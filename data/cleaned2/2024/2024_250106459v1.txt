enhancing the open network definition and automated detection of smart contract defects hao song sichuan university chengdu china ttdelbert foxmail.comteng li university of electronic science and technology of china chengdu china tengli2866 gmail.comjiachi chen sun yat sen university guangzhou china chenjch86 mail.sysu.edu.cn ting chen university of electronic science and technology of china chengdu china brokendragon uestc.edu.cnbeibei li sichuan university chengdu china libeibei scu.edu.cn zhangyan lin university of electronic science and technology of china chengdu china qq.comyi lu bitslab singapore y movebit.xyzpan li tonbit china paul movebit.xyzxihan zhou tonbit china han movebit.xyz abstract the open network ton designed to support telegram s extensive user base of hundreds of millions has garnered considerable attention since its launch in .
func is the most popular programming language for writing smart contracts on ton.
it is distinguished by a unique syntax compared to other smart contract languages.
despite growing interest research on the practical defects of ton smart contracts is still in its early stages.
in this paper we summarize eight smart contract defects identified from ton s official blogs and audit reports each with detailed definitions and code examples.
furthermore we propose a static analysis framework called tonscanner to facilitate the detection of these defects.
specifically tonscanner reuses func compiler s frontend code to transform thefunc source code into func intermediate representation ir in the form of a directed acyclic graph dag .
based on this ir tonscanner constructs a control flow graph cfg then transforms it into a static single assignment ssa form to simplify further analysis.
tonscanner also integrates data dependency call graph taint analysis and cell construct which are specifically tailored for ton blockchain s unique data structures.
these components finally facilitate the identification of the eight defects.
we evaluate the effectiveness of tonscanner by applying it to smart contracts and find a total of defects.
through random sampling and manual labeling we find that tonscanner achieves an overall precision of .
.
the results reveal that current ton contracts contain numerous defects indicating that developers are prone to making errors.
tonscanner has proven its ability to accurately identify these defects thereby aiding in their correction.
index terms ton func defects definition and detection static analysis.
i. i ntroduction the open network ton blockchain is designed to make blockchain technology a readily accessible tool for jiachi chen and ting chen are the corresponding authors.global users .
it aims to be capable of handling millions of transactions per second thereby becoming a ubiquitous decentralized application dapp platform.
leveraging the extensive user base of telegram ton blockchain has garnered significant attention since its testnet phase.
following the launch of the mainnet in ton blockchain has attracted a substantial number of users interacting with dapps on the platform.
as of july according to defillama the total value locked tvl on ton blockchain has reached .
million .
compared to the beginning of the year tvl on ton blockchain has increased approximately times.
the backend of dapps on ton blockchain is developed based on smart contract technology.
smart contracts are turingcomplete programs that run on the blockchain allowing users to interact with the decentralized ledger by invoking these contracts .
ton blockchain uses sharding to horizontally scale overall system performance.
this design differentiates ton from traditional blockchain platforms as ton smart contracts do not perform atomic synchronous access to persistent states .
instead the communication paradigm between smart contracts has shifted to a non atomic asynchronous approach.
to meet performance and scalability requirements ton innovatively introduces the cell as its basic data structure .
the storage and retrieval of smart contract data in ton are centered around the cell.
ton smart contracts also break the limitation of immutable code by providing a native upgrade mechanism .
due to the non atomicity of calls unique data structure and modifiability of ton blockchain there are significant differences in the implementation of smart contracts compared to traditional blockchain platforms like ethereum.
given the unique characteristics of the ton blockchain developers may face an increased riskarxiv .06459v1 jan 2025of contract defects during the development process.
contract defects refer to errors flaws or bugs within smart contracts that result in incorrect or unexpected outcomes or cause the contract to behave in unforeseen ways .
despite numerous previous studies reporting various smart contract defects and some works proposing frameworks or tools for defect detection most of this research has focused primarily on ethereum .
to the best of our knowledge there is currently no research specifically addressing smart contract defects on ton blockchain.
to address this research gap we first conduct an empirical study to define smart contract defects.
specifically we collect blogs from the official documentations the official blogs and the research community recommended by the official sources.
additionally we gather audit reports from blockchain security companies.
these sources provide substantial guidance for our defect definitions.
based on open card sorting approach we ultimately define eight types of func smart contract defects func is the smart contract language of ton blockchain which will be introduced in section ii bad randomness precision loss unchecked return global var redefined improper function modifier unchecked bounced message inconsistent data and lack end parse .
the first three defects may also appear on other blockchains while the latter five are specific to ton.
furthermore to identify the eight defined ton smart contract defects we propose a static analysis framework called tonscanner.
specifically tonscanner leverages the func compiler to transform smart contract source code into a func intermediate representation func ir with a directed acyclic graph dag .
using func ir tonscanner constructs a control flow graph cfg .
to enhance analysis efficiency tonscanner transforms the non static single assignment ssa form cfg into ssa form resulting in ssa form ir .
tonscanner integrates the data dependency call graph taint analysis and a customized cell construct as analyzers.
utilizing these four analyzers tonscanner builds eight detectors for the eight previously defined defects.
based on the requirements for open source and verified code we collect real world func contracts and tact contracts tact is built on func details see section ii totaling contracts.
running our framework on these two datasets we find a total of defects indicating that the defined defects are prevalent on ton blockchain.
to evaluate the performance of tonscanner we randomly sample the two datasets using a confidence interval of and a confidence level of .
we then manually label them and compare the results with our detection outcomes.
tonscanner achieves precision rates of .
and on the func andtact datasets respectively with an overall precision of .
.
the main contributions of our work are as follows we define eight types of func smart contract defects including five of them are specific to ton blockchain.
for each defect we provide a code example to help developers understand and avoid these defects.
we develop a framework named tonscanner based on static analysis for detecting smart contract defects on ton blockchain.
this framework transforms source code into a ssa form ir enabling efficient and accurate defect detection.
tonscanner is also highly scalable supporting the addition of new defect detectors to address future updates and newly identified defects.
we test smart contracts with tonscanner finding a total of defects.
additionally our framework achieves an overall precision of .
on the manually labeled datasets that we randomly sample from these smart contracts.
we publish datasets raw data and tonscanner at ii.
b ackground a. ton smart contract and tvm ton smart contracts are computerized transaction protocols running on ton blockchain designed to manage distributed ledgers and system state.
the system state changes of ton blockchain are governed by a specific execution model .
similar to ethereum the execution model is implemented through a virtual state machine known in ton blockchain as ton virtual machine tvm .
tvm functions as a quasi turing machine with the total computation limited by gas .
tvm executes smart contracts by representing contract code and data as cells stored on the blockchain.
during execution tvm loads these cells into the stack and uses control registers to manage the execution state.
as a stack machine tvm performs instructions by manipulating values at the top of the stack modifying persistent data and generating output actions .
ton smart contracts can be written in three languages tact func and fift .
next we provide explanations of the relevant concepts in this work.
func.
func is a high level c like statically typed language.
func programs are compiled into fiftassembly code which is then converted into bytecode for execution by the tvm.
tact.
tact is the second most popular language for ton contract development after func .tact is built on func and its compiler translates tact programs into func form.
therefore our defect definitions are based on func .
recv internal function.
in ton blockchain this function is executed when a contract is accessed directly .
it can be simply understood as the main function and is a common practice in ton contracts.
bounced message.
bounced message is a mechanism where a message that could not be successfully processed is returned to the sender.
this is primarily used for error notifications and refunding funds.
b. ton vs. ethereum in this subsection we compare the differences between ton and ethereum to facilitate the understanding of this work.
we do not delve into the consensus mechanisms or architectures instead we focus solely on the differences related to smart contracts aligning with the theme of our research.
non atomicity of calls.
on ethereum calls between contracts are atomic.
if any step in the call chain fails the entire transaction will be rolled back.
however on ton blockchain calls between smart contracts are non atomic .
this means that if the final call in a call chain encounters an error the changes made by previous calls will not be rolled back to their initial state.
thus developers must account for such scenarios when writing smart contracts.
specifically developers need to handle messages that are bounced back due to call errors.
if a developer fails to handle these bounced messages it triggers what we define as the unchecked bounced message defect.
unique data structure.
ton blockchain uses a unique data structure called a cell to store data.
a cell can contain up to bits of data and four