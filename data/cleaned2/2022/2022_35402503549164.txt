robofuzz fuzzing robotic systemsoverrobotoperating system ros for finding correctness bugs seulbaekim georgia instituteoftechnology atlanta georgia usa seulbae gatech.edutaesookim georgia instituteoftechnology atlanta georgia usa taesoo gatech.edu abstract robotic systems are becoming an integral part of human lives.
responding to the increased demands for robot productions robot operating system ros an open sourcemiddleware suite for roboticdevelopment isgainingtractionbyprovidingpracticaltools and libraries for quickly developing robots.
in this paper we are concerned with a relatively less tested class of bugs in ros and ros basedroboticsystems calledsemanticcorrectnessbugs including the violation of specification violation of physical laws and cyber physical discrepancy.
these bugs often stem from the cyber physical nature of robotic systems in which noisy hardware components are intertwined withsoftware components and thus cannotbedetectedbyexistingfuzzingapproachesthatmostlyfocus on findingmemory safetybugs.
we propose robofuzz a feedback driven fuzzing framework that integrates with ros and enables testing of the correctness bugs.robofuzz features data type aware mutation for effectively stressingdata driven rossystems hybrid execution for acquiring robotic states from both real world and a simulator capturingunforeseencyber physical discrepancies anoraclehandler that identifies correctness bugs by checking the execution states against predefined correctness oracles and a semantic feedbackengineforprovidingaugmentedguidancetotheinputmutator complementing classic code coverage based feedback which is less effective for distributed data driven robots.
by encoding thecorrectnessinvariantsofrosandfourros compatiblerobotic systems into specialized oracles robofuzz detected previously unknownbugs ofwhich25areacknowledgedandsixhavebeen fixed.
ccsconcepts computersystemsorganization robotics softwareand its engineering software testing anddebugging .
keywords robot operating system ros correctness bugs semantic feedback driven fuzzing esec fse november 14 18 singapore singapore copyright heldby theowner author s .
acm isbn .
reference format seulbae kim and taesoo kim.
.
robofuzz fuzzing robotic systems overrobotoperatingsystem ros forfindingcorrectnessbugs.in proceedingsofthe30thacmjointeuropeansoftwareengineeringconference andsymposiumonthefoundationsofsoftwareengineering esec fse november 14 18 singapore singapore.
acm new york ny usa 12pages.
introduction humanlivesandrobotsareinextricablylinked.traditionally robots havebeenusedextensivelyinagricultureandmanufacturingfor taskautomation.recentdevelopmentshavebroughtrobotseven closerto everyone sdailylives.for example amazon andgoogle are deploying humanless delivery systems using unmanned aerial vehicles themarketsizeofrobotvacuumcleanershasgrown annually and the use of robots in surgical procedures increased from in to in showing how rapidly therobotindustryisgrowingtoaccommodatehumanneeds.simultaneously modernrobots suchasautonomousdrivingvehicles are becomingmoresophisticated demandinganintegrationofcomplex subsystems e.g.
sensing perception planning andactuation.
responding to such higher demands for developing intricate robotic systems robot operating system ros is gaining popularity.rosisanopen sourcemiddlewaresuiteforrobotdevelopment that featuresa message passing scheme for distributed robotprocesses hardwareabstraction abroadcollectionofdevelopmenttools e.g.
simulator androboticlibraries e.g.
pathplanning algorithm .usingros developerscanexpeditethedevelopment processwithouthavingtore inventthewheel andinsteadfocus on the core functionality of their robots.
with its philosophy of multi language and multi platform support ros is proliferating as a de facto standard in robotics programming it has been widely adopted in industry the military research organizations and by individuals and is estimated to power of the totalcommercialrobots shippedin .
althoughhavingsuchauniversalmiddlewareisgenerallyadvantageous a downside exists a flaw in ros itself or in the way developers commonly use ros in their applications can affect a widerangeofroboticsystemsthatdependonrosandwreakhavoc on the safety and security of many users.
for example ros version had no notion of authentication allowing any entity on the networktofullyaccessanyroboticsystem eavesdroponinternal messages and even hijack the execution if the ip address and port are known.
indeed over ros systems deployed in countries were discoveredbyscanning thedefaultrosporton theinternet fortwomonths beingcompletelyvulnerabletosuchattacks.
thelatestversionofros i.e.
ros2 isdesignedandimplemented in consideration of such problems and has invited greater public thiswork islicensedunderacreativecommonsattribution4.0international license.
esec fse november14 18 singapore singapore seulbae kim andtaesoo kim scrutiny of security.
unfortunately existing work and solutions focus either on the network security aspects regarding authenticationandauthorizationmethods oronregression testing leaving the ros communitydeficient in a systematic testingmethodforfindingunknownbugsthataffecttherobustness andcorrectness ofrobotic systems.
giventhissituation fuzzingmayseemtobeaviablesolution as it is well known for its capability of discovering unknown errors in a variety of systems .
however robotic systems are cyber physical.theyhave both physical components hardware interacting with the real world and cyber components software conducting computations and making decisions.
this unique context introduces a new class of bugs closely related to semantic correctness 2. namely violation of physical laws violationofspecifications andcyber physicaldiscrepancy whichdo not exist in traditional software and thus cannot be detected by existing fuzzingapproaches.
as a remedy we propose robofuzz the first feedback driven fuzzingframeworkforsystematicallytestingalllayersofros including the internal layers comprising the ros core as well as the roboticapplicationsbuiltusingrosapis.unlikeclassicfuzzingapproaches which target software binaries looking primarily formemory safetyerrors testingrosrequiresanunderstandingof its distributed architecture underlying components inter process communicationscheme androboticproperties.basedontheknowledgeweaccumlatedbystudyingrosandros poweredsystems we design a flexible fuzzing framework for ros that features a customizableinputmutator hybridexecutor oraclehandler and feedbackengine.
accordingtothetarget layerinrostotest one can select a suitable test strategy by customizing the mutation mode statesto watch properties to check and semanticfeedback to utilize.
given this strategy robofuzz effectively explores the state space of the system under test sut by mutating and publishing messages to two copiesof sut one operating in the cyber world i.e.
asimulator andtheotherrunningphysicallyinthereal world.
states of the suts from both worlds are then collected to finderrorsandgeneratesemanticfeedbacktoassistfurtherinput generation.
todemonstratetheeffectivenessof robofuzz wetestedtheros core aswellasfourros basedroboticapplications namely px4 quadcopter turtlebot3 move it and turtlesim by applying customizedcorrectnessoracles.
byfuzzingthesesystems robofuzz revealed30bugs ofwhich25areacknowledgedandsixarefixed.
among the bugs bugs are high impact bugs that exist in the internal layers of ros i.e.
the type system and the client api implementation affecting anumber ofros basedsystems.
in summary this paper makesthe following contributions weintroduceandstudythreetypesofsemanticcorrectnessbugs that are specific to cyber physical systems.
weproposeandimplement robofuzz afuzzingframeworkthat seamlesslysupportstestingroboticsystems overrostodetect correctnessbugs.theprototypeof robofuzz isopen sourcedat .
by designing robot specific correctness oracles and semantic feedback metrics we test the latest ros distribution and four robotic systems anddetect30 newcorrectness bugs.
background .
challenges oftestingaroboticsystem a typical robotic system can be characterized by the physical hardware component e.g.
a gps sensor or a motor the cyber software component e.g.
an implementation of a control algorithm andthe environment e.g.
aterrain thatarobotinteracts with.thisuniqueconfigurationposesthreechallengesintesting robotic systems.
challenge heterogeneity.
the diversity of robotic systems is enormous surgicalrobotsrequireextraprecision factoryrobots are built to last and aerial robots fly.
moreover robots sharing the same software may behave differently if they have different hardware e.g.
sensorsfromdifferentmanufacturers andthesame robots maybehave differently underdifferentenvironments.
such heterogeneitymakestestingroboticsystemschallengingbecause one testing methodology may not work directly with other robots.
as a workaround we focus on an integral property of a robot that it essentially is a group of distributed processes that exchange data for operation.
in other words a robotic behavior can be represented bythedata flow whetheritisanalog ordigital betweenthenodes.
considering this property we design our framework to be capable ofcapturingandcontrolling the data flowfor testing.
challenge2 hugestatespace.
roboticsystemsoperateinmany different environments and conditions with countless variables that exist in the real world.
as a result the state space tends to be bigger than that of traditional software programs.
to effectively test such a profound system we adopt feedback driven fuzzing which is proven to be effective in exploring large state spaces leading to the successful detection of software bugs .
particularly we propose the use of semantic feedback which is unique to robotic systems to further accelerate the state space explorationbycomplementing the coverage basedfeedback.
challenge noisy hardware.
unlike conventional software that has neatly defined interfaces to exchange accurate data the hardwarecomponents e.g.
sensorsandactuators ofarobotare inherently noisy as they interact with the real world.
for example thegpssensorconstantlyreportsslightlychanginglatitudeand longitude valueseven when a robot is not moving at all.similarly itisalmostimpossibletomovearobottotheexactsamelocation withaprecision ofmillimeters as the actuators are noisy.
toincorporatesuchnoiseintotesting wedesignahybridexecutor whichrunstestssimultaneouslyinasimulatorand inthereal world sothatthestatescapturedfrombothworlds e.g.
thediscrepancy between the values reported by the noisy physical sensor andnoiseless simulatedsensor can be utilizedto assist testing.
.
robot operatingsystem ros robot operating system ros1 is an open source framework designedtohelpdevelopersbuildmodular distributedroboticapplications.
with convenient all in one tools and libraries that support multipleoperatingsystemsandprogramminglanguages combined with a vibrant user community ros established a solidecosystem and attracted many users worldwide to become a de facto standardinrobotics.
1unlessotherwisenoted ros refersto ros2 herein whichis the latestversion.
448robofuzz fuzzing roboticsystems overrobot operating system ros forfinding correctness bugs esec fse november14 18 singapore singapore figure systemarchitecture ofros .
uint32 height image height uint32 width image width string encoding encoding of pixels uint8 data actual matrix data of pixels figure anexample messagedefinition forimagedata.
asshownin figure1 rosseparatestheapplicationlayer from the internal layers so users can focus solely on designing the logical composition of the robotic application while the internal roslayers manage the data distribution.specifically ros powered applications are mainly built around three logical concepts node topic andmessage.
node anodeisaminimalself containedprocesswithadesignated function such as performing computations.
nodes are the foundationsofmodularroboticsystemsthatassistfaultisolation andhigh reusability.
topic atopicisamessagebusconnectingpublishers datawriter nodes tosubscribers datareadernodes .eachtopicmayhave multiplepublishersandmultiplesubscribers enabling multiple nodes to concurrently exchange data anonymously.
message a message is a typed key value data structure that serves as a unit of data transportation.
ros defines built in types bool byte char float int uint string and wstring and array types of the above mentioned built in types.
as shown in figure a message may contain multiple fields of different types.
ros topics are strictly typed meaningthatatopiconlyacceptsmessagesofonetypethatis pre registeredwhen initializingthe topic.
application layer .ros allows developers to build a rosbased application by utilizing ros client library apis to compose a logical network of nodes connected by topics in desired programminglanguages officially c andpython .anillustrativeexampleofarosapplicationisshownin figure3.oncethe developerspecifiesnodesandconnectsthembybindingpublishers and subscribers to topics ros orchestrates the data distribution through the publish subscribe pattern so that if one node publishes a message to a topic the topic broadcasts the message to allthe nodes subscribing tothat topic.
meanwhile the underlying implementation backing the application by handling the process managementanddatadistributioniscompletelyabstractedaway from the user space as shownin figure .
figure an example use of the publish subscribe pattern in a ros application.
nodes gray rounded rectangles publish datatoothernodesthroughtopics whiterectangles .anode may subscribe to multiple topics e.g.
obj detector gets data fromfront image andlaser dist and multiple nodes can subscribetoatopic e.g.
bothpath planner andhazard logger receive data published to objects .
ros clientlibrary apiimplementation .rclapiimplementations are the only user facing apis that expose ros functionality to users in specific languages e.g.
rclcppandrclpy .
developers can be agnostic of theinner workings of ros and simplyutilizetherclapistocomposearosnetworkconsistingof nodes andtopics whichessentiallyisamodularrobotic system.
rosclientlibrary rcl .rclisacommonunifiedlayer thatbridgestheuser spaceapisimplementedinmultiplelanguages with lower level functionalities.
core concepts of ros e.g.
node topic are implemented in this layer so that the behaviors of the language specific apis can remainconstant.
ros middleware interface rmw .rmw is an abstraction layer built to support diverse standalone dds implementations.
it wraps the apis of individual dds implementations in a uniform interface simplifying the interaction withthe rcllayer.
datadistributionservice dds .adds isanetwork middleware that implements the publish subscribe pattern communication for real time systems.
although dds is not specific to ros it became an essential part of ros since it includes a numberofusefulfunctionalitiesfordeliveringarbitrarydata suchas marshalling and de marshalling quality of service qos policy implementation dynamicnodediscovery andmessagedeliveryon the transport layer.
type system based on interface definition language rosidl .thetypesystemofrosutilizesaninterfacedefinition language idl to define messages e.g.
figure to automatically generate corresponding code for the built in ros types in each rcl api language i.e.
c and python and to enforce type checkingatthetimeof valueassignmentanddelivery.italsomaps ros types to the type system used by dds making ros types universally applicable to allros layers.
.
correctnessbugs in roboticsystems havingthecharacteristicsofcyber physicalsystemsdiscussedin 2. robotic systems can suffer from not only traditional softwareorientedbugs e.g.
memorysafetyerrors butalsoanewclassof bugs related to the correctness in the operation.
unlike traditional bugsthatleadtosoftwarecrashes correctnessbugsoftendonot have immediate manifestations but have devastating impacts such asquicklywearingthehardwareofthealreadydeployedrobotic system by pushing the robot beyond its physical capability.
in particular we focus on three types of correctness bugs that can criticallyaffectthe safetyandrobustnessof robotic systems.
449esec fse november14 18 singapore singapore seulbae kim andtaesoo kim violationofphysicallaws.
roboticsystemshavephysicalparts operating in the real world and are thereby bound by various laws of physics and their derivatives that should always hold.
for example as defined by kinematic equations if there is a change of displacement the robot must have a non zero velocity and if there is a change of velocity the acceleration must be non zero.
if the robotic states either externally observed or broadcasted by the robot itself violate any of the known physical laws it implies componentfailure orlogical errorinthe software.
violationofspecification.
specificationsordatasheetsofarobot contain essentialinformationabout theroboticsystem including the physical capabilities of the components e.g.
sensor fidelity or jointlimits aswellasvariousassumptionsaboutroboticbehaviors.
not complying with the specifications the robot can be physically damaged and othercomponents that rely on the specification can also be broken critically affecting the robustness of the system.
regardlessofwhetherthespecificationisincorrect ortheimplementationofthespecificationiserroneous thosecasesshouldbe detectedandhandled.
cyber physical discrepancy.
simulations are often preferred overreal worldenvironmentswhendevelopingandtestingrobotic systems because of the cost and safety benefits.
here the practical meritsofutilizing simulatedrobots arevalid onlyif thesimulated robotsarecloselymodeledtotheirphysicalcounterparts.inthis regard if the behaviors of two identical robots in the real world andthesimulationaresufficientlydifferent weregarditasacyberphysical discrepancy bug.
.
motivationandscopeofwork ros is undergoing constant development every year a stable version with new features upgrades and bug fixesis released.
at the sametime anincreasingnumberofroboticsystemsarebeingbuilt ontopofrosdistributions.roscomesinacomplicatedpackage thatincludesmultipleabstractionlayersinteractingwitheachother andvariousddsimplementationsfromdifferentvendors which makes eliminating bugs and ensuring correctness challenging.
unfortunately ros currently relies on minimal testing approaches e.g.
unittesting whicharenotversatileenoughtodetecta widerangeofunknownissues.thus inthispaper weareprimarily concernedwithquicklydetectingunknownbugsandcorrectness issuesfromsuchanevolvingcodebasebybuildingagenericfuzzing framework targeting the internal abstraction layers of ros as well as the robotic applicationspoweredbyros .
3robofuzz a genericframework .
overview robofuzz is a customizable feedback driven fuzzing framework tailoredforrobotoperatingsysteminternalsandapplications.the keyintuitionbehindthedesignof robofuzz isthataroboticsystem ros basedsystems in particular is a stateful nodedsystem inwhichnodeschangetheirstatesbasedonthedata theyreceive.
therefore the behavior of robotic systems can be summarized as thedata message flowamongthedistributednodes .robofuzz approaches testing from the data flow standpoint injecting messages to nodes composing the robotic systemundertest.
figure4 overviewof robofuzz sarchitectureandworkflow.
algorithm fuzzing algorithm of robofuzz input robot roboticsystem strat s sched t w o teststrategy s set ofseed messages sched mutation schedule t set oftargetnodes w set ofstates to watch o set ofcorrectnessoracles nr maximum roundsin acycle output bug a detailed bug report msg messagethattriggered thebug 1procedure robofuzz main 2graph inspector.inspect robot 3.
3foreachseed sdo fuzz one seed graph 5procedure fuzz one seed graph 6msg seed 7last score 8forrounds 1tonrdo msg mutator.mutate msg sched graph t 3. states executor.sim execute robot w msg 3. stater executor.phy execute robot w msg 3. iforacle handler.check bugs o state s stater 3. true then save bug report msg states stater return else score feedback.quantify score states stater 3. ifscore last scorethen last score score s s msg the architecture and workflow of robofuzz are illustrated in figure4 andalgorithm1 presentstheformalalgorithm.
robofuzz takesatargetsystemandateststrategyasinputandoutputsthe reportoffoundbugs.thesysteminspector 3. analyzesthetarget system and extracts the ros graph.based on the extracted graph themessagemutator 3. mutatesrosmessagesandpublishes them to the target node s running in the hybrid executor 3. .
statesarecollectedduringtheexecutionofthetargetundermutated messagesandcheckedagainsttheprovidedoraclesbytheoracle handler 3. .
if the oracle detects any failure a bug report is generated andthefuzzingloopterminates.otherwise thefeedback engine 3. quantifies the interestingness of the target s behavior from the execution states and provides feedback to the message mutator guiding subsequent mutations.
.
systeminspector thefirst stepoftesting istoscan therobotic systemtoobtain the ros network graph which is a topological view of the robotic 450robofuzz fuzzing roboticsystems overrobot operating system ros forfinding correctness bugs esec fse november14 18 singapore singapore systemconsistingofallnodes topics andassociatedmessagetypes.
the system inspector launches the robotic system and examines therosnetworkbyinvokinginternalnodediscoveryapisofros.
unlessthetargetnodeisspecifiedonthetestprofileprovidedby the user allnodes inthe identifiedrosnetwork that subscribeto at leastone topic automaticallybecome the candidates oftesting.
.
type awaremessage mutator ros basedsystemsaredrivenbyrosmessagesdistributedalong the nodes of the ros network.
thus a testing framework has to be capable ofstressing thesystembygenerating andtransferring proper messages to relevant nodes.
the message mutator is designedspecifically for this task.
type aware mutation.
it is important to note that all topics in the ros network are bound to strictly typed messages.
given that the type checker of ros idl works correctly any message isrejectedtobepublishedifitdoesnotconformwiththetopic s type that is determined when the topic is initialized i.e.
when the robotic system is launched .
in light of this property robofuzz supportstype awaremutationofmessages associatingappropriate mutationoperatorswitheachrosdatatypetoconstraintheresult ofamutation within the right type.
thisisachievedby inheritingthegeneralmutationoperators such as bit flip byte flip and arithmetic operators from american fuzzy lop afl which are proven to be effective in mutating arbitrary data blobs and then associating each operator with rosdatatypesuchthatitisguaranteedfortheapplicationofan operator to produce the values expressible by the type and also addingaugmentedoperatorsthatproducespecialvalues e.g.
nan andinfoffloat andboundaryvalues e.g.
uint32 max for32 bit unsigned integer that are often mishandled by the robotic system.
in addition robofuzz allows users to register custom mutation operators e.g.
generating float in a certain range for extensibility.
specifically givenamessage themutatorselectsoneofthefields retrievesthedatatypeassociatedwiththeselectedfieldfromthe ros network graph and applies one of the mutation operators definedfor that data type.
message scheduling.
the mutator also manages the schedule of when the mutated messages should be published considering thecontextandpropertiesofthetargetsystem.forsystemsthat performaseriesofactionsuponreceivingonemessage publishing a single message and watchingthe behavior would be appropriate e.g.
agoalcoordinatemessagetoatrajectoryfollowingrobot .ifa systemismorerealtime requiringastreamofmessages publishing asequenceofmessageswouldbetterfitthepurposeoftherobot e.g.
remote control messages to a drone .
robofuzz systematically schedules testing campaigns by defining configurable factors suchasthenumberofmessagesinasequence frequencyofpublication andthetimetowatch andlettingusersdecidetheright configurationbasedontheirneeds.
.
hybridexecutor manydevelopersrelyheavilyonroboticsimulatorstobenefitfrom reduced cost and time in developing and testing robotic systems.
even though modern simulators have relatively realistic physics engineswithmoderatelyaccuratedynamicsandkinematicsmodels a px4drone intherealworld b px4droneingazebosimulator figure hybrid executorrunning px4dronesimultaneously in the real world and the simulator.
the actual place is accurately modeled gps coordinate trees and building to minimize unhandled discrepancy between twoenvironments.
a certain degree of discrepancy between the simulation and the real world execution is inevitable either because of the lack of accuracy in the modeling or simply because the state in concern isnotavailableinthesimulator e.g.
thetemperatureofa motor .
in severe cases the in simulator position of a robot differs from thepositionofaphysicalrobotafterreceivingtheidenticalcontrol commandsduetothediscrepancy.suchissuemakesasimulator inthe loop sitl testinginsufficientto test for allpotentialissues.
tofillthegapbetweenthesimulatorswithinsufficientfidelity andprofoundphysicalenvironments weemployahybridexecution model in robofuzz .
as illustrated in figure the hybrid executor runstherobotinasimulator andsimultaneouslyintherealworld if thephysicalrobotisavailable .itthenrelaysthemutatedmessages to bothsystemssothat both robotscan takecorresponding actions to the identical messages.
in the meantime the executor monitors both worlds to capture the states and events.
robofuzz benefits fromthisdesignbecause therearecomplementarystatesthat areonlyavailableineitheroftheworldsand thereareredundant states that show divergence especially if the relayed messages are relatedto sensors oractuators as discussedin 2. .
.
oracle handler everyroboticsystemhasadifferentdefinitionof correctstatesand based onthese employsdifferentinvariantsduringtheexecution.
thus a practicaltesting frameworkmust allowdevelopers to conveniently declare and apply correctness oracles that are specific to eachroboticsystem.
robofuzz providesanoracletemplate that allows developers to define oracle stateswith respect to thestates capturedbythehybridexecutor.thebuilt inoraclehandlerchecks up on the robotic states with the provided oracles and generates bugreportsifanyviolationisfound.in 4 wedemonstratetheuse ofrobot specificdeveloper definedoraclesthat we builttargeting differentsystemsto reveal correctness bugs.
.
feedbackengine in a fuzzing process execution feedback plays an important role in providing guidance to the mutation engine.
typically the effectivenessofthemutatedinputintheexecutionisquantifiedto determine whether the mutation engine should keep mutating the input or move on to another input.
with the intuition that more bugs can be detected by exploring more code paths in the program moderngreyboxfuzzersuse codecoverageasfeedbackandtryto generate inputs that increase the code coverage.
such a strategy workswellforgeneralsoftwareprogramsthathavediversecode paths along the execution and results in finding a number of bugs.
451esec fse november14 18 singapore singapore seulbae kim andtaesoo kim however robotic systems by nature are distributed systems whose behaviors are driven by state changes excited by data flow ratherthanbythecontrolflow andthustendtohavealimitednumberofcodepaths.thispropertymakescoverage basedfeedbackless effective in summarizing the execution of robotic systems as code pathsareredundantevenwhentherobotexhibitsawidevarietyof behaviors andledustodesignanaugmentedfeedbackmechanism tailoredforroboticsystems.tocomplementthecoverage guided feedbackmechanismandenhancetheinputstateexplorationfor robotic systems we propose semanticfeedback which quantifies the bugginess of the execution context by taking advantage of the domainknowledge ofthe testedrobots as detailedbelow.
redundant sensor inconsistency feedback.
in robotics multipleredundantsensorsareutilizedtoimprovetheaccuracyofthe acquireddataand toprovidefaulttoleranceinthefaceofsensor failure .
the assumption behind utilizing redundant sensors is thateventhougheachsensorprovidesitsownmeasurementofthe state in varying precision the results should align with each other with high similarity because we simultaneously measure the same property.fromanalternativestandpoint adiscrepancyinthestates measured by redundant sensors indicates potential issues in the system such as instability.
therefore robofuzz allows developers to register multi sensor inconsistency as feedback if redundant sensors are present in the systemunder test.
in the case when the robotic sut has no redundant sensor one could take advantage of themodulararchitectureofroboticsystemsandinstallaredundant sensor to facilitate the testing.
control error based feedback.
closed loop feedback control is a crucial part of robotic controllers taking a control command input a robotic system outputs the error between the referencevalue e.g.
currentposition andthesetpoint e.g.
desired position whichisfedbacktothecontrollersothatitcangenerate the next control command that can defeat the error.
if a controller is erroneous or poorly calibrated it could fail to reduce the control error makingtherobotuncontrollable.thus developerscanutilize theknowledgeoftheinternallogicofthecontrollertoaugmentthe testingbyfactoringthe controlerrorintothe executionfeedback.
state distance based feedback.
for any numeric state that is bound by physical limits the difference between the measured value and the limit indicates the distanceto the erroneous state.
thus astrategyoffavoringtheinputmessagesthatminimizesuch distance can potentially contribute to guiding robofuzz to trigger errorsthat specification basedoracles 3. attemptto detect.
cyber physical discrepancy feedback.
when the hybrid executor 3. runs the robotic sut it assures that the exact same messagesfromthemessagemutatorarepublishedtoboththephysical robot and the simulated clone which run the same software stack with an identical configuration.
accordingly the resulting states of both robots are expected to be identical.
however in practice there are unwanted factors such as the sensor noise or inaccurate modeling of the simulator that affect the fidelity of the execution and result in a discrepancy in the states such as the divergence in the trajectory over time.
by providing tools for computingdiscrepanciesandregistering them as feedback robofuzz assistsdeveloperstotakesuchfactorsintoaccountinthetesting andexcite the unhandledaspectsofthe executionenvironment.4robofuzz inaction specialization with the base framework introduced in 3 one can readily turn robot specific knowledge and expectations into a specialized fuzzingcampaign.todemonstratehow robofuzz canbeapplied toheterogeneoustargetsandeffectivelyfindbugs weselectfour robotic applications of distinctive properties and study them to generateappropriate oracles andsemantic feedbackmetrics px4quadcopter px4 anopen sourceflightcontrolstack knownforitssupportforavarietyofquadcoptermodelsand high configurability.
turtlebot3 tb3 a differential wheeled mobile robot equippedwithalidar sensor.
move it mi2 a robotic manipulation library for ros thatimplementsfundamentalconceptsofroboticmanipulation such as kinematics motion planning andcontrol.
turtlesim tsm a lightweight velocity controlled turtle robot ina2d simulator shippedwithros for tutorials.
forrosinternals wetarget rclapis andthe typesystem rosidl toensurethebuildingblocksofros basedapplications arecorrect.inthissection wediscussnotabletarget specificfactors leadingto differentmutation strategies oracles andfeedback.
.
common oracles beforeweintroducetarget specificstrategies therearecommon oracles that can be universally applied to multiple robotic systems.
unlessotherwisenoted thesecommonoraclesareutilizedbydefault alongwiththe specializedoracles.
physical constraint oracle.
robotic systems operate in the realworldandaretherebyboundbycertainphysicalconstraints.
the oracle handler adopts a set of checks for physical sanity i.e.
statesrelatedtotheexistenceoftherobotinthephysicalspacecan neitherdisappearnorhaveinfeasiblevalues.inparticular anystate indicatingthegeometryoftherobot i.e.
x y z fortheposition and roll pitch yaw for the orientation should present a feasible value if the robot is in the three dimensional physical space.
for example it is guaranteed by physics that the z position ofa robot can never benull nan orinf.
likewise kinematics related states such as velocity should always present physically tractable values belongingto the real number range.
sanitizeroracle.
althoughnottheprimaryconcernof robofuzz theoraclehandleralsointegrateswithcompilersanitizerstosupport the checking of classic memory safety issues and miscellaneous software oriented errors in the robotic sut.
if the target node is compiled with sanitizer flags the sanitizer oracle detects theerrorsignalsemittedbyaddresssanitizer orundefindbehaviorsanitizer when the systemterminates.
.
testingpx4quadcopter mutationandscheduling.
px4isacomplicatedsystemthatacceptsmultipleformsofinputs onecan send trajectorysetpoint messages that consist of the target position x y z orientation yaw speed vx vy vz yawspeed and acceleration ax ay az tohavetheinternalmotionplannerworkoutmovementcontrol plans to reach each setpoint directly send a stream of control 452robofuzz fuzzing roboticsystems overrobot operating system ros forfinding correctness bugs esec fse november14 18 singapore singapore commands thatconsistsof throttle yaw pitch roll valuescorresponding to the position of the control sticks of a remote control unittomicro controlthedrone or switchthe parameter values as suggested by to dynamically configure the drone in runtime.
robofuzz considers all three input spaces and mutates and schedules messages accordingly for robofuzz mutates one attribute e.g.
vx of one message in the sequence of trajectory setpoint messages and publishes them at a given interval e.g.
20hz for robofuzz mutates one of the stick values of one ofthecontrolcommandmessagesinthesequenceandpublishes theentiresequence andfor robofuzz mutatesthevalueofa parameterandrequestsparameterchangethroughthemavlink protocol.
oracles.
three types oforacles are formulatedfor px4 parameter specification based oracle the behavior of px4 based robots is configured by parameters which are numeric values used in the controller software to configure the robot e.g.
maximum velocity along the z axis .
as the system makes various assumptionsbasedon theparameters violatingtheparameters couldleadtosafety criticalsituations asdemonstratedin 6.we parsedthepx4documentationforparametervaluesandmapped vehicular states with each parameter so that the oracle checks whether the captured states satisfy the valid range set by the corresponding parameterandreports the violations.
safety oracle a collision is considered one of the most undesirable events during flights and any collision needs to be investigatedregardlessofthecause.thesafetyoraclechecksfor collisionsusing the data read bycontact sensors.
flightmode oracle px4supportsvarious flight modes and each modeutilizesdifferentcontrollerlogic leadingtodifferentmaneuvers.
the documentation of px4introduces each mode specifyingtheexpectedbehaviorsofthemode.foreachmode the oracle modelsthe control algorithm checking whether the describedcontrolisbeingexecuted.forexample the takeoffmode brings a drone straight to the desired altitude and does not require any external controls.
if a drone moves horizontally in this mode the incident isreportedbythe oracle as abug.
feedback.
twopx4 specific feedbackmetrics are applied redundantsensorinconsistency pixhawk4 aflightcontroller hardware designed to run px4firmware has two inertial measurementunit imu sensorsofdifferentvendors bmi 055of boschandicm 20689oftdk.bothsensorsutilizeanaccelerometerandagyroscopetomeasurethechangeintheposition location andorientation rotation of the drone.even thoughthe twosensorsvaryinfidelity theyreportconsistentacceleration and angular velocity measurements with negligible discrepancy.
however weobservedthattheirresponsestoanomalousorextreme events such as collisions or flips that bring about rapid movements are divergent resulting in a considerable discrepancy in the readings.
accordingly we interpret the difference between two imu readings as an instability metric and use it as an element of the execution feedback such that inputs that lead to larger discrepanciesare favored.
positionestimationerror px4utilizestheextendedkalmanfilter ekf to combine the measurements from the imu magnetometer and gps sensors into the estimation of the globalposition i.e.
latitude and longitude .
as the controller of px4 computes the thrust amount to minimize the difference between thesetpoint desiredposition andtheestimation currentposition theestimationerroriscriticalinthebehaviorofadrone.
one of the reasons jeopardizing the reliability of the ekf estimation is known as excessive vibration of the drone body.
in lightofthis wecomputethepositionestimationerror i.e.
the euclideandistancebetweentherawgpssensorpositionandthe ekf estimatedposition andregisteritas feedback.
.
testingtb3andtsm tb3is a differential wheeled robot whose movement relies on two individuallyactuatedwheelsonacommonaxis.ithasa360 degree laserdistancesensor lds onthetopthatenablessimultaneous localization and mapping slam and autonomous driving.
tsmisessentiallya2dversionof tb3 whichisvelocitycontrolled.
mutationandscheduling.
tb3runsadesignatednodethatreceivestwistmessages which consist of target translational speed m s and rotational speed rad s and runs a differential drive algorithmtocontrolthetorquegeneratedbytwomotors.accordingly robofuzz mutatesthetargetspeed publishesthemessage tothenode andthenmonitorsthedynamicstatesof tb3 including its position velocities andlaser scan data.
oracles.
alongwiththecommonoracles wedesignedtwo tb3specific oracles.
specification based oracle similar to the px4oracles physical invariantsoftherobot such as themaximum translationaland rotational velocities are collected from the specification document oftb3.in addition from the datasheet andthe code of the laserdistancesensordriver therange ofvalidscandistancedata isobtained whichisalsocheckedbythe tb3 oracle.
goal based control oracle unless the commanded linear and rotationalspeedsdonotexceedthespecifiedlimits tb3isbound toachievethetargetspeed.thisfundamentalpropertyischecked throughthe goal basedcontroloracle.
feedback.
odometry is a process of measuring the change in position over time.
to a robot that does not have a global position sensor e.g.
gps accurateodometryisthekeytoestimatingthe globalposition andguaranteeing correctnavigation.
odometric inconsistency tb3runs odometry to calculate the change in its position and orientation upon the actuation of controlcommands.here theodometryinvolves tworedundant methodsto calculate the change of yaw angle one using the measurement of the imu sensor and the other using the amount of rotation of the wheels.
under normal execution conditions bothmethodsyieldanalogousyawangles.however whenthe instabilityincreases e.g.
iftherobotswaysandthewheelsdo notstickontheground thewheel basedmeasurementbecomes imprecise aswheelmovementdoesnotalwaysleadtothechange inposition andresults inincreasedodometricinconsistency.
.
testingmi2with pandamanipulator panda manipulator by franka emika is a popular robot arm equipped with seven revolute joints and torque sensors.
its control interfaceofficially supports ros and mi2 enabling the testing.
453esec fse november14 18 singapore singapore seulbae kim andtaesoo kim autonode std make shared rclcpp node rclcpp node a rclcppapito create a node.
node rclpy.create node rclpy node b rclpyapito create a node.
c callchainofrclfunctionsthatareinternallyinvokedwhen rclcpporrclpyapisarecalledto create a node.
figure apiconsistency on theros client library rcl .
mutationandscheduling.
mi2 strajectoryplanneracceptsthe goal position which specifies where the hand of the robot arm should be placed and determines the position and motion of the joints i.e.
angles of revolute joints over time to realize the goal position throughinversekinematics.
oracles.
approaching from the control algorithm s angle we designedthree following oracles inversekinematicsoracle dependingonthegoalpositionand constraints theinversekinematicssolutionmayormaynotexist.
this oracle emulates the inverse kinematics using an external module and checks whether mi2fails to find an existing solution.
specification based oracle the motion of the robot is physically constrainedbyvariousjointconstraints e.g.
minimumandmaximumangleajointcanachieve .similartootherroboticsystems we parse the datasheet of panda robot to extract the joint constraints andturnthemintoan oracle checking for violations.
physicalcorrectnessoracle thecontrollerperiodicallypublishes jointstates whichconsistofpositionandvelocitysetpointscomputed by the trajectory planner the actual position and joint velocities anderrors betweenthese vectors.here the positions andvelocitiesshouldbevalidnumericvalues andthejointvelocities should be non zero when the manipulator is being actuated.
feedback.
asmentionedin 3. thejointcontrollerofpanda manipulatoralsoperformsclosed loopfeedbackcontrol utilizing the errorbetween the setpointsandactual position.
joint level controller error the control error measured for each jointindicateshowpreciselythetorquecontrollerisachieving theplannedtrajectory.errorsexceedingthecapacityoftherobot cannotbecorrectedandleadtocontrolfailure.thus byfavoring mutated messagesthatresultinincreased joint levelcontroller errors we can excite the failure andreveal bugs.
.
testingros rclapi consistency asdescribed in 2. rclapiimplementationsarethin wrappers written in specific languages around the core functionalities of the rcllayer.regardlessoftheapilanguage itisexpectedthatthe codepathstakeninrclareidentical suchthatthesamerclfunctions are invoked and return the same result e.g.
return values .
figure6showsanexampleofrclapiconsistency.rosapplicationswritteninc cancreateanodeusing the rclcppshownin figure a .
likewise therclpyapi offigure b can be used iftable codesize ofthe components of robofuzz .
component loc language systeminspector pythonmessage mutator and scheduler hybrid executor and harnesses oraclesand feedback engine the ros system is built in python.
in both cases each rcl api invocation ends up invokingthe same rcl functionslisted in figure6 c ensuringthatarosnodeiscreatedandinitializedinaway that is uniform and thereby correct.
the api consistency oracle isdesignedtocheckwhethertwo ormore apiimplementations emit consistent behaviors with respect to the rcl code path by dynamicallytracingtherclfunctioninvocationsandthereturn valuesduringthe execution.
.
testingros rosidl basedtypesystem ros idl is the centerpiece of ros type system which not only generates language specific code e.g.
c struct for user defined message interfaces consisting of ros native types but also dynamically checks the types of messages coming into and out of ros topics.
built upon the assumption that ros idl works correctly rosnodesoftenomitredundanttypechecksofthedataithandles andeven boundary minimumandmaximum checks.
our idl correctness oracle is designed to test such foundational assumptions.
given amessagecontainingfields f1of built indata typet1andf2offixedarrayoftype t2 theidlcorrectnessoracle checks for the following five invariants regarding the type system assigning avalueoftype t tof1 wheret t should fail assigning avaluebigger thanthe maxoft1tof1should fail assigning avaluesmallerthanthe minoft1tof1should fail assigning a value of type t to one of the elements of f2 where t2 t should fail the valueassignment succeedsotherwise.
evaluation inthissection weevaluatetheoveralleffectivenessof robofuzz in finding correctness bugs in heterogeneous robotic systems by answeringthree questions q1.
howeffective is robofuzz infindingrobotic bugs?
5. q2.
howeffective isthe semantic feedbackmechanism?
5. q3.how does robofuzz compare to a state of the art robotic fuzzer?
5. implementation.
weprototypedthe robofuzz frameworkand the specialized oracles in .5k lines of python3 code as shown intable1.theframeworkisbuiltbasedonros2 foxy whichis the latest ltsdistributionof ros .
costoforaclecreation.
twoweeksonaveragewererequired forapersonwithacollege levelknowledgeofroboticstostudyone system review its specificationsand code and implementoracles.
fortherobotdeveloperswhobetterunderstandtheirownsystems less creation costisanticipated.
experimentalsetup.
weperformedtheevaluationonalaptop machinerunningubuntu20.
withinteli7 8850h .6ghz 16gb ram andquadrop2000 mobilegpu.
we targeted four robotic systems px4 tb3 mi2 andtsm as well asros2internals rosidlandrclpy rclcpp .forpx4andtb3 we 454robofuzz fuzzing roboticsystems overrobot operating system ros forfinding correctness bugs esec fse november14 18 singapore singapore utilized the actual robots along with their simulated clones px4 using holybro x500 frame with pixhawk4 flight controller which runspx4v1.
andtb3 burger build which runs foxy devel firmware.allsimulationswereruninagazebo11simulator exceptfortsm whichoperatesinitsown2dsimulator.forinternal layer testing we builtros foxyfrom the source.
foreachofthesixtargets wecreatedseparatefuzzinginstances perinputtype thetargetaccepts e.g.
threeforpx4 4. andone for eachof therest.eachinstancewasrun for12 hourswithonly target specificoraclesactivatedtopreventbugsinotherlayers e.g.
underlying bugsinros from overshadowing the target bugs.
hybridexecution.
robofuzzfullyautomatesthehybridexecutionatthesoftwarelevel butphysicalexecutioninvolvesinevitable manual actions e.g.
rebootinga robot through a power switchand puttingitbackattheinitialposition.inaddition duetobatterylife safety and the need to visit the test site we intermittently utilized the hybrid executor for physical robots we tested each robot for approximately minutes each time for a total of hours in additionto otherfuzzinginstances.
.
effectiveness of robofuzz newcorrectnessbugs robofuzz detectedfromthetargetrobotic systems are listed in table .
utilizing the in house developed bug oracles robofuzz found previously unknown bugs2.
we reported all the findings to the developers and as a result bugs have been acknowledged and six bugs have been fixed so far.
it should be noted that among the bugs robofuzz found bugs reside in the internal ros layers potentially affecting any robotic systemthat isbuiltontop ofros.
wevalidatedeachbugbyreplayingtherecordedinputmessages against the robotic system under test and observing the consequences i.e.
checking if the oracle handler reports the same errors.
since we dynamically tested systems using concrete input messagesanddefinitiveoracles e.g.
specificationviolation noneof the detectedbugswere identifiedas afalse positive.
.
effectiveness ofsemantic feedback to showtheefficacy ofutilizingthesemanticfeedbackasfuzzing guidance we comparethenumberofbugsfoundovertimewith andwithoutthefeedbackwhilefuzzing px4 whichisthelargestin codesizeandstatespaceamongthetargets analyzethefeedback score demonstratingthe correlation betweenthe metricsproposed in 4.2withthecorrectnessbug and showhowtraditionalcode coveragefeedbackperforms inthe meantime.
fuzzingwithandwithoutfeedback.
figure7showsthenumber of bugsrobofuzz discovered while fuzzing px4for hours with andwithoutthesemanticfeedback.withtheguidanceoftheredundantsensorinconsistencyandpositionestimationerrorfeedback 4. robofuzz found nine instances of bug in the position mode.incontrast whenwedisabledthesemanticfeedbackguidance robofuzz reliedsolelyonthe randommutation andfound only twocasesofthe same violation in12 hours.
2eachbugwastriggeredmultipletimesbydifferentinputs butcountedonceperits root cause identified by manual analysis.
bugs quantified feedback fuzzing time hr feedback score normalized bugs quantified feedback fuzzing time hr with feedback w o feedback figure7 numberofcorrectnessbugstriggeredwhilefuzzing px4for hours with and without semantic feedback.
green boxesindicatethequantifiedsemanticfeedbackgenerated duringtherun with feedback normalized to range .
12branch coverage fuzzing time first10mins fuzzing time total hr figure8 codecoveragemeasuredduringthe12 hourfuzzing campaign presented in figure .
the first minutes are magnified left and theentire result isshown on the right.
breakdown of the semantic feedback score.
inputs that increasethefeedbackscoreareputintheinputqueue astheydeserve further mutations.
in the case of px4 if the imu sensor inconsistency or ekf estimation error increases the input is marked as interesting.
the contribution of feedback scores in finding bugs is illustrated in green boxes in figure .
after detecting a bug the feedbackscoreisreset asanewfuzzingcycleisinitiated.during mostcycles wecanobservethatthefeedbackscorehasatendency togrowovertime and robofuzz ultimatelyreachesthebugsby focusing onmutatingthe inputsthat generatestronger feedback.
impact of traditional code coverage feedback.
as discussed in 3. roboticsystemstendtohavelimiteddiversityinthecode pathsbecause oftheirdistributedand data heavy nature.we observed this by instrumenting px4and measuring the branch coverage using gcov during fuzzing as shown in figure .
the code coverage quickly saturated at in the first minutes and thenhardlygrewduringtheremaining12hourseventhoughthe drone exhibited a variety of different behaviors including nine specificationviolations.thisshowstheimportanceofincorporating supplementary feedback guidance in the robotic context to complementtraditional code coveragefeedback.
.
comparisonwith pgfuzz pgfuzz isastate of the artfuzzerthataimstofindpolicyviolationsinpopulardronecontrolsoftware including px4.itidentifies policies from the documentation maps each policy to the input spaceconsistingofconfigurationparameters environmentalfactors and user commands through static profiling and mutates the inputspacetryingtominimizethedistancetopolicyviolations.by extendingthe robofuzz oraclesbyimplementing21 px4policies pgfuzzidentified includingtheoverlappingpolicieswealready considered we successfully detected out of policy violations pgfuzzreported.the remaining10 violations require intentional faultinjection e.g.
shuttinggpsoffvia px4shellcommand which isnot the inputspaceconsideredby robofuzz .
455esec fse november14 18 singapore singapore seulbae kim andtaesoo kim table list ofnew correctness bugsfoundandreported by robofuzz .rs simulated robot rp physical robot.
layer target bugdescription type ack?
fix?
ros 2applications01px4 offboard mode horizontal acceleration setpoints are not constrained by mpc acc hor max parameter s 02px4 offboard mode controller implementation offeed forward setpoint differs fromdocumentation s 03px4 offboard mode mismatchin trajectory setpoint messagedefinition s 04px4 offboard mode incorrect definition ofapplicableparameters oftheflight mode s 05px4 positionmode definition of mpc pos mode does not matchtheimplementation andinconsistent withinthedocumentation s 06px4 positionmode incorrect usageof mpc acc hor andmpc acc hor max definition s 07px4 positionmode incorrect description of mpc acc up max andmpc acc down max parameters s 08px4 takeoffmode switching frommanual altitude position acromode drone filestowards anarbitrary setpoint s 09tb3motor driver implementation of rpdoes not follow theactualmotorspecification resulting in a smaller maximumvelocity s 10tb3constraining logic on rpfirmware fails to correctly clamp velocity to thevalidrange s 11tb3maximumtorque achievable by rsis not constrained by theactualmaximumtorque ofthemotorspecification s d 12tb3maximumvelocity by thedifferential drive controller of rsdoes not matchthatof rp d 13tb3mismatchbetween lidar scan data software sidedataexceeds thehardware sensor sspecified maximumrange d 14mi2jointlimitsare incorrectly defined in the rsmodel exceedingphysicallimitsandallowinginvalid postures s d 15mi2jointvelocitiesare broadcasted aszerowhen themanipulator is moving p 16tsmtype confusion while normalizing orientationangles resultsin physicallyinvalid positionvalues nan p 17tsmmissingvalidationsof nan infvaluesonthecontroller inputsleadsto physicallyinvalid states p ros 2internals18rosidl codegeneratorfor rclpydoes not check32 64bit float boundaries treatingall floatvaluesasdouble r 19rosidl runtimemessagesetterdoes not handle bytetypes correctly bytevaluesare internallytreated asstringliterals r 20rosidl missingdatarangechecksfor theelementsof intarrays e.g.
65535can be assigned to int8array r 21rosidl missingdatarangechecksfor theelementsof floatarrays double sized valuecan be assigned to floatarray r 22rosidl implicit type casting ofarrayelementsaltersdatawithoutnotifying e.g.
assigning 32to uint8array thevaluebecomes224 r 23rosidl missingtype checksfor boolarrayelements allowingdataofany type to be stored e.g.
string list dictionary ...can becomeanelement r 24rosidl missingtype checksfor bytearrayelements allowingdataofany type to be stored e.g.
string list dictionary ...can becomeanelement r 25rosidl missingtype checksfor stringarrayelements allowingdataofany type to be stored e.g.
list dictionary byte bool ...can becomeanelement r rclpy on parameter event alwaysreturns true regardlessoftheresult r rclpy missing nullcheckofrmw handle inrclpy create publisher leading to nullpointer dereference s rclcpprclcppinternallythrows an exceptionwhile validating incorrect topic service names which cannot be caughtby requester r rclcpp nodeobject reliesonsubscriptioninterfaceto catch parameter events violating design principleofparameter callbacks s rclcpp unreachableerror checking codefor parameter event type r p physicalincorrectness s specification violation d cyber physical discrepancy r miscellaneous software error in ros on the contrary pgfuzzmissed all the new bugs detected by robofuzz forthefollowingthreereasons.first thepolicies pgfuzz manually identified from the documentation do not include all specifications that robofuzz oracle checked.
second some bugs are only triggered by a stream of real time inputs e.g.
remote control signals with accurate timing.
pgfuzzcannot generate such complicated inputs with its coarse timing model which only specifiesthehappens beforerelationshipbetweeninputs.finally due to the lack of soundness of the static profiling engine pgfuzz missedonepolicyviolation robofuzz detected bug 08in table2 eventhoughthebugviolatestwoofthe21policiesittargeted.since the static profiler maps inputs to target parameters by tracking dependency thestatetransitionsthatrelyonimplicitdependencies such as the caseofbug are removedfrom the inputspace.
case study correctness bugs in robotic systems are subtle and complicated to reason about as both hardware and software components are involved.
in this section we introduce and analyze interesting correctness bugs robofuzz discovered.
px4 drone loses control with unconstrained acceleration setpoint.
offboard mode is one of the autonomous modes that realizes trajectory setpointsreceived from a companioncomputer.
bugs in table2arerelatedtothecombinationofspecification violation and missing input sanitation as detailed below.
first even though the documentation of px4definesmpc acc hor max as maximum horizontalaccelerationfor automodeandfor manual mode and assigns a default value of 5m s2 this constraint isnotappliedtotheaccelerationsetpoints allowinganyvalueto be forwarded to the controller.
consequently an abnormally largehorizontal acceleration setpoint e.g.
ay 3000m s2 immediately contaminates the internal controller states which results in generatinghugehorizontalthrust.thecontrollerkeepspushingthe drone at the maximum velocity as it tries to realize the setpoint acceleration 3000m s2 while the actual acceleration saturates atthehardwarelimit.unfortunately oncetheinternalstatesare contaminatedandthedronegearsupfortheanomaloussetpoint it cannotberecoveredtoastablestateevenbyupdatingtheacceleration setpoint e.g.
ay 0m s2 and safety is no longer guaranteed at this point.
tb3 legitimate linear velocity command being silently ignored bugs .
thedocumented maximum linearvelocity oftb3is0.22m s. when we publish a linear velocity control command veldesiredx .
the ros node reads the command and writes it to the control table of the firmware.
on the firmware side thisvalueisconstrainedbytheinternallogicthatcomputes the maximum linear velocity with respect to the motor power as velmax x wheel radius 2 motor rpm .
2 .
then the motor driver translates the constrained linear velocity to the wheel velocity and commands the motor if the velocity does not exceed the hardcoded limit .
the translation is done by the following equation velgoal x wheel radius rpm wheel velgoal .
.
.
wheel velgoal .
pluggingthe goalvelocityin we getthe desiredwheel velocity wheel velgoal velgoal x .
.
.
.
456robofuzz fuzzing roboticsystems overrobot operating system ros forfinding correctness bugs esec fse november14 18 singapore singapore as the final wheel velocity .
does not exceed the limit thiscommandisacceptedandsenttotheactualmotor.however the documented velocity limit of the motor is and the motor silently fails to execute the commanded velocity.
as a result users end up sending a legitimate command that is accepted by the firmware but cannotmake the robot move.
turtlesim typeconfusioninnormalizeanglefunction bug .turtlesim s controller receives desired angular and linear velocities as commands and simulates the motion and position of a turtleevery dt 16ms.the orientationangle isupdatedby new normalizeangle current ang vel dt here normalizeanglenormalizestheorientationangleto so that the posture can be visualized in the simulation.
unfortunately thereturntypeismistakenlyassignedas float whichmakes theorientationnanifthecommandedangularvelocityissufficiently large.asaresult theturtle spositionbecomesphysicallyinfeasible.
rclpy concurrency issue due to missing null check bug .when writing a user space api for creating a publisher it is recommended by the rcldocumentation to get the rmw handle from the publisher using rcl publisher get rmw handle each time it is needed to avoid potential concurrency issues with the functionsthatcanchangethermwhandlepointer.
rclcppdoesthis at the end of its create publisher function.
however the same checkismissingin rclpy create publisher ofrclpyimplementation resulting in a null pointer dereference error when the rmw handle pointer isconcurrently invalidatedbyotherfunctions.
discussion and futurework addressingphysical simulationdiscrepancy.
anumberofuncertainfactorsinthephysicalenvironmentcouldhinder robofuzz fromreliablyobtaining consistentexecutiondata.tothisend we made the following design decisions to minimize the disruption by physical simulation discrepancies.
first we designed simulation mapsasidenticalaspossibletotheactualtestsites.forexample infigure the dimensions and locations of the static objects were reflectedinthesimulationmapasaccuratelyaspossible.second we designed state discrepancy oracles to check for reasonably obviousdeviations e.g.
the difference of the final velocities rather than their trends so that trivial noises can be filtered.
last but not least we ran tests only on clear windless days to minimize the influence ofweather onthe robot.
limitation.
withrobofuzz we attempt to excite the faults in robotic systems by injecting valid i.e.
correctly formatted messages on the ros level.
such positive testing is useful for revealing variousissuesthat can occurduringnormal operations including thecorrectness bugswe addressedinthis paper.however froma holistic point of view the security and robustness of robotic systemscanstillbethreatenedfromdifferentvectors.forexample the underlyingcommunicationprotocol e.g.
dds mightbeflawed allowing malformed messages to be transmitted and crash the entire system or breaking the integrity of messages causing unexpected hard to debug errors.
furthermore various physical attacks can be launched directly to robots.
in our future work we plan to develop testingmethodologiesforthelayerssurroundingrostocoversuch attackvectors andrendersafer ecosystem for robotic systems.
related work testing ros.
most existing work on ros focuses on securing the rosnetwork.dieber etal.
andthesrosproject analyzed potentialnetwork basedattackvectorsandproposeda tls based securechannelforinter nodecommunications.rospento isa penetrationtestingsuitetoanalyzerosnetworks andmcclean et al.
demonstrated a honeypot.
robofuzz instead takes an orthogonalapproachandfocusesontheinternalfailuresthatbreak theassumptionsandthreatentherobustnessofros basedsystems.
fuzzing for cyber physical systems.
rvfuzzer and pgfuzz targetparametererrorsandpolicyviolationsinspecificdronecontrollers.
robofuzz complementstheseapproachesby serving as a generic framework that seamlessly integrates with any ros based robotic system and a highly extensible frameworkwithwhichvariousdeveloperassumptionsandspecifications canbe modeled and tested through feedback guided mutation.
as aresult robofuzz detectsnotonlythe px4bugsfoundby pgfuzz but alsomore bugsfrom px4andotherrobotic systems.
cpfuzz demonstrates the applicability of afl based coverage guided greybox fuzzing to the controller programs of cyber physicalsystems e.g.
aheatersystem toidentifysafetyviolations.testingvarioussmall 100loc benchmarkcontrollers theapproachsuccessfullydetectsspecificationviolations.however as shown in 5. the effectiveness of code coverage guidance is dampenedinlargercodebases.
robofuzz countersthisproblemby accommodating semantics based feedback and successfully identifiescorrectness bugsfrom large robotic systems.
feedback driven fuzz testing.
a number of feedback driven fuzzing approaches are proven to be effective in finding bugs in user spaceapplications andkernels .unfortunately existing fuzzing approaches primarily focus on finding memorysafetyissues andthuscannotbeappliedtofindingcorrectnessbugs inroboticsystems.
robofuzz bringstheconceptoffeedback driven fuzzingintothe robotics domain enabling effective testing.
conclusion thispaperpresents robofuzz asemanticfeedback drivenfuzzer tailored for finding correctness bugs prevalent in ros and rosbasedroboticsystems.byinjectingmutatedmessagestotherobots runninginboththerealworldandasimulatorandcheckingthe capturedroboticstatesagainstcarefullydesignedrobot specificcorrectnessoracles robofuzz goesbeyondmemory safetybugsand detects subtle correctness bugs including the violation of physical laws violation of specifications and cyber physical discrepancies.
thisprocessisfurtherexpeditedbyincorporatingsemanticfeedbackasguidance whichquantifiesthebugginessfromtheexecution context.
as a result robofuzz has detected new correctness bugsinros andros basedapplications.
acknowledgment wethanktheanonymousreviewersfortheirinsightfulfeedback.
this research is funded by the secure systems research center ssrc atthetechnologyinnovationinstitute tii uae.weare gratefultodr.shreekant ticky thakkarandhisteammembers at the ssrcfor theirvaluable comments andsupport.
457esec fse november14 18 singapore singapore seulbae kim andtaesoo kim