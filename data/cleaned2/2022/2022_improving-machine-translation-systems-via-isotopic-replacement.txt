improving machine translation systems via isotopic replacement zeyu sun key laboratory of high confidence software technologies moe school of computer science peking university szy pku.edu.cnjie m. zhang university college london jie.zhang ucl.ac.ukyingfei xiong key laboratory of high confidence software technologies moe school of computer science peking university xiongyf pku.edu.cn mark harman meta platforms and university college london mark.harman ucl.ac.ukmike papadakis university of luxembourg michail.papadakis uni.lulu zhang key laboratory of high confidence software technologies moe school of computer science peking university zhanglucs pku.edu.cn abstract machinetranslationplaysanessentialroleinpeople sdailyinternational communication.
however machine translation systems are farfromperfect.
to tacklethisproblem researchershaveproposed several approaches to testing machine translation.
a promising trendamongtheseapproachesistousewordreplacement where only one word in the original sentence is replaced with another wordtoformasentencepair.however precisecontroloftheimpact of word replacement remains an outstanding issue in these approaches.
toaddressthisissue weproposecat anovelword replacementbasedapproach whosebasic ideaistoidentifywordreplacement with controlled impact referred to as isotopic replacement .
to achieve this purpose we use a neural based language model to encodethesentencecontext anddesignaneural network based algorithmtoevaluatecontext awaresemanticsimilaritybetween twowords.
furthermore similar totransrepair a state of the art word replacement basedapproach catalsoprovidesautomatic fixing of revealed bugs without model retraining.
our evaluation on google translate and transformer indicates thatcatachievessignificantimprovementsovertransrepair.in particular cat detects seven more types of bugs than transrepair cat detects more translation bugs than transrepair cat repairs twice more bugs than transrepair many of which may bring serious consequences if left unfixed and cat has better efficiency than transrepair in input generation .01s v.s.
.41s and comparable efficiency with transrepair in bug repair .92s v.s.
.34s .
corresponding author.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
machinetranslation testingandrepair machinelearningtesting neural networks acm reference format zeyu sun jie m. zhang yingfei xiong mark harman mike papadakis andluzhang.
.improvingmachinetranslationsystemsviaisotopic replacement.in 44thinternationalconferenceonsoftwareengineering icse may pittsburgh pa usa.
acm new york ny usa pages.
introduction machine translation systems such as google translate translate a textfromasourcelanguageintoatargetlanguageautomatically.
they play an essential role in overcoming communication barriers acrosstheglobe providingtranslationservicestomillionsofend users everyday.
in2018 facebook reportedits deployment ofmachinetranslationsupportingapproximately2 000languagepairs servingapproximately4.5billiontranslatedpostimpressionsevery day therebyallowing600millionpeopletoreadtranslatedposts in their mother tongue .
by january of google translate has been reported to support languages with more than billion words translated per day .
poortranslationshavebeenknowntobeaseriousproblemfor a considerably long period of time.
for example mistranslations of article of the treaty of uccialli led to a war while mistranslation of the japanese government s response may have influenced american government s decision to use the atom bomb during worldwar ii .
theseproblems predate theadvent ofmachine translation butarearguablyexacerbatedbytheapparenteasewith which machines may now translate natural languages.
theprofoundconsequencesofmistranslationpriortoautomationareconcernedwithsituationswherethereisaclearimperative foraccuratetranslationandplentyofhumansareinvolvedinthe translation process.how muchmore perniciouscould such asituation become as we rely more and more on automated machinetranslation currently with translation processes that afford few checks and corrections?
ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa sun and zhang et al.
as we move to a scenario in which machines routinely translate natural language sentences the potential for misunderstandings maybecomemagnified.thismakesautomatedtranslationanimportantnewapplicationfortestingandevaluation.furthermore given that machine translation is typically used in scenarios where there is no human in the loop and thus no time to respond to failedtestcases itisalsohighlyimportantthatwehaveinplace techniques for automated repair.
machinetranslationsystemscurrentlyhavefarmorefrequent mistranslations than human translations causing problems in economics and safety becoming a source of international tension and alsopotentiallyviolatinghumanrights .theseissueshighlight the importance of automatic improvement of machine translations.
recently quiteafewapproaches e.g.
sit transrepair and pathinv have been proposed for testing machine translation systems.
in particular approaches based on word replacement whereonlyonewordintheoriginalsentenceisreplacedwithanother word have received intensive attention.
intuitively since onlyonewordintheoriginalsentenceischanged theprediction of the corresponding change on the translation is thus easier than the situation where multiple words in the original sentence are changed.however precisecontroloftheimpactofwordreplacement in word replacement based approaches is still difficult due to the fuzzy semantics of natural language words.
inthispaper weproposeanovelword replacement basedapproach namedcat1 tomachine translationtesting.
given asentence in the source language cat performs isotopic replacement which is a special type of word replacement to generate new sentences.
the goal of isotopic replacement is to control the impactof word replacement so that the translation of the sentence after wordreplacementshouldverylikelybesimilartothetranslation of the sentence before word replacement.
our insight is that thekey to control the impact of word replacement is to control thesemantic difference between the two words.
in a typical natural language the semantics of a word is comparatively stable but the semantics mayalso varyto someextent indifferent sentences .
therefore it is necessary to consider the impact of contexts on the semantics of words when performing isotopic replacement.
as a result we design an algorithm to calculate context aware semantic similarity between each pair of words.
our algorithm uses a neural architecture to encode the sentence context during replacement thereby making the replacement context aware.
on top of context encoding ouralgorithmfurtherperformsneural basedsemantic evaluationtoguaranteethatthesemanticdifferencebetweenthe words under replacement is small enough.
following transrepair our approach is also able to repair bugs revealed during testing.
weempiricallyevaluatedcattogetherwithtransrepairontwo state of the artmachinetranslationsystems googletranslate and transformer .
the translation is between the top two most widelyusedlanguages englishandchinese with2 001sentence pairs.
our experimental results show that cat significantly out performs transrepair in both effectiveness and efficiency catdetects seven more types of bugs than transrepair.
it detects morebugsandrepairs199 morebugsthantransrepairongoogletranslate transformer respectively.overhalf 1context aware replacement for improving machine translation.of the detected mistranslations can be automatically fixed by cat.
furthermore cathasbetterefficiencythantransrepairininput sentence generation .01s v.s.
.41s costs and competitive efficiency with transrepair in repairing .92s v.s.
.34s .
tosummarise thispapermakesthefollowingcontributions a novel approach named cat to improving machine translation based on isotopic replacement where the key technique is a novel algorithmforcalculatingcontext awaresemanticsimilaritytoidentify isotopic replacement.
an extensive evaluation to demonstrate theeffectivenessandefficiencyofcat indicatingthatcatsignificantly outperforms the state of the art approaches.
theimplementationcode thedataweused togetherwiththe fullexperimentalresultsofthispaperareavailableat com zysszy cat.
related work we divide the related work of our paper into two parts machine translation testing in section .
and machine translation repair in section .
.
.
machine translation testing therearedifferentpropertiestotestinmachinetranslationtesting.
heigold et al.
belinkov and bisk and zhao et al.
focusedontestingrobustness i.e.
whethermachinetranslatorsare influenced by minor errors typos or noises in the input sentences.
more approaches focus on testing the correctness of machine translators.themajordifferenceslieintheheuristicsadoptedin these approaches.
pesuetal.
proposedanapproachbasedoncross reference.
in particular this approach focuses on checking whether the direct translation fromasourcelanguagetoatargetlanguage andthe indirecttranslation fromthesourcelanguagetoanintermediate language and then from the intermediate language to the targetlanguage of the same sentence produce the same results.
cao etal.
proposed a similar approach where they check whether thetranslationbetweendifferenttranslationsystemsproducethe similar translation results.
themainstreamapproachestestcorrectnessviathecombination ofinputmutationandmetamorphicrelation .theyadoptthe strategyofcontrolledinputgenerationofnewsentencesorphrases in the source language.
given a sentence in the source language such an approach generates a related sentence or phrase then theoriginal sentence and the generated sentence phrase are fed into thetranslatorundertest andtheapproachcomparesthetranslationresultsofthetwotodeterminewhetherabugisfound.inparticular purity breaks the original sentence into phrases and checks whethersome phrasesalone havedifferent translationscompared with their translations for the original sentence.
except for purity other approaches based on controlled input generationadoptwordreplacement.thatistosay theseapproaches generate a new sentence via replacing one word in the original sentencewithanotherrelatedword.guptaetal.
detectatranslation bug by replacing a word with another word with completely different meaning and expect that the word replacement shouldyield different translations.
sun and zhou replace a human authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving machine translation systems via isotopic replacementicse may pittsburgh pa usa figure overview of cat.
namebefore like or hate withanotherhumanname.theyexpect that the translations of the sentences before and after word replacementshouldbesimilar.heetal.
replaceonewordin the original sentence with another word that would also fit intothe structure of the original sentence and expect that the twotranslations of the original sentence and the generated sentenceshould also have a similar structure.
in particular this approach namedsit adoptsthemaskedlanguagemodel mlm todetermine which words are likely to fit into the structure of the original sentence.notethatthewordreplacementinsitisprimarilysyntacticalwithoutexplicitconsiderationofsemantics.furthermore sincemlmconsidersthecontextoftheoriginalsentencewhengenerating the replacement many syntactically suitable replacements are excluded.
for example when facing make it a requirement that only half is to be used in polling stations except in wales .
sit generates a sentence by replacing half with english .
the approach named transrepair to machine translation testing proposed in sun et al.
replaces a word with another semantically similar word e.g.
girls boys and expect the generated sentence may lead to a similar translation with the original translation for the unchanged part in thesentence.
in particular transrepair adopts vectorrepresentationofwords tocalculatethesimilarity ofeach pairofwords.sincethe vectorrepresentation ofeachword is calculated on the basis of all sentences containing the word in a corpus thesimilarityvaluesbetweenwordsusedintransrepair do not consider the specific context of the original sentence.
ourapproach namedcat tomachinetranslationtestinggenerally falls into the category of word replacement based approaches.
similar to sit and transrepair our approach also expectsthatthechangeofonewordwouldnotresultinsubstantial differenceinthetranslations.however ourapproachisbasedon the concept of isotopic replacement where one word is replaced with only words that differ subtly from the original word.
then weproposeaspeciallydesignedalgorithmtodeterminewhether awordreplacementisanisotopicreplacement.inparticular our algorithmisbasedoncalculatingcontext awaresemanticsimilarity for which to our knowledge no straightforward combinationof mlm and vector representation of words are able to achieveour purpose.
another distinct merit of our approach is that isotopicreplacementisapplicabletoallpartsofspeech whileexisting word replacement based approaches are specific to only few parts ofspeech.forexample wordreplacementinsitisspecifictonouns and adjectives and word replacement in transrepair is specific to nouns adjectives and numbers.therehavebeenwordreplacementresearchforothertasks such as attacking testing defending models on different classification tasks .therequirementoftheirwordreplacement is to keep the classification result unchanged.
as a result the replacementmayleadtogrammarerrors havecompletelydifferent context or affect the translation of the unchanged part in a sentence thereby not being applicable for machine translation testing.
forcat weusetheisotopicreplacementandthebasicideaisto identifywordreplacementwithcontrolledimpacttothetranslation of the whole sentence.
.
machine translation repair torepairtherevealedbugsandimprovemachinetranslation existing approaches are typically based on data augmentation.
heigold etal.
sperberetal.
andbelinkovandbisk proposed to add the generated sentences noises used for robustness testing to the training data and retrain the model.
cheng et al.
and ebrahimi et al.
used the gradient based approach to generating sentences for model retraining.
different from these approaches therearealsosomeapproachesimprovingrobustnessofmachine translationbydesigningsomeadditionalneuralcomponents.cheng et al.
added a component to distinguish the noises from the training set while belinkov and bisk used a character level representation.
theaboveapproachesneedmodelretraining.toourknowledge theonlyapproachthatisabletorepairmachinetranslationwithout model retraining is transrepair by sun et al.
.
in particular transrepair adopts a post processing based strategy for repair.
for a bug revealing sentence transrepair generates several similarsentences via the same word replacement strategy in its testing phase andthencombinesthetranslationsofthesesimilarsentencesandtheoriginalsentencetorepairthebug.ourcatadoptsasimilar strategy withtransrepair forrepair butthe generationof similar sentencesfor repairin cat isalso basedon isotopicreplacement.
accordingtoourevaluationresults therepaireffectivenessofcat significantly outperforms that of transrepair.
approach .
overview ourapproach namedcat followsthegeneralprocessofwordreplacement based approaches given an input sentence sand a wordwins ourapproachidentifiesasetofwords denotedas ww eachofwhichcanbeusedtoreplace wins.foreachword wf ww authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa sun and zhang et al.
figure bert based context aware word replacement.
our approach further ensures thatthe replacement of wwithwf insisisotopicreplacement whichonlysubtlyimpacts s.thekey idea to realise isotopic replacement is to evaluate context aware semantic similarity between wand each candidate replacement wordwr cwin the context of s. figure depicts an overview of cat.
there are two stages in cat for conducting isotopic replacement.
in the first stage cat generates a set of word replacement candidates cwfor each word wintheinputsentence s.inthesecondstage catidentifiesthe final set of words wwfrom word candidates cwto achieve isotopicreplacementviaevaluatingcontext awaresemanticsimilarity between each word in wr cwand the word win sentence s. this section mainly introduces these two parts candidate word generationinsection3.2andsemanticevaluationinsection3.
.
the remaining steps of translation testing and repair are similar to the corresponding steps in transrepair.
to make our presen tation self contained we provide some necessary information in section .
for convenience.
.
candidate word generation inordertorealiseisotopicreplacement wefirstgenerateasetof candidatewords cwforeachword wintheinputoriginalsentence s whereww cw basedon thecontextforfurther evaluationof context aware semantic similarity.
given an input sentence s cat generates such candidate words cwbyensuringthateachwordin cwisalsosuitableforthecontext.
torealiseouridea weusethebidirectionalencoderrepresentationsfromtransformers bert toencodethesentencecontext and check which words are suitable for the context.
figure2showstheoverviewofcontext awarewordreplacement incat.asatransformer basedpre trainedmodel berttakes aninputsentenceandoutputsareal valued vectorforeachword withinthesentencebasedonthecontext.whenperformingaword replacement a word to be replaced in the input sentence is first masked by a special mark .
for example in figure the word within ismaskedfortheinputsentence withinthepast decades... .thesentencewiththemaskedwordisthenfedtothe bertmodel whichextractsasetofreal valuedvectors.toconduct word replacement bert feeds the vector of the word to apre trainedlinearclassifierandgetsasetofpredictedwordswith different prediction probability.givenaninputsentence swithawordsequence w1 w2 wn wherenisthetotalnumberofwords wemaskthewordsinthe sentence in turn one word being masked each time and feed each masked sentence into bert.
theoutputsofbertareasetofvectors h1 h2 hn which denotesthecontext awarevectorrepresentationoftheinputwords.
then a pre trained linear classifier takes the vector of the masked word hmaskasaninput andoutputsasetofinitialcandidatewords ci.
each word in cihas a predictive probability.
the sum of the probabilitiesofallthecandidatewordsis1.
.wethenuseaprobability filter to discard the words with low predictive probability we set the threshold as .
to remove the words that are most unlikely to be qualified .
in addition if the word is the same as the originalwordwemasked wediscardthisword.finally wetreatthe remaining words as word candidates cwmaskfor the masked wordwmask each of which can be used to fill the masked word in the original input sentence for replacement.
notethat theaboveprocedureforwordgenerationiscontextaware becausebertpredictsthemaskedwordbasedonexactly the remaining parts of the sentence.
.
semantic evaluation isotopicreplacementaimstoidentifyasetofwords wwforeach wordwin input sentence ssuch that each word in wwonly subtly differsfrom winthecontextof s.incandidatewordgeneration we generateasetofcandidatewords cwfortheword wins.however there are occasions that bert predicts a masked word that has similarcontextwiththeoriginalword butwithdifferentmeanings.
therefore we next compute the context aware semantic similarity and use it to discard the inappropriate words in cwfor identifying the final word set ww.
to achieve our purpose we propose a novel neural based mechanism for the evaluation of context aware semantic similarity.
the key step to compute the context aware semantic similarity in cat is to measure the wordvector similarity between the originalword anditsreplacedword.inourapproach weagainuseberttoget the output word vectors which is the most widely used word2vec approach in natural language processing .
unlike the usage of bert in candidate word generation in the previous section we do not feed bert with a masked sentence but directly take the wholetokenisedsentenceasitsinput.inthismanner bertfirst representsawordasavectortrainedfromthetrainingcorpus.the vector indicates the semantics of this single word.
bert further considersthesentencecontextandcomputesacontext awaresemantic representation.
in this way we get a series of word vectors for each word in each sentence as the final word vectors.
then we measure the context aware semantic similarity between the word wins denoted by ha and the candidate word wr cwinsr which is generated via replacing winswithwr denotedby hb byusingthecosinesimilarity cossimoftheirword vectors cossim ha hb hahb ha hb .
the overall process of our semantic evaluation is detailed by algorithm .
foran input sentence s aw o r dwins and theset of the candidatewords cwgenerated viacandidate wordgeneration we aim at getting a final word set ww.
we first define an empty set authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving machine translation systems via isotopic replacementicse may pittsburgh pa usa wwfor collecting the words after evaluation line .
for the word wins we further extract its word vector havia bert lines .
next foreachcandidateword wr cw weuseittoreplace win sandgenerateamutantsentence sr lines3and4 .fortheword wrinsr we extract its word vector hb line .
then to capture the context aware semantic similarity of the above two words we compute the introduced cosine similarity cossimof their word vectors haandhb line .
if the similarity is above the predefined threshold sthreshold we set the threshold to be .
it passes the evaluation line .
thus we add the word wrto the set wwas afinalgeneratedone line8 .afterwehaveevaluatedallwords automatically weoutputthefinalwordset wwforwordwins line .
this process ensures that the replacement of wwithwf ww insis isotopic.
finally weinturnusetheword wf wwtoreplacetheword winsand repeat this process for each word in sto generate a final set of sentences mf.
we refer to each of these finally generated sentences as a mutant .
this generated set of mutants is further used for automatic testing each mutant is paired with the original sentence as one test input pair and repair.
algorithm process of semantic evaluation data s theinputsentence wthewordintheinputsentence s cw the set of the candidate words for the word w the output of the candidate word generation result ww the final set of words each of which can be used to replacewins 1ww 2ha bert s w 3foreach candidate word wr cwdo 4sr replace s w w r hb bert sr wr 6similarity cossim ha hb 7ifsimilarity sthreshold then ww ww wr 9end 10end 11returnww .
testing and repair the process of test oraclegeneration and black grey box repair in cat is the same as transrepair.
we briefly introduce the details in this section.
.
.
test oracle generation.
foreachtestinput s m wherem mf letr s andr m bethetranslationresultsofinputsentences sand its mutant m. mutant mis generated by replacing a word w1inswith another word w2.
cat generates the test oracle by computing the similarity between r s andr m excluding the translationchangescausedby w1andw2.toremovethecontext changes we computes the similarity of the subsequences of r s andr m andfurtherselectsthelargestsimilaritytoapproximate the similarity of r s andr m .
when the similarity is below the predefined threshold cat reports an inconsistency bug.
.
.
black grey box repair.
black box and grey box repair transformthe originaltranslation basedon thebesttranslation among thetranslationsformutants.therearetwowaysofchoosingthe best translation one using predictive probability grey box the other using cross reference black box .
in detail cat first repairs the translation of the original sentences in a bug revealing test case and then it seeks to find a translation for the mutant which passes the consistency test.
for the original sentence cat generates a set of mutants and gets their translations.
it further ranks these translations based on thepredictive probability ofthe machinetranslation orcrossreference in decreasing order.
cat maps back the translation with thehighestrankingtothetranslationoforiginalsentenceviaword alignment .
if the mapping back fails it selects the translation with a lower ranking.
forthemutant catusesthesamerepairprocessastheoriginal sentence but marks the output as a candidate solution.
we then checks whether the candidate solution passes the testing with the repaired translation of the original sentence as test input.
if not cat proceeds by checking other candidate solutions.
experimental setup inthissection weintroducetheprocedurewefollowtoevaluate cat.
.
research questions to evaluate cat we begin by investigating the extent to which isotopicreplacementbringsvalueintesting i.e.
helpstheconstruction of test cases.
thus we ask rq1 how effective is cat in generating test inputs?
to answer this question we consider the quantity distribution validity and diversity of the test inputs generated with isotopic replacement.
to ensure validity we conduct a manual check on whether the replaced word in the mutant leads to grammatical errors whether the semantic meaning of the mutant sentence is reasonable andwhetherthemutantoughttohaveconsistenttranslations with the original sentence.
by showing that cat helps designing test inputs we then turn our attention to the actual value of interest bug detection and bug repair.
we first focus on bug detection and ask rq2 how effective is cat in bug detection?
here wefocusonthebug revealingabilityofcat.tothisend we test google translate gt and transformer with the test inputsgenerated in rq1 to investigate the number of inconsistency bugs reported by automated test oracles the diversity of the detected inconsistency bugs the precision recall and f measure of bug detection based on manual inspection.
having presented the bug revealing ability of cat we turn our attention to its repairing ability.
hence we ask rq3 how effective is cat in bug repair?
toanswerthisquestion foreachreportedbugongoogletranslate gt and transformer we use cat to repair the bug automatically withbothblack boxandgrey boxrepair .wethusfollowthesame procedureasinrq2andinvestigate therepaireffectivenessmeasuredbyautomatedtestoracles thediversityofrepairedbugs and the validity of reported fixes based on manual inspection.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa sun and zhang et al.
uptothispoint inouranalysis weonlyinvestigatedtestand repair effectiveness.
however this analysis tells nothing about the time required to conduct the testing and repair tasks.
therefore we ask rq4 what is the efficiency of cat?
toanswerthisquestion werepeattheexperimentsofcatinrq13andrecordthetimecost.then weinvestigate thetimecost ofisotopicreplacement thetimecostofbugdetectionforeach sentence the time cost of repairing a bug.
since cat follows transrepair for improving machine translation for eachresearch question we set transrepair a sa baseline and report the improvement of cat over transrepair underidenticalconfiguration.
thecomparisonwithother testing approaches can be referred to the extended analysis in section .
.
.
machine translators thesameastransrepair weconsiderthefollowingtwostate ofthe artmachinetranslators transformer themostwidely studied machine translation system by the research community googletranslate themostwidelyusedend to endmachine translation system developed by google.
transformer transformerisanattention basedsequence to sequence model designed fornatural languageprocessing tasks.
ithave been shown to be effective in various areas including machine translation question answering and others .
in this paper weusedidenticalparameterstransformermodelusedin 2to achieve a fair comparison.google translate google translate is a neural machine translation system developed by google.
we select google translatedue to it being a mainstream translation system which has over million total users with more than billion words translated daily .
.
implementation settings the implementation of cat is based on the standard bert that is publiclyavailable .thebertmodelcontains24 layers hidden size heads.
the model was trained on tpu chips for one million steps with a batch size of .
for transrepair we implement it with the same setting according to the paper .
to perform a fair comparison we follow the setting of the previous approach and generate at most valid mutants for each input sentence during testing and at most valid mutants for eachsentence in a each buggy test case during repair.
we perform an additionalexperimentinsection6.2tostudytheinfluenceofthis mutant number upper bound.
we conduct experiments on ubuntu .
with 256gb ram andfourintele5 2620v4cpus.theneuralnetworks bertand transformer are all trained and inference on nvidia titan rtxs.
.
dataset foreaseofcomparison weusethesamedatasetastransrepair the news commentary dataset .
this dataset has been adopted as a standard benchmark for translator evaluation .
it contains 2we use the same hyper parameters random seeds deep learning library and trained the model for the same epochs.
parallel sentences that are different from the training set and validation set used for transformer training.
results inthissection weintroducetheresultsofourexperimenttoanswer the research questions.
.
effectiveness of test generation rq1 toanswerthisquestion foreachtestsentenceinourdataset alltogether wegeneratemutantswithcatandtransrepair.each mutant is paired with the original sentence to form a test input.
wethenrecordthequantity i.e.
totalnumberoftestinputs distribution i.e.
the number of generated test inputs per sentence validity i.e.
whetherthemutantandtheoriginalsentenceinatest inputshouldyieldconsistenttranslationsforbugdetection and diversity i.e.
the types of generated mutants .quantity forthe2 001inputsentences 045candidatewords are generated by isotopic replacement and are further discardedbycandidatefiltering usingautomaticsemanticevaluation .intotal catgenerates9 942mutantsthatcouldbepairedwiththe originalsentencesastestinputsfortranslationtesting.fortransrepair itgenerates21 960mutantcandidatesbywordreplacement with17 268discardedbycandidatefiltering usingstandfordparser .
it finally yields test inputs.
theseresultsshowthatcatgeneratessignificantlymoretest inputs than transrepair.
in particular cat s isotopic replacement increases candidates possibility of passing semantic evaluation.
for cat of the mutant candidates pass the filtering for transrepair only mutant candidates pass the filtering due to its ignoranceofthecontextinformationoftheoriginalinputsentences.
inthefollowing wedigdeepintothedistribution diversity and validity of the generated mutants.
distribution we use violin graphs to demonstrate the entire distributionoftestinputsgeneratedforeachsentence.figure3showstheresults.inthisfigure weobservethatthenumberoftestinputs generated by cat reaches the upper bound more details in section .
for most of the input sentences.
however for transrepair many sentences have fewer than test inputs.
in particular the isotopic replacement enables cat to generate test inputs for almost all the sentences with only three sentences i.e.
.
having no generated test inputs .
however for tran srepair it fails to generate test inputs for as many as .
of the sentences.
consequently transrepair is not able to detect any translation bugs for those sentences.diversity we further compare cat and transrepair from the aspectofmutantdiversity i.e.
thetypeofgeneratedmutantsinterms ofpart of speechofthereplacedw ord.thepart of speechtypes include noun adj.
adjective adv.
adverb num.
numeral verb deter.
determiner conj.
conjunction pron.
pronoun prep.
preposition and others.
figure4showsthenumberofmutantsbelongingtoeachtype.
overall we observe that most mutants transrepair generated are for nouns adjectives and numerals as mentioned in section .
by contrast cat generates mutants for seven more types of part of speech.thisdemonstrateddiversityisimportantbecause authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving machine translation systems via isotopic replacementicse may pittsburgh pa usa cat transrepairnumber of mutants per sentence figure3 distributionofthegeneratedmutantsforeachsentence.
cat generates test inputs the upper bound for al mostalltheinputsentences whiletransrepairfailstogen erate any test inputs for .
of the sentences.
different types of test inputs reveal different types of inconsis tency bugs.
for example transrepair will miss the detection of inconsistency bugs aroused by verbs which plays a key role in the understanding of the sentence translation.
noun verb prep.
num.
adj.
deter.
adv.
pron.
conj.
othersnumber of test inputscat transrepair figure number of generated test inputs y axis per mutant type x axis .
this figure shows that cat generates more diverse mutants than transrepair.
validity thevaliditymeasurestheproportionofthegeneratedtest inputsentencesthatarequalifiedfortranslationtesting.thefirst two authors manually check the validity separately.
if a generated mutantis1 grammaticallycorrect semanticallyreasonable and ought to yield semantic identical translation with the original sentence excluding the replaced word we deem the test input to be valid.
we randomly sample test cases for each approach.
ourmanualinspection3indicatesthat96.
ofthetestinputs generatedbycatarevalid.invalidmutantexamplesare1 greater protection priority should be given to whistleblowers sir eric says the supplement suppression of public sports facilities .
for transrepair .
ofitstestinputsarevalid.theseresultsshow thatcatnotonlygeneratesmoretestinputs butalsogenerates more qualified test inputs for inconsistency bug detection.
3thecohen skappais0.96onaverage whichindicatesthatourmanualinspection results are highly consistent.rememberthatweusesemanticevaluationtofilterwordcandidatestoimprovemutantvalidity.thus weareinterestedtoinvestigate the effectiveness of semantic evaluation.
it turns out that withoutsemanticevaluation .
ofthetestinputsareinvalid4.
with semantic evaluation this proportion is reduced to .
.
thus semantic evaluationremoves .
invalid test inputs.
we further investigate the validity of test inputs on different typesofmutants.table1showstheresults.ineachcell thefirst second number is for the valid total number of inputs belonging to the corresponding type.
the ratio in brackets is the proportion of valid inputs.
interestingly we observe that the adj.
mutant type has thelowestvalidityforbothcatandtransrepair.thisobservation shows possibilities for further validity improvement for test input generation in machine translation testing.
overall for rq1 we have the following conclusion answer to rq1 cat outperforms transrepair in the quantity distribution diversity and validity of the generatedtestinputs.inparticular catgenerates 942test inputs covering .
of the input sentences and 10types of mutants with a validity score of .
based on manualinspection.fortransrepair thesenumbersare4 .
and .
respectively.
.
effectiveness of bug detection rq2 to answer rq2 for each test input generated by cat or transrepair wefeeditintogoogletranslateandtransformertoget itstranslations thenapplythesimilaritymetricstoautomatically decide the test input reveals a bug.
table2showsthenumberofbugsreportedbycatandtransrepairwitheachsimilaritymetric.weobservethatcatsignificantly outperforms transrepair in the number of reported bugs.
on average catdetects129 morebugsthantransrepaironbothgoogle translate and transformer.
we further investigate the diversity of the reported bugs.
the results are shown in figure where we select the reported bugs onthelcssimilaritymetricasanexample.weobservethatcat reports diverse bugs aroused by types of part of speeches.
transrepaircanonlydetectthebugsfornouns adjectives andnumerals but could hardly detect bugs aroused by the words in other part ofspeeches.
the overall results are as expected because as shown by rq1 cat generates a larger quantity of more diverse and more widely distributed mutants than transrepair which contributes to its overall bug detection ability.
usingthesimilaritymetricasanapproximationoftestoracles asmentionedbysunetal.
mayhavedifferencewithhuman oracles i.e.
human judgement about whether the translations are consistent .
to investigate such a threat sun et al.
sampled sentencesandconductedmanualinspectiontogettheperformance of oracle approximation.
in this paper following their work we 4the cohen s kappa is .
.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa sun and zhang et al.
table validity of test inputs on different typesofmutantsbasedo npart of speec h rq1 .
method noun adj.
adv.
num.
verb deter.
conj.
pron.
prep.
others transrepair .
.
.
.
.
.
.
cat table number of reported bugs rq2 .
metric transrepair cat gtlcs ed tfidf bleu transformerlcs ed tfidf bleu noun verb prep.
num.
adj.
deter.
adv.
pron.
conj othersnumber of detected bugscat gt cat transformer transrepair gt transrepair transformer figure number of reported bugs y axis per mutant type x axis .
this figure shows that cat reports more diverse bugs than transrepair.
uniformly sampled5100 test inputs for each approach.
for each sampled test input and its translation results the first two authors manuallycheckwhetherthetestinputandtheirtranslationsreveal inconsistency bugs6 then compare the human judgement with the judgement ofsimilarity metrics.
thepurpose isto check whether usingthe similaritymetrictoreport bugsisa threattothe superiority of cat over transrepair shown by table .
we present the precision recall and f1 score of the manual inspectionresults.whencalculatingthesemetrics falsepositive fp means that the similarity metric judges the translations as inconsistent buggy but manual inspection judges them as consistent non buggy falsenegative fn meansthatthesimilarity metricjudgesthetranslationsasconsistent non buggy butmanual inspection says they are inconsistent buggy .
the results show that for cat similarity metric has a precision of .
a recall of .
and an f1 score of .
on average.
for transrepair similarityhasaprecisionof0.
arecallof0.
andan f1 score of .
on average.
these results indicate that the validity of the bugs reported by cat is similar to that by transrepair.
transrepair has slightly better recall than cat.
this is because 5wesamplethetestcasethat revealsabugand thetestcasethatfail torevealabug with equal probability.
6the cohen s kappa is .
on average.manymutantstransrepairgeneratedarevianumeralsreplacement asshownbyfigure4 whichinfluencethetranslationconsistency less than other mutant types.
overall ourmanualinspectiondemonstratesthatthevalidityof the bugs reported by cat is similar to those reported by transrepair.
thus using the similarity metric to report bugs is not a threat to the superiority of cat over transrepair shown by table .
answer to rq2 cat detects seven more types of bugs thantransrepairindiversity aswellas morebugs than transrepair in quantity.
.
effectiveness of bug repair rq3 foreaseofcomparison weletcatandtransrepairfixthesame setofdetectedbugs i.e.
thebugsdetectedbycat.foreachbug we let cat and transrepair generate at most mutants the mutantnumber upper boundforrepair introducedinsection4.
on both the original sentence and the mutant in the test case to conductautomatictranslationrepair.fortransformer weusecrossreference to conduct black box repair and predictive probability to conduct grey box repair.
the predictive probability of google translate is inaccessible we thus only conduct black box repair.
to answer rq3 we first present the number of repaired bugs accessed by similarity metrics.
then we present the diversity ofrepair bugs aroused by the words in different part of speeches.
finally wepresentthetranslationimprovementaccessedbymanual inspection.repair effectiveness accessed by similarity metrics.
the resultsareshownintable3.eachcellpresentsthenumberofrepaired bugsbasedonthesimilaritymetrics aswellastheproportionof repaired bugs against the total number of bugs detected by cat .
theupperrowsareforgoogletranslate gt thebottomrowsare for transformer.
we observe that cat repairs much more bugs than transrepair.
forexample forgoogletranslatewiththelcssimilaritymetric catrepairs53 ofthereportedbugs whiletransrepaironlyrepairs .
on average cat repairs more bugs than transrepair ongoogletranslate transformerwithblack box repair using cross reference and more bugs than transrepair on transformer with grey box repair using probability .diversity of repairedbugs.
we furtherinvestigate theeffectivenessofcatindifferenttypesofrepairedbugsdetectedbythewordreplacementindifferentpart of speeches.sincedifferenttypeshave different numbers of reported bugs we focus on the proportion of repaired bugs against the number of reported bugs for each type.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving machine translation systems via isotopic replacementicse may pittsburgh pa usa table number and proportion of repaired bugs rq3 .
approach metric probability cross reference transrepair gt lcs ed tfidf bleu cat gt lcs ed tfidf bleu transrepair transformer lcs ed tfidf bleu cat transformer lcs ed tfidf bleu noun verb prep.
num.
adj.
deter.
adv.
pron.
conj.
othersproportion of repaired bugs cat gt cat transformer transrepair gt transrepair transformer figure6 proportionofrepairedbugsagainstthenumberof reported bugs y axis per bug type x axis .
theresultsareshowninfigure67.weobservethatcatachieves alarger proportionof repaired bugsthantransrepairamong all bugtypes.furthermore wefindthatcatrepairs42 ofbugsontransformer googletranslateamongallbugtypes.
transrepair repairs of bugs among numerals but only of bugs among other bug types on transformer google translate.
transrepair generates mutants for nouns adjectives and numerals but it can still repair bugs in other types.
this isbecausethesemanticsoftheunchangedpartyieldedbydifferent types of replacement could be the same.
validity of repaired translations.
the first two authors manually check the bug fixes on the lcs similarity metric with crossreference on transformer.
the purpose is to check whether a bug fixbased onthesimilarity metricindeedimproves thetranslation consistency.
although cat aims to repair translation inconsistency it has a bonus benefit of improving translation acceptability which captures the property that a translation meets human assessment of a reasonable akaacceptable translation.thus themanualinspectionconsiderstwoaspects theconsistencyoftranslationsbeforeand after repair the acceptability of the translations for the original sentence as well as the mutants before and after repair.
for 7we present the proportion of bugs repaired by cross reference on the lcs similarity metric as an exampleeachdimension wesetupthreelabels improved unchanged and decreased .
we randomly sampled reported fixes.
foracceptability it checks the translation improvement of both the original sentence and the mutant thus all together inspections are conducted.
table manual inspection results on reported fixes rq3 aspect improved unchanged decreased transrepairconsistency acceptability catconsistency acceptability table shows the results8.
from this table for consistency improvement cat successfully improves the consistency for fixes the remaining fixes have unchanged consistency.
whereasfortransrepair itimprovestheconsistencyfor87 fixes fixeshaveanunchangedconsistency casehas a dropped consistency.
for the improvement in translation acceptability cat improves the translation acceptability for .
sentences with .
sentences acceptability being dropped duetopossibletrade offbetweenqualityandconsistencyaswell as the incorrect alignment from the word alignment tool during repair .transrepairimprovesacceptabilityforthesamenumber of sentences but leads to decreased acceptability for .
cases.
table shows some examples of translations that could be repaired by onlycat transrepair could repair none of them .
in this table the first column is the input sentence.
the second column is the chinese translation of the input as well as the detected translation bug explained in blue text .
the last column shows the repaired translations.
answertorq3 catrepairstwicemorebugsthantransrepair.
for diversity cat repairs approximately halfof the bugs under each bug type whereas transrepair achieves competitive performance on only numerals for catv.s.
for transrepair failing to repair ofthe bugs under other types.
.
efficiency rq4 toanswerrq4 werecordthetimecostofcatandtransrepair during the process of mutant generation bug detection and bugrepair.
the results are shown in table .
overall both cat and transrepairhavegoodefficiencyunderourconfiguration seemore details in section .
in their automatic testing and repair tasks.
this high efficiency is important to guarantee that end users do notneedtowaitforalongtimetogetthefinalrepairedtranslation while using machine translators on line.
specifically formutantgeneration themeantimecostis0.01s permutantforcatand0.41sfortransrepair.thereasonisthat 8the cohen s kappa score of the translation acceptability and translation consistency are .
and .
respectively.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa sun and zhang et al.
table examples of buggy translations that cat can repair whereas transrepair cannot.
original input sentence originaltranslationandthebug explainedinblue text repaired translation around140 000peoplehaveaheartattackinenglandeveryyear andaquarterofthesegoontohave another attack or a stroke.
140 bug isincorrectlytranslated to .
million 140 is correctly translated to .
your patience never fails to disappoint me.
bug never fails to is incorrectly translated to its opposite meaning which means never .
never fails is correctly translated to .
therehemanagedpresidentialprotocolandgovernment staff the kremlin website says in russian .
in russian is correctly translated to .
transrepair uses stanford parser to parse each sentence for applying word replacement as well as filtering mutant candidates.
cat directlyusestheinferenceofthebertmodel.itavoidstheparsing process thereby greatly improving the efficiency.
table efficiency of cat and transrepair rq4 .
approach transrepair cat mutantgeneration .41s0.01s bug detection .99s0.27s bug repair .34s1.92s the lower cost of cat in mutant generation also contributes to itslower costin bugdetection cat needs0.27s onaverage for examining each sentence to report bugs while transrepair needs .99s.
for each reported bug cat spends .92s to conduct the automatic repair transrepair spends .34s.
the reason is that tran srepair is not able to generate many mutants when fixing a bug yet each mutant requires a fetch of translation from google translate transformerfortherepairprocess.consequently itstimespent on each bug is lower than cat.
however this lower time comes at a significant cost most bugs could not be repaired successfully as we have observed in rq2 due to the insufficiency of mutants.
the overall results lead to the following conclusion answerto rq4 cat is significantly more efficient than transrepairinmutantgeneration .01sv.s.
.41s andbug detection .27s v.s.
.99s .
cat has comparable efficiency slightlyworse withtransrepairinbugrepair .92sv.s.
.34s whichisattributedtothelargernumberofmutants that it employs.
extended analysis in this section we provide an analysis beyond the scope of our research questions that can improve the understanding and better explain the effectiveness of cat.
.
comparison with other translation testing approaches asintroducedinsection2 apartfromtransrepair therearealso some other translation testing approaches.
this section explores their effectiveness and discusses their differences with cat.
we compare cat with lcs metric with three most recently publishedtestingmethods sit patinv andpurity .for sit patinv andpurityweusedtheirreleasedcodeandparameterise themaccordingtotheirbestperformingparameters asshownby theirpapers.table7presentsthenumberofbugsdetectedbythesefourapproachesongoogletranslate gt andtransformer.ascanbe seen by these results cat and sit detect many more bugs than transrepair patinv and purity.
table number of reported bugs for different machine translation testing methods.
translator transrepair sit patinv purity cat gt transformer these bugs are reported according to each approach s own test oracles.thus theyhavevariousbugtypes notnecessarilyinconsis tency bugs.
to explore the possibility of employing these approachforthesamepurposeofcat i.e.
todetectinconsistencybugs we further conduct a manual inspection on the bugs each approach reported and report their validity in detecting inconsistency bugs.
to this end the first two authors manually inspected9the reported bugs and checked whether they actually exposed inconsistencytranslationissues.theresultsofthisanalysisarerecordedinta ble .
in this table false positive fp means that the approachreports the translations as problematic buggy but the manualinspection actually finds out that it is correct i.e.
it is not a bug.false negative fn means that the approach reports the transla tions as non buggy but the manual inspection reveals that it isactually problematic it is a bug .
we observe that cat achievesa significantly higher f1 score than sit patinv and purity.
thisis not surprising considering that sit patinv and purity aim to detect different types of bugs.
9the cohen kappa score of sit patinv purity is .
.
.
respectively.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving machine translation systems via isotopic replacementicse may pittsburgh pa usa table validity of reported bugs for different translation testing methods.
approach tn fn fp tp precision recall f1 transrepair .
.
.
.
.
.
.
sit .
.
.
.
.
.
.
patinv .
.
.
.
.
.
.
purity .
.
.
.
.
.
.
cat .
.
.
.
.
.
.
.
influence of mutant number on bug testing and repair inourexperiment followingthepreviouswork wesetthemaximummutantnumberto5forbugdetection andto16forbugrepair.
hereweinvestigatetheinfluenceofthisboundonthenumberof detected and repaired bugs.
forbugdetection werepeattheexperimentswithatmost1or3 mutantspersentence.table9showsthenumberofbugsdetectedby cat and transrepair when using different upper bounds number ofmutants onthefourmetrics.wefindthatahighernumberof mutantsleadstoahighernumberofdetectedbugsforbothcat and transrepair.
notably cat detects approximately twice thebugs as those detected by transrepair for all the three different bounds we examined.
table influence of the upper bound of mutant number in bug detection.
metrictransrepair cat lcs ed tfidf bleu for bug repair we repeat the experiments with a maximum numberof4or8mutants.table10recordstherelatedresults.as can be seen no matter what upper bound we use cat repairs morethanthreetimesthenumberofbugsrepairedbytransrepair.interestingly weobservethatevenwith4mutants catcanstillfix morebugsthantransrepairwith16mutants.thisisbecause transrepairfailstogeneratemutantsformanysentences aswe have observed from figure thus it is not able to repair any of the bugs falling into these cases.
threats to validity threats to external validity mainly lie in the evaluation dataset and the models we used.
first though our approach applies todifferent datasets and translation models so far we follow tran srepair and have only implemented and evaluated it on the same2 001sentencesandtwotranslationmodels.sofuturework is needed to understand the performance of cat on other datasets andmodels.second thoughweonlyusebertmodel toextracttable10 influenceoftheupperboundofmutantnumberin bug repair.
metrictransrepair cat lcs ed tfidf bleu the context aware word embeddings our approach is still compatiblewithothercontext awareembeddingmodels e.g.
roberta .
this is a future work to be explored.
threatstointernalvalidity mainlylieinourmanualassessment.
we follow transrepair and use the same human evaluation criteria.tofurtherreducethebiaswhencomparingdifferentmethods we randomised the sentences test inputs to guarantee thatthe method each sentence belongs to remains unknown to theauthors.
the high kappa scores indicate that the bias in human evaluation is minor.
we also release the details of human labelling on github available at to improve the transparency and replicability.
conclusion we propose cat an isotopic replacement based approach to improving machine translation.
as a special type of replacement isotopicreplacementsubtlycontrolstheimpactwhenreplacingwords.
thisisachievedbyusinganeural basedlanguagemodeltoencode the sentence context and designing another neural network based algorithmtoevaluatecontext awaresemanticsimilaritybetween twowords.suchreplacementisthenusedinasimilarwayastransrepair to detect and repair translation bugs.
the experimental resultsongoogletranslateandtransformershowthatcatsuccessfullydetects129 morebugsandrepairs199 more bugs than transrepair on google translate transformer.
for future work we plan to investigate other oracle approximationtechniquestofurtherimprovecat sperformanceinbug detection and repair.