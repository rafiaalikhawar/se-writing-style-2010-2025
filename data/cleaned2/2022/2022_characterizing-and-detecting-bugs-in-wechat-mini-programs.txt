characterizing and detecting bugs in wechat mini programs tao wang qingxin xu xiaoning chang state key lab of computer sciences institute of software chinese academy of sciences university of chinese academy of sciences beijing china wangtao19 xuqingxin19 changxiaoning17 otcaix.iscas.ac.cnwensheng dou jiaxin zhu state key lab of computer sciences institute of software chinese academy of sciences university of chinese academy of sciences beijing china wsdou zhujiaxin otcaix.iscas.ac.cn jinhui xie yuetang deng jianbo yang jiaheng yang tencent inc. guangzhou china hugoxie yuetangdeng xiaotuoyang jiahengyang tencent.comjun wei tao huang state key lab of computer sciences institute of software chinese academy of sciences university of chinese academy of sciences beijing china wj tao otcaix.iscas.ac.cn abstract builtonthewechatsocialplatform wechatmini programsare widelyusedbymorethan400millionuserseveryday.consequently the reliability of mini programs is particularly crucial.
however wechatmini programs sufferfrom variousbugsrelated toexecutionenvironment lifecyclemanagement asynchronousmechanism etc.thesebugshaveseriouslyaffectedusers experienceandcaused serious impacts.
inthispaper weconductthefirstempiricalstudyon83wechat mini program bugs and perform an in depth analysis of their root causes impactsandfixes.fromthisstudy weobtainmanyinterest ingfindingsthatcanopenupnewresearchdirectionsforcombating wechat mini program bugs.
based on the bug patterns found in ourstudy wefurtherdevelop wedetectortodetect wechatminiprogram bugs.
our evaluation on real world mini programs hasfound11previouslyunknownbugs and7ofthemhavebeen confirmed by developers.
ccs concepts general and reference empirical studies software and its engineering software testing and debugging.
tao wang and qingxin xu contribute equally.
wensheng dou and jun wei are the corresponding authors.
wensheng dou and jiaxin zhu are also affiliated with nanjing institute of software technology and university of chinese academy of sciences nanjing china.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
wechat mini programs empirical study bug detection acm reference format taowang qingxinxu xiaoningchang wenshengdou jiaxinzhu jinhui xie yuetang deng jianbo yang jiaheng yang jun wei and tao huang.
.
characterizing and detecting bugs in wechat mini programs.
in 44thinternationalconferenceonsoftwareengineering icse may21 pittsburgh pa usa.
acm new york ny usa pages.
https introduction wechat is one of the most popular social platforms running on mobileanddesktopoperatingsystems e.g.
android ios windows andmacos.arecentstudyhasreportedthatwechatiswidelyused in daily life and there are more than one billion monthly active users .
wechatmini programsrunonthewechatplatform andcan utilize various functions provided by wechat e.g.
user management fileaccess networkaccess location camera andpayment.
wechat mini programs do not have a palpable installation process as android and ios applications but users can have an experi ence as smooth as native android and ios applications.
wechatmini programshavebeenwidelyusedinmanyscenarios e.g.
ecommerce transaction andeducation.nowadays therearemore than5.5millionmini programsrunningonthewechatplatform and there are more than million wechat users using miniprograms every day .
based on the mini program framework developers can develop various wechat mini programs.
the mini program framework contains two layers a render layer and a logic layer.
the render layer is responsible for ui display.
for the purpose wxml weixinmarkuplanguage andwxss weixinstylesheets are usedasitsdescriptionlanguage whicharesimilartohtmland css in traditional web applications.
the logic layer is responsible for the program logic written in javascript.
the two layers run on ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa tao wang et al.
two independent threads respectively and communicate with each other through an asynchronous and event driven mechanism.
the mini program framework also provides rich components and apis fordeveloperstoimplementtheirownservices.mostoftheseapis are asynchronous thus making theentire mini program response smoothly.
unfortunately developing high quality wechat mini programs is a challenging task.
when developing wechat mini programs developers need to properly handle asynchronous mechanism platform differences lifecycle management etc.
otherwise variousbugscanoccurinwechatmini programs e.g.
conventional javascriptbugs asynchronousrelatedbugs andcompatibilitybugs.
we call wechat mini program bugs as webugsfor short.
more than million of errors caused by webugs are reported in the wechat internal monitoring system every day.
webugs can seriouslyaffectusers experienceandleadtoseriousconsequences e.g.
economiclossesandinformationleakages.tounderstand detect and fix webugs is of great importance to wechat mini program developers.
substantial empirical studies about software bugs have been conductedtoenrichourknowledgeonsoftwarereliability.existing empirical study on mobile applications mainly focus on var ious bugs in java based android applications e.g.
compatibility bugs security relatedbugs .existing javascript related empirical studies mainly focus on the client side javascriptapplications andserver sidejavascriptapplications .thesebugsareusuallyassociatedwithdynamic javascriptfeaturesandclient sidejavascriptbugsaremostlydomrelated.
however wechat mini programs are developed based on the wechat mini program framework which are greatly different fromclient server sidejavascriptapplicationsandandroidapplications.thus thesestudiescannotreflectthekeycharacteristics ofwebugs.existingworksonwechatmini programsmainlyfocusontheirdevelopment acceptanceandusage .
therefore thereislittleknowledgeaboutwebugsinliterature.understandingwebugsisofsignificantinteresttoourresearchersand practitionercommunity andcanbe helpfulinproviding guidance on bug avoidance detection testing and fixing etc.
in this paper we conduct the first empirical study on wechat mini program bugs.
we collect webugs from three sources i.e.
open source wechat mini programs in github qas from the developerforumandonlinerunningmini programsmaintainedby awechatdevelopmentcompany x.we studywebugsfromthe following three research questions.
rq1 root cause what are the root causes of wechat mini program bugs?
rq2 fixstrategy howdodevelopersfixwechatminiprogram bugs?
are there common fix patterns?
rq3 bugimpact whatimpactsdowechatmini program bugs have?
throughour in depthanalysis againstthe abovethree aspects we obtain many interesting findings and useful lessons for further research and practice.
for example .
webugs are caused by incompatiblefeaturesacrossdifferentdevices eventhoughwechat mini programsaredesignedascross platformapplications.thus developers should pay attention to compatibility related webugs.
hello wechat!
index.wxml .
view hello name !
view .
button bindtap changename .
click me!
button index.js .var hellodata .name wechat .
.page .data hellodata .changename function e .
sent data change to view .
this.setdata .
name world .
.
.
index.wxss .button .background color blue .width .margin top .
hello world!hello wechat!
a b c figure a simplified wechat mini program.
based on our empirical study we further design a static analysis tool wedetector to detect webugs under three specific bug patterns e.g.
incorrect platform dependent api usage incomplete layout adaptation to specific devices and non specific handling for arguments passed to callbacks.
we apply wedetector on popularwechatmini programsfromgithubandfind11previously unknown webugs in which webugs have been confirmed bydevelopers.
we have made our studied webugs and wedetector publicly available at in summary we make the following main contributions.
wepresentthefirstempiricalstudyonwechatmini program bugs from three aspects i.e.
root cause bug impact and fix strategy.
our in depth analysis reveals common vulnerabilities in wechat mini programs.
ourempiricalstudyobtainsmanyfindingsthatcanopenup new research directions.
we hope our study can shed lights on combating wechat mini program bugs.
wedesignastaticwebugdetectiontool wedetector and find new bugs in popular wechat mini programs.
the rest of this paper is organized as follows.
section presents anoverviewofwechatmini programsanditsframework.section3presentsourstudymethods.section4presentsourempiricalstudyresults.section5discusseslessonslearnedfromourstudy.basedon ourstudyresultsandlessons weproposeawebugdetectiontool in section .
section discusses related work and finally section concludes this paper.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizingand detecting bugs in wechat mini programs icse may pittsburgh pa usa android ios mac windows development tool location camerarender layer wxss wxmlwebviewlogic layer jscore logic process api filepayment network...event data data event user management runtime platformswechat figure the wechat mini program framework.
wechat mini programs wechat mini programs run on the social wechat platform which havebillionsofusers.onwechatplatform userscaneasilyfind mini programsbyscanningrelatedqrcodeorsearchingthenames and use them without downloading and installing process like android and ios applications.
benefited from the wechat social platform manyandroidandiosapplicationsalsoproposetheircorresponding wechatmini program versions e.g.
amazon airbnb and kfc.
nowadays wechat mini programs have been widely used in our daily life.
awechatmini program.
figure1showsasimplifiedwechat mini program.figure1ashowsthecodewhilefigure1bandfigure1cshowthedisplaypageoftheprogram.thisprogramcontains threefiles index.wxml index.wxss and index.js .file index.wxml builds the view of the page.
file index.wxss manages the style of the componentsin page.
file index.js decides theprogram logic written in javascript.
from figure 1a we can see that the function changename is bound on the button click me!
line and property name line1 isboundwiththe nameindoublecurlybrace line10 in index.wxml .whenthebuttoninfigure1bisclicked the display turns to that in figure 1c.
wechatmini programframework.
figure2showsthewechat mini program framework which mainly contains a render layer andalogiclayer.therenderlayer e.g.
index.wxml andindex.wxss infigure1a runsonthe webviewthread andthelogiclayer e.g.
index.js infigure1a runsonjscorethreadtoexecutejavascript code.
note that similar to android applications miniprograms and their pages have complicated lifecycle management e.g.
application launch page load and page show.
thelogiclayerandrenderlayercommunicatewitheachother through an asynchronous and event driven mechanism.
when usersclickthebutton clickme!
onthepageinfigure1b itwill triggerthebindingfunction changename line2 inthe index.wxml .table wechat mini program execution environments platform logic layer view layer ios mac javascriptcore wkwebview android v8 tencent xweb development tool nw.js chromium webview windows chrome kernel chrome kernel thewebview thread sends the event changename through wechat mini programplatform.thejscorethreadthenexecutesthecorresponding event handler line .
when data changes occurin the logic layer the data is passed from the logic layer to the wechat mini program platform via the setdata method and then forwarded to the render layer.
when the render layer notices name has been changed it then changes the page s display.
the wechat mini program framework provides various functions e.g.
usermanagement file access network access location camera and payment.
in order to make mini programs respond smoothly most of these apis work in an asynchronous and event driven manner.
runtime platforms.
wechat mini programs can run on different platforms.
mobile and desktop operating systems including android ios windows and macos are supported by the wechat mini program framework.
these platforms have different implementations of the mini program framework.
table illustrates the differentexecutionenvironmentsforlogiclayerandrenderlayer on different platforms.
although the wechat mini program framework intends to provideacross platformdevelopmentandruntimeenvironment the underlying runtime platforms can cause intricate differences to the execution of mini programs.
for example javascriptcore for ios9 and ios10 is not fully compatible with the ecmascript standard andtencentxweb rewritessomecomponents in chrome kernel e.g.
video.
therefore mini programs can behave differently when incompatible features are used.
study methodology inthissection wefirstpresenthowtocollectandanalyzewebugs and then explain the threats to our empirical study.
.
collecting webugs we select webugs from three sources i.e.
open source github mini programs official wechat mini program developer forum andonlinerunningmini programsmaintainedbyawechat development company x. these sources can provide various di mensions for webugs.
finally we obtain webugs from these sources.
in the following we explain how we collect webugs from them.
opensourcemini programs.
manyopensourcewechatminiprograms can be found in github.
to collect webugs from github wefirstcollectgithubrepositoriesrelatedtomini programs.we use three keywords mini program weapp wxapp to search github repositories.
we also include all open source repositories listed by the awesome wechat weapp project in our study.
projectawesome wechat weapp recordsmostpopularwechatminiprogramsanddevelopmentmaterialsongithub withover35.8k authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa tao wang et al.
table study subjects from github mini programs.
project category stars issues bugs colorui style .4k iview weapp component 6k wechat app mall shopping .4k 9wxparse text parser .6k winxin watch life blog 2k 2wx calendar calendar .9k 7wechat app demo devtool .7k 4wehalo blog .1k pinche xcx traveling 1scuplus wechat daily life 4weapp trending news 1threejs example graph 1cardoneperson notebook total stars.
through this step we obtain repositories.
we remove invalid repositories that do not have the entry file app.jsfor wechat mini programs and further remove repositories with less than one issue since they cannot contain valid information for our study.
after that we obtain distinct wechat mini program repositories and they contain more than issues.
we notice thatmostissuesareabouthowtouseorimprovemini programs.
we ignore this kind of issues in our study and select webugs with theseissuesthroughthefollowingsteps.
wereadthedescription of each issue report and select the issue if it has a clear description and available fix.
for issue reports having clear descriptions withoutfixes wetrytofindoutafixsolution.ifwecanfindafix solution wealsoincludetheminthestudy.finally weobtain49 webugs from open source github mini programs as shown in table .these wechat mini programs cover awide spectrumof categories e.g.
stylelibrariesanddailyservices.wecanalsosee that most of these wechat mini programs are popular becausetheyobtainmanystargazersingithub andcontainhundredsof issues.
qas in the official wechat mini program developer forum.wechat mini program developer forum is a technical exchange community maintained by the official wechat platform.
anyquestionsrelatedtomini programscanbepostedintheforum.
on average hundreds of questions are posted every day.
some ofthesequestionscanreflectwebugsencounteredbyindividual developers.
toextractwebugsfromthedeveloperforum wegothroughthe questionsandanswers qas postedfrom2021.
.1to2021.
.
and obtain more than10 qas.
we find thatmany qas are notrelatedtowebugs e.g.
developersaskhowtousenewfeaturesinthe wechatmini program.
we excludethese qas fromconsideration.
we consider a qa as a webug if it satisfies the following conditions.
theqadescribesanissuewhendevelopersimplement theirwechatmini programs.
theqacontainscodesnippets or clearly describes the code related to the qa.
thus we can re produce the issues by ourselves.
the qa was solved and the relatedwebugwasfixed.weobtain16webugsafterthescreening.online running mini programs.
during the collaboration with a wechat development company x we have the opportunity to collect webugs from online running mini programs.
online runningmini programsaresimilartoandroidandiosapplications publishedonthemarket respectively.fortheissuesprovidedby company x we compare their original and fixed versions and analyze their error stack information.
if we can fully understand a webug wetakeitintoconsideration.finally weobtain18webugs from online running mini programs.
.
analyzing webugs wethoroughlystudiedthese83wechatmini programbugsand triedtoanswertheresearchquestionsweraisedbefore.allcollected webugsweremanuallyanalyzedbythreeauthorsinthispaper.we performed an in depth analysis on the webugs by investigating their source code discussions fix patterns etc.
tobuildthetaxonomies weadoptopencardsortingapproach.
toreducebias webugsaregroupedandlabeledbythreeauthors independently.
next we discuss their results to reach a consensus.
we sort webugs using the following approaches.
root cause.
we try to answer the question what caused thisbugatthecodelevel .
basedonthestacktraceand messagesinissuereport welocatethebuggycodeandfigureout what caused the bug.
take the message result is not defined as an example we find the locations where the resultis used where the resultis passed from and why it is not defined.
if the issue report does not include the stack trace we manually reproduce this bug to obtain it.
if we cannot reproduce the bug we compare the buggy code and corresponding fix patch.
fix strategy.
the fix patch is obtained from associated pull request.
if there does not exist associated pull request we searchandanalyzecommitlogoftheprojecttoobtainthe fix code.
finally we manually extract the common patterns by abstracting the patches.
bugimpact.
thequalitativeimpactofmostwebugscanbe inferredbytheissuereportsstraightforwardly.ifdevelopers do not provide enough information we reproduce the bugs to check their results.
inourstudyprocess wealsoreferredtosomestudieswhichclassifiedthesoftwarebugs fortheinitialclassifications of root causes.
with further analysis we gradually refined these root causes e.g.
removed the unmatched and added new ones.
duringourstudy wealsoreproducedsomewebugsifrelated information are available.
.
threats to validity internalvalidity.
ourempiricalstudy sdesignandplanningfollow the structure suggested by wohlin .
we carefully study eachwebug ssourcecode discussionandfixpatchtohaveadeeper understanding.whenanycategorieschangeduringthestudy all webugs need to be re analyzed again.
all the collected webugs and analysis results have been discussed and confirmed by at least threeauthorsofthispaper.forbugsthatwedonotagreeon we turntodevelopersandcompanyxforhelp.ifabugcannotbefully understoodby us wedo not takeit intoconsideration.
thus we authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizingand detecting bugs in wechat mini programs icse may pittsburgh pa usa believe that all studied webugs are true positives and have been thoroughly studied.
external validity.
we may miss some known webugs in the selection process and the selected webugs may not cover all kinds ofwebugs.however ourdatasethascoveredtheinvestigatedspace of the wechat mini programs and has good representativeness.
fromfigure2 wecanobservethatbugscanoccurinsomesituations i.e.
the adaptation of different operating systems original wechat functionalities regular javascript code and asynchronous mechanism.wehavestudiedmorethan4000issuesand10000qas covering most of the popular open source projects.
our dataset does cover these bugs.
webug study results inthissection wepresentthedetailedresultsofourempiricalstudy on83webugsfromthreeaspects i.e.
rootcause bugfixandbug impact.
.
root cause as shown in table we identify six types of root causes.
differencesin executionenvironments.
mini programsare designed to be cross platform and it has an internal mechanism to handleplatformdifferenceswheninterpretingthecodeofrender layer and logic layer.
however .
webugs are caused by thediscrepanciesamongplatform executionenvironments.these bugs are related to platform dependent api usage inconsistentrendering among different devices and different versions of the mini program framework.
platform dependent apis.
some apis in the mini program frameworkareos specific e.g.
theydonotsupportallosorhavedifferentbehaviorsondifferentos.compatibilitybugsoccurwhen invoking the same api results in inconsistent behavior on differentdevicemodels.forexample wx.onsharetimeline onlyworks in android.
datereturns different values between android and ios.
the issue wechat app mall reports that users cannot accessapageoniosdevices.thiswebugiscausedbytheinconsis tent time format between android and ios.
developers invoke api datetoobtainthesystemtime.thereturntimeonandroidissplit with e.g.
while e.g.
onios.developers donotnormalizethevalueintothesameformat andintroducethis bug.
nine webugs are related to platform dependent apis.
notethat androidapplicationsalsosufferfromcompatibilityissues caused by platform dependent apis .
howeve r platformdependentapisinwechatmini programshavedifferentcharacteristics from those in android.
platform dependent apis in wechat mini programs are not only related to hardware but also related to softwareplatforms.wehavesummarized13platform dependent apis in table in which six apis are related to hardware e.g.
bluetooth nfc andvideo.fourapishavecertainrestrictionson different platforms e.g.
different parameters different return valuesanddifferentdataformat.forexample thetypeofreturnvalue of apiwx.oncompasschange on ios device is numberwhile on androiddeviceis string.iftheseapisarehandledproperly similar compatibility bugs can be avoided.
safe area a normal screen safe area b anomalous screen top notch bottom barcamera figure safe areas of normal screen and anomalous screen.
finding some apis in the mini program framework are platform dependent.if developersdo nothandle theseapisproperly compatibility bugs can occur.
inconsistent rendering among different devices.
although the layoutofmini programsisself adaptive therearealsothreeabnormal rendering bugs.
these bugs arise in specific devices due to their anomalousscreens.forsomedevices e.g.
figure3a alltheirscreencan be used to render applications.
however for some devices e.g.
figure 3b parts of their screen are occupied by some components e.g camera.
thus rendering applications on the restricted areas cancauseabnormaldisplays.theissuecolorui reportsthat the height of the side drawer is incorrect on iphonex in whichthere is a bottom bar on the screen and the bottom bar occupies certain position.
developers should adapt the layout settings based onsafearea of the screen in different devices.
note that previous rendering issue studies in android observethatrenderingissuesaremainlycausedbydifferentscreensizes.
wechat mini programs have been able to adjust the ui adaptively according to screen sizes.
our study finds that wechat miniprograms should pay more attention to safeareain mobile phones.
finding2 althoughthelayoutofmini programsisself adaptive in rendering developers still need to adjust them to fit the safe areas on some devices with anomalous screens.
inconsistentbehaviorsduetodifferentversionsofthemini program framework.
therehavebeentwomajorreleasesofthemini program framework andtheapisarechangingacrossdifferentversions.for example when the mini program framework was updated from .
to .
the property shapeis no longer supported for i button .
it is difficult for developers to notice the changes in the miniprogram framework and to modify their programs accordingly.
additionally some featuresare notcorrectly supportedby certain framework versions e.g.
some settings in component textarea and api wx.previewmedia cannot work properly.
six webugs belong to this case.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa tao wang et al.
table root causes of wechat mini program bugs root cause webugs ratio differences in execution environmentsapis have restricted usages on specific os e.g.
android and ios.
.
inconsistent rendering among different devices.
.
inconsistent behaviors due to different versions of mini program framework.
.
subtotal .
api misuseusing inappropriate apis.
.
using inappropriate api parameters.
.
using improper style priority settings.
.
subtotal .
syntax errorsspelling mistakes in javascript code.
.
forgetting to define necessary variables and functions.
.
subtotal .
no verification of data validity forgetting to check the validity of return data from external requests.
.
asynchronous errors concurrency errors caused by asynchronous mechanism and lifecycle events.
.
logic errors incorrect or incomplete implementation logic.
.
total finding3 differentversionsofthemini programframeworkcan introduce discrepancies and thus cause webugs.
api misuse.
developers may misunderstand the apis components of the mini program framework and introduce errors due to incorrect usage.
webugs are caused by api misuse including inappropriate api selection inappropriate api parameters and incorrect settings of style priority.
inappropriate api selection.
developers may have wrong understanding of the api functionality provided by the mini programframework.
thus using inappropriate apis cannot satisfy devel opers expectations and introduces bugs.
four webugs belongto this case.
webug cardoneperson is such an example.
in a textarea developers expect that the page automatically updates after the user modifies the page content.
however they bind acontentchange function by using bindblur which is triggered whenthefocusofthepagechanges.thus whenusersclick confirm updatedirectly after their modifications the focus of the textarea does not change and the page does not update accordingly.
in this case developers should use bindinput instead of bindblur.
inappropriate api parameters.
developers may have wrong assumptions anduseinappropriateparametersfortheapisprovided by the mini program framework.
two webugs belong to this case.
forexample inwebugwechat app mall thedeveloper invokesthepaymentapibyexecuting wxapi.paybill a b andonlypassoneparameter a b .however thepaymentapi wxapi.paybill requires two parameters a b and should be used as wxapi.paybill a b .
the developer combines the two parameters into a single object and thus makes the payment fail.
incorrectsettingofstylepriority.
developersmaynothaveafully understanding of style priority.
figure explains style priority withasimplifiedexample.figure4ashowsthestylesettingcode andfigure4bshowsthedisplay.wecanseethattheglobalstyle setting in index.wxss of button.background color is blue while the button color is set green in index.wxml .
however the final color of the button is green because inner settings have higher prioritythanglobalsettings.improperstyleprioritysettingscan click me!
index.wxml button style background color green click me!
button index.wxss button background color blue width margin top a b figure a simplified example of style priority setting.
introduce unexpected rendering bugs especially when third party style libraries are used.
four webugs belong to this case.
finding4 developersmaynothaveafullyunderstandingofstyle priority and introduce some non functional issues like unexpected rendering performance.
syntaxerrors.
themini programframeworkadoptsjavascript as its programming language.
due to the dynamic feature of javascript mini programscanstillrunwhenencounteringsyntaxerrors.
we observe that syntax errors are common in mini programs and .
webugs belong to syntax errors.
syntax errors in mini programs fall into two categories i.e.
spelling mistake and forgetting to define variables and functions .
finding syntax errors are common .
inmini programs.
noverificationofdatavalidity.
duringtheprocessingofdata especially dealing with return data from requests developers often assume that the data structure meets their expectations.
they may directlyaccesspropertiesorfunctionsonthereturndata.however thereturndatacanbe undefined ornullduetovariousreasons authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizingand detecting bugs in wechat mini programs icse may pittsburgh pa usa index.js .getlist function .var that this .util.req url page function data .
if data.list .
var list data.list .
list.foreach function item .
var li ... .
.
util.js .function req url data cb .wx.request .
url rootdocment url .
success function res .
return typeof cb function cb res.data .
.fail function .
return typeof cb function cb false .
.... if data.lis t false.list.foreach figure5 webugpinche .inthiswebug thedeveloper assumesthatallreturndatafromreq havetheproperty list.
e.g.
network failures and server crashes.
thus they need to verify thevalidityofthedatabeforeuse.otherwise atypeerror due toaccesspropertyof undefined nullobjectwilloccur.intotal .
webugs are caused by no verification of data validity.
take pinche in figure as an example.
when a user clicks mine atthebottomoftheindexpage thefunction getlist line1 istriggered andanerrormessage typeerror cannotread property foreach ofundefined appears.function getlistcalls the function req line to send a request.
if the request fails it triggersthe failcallbackfunction line17 andreturnsaboolean data false.
since function getlist does not check whether it is a validvalue e.g.
line4 andoperationsonabooleandata false can cause a typeerror.
finding6 developersoftenassumethatreturndatafromrequests haveexpectedproperties andforgettoverifytheirvalidity causing webugs.
asynchronous errors.
as discussed in section the miniprogram framework provides many asynchronous apis and miniprograms have complicated lifecycle management which is eventdriven.
the asynchronous and event driven mechanism introduces the risk that the data are processed and accessed in an unexpected order thus causing asynchronous errors.
three webugs belong to this case.
figure6showsanasynchronouserrorcausedbylifecycleevents in mini programs .
figure 6a and figure 6b shows the application and page code respectively.
figure 6c shows the process how thisbughappens.whenthemini programstarts theapplicationlevel lifecycle events app.js are first triggered e.g.
onlaunch andonshow.thenthepage levellifecycleevents index.js ar e triggered.
the global variable userinfo inapp.jsisnullby default.
the onlaunch function in app.jsasynchronously sends a request to get user information which is executed in parallel with thecodein onloadofindex.js .ifonloadofindex.js isexecuted app.js app globaldata userinfo null onlaunch wx.getuserinfo success res this.globaldata.
userinfo res.userinfo ... index.js const app getapp page data userinfo onload this.setdata userinfo app.globaldata .userinfo onlaunch onshow onload onshow ...application page wx.getuserinfo this.globaldata.
userinfo res.userinfothis.globaldata.
userinfo null a b c figure webug forumqas .
during the initialization of the mini program the unexpected data processing orders result in the user information being set to null.
before the request returns in app.js userinfo inindex.js will be set as null.
this is unexpected.
finding asynchronous mechanism and lifecycle management in mini programs can introduce intricate concurrency errors.
logic errors.
the logic implemented by developers may be incomplete or incorrect resulting in some functions or displays that do not satisfy the requirements.
.
webugs fall intologic errors.
for these webugs most of them are caused byincompletelogic.forexample inwxparse theparser cannot parse strings longer than characters.
in wechat appmall the balances less than .
cannot be rounded.
.
fix strategy we find that the fixes of webugs are highly related to their root causes.wesummarizefourcommonfixpatternsfor44.
ofthe studied webugs.
the rest webugs are fixed case by case.
layout adaptation to anomalous screens.
three webugs relatedtoinconsistentrenderingonspecificdevicescanbefixedbyageneralapproach.developerscanuseapi wx.getsysteminfo to getthe safearea ofauser sdevice.withthe safearea theycan setupthelayoutasnormal.however developersmayfixthesebugscasebycase.forexample developersset34pxatthescreenbottom if they identify the device type is iphonex in webug colorui .
fixing syntax errors.
four webugs caused by spelling mistakes canbedirectlyfixedwithafewgrammarcheckers e.g.
jslint and eslint .
the rest webugs caused by forgetting to definevariablesandfunctionscanbedetectedbythesegrammar checkers.
base on detecting results developers can easily fix these bugs.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa tao wang et al.
adding undefined null check before use.
all webugs caused by no verification of data validity are fixed by adding the undefined null check andexception handling before use.
the fix codeinfigure5isatypicalexample inwhichthedeveloperchecks the validity of data.list before use.
synchronization.
incorrect timing of asynchronous apis and lifecycle events can lead to wrong shared data accessing orders.
tofixasynchronouserrors developerscanintroducead hocsynchronizationforshared data.forexample in figure6 developers needtocheckwhether getuserinfo hasreturnedand userinfo has been set in onloadofindex.js .
three webugs caused by asynchronous mechanism are fixed under this approach.
case by casefixes.
theremainingbugshavediversecharacteristicsandrequirespecificfixes.forbugscausedbyusingdeprecated apis theyhavetobereplacedbythenewversions.therearesome apichangesdetectionwork forotherlibrariesandframeworks whichcanbeappliedtowechatmini programs.theapi misuse bugs have to be fixed according to the context and api specification.the fixesof bugscaused bylogic errordepends on the logic itself.
finding .
webugs have common fixing patterns such as consideringdevicemodelbeforeusingsomeplatform dependent apis and adding checks before using request data.
.
bug impact in our study we first try to reproduce our studied webugs and observetheirimpacts.ifwecannotreproduceawebug weinfer its impact from itsissue report and related discussion.
finally we clearlyobtaintheimpactsof65webugs.forthese65webugs their impacts are described as follows.
application crash.
mini program bugs hardly cause severe consequences.inourstudy weonlyobserveonebugthatcancrash its application.
abnormaldisplay.
30webugsleadtoabnormaldisplay e.g.
the unexpected style of the view components in figure some inconsistentrenderingamongspecificdevices anderrorsin style settings .
functionalerror.
in26webugs theapplicationsdonotmeet theirrequirements.theapplicationsprovidetheincorrectorflawed functions.wealsofindthatfourwebugsaresporadic.iftheuser re enters or refreshes the page these bugs may disappear.
these bugs are usually caused by missing exception handling of network failures and incorrect asynchronous operations.
silent error.
eight webugs neither affect the display of related pages nor causefunctional errors.
they only report relatederrors in the console.
finding9 webugscancausevariousconsequences e.g.
applicationscrashes abnormaldisplays functionalerrorsandsalient errors.
lessons learned webugscanleadtoabnormaldisplay functionalerrorsandeven application crashes finding .
thus resolving webugs is of great significance for the reliability of wechat mini programs.
in thissection wediscussimplicationstoexistingpracticeandopportunities for research in avoiding detecting and testing webugs in wechat mini programs.
.
avoiding webugs syntax errors are common .
in practice finding .
develop ers can apply some tools to reduce the occurrence of syntax errors.
for example developers can use syntax checkers in the develop ment process e.g.
eslint and jslint thus avoiding some syntax errors.
althoughmini programsaredesignedtorunonmultipleplatforms many .
webugsarestillcausedbythediscrepancies among different platforms finding .
during our study wealso observe that the official document does not clearly state relatedapis restrictions.toavoidthese webugs theserestrictions shouldbewelldocumentedintheofficialdocument.inthesame while astaticcheckertool whichcanautomaticallyidentifyrelated apis in mini programs and check whether their restrictions are satisfied could be greatly helpful.
from another point the miniprogramframeworkcanshieldsomediscrepanciesamongdifferent platforms e.g.
inconsistenttimeformatresultsfrom date.thus related webugs can be avoided.
.
detecting webugs existing javascript bug detection approaches e.g.
tajs xsssafe andsynode mainlyfocusondetectingserverside and client side javascript bugs.
our empirical study has reportedmany mini programspecific bugs e.g.
compatibilitybugs due to incorrect platform dependent api usages finding and inconsistentrenderingacrossspecificdevices finding2 asynchro nouserrorsduetomini programlifecycleandasynchronousmechanism finding and abnormal rendering results due to improper styleprioritysettings finding4 .existingapproachescannotworkon these webugs properly.
our findings can be used to design new webug detection tools.
compatibilitybugdetection.
many .
webugsarecaused by the discrepancies among different platforms finding .
this is mainly caused by incompatibility apis provided by the mini platform framework.
by summarizing incompatible apis in the mini program framework we can develop a static analysis tool to automatically identify these webugs.
return data guided bug detection.
developers often assume that they can obtain expected data from external requests or asynchronoustasks andignorecheckingthedatavalidity finding6 .
however thereturndatamaybewrongduetovariousreasons e.g.
network failures and asynchronous task failures.
thus essential judgments on the return data are required e.g.
whether the return data can be used without triggering any errors.
non deterministicbugdetection.
themini programframeworkprovidesmanyasynchronousapis andmini programsadopt event drivenlifecyclemanagement.theasynchronousandeventdrivenmechanismintroduceswebugs finding7 .differentfrom non deterministicbugsinclient sidejavascriptapplicationsandserver side javascript applications the lifecycle management in authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizingand detecting bugs in wechat mini programs icse may pittsburgh pa usa table four kinds of platform dependent apis android only ios only inconsistency on android and ios any os wx.makebluetoothpair wx.qy.startnfcreader wx.qy.nfcreader canvas.todataurl wx.onsharetimelinebleperipheralserver.oncharateristicsubscribed videocontext.showstatusbar bleperipheralserver.oncharasteristicunsubscribed wx.setbackgroundcolor a arg.backgroundcolortop a arg.backgroundcolorbottomwx.oncompasschange r type number ios r type string android wx.connectwifi v wechat version ios v no limit android date af split with ios af split with android console.dir console.dir makes some devices crash and it should not be used in mini programs.
athe arguments of the function rthe return data of the function vthe version of the wechat afthe data format of the argument.d mini programs makes non deterministic bug detection more challenging.
to automatically detect non deterministic bugs in miniprograms we needto buildaclear modelaboutthe lifecycleman agement and asynchronous apis in mini programs.
.
testing mini programs testingiscriticalinexposingbugsbeforesoftwarerelease.many testingtechniqueshave been proposedforexposingandroid and javascript applications but no technique is designed for wechat mini programs.
wechatmini programsusuallyhavecomplicatedinterfacesand lifecyclemanagement.itiscriticaltodesignatooltoautomaticallyexposeuserinteractionswithmini programs thusexaminingtheir functionality.further mini programsusuallydependonvarious asynchronoustasksandexternalenvironments andmayencountermanyadversarialconditions e.g.
networkfailures.improperlyhandling these conditions can cause webugs finding .
researchers and developers can intentionally inject adversarial conditions and validatewhethermini programscanbehavecorrectly under adversarial conditions.
detecting webugs inthissection wesummarizethreebugpatternsfromourempirical study on webugs and further propose a static analysis tool wedetector to detect webugs.
.
bug patterns our empirical study on webugs has revealed several potential patternstodetectwebugs.amongthem wesummarizethreecommon bugpatterns i.e.
incorrectinvocationsplatform dependentapis incomplete layout adaptation to anomalous screens and improper handling of return data in invoking asynchronous apis.
pattern incorrect invocations of platform dependent apis.someapisinthemini programframeworkareos specific finding .invoking theseplatform dependent apis withoutconsidering different os can introduce webugs.
therefore develop ers should determine target operating system before using these apis.
we summarize four kinds of platform dependent apis intable which are collected from our empirical study and official mini program development document .
the items beginning with show some additional considerations.
for example arg.backgroundcolortop in column ios only means that the argumentcanonlybeusedoniosdeviceswheninvokingfunction wx.setbackgroundcolor .
the column inconsistency on android andios includessomeapisthatbehavedifferentlyondifferent systems.
for example the dateformat on android is split with while that on ios is split with .
pattern incomplete layout adaptation to anomalous screens.
as discussed in section .
developers can use the api wx.getsysteminfo to get the safearea of the phone model and avoidlayoutissues.ifamini programdoesnotapplythistoanomalous screens webugs related to abnormal rendering can occur.
pattern3 improperhandlingofreturndataininvoking asynchronous apis.
in the wechat mini program framework mostapisareusedinanasynchronousway.the successandfail callbacks are defined to handle the return data for successful orfailed invocations.
however the type or data structure for the returndatamayvary.ifdevelopersareunawareoftheirdifferences webugs can occur.
figure shows such an example.
.
detection approach detectionofpattern1.
forwebugscausedbyincorrectinvocationsofplatform dependentapis weneedtoexaminetheusageof specific apis that are listed in table .
in order to identify whether developers consider the system information wedetector checks the usage of wx.getsysteminfo that can obtain the target operating system information.
if developers use the apis on the list in table butdo not considerthe corresponding osrestrictions we report a compatibility webug.
detection of pattern .
we examine whether developers have setupthelayoutbasedon safearea orwindowheight andwindowwidththrough wx.getsysteminfo api.
the windowheight and windowwidth can also obtain the available area of the devices.
therefore wedetector checks whether a mini program uses these properties.
if not we report an abnormal rendering webug.
detection of pattern .
to detect webugs in bug pattern we check whether the return data from an asynchronous function e.g wx.request is legally used i.e.
there are no type errors.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa tao wang et al.
themainideaisasfollows.first weuseesprima toparseall javascriptfilesintoabstractsyntaxtrees ast andthenidentify all asynchronous function e.g wx.request invocations in a miniprogram.second foreachasynchronousfunctioninvocation we useast toidentifyitstwo callbacks succallback forits success return and failcallback for its fail return.
third for callback succallback andfailcallback weextracttheirreturndatafrom the asynchronous function and further analyze their usage based ontajs .fourth forthereturndatausages wecheckwhether they can trigger typeerrors.
if yes we report a webug.
take webug in figure as an example.
we first parse index.js andutil.js into abstract syntax trees.
by traversing asts we obtain all function definitions e.g.
getlist and function calls e.g.
util.req .
we then examine all function definitions.
if we get an function invocation e.g.
util.req we continue to analyze this invoked function.
if a function e.g.
util.req invokes wx.request wefurther obtainits two callbacks e.g.
successcallback line13 andfailedcallback line16 .further wecan obtainthatthereturndata res.data ispassedintosuccesscallback line14 andaconstant falseispassedintofailedcallback line .
inordertodeterminewhetherthereturndataisusedlegally we adopt tajs 1to carry out a data flow analysis on the return data data line3infigure5 .theresultoftajsisanintermediate representation e.g.
vardecl read variable read property write variable for line .
basedontheseintermediaterepresentations wecanbuildtheusagescenariosofthereturndata data.wefindthat data.list.foreach is the usage sequence on data line .
if the failed callback is triggered thereturndatawillbe false line17 andtheexecution offalse.list.foreach willthrow anerror message typeerror cannotreadproperty foreach ofundefined .itisbecausethatthefirstaccessreturnsa undefined object false.list undefined andthesecondaccesson undefined triggersatypeerror.notethat ifdevelopershasalreadyusedif conditiontoguardrelatedaccesses we do not report a webug.
for example in the fixed version in figure5 if data.list inline4isusedtoguardline5 .sowe do not report bugs for the fixed version.
.
evaluation inthissection weevaluatetheeffectivenessofwedetectorusing github open source projects and answer the following research question canwedetectordetectnewwebugsinreal world mini programs?
experimental subjects.
our experimental subjects contain 25wechatmini programs 13mini programsarecollectedfrom the latest versions of the mini programs in table and miniprograms arecollected from awesome wechat weapp bytheir popularity ordered by github stars in different categories.
the first rows show these mini programs.
results.
werunwedetectoronthese25mini programs anddetect12webugs andconfirmthat11ofthemaretrue.table5shows thedetaileddetectionresults.notethat forthelatestversionsof mini programsin our empiricalstudy we only detect 1tajs does not support new features provided by ecmascript6.
therefore we use babel to convert mini projects into ecmascript5.table detection results on mini programs.
project categorydetection results total conf.
p1 p2 p3 fp wxchat mail email hitmers attendance super9 video leantodo weapp notebook taro music music weapp ssha news weapp mark social nideshop shopping gitter git shellbox campus douban map weapp artand art pinche travelling total for13mini programsintable2 wedetectonenewbuginpinche .
onenewwebugsinpinche .formini programsthatwehave notdetectednewwebugsintable2 wedonotlistthemintable5.
we further reported all the true webugs to their correspondingdevelopers andattachedpatchestohelpdevelopersfixthese webugs.
for now of them have been confirmed by developers.
the last column total conf.
in table shows that details about reported and confirmed bugs.
thecolumn detectionresults intable5showsdifferentpatterns of bugs found in these mini programs.
we can observe that we can detect new webugs for all the three patterns.
for bug pattern1 twomini programsuseplatform dependentapiswithoutcompatibilityadaptation andwedetectorreportsfourwebugs.forbugpattern2 among25mini programs 6ofthemdonotadaptthelayoutofviewsacrossdifferentdeviceswithanomalousscreens.forbugpattern3 wedetectordetectsonewebuginprojectpinche .
in this webug when a wx.request fails the program tries to invoke function on an undefined variable which can cause a typeerror.
falsepositive.
forthedetected12webugs wereportonefalse positive which belongs to bug pattern .
in this false positive the developer processes the adaptation to anomalous screens by using anuncommonapproach i.e.
stylesettingforallpossibledevices.
thus the mini program does not handle anomalous screens using thecommonapproachdiscussedinbugpattern2.thisresultsin the false positive.
based on the above experiment and results we draw the following conclusion wedetector can effectively detect webugs in realworld wechat mini programs.
.
discussion comparisonwithexistingbugdetectionapproaches.
existing linter tools can be used to detect incorrect code based onspecificrules.however theycannotanalyzethebugpatterns insection6.
.forthe11truewebugsthatwedetectordetected noneofthemcanbedetectedbytheselintertools.someapiusagedetectionapproaches candetectapiusage e.g.
cryptographic api usage apis that perform additional actions.
however authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizingand detecting bugs in wechat mini programs icse may pittsburgh pa usa these tools mainly focus on specific domain e.g.
trusted apis in javascript.
without api specifications for webugs these tools cannot be used to detect webugs.
the most similar work is wejalangi .
wejalangi aims to detect nullpointexception.
it cannot be directly used to detect bug patterns in section .
.
in addition to this wejalangi is a dynamic analysis tool and its effectiveness heavilydependsontheprovidedtestcases.itischallengingtoconstruct test cases that trigger these webugs.
however wedetector isastaticanalysistool whichdirectlyanalyzesthecodewithout running wechat mini programs.
automated platform dependent api extraction.
in this paper we manually investigate our collected webugs and extract platform dependentapisforbugdetection.thisisalabor intensiveprocess.
it would be interesting to automatically extract these apis and their api context from highly popular mini programs.
as discussed earlier the most common pattern of fixing these webugs is tocheckdeviceinformationbeforeinvokingcertainapis.therefore it is possible for us to mine the usage rules of these apis.
we will explore this in the future work.
related work in this section we discuss related works that are close to our work.
wechatmini programstudies.
thewechatmini program framework is proposed in and has been widely used in practice.however onlyfewresearchworkshavebeendoneforwechatmini programs.haoetal.
analyzethedevelopmentofwechat mini program and regard it as the next generation of mobile internetplatform.someworksinvestigatemini programsfromusage acceptance .
liu et al.
modify jalangi and use it for dynamic analysis on wechat mini programs.
in our work we conduct the first empirical study on wechat mini program bugs andobtainabetterunderstandingofthesebugs.basedonour findings we also propose a static analysis tool wedetector and detectmorebugsinthemini programs.ourstudyshouldbeableto promote new research in improving the quality of mini programs.
empiricalbugstudies.
empiricalstudieshaveplayedanimportant role in understanding a field especially for the aspect ofsoftware reliability.
these studies can often help to characterizeproblems and provide guidance for following research.
lu et al.
conduct the first empirical study on real world concurrency bugs.theirworkprovidespreciousinformationtohelpimprovesoftware reliability such as concurrency bug detection bug fixing crash recovery etc.
ocariza et al.
conduct an empirical study on the client side javascript bugs and find that bugs are usually dom related.
this promotes some research ondom .
wang et al.
conduct an empirical study on concurrencybugsinnode.jsapplications.thisstudyrevealsthat most concurrency bugs in node.js applications contend againstshared memory and external resource.
these findings enlightensubsequent works in node.js bug detection as well.
however no empirical studies are performed on mini program bugs.
platformfragmentationstudies.
differentvendors produce a variety of android phones and make the android ecosystem suffer from fragmentation problems .
han et at.
carry out a topicanalysisofvendor specificbugstounderstandtheandroid fragmentation.
theyreveal that hardware based fragmentation inandroid is evident.
wei et at.
first characterize and detect compatibility issues induced by android fragmentation fic issues .
they observe that device specific fic issues are caused byproblematicdriverimplementation oscustomization and peculiarhardwarecompositionandthenon device specificficissues are caused by api evolution and original android system bugs.
the high frequency fragmentation bugs on android devices are hardware related and they do not have much in depth analysis forsomenon functionalrequirements suchasinconsistentrendering .
bug detection in javascript applications.
the approaches usedinbugdetectionaredecidedbythetargetsystemsandbugs.
therearevariousmethodsforbugdetection e.g.
staticanalysis dynamic analysis or combination of both.
guarnieri et al.
conductoneofthefirstpointeranalysesforjavascript.theyfirst managetomodelsomefeaturesonjavascript.tajs isatype analyzerforjavascriptapplications.ourworkutilizesthedataflow analysis provided by tajs.
there are a group of work to detect concurrencyissuesinnode.jsapplications e.g nodeav nrace noderacer node.fz and madsen et al.
.
there arealsosomeclient sidejavascriptanalysiswork e.g.
rclassify autoflox andsymjs .however theseworkscannot detect some kinds of webugs in mini programs e.g.
compatibility issues.
conclusion millions of wechat mini programs are running on the wechatsocial platform and more than million wechat users are us ing mini programs every day.
however wechat mini programsstill suffer from various quality issues related to execution environment lifecycle management asynchronous mechanism etc.
a comprehensiveunderstandingoftheseissuesisrequiredtoimprove wechat mini programs.
inthispaper weproposethefirstempiricalstudyonthebugsin mini programs.wecollect83bugsfromreal worldmini programs and perform an in depth empirical study on mini program bugsfrom root causes fix strategies and impacts.
we further propose wedetectortodetectwebugsofthreebugpatterns.theevaluation onreal worldmini programsindicatesthatwedetectoriseffective.
we hope our study can inspire more researchers and practitioners to combat mini program bugs.