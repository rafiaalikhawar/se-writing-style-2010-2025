see discussions st ats and author pr ofiles f or this public ation at .researchgate.ne t public ation transracer fu nction dependence guided t ransaction race detection for smart contracts conf erence paper no vember .
.
citations 8reads author s including wei song nanjing univ ersity of scienc e and t echnolog y publica tions citations see profile all c ontent f ollo wing this p age was uplo aded b y wei song on dec ember .
the user has r equest ed enhanc ement of the do wnlo aded file.transracer function dependence guided transaction race detection for smart contracts chenyang ma school of computer sci.
eng.
nanjing university of sci.
tech.
nanjing china .comwei song school of computer sci.
eng.
nanjing university of sci.
tech.
nanjing china wsong njust.edu.cnjeff huang parasol laboratory texas a m university college station tx usa jeff cse.tamu.edu abstract smart contracts are programs that define rules for transactions running on blockchains.
since any qualified transaction sequence within the same block can be orchestrated by the blockchain miner unexpected results may occur due to data races between transactions called transaction races .
surprisingly transaction races in smart contracts have not been fully investigated.
to address this we propose transracer an automated approach and open source tool that employs symbolic execution to detect transaction races in smart contracts.
transracer analyzes function dependencies to identify transaction races hidden in specific contract states.
it also generates witness transactions that can trigger such races.
the experimental results on real world smart contracts show the effectiveness and efficiency of transracer it detects races in .
minutes including race bugs leading to inconsistent states.
ccs concepts security and privacy domain specific security and privacy architectures software engineering software defect analysis .
keywords ethereum smart contract data race symbolic execution acm reference format chenyang ma wei song and jeff huang.
.
transracer function dependenceguided transaction race detection for smart contracts.
in proceedings of the 31st acm joint european software engineering conference and symposium on the foundations of software engineering esec fse december san francisco ca usa.
acm new york ny usa pages.
introduction blockchain is a powerful infrastructure that enables mutually untrusted users to reach a consensus on a distributed ledger.
the ledger can be used to decentralize applications which are known as smart contracts .
conceptually a smart contract is a stateful program that can be invoked by external users via transactions.
a smart corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than the author s must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse december san francisco ca usa copyright held by the owner author s .
publication rights licensed to acm.
acm isbn .
.
.
.
manages transaction executions through the pre defined rules written in a turing complete language e.g.
solidity .
this paper investigates a specific type of vulnerability in smart contracts caused by their concurrent execution model.
as demonstrated in for transactions submitted to ethereum over a brief time period the outcome may vary due to the nondeterministic execution sequence of the transactions determined by the miner.
prior studies have emphasized the seriousness of this issue.
luu et al.
introduce the transaction ordering dependent tod bug to explain how a pair of transactions can exhibit different contract balances under different execution sequences.
kolluri et al.
extend the concept of this concurrent bug to the event order bug which captures the full state differences of smart contracts beyond the balance difference.
we find that state differences or inconsistent states occur mainly because transactions race to access the same variables in a smart contract.
this situation is called a transaction race race for short in this paper.
when two transactions executed in different sequences generate different contract states they lead to a transaction race bug race bug for short .
the inconsistent states impact the subsequent transactions.
what is worse an attacker can tamper with some storage variables that transitively impact on money transactions let alone the cases when the race bugs directly lead inconsistent balances and money loss.
groce et al.
show that roughly of race conditions examined have serious legal and financial implications.
however no tools have been designed to detect races for smart contracts.
to this end we propose transracer an efficient symbolic analysis tool for race detection.
the goal of transracer is to find a reachable contract state and two transactions for each candidate function pair such that the transactions exhibit races at that state.
a race requires that the two transactions have read write conflicts and can be executed in different orders.
moreover whether the transactions can be executed depends on the state of the global variables.
transracer utilizes symbolic execution to capture all the above conditions and employs constraint solving to check the satisfiability of conditions.
when a race is detected transracer further checks whether the race could result in a race bug.
transracer aims to help developers auditors in the process of testing their implementation against their model or intended behaviour.
the detected races race bugs are malignant if contracts are not designed deliberately otherwise they are benign.
transracer can be used for contract auditing before contracts are deployed to ethereum.
users can only provide contract bytecode to transracer .
since smart contracts are stateful programs certain functions can be successfully invoked only at specific contract states.
thus symbolic analysis for race detection cannot proceed without inferring such states.
moreover it is not easy to find such a state for eachesec fse december san francisco ca usa chenyang ma wei song and jeff huang of these functions as the number of reachable contract states is enormous.
to tackle this challenge transracer leverages function dependencies to identify functions whose execution can cause a function not initially callable to become callable at the updated state.
existing smart contract bug detectors usually restrict vulnerability detection to a specific contract state or explore different contract states with the help of fuzzing but none attempt to infer such states like transracer .
for efficiency reasons transracer takes the following steps.
first transracer statically prunes function pairs that share no read write variables.
second at each contract state that activates a specific function transracer checks only the function pairs that contain this function during race detection.
therefore transracer captures races at multiple contract states but does not perform excessively repetitious checking of the same function pairs.
in this study we implement the transracer symbolic analysis tool in python and evaluate the effectiveness and efficiency of transracer on randomly chosen smart contracts.
transracer successfully finds true races including race bugs while requiring an average of only .
minutes of analysis time per contract.
we further apply transracer to investigate races in real world smart contracts and the empirical results reveal that .
of smart contracts can lead to races of which .
can lead to race bugs.
these results indicate that races and race bugs are prevalent in practice.
the main contributions of our work are as follows transracer can effectively detect races between two transactions to the same smart contract without generating false positives.
it also provides witness transaction sequences to manifest the races thus reducing manual auditing efforts.
instead of relying on random fuzzing we propose to seek contract states that activate certain functions by analyzing the dependence relations between functions which significantly shrinks the race detection search space.
our proposed notion of function dependence and the approach to seek the function dependence are applicable to detect other contract vulnerabilities.
we design and implement an open source tool transracer that automatically detects races in smart contracts.
an experimental evaluation on real world smart contracts show the effectiveness and efficiency of transracer .
we apply transracer to real world smart contracts.
the results indicate that races are a severe problem that are potentially harmful in practice.
the rest of this paper is organized as follows.
section presents an example that motivates our work.
section and section describes and evaluates our approach respectively.
section reviews related work and section concludes the paper.
motivation in this section we use an example to motivate our work.
with this example we illustrate how transaction races can lead to severe outcomes e.g.
attacks money loss and how to detect them.
figure a depicts a snippet of the smart contract wintoken that is compliant with the ethereum request for comments erc20 token standard .
the function mint is used to create hostaddress.
transfer this .balance else to.
transfer this .balance 1contract wintoken uint256 public totalsupply mapping address uint256 balances mapping address mapping address uint256 internal allowed function settransferlock bool set onlyowner locktransfer set function mint address to uint256 amount onlyowner totalsupply totalsupply.add amount balances balances .add amount function approve address spender uint256 value allowed value function increaseapproval address spender uint addedvalue allowed allowed msg.sender .add addedvalue function transferfrom address from address to uint256 value require locktransfer false require to !
address require value balances require value allowed allowed allowed msg.
sender .sub value ... ... 1contract gracecoin address public owner uint256 public sellexchangerate mapping address uint256 balances function setexchangerate uint rate assert msg.sender owner sellexchangerate rate function sellcoins uint amount payable assert balances amount uint256 etheramount amount sellexchangerate assert etheramount this .balance msg.sender .transfer etheramount balances balance amount ... 1contract citytoken address public ceoaddress address public cooaddress restrain the authority of the function call modifier onlyceo require msg.sender ceoaddress modifier onlyclevel require msg.sender ceoaddress msg.sender cooaddress function setceo address newceo public onlyceo require newceo !
address ceoaddress newceo function payout address to onlyclevel if to address ceoaddress.
transfer this .balance else to.
transfer this .balance g. figures and tables a positioning figures and tables place figures and tables at the top and bottom of columns.
avoid placing them in the middle of columns.
large figures and tables may span across both columns.
figure captions should be below the figures table heads should appear above the tables.
insert figures and tables after they are cited in the text.
use the abbreviation fig.
?
?
even at the beginning of a sentence.
table i data races detected by scr acer contracts data races data race bugs total unique current state updated state total unique