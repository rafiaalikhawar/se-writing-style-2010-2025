on the flysyntaxhighlightingusingneuralnetworks marcoedoardopalma universityofzurich switzerland marcoepalma ifi.uzh.chpasqualesalza universityofzurich switzerland salza ifi.uzh.chharaldc.gall universityofzurich switzerland gall ifi.uzh.ch abstract with the presence of online collaborative toolsfor software developers sourcecodeissharedandconsultedfrequently fromcode viewers to merge requests and code snippets.
typically code highlighting quality in such scenarios is sacrificed in favor of system responsiveness.intheseon the flysettings performingaformal grammatical analysis of the source code is not only expensive but alsointractableforthemanytimestheinputisaninvalidderivation ofthelanguage.indeed currentpopularhighlightersheavilyrelyon asystemofregularexpressions typicallyfarfromthespecification ofthelanguage slexer.duetotheircomplexity regularexpressions need to be periodically updated as more feedback is collected from theusersandtheirdesignunwelcomethedetectionofmorecomplexlanguageformations.thispaperdeliversadeeplearning based approachsuitableforon the flygrammaticalcode highlightingof correctandincorrectlanguagederivations suchascodeviewers and snippets.
it focuses on alleviating the burden on the developers who can reuse the language s parsing strategy to produce thedesiredhighlightingspecification.moreover thisapproachis comparedtonowadaysonlinesyntaxhighlightingtoolsandformal methodsintermsofaccuracyandexecutiontime acrossdifferent levelsofgrammaticalcoverage forthreemainstreamprogramming languages.
the results obtained show how the proposed approach can consistently achieve near perfect accuracy in its predictions thereby outperformingregularexpression basedstrategies.
ccsconcepts computingmethodologies neuralnetworks software anditsengineering automatedstaticanalysis .
keywords syntax highlighting neural networks deep learning regular expressions acmreferenceformat marco edoardo palma pasquale salza and harald c. gall.
.
on theflysyntaxhighlightingusingneuralnetworks.in proceedingsofthe30th acmjointeuropeansoftwareengineeringconferenceandsymposiumonthe foundationsofsoftwareengineering esec fse november14 18 singapore singapore.
acm newyork ny usa 12pages.
.
.
esec fse november14 18 singapore singapore 2022copyrightheldbytheowner author s .
acmisbn978 .
introduction today softwaredevelopersoftenturntoonlinewebapplications for support on several aspects concerning their source code manipulationtasks.sourcecoderepositoryhostingservices e.g.
gitlab bitbucket aretypicallyconcernedwithmanagingversioncontrol instances devops lifecycles code reviews continuous integration and deployment pipelines.
some extend these functionalities by including issue tracking knowledge bases and chats among other non software related features.
also some q a platforms e.g.
stackoverflow provide the possibility to query the community aboutcode relatedissues.
with the ability to boost productivity code syntax highlighting sh ispopular inonline scenariossuch as these described.
formally sh is a form of secondary notation in which portions of thetextaredisplayedindifferentcolors eachrepresentingsome feature of the language.
due to the majority of features only being inferablefromthegrammaticalstructureoftheinput thetaskof deciding what color should annotate what portion is non trivial.
therefore resolversinferthecolorassignmentsfromsomeinternal grammaticalrepresentation ofthecode.intuitively themorethis analysisrestrictsthebelongingofasubsequencetosomegrammaticalproductions thehigheristheaccuracyofitscomputation.asa resultofthehigherthenumberofsuchproductionsitcanrecognize andtherefore annotate the higheris the strategy s coverage.
unfortunately therearetwomainchallengesinperformingsuch analysisinthiscontext.first thereisavaryinglevelofgrammatical validityofthecodehighlighted.duetoonlinecodebeingembedded in multiple contexts its grammatical correctness cannot be guaranteed.indeed althoughinversioncontroliterationssource code might tend towards being of higher quality in other cases such as discussions in code review or chats this might not carry a valid language derivation i.e.
an abstract syntax tree ast might not be derivable .
this inherently induces sh strategiesinbeinglessreliantontheabilitytoderiveacomplete andwell formedrepresentation of the code.
a brute force bf approach towards performing accurate sh is to use the language s grammar for the derivation of asts binding acolortoeachtoken basedonitslocationinthetree.however not only is thisoften a computationally expensive strategy but it also cannotbeeasilyportedtoeffectivelyordeterministicallyrecover errors in scenarios of severely incorrect or incomplete language derivations e.g.
code snippets .
also given the rich syntax of modern mainstream programming languages parsing strategiesbettersuitedfordealingwithnoisylanguagederivations e.g.
islandparsing wouldexpect developers of sh tools to produce viableencodingsofthelanguages originalgrammars while stillrequiringtoexecuteaparsingroutine.
asforthesecondchallenge onlyasmalltimedelayisallowed for this frequent process to terminate which bf approaches might this work is licensed under a creative commons attributionnoncommercial .
internationallicense.
esec fse november14 18 singapore singapore marcoedoardopalma pasqualesalza andharaldc.gall a pygments .
characteraccuracy.
b brnn .
characteraccuracy.
figure1 anexampleof task t4ofjavash usingthestate of practiceandproposedapproaches.
exceed.
on the fly shreferstocodebeinghighlightedasthisis beingretrieved bythe user.theadherence tosuch computational schemaresultsinshresolvershavinganindirectimpactonuserexperience .fortheabove mentionedreasons stateofpractice sh strategies are mainly built around per language ad hoc lexers whichheavilyrelyonsystemsofregularexpressions regexes .such design allows to achieve excellent computational performances whilstprovidingashcapableofcapturingsomecontainednumber ofgrammaticalstructuresandaccuracylevels.anexampleofthe effects of this strategy is visible in figure .
here the sh produced by a popular regexes based resolver figure 1a is compared to one producing perfect highlighting for a grammatical coverage resemblingthosefoundonintegrateddevelopmentenvironments ides figure1b .thelowcoverageoftheformerisperceivedbyitsinability to detect identifiers for types method and variable declarations.
in addition it cannot distinguish severely distant grammatical constructionssuchasfieldaccesses methodinvocations andreference types.inturn thiscontributestolowannotationaccuracy.moreover thespecificationoftheselexersisoftenfarfromthatofthelanguage inducing a tedious and error prone regexes design process withthegeneralizabilityofthefinalproductrelyingonthemanual compilation oftest casesandmultiple iterations ofuserfeedback.
therefore motivatedbythesechallengesandshortcomings it is desirable to have an approach that is simpletoimplement providingadeterministic reusable andlow effortprocessfordevelopers to create and customize highlighters abletoreachhigh grammaticalcoverages enablingefficienthighlightingofmorecomplex grammatical structures than those computed in nowadays online highlighters highly accurate closely reproducing the highlightingaccuracyofaformalastanalysisprocess input flexible reaching high accuracy on correct and incomplete invalid derivationsofthe target programminglanguage.
this paper proposesa solution that exploits lightweight recurrentneuralnetworks rnns modelstoencodethehighlighting behaviorsofformalshbrute force bf methods.abfapproachis user definedandexploitsthelanguage sexistinglexingandparsing tools to assign each token in the source code to a sh class i.e.
an abstraction of the sh color based on its location in the ast.
therefore itisaformalprocess which ifwell formedtomatchthe intended highlighting scheme is always guaranteed to generate the correct shsfor files carryinga validderivationof the language.
after having used bf to compile highlighting assignments sh for multiple sample files an rnn is trained to bind sequences of tokenstosequencesofshclasses.
thetrainingprocessonlyoccurs once and produces an rnn model that is reusable for all futuresh tasks.
for the training hardware used for the experiments in this work all the proposed models can be trained in the order of minutes and comfortably within the one hour mark.
in the case ofthenon bidirectionalflavors thedelayiscutinhalfcompared to their bidirectional counterpart.
this delay substitutes to today s state of practice resolvers which involve the development of tedious systems of regex.
once trained the rnn computes the sh ofsourcecodebyinferringshclassestothetokenstreamproduced bythe language soriginallexer.
thisnovelapproachtoon the flyshistestedwithregardsto its accuracy across four types of grammatical coverages exploringthedetectionofdifferent combinationsof lexicalfeaturesand variousgrammaticalconstructionsforidentifiers declarations and annotations.tosupportthesuitabilityoftheproposedapproachin the deployment scenarios previously envisioned this is also tested withregardstoitsexecutiontimewhenpredicting.moreover the same metrics are measured across three mainstream programming languages java kotlin andpython.allthemetricsarealsocomputed for a highly popular sh tool i.e.
pygments based on the well establishregex strategyusedby alarge numberof online vendorssuch as gitlab bitbucket andwikipedia .
tosummarize the main contributionsof this paper are a dataset for sh benchmarking for three popular programming languages i.e.
java kotlin andpython obtained through formalbfstrategies the design of an neural network nn based approach for sh withnear perfecthighlightingaccuracyandsuitableprediction delays the comparison with the state of practice sh strategy in terms ofaccuracy coverage andexecutiontime the performance analysis of the approaches in case of incorrect incomplete sourcecodes.
the implementation benchmark datasets and results are available in the replication package and published at the address .
therestofthispaperisstructuredasfollows.section presents the design of the approach.
section 3describes the experimental setup whereas section 4shows and discusses the results.
section surveys the related work and section 6concludes with a summary ofthefindingsandcontributions aswellasanoutlookonfuture researchinthis area.
270on the flysyntaxhighlightingusingneuralnetworks esec fse november14 18 singapore singapore approach the strategy designed to tackle the challenges raised in this paper aims at deriving neural networks nns capable of statistically inferringtheperfectbehaviorofbrute force bf models.forthispurpose anoracleofshsolutionsisgeneratedusingthelanguage sbf resolver.
the following section presents in detail thespecification of both bf and nn models as wellas providing some motivations for the design.
.
oraclesforsyntaxhighlighting brute force bf referstothedeterministicprocessofproducingthe correcttokenclassification orsyntax highlighting sh forsome language derivation fromwhichanabstractsyntax tree ast is derivable.
these are the sole components for the generation of the shoracleand are createdby reusing thelanguage sexisting lexing and parsing tools.
the two components respectively represent the inputsourcecodeasatokenstreamandorderthemintoanast.
subsequently atreewalkerexploitsthestructuralinformationof the ast to assign each token to its sh class.
this process assumes thatabfresolverisguaranteedtocomputethecorrectshofany validinputfile hencesettingthehighestachievablehighlighting accuracyforanycoveragespecification.itisimportanttonotethat suchadesignmerelyrequiresthedevelopertoimplementawalker consistingofonlyahandfulofdetectionrules asreportedinthe replication package .
as a result the process of producing a bf highlighterisdeterministicandonlyasksforabasicunderstanding of the language s grammar as it already exists.
it is a significant departurefromthetediousanderror proneworkflowofdefining systemsorregularexpressions.
thebfalgorithmisintegralinthegenerationofthe oracle i.e.
a collectionoflanguage ssourcecodefilesandrespectivesh.forthis purpose eachsamplefileispipedthroughthelanguage slexerand thentokenized.fromeachtokenanewentityisderivedintheform eta is ie t tr where the extendedtokenannotation eta object is atupleof isandie denotingthetoken s characterstart and end indexes respectively according to the file that contains it t theexacttextthetokenreferences tr thetoken s tokenrule encodedasanaturalnumber orinotherwords the idthelanguage s lexer consistently assigns through a dictionary to tokens of the sametype amongalltypesdefinedinthelexer e.g.
atokenoftext 4mightcorrespondstoalexertype open brace hencetothetoken rule orunique id .forexample s 3a j .
mightresultinthesetofeta s 3a q023 q0 q023 4q2 q2 4q4 j .
and1 42q 2q .
this representation allows the generalization of sh patterns based on the sequence of language features in the form of token types.
it does it byabstractingawaythe otherwise noise injectedbythetokens specific textfeatures transparentto the parsingofthe file.
subsequently the language s parser organizes the tokens into an ast.
walking the ast through patterns such as visitororlistener all previously computed etas are mapped to highlighted extendedtokenannotation heta objects.theseextendetasto includea highlightingclass hc correspondingtothegrammatical sh class to which the token being referenced is part of.
tokens that are not part of any grammatical construction are bounded to the unique hcany representing text i.e.
no highlighting.
as aresultheta is ie t tr hc .
continuing on the above mentioned example the following heta set might be computed as s 3a q02 q3 q0 q02 4q2 q2 4q4 j .
42q 2q wherehcof 0decodestosome nothighlightedtokens qtotypeidentifiers 2tovariabledeclaration identifiers and 3to stringliterals.
a bf resolver for some language lis a function of the form bll c lel ll pl wsl heta where for the lexerencoder lel ll c eta .
llis the lexer of l .
c is the charactersetoftheinputfile .
eta theresultingsetofetas.
for theparserpl ll c astl astlisthe derivedastoftheinput file andforthe walkingstrategy wsl astl eta heta heta isthe oracle for the input s file .
rnnsforsyntaxhighlighting in order to efficiently perform sh for a given file this approach seeks to obtain a neural network nn model capableofmapping a sequence of token rules tr to a sequence of sh classes hc as performedbysomebfresolver.hence theprocessofcomputing sh becomes a statistical inference on the expected grammatical structure ofthe token sequenceininput.
the motivation behind the use of nns for such a task relies onthehighlystructurednatureofprogramminglanguages files.
indeed theflowoftheincomingcharactersis representedas anentitystreamselectedfromafinitesetofterminalsymbols tr and orderedbyanunderlyingpureorderingfunctionasaformal grammar.shcanbeviewedasthegrammarforwhichtherealways existsacorrectlanguagederivationwheneverthereexistsavalid derivationoftheoriginalgrammar.thisistrueasforsomegrammarg its highlighter is the grammar hgthat sequentially parses sub productions shgofg whichareenoughtodiscriminatea trsubsequencetosometargethighlightingconstruction orotherwise mapeverytokennotconsumablebyany shgtoaterminalsymbol.in thisnovelapproachtosh theeffortofproducingsuchshgrammar is lifted from the shoulders of the developers and instead delegated tothennwhichinfersitfromthebehaviorobservedfromsomebf.
the taskof sh isreduced toa sequence to sequence translation task i.e.
from tr to hc .
to tackle this new problem reduction the following proposes the use of recurrent neural networks rnns for the learning of shsequence bindings.
these offer a baseapproach to sequence translationbyiteratingthrougheachvalueoftheinputsequence while outputting aunit of translation and carryingforward differentiallyoptimizedinformationtoaidthepredictionoffutureinputs.
furthermore forthosegrammarsproducingsequencedistributions for which the binding of an hcfor some trmay require the look aheadofanarbitrarynumberoftokens thisapproachresortstothe use of bidirectional recurrent neural networks brnns in place of traditional rnns.
indeed these also aim at addressing this specificissueby behaving astraditionalrnns howeverinferring the translation of each input from the extra information carried fromnavigatingtheinputsequenceinreverse.finally themodelis designedtooutputforeach tr acategoricalprobabilitydistribution overthesetofavailable hc.theabsolutevaluesofsuchdistributions are normalized by a softmaxfunction resulting in the sequence ofhcfor some sequence of trbeing the set of maxvalues of the 271esec fse november14 18 singapore singapore marcoedoardopalma pasqualesalza andharaldc.gall distributioncomputedforeach tr.consequently withregardsto sh an rnnmodel misafunctionofthe form m tr hc .
althoughbasernnsarenolongerthestateoftheartinmany translation applications with current solutions mostly utilizing convolutional layers the encoder decoder architectures or relying on the attention mechanism these still offer a lightweight model compared to more recent techniques.
moreover as it is later shown the number of well formed structural features nn are expected to infer from the sh oracle samples is small.
it means that the extra infrastructure of deeper networks would result in no appreciable sh accuracy increases but rather in computational overheads and non trivial hyperparameter training configurations.
instead rnns and brnns provide a baseline solution for this novel challenge delivering predictions with contained overheads.inaddition thetrainingbehaviorofsuchmodelsallows this approach to maintain a constant training configuration.
not onlydoesitresultinstableperformancesacrossdifferentlanguages andcoveragesettings butalsoinasolutionthatisaccessibletoa broaderaudience ofdevelopers .
experiments theeffectivenessofthisproposedapproachisevaluatedinterms of its prediction accuracy and speed for four types of sh coverage.
moreover in the interest of providing a clearer view on how the performances of this approach might generalize all experiments wereconductedonthreemainstreamprogramminglanguages java kotlin andpython.torepresentthestateofpracticeapproach usingregexes the pygments shlibrary isalsoevaluatedagainst the same metrics.
pygments is highly popular in online and offline scenariosandfoundinanarrayoftoolssuchas gitlab bitbucket andwikipedia .thefollowingresearchquestionsareconsidered for the formalanalysisofthe solution rq1howaccuratelycantheproposednnapproachreplicatethesh behaviourofabfmodel?
thisquestionaimsatevaluating intermsofshaccuracy forall the defined coverage levels to what extent the proposed approach can be asubstituteto pure brute forcemethods.
rq2howdoestheproposednnapproachcomparetonowadaysstate ofpractice orregex approaches?
thisquestionneedsthecomputationoftheshaccuracy forallthe definedcoverage levels to understand to whatextentthe proposed approach can be asubstituteto the state ofpractice.
rq3howdothespeedofcomputationofthethreeapproaches nn bf andregexcompare?
it provides insights into the time delays required when performing sh withthe proposednns regex based andbfapproaches.
rq4howaccuratelycantheproposednnapproachperformshof incompletelanguagederivations comparedtotheregexandbf approaches?
an advantage of both the proposed and regex based approaches is their natural portability to estimate sh schemes for incorrect incomplete sequences of tokens.
hence this question evaluates in terms of accuracy for all the defined coverage levels how these approachescompare to the theoreticalperfectsh solution.
.
coveragetasksdefinition althoughaninfinitenumberofcoverageschemescouldbegenerated and tested for the initial iteration of this novel approach to sh investigates the highlighting of language features as done in themostcommonidesfortheselectedlanguages suchas intellij idea pycharm andvisualstudiocode .
eachcoveragetask t is therefore created by combining one or many of the following language feature groups.
each feature represents a unique hc highlightingclass see section .
or in visual terms acolor.
l 1a thisgroupincludestokenclassesthatarelexicallyidentifiable meaning that for a given token nothing but its trvalue is requiredto binditornot to any of such classes keyword thereby only referring to strong keywords as soft keywords may also be used as user defined identifiers in some allowedlanguagecontexts.inthisclass alsotokensofprimitivetypes e.g.
a areincludedifthelanguageidentifies themas such literal anyliteralvalueofthelanguage e.g.
numbers integers floating binary hexadecimals booleanvalues 3 null constants n char string literal anyuser definedstringorcharacterliterals includingthosepart of stringinterpolation sequences comment.
for this group all classes are assigned using the same criterion that isappliedto allthe selectedprogramming languages.
i a a thegroupincludesclassesforspecialtypesofidentifiers type identifier matching all the identifier tokens within all the languages productions representing atype entity function identifier alltheidentifiersusedinfunctionormethodscalls field identifier referring to those identifiers that the grammars understand being