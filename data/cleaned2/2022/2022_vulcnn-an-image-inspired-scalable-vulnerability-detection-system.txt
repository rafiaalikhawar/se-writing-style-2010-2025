ieee acm 44th international conference onsoftware engineering icse vuicnn animage inspired scalable vulnerability detection system yuerning wu t huazhong university ofscience and technology china wuyueming hust.edu.cn wei yang university oftexas atdallas united states wei.yang utdallas.edudeqing zou h huazhong university ofscience and technology china deqingzou hust.edu.cn duo xu huazhong university ofscience and technology china u201714569 hust.edu.cnshihan dou fudan university china shihandou foxmailcom haijint huazhong university ofscience and technology china hjin hust.edu.cn abstract since deep learning dl can automatically learn features from source code ithasbeen widely used todetect source code vulnerability.
toachieve scalable vulnerability scanning some prior studiesintend toprocess thesource code directly bytreating them as text.
toachieve accurate vulnerability detection other approaches consider distilling theprogram semantics into graph representations andusing them todetect vulnerability.
inpractice text based techniques arescalable butnotaccurate duetothelack ofprogram semantics.
graph based methods areaccurate butnotscalable since graph analysis istypically time consuming.
inthispaper weaimtoachieve both scalability andaccuracy on scanning large scale source code vulnerabilities.
inspired byexistingdl based image classification which hastheability toanalyze millions ofimages accurately weprefer tousethese techniques toaccomplish ourpurpose.
specifically wepropose anovel idea that canefficiently convert thesource code ofafunction into an image while preserving theprogram details.
weimplement vulcnn andevaluate itonadataset of13 vulnerable functions and non vulnerable functions.
experimental results report that vulcnn canachieve better accuracy than eight state of the art vulnerability detectors i.e.
checkmarx flawfinder rats tokencnn vuldeepecker sysevr vuldeelocator anddevign .
asforscalability vulcnn isabout four times faster than vuldeepecker and sysevr about 15times faster than vuldeelocator andabout sixtimes faster than devign.
furthermore weconduct acase study onmore than hubei engineering research center onbigdata security school ofcyber science and engineering hust wuhan china tnational engineering research center forbigdata technology andsystem services computing technology and system lab hust wuhan china t corresponding author cluster andgrid computing lab school ofcomputer science andtechnology hust wuhan china permission tomake digital orhard copies ofallorpart ofthis work forpersonal or classroom useisgranted without feeprovided that copies arenotmade ordistributed forprofit orcommercial advantage andthat copies bear this notice andthefullcitation onthefirst page.
copyrights forcomponents ofthiswork owned byothers than acm must behonored.
abstracting with credit ispermitted.
tocopy otherwise orrepublish topost onservers ortoredistribute tolists requires prior specific permission and or a fee.request permissions from permissions acm.org.
lese .may .
pittsburgh.
pa usa association forcomputing machinery.
acm isbn ... .
236525million lines ofcode andtheresult indicates that vulcnn can detect large scale vulnerability.
through thescanning reports we finally discover 73vulnerabilities that arenotreported innvd.
ccs concepts security and privacy 7vulnerability scanners.
keywords vulnerability detection cnn large scale image acm reference format yueming wu deqing zou shihan dou wei yang duo xu and haijin.
.
vuicnn animage inspired scalable vulnerability detection system.
in44th international conference onsoftware engineering icse may pittsburgh pa usa.
acm new york ny usa 12pages.
https 1introduction recently various cyberspace security incidents such as hacker extortion botnet attacks and user information leakage have occurred frequently.
asanimportant part ofcyberspace vulnerabilities insoftware systems have brought serious security threats tocyberspace.
in2020 synopsys open source security and risk analysis ossra examined audit data from commercial code bases and revealed that ofthecode inthese codebases were open source.
moreover ofthese open source codebases contained open source security vulnerabilities and nearly half contained high risk vulnerabilities .therefore itisurgent tocarry outlarge scale and intelligent software vulnerabilities detection methods tobetter protect software security.
ingeneral source code vulnerability detection methods canbe divided into twomain categories that is thecode similarity based methods andthepattern based methods .
vulnerability detection methods based oncode similarity aremainly used todetect vulnerabilities caused bycode cloning.
when used todetect vulnerabilities notcaused bycode cloning itwill lead toahigh false negative rate .
traditional pattern based vulnerability detection methods rely on experts tomanually define vulnerability rules orcharacteristics to describe vulnerabilities.
these approaches arenotonly subjective butalso difficult toachieve alowfalse positive rate andalowfalse negative rate atthesame time .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa lnrecent years due totheautomatic feature extraction of deep learning dl ithasbeen widely used todetect source code vulnerability.
these dl based techniques belong tothe second category ofmethods i.e.
pattern based methods .
they donotrequire experts tomanually define features andcanautomatically generate vulnerability patterns.
forexample some prior studies treat theprogram source code astext andapply techniques inthefield ofnatural language processing to detect vulnerability.
the detection performance ofthese text based methods isnotideal since they ignore theprogram semantics of source code.
toaddress theissue researchers conduct program analysis todistill theprogram semantics ofsource code into a graph representation andperform graph analysis e.g.
graph neural network todetect vulnerability.
these graph based techniques can achieve higher effectiveness ondetecting vulnerability however their scalability ismuch worse than text based methods.
in addition almost allthese methods only focus onlabeling afunction aseither vulnerable ornot andcannot pinpoint which lines ofcode may bemore likely tobevulnerable.
lnthis paper weaim toachieve accuracy and scalability simultaneously ondetecting vulnerabilities from large scale source code.
our keyidea isderived from dl based image classification which can process millions ofimages while maintaining high accuracy and theclassification results can beinterpreted by visualization techniques.
specifically wemainly address onemajor challenge inourpaper.
how toefficiently convert thesource code ofafunction into an image while preserving theprogram details?
totackle thechallenge wefirst conduct program analysis todistill theprogram semantics ofafunction into aprogram dependency graph pdg which contains both control flow anddataflow details ofsource code.
after obtaining thepdg ofafunction wetreat itasasocial network and apply centrality analysis on thenetwork toattach thegraph structural information toeach lineofcode.
insocial network analysis centrality analysis hasbeen proposed tomeasure theimportance ofanode within thenetwork.
specifically weleverage three different centralities i.e.
degree centrality katz centrality and closeness centrality tocommence ourimage transformation.
there aretwo main reasons forusing three centralities.
first different centralities canmaintain thegraph properties from different aspects .
second animage generally hasthree channels i.e.
red green and blue and they work together toproduce acomplete image.
the output ofcentrality analysis isanimage while preserving the graph details from three aspects.
given generated images wethen train aconvolutional neural network cnn model and useittodetect vulnerability.
topinpoint thevulnerable lines of code inafunction weuseadeep visualization technique i.e.
class activation map onourimages toobtain thecorresponding heatmaps these heatrnaps canhelp security analysts understand why thefunction islabeled asavulnerability.
weimplement vulcnn and evaluate itonadataset of40 functions which consists of13 vulnerable functions and26 non vulnerable functions.
evaluation results show that vulcnn can achieve better effectiveness than eight comparative vulnerability detectors i.e.
checkmarx flawfinder rats tokencnnyueming wu deqing zou shihan dou wei yang duo xu and haijin vuldeepecker sysevr vuldeelocator and devign .
furthermore vulcnn ismore than sixtimes faster than another state of the art graph based vulnerability detection tool i.e.
devign .
tovalidate theability ofvulcnn onlarge scale vulnerability scanning weconduct acase study onmore than million lines ofcode.
through thescarming reports wefinally discover 73vulnerabilities that arenotreported innvd.
among them 17have been silently patched byvendors inthelatest version ofcorresponding products four vulnerabilities have been deleted andtheother 52stillexist intheproducts.
wehave reported these vulnerabilities totheir vendors andhope that they canbe patched assoon aspossible.
insummary thispaper makes thefollowing contributions wepropose anovel idea that can efficiently convert the source code ofafunction into animage while preserving the program details.
wedesign andimplement aprototype system vuicnn1 a scalable graph based vulnerability detection system.
weconduct evaluations onadataset of13 vulnerable functions and26 non vulnerable functions.
experimental results report that vulcnn issuperior toeight state ofthe art vulnerability detectors i.e.
checkmarx flawfinder rats tokencnn vuldeepecker sysevr vuldeelocator and devign .
weconduct acase study onmore than 25million lines ofcode tovalidate theability ofvulcnn onlarge scale vulnerability scanning.
through thescanning results we discover 73vulnerabilities that arenotreported innvd.
paper organization.
the remainder ofthepaper isorganized as follows.
section 2presents themotivation ofourpaper.
section introduces oursystem.
section 4reports theexperimental results.
section 5discusses thefuture work.
section 6describes therelated work.
section 7concludes thepresent paper.
2motivation weallknow that afunction consists ofmultiple lines ofcode which together implement theprogram semantics i.e.
functionality of thefunction.
however thesemantic contribution ofdifferent lines ofcode isdifferent.
forexample some code isjustasimple variable definition while some code implements thecore algorithm of thefunction.
obviously thelatter contributes more semantics.
therefore weraise aquestion how tofind outthecontribution of different lines ofcode inthefunction totheprogram semantics?
toanswer it weselect abuffer overflow vulnerability function asourexample.
tomaintain theprogram semantics weconsider extracting both control flow and data flow details bystatic analysis.
specifically weleverage joern toobtain theprogram dependency graph pdg ofthevulnerability infigure .each node inthepdg corresponds toalineofcode inthevulnerability.
red lines and blue lines show thedata flows and control flows between different lines ofcode inthefunction respectively.
to simply display thepdg ofthevulnerability wereplace each line ofcode with anumbered circular node.
eight lines ofcode inthe function correspond toeight circular nodes asshown infigure .
ingraph theory anadjacency matrix isasquare matrix used to ihttps llgithub.com cgcl codeslvulcnn authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
vuicnn an image inspired scalable vulnerability detection system lese may pittsburgh pa usa figure the program dependency graph pdg and corresponding adjacency matrix ofavulnerability represent afinite graph .therefore torepresent thepdg ofthe vulnerability wecompute thecorresponding adjacency matrix and describe itinfigure .theelements ofthematrix indicate whether pairs ofnodes areadjacent ornotinthegraph.
since ourpdg isa directed graph anelement represents thenumber ofdirected edges between two different nodes.
forexample node 3hastwo edges pointing tonode while node 4hasnoedges pointing tonode .
therefore thecorresponding values between node 3andnode 4in thematrix aretwo andzero respectively.
after obtaining theadjacency matrix ofthepdg wefind that when wesum arow inthematrix thevalue obtained corresponds totheout degree ofthenode.
moreover when wesum acolumn thevalue obtained isthein degree ofthenode.
forexample the sum oftherow ofnode 4isthree i.e.
which indicates thattheout degree ofnode 4isthree.
tobetter illustrate ourinsight wepresent thein degrees out degrees anddegrees ofalllines of code ofthevulnerability infigure .through theresults infigure wefind that thedegrees ofdifferent lines ofcode arebasically different.
itisreasonable because there aredifferent relationshipsdegreeout diin idi egreeegree bar lat i .
to estr i i i void bado inthis section weintroduce vuicnn anovel andefficient source code vulnerability detection system.
.
overview asshown infigure vulcnn consists offour main phases graph extraction sentence embedding image generation and classification.
graph extraction given thesource code ofafunction wefirst normalize them andthen perform static analysis to extract theprogram dependency graph ofthefunction.
sentence embedding each node intheprogram dependency graph corresponds toaline ofcode inthefunction.
weregard alineofcode asasentence andembed them into avector.
image generation after sentence embedding weapply centrality analysis toobtain theimportance ofalllines of3systemfigure the in degrees out degrees and degrees ofalllines ofcode infigure i.e.
control flows anddata flows between different lines ofcode andthevulnerability istriggered based onthese relationships.
ifwe directly process these codes bytreating them astext thedegrees ofalllines ofcode areone which may decrease thevulnerability detection accuracy.
inoneword agraph canberepresented byitsadjacency matrix thematrix can bedescribed bydegrees ofallnodes.
therefore computing thedegrees ofcode inafunction may beagreat candidate toretain thegraph details.
inpractice thedegree of anode inagraph isoriginally used toquantify itsimportance.
it hasbeen widely used insocial network analysis .
thehigher the degree themore important theperson.
meanwhile different lines of code have different degrees.
ifwetreat each lineofcode asaperson thecontrol flow anddata flow relationships asthecommunications between persons then thecorresponding pdg canberegarded as asocial network.
the higher thedegree ofaperson themore other persons communicated with him andthegreater hisimportance within thepdg social network.
therefore wecanleverage the importance ofalineofcode asaform ofthecontribution ofprogram semantics.
inother words themore important alineofcode is the more itmay contribute toimplementing theprogram semantics i.e.
functionality ofthefunction.
based ontheobservation we design vulcnn byanalyzing theimportance ofalllines ofcode.
0out degree in3 adjacency matrixsource code char data char databuffer data databuffer data badsource data char dest stmcat dest data strlen data dest printline data void bado authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
lese may pittsburgh pa usa yueming wu deqing zou shihan dou wei yang duo xu and haijin figure system overview ofvulcnn figure steps ofsource code normalization invulcnncode and multiply them bythevectors one byone.
the output ofthisphase isanimage.
classification our final phase focuses onclassification.
given generated images wefirst train acnn model and then useittodetect vulnerability.
xi a aijxj f3 jdeg i x z n l note that deg i isthedegree ofnode i. katz centrality computes thecentrality foranode based onthecentrality ofitsneighbors.
the katz centrality fornode iisfigure 4shows thedetailed transformations ofafunction at varying normalization levels.
stepl remove thecomments inthesource code because they have nothing todowith program semantics.
step2 map user defined variables tosymbolic names ina one to one manner e.g.
varl .
step3 map user defined functions tosymbolic names ina one to one manner e.g.
funl .
after abstracting thesource code wethen leverage anopensource code analysis platform forc c joern toextract theprogram dependency graph pdg ofthefunction.
pdg isa graph representation that contains both data flow andcontrol flow details ofthesource code.
each node inapdg corresponds toa line ofcode inthefunction.
wetreat aline ofcode asasentence andapply sentence embedding totransform itinto afixed length vector.
specifically wemake useofawidely used method i.e.
sent2vec tocomplete oursentence embedding.
itadopts a simple butefficient unsupervised objective totrain distributed representations ofsentences.
using thesent2vec model wecan transform alineofcode into itscorresponding vector representation whose dimension is128inourpaper.
tobetter illustrate thedetailed steps involved inourproposed method weprovide anexample infigure .redlines andblue lines infigure 5represent data flows andcontrol flows between different lines ofcode inafunction respectively.
.
image generation after graph extraction and sentence embedding wecanobtain a new pdg where each node isavector representation.
inthisphase weaim toefficiently convert thenew pdg into animage while considering thecontributions ofdifferent lines ofcode toprogram semantics.
tocomplete ourpurpose weregard thenew pdg as asocial network and apply social network centrality analysis to obtain theimportance ofalllines ofcode.
centrality concepts were first developed insocial network analysis whose original purpose istomeasure theimportance ofanode inthenetwork.
centrality analysis has been used inmany different areas e.g.
biological network and transportation network these successful applications have validated theeffectiveness ofnetwork analysis.
infact there have been proposed many different types ofcentrality toquantify theimportance ofanode inanetwork from different aspects forexample degree centrality ofanode isthefraction ofnodes it isconnected to.the degree centrality values arenormalized bydividing bythemaximum possible degree inagraph n l where nisthenumber ofnodes inthegraph.stepl remove commentsimage generationsentence embeddinggraph extraction input source code ofafllllction void bado void badochar data char databuffer char i data data databuffer char databuffer data badsource data data databuffer data badsource data char dest f potential flaw possible buffer overflow ifdata islarger thanchar dest stmcat dest data strlen data sizeof dest strlen dest idest stmcat dest data strlen data dest printline data printline data step2 map user defined variables step3 map user defined functions void bado void funio char varl char varl char var2 char var2 varl var2 var1 var2 vari badsource v arl vari fun2 v arl char var3 char var3 stmcat var3 varl stmcat v ar3 varl strlen v arl strlen var1 var3 var3 printline v arl fun3 var1 .
graph extraction and sentence embedding vulcnn aims toachieve accuracy and scalability simultaneously ondetecting vulnerabilities therefore wefirst apply static analysis todistill theprogram semantics ofsource code into agraph representation.
due tothecoarse granularity offile level vulnerability detection wefocus ondetecting vulnerability atamore fine grained level i.e.
function level since afunction canalso implement aspecific task.
before extracting thegraph representation ofafunction wefirst abstract and normalize thesource code.
particularly we usethree levels ofnormalization which make vulcnn resilient to common code modifications while preserving program semantics.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
vuicnn animage inspired scalable vulnerability detection system lese may pittsburgh pa usa input nonnalized source code i 1void funio char varl charvar2 vari var2 vari fun2 vari lcharvar3 strncat var3 varl strlen vari var3 fun3 vari i source codegraph extraction original program dependency graphsentence embedding new program dependency graphimage generation degree degree centrali vectorj .
vector2 .
vector .
vector4 .
vector5 .
vector6 .
vector7 .
vectors .
katz centrality closeness centrality r. output animage image figure anexample toillustrate how toconvert thesource code ofafunction into animage note that aistheadjacency matrix ofthegraph gwith eigenvalues a.theparameter f3controls theinitial centrality and 1a am ax katz centrality computes therelative influence ofanode within agraph bymeasuring thenumber oftheimmediate neighbors first degree nodes andalsoallother nodes inthe graph that connect tothenode under consideration through these immediate neighbors.
closeness centrality indicates how close anode isto allother nodes inthenetwork.
itiscalculated astheaverage oftheshortest path length from thenode toevery other node inthegraph.
the smaller theaverage shortest distance ofanode thegreater thecloseness centrality ofthenode.
n 1x l iij d i j note that d i j isthedistance between nodes iand j and nisthenumber ofnodes inthegraph.
because animage generally hasthree channels i.e.
red green andblue andthey work together toproduce acomplete image.
we select three different centralities i.e.
degree centrality katz centrality and closeness centrality tocorrespond tothe three channels.
these three centralities cancompute theimportance ofalllines ofcode inafunction from three different aspects.
bythis wecanachieve complete consideration ofdifferent lines ofcode s contribution toafunction s program semantics.
algorithm 1shows theentire process ofvulcnn ofhow toconvert afunction into animage.
asshown infigure 5andalgorithm wefirst perform degree centrality analysis onallnodes inthenew pdg tocollect thedegree centralities ofallnodes i.e.
vectors .
allvectors are then arranged onebyoneaccording tothenumber oflines ofcode after multiplying bythecorresponding degree centrality.
wecall these arranged new vectors the degree charmel .
similarly after applying katz centrality and closeness centrality analysis onthe new pdg wecanobtain theother two channels which are katz channel and closeness channel .
finally these three channels are used toproduce animage.
2369algorithm 1converting thesource code ofafunction into an image input f source code ofafunction output i animage.
i nff codenormalization f pdg f graphextraction nf vf obtainnodes pdg foreach vevdo vector f sentenceembedding v degreecentrality f degreecentralityanalysis vector pdg degreechannel.add degreecentrality vector katzcentrality f katzcentralityanalysis vector pdg katzchannel.add katzcentrality vector closenesscentrality f closenesscentralityanalysis vector pdg closenesschannel.add closenesscentrality vector endfor if imagegeneration degreechannel katzchannel closenesschannel return i inbrief theinput ofimage generation phase isanew pdg where each node isanembedded vector andtheoutput isanimage with theimportances ofalllines ofcode.
.
classification deep learning isacomplex machine learning algorithm thathas achieved results inmany areas e.g.
speech andimage recognition farbeyond previous related technologies.
the advantage ofdeep learning istouseunsupervised orsemi supervised feature learning andefficient hierarchical feature extraction algorithms toreplace manual feature acquisition.
inthe field ofimage processing convolutional neural network cnn hasbeen thefocus since itnotonly does notrequire manual image preprocessing but also canuseitsunique fine grained feature extraction toreach a level close tohumans.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
lese may pittsburgh pa usa yueming wu deqing zou shihan dou wei yang duo xu and haijin .
u s0 0o thetotal number oflines ofcode ofafunctionanimage 10010region sizes 32mers foreach region size totally mers vulnerable arnot fully max pool connected layer figure the cumulative distribution function cdf ofthe total number oflines ofcode inafunction after image generation phase thesource code ofafunction isconverted into animage.
given animage weintend totrain acnn model first and then useittodetect vulnerability.
since cnn takes equal size images asinput while thenumber oflines ofcode indifferent functions isdifferent weneed tomake an adjustment.
tofind amore suitable threshold toproduce fixed size images weselect ourexperimental dataset insection i.e.
functions asthetestobject andrecord thenumber oflines ofcode ofallthese functions.
figure 6shows thecumulative distribution function cdf ofthenumber oflines ofcode inthese functions.
from theresults infigure itcan beobserved that more than ofthefunctions have lessthan 200lines ofcode.
inreality we have experimented with different thresholds i.e.
lines of code ondetecting vulnerability.
considering thedetection accuracy andcorresponding runtime overhead2 wefinally choose 100lines ofcode asthethreshold togenerate ourinput images.
when the number oflines ofcode inafunction islessthan wepadzeros totheend ofthevectors.
when afunction has more than lines ofcode wedelete theending part ofvectors.
the sizeofthe image weinputis where 3corresponds tothree channels i.e.
degree channel katz channel and closeness channel corresponds tothethreshold ofcode lines and 128represents the dimension ofasentence vector.figure cnn classification ofvulcnn after generating fixed size images wethen train acnn model using these images.
asshown infigure weuse different convolution filters with ashape ofm sothat each filter can span theentire space ofthesentence embedding.
the filter size m determines thenumber ofsequential sentences considered together.
invuicnn weselect 10filter sizes i.e.
1to10 andeach sizehas32 feature maps toextract thefeatures ofdifferent parts oftheimage.
after max pooling thelength ofourfully counected layer is320.
the descriptions ofparameters used invulcnn areillustrated in table .the whole model uses rectified linear units i.e.
relu asthenon linear activation function.
moreover theloss function used inourcnn topenalize theincorrect classification iscrossentropy loss.
wetrain thecnn using adam with alearning rate of0.
.
after obtaining atrained cnn model wethen useit toflagnew functions aseither vulnerable ornot.
tointerpret thedetection results weleverage gradient weighted class activation mapping grad cam asour visualization technique topinpoint thevulnerable lines ofcode.
grad cam isaclass discriminative localization technique that generates visual explanations foranycnn based network without changing thearchitecture orretraining.
according totheintensity ofthecolor intheheatmap wecanknow which lines ofcode may bemore likely tobevulnerable.
4experiments table parameter settings invulcnn parameters loss function activation function optimizer batch size learning rate epochnum 2more details areinsection .
.settings cross entropy loss relu adam .
100inthissection weaimtoanswer thefollowing research questions rql what isthedetection performance ofvulcnn when detecting source code vulnerability?
rq2 what istheruntime overhead ofvulcnn when detecting source code vulnerability?
rq3 can vulcnn achieve large scale vulnerability scanning?
.
experiment settings wefirst collect adataset from software assurance reference dataset sard which isaproject maintained bynational institute ofstandards and technology nist .sard contains alarge number ofproduction synthetic and academic security flaws or authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
vuicnn animage inspired scalable vulnerability detection system lese may pittsburgh pa usa accuracy tnr i o .
tpr90 t .
r r d ch ec km a rx flawfinder d rats dtokencnnc j vuldeepecker sysevr gzj vuldeelocator devign iiiivulcnn .vuicnn wcql iiie.g70 e ql50 weseethat thethreshold ispositively correlated with detection accuracy thelarger thethreshold thehigher theaccuracy.
however when thethreshold reaches lines thegrowth ofaccuracy becomes small.
ontheonehand since thedetection accuracy of vulcnn with 100lines ofcode isalmost thehighest.
ontheother hand thegreater thethreshold thelarger theimage andthemore thememory required.
therefore weselect 100lines ofcode asour final threshold togenerate theinput images.
wethen compare vulcnn with several vulnerability detection tools including onecommercial static vulnerability detection tool i.e.
checkmarx two open source static analysis tools i.e.
flawfinder andrats andfivedeep learning based vulnerability detection approaches i.e.
tokencnn3 vuldeepecker sysevr vuldeelocator anddevign .vulnerabilities i.e.
badfunctions andmany good functions.
inour paper wefocus ondetecting vulnerability inc c therefore we only select functions written inc c insard.
data obtained from sard consists of12 vulnerable functions and non vulnerable functions.
moreover since thesynthetic programs insard may not berealistic wecollect another dataset from real world software.
forreal world vulnerabilities weconsider national vulnerability database nvd asour collection source.
wefinally obtain vulnerable functions that belong to different open source software written inc c .
forreal world non vulnerable functions werandomly select apart ofthedataset in which contains non vulnerable functions from several opensource projects.
our final dataset consists of13 vulnerable functions and26 non vulnerable functions.
four phases i.e.
graph extraction sentence embedding image generation and classification invulcnn areimplemented by using joern sent2vec networkx andpytorch respectively werunallexperiments onaserver with 16cores of cpu andagtx 1080ti gpu.
fordataset wefirst randomly divide itinto tensubsets then theseven subsets areused totrain acnn model theother two subsets areused tovalidate and thefinal subset isused totest.
the metrics used tomeasure theeffectiveness ofvulcnn arethesame asothers .forexample true positive tp reports thenumber offunctions that arecorrectly classified asvulnerable and true negative tn shows thenumber offunctions that arecorrectly detected asnon vulnerable.
.
detection performance figure the detection performance ofvulcnn with different thresholds toconstruct animage wefirst present thedetection performance ofvulcnn under different thresholds i.e.
thenumber oflines ofcode toproduce our images .
because more than ofthefunctions infigure 6have lessthan 200lines ofcode wefocus onthethresholds below lines.
specifically weselect atotal of10thresholds i.e.
200lines tocommence ourevaluations.
the experimental results arepresented infigure through theresults the number oflines ofcode togenerate animagefigure true positive rate tpr true negative rate tnr and accuracy ofcheckmarx flawfinder rats tokencnn vuldeepecker sysevr vuldeelocator devign and vulcnn ondetecting vulnerability 3por more convenient discussion wecallthemethod tokencnn since ittakes tokens asinput and detects vulnerability bytraining acnn model.asforthecommercial tool i.e.
checkmarx and two opensource static analysis tools i.e.
flawfinder andrats thedetection performance infigure 9shows that their true positive rates tprs and true negative rates tnrs arenotideal.
forexample thetpr ofcheckmarx isonly .
which means that checkmarx canonly detect .
ofvulnerabilities inourlabeled dataset.
such results arereasonable because these tools depend onrules orpatterns defined byhuman experts.
inpractice there aredifferent types ofvulnerabilities and thepatterns ofeach type aredifferent.
in other words experts cannotdefine allpatterns ofallvulnerabilities resulting inpoor detection performance.
asfortokencnn itfirst conducts lexical analysis totransform thesource code into atoken sequence and then embeds them into fixed length vector representations.
finally these vectors are fedinto aconvolutional neural network cnn model totrain avulnerability detector.
since itdoes notconsider any program semantics itperforms worse than vuicnn.
asforvuldeepecker and sysevr they both collect code gadgets byslicing programs andthen transform them into corresponding vector representations.
finally these vectors areused totrain abidirectional recurrent neural100 60i !
i j authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
lese may pittsburgh pa usa yueming wu deqing zou shihan dou wei yang duo xu and haijin figure the visualization ofadetected buffer overflow vulnerability furthermore since vulcnn isanimage based vulnerability detection system wecaninterpret thedetection results byusing cnn visualization techniques.
lnthis paper wetake gradientweighted class activation mapping grad cam asan example tovisualize ourdetection results.
figure 10shows thenetwork brnn model todetect vulnerability.
the difference between these two systems isthat vuldeepecker only conducts data flow analysis toslice programs while sysevr considers both control flow anddata flow toobtain theprogram slices.
obviously sysevr performs better than vuldeepecker because itcontains more program semantics.
however they donotconsider thedifferent contributions ofdifferent lines ofcode totheprogram semantics buttreat alllines ofcode inaslice astext and directly apply brnn totrain avulnerability detector.
this isthereason why they detect lessvulnerability than vuicnn.
asforvuldeelocator itfirst compiles aprogram toallvm bitcode fileand then extracts intermediate representation ir slices toretain theprogram semantics.
finally these irslices areused todetect vulnerability bytraining abrnn model since ircontains more program details than source code vuldeelocator can distinguish more vulnerability than vuldeepecker and sysevr.
however similar to vuldeepecker andsysevr vuldeelocator also treat theslices astext resulting lower performance than vuicnn.
asfordevign itfirst applies complex program analysis toextract agraph representation that contains comprehensive program semantics and then uses a general graph neural network todetect vulnerability.
the detection performance ofdevign isalmost the same asthat ofvuicnn.
however duetothecomplexity ofthegenerated graph itcannot beextended tolarge scale vulnerability scarming.
but vulcnn can because ituses centrality analysis toconvert time consuming graphic analysis into efficient image scanning.
tocheck whether theuseofcentrality analysis contributes tovulcnn ondetecting vulnerability ornot weconstruct another experiment.
more specifically after sentence embedding we directly feed thesentence vectors into acnn model totrain a classifier without multiplying bythecentrality.
wecallthemethod asvuicnn wc i.e.
vulcnn without centrality and show the experiment result infigure .through thefigure wecan see that vulcnn issuperior tovuicnn wc which indicates that the consideration ofcentrality ofdifferent lines ofcode inafunction canimprove thedetection accuracy onvulnerability detection.
.
.
graph extraction.
given thesource code ofafunction the first step ofvulcnn istoextract thepdg ofit.figure 11presents theruntime overheads ofgraph extraction onourdataset inwhich more than functions can beobtained thegraphs inthree seconds.
onaverage ittakes .
seconds toconstruct apdg ofa function.
.
.
sentence embedding.
the second stepofvulcnn istoembed alllines ofcode into corresponding fixed length vectors.
asshown infigure thisphase isvery fast itonly requires about .
seconds tocomplete thesentence embedding ofapdg.
.
.
classification.
the final step ofvulcnn istodetect vulnerability using atrained cnn model cnn classification isthefastest ofallphases invuicnn itonly consumes about 41microseconds tocomplete theclassification ofanimage.
inaddition wealsocompare thescalability ofvulcnn with other comparative systems.
weexclude thecomparison ofcheckmarx flawfinder and rats since they arenot deep learning based methods and perform worse than theother five deep iearningbased approaches.
figure 12shows theaverage runtime overheads oftokencnn vuldeepecker sysevr vuldeelocator devign and vuicnn.
asfortokencnn because itonly applies simple lexical analysis toobtain thesource code tokens and uses acnn model todetect vulnerability itisthefastest.
onaverage itonly takes .
seconds tofinish theanalysis ofafunction inourdataset.
as forvuldeepecker and sysevr their slice generation phase needs toextract thecontrol flow graph cfg program dependency graph pdg andfunction callgraph fcg resulting inlower scalability than vuicnn.
asforvuldeelocator asitisallvm ir based vulnerability detection system thesource code needs tobecompiled first.
the compilation phase consumes lots oftime making it difficult todetect vulnerability onalarge scale.
asfordevign it4.
runtime overhead inthissection weperform acomprehensive evaluation onruntime overhead ofvulcnn byusing our40 functions i.e.
vulnerable functions and non vulnerable functions .
given anew function vulcnn consists offour main steps tocomplete theclassification graph extraction sentence embedding image generation and classification.
.
.
image generation.
after embedding alllines ofcode into vector representations the third step ofvulcnn istoapply centrality analysis totransform thenew pdg into animage.
figure 11presents theruntime overheads ofvulcnn inthis step.
more than pdgs areable tobeconverted into images inonesecond and theaverage runtime overhead ofthis phase is0.
seconds.
such result indicates that vulcnn canefficiently transform apdg into animage.visualization ofadetected buffer overflow vulnerability.
this vulnerability canbetriggered when data islarger than sizeof dest strlen dest .
inthiscase theterminal null will bewritten outside the buffer.
through figure weseethat thecolor ofcode strncat dest data strlen data isthereddest which means that thislineofcode ismore likely tobevulnerable code.
this result is inlinewith expectations.
generated heatmap source code authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
vuicnn animage inspired scalable vulnerability detection system lese may pittsburgh pa usa .
!
!
!
!
.
!
!
!
!
.
.
.
.1v o.o i .j .
.
.
.
overhead ofcnn classification s .
o.g1 i m n .
sei ond .
.7i !
.
!
u. .
t t !
.
1i j .
i ii ii h0.
i i i .
.
.
.
.
.
.
.
.
.
.
.
o rhead ofimsge generation s !
!
!
!
!
!
!
!
!
!
!
.
.. i .
.
.
.
.
.
overhead of5en enoe embedding s .
i i i .j .
t t .
r ... ... .... .
o.g i i i mean .89e ll4 sec nds .
.
.
.
.
t i ji o12345678g overhead ofgraph extraction s .
j i i u. .
!
c i w80.51 i .
!
!
.
!
!
!
!
figure the cumulative distribution function cdf ofruntime overheads ofvulcnn ondifferent phases seconds table summary ofourtested open source software iii 0c iii..c 15o ll .g o .
i i figure comparative runtime overheads oftokencnn vuldeepecker sysevr vuldeelocator devign and vulcnn combines different code representations i.e.
abstract syntactic tree ast control flow graph cfg data flow graph dfg and natural code sequence nsc toachieve accurate vulnerability analysis.
due totheheavy weight extraction ofthese code representations devign consumes more runtime than vulcnn insummary although vulcnn isnotasscalable astokencnn itisabout four times faster than vuldeepecker and sysevr about 15times faster than vuldeelocator andabout sixtimes faster than devign.
.
case study the original goal ofourpaper istoachieve accuracy andscalability simultaneously ondetecting vulnerabilities from large scale source code.
therefore inthis subsection weconduct acase study to examine theability ofvulcnn onreal world large scale vulnerability detection.
weselect three widely used open source products asourtest objects libav xen and seamonkey .
the versions ofthese products include both several oldversions andthe latest version.
bythis wecanreport whether vulnerabilities inold versions have been silently patched inthelatest version ornot.opensource software files functions lines ofcode libav .
.
libav .
libav .
libav .
xen .
.
xen .
.
xen .
.
seamonkey .
seamonkey .
.
total table 2presents thesummary ofourcollected products thetotal number offunctions that canbesuccessfully analyzed byjoern inthese products is600 .
inother words vulcnn analyzes a total of600 functions with atotal ofmore than 25million lines ofcode.
due toalarge amount ofthese codes weadopt parallel processing toanalyze them.
specifically weprocess tenfunctions atatime.
the total processing runtime overheads arepresented in figure itcanbeobserved that themost time consuming phase is toextract thepdg offunctions thisphase occupies more than ofthetotal processing runtime.
after generating thepdgs ofthese 600thousand functions wecantransform them into corresponding images inabout 253minutes.
such high efficiency indicates that vulcnn hastheability toscan large scale source code todiscover new vulnerabilities.
lnpractice our scanning results arealso encouraging since wediscover 73vulnerabilities.
specifically wefirst train acnn model using ourcollected labeled functions including vulnerable functions and26 non vulnerable functions.
then the generated images from more than 25million lines ofcode intable 2arefedinto thetrained cnn model after collecting all warnings reported byvuicnn wethen conduct manual analysis tocompare them with our collected real vulnerabilities one by one.ifthetwo arefound tobelong tothesame pattern itwill be judged tobeareal vulnerability.
the analysis result shows that 73warnings correspond topatterns ofknown vulnerabilities in authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa yueming wu deqing zou shihan dou wei yang duo xu and haijin table 26vulnerabilities discovered byvulcnn from thelatest versions ofour selected products target product cveid vulnerable product reported vulnerability release date vulnerable fileinthetarget product cve ffmpeg libavcodec!vorbis.c cve ffmpeg libavcodec!
alsdec.c cve ffmpeg libavcodec!
alac.c cve ffmpeg libavcodec!
aacsbr.c libav .
cve ffmpeg libavcodec!
sanm.c cve ffmpeg libavcodec jpeg2000dwt.c cve ffmpeg libavformaumms.c cve ffmpeg libavformau asfdec.c cve firefox ... base nsdocshell.cpp cve firefox seamonkey ... generic!hypertextaccessib le.cpp cve firefox seamonkey ... generic!
accessible.cpp cve firefox ... lib vorbis analysis.c cve firefox ...!cxxltestcrashcleanup.cpp cve firefox ... c.xx testinterrupterrorcleanup.cpp cve firefox thunderbird seamonkey ... pingsender pingsender win.cpp cve freetype ...lmac!ftmac.c seamonkey .
.
cve freetype ...llzw ftlzw.c cve freetype ...lbzip2 ftbzip2.c cve bzip2 ...lsrc!decompress.c cve bzip2 ...lbzip2 .
.6jbzip2recover.c cve bzip2 ...lbzip2 .
.
decompress.c cve firefox thunderbird ...lxsltitxmozillatextoutput.cpp cve firefox ...lwidgeunsdragserviceproxy.cpp cve qemu ...1scsi!
scsi disk.c xen .
.0cve qemu ...lhw stellaris enet.c cve qemu ...lhw ne2000.c .
gj .
.
.
1j1000 .
e600 e .
.
graph sentence image cnn total extraction embedding generation classification figure the total runtime overheads ofvulcnn on processing more than 25million lines ofcode nvd.
among these detected vulnerabilities 17ofthem have been silently patched byvendors inthelatest version ofcorresponding products codes offour vulnerabilities have been deleted andthe other 52ofthem stillexist intheproducts.
wehave reported these vulnerabilities totheir vendors andhope that they canrelease a patched version assoon aspossible.due tothelimited page weshow thedetection results onold versions ofproducts inourwebsite4and only present theresults i.e.
table onthree newest versions inthissubsection.
thedetails ofourdiscovered vulnerabilities include thecorresponding eve idinnvd vulnerable products reported innvd therelease data innvd and thevulnerable fileinthetarget product.
from six oldversions ofourselected products wedetect 47vulnerabilities.
from three latest versions ofthese products vulcnn discovers vulnerabilities.
5discussion .
threats tovalidity labeled functions insard arefrom synthetic programs.
these synthetic functions may notberepresentative oftheentire programs.
tomitigate thethreat weaddsome real world vulnerabilities from nvd and non vulnerable functions from open source products into ourdataset.
the selection ofthemaximum number oflines ofafunction toproduce anequal size image may cause some inaccuracies.
wemitigate thethreat byresearching thenumber oflines ofcode formore than functions tofind abetter 4https 11github.com cgcl codeslvulcnn authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
vuicnn animage inspired scalable vulnerability detection system threshold.
also inaccuracies indetecting vulnerabilities onopensource products i.e.
libav xen and seamonkey areinevitable since vulcnn may cause some false positives.
the threat ismitigated bydeeply comparing thepattern ofdetected vulnerabilities with thepattern ofreal world vulnerabilities innvd.
.
discussion .
.
theselection ofcomparative tools.
wefirst select candidates based onwhether thetool isopen source andthen filter based on thetype oftechnique used bythetool finally weselect onetokenbased tool i.e.
tokencnn oneslice based tool i.e.
vuldeepecker onebitcode based tool i.e.
vuldeelocator andonegraph based tool i.e.
devign .
note that since sysevr istheimproved version of vuldeepecker weselect itasoneofthecomparative tools aswell moreover toachieve amore comprehensive comparison wealso select three traditional rule based tools i.e.
checkmarx flawfinder and rats .
.
.
therelationship between centrality measures and thecolors of image channels.
thepurpose ofconstructing animage istofacilitate theuseofimage based model i.e.
cnn forvulnerability detection while preserving theprogram details.
thus ourfunction image has three layers the same format asregular images butthere isno rigid correspondence between three colors inregular images and three centrality measures infunction images.
.
.
future work.
from theresults infigure weseethat the most time consuming phase ofvulcnn istoextract thepdg of functions thisphase occupies more than ofthetotal processing runtime.
inour future work weplan todesign anew static analysis toolortryother static analysis tools e.g.
frama c to achieve more efficient pdg generation.
invuicnn weselect degree centrality katz centrality and closeness centrality tocommence ourimage transformation.
inpractice other different centralities canalso beadopted toretain thegraph details.
weplan touse different combinations ofdifferent centralities tofind asuitable combination toachieve more effective image transformation in vuicnn.
moreover since most vulnerability detection systems areclosed source weonly compare vulcnn with eight tools i.e.
checkmarx flawfinder rats tokencnn vuldeepecker sysevr vuldeelocator and devign .
wewill conduct detailed comparative analysis onmore systems inourfuture work.
although vulcnn canmaintain better effectiveness than comparative tools itstnr isnotideal.
inother words some ofourdetected vulnerabilities may befalse positives.
inourfuture work weplan toleverage directed fuzzing onourdetected vulnerabilities tomitigate thesituation.
6related work there have been proposed many different vulnerability detection methods which canbeclassified into twomain categories codesimilarity based andpattern based.
asforsimilarity based methods thesimilarity canbemeasured from different aspects such asstring based tree based token based graph based and their hybridbased .
however they canonly detect cloned vulnerabilitieslese may pittsburgh pa usa andcannotdetect new vulnerabilities .
totackle thechallenge pattern based techniques have been designed.
according tothedegree ofautomation pattern based work can bedivided into three subcategories.
manual methods human experts manually generate thevulnerability patterns and use them todetect new vulnerabilities.
inpractice thedetection effectiveness ofthese tools e.g.
checkmarx flawfinder and rats ispoor since experts cannotgenerate allpatterns ofdifferent vulnerabilities.
results infigure 9also demonstrate thesituation.
semi automatic methods human experts first extractcertain features e.g.
subtrees and api symbols imports andfunction calls andthen feed them to traditional machine learning models e.g.
support vector machine andk nearest neighbor todetect vulnerability.
more automatic methods i.e.
deep iearning based methods since deep learning canautomatically extract features from source code ithasbeen used todetect source code vulnerability .
forexample vuldeepecker first collects code gadgets byslicing programs and then transform them into corresponding vector representations.
finally ituses these vectors totrain abidirectional long short term memory blstm model todetect vulnerability.
muvuldeepecker uses theprogram processing method in vuldeepecker andadds acode attention todetect multi class vulnerability.
devign applies ageneral graph neural network todetect vulnerability.
itcontains anovel convolutional module that caneffectively extract useful features from thelearned rich node representation forgraph level classification.
deepwukong distills theprogram semantics into aprogram dependency graph andsplits itinto several subgraphs according totheprogram points ofinterest.
then these subgraphs arefedinto agraph neural network totrain avulnerability detector.
7conclusion inthispaper wepropose anovel idea thatcanefficiently transform thesource code ofafunction into animage while preserving theprogram semantics.
bythis wedesign ascalable graphbased vulnerability detection system i.e.
vuicnn .
the evaluation results onadataset of13 vulnerable functions and26 nonvulnerable functions report that vulcnn issuperior toeight stateof the art vulnerability detectors i.e.
checkmarx flawfinder rats tokencnn vuldeepecker sysevr vuldeelocator and devign .
tovalidate theability of vulcnn onlarge scale vulnerability scanning weconduct acase studyon more than 25million lines ofcode.
through thescanning results wediscover 73vulnerabilities that arenotreported innvd.
wehave reported them totheir vendors andhope that they canbe patched assoon aspossible.