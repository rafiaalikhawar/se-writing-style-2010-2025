bedivfuzz integrating behavioral diversity into generator based fuzzing hoang lam nguyen humboldt universit t zu berlin germany nguyehoa informatik.hu berlin.delars grunske humboldt universit t zu berlin germany grunske informatik.hu berlin.de abstract a popular metric to evaluate the performance of fuzzers is branch coverage.however weargue thatfocusingsolelyoncoveringmany differentbranches i.e.
the richness isnotsufficient sincethemajority of the covered branches may have been exercised only once which does not inspire a high confidence in the reliability of the covered code.
instead the distribution of the executed branches i.e.
theevenness should also be considered.
that is behavioral diversity is only given if the generated inputs not only trigger manydifferentbranches butalsotriggerthemevenlyoftenwith diverseinputs.weintroducebedivfuzz afeedback drivenfuzzing technique for generator based fuzzers.
bedivfuzz distinguishes betweenstructure preserving andstructure changing mutations in thespaceofsyntacticallyvalidinputs andbiasesitsmutationstrategytowardsvalidityandbehavioraldiversitybasedonthereceived programfeedback.wehaveevaluatedbedivfuzzonant maven rhino closure nashorn and tomcat.
the results show that bedivfuzzachievesbetter behavioraldiversitythan thestateof the art measured byestablished biodiversity metrics namely thehill numbers from the field of ecology.
keywords structure aware fuzzing behavioral diversity random testing acm reference format hoanglamnguyenandlarsgrunske.
.bedivfuzz integratingbehavioral diversityinto generator based fuzzing.in 44th internationalconferenceonsoftwareengineering icse may21 pittsburgh pa usa.
acm newyork ny usa 13pages.
introduction traditionally fuzzing tools e.g.
have beenusedtoevaluatethesoftwareundertest sut withrespect to security and robustness properties.
typically vulnerabilities are foundbyfeedingthesutmalformedinputs potentiallyresulting in unexpected program behavior which can be identified usinge.g.
memory and safety oracles .
since most of the vulnerabilities emerge due to incorrect handling of unexpected inputs security orientedfuzzersusuallytargettheinputparsing permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
to use fuzzers to test the actual core functionality of the sut rather than the early input processing stages only.
the challengeoftestingthecorefunctionalityofaprogramthatexpects complexstructuredinputsismainlyduetothefollowingproblems the input must be syntactically valid i.e.
conform to the expectedstructure type inordertobeparseablebythesut.
the input must satisfy any additional semantic validity constraints e.g.
assertionsor repokmethods toactually reach the core program functionality.
thegenerated inputsmust exhibitsome sortof diversityin order to trigger diverse behavior.
thetechniquestargetingthisproblemtypicallyrelyonaninput specification e.g.
a grammar that describes the expected inputstructure to produce inputs of the expected format.
generatorbased fuzzers like zest follow an imperative approach where thetesterimplementsa generator programthatisabletoproduce syntactically valid inputs.
zest uses code coverage and validity feedbacktosearchforinputsthatexercisemanydifferentbranches in the semantic analysis stages of the sut.
that is the goal of zest istocoverasmuchofthesemanticprogrambehavioraspossible.
a more recent technique rlcheck utilizes reinforcement learningtoautomaticallyguidethegeneratortowardshighinput diversity i.e.
inputsthat exercise differenttraces.
however while rlcheckisabletoproducealargenumberofdiverseinputsthat triggerspecific behaviors it fails to cover many different behaviors.
we are interested in a technique that is able to not only cover many different behaviors but also test these behaviors in a diverse manner.
that is we aim for an even distribution of exercised behaviors rather than focusing our testing effort solely on particular behaviors.
a simplified illustration of this idea can be found in figure1.inthefigure thegreyareasintheinputspacerepresent thevalidinputs i.e.
inputsthattriggerthecorefunctionalityofthe sut whereasthewhiteareasrepresentotherinvalidinputs e.g.
inputsthatonlytriggererrorhandlingcode .traditionalfuzzers like afl as depicted in figure .a tend to produce malformed inputs and hence only cover a small proportion of the valid be havior.
further the distribution of the triggered valid behaviormostly concentrates on the more likely branches.
on the otherhand validity focused fuzzers like zest and rlcheck cf.
figure .b either only focus on covering many different behaviors but not their diverse execution indicated by grey areas with a low concentration of green crosses or disproportionally test particular behaviorsonly indicatedbythesmallareaswithahighnumberofgreen crosses .
our proposed technique bedivfuzz cf.
figure .c avoids this problem by searching for many different valid inputs while evenly testing the behaviors in a diverse manner.
ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hoang lam nguyen and lars grunskeinput space a traditional fuzzer afl libfuzzer ... input space b validity fuzzer zest rlcheck input space c behavioral diversity bedivfuzz behavior spacebranch hit counts call frequencies likely branches rare branches behavior spacebranch hit counts call frequencies likely branches rare branches behavior spacebranch hit counts call frequencies likely branches rare branches figure illustrative simplified motivation for bedivfuzz.
in the input space the white and grey areas represent invalid and validinputareasforthesut respectively.thegreencrossesrepresentvalidtestinputs whiletheredcrossesrepresentinvalid inputs.inlinewith weusebranchhitcountsandcallfrequenciesasanillustrativemetrictorepresentthebehaviorspace.
inparticular bedivfuzzdistinguishesbetween structure changing andstructure preserving mutations.
performing structure changing mutationsallowstosearchfornewprogrambehaviorthatisonly triggered if the input satisfies particular structural properties.
in contrast the structure preserving mutations allow to target specific behavior of the code with different variants of the same input structure effectivelytestingthetargetedbehaviorinadiversemanner.
bedivfuzz uses an adaptive mutation strategy that utilizesthe received program feedback to guide the search towards high behavioral diversity.
in order to determine the behavioral diversity ofafuzzingcampaign weproposeanovelmetricthatincorporates both the number of covered branches and the branch execution distribution over all unique traces.
noveltyandcontributions.
overall weprovidethefollowing key contributions wepresentbedivfuzz anovelfuzzingapproachthatgenerates valid and behaviorally diverse inputs.
we propose to utilize hill numbers a common metric forspeciesdiversityfromecology toquantifythebehavioral diversity of the covered branches by a fuzzing campaign.
we evaluate bedivfuzz based on several fuzzing campaigns withxmlandjavascriptsuts namelyant maven closure rhino nashorn and tomcat.
we provide the source code of bedivfuzz and a replication package of our results at significanceofthecontributions.
weprovideanovelmetric thatquantifiesthe behavioraldiversity ofafuzzingcampaignand proposeatechniquethatimprovesuponthecurrentstate of the art w.r.t.
to that metric.
the proposed metric shifts the focus of simply1def generate tree depth value random.randint tree binarytree value ifdepth max depth return tree ifrandom.choose tree.left generate tree depth ifrandom.choose tree.right generate tree depth return tree figure2 asimplebinarytreegenerator.adaptedfrom .
covering many behaviors i.e.
branch coverage to diversely testing manydifferentbehaviors.thus itwillpotentiallyserveasastepping stone towards future systematic evaluations of a sut with respect to reliability and correctness after the termination of a fuzzing campaign as desired in practical software engineering.
background .
generator based fuzzing fuzzing also known as fuzz testing attempts to find bugs and crashes in software through random input generation.
a common challenge in fuzzing is to produce test inputs for programs that expect complex structured inputs e.g.
compilers .
effectively testing thesetypesofprogramsischallengingduetothefollowingreasons authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
bedivfuzz integrating behavioral diversity into generator based fuzzing icse may pittsburgh pa usa i thegeneratedinputsmustbe syntactically validinordertobe successfully parsed by the program.
ii the input must also satisfy any additional semantic validity constraints in order to actually exercisethesut scorefunctionality.
iii thetestinputshavetobe diverseenoughtoexecuteavarietyofdifferentprogrambehavior.
structure awarefuzzerstypicallyapproachthisproblembyutilizing domain specificknowledgeabouttheexpectedinputtypeorformat.
onewaytoprovidethisknowledgetothefuzzerisviaadeclarative input specification e.g.
a grammar .
alternatively the tester may write an imperative generator programthatrandomlysamplessyntacticallyvalidinputs anapproach known as generator based fuzzing .
for example figure shows the pseudocode for a generator that produces random binary trees which will serve as the running example throughout the paper.
the function generate tree first samples a random integervaluebetween0and10 line2 toinstantiatetherootnode line .
if a user defined maximum depth has been reached the generatednodeisreturned lines4 .otherwise thegenerator non deterministically decides whether to generate left and rightchild nodes in which case generate tree is recursively called lines .
the output of the generator thus depends on the sequenceof randomchoices madeduringthegenerationprocess.in the example the sequence of random choices precisely determines the shape of the binary tree and all the tree node values.
as a concrete example consider the following random choice sequence for the call of generate tree max depth random choice result context random.randint 3root node value line random.choose false root generate left child?
line random.choose false root generate right child?
line this sequence of random choices would result in a binary tree consistingofasinglerootnodewiththevalue3andnochildnodes togiveadifferentexample considerthefollowingchoicesequence random choice result context random.randint 3root node value line random.choose true root generate left child?
line random.randint 5left child node value line random.choose false left child gen. left child?
line random.choose false left child gen. right child?
line random.choose true root generate right child?
line random.randint 7right child node value line random.choose false right child gen. left child?
line random.choose false right child gen. right child?
line the corresponding binary tree consists of a root node with the value and leaf nodes with the values and as the left and right child respectively 7atypicalchallengeingenerator basedtestingariseswhenthe inputisexpectedtosatisfycomplexsemanticvalidityconstraints that are not explicitly considered by the generator.
to continuethe current example the sut may expect the generated tree tobe sorted e.g.
a binary search tree or height balanced e.g.
an avltree .inthiscase randominputsamplingisusuallynotvery effectiveasmostofthegeneratedinputswillberejectedbythesut.
instead recent techniques bias the generator towards producing validinputsbydirectlycontrollingtherandomchoicesmadeduring the input generation process.
zest reliesonthefactthattheimplementationofrandom number generators usually depends on a pseudo random source of untypedbits whichpadhyeetal.refertoas parameters.specifically random values of a particular type are generated by consuming and interpreting a fixed number of parameters.
for instance a randombooleanvaluemaybesampledbyconsumingonebitfromthesourceofuntypedparameters whichistheninterpretedas falseif itiszeroandotherwiseas true.thepseudo randomnatureofthis methodensuresthatusingthesamerandomseedalwaysgenerates thesamesequenceofparameters.foragivengenerator thiswill producethesamesequenceofrandomchoices effectivelyresulting inthesamegeneratedinput.ontheotherhand bymutatingthe untyped parameter sequence the sequence of random choices can be altered which corresponds to complex structural mutations in theinputdomain.forexample mutatingtheparametersthatare consumed by the first call to random.randint figure line resultsinthevalueoftherootnodetobemutated.similarly mutating the parameters corresponding to a call to random.choose line may change the decision on whether a left child node will begenerated.asaresult bycontrollingthesequenceofparameters itispossibletodirectlycontroltheoutputoftheinputgenerator.
zest exploits this insight by performing a feedback directed parametersearchtoguidethegeneratorstowardshighcoverage inthesemanticanalysisstages.contrary rlcheck employs reinforcementlearningtoautomaticallylearna guidethatleadsthe generatortoproducediversevalidinputs w.r.t.avalidityfunction .
.
hill numbers in the field of ecology researchers are interested in quantifying thebiodiversityofanassemblagebasedonasampleofspecies.a commonlyusedclassofdiversitymetricsarethehillnumbers .
thehillnumbersconsiderbothspeciesrichness i.e.
thetotalnumberofdifferentspecies andspeciesabundances i.e.
thenumber of individuals per species in a sample and are defined as follows definition .
hill number of order q .letsbe the species richnessandpitherelativeabundanceofthe i thspeciesinthedataset.
thehillnumberoforder qisdefinedas qdistheoriginalnotation qd d q parenleftbiggs summationdisplay.
i 1pq i parenrightbigg1 q forq equation is undefined but its limit for q corresponds to the exponential of the shannon wiener index 1d d lim q 1qd exp parenleftbigg s summationdisplay.
i 1pilogpi parenrightbigg authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hoang lam nguyen and lars grunske theorder qdeterminesthesensitivityofthemetrictotherelative species abundances where typically measures for q are reported.
for q the relative species abundances are not considered at all and d corresponds to the total number of speciesinthedataset i.e.
therichness .for q thespeciesare weighted in proportion to their relative abundances which is why d canbeinterpretedastheeffectivenumberof typical species.
forq moreweightisgiventothemostabundantspeciesand therarerspeciesarediscounted.asaresult d canbeinterpreted as the effective number of common or dominant species.
approach in this section we first describe our approach to extend generatorbasedfuzzingwiththeabilitytoproducemorebehaviorallydiverse inputs section3.
.
.then weintroduceanovelmetrictoquantify the behavioral diversity of a fuzzing campaign based on hill numbers section .
.
.
overview the key idea of our approach can be summarized as follows i we searchforinteresting inputstructures inthespaceofvalidinputs throughstructure changing mutations.
ii we produce different variantsofthesameinputstructurebyapplying structure preserving mutationswiththegoalofexploringdiverseexecutiontraces.to bias the input generation towards high behavioral diversity we observe the coverage and validity feedback from the program after every execution and adapt the mutation strategy accordingly.
.
structural parameter splitting as described in section .
the non determinism of the input generation process is entirely controlled by the sequence of randomchoices made.
our first insight is that the choices can be classi fied into two different types structural choices andvalue choices dependingontheirinfluenceonthecontrol flowbehaviorofthe generator.basedonthenotionofa choicepoint byreddyetal.
we define these choice types as follows definition3.
structuralandvaluechoices .letthechoicepoint pbe a tuple l c wherel lis a program location in the generatorgandc cis a finite domain of choices.
the choice point pis said to produce structural choices if the evaluation of a branch condition at some point during the execution of gdepends on the choicec c. otherwise pis said to produce value choices.
forexample thechoicepoint p1 line2 in figure produces value choices since no branch condition in generate tree dependsonthatchoice.ontheotherhand both choicepoints p2 line6 andp3 line8 true false producestructuralchoices sincethecorrespondingchoices directlyinfluencethebranchingbehaviorofthegenerator g i.e.
the decision on whether to generate child nodes or not .
based on this insight our first idea is to splitthe sequence of untypedparametersintotwodistinctparametersequencesbased on the choice type they are used for astructuralparametersequence tobeconsumedbystructural choice points.
avalue parameter sequence to be consumed by value choice points.
that is we can now represent each input as a tuple s v where sand vrepresent the structural and value parameters consumed by the input generator respectively.
to further illustrate this idea consider the following binary tree thecorrespondingparametersequence shownastypedchoice values for the sake of simplicity is given by true false false true false false here thestructuralchoicesconsistsofallthebooleanandthe value choices of all the integer values.
therefore we can represent thisparametersequencebythefollowingtwodistinctsequences s true false false true false falseand v .
thischangeinhowtheparametersforageneratorarehandledis a key idea of our approach since it gives us access to the following operations and concepts.
first it enables us to perform more controlled mutations on the input.inparticular bymutatingthestructuralparametersequence we can directly mutate the structural choices made during the input generation process.
by definition the change of structural choices eventually results in a change of the control flow behavior inthegenerator whichtypicallyproducesaninputwithadifferentstructure.forexample ifweconsiderthebinarytreegeneratorfrom figure2 mutatingthestructuralparameterschangestheboolean decisionsonthegenerationofchildnodes.ontheotherhand by mutatingthevalueparametersonly thecontrol flowbehaviorof the generator is preserved yet different value choices are sampled.
in the case of the binary tree generator mutating value parameters resultsinmutatedchoicesforthenodevalues whilekeepingthe shape of the binary tree unmodified.
overall the access to these structure changingandstructure preservingmutationsallowsus to explore the input space in a more controlled manner.
the second benefit of separating the structural and value parameters is that it allows us to synthesize an abstract input from a concrete input definition3.
abstractinput structuralsignature .letibean inputgeneratedbyagenerator g s cs1 cs2 ... csnbethecorrespondingsequenceofstructuralparameters and v cv1 cv2 ... cvm bethecorrespondingsequenceofvalueparametersmadeby gduring the generation of i. theabstract input a i of the input iis the input that is obtained by setting all value parameters in v as unspecified or symbolic while fixing the concrete structural parameters s. the sequence of concrete structural parameters s is called the structural signature ofa i .
intuitively the abstract input represents the structural skeleton oftheinput whichmaybeconcretizedbyspecifyingthemissing value parameters.
in our running example the abstract input of a generated binary tree would correspond to a binary tree with the same shape but unspecified node values.
as an example for authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
bedivfuzz integrating behavioral diversity into generator based fuzzing icse may pittsburgh pa usa the above described tree the abstract input a t fixes the structuralparameters sandleavesthevalueparameters vunspecified cv1 cv2 cv3 i.e.
cv1 cv2 cv3 s true false false true false false v cv1 cv2 cv3 thestructuralsignature i.e.
thesequenceofstructuralparameters s o fa t thus describes the set of all binary trees consisting of three nodes a root node that is connected to two child nodes whereeach nodehas avaluebetween 0and thedomain ofthe choice point p1 line .
since we represent each input as a tuple s v we can easily check whether two inputs share the same abstract input by comparing their structural signatures.thisisanothercrucialaspectofourapproach asthis propertyallowsustoreasonabouttheexploredinputspaceona higherlevel.inparticular ourapproachusestheconceptofabstract inputsinordertoidentifyinterestinginputstructuresthatexercise new behavior.
.
feedback driven search strategy thefuzzingalgorithmof bedivfuzzispresentedinalgorithm1.it isbasedonthecoverage guidedzestalgorithmforgenerator based fuzzing andisextendedbyintegratingtheconceptsofstructural parameter splitting and abstract input structures.
in particular the two key components of the bedivfuzz algorithm consist of an adaptive mutation strategy that biases input generation towards high behavioral diversity and a fuzzing heuristic that guides the search strategy based on the structural properties of the input.
we highlight these main innovations in algorithm in grey.
algorithm bedivfuzz algorithm input programp generator g output a set of test inputs a set of failing inputs 1q random initial seed input 2f failing parameters 3c total coverage 4t unique traces 5s interesting valid input structures 6repeat 7for s v inqdo for1 i numchildren s v do s v mutateadaptive s v input g s v coverage result run p input ifresult failurethen save failures f f s v else check if input has interesting structure ifresult valid and coverage notsubseteqlcand s sthen q q s v add to queue s s s add saved structure updatecoveragestats coverage result c t 19untilgiven time budget expires 20returng q g f similartozest andothercoverage guidedfuzzers wemaintain a queueqof interesting inputs which is initially seeded with a random value line .
while zest operates on single parameter sequences bedivfuzzoperatesontuples s v ofsplitparametersequences.forthesakeofbrevity intheremainderofthispaper wewillusetheterm parameters whenreferringtotuples s v of split parameter sequences.
throughout the fuzzing campaign the algorithm maintains basic bookkeeping data such as the set of failing parameters and the current branch coverage lines .
additionally bedivfuzz keeps track of all unique coverage traces line and the set of interesting abstract input structures line .
the set of unique coverage traces is used to adaptively bias the mutationstrategy describedinmoredetailattheendofthissection.the setof abstractinput structuresis utilizedby bedivfuzz to guide the search within the space of valid inputs.
the main fuzzing loop lines has the same structure as other coverage guided fuzzers described as follows first a parametersequenceisselectedfromthequeue line7 afterwhich the number of child parameters is determined line .
we usethe same heuristic as zest which computes the number of child parametersbasedonthecoverageoftheparentinput.eachchild isgeneratedbyperformingoneormoremutationsontheparent parametersequence line9 .themutatedparametersarethenusedtogenerateaconcreteinputusingtheprovidedgenerator line10 .
afterwards thesystemundertestisexecutedwiththegenerated input which yields the code coverage and the validity feedback line .
the validity feedback is stored in the variable resultand can be any of valid invalid failure .
in the case of failure the current parameters are saved to the set of failures line .
otherwise the algorithm heuristically decides whether the currentparameters should be saved to the queue i.e.
if the parameters are interestingenoughtobefurthermutated basedontheobserved executionresults line15 .thisisbydefaultthecaseiftheinput is valid exercises new coverage and represents an input structure thathas not been previouslyadded to the queue.finally the bookkeeping data is updated line .
this includes updating the branch coverage and the set of unique coverage traces.
as described in section .
bedivfuzz is able to distinguish betweenstructure changing andstructure preserving mutations.this isdonebyperformingmutationsoneitherthestructuralparameters soronthevalueparameters v.performingstructure changing mutationsallowstosearchfornewprogrambehaviorthatisonly triggered if the input satisfies particular structural properties.
incontrast structure preserving mutations allow to test a specific behaviorofthecodewithdifferentvariantsoftheinput i.e.
inputs with the same abstract structure but different values .
inordertodecidewhichtypeofmutationtoperform bedivfuzz keeps track of the types of mutations that have been performed on aparametersequenceandobserveswhethertheresultinginputhasresultedintheexecutionofa uniquetrace.thefollowingmutations arethenbiasedtowardsthemutationoperatorthatismorelikely toproduceuniqueexecutiontraces asillustratedinalgorithm2.
specifically with a probability of a random type of mutation is performed.
otherwise the mutation type is chosen based on heuristicscores rsandrvforthestructuralandvaluemutations respectively line .
for a given mutation type x the score is calculated as the fraction of inputs that have exercised a unique authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hoang lam nguyen and lars grunske trace ux outofalltheinputsthatweregeneratedbytherespective mutation type nx i.e.
rx ux nxx s v thus webiastheselectionofthemutationoperatortowardsproducing inputs that diversely exercise particular behaviors while relyingonthestructuralsearchheuristicinalgorithm1 line15 to discover new behaviors.
algorithm adaptive mutation strategy input structural parameters s value parameters v exploration factor output mutated parameters s v 1ifuniformrandom then 2ifrandomboolean then mutate either of the params return mutate s v 4else return s mutate v 6rs rv calculatescores score by mutation type eq.
7ifrs rvthen perform most promising mutation 8ifrs rvthen return mutate s v mutate structural params 10else return s mutate v mutate value params 12else 13goto2 resort to random mutation .
a metric for behavioral diversity aspartofthiswork weareinterestedinestablishinganotionof behavioral diversity in the context of fuzz testing.
in particular we propose to use hill numbers section .
or effective number of species .
the inspiration for this metric stems from the stads softwaretestingandanalysisasdiscoveryofspecies framework introduced by b hme .
in this framework b hme links the sampling process in an assemblage for species discovery to the process of sampling from the program s input space to discover particular featuresoftheinput sexecution e.g.
coveredbranches reached program states .
however rather than using the framework to estimatespeciesdiscoveryprobabilities webuilduponthe sameconnectionbetweenecologyandsoftwaretestingbyapplying an established biodiversity index known as hill numbers to quantify the behavioral diversity of a fuzzing campaign.
we apply this diversity measure to the context of fuzzing as follows.considerafuzzingcampaign whereafuzzer fsamplesinputs itofuzzaprogram p.executing pwithaninput i iresultsina tracet i thatconsistsofthesequenceofbranchesvisitedduring the execution.
each branch bthat has been covered by at least one inputicannowbeseenasaspecies.theabundanceofaspecies i.e.
ofacoveredbranch b canthenbecomputedasthenumber c b ofuniquetraces thathaveexecutedthebranch b thebranch execution count .
given these measures we can now quantify the behavioral diversity of a fuzzing campaign as the hill numbers computed over the distribution of branch execution counts.
definition3.
behavioraldiversity .letibethesetofinputsgeneratedbyafuzzerduringafuzzingcampaign andlet c b n be a function that maps a covered branch b bto its relative executioncountoveralluniquetraces.then the behavioraldiversityof orderqis defined as b q parenleftbigg summationdisplay.
b bc b q parenrightbigg1 q intuitively this measure quantifies the effective number of diverselycoveredbranches thatis thenumberofbranchesthatwere equallyoftenexecutedbydiverseinputs i.e.
inputswithunique traces .
while b is equal to the number of covered branches since it equally weights rare and common branches b weights branchesbytheirrelativeexecutioncountsandcanthusbeinterpretedasthe effectivenumberoftypicallycoveredbranches .
b gives more weight to common branches and can be seen as the effective number of common branches .
in the context of fuzzing behavioral diversity considers the distributionofdiversebranchexecutioncountsinordertomeasure thedegreeofexplorationbiastowardsspecificprogrambehavior.
higher numbers indicate that a fuzzer is diversely exploring more branches whereas lownumbersmean thatthefuzzer isspending mostoftheresourcesexploringthesamefewbehaviors.lowbehavioral diversity is most evident for random blackbox techniques which may be able to spuriously cover many branches but ultimatelyexercisethesamelikelycoderegionsoverandoveragain.
especially for unsuccessful fuzz campaigns where no bugs are found behavioraldiversitycanprovidevaluableinsightsintothe progressofafuzzerasacomplementarymetrictobranchcoverage.
forinstance practitionersmayconsidermorediverselyexecuted branchesasmore reliablethanlessdiversely executedones since they have been tested more thoroughly .
on the other hand researchers may tune their fuzzers to repeatedly target less diversely executed branches in order to increase the overall confidence in the reliability of the respective behavior.
evaluation inthissection weevaluatetheeffectivenessof bedivfuzzingeneratinginputsthatexhibitdiversebehavior.wecompareourapproach against three techniques rlcheck zest and an implementationofquickcheck fromthejqf fuzzingframework.
in particular we seek to answer the following research questions rq1isbedivfuzzabletoeffectivelyproducediversevalidinputs for real world benchmarks?
section .
rq2do the inputs generated by bedivfuzz have a higher behavioral diversity compared to state of the art techniques?
section .
rq3howdoesbedivfuzzperformintermsoffaultfindingcapabilities?
section .
.
study design baseline techniques.
we compare against two state of the art techniquesingenerator basedtesting namelyrlcheck andzest .
rlcheck uses reinforcement learning in order to automaticallylearn aguidethat leads the generator towards producing many diversevalidinputs.zestisagenerator basedfuzzerthatintegrates validity feedback into a coverage guided search algorithm to effectivelycoverthesemanticanalysiscode.wealsocompareagainst a java version of quickcheck by running zest without code coverage and validityfeedback as donein the original evaluation authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
bedivfuzz integrating behavioral diversity into generator based fuzzing icse may pittsburgh pa usa of rlcheck.
that is quickcheck performs random sampling of inputs using the generator.
experimental subjects.
our evaluation is conducted on six realworld benchmarks namely apache ant apache maven mozilla rhino googleclosurecompiler oraclenashorn andapachetomcat.thefirstfoursubjectshavebeenusedintheoriginalevaluations of zest and rlcheck we add two additional subjects for a broader benchmark.
in addition we have updated the subjects to the latest versions available at the time when we conducted the experiments.
inputs for ant maven and tomcat are generated by an xml generator whereas rhino closure and nashorn use a javascript code generator.
configuration.
we run all baseline techniques with their default configurations.inordertorunnashornandtomcatwithrlcheck weuseconfigurationfilesbasedonthoseprovidedforrhinoand mavenbytheoriginalauthors respectively.forbedivfuzz weuse .2astheprobabilitytoperformarandommutation.further we provideresultsfortwoconfigurationsof bedivfuzz whichwerefer to asbedivfuzz structure and bedivfuzz simple.
bedivfuzzstructure utilizes both structural mutations and analysis of input structure novelty whereas bedivfuzz simple only employs structural mutations.
in order to make the input generators used by zestcompatiblewithourtechnique wemanuallyextendedthemto handle split parameter sequences and annotated the choice points with the type of choice they produce.
however we note that the latter could also be done automatically through data flow analysis.
implementation.
we have implemented bedivfuzz as an extension of zest in jqf .
jqf is a framework for generator based testinginjavaandimplementsdifferentfuzzingalgorithms including the zest algorithm and afl like fuzzing for java programs.
experimental parameters.
fortheevaluationofrq1 inputdiversity and rq2 behavioral diversity we run each experiment with atimeoutof1hour.theoriginalevaluationofrlcheck was conducted with a timeout of minutes as the authors assumed aproperty basedtestingcontextwherethegeneratoristypically executed only for a short time.
while a minute timeout may seem short compared to common timeouts in fuzzing evaluations itshouldalsobenotedthatcollectingcoveragemetricsforblackboxmethods e.g.
quickcheckorrlcheck issignificantlymore expensivethanforgreyboxmethods e.g.
zestorbedivfuzz .in particular the inputs for blackbox techniques first need to be generatedontheuninstrumentedsutuntiltimeout andsubsequently be replayed on the instrumented version of the sut.
this is necessary to allow for a fair comparison against greybox methods since instrumentationaddsadditionaloverhead.however thismethodology results in significantly longer experimental runtimes1.o nt h e otherhand coveragedatamaynotbemeaningfuliftimeoutsare tooshort sincecoverage guidedalgorithmstypicallyneedsometime to become effective.
thus for the evaluation of rq1 input diversity andrq2 behavioraldiversity weextendthetimeoutfor each experiment to hour.
we further justify this decision by our observation that coverage has plateaued in almost all experiments 1inourexperiments wehaveobservedupto longerruntimeswhencomputing coverage for quickcheck and rlcheck.after this timeout.
however for rq3 fault finding capabilities we extendthetimeoutto24hours sinceevaluationsthatfocusonbug metrics should be performed with longer timeouts as suggested by klees et al.
.
to account for the variability of the results due torandomness weperform30repetitions.statistical significance is assessed using the mann whitney utest also known as the wilcoxonrank sumtest with .
assuggestedbyarcuriand briand for randomized algorithms.
as for hardware we conducted all experiments on a server with anintel r xeon r e7 .5ghzcpuand1tboframrunning opensuse leap .
.
rq1 generating diverse valid inputs weanswerrq1byassessingthenumberofdiversevalidinputsgenerated by bedivfuzz compared to the baseline techniques.
similar to reddy et al.
we consider diverse valid inputs as inputs that exercisedifferenttraces ratherthaninputsthatareonlyuniqueon thebyteorstringlevel.theresultsarevisualizedinfigure3.the left column shows for each benchmark subject the percentage of all generated inputsthat were diversevalid inputs whereas the right column depicts the totalnumber of diverse valid inputs.
if we consider the percentages of generated diverse valid inputs theresultsindicatethat bedivfuzziscompetitivewiththe current state of the art.
for all benchmark subjects both configurationsof bedivfuzz outperform zest and quickcheck as they are ableto maintain a high percentage of diverse valid inputs and even increaseitovertimeforseveralsubjects.however intwooutofsix subjects rlchecksignificantlyoutperforms bedivfuzz whichis most notable in the maven benchmark where the mean percentage of diverse valid inputs is about and higher compared to bedivfuzz structure and bedivfuzz simple respectively.
the plots for ant show a high variability in the performance of bedivfuzz whichisduetothedifficultyoffindingthefirstvalid inputforthissubject.thisindicatesthatbedivfuzzcanpotentially benefitfromaninitialvalidseedinput.thesameappliestozest which also further mutates invalid inputs by default thus potentially wasting resources by initially exploring the error handlingcode of the sut.
on the other hand the efficiency of rlcheckallows it to quickly find a valid input and exploit the obtained information to generate further diverse valid inputs.
on our newly added subjects nashorn and tomcat rlcheck does not perform as well as on the other benchmarks.
this canpotentially be attributed to the fact that the new subjects have verysimplevalidityfunctions whiledifferentbehaviormayonly be triggered by specific input structures.
we assume that since rlcheckonlyreliesonthevalidityfeedback itisunabletolearn anymeaningful policyasalmost anygeneratedinput isvalid but not necessarily diverse valid.
as a result rlcheck might be prone to overfit to a valid yet uninteresting space of inputs with regard to the triggered program behavior .
in contrast to that bedivfuzz also utilizes code coverage to identify whether an input with a unique structure exercises interesting behavior or not.
while the results indicate that bedivfuzz is highly effective in generating diverse valid inputs the total numbers figure right column show that our approach is mostly limited by itsefficiency.
overall bedivfuzz only performs better than zest in authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hoang lam nguyen and lars grunske bediv structure bediv simplerlcheck zestquickcheck time min diverse valid time min 020k40k diverse valids a ant time min diverse valid time min 0500k1mdiverse valids b maven time min diverse valid time min 0500k1mdiverse valids c rhino time min diverse valid time min 0500k diverse valids d closure time min diverse valid time min 020k40k diverse valids e nashorn time min diverse valid time min 01m diverse valids f tomcat figure percent left and absolute number right of diverse valid inputs i.e.
valid inputs with different traces .termsofgeneratingmanydiversevalidinputs.whencomparing bothconfigurationsof bedivfuzz bedivfuzz structuretendsto haveaslightedgeduetotheaddedanalysisofinputstructures but thedifferences aregenerallynot significant.
however bedivfuzz is outperformed by both rlcheck and quickcheck for most ofthe benchmark subjects.
this can be explained as follows.
likezest bedivfuzz requires the sut to be instrumented in orderto collect code coverage.
this results in a significant slowdownof execution time around slower effectively reducing the total number of diverse valid inputs that can potentially begenerated.
on the other hand while rlcheck has a comparable effectiveness to bedivfuzz the blackbox approach makes it much moreefficient.nevertheless thisisanacceptabletrade off since our main focus is not on producing a large number of diverse valid inputs.
instead the overall goal of bedivfuzz is to exercise diverse behavior which we evaluate in the following section.
.
rq2 diverse execution of program behavior in this section we seek to answer rq2 that is whether bedivfuzzisabletogeneratetestinputsthathaveahigherbehavioral diversity compared to the baseline techniques.
we measure the behavioral diversity by the behavioral diversity index b q of order q definedin equation4.
in particular we compare thebehavioral diversityindicesfor q sinceinthefieldofecology hill numbersareusuallyreportedfortheseordersaswell.recallthat the behavioral diversity b q can be interpreted as follows q thetotalnumberofcoveredbranches i.e.
branchcoverage q the effective number of typically executed branches q the effective number of commonly executed branches theeffectivenumber ofasetofcoveredbranchescanbeseenasthe number of branches executed by the proportionally same number ofdiverseinputs.wearemostlyinterestedintheresultsfor b andb sincetheyemphasizetherelativeexecutioncountsofthe typical and more common branches respectively.
theresultsareshowninfigure4.fromlefttoright thecolumns depict the behavioral diversity of increasing order q from to .
the first column shows for each subject and technique thebehavioral diversity of order i.e.
the total number of covered branches.whilerlcheckisabletogeneratethehighestnumber of diverse valid inputs section .
it performs the worst in terms ofbranchcoverage.whencomparingtheotherapproaches both configurations of bedivfuzz have coveredthe highestnumber of branches in three out of six benchmarks ant maven nashorn with bedivfuzz simple additionally outperforming all other techniquesintomcat.however quickcheckoutperformsbedivfuzz in the two remaining benchmarks rhino and closure .
comparingagainstzest bedivfuzzisonlysignificantlyoutperformedinclosure and also in tomcat for bedivfuzz structure.
thesecondcolumnoffigure4comparesthedifferenttechniques w.r.t.the b metric i.e.
theeffectivenumberof typically executedbranches.here asimilartrendintheresultscanbeobserved.
whiletherelativeperformanceofrlcheckremainsthesame both configurationsof bedivfuzzperformsignificantlybetterthanall baseline approaches in four out of six benchmarks maven rhino closure nashorn .mostinterestingly whencomparingagainstthe authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
bedivfuzz integrating behavioral diversity into generator based fuzzing icse may pittsburgh pa usa bediv structure bediv simple rlcheck zest quickcheck time min 2k4kb time min 1k2k3kb time min 1k2k3kb a ant time min 1k2kb time min 5001k1.5kb time min 5001k1.5kb b maven time min .5k5kb time min 2k4kb time min 1k2k3kb c rhino time min 10k20kb time min 5k10kb time min 5k10kb d closure time min 100200300b time min 100200b time min 100200b e nashorn time min 2k4kb time min 1k2k3kb time min 1k2k3kb f tomcat figure from left to right behavioral diversity of increasing order to .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hoang lam nguyen and lars grunske plotsofthefirstcolumn b i.e.
numberofcoveredbranches bedivfuzznowoutperformsbothquickcheckandzestinrhino andclosure.intheremainingbenchmarks antandtomcat the performanceofzestiscomparabletobedivfuzz.anotherobservationisthatthe b valueof bedivfuzztendstoincreaseover time most noticeable on ant rhino and closure.
this indicates thattheinputsgeneratedbybedivfuzznotonlydiverselyexecute a fixed set of behaviors.
instead bedivfuzz is able to continuously increase the coverage of new behaviors while maintaining the overall diversity of the triggered behavior.
in contrast the b metric even slightly decreases over time for quickcheck in the clo surebenchmark.apossibleexplanationforthisobservationisthat quickcheckispronetodisproportionatelyoftentriggerthemost likelybehaviorsinthesut.ontheotherhand mostoftheother covered branches may have been executed only a few times by chance.thisincreasing unevenness inexecutedbehaviorcould consequently result in a decline of the b value.
the third column shows the results for the b metric i.e.
the effectivenumberofcommonlyexecutedbranches.again infour outofsixbenchmarks maven rhino closure nashorn bedivfuzzperformssignificantlybetterthanallbaselineapproaches.for the rhino and closure benchmark the difference between bedi vfuzz and the baselines even increased compared to the results of theb metric center column .
that is both configurations of bedivfuzz generate inputs that trigger common behavior in a more diverse manner compared to the baselines.
throughout the experiments when comparing the two configurationsof bedivfuzz wehaveobservedthatbedivfuzz structuregenerallyperformsbetterforshortertimeouts 5minutes .since bedivfuzz structureonlysavesinputstothequeueiftheyexhibit a new input structure the queue of saved inputs contains less but more structurally diverse inputs.
as a result bedivfuzzstructureinitiallyexploresmorediversebehavior buttheplain adaptivemutationstrategyof bedivfuzz simpleseemstobesufficient to eventually discover these behaviors as well.
thus the moreexplorativenatureof bedivfuzz structuremaybemore suitable for contexts where runtimes are required to be short e.g.
property based testing .
.
rq3 finding faults table shows the list of crashes that were discovered after a timeoutof24hours deduplicatedbybenchmarkandexceptiontype as done in the evaluations of zest and rlcheck .
to answer rq3 we comparethedifferentapproachesconcerningthediscoverytimes and the reliability of triggering a particular crash.
the results in dicatethatrlcheckperformstheworstintermsoffaultfindingcapabilities as this approach has triggered the least number of crashes.incontrast zestperformsthebestasithasfoundoneadditional crash compared to bedivfuzz and quickcheck though this crash was only found in of the trials.
this is is most likely due to the coverage guided algorithm of zest that allows to effectively explore deeper paths in the semantic analysis stage compared toquickcheck.ontheotherhand whilebedivfuzzalsoleverages coverage guidance the approach focuses more on diversely executing many different behaviors through controlled mutations.
thus bedivfuzz may miss interesting edge cases that are more likely to be produced by completely random mutations.
comparingthemetricsforthebugsfoundbybedivfuzz zest and quickcheck it can be noted that quickcheck finds the crashes faster and more reliably.
the crashes in closure and rhino are typically found within minutes by quickcheck while bedivfuzz and zest require hours to discover most of the crashes.
this result can potentially be explained by results in section .
which show that quickcheck already achieved high coverage after a few minutes in thesesubjects.incontrast thesearchalgorithmsof bedivfuzzand zestmighthaveprioritizedexploringotherpartsoftheprogram before eventually discovering the crash inducing behaviors.
interestingly bedivfuzz structuretendstofindcrashesfaster than bedivfuzz simple which suggests the importance of the structural novelty heuristic for fault finding.
.
threats to validity internal validity.
to avoid potential systematic errors that could posethreatstointernalvalidity wehavedesignedourexperiments replicationcount timeout etc.
basedontheguidelinesprovidedby kleesetal.
.additionally wehavereusedexistingandavailable implementationsofthebaselinefuzzerswithconformingparameter settingsfromtheevaluationofrlcheck .theparametersfor bedivfuzzarenottuned thuswecanprovideafairandrealistic comparative evaluation of the different approaches.external validity.
ourevaluationfocusesonlyonsixprograms ant maven rhino closure nashorn andtomcat withtwodifferentinputformats namelyxmlandjavascript.whetherourresults can be generalized to other programs and other input formats isa threat to external validity.
however the programs under test represent complex long living and mature programs with a widespread adoption.
thus we argue that an application of bedivfuzz to similar programs would produce similar results.constructvalidity.
themainquestiontowardsconstructvalidity iswhetherthehillnumbers forspeciesdiversityareactually agoodmetrictoevaluatethebehavioraldiversityofthecovered branchesinafuzzingcampaign.wearguethatbehavioraldiversity is given not only if many different behaviors are covered i.e.
a highbranchcoverage buteachofthedifferentbehaviorsisequally covered by many diverse inputs.
utilizing hill numbers as a metric specifically accounts for the possible variations in the diverse executionof differentbehaviors whichmay differgreatlydepending on the chosen fuzzing technique as shown in our evaluation.
related work diversityinfuzzingandsearch basedtestcasegeneration there have been several fuzzing and search based test case generationapproachesthattargetdiversityasoneoftheirobjectives.
theseapproachescanbeclassifiedintoapproachesthata aimto achieve diversity in the input space o rb i nt h e coveredbehavioroftheprogramundertestwhenexecutingthetestcases.oneoftheearlierapproachesinthefirstcategoryisadaptiverandomtesting art ablackboxtestingapproachthataims to distribute the test cases over the entire input space.
technically art selects the next test case that maximizes the minimal distance to allalready executedtest cases.
asimilar approachis applied in authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
bedivfuzz integrating behavioral diversity into generator based fuzzing icse may pittsburgh pa usa crash id bediv simple bediv structure zest quickcheck rlcheck closure.stringindexoutofboundsexception closure.nullpointerexception closure.runtimeexception rhino.arrayindexoutofboundsexception rhino.classcastexception rhino.illegalstateexception rhino.nullpointerexception rhino.verifyerror nashorn.assertionerror table average time in minutes and reliability of triggering a particular crash.
thetooldig fortestingweb basedapplications.thedistance of test cases is computed based on the sequences of actions that traversethenavigationalmodelofthewebapplication.insearchbasedtesting sapienzdiv aimstomaintainandimproveaset of test cases for mobile applications that trigger diverse inputs measuredbythedistanceoftestinputsequences.the uncommon inputs strategy from soremekun et al.
creates inputs based onaninvertedprobabilisticgrammar.iftheoriginalprobabilistic grammar is learned from a set of common samples the hypothesis is that inverting the probabilities would lead to uncommon and more diverse inputs.
bedivfuzz belongs to the second category of approaches since wefocusonbehavioraldiversityandachievinginputdiversityas abyproduct.a firststeptowardsbehavioraldiversityis takenin any greybox fuzzing approach e.g.
that aim to maximize some coverage metric in the sut such as branch or statement coverage.
the feedback loop in these greybox fuzzing approachesimplementsanoveltysearchthatvaluestestinputsthat provideadditional coverage.thisfeedback loopisalso presentin hybrid fuzzing approaches e.g.
that combine greybox fuzzing with symbolic execution or concolic testing .
furthermore the general idea of greybox fuzzing is taken a step further in fairfuzz vuzzer and tortoisefuzz .
fairfuzzisanafl extensionwiththegoaloftriggeringrare branches.themainideaoffairfuzzistolearnmutationmasksand areas that have a higher chance of hitting these rare branches.
tortoisefuzzandvuzzerinsteadprioritizeexplorationofcoderegions with a high chance of containing a vulnerability.
in the case of vuzzer the goal is to cover error handling code and tortoisefuzz aims to cover memory access operations.
in contrast to all these approaches we argue that just hitting abranchoncedoesnotprovidebehavioraldiversity.theexisting approachesbasicallyaimtooptimizethe b metric i.e.
branch coverage infigure4 whereasbedivfuzzalsoprovidesbehavioral diversity and scores well on the b andb metrics.
fuzzing and generation of valid inputs the generation of syntacticallyandsemanticallyvalidinputshasalwaysbeenthetargetofmodernfuzzingapproaches.concerningsyntacticallycorrectinputs thecommonapproachistousemodelstodescribetheinput structure.
examples are input specifications or grammars .
however having just syntactically correctinputsisoftennotenough andtoexploredeeperregions of the sut semantic validity of the inputs is required.
zest utilizesvalidityandcodecoveragefeedbacktoproduceinputswith high semantic coverage.
bedivfuzz is based on the same feedback mechanismaszest butextendsitwithnovelstructuralmutation operators and a structure aware fuzzing heuristic.
rlcheck usesreinforcement learningtolearnapolicytoguidethegenerator towardshighinputdiversity.similarly bedivfuzzautomatically adapts its mutation strategy based on the received feedback.
while ourapproachisbuiltontopoftheseapproaches themaindistinguishingfactoristhatwealsoaimtoproducediversebehavioral inputstohaveamoresystematicexplorationofthesut sbehavior.
conclusion and future work in this paper we have described an approach to generate test in puts with high behavioral diversity.
that is our approach doesnot only aim to coveras many behaviors as possible but also to diversely execute the different behaviors.the key to our approach istodistinguishbetween structure changingmutations thatallow tosearchfornewbehaviorstriggeredbyspecificinputstructures andstructure preserving mutationstodiverselyexecuteaparticular behavior.thismethodiscomplementedbyanadaptivemutation strategy and a new fuzzing heuristic that is based on the structural novelty of an input.
we implemented this approach in bedivfuzz and show that it outperforms the current state of the art w.r.t.
to a novel measure of behavioral diversity that is inspired by a popular biodiversity metrics in ecology hill numbers.
in future work we wouldliketoprovideguaranteesforourapproachbyevaluating measures such as the residual risk and reliability of a sut after we terminate a fuzzing campaign.