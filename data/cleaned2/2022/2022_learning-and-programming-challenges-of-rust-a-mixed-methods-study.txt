learning and programming challenges of rust a mixed methods study shuofei zhu pennsylvania state university usaziyi zhang university of wisconsin madison usaboqin qin china telecom cloud computing china aiping xiong pennsylvania state university usalinhai song pennsylvania state university usa abstract rustisayoungsystemsprogramminglanguagedesignedtoprovide boththesafetyguaranteesofhigh levellanguagesandtheexecution performance of low level languages.
to achieve this design goal rust provides a suite of safety rules and checks against those rules at the compile time to eliminate many memory safety and thread safety issues.
due to its safety and performance rust s popularityhasincreasedsignificantlyinrecentyears andithasalready been adopted to build many safety critical software systems.
itiscriticaltounderstandthelearningandprogrammingchallenges imposed by rust s safety rules.
for this purpose we first conducted an empirical study through close manual inspection of rust related stack overflow questions.
we sought to understand what safety rules are challenging to learn and program with under which contexts a safety rule becomes more difficult toapply and whethertherustcompilerissufficientlyhelpful in debugging safety rule violations.
we then performed an online surveywith101rustprogrammerstovalidatethefindingsofthe empiricalstudy.
weinvited participantstoevaluate programvariantsthatdifferfromeachother eitherintermsofviolatedsafety rulesorthecodeconstructsinvolvedintheviolation andcompared the participants performance on the variants.
our mixed methods investigationrevealedarangeofconsistentfindingsthatcanbenefit rust learners practitioners and language designers.
ccs concepts software and its engineering general programming languages development frameworks and environments.
keywords rust programming challenges empirical study online survey this work was supported in part by nsf grants cns and ccf and an ist seed grant from pennsylvania state university.
ziyi zhang contributed equally with shuofei zhu in this work.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe firstpage.copyrights forcomponentsof thisworkowned byothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa copyright held by the owner author s .
publication rights licensed to acm.
acm isbn ... .
reference format shuofei zhu ziyi zhang boqin qin aiping xiong and linhai song.
.
learningandprogrammingchallengesofrust amixed methodsstudy.
in44th international conference on software engineering icse may pittsburgh pa usa.
acm new york ny usa pages.
https introduction rust is a new programming language designed to build safe and efficientsystemssoftware .thekeyinnovationofrustis its suite of safety rules that are checked against during compila tion to catch memory safety and thread safety issues.
alongside the language s safety mechanism rust maintains its compiled executable programs to be as efficient as c programs.
due to its safety andefficiency rusthasbecomeincreasinglypopular ithasbeen rated the most beloved programming language every year since2016 and was the fifth fastest growing language on github in .
rust has already been adopted by many opensourceprogrammersandbigtechcompaniestobuildsafety critical software .
rust ssafetymechanismcentersaroundtwoimportantconcepts ownership andlifetime.
the basic safety rule requires each value to have exactly one owner variable and the value is freed when its owner variable ends its lifetime.
t o improve pr ogramming flexibility rust extends this basic rule to a suite of extended rules such as allowing ownership to be moved to another owner or to be borrowedusingareference andstillguaranteesmemorysafetyand threadsafety.rust ssafetymechanismiselegantandeffective.it essentially prohibits programs from having mutability and aliasingatthesametime andinherentlyavoidsmanyseverememory bugs e.g.
useafterfree andconcurrencybugs e.g.
datarace .a recent empirical study reports that if a program is written solely in saferustcode thenitwillhavenomemorybugs confirmingthe effectiveness of rust s safety mechanism in practice .
unfortunately rust is known to have a steep learning curve and is difficult to program in practice .
the ease with which programmerscanwritecodethatviolatesrust ssafetyrulesand is rejected by the rust compiler comes down to two reasons.
first rust ssafetymechanismisunique andtherelatedgrammarand semanticsareverydifferentfromtraditionalsystemsprogramminglanguages e.g.
c c .thus itisdifficultforprogrammersto migrate the programming experience they have gained from other languages to coding in rust .
second the design philosophy of rust is to reject all suspicious code and force programmers to ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa shuofei zhu ziyi zhang boqin qin aiping xiong and linhai song let r1 mut out1.a let r3 mut out2.a.
let r2 out1.a let r4 out2.a.
r1 r3 println!
?
r2 println!
?
r4 pc changes to pc !
struct inner inner u8 struct outer1 a struct outer2 a inner inner fn test in1 mut inner in2 inner fn main let mut out1 outer1 a let mut out2 outer2 a inner inner inner inner test mut out1.a out1.a let first rest out1.a.split first mut .unwrap test first rest test mut out2.a.
out2.a.
a rust programerror cannot borrow out1.a as immutable because it is also borrowed as mutable demo snippet3.rs test mut out1.a out1.a immutable borrow occurs here mutable borrow occurs here mutable borrow later used by call note a is an array and can only be borrowed as a whole struct outer1 a error aborting due to previous error for more information about this e rror try rustc explain e0502 .
b compiler error messages figure a rust program and its compile error.
in figure 1a the program is pc in the survey the red colored tokens violate a safety rule and and denote code added and deleted to fix the violation.
we replaced lines and with the code in the cyan colored rectangle to create pc 3inthesurvey.infigure1b thepartinthegreen coloredrectangledoesnotbelongtotheoriginalerrormessages andweaddeditinthesurvey.
prove their code follows all safety rules.
rust s safety checks are strict sometimes overly so making rust code hard to be compiled.
a piece of rust code is shown in figure 1a.
structs outer1and outer2are declared atlines and respectively.the two structs aresimilartoeachotherinthesensethatbothofthemonlycontain one field with the same name and the same contents two inner objects .
however the field of outer1is an array while the field ofouter2isatuple.function test takestwo innerobjectsas inputs.
it uses a mutable reference to borrow the first innerobject and an immutable reference to borrow the second one.
function test iscalledatline14usingthetwo innerobjectsinan outer1 object as inputs.
however the rust compiler reports an error on thisline figure1b .thereasonfortheerroristhattheelementsof an array must be borrowed altogether in rust or after an element isborrowed allotherelementsinthesamearrayarealsoconsidered as being borrowed since the rust compiler conservatively assumesanindexcanaccessanyelementinanarray.rustdoesnot allowamutablereferencetocoexistwithotherreferencestothe sameobjecttopreventsimultaneousmutabilityandaliasing.array out1.ahas already been mutably borrowed as the first parameter.
thus it cannot be borrowed again as the second parameter.
counterintuitively line 17is allowedby the compilerbecause different tuple fields can be borrowed separately.
figure1bshowstheerrormessagesreportedbytherustcompiler.
the compiler points out which ownership rule is violated where it is violated and how it is violated but it fails to provide the most important information for the programmer that array elements areborrowed together in rust causing the programmer to go to stack overflow to ask for more explanations about the code and the error messages .
the above case demonstrates the complexity of applying rust s safety mechanism under concrete coding scenarios and the difficultyinwritingprogramsacceptedbytherustcompiler.besides the safety rule that a mutable reference cannot coexist with anotherreferencetothesameobject programmersmustalsoknow how array and tuple elements are borrowed to avoid similar mistakes.moreover thecompilermaynotalwaysprovideallnecessary information for programmers to understand and fix the errors.
our ultimate goal is to facilitate the learning and programming of rust.
we take the identification of the challenges imposed byrust s safety rules as the first step.
those rules are unique and complex.asshownbytheempiricalstudyinsection3 theyindeed cause challenges to rust programmers in the real world.
rust is stillevolving .learningrustisacontinuousprocess and programmingrustinpracticeofteninvolvesstudyinghowtoapply a safety rule under a particular coding context.
thus we do not differentiate learning from programming in this paper.
overall we aim to answer the following research questions rqs rq which rust safety rules are difficult to understand?
rq under which programming contexts is a safety rule more challenging to apply?
rq how helpful is the rust compiler in resolving programming errors due to safety rule violations?
we adopted two approaches to answer these questions.
we first conducted anempiricalstudy onrust related stackoverflowquestions since programmers usually seek technical advice on stack overflowforissuestheycannotresolveontheirown .
we then performed an online survey to validate the findings of theempirical studyby closelyexamining howrust programmers answer carefully designed survey questions.
we built two datasets for the empirical study.
the larger one contains rust related stack overflow questions and the smalleronecontains100questionscausedbyviolationsofrust s safety rules.
to answer rq we built a taxonomy for safety rule violations in the small dataset.
the taxonomy contains two major categories complex lifetime computation andviolating ownership rules.
each of these contains several sub categories.
to answer rq2 weappliedtheldamodel tothelargedataset andcomputed the correlation between violated safety rules and involved code constructsforthesmalldataset.wemanuallyinterpretedtheresults toidentifyscenarioswhereasafetyruleismorechallengingtoapply.
toanswer rq weexaminedwhethertherustcompilerprovides allnecessaryinformationfordebuggingsafety ruleviolationsin the small dataset.
the empirical study yielded several important findings.
first rust ssafetyrulesaredifficultforprogrammerstoapplyinpractice andcomputingalifetimeismorechallengingthanapplyinganownership rule.
moreover some safety rule violations are highly correlated with particular code constructs indicating the corresponding rules are more challenging to apply to those code constructs.
in authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
learning and programming challenges of rust a mixed methods study icse may pittsburgh pa usa table our findings in the empirical study and how the findings are validated in the online survey.
findings in empirical study section validation in online survey section rust s complex safety rules indeed bring unique challenges to its programmers.
a large portion of participants at least sometimes felt confused about rust s lifetime or ownership rules.
rq which rust safety rules are difficult to understand?
a rust safety rule may be difficult to apply in concrete scenarios.
the average scores in marking program tokens that violated rust s safety rules ranged from .
to .
.
programmersaskmorelifetime relatedquestionsonstackoverflow thanownership relatedquestions suggestingthatlifetimecomputation is more difficult than applying ownership rules.
participantswho always understoodcompiler errorsfor lifetimeruleviolations .
weresignificantlyfewerthanthosewho always understood compiler errors for ownership rule violations .
.
programspd 1andpd 2sharedthesamecodeconstructs butpd due to errors in lifetime computation was reported with a significantly higherdifficultylevelthanpd 2causedbyviolatinganownershiprule.
themajority .
ofsafety ruleviolationscanbefixedusingsafe code or well encapsulated interior unsafe libraries.n.a.
rq under which programming contexts is a safety rule more challenging to apply?
thesamerustsafetyrulehasdifferentdifficultylevelswhenapplied to different code constructs and different safety rules have different difficulty levels when applied to the same code construct.
participants performed significantly better in labeling error tokens for program pc than for program pc where pc and pc shared the same code constructs but violated different safety rules.
anon negligibleportionofparticipantswereconfusedbyhowto apply the same rule to two different code constructs array and tuple .
rq how helpful is the rust compiler in resolving safety rule violations?
the rust compiler may not provide all information necessary to understand and fix violations of rust s safety rules.
participants shown with enhanced compiler error messages per formed significantly better than those with the original messages in explaining how safety rules are violated for program pc .
addition therustcompilermaynotprovideallthenecessaryinformationforcomprehendingsafety ruleviolations.wesummarize our findings in table .
intheonlinesurvey wefirstaskedforparticipants demographic information technical background and previous experience in interacting with rust s safety mechanism and the rust compiler.
wethenshowedthemfoursmallrustprograms namedpa pb pc andpd.weonlyaskedparticipantswhetherpaandpbcouldbe compiledtotesttheirrustknowledge.wesampledpcandpdfromtwosetsofsimilarprogramvariants.allvariantscontainedasafetyrule violation ho wever they wer e different from each other either in the safety rules they violated or in the code constructs those violations involved.
for both pc and pd we asked participants to pinpointerror rootcauses by highlightingprogram tokens evaluatehowdifficultitwastocomprehendtheerrorsbeforeand afterseeingtheerrormessages selecttheviolatedrules ratethehelpfulnessoftherustcompiler and describetheerrorroot causes in their own words.
we received valid responses and conductedextensivedataanalysisontheresponses.asshownin table1 weconfirmedmanyfindingsoftheempiricalstudywith significant confidence.
overall our mixed methods investigation reveals what to learn about rust how to learn it and how to interpret compiler error messages all of which can benefit rust learners and programmers.
moreover ourinvestigationpinpointsinformationmissedbythe rustcompilerwhenreporting safety ruleviolationsandthusprovides valuable guidance for the evolution of the rust compiler.
in sum this paper makes the following key contributions.
we performed the first empirical study on stack overflow questions related to violations of rust s safety mechanism.
wegainedsixfindingsregardingtheprogrammingchallenges caused by rust s safety rules and the helpfulness of the rustcompiler in debugging safety rule violations.
those findings can be useful