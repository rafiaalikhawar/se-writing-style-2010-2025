control parameters considered harmful detecting range specification bugs in drone configuration modules via learning guided search ruidong han hanruidong stu.xidian.edu.cn xidian university xian chinachao yang chaoyang xidian.edu.cn xidian university xian chinasiqi ma siqimslivia gmail.com the university of new south wales canberra sydney australia jiangfeng ma jfma mail.xidian.edu.cn xidian university xian chinacong sun suncong xidian.edu.cn xidian university xian chinajuanru li mail lijuanru.com shanghai jiao tong university shanghai china elisa bertino bertino purdue.edu purdue university west lafayette usa abstract in order to support a variety of missions and deal with different flight environments drone control programs typically provide configurablecontrolparameters.however suchaflexibilityintroduces vulnerabilities.onesuchvulnerability referredtoasrangespecificationbugs hasbeenrecentlyidentified.thevulnerabilityoriginates from the fact that even though each individual parameter receives avalueintherecommendedvaluerange certaincombinationsof parameter values may affect the drone physical stability.
in this paper we develop a novel learning guided search system to find suchcombinations thatwerefertoasincorrectconfigurations.our system applies metaheuristic search algorithms mutating config urations to detect the configuration parameters that have valuesdriving the drone to unstable physical states.
to guide the mutations our system leverages a machine learning based predictor as the fitness evaluator.
finally by utilizing multi objective optimization our system returns the feasible ranges based on the mutation searchresults.becauseinoursystemthemutationsareguidedbyapredictor evaluatingtheparameterconfigurationsdoesnotrequire realistic simulationexecutions.therefore oursystemsupportsa the work was conducted while the author was lecturer at the university of queensland.
corresponding author permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
theevaluationresultsshowthatthesystemsuccessfullyreportspotentially incorrect configurations of which over lead to actual unstable physical states.
keywords drone security configuration test range specification bug deep learning approximation acm reference format ruidonghan chaoyang siqima jiangfengma congsun juanruli andelisabertino.
.controlparametersconsideredharmful detecting range specification bugs in drone configuration modules via learningguided search.
in 44th international conference on software engineering icse may pittsburgh pa usa.
acm new york ny usa pages.
introduction drones flyingminirobots arerapidlygrowinginpopularity.they havebecomeessentialinsupportingthecentralfunctionsofvariousbusinesssectors e.g.
motionpicturefilmmaking andgovernmental organizations e.g.
surveillance .
due to their features of pilotless a small physical shape and fast speed drones are often used in missions suchasdelivery surveillance andtargetinglocationsthat aredifficultorexpensivetoreachwithothermeans.however as dronesareincreasinglyused forcritical missions it isessential to ensurethereliabilityandadaptabilityofthecontrolsystem towards completing missions successfully.
toachievereliabilityandadaptability enhancedflightcontrol systemshavebeendeveloped.suchsystemsprovidelargenumbers ofcontrolparametersthatcanbeconfiguredtomodifytheflight states of drones such as linear and angular positions.
through parameter adjustment different configurations can be set and sent to theflightcontrolprogram.basedonsuchaconfiguration theflight ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa ruidong han chao yang2 siqi ma jiangfeng ma cong sun juanru li and elisa bertino control program controls the flight states of the drone to complete flight missions.
however the functionality of adjusting parameters introducescertainvulnerabilities referredtoasrangespecification bugs arising from the lack of adequate checking of the control parametervalues.specifically whensettingsomeparticularconfigurations by selecting parameter values within the ranges provided bythemanufacturer unstableflightstatesmightbetriggered such as trajectory deviation or even drone crash.
unfortunately existingvulnerabilitydetectiontechniquescannotdetectsuchrangespecificationbugs.ifthesourceofthecontrol program is available static program analysis can be used to detect data control dependencies and find such bugs.
however suchanapproach workswellonlyforsmallcode snippets.ifused onlargeandcomplexprograms staticanalysiswouldhavescalability issues.
to address scalability taint analysis can be used by tracking input data flow which relies more on input construction.however when dealingwithvery largenumbersof control parameters each with a wide range of values analyzingconfigurations by tainting all the parameter values is time consuming.arecentlyproposedtool rvfuzzer triestoaddress suchan issueby generatingconfigurationinputs throughfuzzing.
eventhoughrvfuzzerisabletoreducethetotalamountofconfigurationstobetested itisstillinefficientandunabletoachieve high coverage analyses of configurations.
as a result it misses incorrect configurations.
major challenges for detecting range specification bugs include how to validate configurations effectively and how to efficientlysearch for correct parameter ranges.
in this work we address thesechallengesbydevelopingalearning guidedfuzzingapproach specificallydesignedtodetectrangespecificationbugs.atahigh level our detection tool lgdfuzzer relies on a genetic algorithm ga andaflightstatepredictortodetecttheconfigurations thatarepotentiallyincorrectandtesttheincorrectconfiguration throughsimulation.specifically lgdfuzzerisequippedwiththree core components state change predictor learning guided mutation searcher and range guideline estimator.
first we manually collectedalistofflightlogs eachofwhichcontainsaflightstate sensordata configurations andatimestamp.byusingsuchlogs lgdfuzzer trains a state predictor which is utilized to estimate the state referred to as reference state that will be reached by the drone at the next timestamp.
simultaneously lgdfuzzer runs the learning guidedmutationsearchertogenerateconfigurationsby leveraging the ga. unlike the traditional configuration validation schemes that test the configuration on either a flight simulatoror a realistic drone lgdfuzzer leverages the state predictor to estimatethereferencestateandinferswhetheraconfigurationis correct based on the deviation of the reference state concerning theexpectedstate.finally lgdfuzzervalidatestheconfigurationsthatarepredictedas incorrect andfurthergeneratesavalidrange for each parameter.
we used lgdfuzzer to analyze the most popular flight control program ardupilot .
in total lgdfuzzer validated configurations and labeled as incorrect out of which incorrect configurations were confirmed.
apart from the identified rangespecificationbugs wealsofound564privilegeescalationvulnerabilities referredtoas post launchprivilegeescalation.these refer to configurations that are detected as incorrect before thedrone takes off and as a result the flight is aborted.
however the controlprogramwill accepttheseincorrectconfigurationsif they aresenttothecontrolprogramafterthedronehastakenoff.our analysis also shows that a significant number of incorrect configurationsaresetinordertoenhanceadaptability.toassistdevelopers andusersinbuildingsecureflightcontrolprograms lgdfuzzer optimizes the parameter ranges based on a manually set adaptabilitylevel.ifdevelopersanduserspreferhigheradaptability larger parameter ranges will be provided by lgdfuzzer however the possibility of causing unstable flight would be higher.
otherwise a smallerrangewillbesetandtheflightstatesofthedronewillbe more stable.
contributions.
we have designed and implemented lgdfuzzer to detect incorrectconfigurationseffectivelyandefficiently.oursystemuses a ga to select the highly possible incorrect configurations and validates configuration correctness by using a deep learning based state predictor.
according to the requirements of reliability and adaptability by developers and users we designed and implemented a range optimization component in lgdfuzzer to provide the most ap propriate parameter value ranges to minimize the possibility of introducing incorrect configurations.
weappliedlgdfuzzertoareal worldflightcontrolprogram andidentified2 036incorrectconfigurationscausingunstableflight states.
we also verified incorrect configurations on real world drones and confirmed that these incorrect configurations cause trajectory deviations or drone crashes.
we found a new type of bug incorrect configuration tackling bug and verified that this bug also causes unstable flight states.
wehaveopensourcedourlgdfuzzerat blackjocker1995 uavga tree main thesitemakesavailablethetool dataset and video recordings of our tests of incorrect configurations.
motivation and challenges in this section we first introduce background information of flight controlprogramsutilizedbydronesandrangespecificationbugs.
we then discuss the challenges in the design of an approach to validate parameter configurations followed by our solutions to address these challenges.
.
flight control program during a flight the ground control station gcs communicates withthedronebysendingaseriesofcommandstotheflightcontrol program.
before the drone takes off users can configure the flightcontrolprogrambyadjusting theparameterstomanipulate the flight states of the drone e.g.
linear position angular position angularspeed velocity andacceleration .toensurethatadrone completesits flightmissionsuccessfully the flightcontrolprogram periodically observes the current positioned flight state and sensor data e.g.
from gps gyroscopes and accelerometers to estimate a reference stateindicating the next state ofthe drone.
then thecontrol program generates actuator signals e.g.
motor commands to authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
detecting range specification bugs in drone configuration modules via learning guided search icse may pittsburgh pa usa move the drone to the reference state.
the positioned state and the referencestateneedtobecloseenough i.e.
withinastandarddeviation.
if this is not the case the drone flight may become unstable leading to trajectory deviations and crashes.
although thevalue ranges for control parametersare typically hardcodedinthecontrolprogramsandonewouldexpectthatall possiblecombinationsofthesevaluesbecorrect butsomeofthe combinations are actually incorrect.
any configurations triggering unstable flight states are regarded as incorrect.
the corresponding control parameter ranges are range specification bugs .
since hundreds ofcontrol parameters canbe specified bythe flight control program identifying range specification bugs by validating all parametervaluesistimeconsumingbecausesomeparametersmay not affect flight stability.
therefore we focus on the parameters that might affect angular position and angular speed state because theydirectlyimpacttheflightattitudeandtheirincorrectvalues are more likely to cause unstable states.
byanalyzingthephysicalimpactondrones wedefinefiveunstable flight states flightfreeze.
adroneisrequiredtokeepmovingunlesstheflight control program generates a signal to keep the drone stationary or to instruct the drone to land.
however incorrect configurations may lead the drone to accidentally freeze at a waypoint when moving forward backward or to wander around a position within a minimum range.
to determine whether a flight is frozen we calculate the movement distance between the previous and the current positions within a time interval.
if the distance is less than a threshold the flight state is regarded as frozen i.e.
flight freeze .
deviation.
according to the actuator signals generated by the flightcontrolprogram thedronewillbedriventoachievethereference state as close as possible.
in practice however the positioned statemaynotalwaysmatchthereferencestate thatis thedroneisdeviatingfromtheexpectedtrajectory.whenthedeviationissmall the control system can generate an actuator signal based on the differences between the current positioned state and the reference state.however anincorrectconfigurationmaytriggerasignificant deviation.
such a deviation may lead to an erroneous trajectory from which the drone cannot return back to the correct trajectory.
ifthedeviationexceedsagiventhreshold weconsidertheflight state as unstable i.e.
a deviation state.
dronecrash.
forgeneraldeviations thedronecanstilllandsafely eventhoughnotattheexpectedlocation.aworsecaseisadeviation leading the drone against an object and eventually to crash.potentialthrustloss.
bydrivingthedronemotor theflightcontrolprogramusesmotorpowertoadjustthedronetothereference state.nonetheless theadjustmentthatcanbedonebythedrone motor is limited.
if an incorrect configuration is set the drone may not be able to move close to the reference state even when saturating the motor up to throttle.
remaining in such an incorrect state can cause a decrease in the drone flight altitude or even a crash.post launch privilege escalation.
before taking off the flight controlprogramvalidatestheconfigurationanddetermineswhether it will trigger unstable flight states.
i.e.
the configuration is incorrect .whenoneormoreincorrectparametersoftheconfigurationsareidentified thecontrolprogramdisplaysawarningmessageand abortsthetaking offoperation.however iftheseconfigurations flagged as incorrect are set after taking off they can still be accepted by the flight control program.
as a consequence the drone may end up in some unstable states.
.
challenges inordertovalidateallconfigurationsanddetectrangespecification bugs the following challenges must be addressed challenge i how to validate configurations effectively?
approachesproposedforanalyzingflightcontrolprogramsaregenerally based on static program analysis techniques that explore control and data dependencies .
however such techniques are not suitable for validating configurations because large numbers of specified parameter values need to be analyzed.
unlike conventional bug detection techniques that statically analyze only smallcodesnippets theentireflightcontrolprogramneedstobe analyzedinordertoachievehighcodecoverage.thereasonisthatdifferentparametervaluesoftenresultinexecutionflowsinvolving verydifferentportionsofthecontrolprogram.unfortunately flight control programs have huge sizes e.g.
over 700k lines of code complicated control and data dependencies.
therefore it is critical that the approach designed for configuration validation be effective that is able to provide high coverage of all possible parameter values.
challengeii howtoconductanefficientconfigurationvali dation?
referringtotheunstableflightstatesdefinedinsection2.
we need to validate each configuration through either a realistic or simulated flight execution.
because of the large number of control parameters each with a wide value range changing the parameter valuestogenerateconfigurationsandvalidatingalltheseconfigurationsisinefficient.completingtheentirevalidationproceduremaythenenduprequiringhours.therefore existingapproaches which analyze all possible configurations are not suitable.
an alternativeapproach is touse fuzzing combinedwith a binary search to reduce thesearch space of the combinations tobeanalyzed.however althoughthesearchscopeisnarrowed the execution time increases because each fuzzing iteration needs to wait until the validation feedback of the previous configuration is obtained.
challenge iii how to balance the requirements of drone adaptabilityandflightstability?
theflightcontrolprogramsupportsdifferentconfigurationstoadapttodifferentflightmissions.
whenhighadaptabilityisrequired eachcontrolparametermust have a large value range to adapt to different scenarios.
as a result thenumberofincorrectconfigurationswillbehigher whichwill then affect flight stability.
on the other hand when parametershave small value ranges the possible configurations are limited which reduces adaptability.
hence complex flight missions cannot be carried out.
identifying proper value ranges is thus challenging.
.
solutions we propose three solutions to address the above challenges.
solution i grey box based fuzzing.
sincedependenciesofthe flight control program are complex simple static program analysis authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa ruidong han chao yang2 siqi ma jiangfeng ma cong sun juanru li and elisa bertino techniquesareineffective.ourapproachisinsteadtoconductgreybox based fuzzing by setting various configurations and validating thecorrespondingflightstates.inparticular weapplyagatocarry out fuzzing.
the algorithm first selects some parameter values and validatestheparameterconfigurationbypredictingitsimpacton the flight states.
after that referring to the validation result the algorithm conducts mutation to select alternative incorrect parameter values and set new configurations to validate.
the process of configuration searching is executed iteratively.
this approach addresses challenges i and ii.
solution ii flight state prediction.
although ga and fuzzing reducethesearchrangeofparametervalues thenumberofcombinationsisstillhuge.therefore validatingallthecorresponding configurations through realistic simulation execution is highly inefficient.inresponse wedesignedastategenerationapproachthat leveragesamachinelearningalgorithmtotrainastatepredictor.
insteadofvalidatingconfigurationsthrougharealistic simulation execution the state predictor takes each configuration as input andpredictsthepotentialflightstatetoguidethemutation.such an approach requires much less time than a realistic simulation execution.itisimportanttonotethatdatalabelingandpredictor generationareone timecosts.henceitisstillmoreefficienttoconduct prediction rather than a realistic simulation execution.
the reason is that configuration validation has to be executed iteratively wheneach new configuration isgenerated by themutation algorithm.
this solution addresses challenge ii.
solution iii multi objective optimization.
to balance adaptability and stability we utilize a multi objective optimization approach.
our approach estimates multiple feasible range guidelines accordingtothedetectedincorrectconfigurations.theoptimization target is to eliminate the incorrect configurations improve stability whileprovidingawiderrangeforparameters improve adaptability .eachsolutionofthemulti objectiveoptimization i.e.
range guideline is the best solution in specific conditions i.e.
the optimal balance of adaptability and stability.
our approach allows userstochooseanappropriaterangefrommultiplerangeguidelines based on their requirements.
this approach addresses challenge iii.
lgdfuzzer in this section we present the design of lgdfuzzer a system for findingrangespecificationbugsdronecontrolprogramsthrough learning guidedmutationsearch.wefirstpresentanoverviewofits architecture and then the detailed design of its three components.
.
overview of lgdfuzzer lgdfuzzer see fig.
contains three components state change predictor a module to predict the flight state and assess whether a configuration will lead to unstable states learning guided mutation searcher a ga search module to detect incorrect configurations range guideline estimator a module to provide secure parameter range guidelines.
lgdfuzzer relies on log entries that we generate by repeatedly executingdrone flightmissions .the logentriesare splitintofeasible rangestate change predictor learning guided mutation searcher range guideline estimatorpredictor generation cluster sampleexecution validation configconfigincorrect logmulti objective optimizationfeature dronepredictor spl samples searcher config individualsevaluation feedback break potentially incorrectsimulator 14iterated evaluate fitness figure overview of lgdfuzzer.
two groups one group is used by the state change predictor to generate a feature matrix containing vectors with flight states sensor data and configurations and another used by the learningguided mutation searcher to carry out cluster sampling .
by using the feature matrix lgdfuzzer then generates a predictor .
the searcher clusters data and selects representative samples from each cluster .
it further uses each representative sample to find out the corresponding incorrect configurations .
inparticular lgdfuzzeriterativelymutatestheconfigurationand usesthepredictortoevaluatewhichconfigurationismorelikely tocauseunstablestates .theiterativesearchwillstopwhen certainconditionsaresatisfied.alltheidentifiedpotentialincorrect configurationsare collected to construct a configuration set and validated by a simulation .
finally through the validation results the estimator uses a multi objective optimization to generatemultiplefeasiblerangeguidelinesthatbalanceavailability and stability under specific conditions .
.
flight log generation since there is no standard data set for testing drones in order toconstruct the feature matrix for the predictor and generate datafor the searcher we manually fly a drone through a simulator to generateanumberofflightlogs.whenflyingthedrone weseteachflightwiththesameflighttestmission avc2013 whichisoften used to test the drone mission execution capabilities.
the flight missionisrepeatedlyexecutedbysettingconfigurations.werecord all flight logs but discard those causing unstable states.
becauseunstable state data is uncontrollable and complex compared to stable state data dropping the unstable states prevents them from affectingthetrainingofthepredictor.intotal werecorded308 systemlogentries.eachentrycontainsstateinformationincludingangularposition angularacceleration throttlespeed sensordataofgps gyroscopes andaccelerometers thecurrentsetconfiguration and a timestamp index.
.
state change predictor sincethecontrolalgorithmestimatesthenextreferencestatebased on the current positioned state and sensor data we leverage a machinelearning ml predictortoemulatethecorrelationbetween input states and output states and then assess how the configurations affect flight states.
through the ml predictor lgdfuzzerexplores the diversity of flight states and configurations.
then it authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
detecting range specification bugs in drone configuration modules via learning guided search icse may pittsburgh pa usa calculatesthenextreferencestatewhichdemonstratesthedeviation caused by incorrect configuration accurately.
two steps are executed to train the predictor feature extraction andpredictor generation.
featureextraction.
giventhelogentries lgdfuzzerconstructs afeaturematrixbyselectingthespecificdata.sincewefocusonthe unstable states that affect flight attitude i.e.
angular and speed the predictor considers the following state sensor data and configurationsthatmightaffectflightattitude i angularpositionand angularspeedof the flight state a ii sensordata sobtained from gyroscopesandaccelerometers iii controlandmissionparameters oftheconfiguration x whichcouldadjustflightattitude.according to the above information lgdfuzzer groups them as a feature vector v c x wherec a s .
the vectors are further combined to construct a feature matrix.
predictorgeneration.
aslongshort termmemory lstm techniquehandlescomplicatedinput outputdataefficiently lgdfuzzer further utilizes lstmas the predictor to refer the next reference state.
specifically for a pre processed feature vectorvi ct xt with timestamp t lstmtakes a number hof consecutive vectors with timestamp lower or equal than tas input i.e.
v vt h ... vt vt and returns the maximum conditional probability prediction of the next reference state units a prime t .w e show in sec.
how we determine the best values for h. in the training stage the weight of the predictor is iteratively updated to ensure that the predicted reference state a prime t 1is closer to the ground truth state at .
we use the mean squared error mse loss for training.
.
learning guided mutation searcher to exploreincorrect configurations weuse aga a metaheuristic search relying on biologically inspired operators such as mutation crossover andselection.initially asincorrectconfigurationsmay only produce unstable states in specific contexts i.e.
state andsensor data our system conducts searches for multiple specificcontexts to find incorrect configurations.
we split the data from logsintomultiplesegments ci ci ci ... ci h imod h whereiistheindexoftherecordeddata.butconsideringthatthere aresimilaritiesamongsegments searchingforeachonewillgenerate a huge number of duplicate results.
to address such an issue we cluster the segments and sample from these clusters in order to reduceredundancywhilemaintainingdiversity.weleveragethe meanshift aprobabilitydensity basednon parametricadaptiveclusteringalgorithm toclustersegmentsandrandomlysample mrepresentative examples from each cluster for the subsequent search.
then for each sample segment the searcher carries outa ga search to explore incorrect configurations by iterative mu tation crossover and selection.
when the searcher has collected alltheincorrectconfigurationsforeachsample itmergesanddeduplicates them as a unique set referred to as set of potentially incorrect configurations.
in what follows we provide details on the fitness evaluation function used to evaluate the fitness of a configuration and the searching process.fitness evaluation function.
the ga search applies fitness to quantify by using the predictor how much deviation a given configuration may cause.
intuitively the fitness evaluation function returnstheprobabilityofdeviationforaconfiguration.specifically assumethatthecurrentsearchiscarriedoutforthecontextsegment c c1 ...ch ch thefunctionselects c prime c1 c2 ...ch tobeusedas inputtothepredictionmodeland ah 1ofch 1tobeusedasground truthforcalculatingthedeviation.whenevaluatingaconfigura tion x x1 ... xd dis the number of parameters the function mergesitwiththesegmenttocreatefeatures v c1 x ... ch x .
then suchfeaturesaregiven asinputtothepredictor whichreturnsapredictedreferencestate a prime h .thefitnessisthel1 distance bardblah a prime h bardblbetween the predicted state and the ground truth state.thegoalofthesearchisthentofindincorrectconfigurations whicharepredictedtomaximizethefitness thatis thedeviation and thus maximize the probability of causing unstable states .
searchingprocess.
foreachcontextsegmentsample thesearcher firstinitializesapopulationwhoseindividualsareconfigurations and the parameter values of each configuration are set to their defaultvalues.weassumethatthepopulationsizeis npandthe maximum number of iterationsis gmax.
the search process iteratively mutates and updates the population as follows.
intheg thgenerationiteration g thesearcherfirst mutatesthecurrentpopulation popg x1 g... xnp g andgeneratesa variantpopulation popv y1 g ... ynp g .
eachconfigurationof the variant population is obtained as follows yi g xi g f xbest g xi g f xr1 g xr2 g wherexr1 r2 gare random configurations xbest gis the best fitness configuration and fis the scaling factor.
then popgiscrossedoverwith popvtoproduceanewexperimental population pope e1 g ... enp g whosei th configuration isei g ei1 g ei2 g ... eij g wherej .the parametervalues eij gof each configuration are calculated as follows eij g braceleftbigg yij g i f r a n d cror j jrand xij g o t h e r w i s e wherejrandis a random integer in cris the crossover rate xij gisthej thparametervalueofthe i thconfigurationin popg andyij gis thej th parameter value of the i th configuration in popv.
then the searcher evaluates the fitness of each configuration both inpopgandpope.
according to their fitness the searcher selects some configurations from the population to obtain the next generation of population popg x1 g ... xnp g by using the following selection function xi g braceleftbigg ei g i f f ei g f xi g xi g o t h e r w i s e wherefis the fitness evaluation function.
finally ifthefitnessofeachconfigurationinthepopulationdoes not any longer increase or the maximum number gmaxis reached the search stops the mutation.
we select the top highest fitness configurations from the final generation population as incorrect configurations.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa ruidong han chao yang2 siqi ma jiangfeng ma cong sun juanru li and elisa bertino .
execution validation thepredictorclassifiesaconfigurationasincorrectiftheconfigurationhasahighprobabilityof causingunstablestates.ho wever the set of all such configurations needs to be validated to confirm that they actually cause unstable states.
we thus simulate the flight and use a monitor to observe which potential incorrect configurations actually lead to unstable states during the simulated execution.
specifically thedroneissetwithpotentiallyincorrectconfigurationstoperformthe avc2013flightmission.forflightfreeze ifthe dronemovesatdistancesalwayslessthan0 .5metersin15seconds themonitoridentifiesthisasaflightfreeze.fordeviations ifthe flight deviation continues to be times higher than .
meters the flight is considered a deviation.
.
range guideline estimator therangeguidelinesprovidedtotheusersshouldconsiderstability and adaptability while at the same time eliminating discrete incorrect configurations and reserving relatively complete space foreachparameter.meanwhile aswecannotensurethestability of unverified configurations the estimation of range guidelines shouldreferencetheobtainedvalidationresultsandrefrainfrom consideringincorrectconfigurations.therefore weleverageamultivariate optimizationto determine the suitablerange guideline.
if allparameter valuesina configurationarewithin therangespecified by the guideline we consider the configuration to be covered.
our system estimates the range guideline range prime based on the following optimization problem min f num rincorrect range prime num r range prime max f2 num r range prime s.t.
range prime originrange theoptimizationproblemhastwoobjectives a tomaximize the number of validated configurations rcovered by the guideline b to minimize the coverage of incorrect configurations rincorrect.
if weshrink theallowed rangesto avoid incorrectconfigurations therangeofeachparametervaluewouldalsoshrinkandviceversa.
therefore instead of defining strict ranges for each parameter the system solves this optimization problem with multiple constraints to obtain a diverse group of paretosolutions.
these paretosolutions form a boundary consisting of the best feasible solutions allowing users to select the best configuration according totheirrequirements.
the system provides this range guideline mainly basedonthefollowingconsiderations asthenumberofparam etersincreases itwouldbedifficulttocompletelyruleoutinsecureparametervaluesasthesecureparameterrangesmaynotbecontin uous.
whilestabilityisparamount usersmaybewillingtoincur some minor risk for better controlling flexibility or availability.
evaluation weassessedlgdfuzzerbyconsideringitseffectivenessandefficiencyinvalidatingconfigurations.thefollowingresearchquestions rqs were answered rq1 effectiveness.
how many incorrect configurations are detected by lgdfuzzer precisely?
rq2 adaptability.
canlgdfuzzerprovidethemostsuitablevalue rangesfor parameterswithminimum incorrect configurations?
rq3 enhancement.
how do the mutation and the predictor help improve configuration validation?
.
experiment setup weappliedlgdfuzzertoanopensourceflightcontrolprogram ardupilot .
.
which is widely used by drone manufacturers suchasparrot mamba andmateksys .tovalidateconfigurationsspecifiedin ardupilot weutilizedthreeexperimentalvehicles showninfig.
fortesting includingtwodroneswith pixhawk i.e.
cuav zd550 andamovlab z410 and a drone simulator i.e.
airsim .
a cuav zd550 b amovlab z410 c airsim figure real and virtual drone vehicles used for experi ments.
according to the control parameter descriptions provided by the manufacturer we selected parameters that may affect flight angularpositionandangular speed.wepro videdetailsaboutthese parameters in appendix a including the parameter name the parametervaluerange adefaultvalue andtheparameterdescription.
thepredictorandthegasearcherareimplementedinpython.
concerning the ga its evolutionary stagnation judgement threshold is set to .
the number of representatives mis set to and themaximumnumberofevolutionarygenerationsissetto200.we further setthe sizeof initialpopulation to i.e.
np and the scaling factor fto .
.
.
rq1 effectiveness toevaluatewhetherlgdfuzzeridentifiesincorrectconfigurations accurately wefirstassessedthepredictionaccuracyofthepredictor in theflight state predictorphase.
then wevalidated whether the predicted incorrect configurations can impact flight stability.
state prediction.
wefirstsent1 500configurationsto airsimto testandmanuallylabeledtheconfigurationscausinganunstable state and the ones resulting in a regular state.
the same method infitnessevaluationfunction wasusedtocalculatethedeviation for each configuration.
we calculated the average deviations of unstable states and regular states and regarded the median val ues between them as a threshold.
we then treated another configurations as test data to verify the accuracy precision and recall of predictors.
specifically our experiment first extracted the context i.e.
stateandsensordata segmentsfromlogdata.then eachlabeledconfigurationinthetestdatawasrandomlymerged with a segment and its deviation was calculated.
if the deviation is authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
detecting range specification bugs in drone configuration modules via learning guided search icse may pittsburgh pa usa greaterthanthethreshold thepredictorclassifiestheconfiguration as unstable and as stable otherwise.
table reports the performance of predictors with different input lengths h wheredcis the average deviation that the correct configurations affected and diis the average deviation that incorrect configurations caused.
table1 predictoraccuracy precisionandrecallfordifferent input lengths.
haccuracy precision recall dc di .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
his the input length of the model dcis the average deviation of correctconfigurations diistheaveragedeviationofincorrectconfigurations.
generally the results show that our predictor is robust when taking various input lengths.
the deviation values derived fromtheincorrectconfigurationsareobviouslylargerthanthevalues collectedfromthecorrectconfigurations.thatisthereasonwhy wecanusethepredictorinthegasearchtodriveconfigurationsto ahigherdeviation.inaddition theexperimentresultsshowthatthe recallofthepredictiondoesnotlinearlyincreasewhen hexceeds .
therefore we chose thepredictor with thebest recall i.e.
h as the input length to carry out the subsequent experiments.
to assess the prediction accuracy for state changes we sent the configurationsto airsimandrecordedthecorrespondingflightdata.
then werandomlyselected150consecutivefeaturesfromthedata gavethemasinputtothepredictortopredictthestatechange and compared it with the ground truth state.
the results in fig.
show that the predictions closely match the real states an example of angle roll .
in the figure the dotted curve denotes the actual states thesolidcurvedenotesthepredictedstates andthehistogramatthe bottom the blue bar indicates the prediction errors as differences betweenthetwocurves.thesmallerrorshowedthatthetrained predictor can accurately predict flight state changes.
figure match between real behavior and prediction.
configurationvalidation.
giventhepredictedincorrectconfigurations we validated them through realistic simulation execution.
sincetheincorrectconfigurationsmaycausedronecrash weexamined all of them on airsim.
for the samples obtained byclustering and sampling lgdfuzzer searched out unique incorrect configurations.
finally after a validation configuration of were marked as truly incorrect resulting in deviations 2flight freeze 2crashes post launch privilege escalation and potential thrust losses.
.
rq2 adaptability inthisexperiment weusedthepreviousvalidationresultsabout incorrectconfigurationstoestimatetherangeguidelines anddiscussed how they balance stability and adaptability.
with reference tothevalidationresults theestimatorfoundout143 paretosolution results see fig.
.
in the graph the horizontal axis represents the number of validated configurations covered by the range guideline and the vertical axis represents the ratio of incorrect configuration in the range guideline.
each paretosolution represents a feasible solution i.e.
range guideline satisfying specific constraints i.e.
adaptability and stability constraints .
figure paretofrontier solution.
forinstance weselectedsomerangeguidelineexamplesintable andfurther analyzed theirstability and adaptability.
to illustratethemodifiedguidelinesgeneratedbylgdfuzzer weselected severalparametersoutof20onestoshowtheirdetails.thetable shows three examples in which stability decreases and the configurable space i.e.
adaptability increases.
guideline i avoids the majority of incorrect configurations.
it covers validated configurations onlyoneofwhichcausedanunstablestate thismeanshigh stability.however comparedwiththeoriginalparameterranges thisguidelinereducestoomuchtheavailablespace whichresulted in low adaptability.
in contrast guideline iii reserves relatively complete ranges for the parameters.
it covers validated configurationsbutmorethanhalfofthem areincorrect which resulted in low stability.
guideline ii is an intermediate choice covering validated configurations where only are incorrect.
ifusershavemorestringentstabilityrequirements theycanuse the lower error ratio range guideline at the cost of limiting the configuration space and thus being unable to satisfy other flight re quirements.onthecontrary ifusershavetosatisfyspecialmission requirements e.g.
the mission is a time limited task or it needsa large flight angle to reach the target speed they may consider sacrificingabitthestabilityinordertoimproveadaptability.infact they can choose an appropriate range guideline from the pareto solutionsaccordingtotheirstabilityandadaptabilityrequirements.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa ruidong han chao yang2 siqi ma jiangfeng ma cong sun juanru li and elisa bertino table examples of feasible range guideline parameterguideline i guideline ii guideline iii lu reduce lu reduce lu reduce psc posz p .
.
.
.
.
.
.
.
.
atc ang rll p .
.
.
.
.
.
.
.
.
atc ang pit p .
.
.
.
.
.
.
.
.
atc rat pit p .
.
.
.
.
.
.
.
.
atc rat pit i .
.
.
.
.
.
.
.
.
atc rat yaw i .
.
.
.
.
.
.
.
.
wpnav speed .
.
.
wpnav speed up .
.
.
i c v coverage covered total validation .
.
.
.
.
.
.
.
.
lisrangelowerbound uisrangeupperbound reducediscalculatedrelativetooriginalrange iisthenumberofincorrectconfigurations covered by the range guidance cis the number of correct configurations covered by the range guidance vis the number of validated configurations covered by the range guidance.
.
rq3 improvement to show the advantages of our system we experimentally compareditwithrvfuzzer arecentapproachforsearchingrange specificationbug.rvfuzzerreliesonthe one dimensionalmutation andmulti dimensional mutation search to detect incorrect configurations.byusing one dimensionalmutation centeredonthedefault parametervalues rvfuzzerseparatelyconductsbinarysearches to narrow the upper and lower bounds until a midpoint value is obtainedthatdoesnotanylongercauseunstablestates.inthe multidimensional mutation multiple parameters are considered each of which determines a novel binary mutation search configured with differentextremevalues i.e.
maximumandminimum oftheother parameters.alltheseexperimentswerebasedonthesixparameters utilized in rvfuzzer see appendix a .
in the experiments we considered the unstable states listed in section .
.
comparisonwithrespecttomissedincorrectconfigurations.
in theone dimensional mutation the optimal solution may not be consistent with the right optimum.
for example using such a mutationstrategy thesearchindicatedthatthecorrectrangefor ins pos1 z should remain within when it searched for thelowerbound.however therewerestillincorrectconfigurations specificallybetween .0and0.
insidethis range.thereasonis that becauseofthebinarysearch asthefirstmidpoint i.e.
.
didnotcauseanunstablestate thesearchdirectlyskippedvalues greater than .
.
it thus did not cover the space which resulted in missing potentially incorrect configurations.
in the case of multiple parameters mutations we first applied themulti dimensional mutation to determine the correct range.
after that based on this correct range we leveraged lgdfuzzer to start another search to evaluate whether there are incorrect configurations.
lgdfuzzer still detected potentially incorrect configurations of which only were confirmed.
such a result indicated that the ranges provided by the multi dimensional mutationarenotcorrect.inouropinion the multi dimensionalmutation isstill aone dimensionmutation because itusesbinary searchto mutate parameters separately but only imports the extremes of the value ranges of other parameters.
it can be regarded as multipleone dimensionalmutationswithalimitedcorrelationbetweencon trolparameters assuch itdoesnotconsidertheinfluenceofvalues different from the extremes of the ranges.
comparison withrespect to correctrange guidelines.
the six parameters utilized in this experiment are listed in appendix a. we leveraged lgdfuzzer to search incorrect configurations for these six parameters.
the search detected unique potentially incorrectconfigurations.thenthevalidationdeterminedthat714 out of those configurations actually leaded to unstable states.
after that we used them to generate the feasible range guidelines and chose the lowest incorrect ratio result.
table lists the ranges obtainedbythreemethods where 1isone dimensionalmutation mismulti dimensionalmutation andga ourgeneticalgorithm mutation .
rvfuzzer method 1obtained little reduction for each parameter range thus it is not able to rule out incorrect configurations.
m avoidedsomeoftheincorrectconfigurationsbutstillmissesothers.
because our gagreatly reduced the ranges it provided high stability.
a special case is related to ins pos3 z the range given by ga is larger than the range given by m. but this does not mean that our range for ins pos3 z is incorrect.
the reason is that as other parameters have a smaller range ins pos3 z can have a larger range since the validity of configurations is decided based on multipleparametersinsteadofasingleone.asforotherparameters angle max influences the flight inclination angle.
under the influence of other parameters a too large value for angle max is more likely to cause flight problems.
a too small value for the waypoint speed wpnav speed makes the drone more likely to freeze both mandgareducesthelowerpartoftherangeforthisparameter.
forins pos z the ranges returned by gaare smaller than the ones returned by m and closer to default values.
in fact changingins pos z influences the position judgment of the inertial measurement unit.
therefore this parameter should be changed carefullyandshouldnotdeviatetoomuchfromthedefaultvalue.
psc velxy p affected the output gain of the system for acceleration a too large gain can easily cause drone deviations or thrust losses.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
detecting range specification bugs in drone configuration modules via learning guided search icse may pittsburgh pa usa table comparison of range guideline.
parameter1 m ga lu lu lu psc velxy p .
.
.
.
.
.
ins pos1 z .
.
.
.
.
ins pos2 z .
.
.
.
.
.
ins pos3 z .
.
.
.
.
.
wpnav speed angle max i v c one dimensional mutation m multi dimensional mutation ga genetic algorithm mutation lis range lower bound uis range upper bound iis the number of incorrect configurations covered by the range guidance cis thenumberofcorrectconfigurationscoveredbytherangeguidance visthe number of validated configurations covered by the range guidance.
comparison with respect to time requirements.
we analyzed the time taken by lgdfuzzer and multi dimensional mutation.
to determine the range guideline for the six parameters we started multiple simulations and took seconds to collect log data.
the predictor took seconds to train until reaching convergence.
the ga search took another seconds to iterateand updated its population configurations .
finally from generating data to searching out incorrect configurations our system totally took seconds.
also over configurations were validated and detected to actually cause unstable states.
on the contrary depending on the configuration values rvfuzzer usually took between and seconds per round to complete aavc2013 flightmission.evenwhenweallocated1 552seconds tomulti dimensionalmutation itcanonlycarryout78roundsof mission test.
in fact the multi dimensional mutation search took roughly2hourstoestimatetheguidelinesforthesixparameters.
in addition for parameters the time taken by multi dimensional mutation increasedexponentially.instead thetimeconsumption of lgdfuzzerwasstillclosertothetimeconsumptionrequiredby six parameters because the time required by predictor was almost unchanged.
.
case studies after obtaining the fuzzing results we selected several representative examples of unstable states to analyze their characteristics.
deviation.
therearetwomaindeviationsituationsinourexperiment overshoot and fly away.
when flying from one waypoint toanother thedronefirstacceleratestoreachthetargetvelocity anddecelerateswhileapproachingthenextwaypoint.iftheconfiguration is set improperly the dr one is unable to re duce its speed when close to the waypoint which caused an overshoot deviation see the video of a simulation in which the drone is not able to break at .
in comparison fly away is much more dangerous in thatthedronekeepsmovingawayfromitsmission plannedpath.
we leveraged a real drone experiment to demonstrate the damage resultingfromthoseunstablestates.theexperimentsetupasimplesurroundflightmissionandadroneconfigurationissetthat inthe simulationtest resultedinaflyawaydeviation.asshowninthe video thedronedeviatedfromthemission plannedpath.unfortunately eventhoughweusedtherccontroller remotemanualcontroller tomanuallyswitchitsmodeto landinordertostabilize thedroneandmakesureitwouldlandslowly thedronewasstill unable to stabilize and kept deviating.
in fact after checking theoffline flight log when we manually switched to the landmode thesystemreportedaswitchingerrorindicatingthatitcouldnot stabilize and land.
in other words if the incorrect configuration is not dealt with in time the flight stability cannot be even corrected manually.
flightfreeze.
therearetwomainsituationsofflightfreeze.on theonehand anincorrectcontrolgainparametermakesthedrone failtoreachthedesiredpositionintime orprolongthetimetoreach aparticularwaypointorthedesiredposition.ontheotherhand aninvalidconfigurationaffectsthepositionandcausesthedrone to around flight within a small area.
we tested the around flightsituation with a real drone experience.
the video at showed thatthe drone keepscirclingand wasunableto completethegiven mission.
we analyzed the offline flight log and from the log wecould see that the drone kept flight switching between althold hovering fly and landbut could not land successfully.
drone crash.
drone crash may be caused by a rollover during takeofforbyhittingthegrounddue toimproperdescent speed.the videoat showedanactualexampleofadronecrashingwhen taking off.
potential thrust loss.
thissituation ismainly causedbyan excessivechangeinangleors peed the flightcontrollerattemptsto recoveritspositiontonormal butthepowerofthemotorcannot satisfytherequirement.failureinrecoveringfromthethrustloss or stabilizing the altitude would lead to a drone crash.
in the postmortemanalysis wefoundthatchangingthecontrolparameters relatedtotheinertialmeasurementunitposition e.g.
ins pos z andthepidanglecontroller e.g.
atc ang p i d canforcethe drone into a gradually amplified oscillation.post launchprivilegeescalation.
post launchprivilegeescalationisthenewtypeoferrorwedefined.acontrolprogramusually containsacheckingmechanismtopreventobviouserrorsinconfig urations.iftheparametersarerelatedtothepositioncontroller e.g.
atc p i d theincorrectconfigurationwillraiseawarning when the gcs tries to arm the drone.
but in fact if we update the configuration after the drone takes off the problem is that the control system still accepts it which ultimately drives the drone to become unstable and out of control.
the video at showed an example in which uploading an incorrect configuration during the mission causes the drone to crash.
related work .
drone fault detection a large number of drone fault detection methods systems have been proposed to prevent errors during flights.
among them an invariant approach uses the control invariant to identify physicalattacksagainstroboticvehicles.buttheirapproachisunableto prevent attacks thatexploit the range specification bug.todetect faultycomponentsinadronesystem afaultdetectionmethod constructsanobservermodeltoestimatetheoutputinfault free authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa ruidong han chao yang2 siqi ma jiangfeng ma cong sun juanru li and elisa bertino conditions from the history inputs and outputs.
such a system utilizesthedifferencebetweenactualoutputsandthepredictedvalues todetectfaultysensorandactuatorcomponents butitstilldoesnotconsidertheinstabilitycausedbyrangespecificationbug.aneural network based validation approach leverages the analytical redundancy between flight parameters to detect sensor faults.
like the other approaches it only considers external factors.
in comparison lgdfuzzer implements a search system to avoid incorrect configurationsthat are instability factors within the system.
.
learning based testing fromtheperspectiveoflearning basedtesting therearethreerelevant systems or methods.
neuzz is a gradient guided search strategy.
it uses a feed forward neural network to approximateprogrambranchingbehaviorsandpredictthecontrolflowedges tocovermoretestspace butthepredictivemodelisnotusedfor guiding testing.
exploitmeter uses dynamic fuzzing tests with machine learning based prediction to update the belief in software exploitability.
a learning guided fuzzing uses an lstm network to model the input output relation of the target system and a meta heuristic method to search for specific actuator commandsthat could drive the system into unsafe states.
a reinforcement fuzzing appliesadeepq learning algorithmtogeneratean optimizedpolicyforthefuzzing basedtestingofpdfprocessing programs.deepsmith trainsagenerativemodelwithalarge corpus of open source code and uses this model to produce testinginputstoexaminetheopenclcompilerautomatically.these approaches make use of prior knowledge to drive the mutation input.
similarly we introduced a machine learning model to guide the search test process.
however our lgdfuzzer combines the modelwiththegeneticalgorithmtocarryoutalarge scalemultiparameter search.
conclusion incorrect configurations of drone control parameters set by legitimateusersorworstsentbyattackers canresultinflightinstabilitiesdisruptingdronemissions.inthispaper weproposeafuzzing based systemthat efficientlyand effectivelydetectsthe incorrectparameterconfigurations.lgdfuzzerusesamachinelearning guided fuzzing approach that uses a predictor a genetic search algorithm and multi objective optimization to detect incorrect configurations and provide correct feasible ranges.
we have experimentally compared lgdfuzzer with a state of the art tool.
the experimentalresults show that lgdfuzzer is superior to such a tool in all respects.
even though our methodology has been designed for aerial drones webelievethatitcanbeusedforothermobiledeviceswith complex controls such as underwater drones.
acknowledgment we would like to thank anonymous reviewers for the insightful comments.thisworkissupportedbythefoundationforinnovative research groups of the national natural science foundation of china grant no.
.