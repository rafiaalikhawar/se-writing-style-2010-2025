r2z2 detecting rendering regressions in web browsers through differential fuzz testing suhwan song seoul national university seoul south korea sshkeb96 snu.ac.krjaewon hur seoul national university seoul south korea hurjaewon snu.ac.krsunwoo kim seoul national university seoul south korea sunwoo28.kim snu.ac.kr philip rogers google mountain view ca united states pdr google.combyoungyoung lee seoul national university seoul south korea byoungyoung snu.ac.kr abstract arenderingregressionisabugintroducedbyawebbrowserwhere a web page no longer functions as users expect.
such rendering bugscriticallyharmtheusabilityofwebbrowsersaswellasweb applications.theuniqueaspectofrenderingbugsisthattheyaffect thepresentedvisualappearanceofwebpages butthosewebpageshavenopre definedcorrectappearance.therefore itischallenging to automatically detect errors in their appearance.
in practice web browservendorsrelyonnon trivialandtime prohibitivemanual analysis to detect and handle rendering regressions.
this paper proposes r2z2 an automated tool to find rendering regressions.
r2z2uses the differential fuzz testing approach whichrepeatedlycomparestherenderingresultsoftwodifferent versions of a browser while providing the same html as input.
iftherenderingresultsaredifferent r2z2furtherperformscross browsercompatibilitytestingtocheckiftherenderingdifferenceisindeedarenderingregression.afteridentifyingarenderingregression r2z2will perform an in depth analysis to aid in fixing the regression.
specifically r2z2 performs a delta debugging like analysistopinpointtheexactbrowsersourcecodecommitcausing the regression as well asinspecting the renderingpipeline stages to pinpoint which pipeline stage is responsible.
we implemented a prototypeof r2z2particularlytargetingthechromebrowser.so far r2z2found previously undiscovered rendering regressions in chrome all of which were confirmed by the chrome developers.
importantly in each case r2z2correctly reported the culprit commit.
moreover r2z2correctly pin pointed the culprit rendering pipeline stage in all but one case.
corresponding author permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe firstpage.copyrights forcomponentsof thisworkowned byothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa copyright held by the owner author s .
publication rights licensed to acm.
acm isbn ... .
concepts software and its engineering software testing and debugging.
keywords rendering regression web browser differential testing acm reference format suhwan song jaewon hur sunwoo kim philip rogers and byoungyoung lee.
.
r2z2 detectingrenderingregressionsinwebbrowsersthrough differential fuzz testing.
in 44th international conference on software engineering icse may21 pittsburgh pa usa.
acm newyork ny usa 12pages.
introduction a rendering regression is a bug introduced by a web browser where a web page s visual appearance no longer matches what users expect.
rendering regressions impact the usability of web browsers the revenue of websites as well as long term trust in webbrowsers.asanexample amajorcloudcomputingplatform servicenow suffered a service outage due to a rendering regres sion where chrome failed to paint parts of the web page .
accordingtothechrometeam sbugtracker 400bugswerefiled against rendering related components i.e.
dom style layout and paint between and highlighting the non trivial andprohibitivedevelopmentcoststomaintaincorrectrenderingin chrome.
the unique aspect of rendering bugs1is that they affect the presentedvisuallookofawebpagewhichhasnoclear formallydefined notion of a bug decision boundary.
in particular we found twokeychallengesrelatedtorenderingbugs.first itischallenging to identify rendering bugs because it is difficult to determine thecorrectness of rendering results.
the correctness of browser rendering is mostly dictated by the complex html and css specifications which are difficult to completely express into programmable software friendly conditions for automated verification.
further more specifications are incomplete and do not cover all aspectsof rendering e.g.
table width distribution is only partially spec ified .
second even after identifying a rendering bug it is challengingtoanalyzeandfixit.unlikememorycorruptionbugs rendering bugs do not raise an immediate violation so they do 1in this paper the word bug implies regression bug if not specifically mentioned.
ieee acm 44th international conference on software engineering icse icse may pittsburgh pa usa suhwan song jaewon hur sunwoo kim philip rogers and byoungyoung lee notleaveaclueaboutwhichcodeisresponsibleforabug.worse yet for performance rendering is processed through a multi stage pipeline further complicating the bug analysis.
we note that these unique aspects and challenges are not present in common traditionalbugssuchasmemorycorruptionbugs whichcanbemodeled usingaclearviolationconditionafterdefiningavalidmemoryregion .
inthispaper wepropose r2z2 adifferentialfuzztestingtechnique to find rendering regressions in web browsers.
in order to addresstheaforementionedtwochallenges r2z2 sapproachescan besummarizedintothefollowingtwofeatures.first r2z2features abugoraclealongwithrenderingchangedetection.
r2z2runstwo versionsofabrowserwitharandomlygeneratedhtmlfile and attempts to identify rendering image differences.
in order to avoid falsepositivebugs r2z2developedaregressionoracle whichiscapableofdeterminingifagivenbugisindeedarenderingregression bugornot.thisregressionoracleexploitstwointerestingcharacteristicsin webbrowsers ifmultiple independentlydeveloped browsersgeneratethesamerenderingresultsfromthesamehtml input it is likely that both produce the correct rendering and browserdevelopersaddatestcasewhenthereisarenderingfeature update which can be used to validate the rendering correctness with respect to the new feature.
second r2z2features two automated analyses the bisect analysis and the rendering pipeline analysis which pinpoint the culprit commitandpipelinestageresponsibleforthebug.asdevelopers are currently this manually we believe r2z2 s automated analyses can significantly reduce engineering costs.
more specifically r2z2designs fourcomponents i change detector ii bisect analysis iii regression oracle and iv rendering pipeline analysis.
the change detector finds any html file where renderingresultsaredifferentacrosstwodifferentbrowserversions.
then the bisect analysis finds the culprit browser commit which firstintroducestherenderingdifference.oncefindingtheculprit browser commit the regression oracle determines if the rendering difference is truly due to a regression bug.
lastly the rendering pipelineanalysisperformsin depthdifferentialtestingtopin point which pipeline stage is responsible for the regression.
we implemented r2z2and evaluated it with the popular web browser chrome.
in the courseof our evaluation r2z2identified 11new renderingbugs allof whichare confirmedbythe chrome developers.forthoserenderingbugs r2z2correctlypinpointedthe culprit commit.
r2z2also correctly pinpointed the culprit pipeline stage in all cases except one demonstrating its practical ability to assist in the bug fix process as well.
the key point that r2z2exploits is that differential testing is made possible by the existence of multiple independently devel oped implementations and we can use that to bootstrap quality in all web browser implementations.
hence the general ideas and lessons that we developed and learned from r2z2can further be utilized for various suites of programs meeting this criterion in the future.theseprogramsincludeanysetofmultipleindependentimplementations targeting the same standards such as pdf viewers svg engines java virtual machines or ssl tls servers or clients.
to summarize this paper makes the following contributions design.
we designed r2z2 a differential fuzz testing tool to automaticallydetectbrowserrenderingregressionbugs.afterdetectingrenderingimagedifferences itfeaturesabugoracle to filter out falsepositive cases.
r2z2also performs automated analyses to spot a specific code commit and pipeline stage responsibleforthebug whichcansignificantlyreducetheentailed engineering costs.
promising results.
while performing the evaluation r2z2 found11newrenderingregressionsinchrome.allofthesewere confirmed by the chrome developers and six have already been fixed.forallbugs r2z2correctlyspottedtheculpritcommit.for allbugsexceptone r2z2correctlyspottedtheculpritrendering pipelinestage.theseresultssuggestthestrongpracticalaspects of r2z2 to detect and triage browser rendering bugs.
background .
fuzz testing and differential testing fuzzing.
fuzzingisapopularbugfindingtechnique.itrepeatedly generates random test cases to run against a target program and monitors for erroneous behaviors such as crashing hanging or memory access violations.
from an engineering point of view fuzz testing doesnot require expert domainknowledge of atarget pro gram so it has been widely used in various software applications.
most fuzzers are designed to find bugs where it is easy to expressthebuggyconditions socallednon semanticbugs .thisis relatedtothefactthatafuzzeralonedoesnothavethecapability to detect a bug it has to observe a certain buggy condition during the fuzzing.
as such most fuzzing techniques have been proposed tofindmemorycorruptionbugs whichare operated with the memory error detectors which clearly exhibit buggy conditions e.g.
asan and ubsan .
differentialtesting.
fuzztestingaloneisnoteffectiveinfinding semanticbugs becausesemanticbugsaredifficulttoexpress as a bug condition and thus require domain knowledge to determine.inthisregard differentialtestingmethodscanbeaneffective technique to find semantic bugs.
differential testing runs multiple programs all of which are supposed to produce the same output for the same input.
differential testing then compares the outputs and if the output is different it determines that the program likely hasasemanticbug.forinstance previousworksleverageddifferential testing to find semantic bugs in java virtual machines jvm ssl tlsimplementations webbrowsers graphicdriverlibraries and cpu rtls .
in fact fuzz testing and differential testing can be employed together if the input of the differential testing is provided through the fuzzing procedure which we refer to as differential fuzz testing throughout this paper.
.
the rendering pipeline of a web browser renderingistheprocessofturningresources e.g.
htmlandcss into pixels.
modern web browsers including chrome firefox and safari useroughlythesamehigh levelsteps whichform the rendering pipeline dom style layout paint.dom.
the document object model dom is an in memory tree of nodes with the most common node types being elementand text.
the dom is initially constructed from an html file using a well definedparsingalgorithm andcanlaterbemodifiedusing 1819r2z2 detecting rendering regressions in web browsers through differential fuzz testing icse may pittsburgh pa usa !
!
!
.
.
!
.
!
.
.
figure the high level rendering pipeline of modern web browsers.
javascript apis.
for example in the dom tree construction shown infigure1 b theelementnodesare html head style body and div and there is a text node with the string hello world .
style.visualeffectsareappliedtodomnodesbythestylestep.
cascading style sheets css defines style properties such as font size background andposition.
css also defines selectors formappingthesepropertiestodomnodes.thestylestepdeterminesthecsspropertiesandvalues togethercalledthe computed style that apply to each dom node.
for example as described infigure c the divelement has the css property background with value aaa.
layout.
layouttakesthedomnodeswithcomputedstylesand computes boxeswithsizeandlocation.aboxcanbeassimpleasan individualnodeinthedomtree.multipleboxescanbecreatedforadomnode suchasoneboxforeachlineoftext.cssspecifications definewhentocreateboxes aswellashowtocalculatetheirsize andlocation.forexample asshownin figure1 d the hello world textnodeproducesoneboxforeachline.thesizeofthetextresults in the box for the parent divexpanding to 706pxtall.
paint.paint iterates the boxes from the layout step in back tofront order to produce low level graphics instructions i.e.
paintrecord .
css specifications define the order .
for example in the case of the div the rectangular background with color aaa would be painted before the text hello world .
then pixels are finallyproducedbyrasterizingthepaintrecords.additionally some compositor only css properties such as scrolling effects and 3dtransforms are applied at this step.
threaded compositing orjust compositing is the use of two techniques to improve the efficiency of rasterization threading andcompositing.
threading is theoptimizationofrasterizingononeormoreadditionalthreads.
compositingistheoptimizationofcachingportionsofrasterized outputthatchangetogether.theportionsofrasterizedoutputfrompaintrecordsthatchangetogetherareplacedinthesamelayer.for scrollingcontent therasterizedpixelsforanentirescrollingarea are cached in a texture which avoids needing to rasterize on every scroll.
.
rendering bugs a rendering bug is a bug where the browser fails to render a given page according to html and css specifications if specified or how the user expects.
rendering bugs can manifest in many different ways to users.
for instance if the layout stage has a bug the browsermayincorrectlyplaceanhtmlelement harmingthe1 html style .class7 backdrop filter hue rotate 1deg filter brightness .
padding style body the example of rendering bug span class class7 span body html a poc html code b correct chrome c incorrect chrome figure2 arenderingbugexample chromeissue .
a correct chrome .
.
b incorrect chrome .
.
figure3 therenderingbug chromeissue which was triggered on apple s homepage com.themenubarisdisappearedontheright highlighted with the red box .
userexperiencebydisruptingtheweb pagelayout.takinganotherexample ifthepaintstagehasabug visualeffectsonsomecontent may be incorrect .
weexplaintheexampleofarenderingbugthroughthehtml code as shown in figure .
in this example css style filteris appliedto span element.thus thecorrectrenderingistopaint the span element with gray which is rendered by chrome .
however chrome renders this incorrectly painting the outside of span element with gray as well.
the root cause of this bug is that chrome incorrectly includes the empty rectangles i.e.
width and height are zero if their offsets are outside the frame so the area specified by span is over extended.
if such a web page is used for commercial services rendering bugscancriticallydamagethereliabilityandfidelityofthepage.for instance figure 3shows a case where a rendering bug made the menu bar unusable on apple s homepage.
1820icse may pittsburgh pa usa suhwan song jaewon hur sunwoo kim philip rogers and byoungyoung lee challenges and our approach thissection firstidentifies challengesin identifyingrenderingregressions in web browsers .
.
then we shortly describe our approach to address these challenges .
.
.
challenges of rendering bugs inthissubsection weelaborateontwochallengesinidentifying and analyzing rendering bugs.
challenge identifying rendering bugs.
in order to detect the rendering bugs one should be able to clearly determine the correctness of the rendered result.
however it is challenging to design sucha rendering bugoracle.
this isprimarily becauserendering bugs are semantic bugs the rendering bug involves se mantically incorrect rendering results which violate html andcss specifications where it is difficult to confirm semantic correctness incorrectnessthroughautomatedorprogrammatictechniques.inotherwords givenanhtmlanditsrenderedresult it is challenging to develop systematic mechanisms or tools which determine if the rendered result indeed follows the html and css specifications .
forthis reason in practice renderingbugs areconfirmedthroughmanualinspectionbydomainexperts i.e.
browser developers .
there have been two general research directions to handle this issue i formalized methods and ii differential testing.
formalized methods attempt to statically verify if the browser implementation of the browser follows html and css specifi cations.
using various static analysis techniques such as formal verification techniques or symbolic execution this method can completelyinspectthecorrectnessofanentirebrowser srendering implementation.
however converting the html and css specifications to formalized rules is labor intensive and error prone demandingexpertdomainknowledgeofspecificationsaswellas browser implementation.
differentialtestingcomparestheresultoftwodifferentbrowsers to detect rendering bugs.
it determines there is a rendering bug when two browsers produce different results e.g.
two rendered images fromthesamehtmlinput.unlikeformalizedmethods this approach can be easily adapted to detect the rendering bugs asitdoesnotrequiredomainknowledgeandhumaneffortssuch as writing formalized rules.
in practice however the rendered imagegeneratedfromthesamehtmlcanbequitedifferentacross different browsers due to benign browser incompatibilities.
we observe two main factors behind benign browser incompatibilities.
first web browsers can have different development status in supporting features so a certain standard feature may or may notbesupportedbyeachbrowser.asaresult renderingresultsforsuchapartiallysupportedfeaturearedifferentacrosswebbrowsers.forinstance css contain strict issupportedbychromebutnot safari illustrated in figure .
thus chrome and safari render the htmldifferently.second webbrowsersgeneratetheirownunique rendering for featuresthat are not specified by specifications i.e.
under specified .
for instance the designs of input type file in chrome and firefox are different introducing rendering results differences illustratedin figure5 .therefore differentialtesting alonecangeneratemanyfalsepositivesduetothesebenignbrowser incompatibilities.
style 2div contain strict height style div invisible if 8contain is supported div a example code b chrome c safari figure example of supported feature differences.
html head head body input type file body html a example code b chrome c firefox figure example of benign design differences.
inshort bothpreviousapproachessufferfromhighfalsepositives.inpractice browserdevelopersinvestconsiderablemanual effort to identify rendering bugs.
if any rendering issue is reported manual analysis is needed to confirm if a bug is present imply ing that the complete automation of detecting rendering bugs is challenging.
challenge analyzing rendering bugs.
we find that it is difficult to analyzeand fix renderingbugs due to the following two mainfactors complexrenderingpipeline and2 semanticbug.
inordertofixarenderingbug itisessentialtofindoutwhichstage of the rendering pipeline and which part of code in the stage has a bug.
however as described in .
the rendering pipeline of the browserislong andeachstageofthepipelinehashighcomplexity aswellasadependencyontheresultofitspreviousstage factor1 .inaddition renderingbugsaresemanticbugssotheydonotgenerate a clear violation such as crash factor .
in the case of memory corruptionbugs theydisplaytheviolationsothatthedevelopers canobtainclearviolationcontextsfromtheviolationfordebugging.
however unlike the memory corruption bugs it is challenging to get clear violation contexts without any violation signal from a renderingbug soonly renderedresults maysuggest theviolation context.inordertopin pointthetrueviolationcontext onemay need to manually trace back the complex implementation of the rendering pipeline.
in this respect previous work only focused on howtofindthebug nothowtoaidinfixingthebug.inpractice browser developers rely on manual analysis to fix rendering bugs.
.
our approach to address the challenges that we described in .
we propose two approaches.
approach bug oracle along with change detection.
we add the bug pseudo oracle capability .
along with the changedetectioncapability .
.previouswork onfuzzingordifferential testing focusesondetectingchanges.however changedetection 1821r2z2 detecting rendering regressions in web browsers through differential fuzz testing icse may pittsburgh pa usa alone may generate false positives as we mentioned in .i no r dertosolvethischallenge weproposetheregressionbugoracle component which can reduce the false positive issues.
the key idea of the regression oracle is to use cross browser interoperability to detect correctness.
cross browser interoperability is where different browsers e.g.
chrome and firefox generate the samerenderedresultfromthesamehtmlfile becausetheyfollow the same html and css specifications.
therefore it is worth notingthatwhentwodifferentbrowsersrenderthesamehtmlthe same wecansaybothbrowsersproperlyrenderthehtml andtherenderedresultcanbethereferenceresultofthehtmlfile.inthis respect we canusethis referenceresultasan oracletodetermine whether a new browser version is correctly implemented.
we will explain the details of regression oracle in .
.
approach automated rendering bug analysis.
we followed the manual bug analysis process of browser teams and automatedit.inthebuganalysisprocess weobservedthatthebrowser team manually performed version bisect and pipeline pin point analysis.
the version bisect is to find out which commitintroduces a bug.
the pipeline pin point analysis is to find out which stage of the rendering pipeline triggers a bug.
r2z2automates the version bisect through the bisect analysis .
andthepipelinepin pointanalysisthrough thebugrendering pipeline analysis .
.
first the key idea of bisect analysis istoutilizethedeltadebuggingtechniquealongwithchangedetection.theintuitionbehinddeltadebuggingisthattherendered image should be significantly changed before and after the culprit commit.inordertoautomaticallypin pointtheculpritcommit the bisect analysis performs a binary search using the change detector.
second the key idea of the rendering pipeline analysis is to utilize the cross version differential testing to compare the results of each pipeline stage in order.
the intuitions here are thereshould be a culprit stage which introduces the rendering bug inthe rendering pipeline and the culprit stage is the stage thatgenerates the different results in two versions for the first time becauseeachstageofrenderingpipelinegeneratesitsoutputbased on the output of its previous stage.
in this respect the renderingpipeline analysis sequentially compares the results of each stage from two adjacent versions of the browser which is obtained from thebisectanalysis.then iftheresultsofacertainstagearedifferent the analysis regards that stage as the culprit stage and terminates.
design nowwedescribethedesignof r2z2.theoverallworkflowof r2z2 isshownin figure6 whichhasfourcomponentsoperatinginorder change detector .
bisect analysis .
regression oracle .
and rendering pipeline analysis .
.
thechangedetectorin r2z2firstgeneratesanhtmlfile which werefertoas html .thenitopens htmlusingtwodifferentversions of the same browser say aandb and captures two rendered images 1infigure .
next it checks whether two rendered results aredifferent.ifdifferent r2z2minimizes htmlanddeterminesthat htmlhasapotentialtobearenderingbug whichwecallacandidaterenderingbug htmlcandbug .thenextisthebisectanalysis whichfindstheculpritversion i.e.
culpritcommit raisingthefirst !
!
!
!
!
!
!
figure the overall workflow of r2z2.
renderingdifferencebetween aandb .werefertotheculprit commit as b and the previous commit as a .
thisbisectanalysisisessentialforthenexttwocomponents the regressionoracleandtherenderingpipelineanalysis.theregressionoracleidentifies htmloraclebug whichfiltersoutbenignissues from htmlcandbug .r2z2performsrenderingpipelineanalysis onthe htmloraclebugtoidentifywhichstageofrenderingpipelineis responsiblefortheregressionbug .itcompareseachresultof fourstagesontwobrowsers a andb allofwhichareaninternal representation during the browser rendering pipeline procedure dom tree style tree layout tree and paint output i.e.
layers .
after this testing r2z2can tell which state as well as value introduced htmloraclebug.werefertothefirstdifference introducing stageasabugstage.finally r2z2generatesafinalbugreporton htmloraclebug which includes the following information a minimizedhtmlfile thescreenshotsof a andb theculpritcommit and the pipeline stage and details of the bug.
.
change detector the change detector leverages cross version differential testing todetectrenderingchangesbetweentwomajorbrowserversions e.g.
chromev91andchromev92 onagiven html.asdescribed in .
a rendering difference is required for a rendering bug but a difference alone is not sufficient to determine a bug is present.
oneexampleofabenigndifferenceistheimplementationofanewfeaturewhichisexpectedtohavearenderingchange.therefore the change detector identifies a candidate bug i.e.
htmlcandbug which is used by later stages to determine true bugs i.e.
htmloraclebug .
wechose phashtodetecttherenderingdifference.
phashisawell known perceptual hashing algorithm producing representativefingerprint of a given image using a graphical algorithm .phashcomputes the hash value based on the low frequency componentsofimage.aftercompletingthehashcomputation each pixel in a low frequency filtered image is converted to or if its valueishigher orlower thanthemedianvalueofallthepixels.we notethatitispossibletouseotherimagecomparisonalgorithms instead of using phash.
afterobtainingindividual phashvaluesfromtworenderedimages wemeasurethedistancebetweentwoimagesbycomputing the hamming distance between two hash values which we refer to as pa pb .
here paandpbdenote phashvalues of htmlon the browserversion aandb respectively.itisworthnotingthata phash 1822icse may pittsburgh pa usa suhwan song jaewon hur sunwoo kim philip rogers and byoungyoung lee value is not a scalar value but a vectorized value so we compute pa pb usingthehammingdistanceforeachelementinthevector.
the minimum value of pa pb is zero which indicates that two rendered images are visually identical.
the maximum value of pa pb isthenumberof phashbits e.g.
ifthenumberofbitsis64 the maximum hamming distance is also which indicates that two rendered images are significantly different.
r2z2 s decision boundary on a candidate rendering bug is a configurable threshold value thresh i.e.
if pa pb is larger than thresh it determines the giveninput htmlishtmlcandbug.inourpreliminaryexperiments we tuned the threshold value of phashto have the following two properties i the threshold value should avoid false negatives as much as possible and ii the threshold value may allow false positives tosome extent.this isbecause r2z2 sregression oracleis ableto cater false positive issues as we will describe at .
so we designedthechangedetectionphasetofocusonnotmissingpotentialbugsifpossible.usinginitialtestcases weobtainedtheempiricallytunedthresholdvalue140whileconsideringtheaforementioned two properties.
.
bisect analysis thebisectanalysislocatestheculpritcommit b responsiblefor the rendering differenceof htmlcandbug.
this isimportant because the change detector uses major release versions of a web browser wheremanycodecommitsaretakenplaceinbetween.forexample there are approximately commits between chrome v91 and chrome v92.
thus the bisect analysis pinpoints the culprit commit from a wide range of commits allowing r2z2to avoid any unintentional side effects from unrelated commits in the follow up analyses.
inordertoefficientlyidentifytheculpritcommit abinarysearch isperformedoverthelinearsequenceofcommits.itispossiblethatmultiplecommitsareresponsibleforthedifference butthecurrent design of r2z2assumes that the latest commit from those is the culpritcommit.thisisfollowingthecommonpracticeexercisedbybrowserdevelopmentteamsforengineeringefficiency i.e.
thelater commitlikelyshadowsthepreviouscommit.theculpritcommit willbethen usedbythe bugregression oracle .
to filterout false positives and therendering pipelineanalysis .
toavoidunrelated differences.
workflow of bisect analysis.
the workflow of bisect analysis is as follows given two versions of browsers aandb r2z2 computes phashvaluesof html paandpb r2z2picksaversion between aandb saym andthen computes pm r2z2computes pm pb .i f pm pb is larger than thresh r2z2will search the half between mandb.i f pm pb is zero i.e.
the pmis the same as pb itwillsearchtheotherhalf between aandm.
r2z2recursively searches through the region i.e.
it returns to step and keeps continuinguntilthetwoversionofbrowsers aandbareadjacent.
ifaandbareadjacent thepre culpritcommit a issetto a.the culprit commit b is set to b. .
regression oracle r2z2develops a pseudo bug oracle called regression oracle to handle the challenges in identifying rendering bugs .
.
specifically given htmlcandbug .
as well as the bisected browser versionb r b r a r not a bug case not a bug case a r bug case infeasible a b a interoperability oracle.
a b r decision failfail nota bug infeasible case fail pass fail nota bug case fail pass pass bug case pass nota bug infeasible case b non feature update oracle.
figure regression oracle decision table.
information .
the regression oracle aims to filter out false positiveissuesindetectingrenderingbugs.theregressionoracle operates with two chained sub oracles the interoperability oracle .
.
and the non feature update oracle .
.
.
.
.
interoperability oracle.
theinteroperabilityoracleisbased on the following assumption assumption interoperable rendering is correct.
if two independently implemented browsers e.g.
chrome and firefox generatethesamerenderedresultfromthesameinput it is likely that both produce the correct rendering.
thisassumptionisbasedontheobservationthatbrowsersare independentlyimplementedtofollowthesamehtml cssstandards.letussupposetwodifferentbrowsersrenderagiven html the same then both browsers are either correct or incorrect.
of these two possible outcomes itis unlikely that both browsers are incorrect forthistobethecase bothwouldneedtohaveindependentlyimplementedthesamebug.furthermore iftwobrowsersdo contain the same bug it is possible that many web developers are already aware of the bug and thus develope their websites depending on the bug making the buggy behavior a de facto empirical standard.
therefore we assume that the interoperable behavior islikelyimplicatingthatbothbrowsersproduceacorrectrender ingbehavior.runningadditionalbrowsers e.g.
chrome firefox internet explorer opera can further strengthen this assumption.
it is worth noting that cross version testing in the change detector .
does not leverage this interoperability because two versionsofthesamebrowserarenotindividuallyimplementedand can have the same bug.
constructing interoperability oracle.
r2z2constructstheinteroperability oracle based on rendering interoperability.
given htmlcandbug i.e.
anhtmltestcasewhichgeneratesdifferentrendering results the interoperability oracle determines if it is a true bugorafalsepositive.
r2z2runsareferencebrowser denotedas r which has an independent implementation from the base browser used in the previous phases change detection .
and bisect analysis .
.thecurrentprototypeof r2z2runschromeasthe base browser and firefox as the reference browser.
1823r2z2 detecting rendering regressions in web browsers through differential fuzz testing icse may pittsburgh pa usa running the reference browser and two versions of the base browserwith thesame htmlcandbug the interoperabilityoracle observesthreepossiblecasesasshownin figure7a.first case1represents the case where both browsers have different rendered results withr.sincetherenderinginteroperabilitycannotbeleveragedfor differentrenderedresults theoraclecannotinferthecorrectness ofanybrowsers.thus theoracledeterminesthatcase1isnota bug.case2representsthecasewhere a hasthedifferentrendered result.inthiscase astherenderedresultsof b andrarethesame we can learn that both b andrare correct according to the renderinginteroperability.theoracle determinescase2isnotabug because a isanolderversionof b andthusthelatest b fixedthe bug presented in a .
case represents the case where only b has adifferentrenderedresult.inthiscase astherenderedresultsof a andrare the same we can infer that both a andrare correct becausetheyareinteroperable.hencetheoracledeterminesthat case3isabug b isanewerversionof a socase3impliesthat a andr correctlyrenderedthehtmlfile andabugisintroduced inb .
in summary the interoperability oracle determines htmlcandbug is a bug if it falls into case in figure 7a otherwise it is not a bug.
.
.
non feature update oracle.
to avoid potential rendering regressions and ensure interoperable behavior web browser developers are strongly encouraged to add web platform tests wpt for every code commit introducing a new rendering feature.
here afeaturecanrefertosomethinginanewspecification orevena part of an existing specification.
wpt tests are written in a format that can be run in all browsers and there is continuous integration testingthis.
r2z2usesthebehaviorofnewly addedwptteststo filteroutcommitswhere thebasebrowserisimplementinga new feature.
constructingnon feature updateoracle.
r2z2constructsthe non feature update oracle which is capable of determining if a certaincodecommit i.e.
b introducesanewrenderingfeature that is not supported in the reference browser r. if the commit introducesanewfeature r2z2determinesthatitisnotabug.this is because although htmlcandbugtriggers rendering changes which breakinteroperability therenderingdifferencecanbeduetothe newfeature whichshouldnotbeconsideredasabug.ifthecommit does not introduce a new feature r2z2 determines it is a bug.
morespecifically thenon feature updateoracleisconstructed as follows.
first the non feature update oracle checks whether b hascorrespondingwpttests.ifnot itdeterminesthat htmlcandbug is a bug.
next r2z2runs each corresponding wpt test on a b andr where the decision table is summarized in figure 7b.
in this table it is assumed that a always fails the wpt test while b shouldalwayspassbecausethatistheoriginalfunctionofthewpt test.
although it is practically infeasible it is still possible that this pre condition does not hold if the wpt test itself has a correctness issue i.e.
thewpttestingcodehasabug .as r2z2cannotlearn any from these cases i.e.
case and case in figure 7b the non featureupdateoracledeterminesthisasanot a bugcaseso as to conservatively avoid false positives.
for the case that a fails b passes and rfails i.e.
case the non feature update oracle determinesitisnotabug.thisisbecause b isthefirstbrowserthat figure overview of the rendering pipeline analysis.
!
!
!
figure final bug report example.
introducesthenewfeature sotherenderingchangesof htmlcandbug can possibly be due to this new feature update.
however for the case that a fails b passes and rpasses thenon featureupdateoracledeterminesitisabug i.e.
case3 .
this case implies that both b andrcorrectly implemented the new feature associated with the wpt test but htmlcandbugis not relevanttothisnewfeature b andrproduceddifferentrendering results as already tested by the interoperability oracle.
to summarize the non feature update oracle determines the given htmlcandbug which passed the interoperability oracle is a bug if a fails b passes and rpasses the corresponding wpt test as shown in case .
since this bug is passed by both interoper ability oracle and the non feature update oracle we term this as htmloraclebugwhich passes the regression oracle.
.
rendering pipeline analysis once finding htmloraclebugusing the regression oracle a rendering pipeline analysis attempts to figure out which rendering stage triggers the bug.
to be specific r2z2first opens an htmloraclebugfile in two versions of thesame browser a andb .
then throughout the rendering pipeline stages of web browsers .
r2z2performs differential testing using the internal representation of each pipeline stage.
more specifically r2z2performs the following four differential testing on each rendering stage figure dom test style test layout test paint test.
note that this test runs fourpipelinestagesinorder.ifthetestfindsadifference itstops andreportsthecurrentstage.thisisbecauselaterstageswillbe different once a difference is present.
1824icse may pittsburgh pa usa suhwan song jaewon hur sunwoo kim philip rogers and byoungyoung lee dom test.
in dom test r2z2checks if two versions of the same browsergeneratethesamedomtree.tothisend r2z2performsa domtreeequalitycheck bothshouldhavethesametreestructure and eachnode should have thesame tag and attributes.if any of these is different r2z2determines there is a dom bug and generatesa human readablereport showingthe domtreedifference.
more specifically r2z2first opens htmloraclebugona andb .
then it obtains a dom tree from each and traverses the dom tree in a depth first order to compare the tag name e.g.
bodyanddiv and attributes e.g.
type of each node .
style test.
after dom test r2z2compares the style information generated from each of the browser i.e.
a andb through style treeequalitycheck nodesinbothtreesshouldhavethesameproperty names and values.
in particular it obtains style information from the browser after a style stage in the rendering pipeline and traverses again the dom tree in a depth first order while com paring the style information e..g. font size 30px .r2z2 determinesthereisastylebugifanyoftreenodeshavedifferent style information as in dom test.
layout test.
in layout test r2z2checks if two versions of the same browser generate the same layout boxes.
to perform the layout box equality check each matching box i.e.
a layout boxpointed by the same node in both dom trees should have thesame size and location.
since we already checked the equality of the dom trees we traverse both dom trees in the same order and comparethegeometricpropertiesofthelayoutboxespointedby thesamedomnode .r2z2determinesthatanydifferencein this stage is a layout bug.
paint test.
finally in paint test r2z2checks if two browsers generate the same layers.
r2z2performs the equality check both browsersgeneratethesamenumberoflayerswiththesamesize compositingreason andpaintrecords.tobespecific r2z2obtains the layers using chrome devtools and sequentially compares each layer s size compositing reason and paint records .
if any of these are different r2z2 determines it is a paint bug.finalbugreport.
attheendof r2z2 sanalysis r2z2generates a final rendering bug report .
we provide the example of the final bug report in figure .
the report includes a raw html code triggering the bug rendering screenshots of a andb the bug commit i.e.
b and the triaged bug stage as well as the specific elements having different pipeline results.
implementation we implemented r2z2targeting the chrome browser.
we used domatofuzzer imagehash selenium andchromedevtools .domatofuzzerisagrammar baseddomfuzzerthatuses the context free grammars to generate html files.
we modified thedomatofuzzertogenerate htmlfileswithouttheanimations.
weimplementedthechangedetectorandbisectanalysisof r2z2by using1 seleniumtocapturetherenderedresultsfromtwodifferent versions of browser and imagehash to compute a phashvalue of imagesanddeterminewhethertwoimagesaredifferent.wesetthe numberofhashbitsas4 096tocomputea phashvalueand threshas to determine if the two images are different.
in order to implement the regression oracle we used firefox as a reference browser.
we implemented the rendering pipeline analysis by using dombrowser setting test env.
test env.
version achrome .
.
.
chrome .
.
.
release date may apr bchrome .
.
.
chrome .
.
.
jul jul rfirefox .
firefox .0a1 aug aug of commits b w a b figure experimental configurations.
apisandseleniumtocomparetheresultsofdom style andlayout between two browsers.
we used chrome devtools to compare the layer information such as paint records and compositing reason between two browsers.
in terms of the implementation complexity r2z2is implemented with lines of python and lines of javascript.
evaluation thissectionevaluatesvariousaspectsof r2z2 particularlyfocusing on answering the following research questions rq .how many candidate bugs can the change detector find?
.
rq .canthebisectanalysis .
accuratelyidentifyculprit commit of candidates?
.
rq .cantheregressionoracle .
accuratelyidentifytrue regression bugs from the candidates?
.
rq .can the rendering pipeline .
analysis correctly determine the bug introducing stage?
.
experimentalsetup.
wetested r2z2withtwosetsofdifferent browser versions as shown in figure .
r2z2considers stable released versionsas aandthelatestdevelopmentversionas b.this is because animportant aspect in this paperis specifically finding regression bugs.
even though two versions of a browser may have thesamebug onlythelaterversioncouldhavea regression .in thisrespect itisimportanttofixregressionbugsthatarecurrentlyimpacting end users so we picked the stable version as a. then we usedthelatestdevelopmentversionasthe b which i maximizes thecommitwindowtobesearchedforand ii offersacertainlevelofstability.next weusedthereferencebrowser rwiththebrowser releasedatthenearesttimeas b becausebrowserdeveloperstry tokeepthecompatibilitybetweendifferentonesreleasedaround the same time .
it is possible that two browsers i.e.
chrome andfirefox maysupportdifferentfeatures butwenotethatthis does not cause false positive issues for r2z2.
this is because the interoperability oracle identifies the bug only if a andrwere the same case3 whichimpliesbothbrowserssupportallthefeatures to run the testcase.
forthefirsttestingenvironment weselectedchrome84.
.
.
i.e.
commitposition766 as a chrome86.
.
.
i.e.commit position784 as b whichhas18 091commitsinbetween.we used firefox .
as the reference browser r. for the second we selected chrome .
.
.
i.e.
commit position as a chrome94.
.
.
i.e.
commitposition904 as b whichhas 052commitsinbetween.weusedfirefox93.0a1asthereference browser r. we ran all experiments on a core server running ubuntu18.04withintelxeon r gold5118 .30ghz processors 1825r2z2 detecting rendering regressions in web browsers through differential fuzz testing icse may pittsburgh pa usa statistics test env test env of tested html 200k 200k o fhtmlcandbug6 elapsed time h .
throughput html s .
.
a change detector.
statistics test env test env of tested htmlcandbug6 of bisected htmlcandbug6 elapsed time h throughput html s .
.
b bisect analysis.
figure run time statistics of change detector and bisect analysis in r2z2.
and 512gb memory.
then we leveraged the domato fuzzer to generatehtmlinputswhicharefedinto r2z2forchangedetection and analysis.
.
effectiveness of change detection we counted the number of candidate bugs i.e.
htmlcandbug that thechangedetectoridentifiedasshownin figure11a.aftertesting 200k randomly generated html files the change detector in each test environment found and htmlcandbug respectively.
thenumberof htmlcandbuginthesecondenvironmentisdoubled from thefirst which is due tothe large commitgap ofthe second test environment.
onaverage about5 ofthe htmlfilescausedrenderingdifferences between aandb.
while can be interpreted as a small number it accounts for or htmlcandbug.
these all may beworthmanuallyanalyzing butitwouldimposeprohibitiveengineering costs.
this result supports the challenge in identifying the renderingbugsthatwedescribedin .
whichalsosignifiesthe importanceofhandlingfalsepositiveissueswith r2z2 sregression oracle.
.
effectiveness of bisect analysis in order to evaluate the effectiveness of bisect analysis we first checked whether the bisect analysis properly finds the culprit com mitofeachcandidateandthenmeasuredtheelapsedtimeofbisect analysis.inthisexperiment weassumedthatallchromecommit versions between aandbwere pre built for the bisect analysis whichare inpractice alreadyavailablefromtheautomatedbuild testing infrastructure.
thus we did not include such overheads as it is already part of the browser development chain.
theresultofbisectanalysisisshownin figure11b.inthefirst testing environment out of htmlcandbug i.e.
.
were successfully bisected to culprit commits.
it failed to pin point the culprit commit of candidates.
the result for the second testingenvironmentwassimilar with219 htmlcandbugfailing.these failurecasesaremostlyduetochromefailingtorender suchasthe browser crashing or hanging.
for instance while chrome was able torender htmlcandbugatboth aandb itfailedtorenderatacertaincommit in between.
for the failed commit r2z2cannot capture the rendering result so r2z2terminates the bisect analysis.
while failingtorenderlimitstheeffectivenessof r2z2 sbisectanalysis this is rare and we believe addressing this issue is an orthogonal researchproblem .intermsoftheanalysistime theelapsedtime wasabout4and10hours foreachtestingenvironment respectively.
translatingtheseresultsintothethroughput r2z2processedabout .21htmlcandbugfiles per second which we believe is reasonably fast enough to be used in the production development chain.
with respect to the correctness of the bisect analysis r2z2was abletocorrectlypin pointtheculpritcommit.specifically asshowninfigure12 allculpritcommitsof13 htmltruebug whichr2z2found in .
wereconfirmedtobecorrectbychromedevelopers i.e.
the accuracyofthebisectanalysisis100 .consideringthefactthatthebisectanalysisismanuallyperformedbychromedevelopers we argue that r2z2 s automation can significantly improve the efficiency of the bug triage and debug processes.
.
effectiveness of regression oracle this section evaluates the effectiveness of the regression oracle.
we first use an interoperability oracle and then use non featureupdate oracle to find htmloraclebug.
then for deduplication we classified the htmloraclebugby their culprit commit and picked one htmloraclebugfrom each culprit commit.
specifically r2z2detected htmloraclebugfrom6 986candidatesbyusingtheinteroperabilityoracleinthefirst secondtestenvironments respectively.
then27 htmloraclebugwerebisectedinto10 11uniqueculprit commits respectively.
from unique culprit commits we picked anhtmloraclebugfromeachuniqueculpritcommit.thenumberof true falsebugs is14 i.e.
thetrue positiverateis .
.among commits the culprit commits of eight true and five false bugs haveweb platform tests respectively.non feature updateoracle filteredoutfourfalsepositivesandonetruebug.itfailedtofilter out two false positives as they do not have web platform tests.
to sumup given22 htmlcandbug theregressionoracleidentified 16htmloraclebug.afterreportingthese 13bugswereconfirmedas true regression bugs and three htmloraclebugwere false positives ofr2z2 i.e.
the true positive rate is .
and the false positive rate is .
.
newregressionbugs.
throughtheevaluation r2z2identified 13trueregressionbugs.outofthese 11regressionbugswerenewly identified by r2z2and two were previously and independently identifiedbyotherusersandresearchers.thelistofnewrendering regression bugs is shown in figure .
after reporting six of these regression bugs were fixed by developers and thus r2z2prevented such regression bugs from harming users demonstrating r2z2 s impact on spotting regression bugs.false positives.
two false positive cases were due to the fact thatr2z2was not able to use the non feature update oracle i.e.
browser developers did not include wpt tests for these two so the non feature update oracle simply determined they were htmloraclebug.
while these false positive issues may seem to be the limitationof r2z2 thetestcaseswereusefultobrowserdevelopers.
specifically after reporting these bugs browser developers men tioned that htmloraclebugin fact tests the new features that were 1826icse may pittsburgh pa usa suhwan song jaewon hur sunwoo kim philip rogers and byoungyoung lee updated by b .
therefore htmloraclebugcan be used to add missing testcases.
.
correctnessofrenderingpipelineanalysis in order to evaluate the correctness of the rendering pipeline analysis wefirst obtainedthe ground truth a trueculprit stage forall htmltruebug.
as we reported htmltruebug the browser developers performedthemanualanalysisandlefttheannotationonwhich pipeline stage is responsible for the bug.
we were able to obtain theground truthfor12 htmltruebug outoftotal13 htmltruebugthat r2z2detected .fortheoneremainingunlabeledone browserdevelopersfailedtopinpointaspecificstagealthoughtheyconfirmed the bug.
according to our evaluation the rendering pipeline analysis correctly spotted all of htmltruebug i.e.
the accuracy is showingtheeffectivenessofthisanalysis.becauseno htmltruebug wereindomandstyle wepreparedanextraevaluationwithexisting dom and style bugs which are reported by other chrome contributors.
searching chrome bug tracker we selected three dombugs whicharereproducedin olderversionsthanour evaluation environment because there was no recent dom bug.
we alsoselectedfourstylebugs whicharevalidintheversionrange of our evaluation environment.
the result is that r2z2correctly pin pointed all dom bugs.
however in the case of style bugs it correctlypin pointedthreeoutoffourstylebugs.asshowninthis evaluation r2z2was able to correctly spot a culprit pipeline stage foralltestedbugsexceptonestylebug demonstratingitsstrong potentialtosignificantlysavemanualengineeringworkperformed bybrowserdevelopers.finally weconductedacasestudyonthe incorrectly pin pointed style bug to clarify the flaw of pipeline analysis as described below.
case study a failure case of pipeline analysis.
in style test the pipeline analysis failed to find the culprit stage of the bug chromeissue .thisisbecause r2z2relieson getcomputedstyle dom api to retrieve the style information but forsomecasesitdoesnotreturnthecompleteinternalinformation used in the style stage.
for these cases the complete internal informationcanonlyberetrievedthroughinspectingtherawmemory while handling virtual address differences between two browser instances.whilethisclearlyisalimitationof r2z2 weleavethis as our future work as it only occurred in one case out of .
discussion thissectiondiscussesfutureresearchdirectionsof r2z2 particularly stating how r2z2 can further be utilized for other use cases.detectingregressionsinotherwebbrowsers.
r2z2 currently supports chrome but does not support other web browsers e.g.
safari firefox andedge .sincethedesignof r2z2isgeneric these canbesupportedby r2z2withmoderateimplementationeffort.in particular r2z2 srunscriptneedstobemodifiedtospawnthese other browser instances.
the bisect analysis requires including a browser specific build script for each version.
the renderingpipeline analysis can be implemented in a similar way by using eachbrowser sdevelopmentapistocollectintermediaterendering information.issue culprit culpritcorrect incorrect confirmed fixedid commit stage paint layout layout paint paint paint layout undecided layout paint layout paint paint figure12 thelistof13 htmltruebugfoundbyr2z2inchrome.
bugs were newly identified by r2z2 and two were independently identified by other contributors annotated with .
using regression oracle for other programs.
while this paperleveragestheregressionoracleforrenderingregressionbugs it can be adopted to find regressions in other programs in the future.
therearemanyprogramsinwhichmultipleindependentprograms implement the same standards e.g.
pdf viewers svg engines javavirtualmachines orssl tlsserversorclients .sincethese programs have the same challenge in identifying regression issues as browser rendering i.e.
complex and unclear standard specifications r2z2 s regression oracle can be utilized to correctly identify regressions while avoiding false positives.
related work browser layout testing.
previous work has proposed tools to help web page developers discover cross browser incompatibilities inwebapplications .they automaticallyidentified cross browser incompatibilities in web applications by detecting rendering differences of two different browsers.
compared to this previouswork thefocusof r2z2isinidentifyingrenderingbugs in web browsers rather than web applications.
moreover these do 1827r2z2 detecting rendering regressions in web browsers through differential fuzz testing icse may pittsburgh pa usa not employ the bug oracle so they suffer from false positive issues.
thereisanotherworkthatfoundhtmlpresentationfailuresin web pages which requires manually developed oracles by domainexperts.comparedtothese r2z2 soracledoesnotinvolve the manual processes.
browserlayoutverification.
thereareseveralworksthatpartly formalized the browser layout algorithm .
proposes visual logic to express accessibility guideline and leverages finitizationreductions toproperlyformalize thefragmentof thebrowser layoutalgorithm.troika proposesmodularlayoutproofsfor verification of web page layout.
as described in .
converting htmlandcssspecificationstoformalizedrulesislabor intensive anderror prone requiringexpertdomainknowledgeofspecifications as well as browser implementation.
compared to these r2z2 is able to perform the automated rendering bug detection without domain expert s knowledge.fuzzingtofindsemanticbugs.
nezha exploitsthebehavioral asymmetries between multiple test programs to find semantic bugs.
deepxplore and dlfuzz guide deep learning dl systemstoexposeincorrectbehaviorsusingneuroncoverage.some studiesemploydifferentialtestingtodiscoversemanticbugsinjava virtualmachine jvm implementations .glfuzz leverages metamorphic testing to find shader compiler bugs.
itinserts dead code into the graphics shading languages such asopengl and checks whether the original code and variant code aresemanticallyequivalentbasedontheirrenderedresults.glfuzz determinesthatthevariantcodeisabugcasewhentherendered results are significantly different.
dom fuzzing.
manydomfuzzers areproposed to find the memory related bugs from the web browsers.
for instance cross fuzz dynamically generates the sequences of domapistobindmultiplehtmldocumentsforstress testingthe garbagecollectionmechanismsofwebbrowsers.inthisway itidentified about one hundred memory related bugs from web browsers e.g.
internet explorer firefox and opera .
domfuzz uses domapi callsto testsome partsof browserengines e.g.layout .
wadi domato and dharma are the generation based dom fuzzers which generate html inputs based on their html css and javascript grammars.
freedom leverages a contextaware intermediate representation to generate semantically valid html documents.
conclusion this paper proposed r2z2 a differential fuzz testing technique tofindrenderingregressionsinwebbrowsers.
r2z2featurestwo unique techniques to find and analyze rendering bugs.
first it featuresaregressionoraclealongwiththerenderingchangedetection soastodetectregressionbugswhileavoidingthefalsepositives.second it features the bisect analysis and the rendering pipelineanalysis allowing r2z2to spot the culprit commit and pipeline stage which are responsible for the bug.
with the prototype implementation for the chrome browser it identified new rendering bugs in chrome all of which were confirmed by chrome developers.
data availability we disclosed our data used in this paper at m9.figshare.
.v1.