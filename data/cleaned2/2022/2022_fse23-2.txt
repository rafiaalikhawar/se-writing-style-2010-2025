compatibility issues in deep learningsystems problems and opportunities jun wang junwang nuaa.edu.cn nanjing universityof aeronautics and astronautics chinaguanping xiao gpxiao nuaa.edu.cn nanjing universityof aeronautics and astronautics chinashuai zhang shuaizhang nuaa.edu.cn nanjing universityof aeronautics and astronautics china huashan lei leihuashan nuaa.edu.cn nanjing universityof aeronautics and astronautics chinayepangliu liuyp1 sustech.edu.cn southernuniversityof scienceand technology chinayuleisui y.sui unsw.edu.au universityof new southwales australia abstract deep learning dl systems are complex component based systems which consist of core program code implementation and data python language and interpreter third party libraries lowlevel libraries development tools os and hardware environments.
incompatibleinteractionbetweencomponentswouldcauseserious compatibilityissues substantiallyaffectingthedevelopmentand deployment processes.whattypes ofcompatibility issuesare frequentlyexposed indl systems?
whatare theroot causesofsuch issues and how do developers f ix them?
how far are we from automaticallydetectingand f ixingdlcompatibilityissues?although therearemanyexistingstudiesondlbugs thecharacteristicsof dl compatibility issues have rarely been systematically studied and the above questions remain largely unexplored.
to f ill this gap weconductthe f irstcomprehensiveempiricalstudytocharacterize compatibilityissuesindlsystems.throughanalyzing352dlcompatibilityissuesclassi f iedfrom3 072postsonstackover f low we presenttheirtypes manifestationstages andsymptoms.wefurther summarize the root causes and common f ixing strategies and conduct a tool survey on the current research status of automated detectionandrepairofdlcompatibilityissues.ourstudyallows researchers and practitioners to gain a better understanding of dl compatibilityissuesandcan facilitate future tooldevelopment.
ccs concepts software and its engineering software defect analysis softwarelibrariesandrepositories generalandreference empirical studies .
guanpingxiao is the corresponding author.
yepangliuisaffiliatedwiththedepartmentofcomputerscienceandengineering and the researchinstituteof trustworthyautonomous systemsat sustech.
permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forpro f itorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe f irstpage.copyrights forcomponentsofthisworkownedbyothersthanthe author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspeci f icpermission and or a fee.
request permissions from permissions acm.org.
esec fse december san francisco ca usa copyright heldby the owner author s .
publicationrightslicensed to acm.
acm isbn ... .
deeplearning compatibilityissues empirical study acmreference format junwang guanpingxiao shuaizhang huashanlei yepangliu andyulei sui.
.
compatibility issues in deep learning systems problems and opportunities.
in proceedings of the 31st acm joint european software engineering conference and symposium on the foundations of software engineering esec fse december san francisco ca usa.
acm new york ny usa 13pages.
system libraries cuda cudnn macos linux gpu cpu tpupycharm gcc bazel windows hardwareosdevelopment toollow level librarythird party librarycore program python from keras.layers import dense from keras.models import sequential import tensorflow as tf import numpy as np code data caffe theano figure components ofdlsystems introduction withthecontinuousevolutionofdeeplearning dl technology numerousdl relatedsoftwaresystemshavebeenubiquitouslyproduced and deployed such as medical imaging autonomous driving cars and various software engineering tasks .like traditional software developinganddeployingdlsystemsalsofacedifferenttypesofcompatibilityissues whichtendtotriggerunexpectedproblems signi f icantly obstructing the developmentanddeploymentprocesses.
as shown in figure dl systems are composed of several complexandinterdependentcomponents includingcoreprogram code implementationanddata programminglanguage mainlyreferred to python and its interpreter third party libraries e.g.
tensorflow pytorch numpy andpandas low levellibraries e.g.
cuda cudnn drivers andmanysystemlibraries developmenttools e.g.
gcc bazel and pycharm operating systems os e.g.
windows linux andmacos andhardwareenvironments e.g.
cpu gpu and tpu .
to satisfy the requirements of different software and 476esec fse december3 san francisco ca usa jun wang guanping xiao shuaizhang huashan lei yepangliu andyuleisui dl compatibility issues core tpl .
tpl tpl .
tpl lll .
tpl python .
core core program tpl third party library lll low le vel library dev development tool os operating systemtpl dev .
tpl os .
tpl hardware .
lll hardware .
others .
figure typesofcompatibility issues indlsystems hardware environments considering their frequently evolving versions suchcomponentsarespeci f icandoftenincompatiblewith each other.
thus compatible component to component interactions must be speci f ied inaccordance with certainconstraints to make dl systemsrun normally.
on the one hand apis in third party libraries are frequently changing due to f ixing bugs adding new features and optimizing codeimplementation .thesecodingactivitiesmaybringserious backward breaking changes.
one typical case is the change related toapiusage which offersaninterfacefordeveloperstodirectly usea libraryfeatureinbuildingcoreprograms.
usingremovedor renamedapis e.g.
functiongettingremovedorrenamed inthe program willinevitablycause the collapse ofdl systems .
on the other hand dl systems can only be built upon speci f icversionsofcomponents.incompatibleversioncombinations willcauseunexpectedissuesduringtheinstallationorexecution of dl systems.
for example according to the official installation guide thelow levellibraryforperforminggpucomputingof tensorflow gpu .
should be cuda .
if users choose cuda .
noerrormessagewill appear inthetensorflow installationstage.
however thesystemwillthrowan importerror duringexecution since the corresponding runtime cuda f ile cannot be found as reported in a stack over f low so post .
in addition due to api breaking changes that occurred in the evolution of libraries the interaction between third party libraries should also rely on speci f ic combinationsofversions .
althoughcompatibilityissuesarecommonlyobservedindlsystems theseissuesareoftenchallengingtolocateand f ix especially fortheonewhoisunfamiliarwiththeinteractionbetweendifferent components.inparticular whenthesystemthrowsanexceptionat runtime itisdifficultforuserstodeterminewhethertherootcause isinducedbytheincompatibilitybetweensoftwareandhardware environments the version mismatch between third party libraries or the breaking changed api of third party libraries used in the core program.
for example another so post reported that a developer tried toperformtheobjectdetection f inetuningtutorialfrompytorch on a linux laptop with a nvidia gpu but kept getting the typeerror i.e.
objectoftype class numpy.
f loat64 cannotbesafely interpreted as an integer .
strangely the error did not happen on his home computer with the same os and gpu environment a day before.hespentabout15hoursinvestigatingtherootcauseand f inally realized that in a recent release i.e.
numpy .
.
the num parameterin numpy.linspace nolongeracceptsthe f loattype.
hence anyonewhouses pycocotools apiwithnumpy1.
.0will encounterthesameerror.simplydowngradingthenumpyversion to .
.
solves this issue.therefore itispracticallyvaluabletostudythecharacteristics of dl compatibility issues.
since dl systems have become more andmorepopularandimportantnowadays therearemanystudiesrelatedtodifferentcomprehensivetaxonomiesofdlbugs .
however none of these studies speci f icallyfocusontheanalysisofdlcompatibilityissues.besides existingeffortshaveprimarilyconcentratedonanalyzingtheapi evolutionofpythonlibraries andresolvingdependencycon f lictsinpythonprograms .forexample zhanget al.
analyzed the evolution patterns of six python frameworkapis i.e.
tensorflow keras scikit learn pandas flask and django and compatibility issues caused by breaking changed apis.yeetal.
proposedatoolcalledpyegothataimstoautomatically infer compatible versions of python third party libraries and system libraries.
however these studies focus on a speci f ic aspect of dl compatibility issues but lack a comprehensive understanding of the prevalent types symptoms root causes and f ixing solutions ofcompatibilityissuesindl systems.
to bridge this knowledge gap in this paper we conduct systematicstudyoncompatibilityissuesindlsystems.first wecollect posts from the official so data dump using f ive tags i.e.
tensor f low keras pytorch caffe and theano related to the f ive most discusseddllibrariesonsoand12keywords i.e.
compatibility version evolution exception typeerror attributeerror importerror modulenotfounderror runtimeerror compatible cuda cudnn .
then we perform manual classi f ication on these posts to identifydl compatibility issues i.e.
and further investigate their characteristics.
last we conduct a tool survey to study the current state of relevant research on automated detection and repair of dl compatibility issues.
our work mainly focuses on answering the following three researchquestions rqs .
rq1.what types of compatibility issues are frequently exposed indl systems?
rq2.what are the root causes of dl compatibility issues and howdo developers f ixthem?
rq3.how far are we from automatically detecting and f ixing dl compatibilityissues?
in this paper we make the following contributions de f inition.
alistofcomponents includingcoreprogram python third party library low level library development tool os and hardware in dl systems and the de f inition of dl compatibility issues section .
empirical study.
we conduct the f irst empirical study of dl compatibilityissuesbyanalyzing352issuesclassi f iedfrom3 so posts sections 3and4 .
toolsurvey.
wesurvey15toolsrelevanttodetectingand f ixing dlcompatibilityissuesselectedfromthemostrecenteditions ofthetopseconferences i.e.
icse fse andase section .
477compatibilityissues in deep learning systems problems andopportunities esec fse december3 san francisco ca usa implicationsandsuggestions.
wecomparecompatibilityissues in dl systems with those in traditional software systems and provide implications and suggestions for researchers and practitioners basedonour empirical f indings section .
datasets.
wereleasethereplicationdatasetwithadetailedinstruction document ofdl compatibilityissues section .
dl compatibilityissues dlsystem inthisstudy wede f inea dlsystem asthecomposition of seven interdependent components including coreprogram python third partylibrary low levellibrary developmenttool os andhardware as depicted in figure .
each component is brie f ly describedas follows core program core the core program core consists of code implementation and data.
code implementation mainly includes data processing model de f inition hyper parameter settings andtheoptimizationtrainingprocess .datastandsfor the datasets usedinmodeldevelopmentanddeployment.
python python theprogramminglanguageanditsinterpreter environment provides the syntax and runtime environment to implement and execute the core program.
for example the core program can be written in python or python .
in this study we consider pythonasthemajor programming languageusedfor implementingdl systems.
third partylibrary tpl tplsprovideprede f inedfunctions through apis which are used by developers to implement correspondingfeaturesinthecoreprogramaswellasothertpls.for example dlframeworks e.g.
tensorflowandpytorch provide the featuresto buildandoptimizedl models.numpyandpandas offer severaldataprocessingfunctions.
using apisfromtplscan simplifyandaccelerate software development .
low level library lll llls provide apis to access hardware andsystem resources which are fundamental parts required by several tpls.
for example the gpu computing operations of tensorflow are performed through cuda cudnn libraries .
besides system libraries e.g.
glibc and glibcxx provide standard c c apis and os speci f ic apis for tpls since the low level implementationofmanytpls waswritten inc c .
development tool dev devs are the tools used in developmentanddeploymentprocesses usuallyrelatedtobuilding compiling executingactivities etc.forexample bazelistheofficialtoolfor buildingtensorflowfrom source .
operating system os os provides the software computing environment.commonossindlsystemsincludewindows linux andmacos.
hardware hardware provides the hardware computing environment for dl systems .
typical computing devices include cpu gpu andtpu.
dlcompatibilityissue basedontheabovede f inition wede f ine the dl compatibility issue as the incompatible interaction problem between componentsinthe dl system.
methodology .
data collection .
.
stack overflow data.
to study compatibility issues in dl systems we have collected data from stack over f low so oneof the most popular question answering sites concentrating on programming relatedquestions .postsonsoarefrequently updated.thismaybringpotentialthreatstothereliabilityofour f indings.thus weusedtheofficialstackexchangedatadumpreleased at archive.org which provides each separate part of the whole so website including posts users votes comments posthistory postlinks tags andpostlinks .
thelatestsodumpdatawaspublishedonjune6 when we started this work and later updated on october .
to guarantee questions re f lect the latest issues that dl developers and users encountered we used the data released on october .inourstudy wedownloaded stackover f low.com posts.7z and stackover f low.com tags.7z which contain posts.xml andtags.xml respectively as the raw data.
.
.
data collection process.
there are question posts in the collected so dump data spanning from july to october .we de f inedthe following f ive rules as the criteria to sample a small setas our classi f ication data rule .the post is a question post.
the f ield posttypeid in posts.xml represents the type of a post for a question post and for an answer post .
rule .the post is still open for discussion.
some posts are labeledasclosedduetoduplication needingdetailsorclari f ication oroutoftopic.thesepostsmaynothavesufficientinformationfor our analysis.
to ensure the reliability of our study we discarded such closedposts.
rule3.theposthasanacceptedanswerandthescore computed by upvotes minus downvotes of the post is no less than .
posts with accepted answers indicate that the issues have been resolved as recognized by the original posters .
to further ensure the quality and quantity of posts we set a minimum score threshold of3.
rule4.thepostcontainsatleastoneofthe f ivetags i.e.
tensor f low keras pytorch caffe andtheano.
these f ive tags represent the f ive most discussed dl libraries on so according to the number of relatedposts.
rule5.thepost stitleorbodycontainsat leastoneofthe12 keywords i.e.
compatibility version evolution exception typeerror attributeerror importerror modulenotfounderror runtimeerror compatible cuda andcudnn.
the f irst seven keywords are adopted from where the authors used them to search for compatibilityissuesingithubrelatedtotheapievolutionofpythontpls.
based on our domain knowledge in developing and testing dl projects we extend the keyword set by adding f ive new keywords i.e.
modulenotfounderror runtimeerror compatible cuda cudnn.
basedonthe above f iltering conditions we developedpython scriptstoautomaticallyextracttagsandpostsfrom tags.xml and posts.xml f iles.
finally posts are collected for further manual classi f ication as shownintable .
.
dl compatibility issues classi f ication toidentifyandcharacterizedlcompatibilityissues weperformed aniterativemanuallabelingprocessbyfollowingthewidely adopted 1thesumofthenumberofpostsineachtagexceeds3 072becauseapostcanhave multiple tags.
478esec fse december3 san francisco ca usa jun wang guanping xiao shuaizhang huashan lei yepangliu andyuleisui table summary ofdatasetinour study tag tensorflow keraspytorch caffetheano posts comp.
posts dl compatibility issue?
so posts iteration iteration iteration 3noyes unknowntype core tpl stage execution symptom breaking solution version change tensorflow root cause api incompatibility figure classi f ication process open coding procedure as shown in figure .
two annotators i.e.
co authors of this paper who are all familiar with dl project development spent f ive months on the classi f ication.
in eachiteration athirdauthorparticipatedinthediscussiontosolve the inconsistencies and f inally reached a consensus.
to measure theinter rateragreementbetweentwoannotators wecalculated cohen skappacoefficientforeachiteration .theiterations are as follows iteration1.
forthe3 072posts weanalyzedthreepartsinapost i.e.
thequestiondescriptions includingcodesnippets exception information e.g.
traceback andtheattachedexternallinks the answers in the post and the comments discussed by users.
two annotatorsindependentlyinspectedthesesourcesofdataontheso website which hasbetter readabilitythan the posts.xml.
sincethe onlinepostmaybefurtherupdated wecomparedthelastmodi f ied datesbetweentheonlinepostandtheextractedonefrom posts.xml to ensure consistency.
if the dates are different we ignore the new information e.g.
newanswersorcomments postedonthewebsite after the last modi f ieddaterecordedin posts.xml.
in this iteration we f irst checked whether a post discusses a dl compatibility issue according to the de f initions described in section2.speci f ically wefocusedontheinformationrelatedtothe version change of components such as tpls llls and python.
if thereisnosuchinformation wefurthercheckedwhethertheissue wasinducedbyapi evolution.
if a post is labeled as yes we further described corresponding counterparts of the issues i.e.
the incompatible problem was induced between which components the manifestation stage of such issue andtheconsequentimpactonthedlsystem.iftheposter did not specify the version of the incompatible component we can infer the range of versions prior to the post submission time byexaminingthe releasehistory ongithubandthe python pypi repository.
it is noted that the library in an issue could be different from the tag attached to the post since the tag is a general label related to the discussion topic on so.
besides we also recorded the solution posted by the accepted answer and described the root cause based on our own understanding.
if posts do not contain sufficient information to be classi f ied as a compatibility issue or not welabelthemas unknown .postsrelatedtoapimisuseand usage query general questions asking for code implementation to aspeci f icfunction andenvironmentcon f igurationissuesrelatedtable distribution ofstagesand types type installation execution total core tpl tpl tpl tpl lll tpl python tpl hardware tpl os tpl dev lll hardware others total tomissingrequireddependenciescausedbyforgettingtocon f igure install necessary components but not due to version mismatch are labeledas no.
wethencross checkedthelabelingresultsandmainlycompared theidenti f icationofcompatibilityissuesandtheirstageandimpact.
the valueofcohen skappacoefficient is0.89inthis iteration.
iteration .
in the second iteration we independently relabeled allpostsbasedonthepreliminaryclassi f icationfromthe f irstround.
in particular we focused on the type of dl compatibility issues i.e.
to determine which two components introduce the issue.
to further understand and identify the type we created virtual environments using conda trying to reproduce the reported issues accordingtothegivenversionsofpythonandtpls.forthe compatibilityissuesrelatedtocoreandtpl weused gitblame to identify the commit on github that introduced the api changes andfurtherlabeledtheapievolutionpatternbyadoptingthetaxonomyfrom .notethatthereproductionprocesshelpsusto matchtheincompatiblelibraryversionwiththespeci f icbreaking changes thatwere introduced.
for example the codesnippet runs normallyinversion v1 butcrashesinthesubsequentversion v2.
byreproducing weupdatedthelabelingresultsofdlcompatibility issues solutions androotcauseswithmoredetailedinformation.
misclassi f ied posts in the f irst iteration can be further veri f ied.
the valueofcohen skappacoefficient inthis iteration is0.
.
iteration .
in the last round we focused on the labeling of solutionsandrootcausesofdlcompatibilityissues.speci f ically wefurthercheckedwhethertheproposedsolutioniseffectiveaccording to discussions posted by users and our reproducing results.
since posts could have several answers we concentrated on analyzing those whose submitted time is close to the issue posted time.
due to the evolving versions of components new answers solutions areoftennotappropriatefortheoriginalissue which waspostedyearsago.we f inallysummarizedthesolutionsandroot causes of the dl compatibility issues.
the value of cohen s kappa coefficient is0.95for the last iteration.
after three iterations we classi f ied dl compatibilityissues from so posts.
table 1depicts the distribution of the issues in the set of so posts.
note that the sum of the number of posts isgreater than352 as apost can have more thanone tag.
analysisresults .
rq1 types stages andsymptoms .
.
types.
basedontheclassi f icationprocessdescribedabove weclassi f ied the352compatibility issuesin dlsystemsinto nine types including core tpl tpl tpl tpl lll tpl python tplhardware tpl os tpl dev lll hardware andothers as shown infigure .eachissueislabeledasoneleafcategoryofourclassi f ication taxonomy.below we willdiscuss eachtype indetail.
479compatibilityissues in deep learning systems problems andopportunities esec fse december3 san francisco ca usa core models.py ... from keras.layers.core import dense dropout activation merge reshape ... traceback most recent call last file users pengjuzhao u dacity mlnd entity embedding rossmann test model.py line in module from models import nn with entityembedding file users pengjuzhao u dacity mlnd entity embedding rossmann models.py line in module from keras.layers.core import dense dropout activation merge reshape importerror cannot import name mergetpl keras keras api version in core .
.
installed keras version .
.
figure core tpl backward incompatible core mnist test.py ... y tf.matmul h w2 b2 cross entropy tf.nn.sigmoid cross entrop y with logits labels y logits y train step tf.train.adamoptimizer .minimize cross entropy ... traceback most recent call last file mnist test.py line in module cross entropy tf.nn.sigmoid cross entropy with logits labels y logits y typeerror sigmoid cross entropy with logits got an unexpected keyword argument labels tpl tensorflow tf api version in core .
.
installed tf version .
figure core tpl forward incompatible core program and third party library core tpl this is the most common type .
of dl compatibility issues.
developers usually use apis from a speci f ic version of tpls to implement the core program.
if the installed version is different from the used one compatibility issues are likely to occur due to api evolution .
according to a newer or older installed version than the used one core tpl issues can be further classi f ied as backward incompatible andforward incompatible .
for example figure 4shows a backward incompatible issue .
theerroroccurredwhenimportingclass mergefromkeras.layers.core .
this is because class mergehas been moved to another module since version .
.
the same import statement can be executed under version .
.
.
on the contrary figure 5shows a forwardincompatibleissue inwhichanerrorappearedwhencallingtensorflowapi tf.nn.sigmoid cross entropy with logits with parameter labelsinthecoreprogram.theparameter labelswas added in tensorflow .
.
while the developer installed an older version e.g.
.
.
in addition we found that the top f ive tpls ofcore tpl issues are tensorflow keras pytorch theano andtorchtext .
finding1 core tpl .
isthemostfrequenttypeofdl compatibility issues.
.
of core tpl issues are backwardincompatible issues and the remaining .
are forwardincompatible issues.
most .
of core tpl issues are relatedto tensorflow .
andkeras .
.
third party library and third party library tpl tpl is the second most frequent type .
.
developing python tpls also relies on several other tpls.
the triggering factor of tpl tpl mainlylies in theinstallation of tpls withincompatible versions.
since tpls are frequently evolving it is often difficult for userstochoosecompatibleversions especiallywhentheconstraint condition e.g.
requirements .txt isnotprovided .wefound the top four related tpls of tpl tplissues are tensorflow keras numpy and theano .
in particular tensorflowkerasintroducesthemostissues astheyhaveastrongversion constraintandalarge userpopulation.
kerasprovidesuser friendlyapiforbuildingneuralnetworks andsupportsmultibackends e.g.
tensorflowandtheano.for example figure 6showsacompatibilityissueinducedbyincompatible versions of keras and tensorflow.
the exception occurred insidekeraswheninvokingtensorflowapi tf.nn.leaky relu traceback most recent call last file main.py line in module dcgan dcgan file main.py line in init self.discriminator self.build discriminator file main.py line in build discriminator model.add leakyrelu alpha .
file opt libraries anacond a2 lib python2.
site packages keras models.py line in add output tensor layer self.outputs file opt libraries anacond a2 lib python2.
site packages keras engine topology.py line in call output self.call inputs kwargs file opt libraries anacond a2 lib python2.
site packages keras layers advanced activations.py line in call return k.relu inputs alpha self.alpha file opt libraries anacond a2 lib python2.
site packages keras backend tensorflow backend.py line in relu x tf.nn.leaky relu x alpha attributeerror module object has no attribute leaky relu tpl keras tpl tensorflow installed keras version .
.
installed tf version .
.
figure tpl tpl testing.py from keras.models import sequential from keras.layers import dense dropout flatten from keras.layers import conv2d maxpooling2d from tensorflow.python.keras.callbacks import tensorboard ... model.fit x train y train batch size epochs callbacks traceback most recent call last file c ... rps project testing.py line in module model.fit x train y train batch size epochs callbacks file c ... python37 lib site packages keras engine training.py line in fit validation freq validation freq file c ... python37 lib site packages keras engine training arrays.py line in fit loop callbacks.set model callback model file c ... python37 lib site packages keras callbacks.py line in set model callback.set model model file c ... python37 lib site packages tensorflow pyth on keras callbacks.py line in set model if not model.run eagerly attributeerror sequential object has no attribute run eagerly tpl tensorflowtpl keras keras.models.sequential tf.keras.callbacks.tensorboard figure tpl tpl intheimplementationoflayer leakyrelu .thedeveloperinstalled tensorflow .
.
and keras .
.
.
however the function leaky relu was added in tensorflow .
resulting the attributeerror .besides themixeduseofapisfromkerasandtf.keras i.e.
theintegratedkerasapisintensorflow couldalsobringcompatibilityissues asshowninfigure .kerasandtf.kerasare notcompatible astheimplementationoftf.kerasisnotidenticalto the standalone keras .
finding tpl tpl .
is the second most common type of dl compatibility issues.
.
of tpl tpl issues are inducedbetweentensorflowandothertpls ofwhichkeras accounts for .
.
third party library and low level library tpl lll issuesare causedbyincompatible versions betweentpls and llls accounting for .
.
among them issues are related to tplcuda cudnn.
in particular tensorflow andcuda tensorflow andcudnnintroduce25and15issues respectively.oneissueis related to both.
unlike pytorch which integrates cuda cudnn librariesinitsinstallationwheel usinggpuforaccelerating dl model training by tensorflow requires users to install and con f igurerespectivecompatiblecuda cudnnversionsaccordingto thetensorflowversions .forexample figures 8and9illustrate two typical compatibility issues related to tensorflow and cuda cudnn.duringruntime tensorflowthrowsan importerrorsincelibcudart .so.
.0can not be found .
this implies that tensorflow requires cuda to perform gpu computing but the installed cuda version is .
.
besides the cudnn issue depicted in figure 9describes that the version of cudnn library that tensorflowcompiledagainst i.e.
.
.
isincompatiblewiththe con f iguredcudnn library i.e.
.
.
at runtime .
finding3 tpl lll .
isthethirdmostfrequenttypeof dlcompatibilityissues.
.
oflllsarecudaandcudnn while the remaining .
are related to nvidia gpu drivers andsystemlibraries e.g.
glibc libstdc andboost .
480esec fse december3 san francisco ca usa jun wang guanping xiao shuaizhang huashan lei yepangliu andyuleisui etc profile ... ld library path usr local cuda .
lib usr local cuda .
lib64 ... traceback most recent call last file multiply.py line in module import tensorflow as tf file home luohao .usr bin pytho n2.
.
lib python2.
site packages tensorflow init .py line in module from tensorflow.python import ... file home luohao .usr bin pytho n2.
.
lib python2.
site packages tensorflow python pywrap tensorflow.py line in swig import helper mod imp.load module pywrap tensorflow fp pathname description importerror libcudart.so.
.
cannot open shared object file no such file or directorylll cuda .
tpl tensorflow tf requires cuda version .
installed cuda version .
figure tpl lll i tensorflow core common runtim e gpu gpu device.cc creating tensorflow device gpu device name tesla k20m pci bus id .
e tensorflow stream executor c uda cuda dnn.cc loaded runtime cudnn library compatibility version but source was compil ed with compatibility version .
if using a binary install upgrade your cudnn libra ry to match.
if building from sources make sure the library loaded at runtime matches a compatible version spec ified during compile configuration.
f tensorflow core kernels conv ops.cc check failed stream parent getconvolvealgorithms algorithms lll cudnn tpl tensorflow tf requires cudnn version .
.
installed cudnn version .
.
figure tpl lll pip3 install torch .
.
cpu torchvision .
.
cpu f torch stable.html could not find a version that satisfies the requirement torch .
.
cpu from versions .
.
.
.
.post1 .
.
.post2 error no matching distribution found for torch .
.
.
cpupython .
tpl pytorch pytorch version .
.
python version .
figure tpl python i tensorflow core common runtime gpu gpu device.cc ignoring gpu device device name grid k520 pci bus id .
with cuda compute capability .
.
the minimum required cuda capability is .
.
hardware gputpl tensorflow tf requires cc .
gpu grid k520 with .
cc figure tpl hardware third partylibraryandpython tpl python thereare33dl compatibility issues caused by incompatibility between tpl and python accountingfor9.
.forexample figure 10showsthatthe developer trying to use pipto install pytorch .
however there are no pytorch wheels for python .
at the posted time resulting inpipbeingunableto f indacompatibledistributionforpytorch.
in addition using bitpython to install bit tplwheels also leadto compatibilityissues .
finding .
of dl compatibility issues are related to tpl python .
third partylibraryandhardware tpl hardware among the issues issues are caused by the incompatibility between tpl and hardware accounting for .
.
for example figure showsthattheminimumcudacapabilityrequiredbytensorflow is .
whilethe cudacapability of gridk520gpuis .
.
asa result the gpu device will be ignored and the model training will be performedoncpu.the hardware types are cpu gpu tpu andraspberrypi whiletplsarerelatedtotensorflow pytorch theano and lasagne .
moreover .
oftpl hardware issues are related to the incompatibility between tensorflow and cpu.
this is mainly because starting with version .
tensorflow binaries were built with enabling the support of avxinstructionsbydefault whichmaynotrunonoldercpu e.g.
intel r core tm 2duocput5870 amdathlondual core 4450e andintel r pentium r 3556u .
finding5 tpl hardware accountsfor6.
ofdlcompatibility issues.
.
of tpl hardware issues are caused by the incompatibility between tensorflowandcpu.
third party library and operating system tpl os dl compatibility issues are tpl os accounting for .
.
common os typesinthiscategoryaremacos linux windows and raspian lite os .
we can observe from the example shown in figure12that a symbol was missing in cpu feature guard .so1 import tensorflow oserror dlopen users blancoarnau tensorflow test env lib python3.
site packages tensorflow python platform .. .. core platform cpu feature guard.so symbol not found znkst3 115basic stringbuficns 11cha r traitsiceens 9allocatoriceee3strev referenced from users b lancoarnau tensorflow test env lib python3.
site packages tensorflow python platform .. .. core platform cpu feature guard.so which was built for mac os x .
expected in usr lib libc .
.dylibos macostpl tensorflow tf requires os version .
installed os version .
figure tpl os bazel test c opt tensorflow ... tensorflow compiler ... tensorflow contrib lite ... error error loading package encountered error while reading extension file closure defs.bzl no such package io bazel rules closure closure the native http archive rule is deprecated.
load bazel tools tools bu ild defs repo http.bzl http archive for a drop in replacement.
use incompatible remove native http archive false to temporarily continue using the native rule.
... info elapsed time .088s info processes.
failed build did not complete successfully packages loaded failed build did not complete successfully packages loaded tpl tensorflow dev bazel tf version r1.
bazel version .
.
figure tpl dev when importing tensorflow on macos .
.
this is because the installedtensorflowversionwasbuiltfor macos .
.
finding6 .
ofdl compatibilityissuesare tpl os.
third partylibraryanddevelopmenttool tpl dev there are10compatibilityissuesareclassi f iedas tpl dev accountingfor .
.therespectivedevelopmenttoolsincludecompiler building tools i.e.
bazel gcc and g ide i.e.
xcode and pyspark andother e.g.
broswer .forexample figure shows atpl dev issue related to bazel .
the developer attempted to build tensorflow r1.
from source using bazel but failed sincesomebazelfeaturesthattensorflowusedhavebeen deprecatedinbazelversionsnewer than0.
.
e.g.
.
.
.
finding .
of dl compatibility issues are related to tpl dev.
low level libraryand hardware lll hardware five issues are classi f ied as lll hardware accounting for .
.
this category mainly includes incompatibility between cuda cudnn and gpu.
for example cuda does not support gpu architecture compute 20 andsm 20 .
nvidia fermi m2090 is a gpu with compute capability .
that does not support cudnn library .
finding8 .
ofdlcompatibilityissuesare lll hardware .
others eachtypeinthiscategoryhasnomorethan f iveissues whicharerelatedto core python lll lll os hardware anddev hardware .forexample postswiththeids and forthefour types respectively.
finding dl compatibility issues can be also related to core python lll lll os hardware anddev hardware .
figure14showstheevolutionofdlcompatibilityissues.over time all types of dl compatibility issues show an increasing trend.
among these types core tpl tpl tpl and tpl lll have receivedmoreattentionfromdevelopers.withtheevolutionofdl frameworks api signatures and behaviors inevitably change to accommodate new requirements resulting in incompatible apis core tpl .
besides the integration of different tpls when building dl systems often leads to version mismatches between the librariesinvolved causingmoretpl tplissues.moreover tpllll issues have become more prevalent because dl systems often require dl frameworks to interact with low level libraries such 481compatibilityissues in deep learning systems problems andopportunities esec fse december3 san francisco ca usa core tpl tpl os tpl tpl tpl dev tpl lll lll hardware tpl python others tpl hardware 2022020406080100120number of issues year figure evolution ofdlcompatibility issues overtime as cuda and cudnn.
this interaction is necessary to improve training efficiency but itcan introduce compatibilityissues.
.
.
stages.
we classi f ied the manifestation stage of dl compatibilityissuesintotwostages as depictedintable installation.
the issueappeared intheprocess ofthe environment con f iguration of dl systems such as selecting software andhardware environments andinstalling compiling tpls.
execution.
the issue that appeared in the execution running of dl systems.
we observed that issues appeared in the execution stage while only issues were found in the installation stage.
this indicatesthatmostdlcompatibilityissuesarenotexplicit andoften expose only at runtime.
in particular most of core tpl tpl tpl .
tpl lll .
and tpl hardware .
occurred during execution.
in most cases compatibility issues would occur when core tpldynamically invokesothertpls apis.
onthecontrary mostof tpl python .
and tpl dev .
issues are manifested during the installation stage.
for example tpl python issuesarerelatedtotheinstallationstage.givenatpl itssupportedpythonversionsareoftenlimited especiallyforan olderpythonversion e.g.
.
orarecentlyreleasedpythonversion e.g.
figure .
moreover the number of compatibility issues related to tpl osis the same during installation and execution bothofwhichare6.for lll hardware threeissuesoccurredinthe executionstage whileothertwooccurredduringinstallation.
finding most .
of dl compatibility issues were exposedduringtheexecutionstage.
core tpl tpltpl .
tpl lll .
and tpl hardware .
are prone to occur during execution while tpl python .
andtpl dev .
are likely to appear inthe installation.
.
.
symptoms.
we classi f ied the impact of compatibility issues ondl systemsintothree categories breaking.
theissueledtothefailureofcomponentsattheinstallation stage or the termination of the program during execution.
low performance.
the issue caused a low execution efficiency.
unexpectedbehavior.
theissueresultedinunexpectedresults but the systemsdidnot throwan exception duringexecution.
wefoundthat321dlcompatibilityissueshaveabreakingimpact on both the installation and execution stages.
for example figure12shows that the system encounters an oserrorduring execution.
the large proportion of breaking impact on dl systems showsthenecessityandurgencytodeveloptoolsfordetectingand repairing such issues .table distribution ofroot causesand types typeapiincompatibilityucvmcrl totalvmcl vmll core tpl tpl tpl tpl lll tpl python tpl hardware tpl os tpl dev lll hardware others total althoughthereareonlyafewcompatibilityissuesthatcauselow performance and unexpected behavior to dl systems their impactisnotnegligible.fortheexampledisplayedinfigure due to thetpl hardware issue the system will perform model trainingonthecpu.thiswillsigni f icantlyimpactthemodeltraining efficiency.inaddition apievolutionmayleadtounexpectedbehavior in the code implementation.
for example torch.arrange returnsatensoroftype f loatfor0.
.0whileitreturnsatensorof type longfor .
.
.
finding11 most .
ofdlcompatibilityissueshavea breakingimpactontheinstallationstageorexecutionstage ofdl systems.
.
rq2 root causes andsolutions .
.
rootcauses.
weidenti f iedthefollowingthreerootcausesof dl compatibility issues including api incompatibility unsupported component andversion mismatch between compiled and runtime libraries.
table3depicts the distribution of root causes of dl compatibility issuesacrossthe types.
rootcause1 apiincompatibility.
thedlcompatibilityissueis causedbytheapievolutionbreakingtheforwardand orbackward compatibility.
we canobservefrom table 3that apiincompatibilityisthemostcommonrootcausethatinduceddlcompatibility issues .accordingtotheinteractionbetweencomponents api incompatibility can be further divided into two subcategories versionmismatchbetweencoreandlibraries apis vmcl andversionmismatchbetweenlibraries apis vmll .
finding api incompatibility is the most common root cause accounting for .
.
of which .
are caused by vmcl and40.
are inducedbyvmll.
versionmismatchbetweencoreandlibraries apis vmcl .
it can be seen from table 3that all the core tpl issues areintroducedbyvmcl.wefurtheranalyzedtheapievolution pattern adopted from in these issues as shown in table .
note that in the table we categorize the rename and relocated patterns as part of the remove pattern.
speci f ically removealias .
removemodule .
addparameter .
removefunction .
removeclass .
and addfuntion .
arethetop six api evolution patterns accounting for .
.
it is noted that removealias is mainly found in the issues related to tensorflow.
for example in order to make apis of tensorflow .
compatible with tensorflow .
developers usually remove the original alias and add a new one such as changing tf.get variable to tf.compat.v1.get variable .
in addition although developers usually attempted to not breaking backward compatibility whenchangingapis theseapievolutionchangesintroduced38.
forward incompatible issues as mentionedinfinding1.
482esec fse december3 san francisco ca usa jun wang guanping xiao shuaizhang huashan lei yepangliu andyuleisui table apievolution patterns invmcl issues pattern subpattern issues percentage total classaddclass .
removeclass .
changeinheritance .
functionaddfunction .
24removefunction .
changereturntype .
changereturnvalue .
parameteraddparameter .
23removeparameter .
addparameterdefault .
moveparameter .
moduleaddmodule .
22removemodule .
aliasaddalias .
26removealias .
attributeaddattribute .
2removeattribute .
others addexception .
total .
table distribution ofexceptions invmcl andvmll exception vmcl exception vmll attributeerror 47attributeerror importerror 27importerror typeerror 23typeerror modulenotfounderror 8runtimeerror runtimeerror 2valueerror others 8notimplementederror total 115others total finding the most common api evolution patterns relatedtovmclissuesare removealias .
removemodule .
addparameter .
removefunction .
removeclass .
and addfuntion .
.
versionmismatchbetweenlibraries apis vmll .
among the issues .
are caused by vmll which is the majorrootcauseof tpl tpl.thisismainlyduetotheindependent development and design of different libraries.
the lack of standardized speci f ications and limited testing also contribute to the issues.
particularly as mentioned in finding tensorflow keras introduced the most tpl tplissues which are caused by vmll as the examples shown in figures 6and7.
there are tpl tplissues relatedtothemixeduseofkerasandtf.keras.sincetensorflow2.
kerasbecomesthecoremoduleoftensorflow .toavoidthe compatibility issues caused by the mixed use of keras and tf.keras it is recommended to import all keras api from tensorflow i.e.
using tf.keras .
besides we further counted the exception type of issues caused byapiincompatibility i.e.
vmclandvmll asshownintable .
wefoundthat attributeerror importerror andtypeerror arethetop three most frequent exception types in api incompatibility issues whichcon f irmsasimilar result from .
finding attrituteerror importerror andtypeerror are the top three exceptions causedbyapi incompatibility.
root cause unsupported component uc .
compatibilityissuesarecausedbyusingunsupportedcomponentstothe installationand orexecutionofdlsystems.ucisthesecondmost common root cause that exists in all the types of dl compatibility issuesexcept core tpl .wecan observe fromtable 3thatallthe tpl python tpl hardware tpl os tpl dev lll hardware and othersare caused by uc.
some components are only compatible for speci f ic environments.
for example tensorflow only supports bit python shown in figure .
google tpu does not support somegraph operations when using tensorflow .
finding15 .
ofdlcompatibilityissuesarecausedby uc which is the second most common root cause.
besides ucisone ofthe root causes ofalltypes except core tpl .table distribution ofsolutions to apiincompatibility solutionvmclvmll totalforward backward versionchange code changechangeapi changeimport changebuild table distribution ofsolutions to ucand vmcrl solution ucvmcrl total versionchange code changechangeapi changeimport changebuild rootcause3 versionmismatchbetweencompiledandruntime libraries vmcrl .
there are .
dl compatibility issues caused vmcrl.
among them issues are related to tpl lll while among the rest f ive issues are tpl tpland one issues are lll lll.
compilation and execution are two separate processes whichareoftenconductedbydifferentdevelopers especiallyfor the releases of tpl binaries.
thus when executing a compiled binary it is difficult to con f igure required libraries if there is no guidanceprovided.
finding16 .
ofdlcompatibilityissuesarecausedby vmcrl ofwhich88.
are relatedto tpl lll.
.
.
solutions.
by analyzing the issues we identi f ied the following two common f ixing strategies that developers often use to solve dl compatibility issues covering issues.
note that someissuescan be f ixedbymore thanone solution.
versionchange.
theissuewas f ixedbychangingtheversion ofacomponent.
codechange.
theissuewas f ixedbychangingthecode mainly including changing api changing the import statement and changing the build f ile.
solutions to root cause .
table6shows the distribution of solutions to dl compatibility issues caused by api incompatibility.
for vmcl it can be observed that forward incompatible issues were solved by changing the tpl version while issues were repaired by changing the code api and import statement .
by contrast backward incompatible issues were f ixed by changing the code especially the api usage.
the results are expected.
it is convenienttoupgradetheinstalledversiontothecorresponding new version for the forward incompatible issues.
however for the backward incompatibleissues developers need to changethe api usage if they want to use the new tpl version.
besides for vmll 57issueswere f ixedbychangingtheversion and20issuesgota code f ix.
this is because changing the incompatible tpl version is easier thanchanging the code inatpl for f ixing such issues.
finding for compatibility issues caused by vmcl .
of forward incompatible issues were f ixed by changing the tpl version while .
of backward incompatible issues were repaired by changing the code.
in addition .
of issuescausedbyvmllwere f ixedbyversionchange.
solutionsto root causes 2and .
table7displays the distribution of solutions to uc and vmcrl.
uc caused issues were repaired by changing the component version while issues were f ixed by a code change especially changingthe build f iletorebuild remake.besides allthe vmcrlcausedissueswere f ixedbyaversionchange.forexample thec 483compatibilityissues in deep learning systems problems andopportunities esec fse december3 san francisco ca usa table library apievolution tool extract used api extract tplapi matchapi detect changes repairapi aexpy pycompat dlocator mlcatchup apiscanner relancer table detection andrepair ofdependencycon f licts tool infertpl inferpython inferlll pyego dockerizeme snifferdog pipreqs pydfix v2 watchman pycre smartpip apiversionofnumpythattensorflowcompiledagainstis0xb not installed0xa .
upgradingthe numpy version f ixedthe issue.
finding most .
of the issues caused by uc and all vmcrl induced issues were solved by changing the component version.
rq3 tool survey we conducteda toolsurveytostudy the currentresearchonautomatedaddressing dl compatibilityissues.
tool selection criteria and study approach.
we collected a totalof1 779researchpapersfromthetopseconferences i.e.
icse ase and fse published in acm proceedings over the past f ive years .toensureup to dateinformation wealsoincluded the accepted papers of icse which were available on the official website prior to our submission.
first wereviewedthe1 779collectedpaperstoidentifypapers thatmeetthefollowing f ilteringcriteria thepaperintroduces atoolspeci f icallydesignedtoaddressissuesrelatedto pythonand dependency con f licts orapi evolution orcompatibility issues the tool is readily available for download and use.
through this process we extractednine papers.
next wecontinuedtheidenti f icationprocessbyexaminingthe referencesandcitationsoftheninepapersobtainedinthe f irst step applying the same f iltering criteria.
at this stage we identi f iedadditional f ive papers andone tool.
finally weextractedatotalof15tools consistingof14papers and one tool from github.
we classi f ied these tools into two categories i.e.
library api evolution detection and repair of dependencycon f licts asshownintable 8andtable respectively.
twoauthorsindependentlyreviewedandidenti f iedallthepapers.theinter rateragreementwasmeasuredusingcohen skappa coefficient whichexceeded95 aftertheirinspection.incasesof inconsistency athirdauthorparticipatedinthediscussiontoreach a consensus and f inalize the results.
besides we also con f igured andexecutedthesetoolsto evaluate theirfunctionality.
toolsurveyresults.
thetoolslistedintable 8thatarerelatedto libraryapievolution canbecategorizedintotwomainapproaches static and dynamic.
the static approach involves establishing a knowledge base of library api evolution histories using manual or semi automatictechniques.thepythonprojectsourcecodeisthen parsed to extract the invoked apis through ast.
the extracted apis are subsequently matched against the library apis stored in the prebuilt knowledge base.
for example mlcatchup dlocator pycompat andapiscanner employthe static method to identify deprecated apis or apis with breaking changes in python projects.
dynamic methods are used by tools like aexpy and relancer .
aexpy uses dynamic re f lection to infer the types parameters aliases and inheritance making theapievolution knowledgebase morecomprehensive.
relancer adopts an iterative approach by executing code snippets in jupyter notebookanditerativelyrepairingdeprecatedapisbasedonthe runtimeerrormessages.
besides tools for resolving dependency con f licts in pythonprogramscanbedividedintostaticanddynamicapproaches.
inthestaticmethod thedependencyrelationshipsbetweenlibraries and their required versions are collected from platforms such as thepython pypirepositoryandlibraries.io.toolslikepyego pycre dockerizeme andwatchman convertthis collecteddataintoadependencyknowledgegraph.theythenparse theproject sasttoidentifytheresources e.g.
apis utilizedby libraries andusetheseresourcesasqueryconditions.bydesigning appropriate traversal algorithms they resolve the dependencies or version con f licts of libraries in the project by traversing the knowledge graph.
smartpip extracts version constraints between tplsfromaprebuiltknowledgebase.theseconstraintsarethen transformed into satis f iability modulotheories smt expressions.
bysolvingthesesmtexpressions smartpipeffectivelyresolvesversiondependenciesbetweentpls.pipreqs andsnifferdog adopt a different approach.
they f irst parse the project s ast to extracttheapisused.theythencomparetheseapiswiththeentries in a prebuilt database to infer the corresponding tpls used intheproject.dynamicmethodsarealsoemployedbytoolssuch as v2 and pydfix .
v2 builds on dockerizeme and uses runtimeerrormessages tonarrowdown the searchspacefor candidate tpls.
pydfix tackles dependency issues in large python projects by running the project s build process e.g.
pip install andpython setup .py andanalyzingthedependencyerrorsfound inthe buildlog.
finding of the six tools related to library api evolution none of them can fully realize the entire automation process from detection to repair of dl compatibility issues caused by api incompatibility.
for the resolution of dependency con f licts in python programs nine tools attempt to f ix dependencycon f lictsinducedby tpl tpl butonlyafewof them can infer the incompatibilities caused by the python interpreter versions and system libraries.
currently none of them can detect and f ix compatibility issues caused by cuda cudnn whichare commonly usedindl systems.
discussionsand implications .
comparisonwith traditionalsoftware python programs.
in python programs compatibility issues arise primarilyfromapiincompatibility anddependency con f lictsbetweenlibraries .sinceourstudyfocusesonpythonbaseddlsystems asde f inedinsection core tplandtpl tpl arethemostcommontypes .
ofcompatibilityissuesinthis domain.
dl systems characterized by their data driven nature demandsubstantialcomputationalresources e.g.
gpusandtpus to 484esec fse december3 san francisco ca usa jun wang guanping xiao shuaizhang huashan lei yepangliu andyuleisui expedite model training.
dl frameworksrely heavily on low level libraries particularly cudaandcudnn totakeadvantageof the computational capabilities of gpus.
as a result compatibility issuescanarisebetweendllibrariesandtheunderlyingcomponents especiallywithindlsystems.notably tpl lll tpl hardware andlll hardwarearecommontypesindlsystems accounting for .
ofthe totalcompatibilityissues.
androidapplications.
inandroidapplications compatibilityissues are mainly related to variations in device platform con f igurations evolutionary changes in the os and callbackcompatibility .similartoour f indings compatibility issues in android occur during both the installation and execution runtimestages .duringinstallation themajorityoffailuresareduetoapplicationsusinglibraryfunctionsthatarenotsupportedbytheunderlyingarchitecture.meanwhile runtimecrashes often stem from api incompatibility at different levels resulting from os evolution.
there are signi f icant differences in compatibility issues between android applications and dl systems.
for android applications compatibility issues are primarily caused by fragmentation where certain versions of the android os can only runoncertaindevices.ontheotherhand indlsystems incompatibilitywithhardwaredevicesoftenoccursduetoversionmismatch between the dl framework and the underlying hardware tplhardware .anotherdifferenceisthenatureofbreakingchanges.
inandroid breakingchangestypicallyresultfromtheevolutionof theos.incontrast dlsystemsexhibitgreaterindependenceatthe os level with fewer dependencies on speci f ic os versions.
besides the api changes are primarilydriven bylibrary evolution.
web applications.
compatibility issues in web applications encompass various aspects including cross browser compatibility and web api evolution related compatibility .
the f irsttypeisspeci f ictowebapplications.inadditiontodisruptive changes such as adding or removing methods and parameters api evolutioninwebapplicationsofteninvolvesissueslikeunsupported request access and api access restrictions.
these issues speci f ic to webapi evolution have not been observedindl systems .
others.linuxsystemcompatibilityismainlyre f lectedinkernelversioncompatibility applicationversioncompatibility andsystemapicallcompatibility .therootcauseofthesecompatibility issues often stems from the differences in the versions ofthesecomponents.tomaintainbackwardcompatibility linux developersoftenchoosetorenameoldapis e.g.
from vm86 to vm86old .
besides similar to dl systems compatibility issues in java software systems mainly include api evolution and componentcompatibility .however javasoftwaresystemsput moreemphasisonmaintainingbackwardcompatibilityofcomponents compared to our study which considers both forward and backward compatibility.
in addition the peculiarities of the java language such as the explicit speci f ication of class and method modi f iers result in api evolution patterns that differ from thoseobservedindl systems.
insummary compatibilityissuesindlsystemsdifferfromthose intraditionalsoftwareduetotheiruniquecharacteristicsandrequirements.
generalizations about traditional software may not be directlyapplicable to dl systems.
.
implications ensuringconsistencybetweenapiusageandinstalledlibrary versions .
a large proportion of dl compatibility issues are caused by api incompatibility especially the core tpl and tpl tpl findings1 and12 .dldevelopersshouldpayattention to the consistency betweenthe used apis and theinstalled library version.
in particular when encountering exceptions such as attributeerror importerror andtypeerror during execution finding developersaresuggestedtoconsiderthepotentialcompatibility issues.
forissuescausedbytheapiinvocationbetweentpland tpl a common practice isto reinstallthe libraries thatsatisfy the version constraints.
we suggest using tools like pyego to resolve the versioncon f lictsbetween tpls finding19 .
early determination of component versions .
due to the datadrivennatureofdl thesesystemsrelyheavilyonhigh performance computingresources e.g.
gpus to accelerate the model training process resulting in a high proportion of tpl lll tpl hardware and lll hardware issues findings and .
such dependencies often lead to breaking impact findings and .
therefore to maintainthecorrectcon f igurationofdlsystems developersshould carefullyexaminetheofficialdocumentstodeterminetheappropriate versions of components.
for example the tested compatible versions of cuda cudnn for different tensorflow versions thecompatibleversionsbetweencuda cudnnanddrivers andthe gpuarchitectures .
challengesinautomateddetectionandrepairofapievolutionissues.
constructapimappings twotypesofmappings need to be established.
the f irstmapping is between the api calls in the project and their corresponding de f initions in tpl.
current approaches mainly rely on matching the api names.
for example dlocator formats all api calls into a fully quali f ied name format i.e.
a.b.c.api name torepresentthehierarchicalstructure oftheentireapipath.thegoalistoeliminatetheimpactofaliases andallowforaccuratemappingtothetplapi.however thereare twoproblemswiththisapproach.first thepythonimportmechanismcancauseinconsistenciesbetweentheactualcallpathand theactualapipathinthesourcecode especiallyforcomplexdl frameworks.
for example the api torch.loadin pytorch version .
.0hastherealpath torch.serialization .loadinthesource code.otherapiswiththesamenameinclude torch.hub.loadand torch.jit.
init .load .thisinconsistencyleadstomultiple matchresults.second complexdlframeworkslikepytorch which havemanybuilt inapiscompiledinc c oftenhavemultiple overloadedapis.forexample torch.maxhasthree overloads in pytorch version .
.
making it challenging to determine the correct mapping between the called api and its de f inition in the tpl.thesecondmappinginvolvesestablishingrelationshipsbetween tpl apis across different versions to analyze api evolution.
mlcatchup creates this mapping manually because it isdifficult to automate.
mapping becomes particularly challenging when tplapisarerenamedorremoved.
repairandveri f ication this phaseaimstorepairandverifytheinvokedapisthathavebreaking changes.however automaticallyswitchingtoanotherapiwhen repairingaspeci f icapifailsisanon trivialtask.sequentialcode executionmakesitdifficulttocontinuetherepairprocess.for example when relancer fails to repair the f irst encountered 485compatibilityissues in deep learning systems problems andopportunities esec fse december3 san francisco ca usa api it cannot continue to repair other apis with breaking changes inthe code snippet.
challenges in automated detection and resolution of incompatiblecomponentversions.
pythoninterpreteridenti f ication inferringthespeci f icversionofthepythoninterpreter is currently done using the python standard libraries and syntax featuresemployedinpythonprojects .however thisapproach becomes challenging when projects don t use standard libraries or when explicit syntax features are absent.
low level library dependencyidenti f ication resolvingcompatibilityissuesthatarise fromlow levellibrariessuchascuda cudnn whichdependon speci f ic gpu hardware models poses signi f icant difficulties and mayrequirelow levelcodedependenceanalysis .
osspeci f icdependencyidenti f ication addressingcompatibilityissues stemmingfrom tpl os interactionsisanon trivialtask.
threats to validity internal threat .
the main internal threat comes from the subjectivebiasanderrorinthemanualclassi f icationandlabelingofdl compatibility issues.
we followed the open coding method in classi f icationandconstantlyoptimizedtheclassi f icationaccordingto theiterativerounds.tominimizesubjectivebias twoauthorsindependently classi f ied the posts compared their results and resolved anyinconsistenciesthroughdiscussionwitha thirdauthoruntila consensuswasreached.besides wetriedtoreproducethereported issues to facilitate the classi f ication process.
moreover the dataset ispubliclyavailable for further investigation andreplication.
externalthreat.
ourdatasetissourcedexclusivelyfromthe so without incorporating data from other sources.
this poses a potential threat to the generalizability of our f indings.
besides our study reliesontheselectionof12keywordsto f ilterthedata.however this approach may inadvertently exclude relevant posts thus introducingapotentialbias.toalleviatethisthreat weselectedsix commonkeywordsrelatedtopythonprogramexceptions which coveredabout54.
ofthe3 072posts.moreover theinclusionof postsrelatedtotheano adiscontinueddllibrary maylimitthe applicabilityofourresults.however thereareonly16compatibility poststagged with theano which isa relativelysmallproportion.
related work empiricalstudyondlbugs.
thecharacteristicsofvariousdl bugs have been widely studied e.g.
dl bugs taxonomy cloudapimisuse dljobfailures performanceissues developmentanddeploymentfaults dl libraries and compiler bugs and model optimization bugs .
for example yang et al.
conducted ananalysisofdlbugsongithubandfoundthatcertainbugswere the result of api evolution and incorrect con f igurations.
zhang et al.
highlighted that api in dl frameworks can lead to failuresindljobs.however thesestudiesdidnotspeci f icallyfocus oncompatibilityissues.ourpapercomprehensivelyanalyzesthe characteristics ofdl compatibilityissues.
analysis of api evolution in python libraries.
many studies focusontheanalyzingapievolution detectingand evaluating api changes in python projects.
zhangetal.
conductedthe f irstlarge scaleand f ine grainedstudy of the evolution patterns of python libraries.
du et al.
proposedaexpy anapi model basedapproachthatoutperforms existing toolsindetecting breaking changes inpythonlibraries.
repairingdependencycon f lictsinpythonprograms.
various studieshavefocusedonautomatingthedetectionandresolution ofdependencycon f lictsbetweentplsinpythonprojects .
thestate of the art pyego proposedby yeetal.
automaticallyresolvescompatibilityissuesrelated to the pythoninterpreter tpls andsystemlibraries.
compatibilityissuesinother softwaresystems.
compatibility issues have been widely studied in android apps .
many studies focus on detecting deprecated apis and developing tools to resolve compatibility issues .
for example zhaoet al.
proposed repairdroid a tool designed to address three types of compatibility issues in android apps os induced device speci f ic andinter callbackcompatibilityissues.besides the continuous evolution of web apis and client apps often leads to compatibility issues related to api evolution and cross browser behavior .furthermore severalstudieshavebeen conductedtoinvestigatecompatibilityissuesinotherdomains such as linux java c c and javascript .ourstudypresentsthe f irstcomprehensiveempiricalstudyof compatibility issues in dl systems distinguishing it from previous researchontraditional software.
conclusion inthispaper weconductedthe f irstcomprehensiveempiricalstudy tocharacterizecompatibilityissuesindlsystems.weidenti f ied dl compatibility issues from stack over f low posts.
by analyzing these issues we proposed a taxonomy of dl compatibility issues and learned their manifestation stages and symptoms.
we further summarized three root causes and two common f ixing strategies.
moreover we conducted a tool survey to investigate the current research state on automated detection and repair tools for dl compatibility issues.
we believe that this study can provide researchers and practitioners with a better understanding of dl compatibilityissuesandfacilitatefuture researchinrelated areas.
in the future we plan to leverage the f indings to develop tools for detecting andrepairing dl compatibilityissues.
data availability the replication package and the dataset are publicly available at .