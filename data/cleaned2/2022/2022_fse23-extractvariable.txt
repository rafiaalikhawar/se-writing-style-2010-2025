an automated approachto extracting localvariables xiaye chi beijing institute of technology beijing china chixiaye icloud.comhui liu beijing institute of technology beijing china liuhui08 bit.edu.cnguangjie li national innovation institute of defensetechnology beijing china weixiaowang beijing institute of technology beijing china bit.edu.cnyunni xia chongqinguniversity chongqing china xiayunni hotmail.comyanjiejiang beijing institute of technology beijing china yanjiejiang bit.edu.cn yuxia zhang beijing institute of technology beijing china yuxiazh bit.edu.cnweixingji beijing institute of technology beijing china jwx bit.edu.cn abstract extract local variable is a well known and widely used refactoring.itisfrequentlyemployedtoreplaceoneormoreoccurrences of a complex expression with simple accesses to a newly added variable.
although most ides provide tool support for extract local variables such tools without deep analysis of the refactorings may resultinsemanticerrors.tothisend inthispaper weproposea novelandmorereliableapproach called valextractor toconduct extract variable refactorings automatically.
the major challenge of automatedextractlocalvariablerefactoringsishowtoefficiently and accurately identify the side effect of the extracted expressions andthepotentialinteractionbetweentheextractedexpressionsand theircontextswithouttime consumingdynamicexecutionoftheinvolvedprograms.toresolvethischallenge valextractorleveragesa lightweight static source code analysis to validate the side effect of theselectedexpression andtoidentifywhichoccurrencesoftheselectedexpressioncouldbeextractedtogetherwithoutchangingthe semantics of the program or introducing potential new exceptions.
our evaluation results on open source java applications suggest that eclipse and intellij idea the state of the practice refactoring engines resulted in a large number of faulty extract variable refactoringswhereasvalextractorsuccessfullyavoidedallsucherrors.
theproposedapproachhasbeenmergedinto anddistributedwith eclipseto improve the safetyofextractlocal variable refactoring.
ccs concepts softwareanditsengineering softwaremaintenancetools integrated andvisual development environments .
corresponding author permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forpro f itorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe f irstpage.copyrights forcomponentsofthisworkownedbyothersthanthe author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspeci f icpermission and or a fee.
request permissions from permissions acm.org.
esec fse december san francisco ca usa copyright heldby the owner author s .
publicationrightslicensed to acm.
acm isbn ... .
software refactoring extractlocal variable reliable bugs acmreference format xiaye chi hui liu guangjie li weixiao wang yunni xia yanjie jiang yuxia zhang and weixing ji.
.
an automated approach to extracting local variables.
in proceedings of the 31st acm joint european software engineering conference and symposium on the foundations of software engineering esec fse december3 sanfrancisco ca usa.
acm newyork ny usa 13pages.
introduction theterm softwarerefactoring wascoinedbyopdyke referringtotheobject orientedvariantofrestructuring .ingeneral software refactoring could be de f ined as the process of changing a software system in such a way that it does not altertheexternalbehaviorofthecode yetimprovesitsinternalstructure .recently softwarerefactoringhasbeenwellstudiedasan efficientwaytoimprovesoftwarequality aswellasaneffective wayto facilitate software maintenanceand evolution .
refactoringtoolslikejdeodorant resharper andbuilt in refactoringenginesinides includingeclipse intellijidea netbeans and visual studio have been widely used to facilitate software refactoring.
extractlocalvariable orextractvariable forshort isoneofthe most popular refactorings.
notably dozens of software refactorings have been proposed ranging from low level refactorings like renamingvariable tohigh levelrefactoringslike teasingapartinheritance .bytrackingtherefactoringhistoriesofprogrammers murphy hilletal.
foundthat extractvariable wasthesecond mostpopularsoftwarerefactoring.
extractlocalvariable istocreate a local variable initialize it with a selected expression and replace oneormoreoccurrencesoftheexpressionwithdirectaccesstothe newvariable.thebene f itsoftherefactoringaretwofold .on oneside replacingcomplexexpressionswithanamedvariablemay increase the readability of the program because variable names are oftenmorereadablethancomplexexpressions.ontheotherside replacing multiple occurrences of the same expression with simple 313esec fse december3 san francisco ca usa xiaye chi huiliu guangjie li weixiao wang yunnixia yanjiejiang yuxiazhang andweixing ji accessestoavariablemayavoidrepetitivecomputationandthus reduce code complexity.
manuallyextractinglocalvariablescouldbetedious time consuminganderror prone.ithasbeenwellknownthatchangingsource code of complex software systems could be risky .
the same is trueforsoftwarerefactoring .tothisend mainstreamideshave provided automated tool support for this refactoring.
according to the survey by golubev et al.
.
of the surveyed developers use the ide support to conduct extractrefactorings e.g.
extract variables.
the empirical study conducted by negara et al.
suggests that extract variable is frequently performed with automated toolsupport.developerspfermover80 ofextractvariablerefactorings with automated tool support.
however such refactoring toolsoftensimplyreplaceallexpressionsthatarelexicallyidentical to the selected one without in deep analysis on the safety of the refactoring.
as a result even with such tool support extracting local variables could be error prone resulting in exceptions and semantic errors.
in section we explain with motivating examples why the state of the practice refactoring tools may introduce semantic errorswhileextracting local variables.
tothis end in this paper we propose anovel and more reliable approach called valextractor toconductextractvariablerefactorings automatically.
the major challenge of automated extract local variablerefactoringsishowtoefficientlyandaccuratelyidentifythe sideeffectoftheextractedexpressionsandthepotentialinteraction between the extracted expressions and their contexts i.e.
statementsaroundthem withouttime consumingdynamicexecution oftheinvolvedprograms.toresolvethischallenge valextractor leveragesalightweightstaticsourcecodeanalysistovalidatethe side effect of the selected expression and to identify which occurrences of the selected expression could be extracted together without changing the semantics of the program or introducing potential new exceptions.
we evaluated the proposed approach on open source applications by applying it and the baseline approaches eclipse and intellij idea to extract expressions in such applications.our evaluation results suggested that the state of thepracticebaselinesdidresultinhundredsofsemanticerrorswhile conductingextractvariablerefactorings.ourapproach however successfullyavoidedallsucherrors.besidesthat wealsoevaluated theproposedapproachandeclipsewith253real worldextractvariable refactorings discovered from open source applications.
our evaluationresultssuggestedthateclipseresultedinsemanticerrors in19outofthe253cases andanothermainstreamide intillijidea resulted in semantic errors on all such cases as well.
in contrast ourapproachsucceededinconductingallsuchrefactoringswithout introducing any semantic errors.
the paper makesthe following contributions anautomatedandmorereliableapproachtoextractinglocal variables injava applications.
abenchmarkconsistingof253real worldextractlocalvariable refactorings.
an evaluation of the proposed approach on the benchmark whosereplicationpackage includingdetailedinstruction for replication ispubliclyavailable .1private static string parsetoken string pattern int indexref ... 3if pattern null pattern.length max len 4return null 6while i pattern.length ... ... 10char lastchar pattern.charat pattern.length 11pattern default pattern 12int j indexref 13while j pattern.length ... listing motivatingexample motivating example in this section we explain with a motivating example the potential risks in extract variable refactorings and how we minimize such risks.
the motivating example is presented in listing1.
suppose that a developer realizes that there are many instances of expression pattern.length in the motivating example as shown in colors and would like to replace such instances with a local variable.
to this end the developer selects the expression pattern.length at line within eclipse1 rightclicks it and selects menu item refactoring extract local variable as well as the checkbox replace all occurrences of the selected expression with