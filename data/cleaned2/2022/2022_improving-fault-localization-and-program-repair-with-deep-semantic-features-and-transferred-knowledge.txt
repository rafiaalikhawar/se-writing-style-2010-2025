improving fault localization and program repair with deep semantic features and transferred knowledge xiangxin meng sklsde lab beihang university beijing china mengxx act.buaa.edu.cnxu wang sklsde lab beihang university beijing china wangxu act.buaa.edu.cnhongyu zhang the university of newcastle nsw australia hongyu.zhang newcastle.edu.au hailong sun sklsde lab beihang university beijing china sunhl act.buaa.edu.cnxudong liu sklsde lab beihang university beijing china liuxd act.buaa.edu.cn abstract automaticsoftwaredebuggingmainlyincludestwotasksoffaultlocalizationandautomatedprogramrepair.comparedwiththetraditionalspectrum basedandmutation basedmethods deeplearning basedmethodsareproposedtoachievebetterperformanceforfaultlocalization.however theexistingmethodsignorethedeepsemantic features or only consider simple code representations.
they do notleveragetheexistingbug relatedknowledgefromlarge scale open source projects either.
in addition existing template based programrepairtechniquescanincorporateprojectspecificinforma tionbetterthandeep learningapproaches.however theyareweak in selecting the fix templates for efficient program repair.
in this work weproposeanovelapproachcalledtransfer whichleveragesthedeepsemanticfeaturesandtransferredknowledgefrom open source data to improve fault localization and program repair.
first webuildtwolarge scaleopen sourcebugdatasetsanddesign bilstm based binary classifiers and a bilstm based multiclassifier to learn deep semantic features of statements for fault localization and program repair respectively.
second we combine semantic based spectrum basedandmutation basedfeaturesand use an mlp based model for fault localization.
third the semanticbased features are leveraged to rank the fix templates for program repair.ourextensiveexperimentsonwidely usedbenchmarkdefects4j show that transfer outperforms all baselines in fault localization andisbetterthanexistingdeep learningmethodsin automated program repair.
compared with the typical templatebased work tbar transfer can correctly repair more bugs in total on defects4j.
corresponding author xu wang wangxu act.buaa.edu.cn.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
concepts software and its engineering software verification and validation.
keywords fault localization program repair transfer learning neural networks software debugging acm reference format xiangxinmeng xuwang hongyuzhang hailongsun andxudongliu.
.improvingfaultlocalizationandprogramrepairwithdeepsemantic featuresandtransferredknowledge.in 44thinternationalconferenceon software engineering icse may pittsburgh pa usa.
acm new york ny usa pages.
introduction fault localization fl and automated program repair apr are two consecutive tasks for automatic software debugging.
fault localizationprovidesthesuspiciousfaultlocationsandthenapr tries to repair them.
since of the total software cost is spent onfinding softwarefaults fault localizationapproaches have beenwidelystudiedtoreducetheheavyburdenondevelopers .faultlocalizationcanbeconducted at different granularities such as class method and statement .
the finer the localization granularity is the easier the subsequent bug repair task would be.
thus we prefer faultlocalizationatthestatementlevel.basedonthelocatedfaulty lines of code many apr approaches have been proposed to fix the faults .
traditionalfaultlocalizationapproaches suchasspectrum based and mutation based methods adopt manually extracted featuresto locate suspicious code elements .spectrum basedfaultlocalization sbfl producesasuspicious score for each code element i.e.
class method or statement by performingstatisticalanalysisoffailed passedtestcases.mutationbased fault localization mbfl applies specific mutation operators to the original code elements and analyzes the execution of themutants.
besides sbfl and mbfl other features including code complexity codechangefrequency andtextsimilarityarealsoleveragedtoimprovefaultlocalization .hybridapproaches have also been proposed to combine multiple suspicious scores from different fl techniques .
ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa xiangxin meng xu wang hongyu zhang hailong sun and xudong liu recently deep learning based approaches such as deepfl anddeeprl4fl areproposedforfaultlocalizationandhave achieved promising results.deepflimproves fault localization by integratingmorethan200featuresfromspectrum based mutationbased complexity based andtextualsimilarityfeatures.deeprl4flimprovesfaultlocalizationperformanceatthestatementandmethod level by incorporating representation learning of code coverage datadependency andcodesemantic.however theseapproaches have two major limitations.
first although deep semantic infor mation has been proven to be effective in code representation thedeepsemanticfeaturesofsource codeareignoredbydeepfl anddeeprl4flonlyconsiderssimple semanticrepresentation by thefully connected layerafter the concatenation of word embeddings at the statement level second although the bug related knowledge extracted from historical bug reports and bug fix commits is helpful for bug detection theexistingapproacheslargelyignoresuchbug relatedknowledge.
in this work we consider the deep semantic features of source code and the transferred knowledge from open source bug data to further improve fault localization.
having obtained the suspicious code returned by fl techniques the template based repair methods are widely used for automated program repair .
these methods utilize fix templates predefined or extracted from similar code snippets to repair specific bugs.
among them tbar uses manually extracted common fix templates and selects them one byoneinapredefinedimmutableordertogeneratepossiblepatches.
recently theencoder decoderbasedneuralprogramrepairtechniqueshavebeenpresentedtogeneratecoderepairpatchesbeyond predefined templates .
however they intend to produce the frequent repair patterns and words in the training set andignoretheprojectspecificinformation .recoder learns syntax guided edits i.e.
templates and replaces placeholders with possible project specific identifiers to optimize neural programrepair.
since template based apr methods naturally adopt local informationinfillingtemplates weleveragethedeepsemanticfeatures and transferred knowledge to help select better fix templates for efficient repair and remove plausible but incorrect patches.
in this work we propose transfer a novel deep learningbasedapproachtofaultlocalizationandprogramrepairbyincorporating the deep semantic features and transferred knowledge from the large scale open source bug datasets.
more specifically weconstructtwolarge scalebugdatasetscollectedfromhighquality github projects to learn bug related knowledge for fault localization dataset fl andautomatedprogramrepair dataset pr respectively.
we choose kinds of bug fix templates from tbar basedonthebugpopularityandtreatthemasthepossiblebug types.
based on these bug types we then build datasets consistingof785 134samplesasourfaultlocalizationdataset dataset fl.
we also use bug fix commits and their bug types to constructourprogramrepairdataset dataset pr.foreachbugtype we train a bilstm based binary classifier to predict whether or notonemethodcontainsabugofthistypeinaspecificlocation.we also train a bilstm based multi classifier model to predict which fixtemplateshouldbetriedtorepaironesuspiciousstatement.thelearnedclassifierswillbereusedtotransferbug relatedknowledge to target projects.
forthefaultlocalizationtask transfer fl weextracteach statementanditscontextualmethodofatargetprojecttoobtain itsdeepsemanticfeaturesbyperformingthe11binaryclassifiers trainedondataset fl.thesemanticfeatures togetherwithexisting spectrum basedandmutation basedfeatures arefurtherusedto train an mlp based multi layer perceptron ranking model for all statements.inthisway wegeneratethesuspiciousscoreofeach statementfromthemlp basedrankingmodelforfaultlocalization.
for the program repair task transfer pr based on the bilstm based multi classifier trained on dataset pras the transferredknowledge wefurtherfine tunethemodelparameterson the target project.
given an unseen and faulty statement the 11dimensionvectoroutputbythemulti classifierrepresentstheprobabilities for selecting the corresponding fix template.
the selection orderoffixtemplatesbasedontheseprobabilitiesisusedtoimprove program repair.
weconductextensiveexperimentson395realsoftwarefaults fromthewidelyuseddefects4jbenchmark v1.
.
toevaluate our proposed approach.
the experimental results show that for thefaultlocalizationtask ourflmethod transfer fl significantlyoutperformsallbaselinesincluding3typicalspectrum based methods mutation based method and recent deep learningbasedmethods.specifically ourapproachincreasesthefaultshit by on top respectively.
for the automated program repairtask ouraprmethod transfer pr outperformsboththe state of the art template based repair technique tbar and the state of the art deep learning based repair technique cure .
comparedwiththestrongbaselinetbar transfer thecombination of fl and pr canwork together to correctly repair more bugs in total on defects4j.
the main contributions of this paper are as follows we build two large scaleopen source bug datasets anddesignbilstm basedclassifierstolearndeepsemanticfeatures of statements for fault localization and program repair.
weproposetransfer whichleveragesthesemantic based spectrum based andmutation basedfeaturesforeffective fault localization and leverages the semantic based features for effective program repair.
we conduct extensive experiments on widely used bench mark defects4j to evaluate our approach and the experimental results confirm that our approach is effective.
related work learning basedfaultlocalization.
learning to rank isan importantapproachininformationretrievalarea whichutilizessupervised machine learning to solve ranking problems.
some recent studies apply the learning to rank strategy to fault localization whichtakesmultiplefeaturesasinputsfromdifferent sources suchassuspiciousscoresfromsbflandmbfltechniques.
amongthem thepairwisetrainingisfrequentlyusedtorankfaulty elements before correct ones.
recently deep learning based approachesareproposed suchasdeepfl anddeeprl4fl which achieve promising results for fault localization.
deepfl improvesfaultlocalizationbyintegratingmorethan200featuresfrom four traditional feature groups but misses the deep semantic fea tures.
deeprl4fl combines a coverage representation approach authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving fault localization and program repair with deep semantic features and transferred knowledge icse may pittsburgh pa usa with code representation learning for fault localization which simplyusesthefullyconnectedlayerwiththeconcatenationmatrix of word embeddings at the statement level.
both deep learning based methods have not captured the deep semantic features of source code well especially the sequential dependencies of tokens whichlimits theeffectiveness ofstatement level faultlocalization.
grace is another deep learning based method which leverages gnns gatedgraphneuralnetworks tolearnvaluablefeatures fromthegraph basedcoveragerepresentation.however itremoves all children nodes of the statement structures of asts abstract syntaxtrees whichisusefulformethod levelflbutmissesthe statement level semantics.
moreover the method level fault localization effectivenessof grace isworse thandeeprl4fl so itis not included in our fault localization experiments.
template basedprogramrepair.
template basedprogramrepair approach is a widely studied researcharea in apr which utilizespredefinedfixtemplatestofixspecificbugs.therepairprocess can be basically divided into four steps i.e.
fault localization fix template selection donor code search and patch candidate validation.thefirst3stepsofthemdeterminethefinaleffectivenessof the corresponding repair technique.
typical template based program repair techniques include tbar simfix avatar fixminer and so on.
among them tbar is the state ofthe art template based repair technique which contains commonly used fix templates and achieves a good performance on the benchmark defects4j .
however the approach of fix template selection has not been well studied which influences the entire program repair task.
deeplearning basedprogramrepair.
recently somestudies treat the program repair task as a statistical machine translationtask and adoptthe widely used encoder decoder architecture to learn to generate possible patches.
dlfix proposes an efficient way to embed the contextual information into the faulty statement.
coconut combinescnns convolutionalneuralnetworks andanewcontext awareneuralmachinetranslationarchitectureto generate patches token by token.
cure pre trains a language modeltoextractbug fixknowledgeandproposeanewcode aware search strategy to reduce the search space.
recoder learns syntax guided edits i.e.
templates and replaces placeholders with possible project specific identifiers to optimize neural program repair.nevertheless theprojectspecificinformationishardtolearn andthefrequentrepairpatternsandwordsappearingintraining sets are more likely to be selected.
in contrast template based aprmethodsnaturallyadoptlocalinformationtofilltemplates butthey cannot effectively select fix templates.
in this work we address thetemplate selection problem by learning useful semantic knowledge fromopensourcecode whileretainingtheadvantagesoftemplatebasedtechniques.therecentdeeplearning basedprogramrepair methodsincludingdlfix coconut andcure ar e used as baselines in this paper.
proposed approach .
overview in order to improve the performance of statement level fault localization and automated program repair the deep semantic features of statements and the transferred knowledge from large scale bugdatasetsareleveraged inourapproach.asshownin figure1 our approach transfer mainlyincludesthreecomponents.thefirst component section3.
isdesignedtolearntransferredbug related knowledge from our two large scale open source bug datasets which includes different binary classifiers to detect whether one statementhascorrespondingbugsandonemulti classifiertopredictwhichfixtemplateshouldbeusedforafaultystatement.based on the transferred knowledge the second component transferfl section .
aims to improve fault localization with the deep semanticfeatures andthethirdcomponent transfer pr section .
can improve automated program repair by predicting the order of fix templates to be used.
.
learning transfer knowledge .
.
extractionofbug fixcommitsfordifferentbugtypes.
we firstcollectandanalyzealargenumberofhistoricalbug fixcommits in open source projects.
specifically we collect open source java projects with most stars on github.
four projects i.e.
joda time closurecompiler apachecommons lang andapache commons math areremovedfromthecollectedprojectsbecause theyalso existinthe targetbenchmark i.e.
defects4j .weutilize theapproachdescribedin toextractallcommitsrelevanttobug fix.
specifically a commit is considered bug relevant if its message contains keywords such as error bug fix issue mistake incorrect fault defect flaw type etc.wekeepthecommitsthatmodifycodeinonlyonemethod andintotal1 628commits are collected.
wethenidentifybugtypesfromthebug fixcommits.giventhat theextractedcommitsarerelatedtobugfix ifthecodemodificationsofacommitmatchthechangeactionsdefinedinaspecificfix template the code element before this commit is made is considered to contain the corresponding type of bugs.
a fix template definesapatternofcodemodifications whichisappliedtoafaulty code element to help generate possible patches.
if a buggy code elementcisrepairedafterapplyingthefixtemplate ft wesaythat ccontainsbugswithatypecorrespondingto ft.wecollectall15 fix templates defined in tbar and the corresponding bug type of each fix template is shown in table .
we implement an ast based abstract syntax tree syntax checkerthroughanast basedcodedifferencingalgorithm similar togumtree andarule basedmatchingtoolthatmatchesthe edits to the fix templates shown in table .
on the one hand once a fix template is identified the code element before the commitis tagged with the corresponding bug type.
note that a commitmay match multiple fix templates because the predefined codechange actions in different fix templates may overlap.
as the ex ample shown in table both mutate conditional expression and mutatevariable fixtemplatesarematched whiletheformerconsidersthemodificationfrom a atoa bandthelatterconsiders that fromatob.
on the other hand if no fix template is identified the commit will be discarded.
simultaneously we mark the startline of the statement where modification is located as the faulty position.
still taking table as an example the line is marked as faulty position because it is the start line of the if statement which wraps the modification.
to verify the correctness of the labeling authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa xiangxin meng xu wang hongyu zhang hailong sun and xudong liu figure an overview of transfer process using our syntax checker we have randomly sampled results and checked that they are all accurate.
afterapplying thesyntax checker wefind thatthe numbersof commits corresponding to bug types are very small less than whicharedifficulttobeutilizedforthesubsequentlearning tasks soweonlystudytheremaining11bugtypes shownintable in this paper.
in total commits are extracted with the annotations of bug types and faulty positions.
.
.
dataset construction.
construction of dataset fl.having collected the bug fix commits tagged with bug types we assign each commit to one or more groups in total according to its bug type s .
then for each group we further extract all the methods before the commits were made as the positive samples.
each positive sample consists of two parts the faulty statement which marked with bos and eos and2 the contextualmethod ofthe faulty statement.the first column in table gives the positive sample to the commit intable2for mutatevariable fixtemplate.inthisexample since the faulty code element is the variable ain line whose nearest statement typeancestoristheifstatementwrappingit.thus we addthemarks bos and eos atthestartandendpositionof line respectively.
since the commit is also tagged with the bug type corresponding to mutate conditional expression for this fix template the generated positive sample is the same as that of mutate variable because the nearest statement type ancestor of the faulty code element a ais also the if statement.
tocollectthenegativesamples weproposeanewapproach.we firstlookforanotherstatementinthesamemethod whichcontains the same necessary syntax ingredients as the positive sample.
thenecessarysyntaxingredientsforeachfixtemplate bugtype areunderlinedinthesecondcolumnintable1.ifnosuchstatement is found in the method we will expand the scope and continue searchinginthesamejavafile.wecollectallstatementscontaining thenecessarysyntaxingredientsandthecorrespondingmethods theybelongtoasnegativesamplecandidates andthenselectoneofthemrandomly.however ifnosuitablenegativesamplesarefound the corresponding positive samples will be discarded in order to constructabalanceddataset.thesecondcolumnintable3showsa negativesamplecorrespondingtothealreadygeneratedpositive sample in the first column for mutate variable fix template.
the necessarysyntaxingredientof mutatevariable isavariablecode element as long as a statement contains at least one variable itcan be selected and marked to generate a negative sample.
thus bothreturna andreturnb statementscanbemarked.afterthe random selection the former is finally marked and the negative sample is generated.
finally datasets containing positive samples and the samenumberofnegativesamples 134intotal areconstructed for the subsequent fault localization task the detailed statistics are shown in table which are called collectively as dataset fl.
construction of dataset pr.for program repair given a faulty statement our goal is to select the correct fix templates to repair it which can be regarded as a multi classification task.
thus for each commit extracted in section .
.
we only keep the method before thecommitwasmadeandcategorizeitintooneofthe11predefined bug types.
as a bug fix commit can be tagged with one or morebug types we assign it to the bug type that is deeper in the ast hierarchy.intuitively adeeperastnodeneedsarelativelysimpler authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving fault localization and program repair with deep semantic features and transferred knowledge icse may pittsburgh pa usa table fix templates and the corresponding bug types fix templates corresponding bug types insert cast checker at least one cast expression exists without checking the compatibility of the original type and the cast type.
insert range checker at least one array collection access exists without checking whether the index key is beyond the scope.
insert null pointer checker at least one field expression is used without checking if it has a nulltype.
insert missed statement missing a specific type of statement including method invocation return if try catch statement.
mutate conditional expression a conditional expression should be added removed or modified.
mutate data type the data type used in cast expression or variable declaration expression is incorrect.
mutate literal expression the literal expression used in the statement is incorrect.
mutate method invocation expression the name or at least one of the parameters of the method invocation expression is incorrect.
mutate class instance creation super.clone method should be used rather creating a new class instance in an overridden clone method.
mutate integer division operation an integer literal is used in division operation and results in the loss of accuracy.
mutate operators at least one relational arithmetic instanceof parentheses operator is incorrectly used.
mutate return statement the expression in return statement is incorrect.
mutate variable the variable used in the statement is incorrect.
move statement a statement is placed in an incorrect position.
remove buggy statement a statement should not appear in the current position and is expected to be removed.
table2 ajavacodeexamplebeforeandafterthecommit method before commit method after commit 23456public int max int a int b if a a return a return b public int max int a int b if a b return a return b table an example pair of positive and negative samples for the fix template mutate variable positive sample negative sample 123456public int max int a int b bos if a a eos return a return b public int max int a int b if a a bos return a eos return b repairtemplatewithasmallerchangearea whichispreferredby actual developers.
for example for the method before the commit wasmade shownintable2 thecorrespondingastisconstructed infigure2.wecanseethatthecodeelementfocusedonby mutate conditional expression is the conditional expression node whose depthis4 whilethecodeelementfocusedonby mutatevariable is the variable node a the child of right operand node whose depth is .
thus the mutate variable should be selected as the unique label because it focuses on a deeper ast node.
inthisway weconstructadatasetwith11categoriesand408 samplesintotal whichiscalled dataset pr.eachsampleconsistsofa faultystatementwiththecontextualmethodanditscorresponding bug type.
the detailed statistics are shown in table .table statistics of dataset flanddataset pr where positive and negative samples are seperated by the slashes.
fix templates samples indataset fl samples indataset pr insert null pointer checker insert missed statement mutate conditional expression mutate data type mutate literal expression mutate method invocation expr.
mutate operators mutate return statement mutate variable move statement remove buggy statement total figure an example to illustrate the selection of theunique bug type authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa xiangxin meng xu wang hongyu zhang hailong sun and xudong liu .
.
learning knowledge for fault localization.
the design of binary classifiers.
we build bi lstm based binaryclassifierswithsamestructurestojudgewhetherthebugs withcorrespondingbugtypeexistinthecodeornot.theoverall architectureofthemodelisshowninfigure3.sincewearestudying statement level fault localization the input of the model is a token sequence t1 t2 ... tn including the specified statement and its contextual method where nrepresents the length of the token sequence.
then the token sequence is fed into an embedding layer withthepre trainedword2vec parameters we r v dwhere vis the vocabulary size and dis the embedding dimension of each token to generate a sequence of token vectors e1 e2 ... en .
the vector representation ekof tokentkcan be obtained by ek wetxk wherexkistheone hotrepresentationoftoken tk.next weutilize lstm one type of recurrent neural network to extract the contextualsemanticfeaturescontainingtokensequentialdependencies while the fully connected layer after the concatenation matrix of token embeddings used in deeprl4fl in statement level fault localization cannot extract such dependency relationships.
inordertoobtainricherdependencyinformationamongtokens we adopt a bidirectional lstm bi lstm the output of which is a new state generated by concatenating the hidden states from both directions at time t ht lstm et ht lstm et ht toextractthemostimportantfeaturesforeachdimension wekeep the hidden states of all time steps which are then pushed into a stack and sampled by max pooling.
we assume that the result after processing of max pooling is g which is calculated as follows g max t n ht1 max t n ht2 ... max t n ht 2m wheremrepresents the dimension of hidden states.
finally we putginto a dense layer with softmax activation function and the output indicates the probability of containing the corresponding type of bugs which is exactly the semantic feature we need.
trainingthebinaryclassifiers.
wedividethetrainingtaskinto two phases.
in the first phase for each of the bug types weuse dataset flfor model training after which the optimal model parameters are saved.
we call the knowledge learned in this phase astransferredknowledge.inthesecondphase eachsuspiciousstatementwithitscontextualmethodintargetdatasetsisinputintothe trained models to obtain deep semantic features.
in addition as mentioned above the annotated statements in both positive and negativesamplesin dataset flmustcontainthenecessarysyntax ingredientsforitscorrespondingbugtype.therefore inthesecond phase for each suspicious statement in target projects we first judgewhetherthe statementcontainsthenecessarysyntaxingredientsrequiredbyeachbugtype.ifitdoes thisstatementandits contextual method will be input into the binary classifier for the corresponding bug type to obtain the output probability otherwise theprobabilityissetto0ifthenecessarysyntaxingredientsmiss.
in this way the dimension deep semantic features are extracted for all suspicious statements in target projects which will be used in the subsequent fault localization task.
figure bi lstm based binary classifier model for learn ing transfer knowledge for fault localization .
.
learning knowledge for program repair.
for selecting correct fix templates to enhance the existing template based program repairapproaches webuildabilstm basedmulti classifier whosearchitectureisthesameasthebinaryclassifierdescribedinsection .
.
exceptthedimensionoftheoutputlayer whichischanged from to i.e.
the number of bug types .
we feed the large scale dataset printothemulti classifierformodeltraining andinthis way the transferred knowledge for judging which fix templates shouldbeselectedfirsttogeneratepatchesislearned whichcan be used for the subsequent program repair task.
.
transfer fl effective fault localization based on transferred knowledge .
.
spectrum based and mutation based features.
spectrum based features.
spectrum based fault localization sbfl is one of the most widely studied fault localization approaches.sbflapproachestakesourcecodeandrelevanttestcases as inputs and output a sorted list of code elements ordered by suspiciousscores whicharecalculatedfromtheexecutioninformation of test cases.
it has been found that the results of sbfl approaches can serve as part of input features for training learning to rankmodels in some recent studies .
learning to rank approaches have been proved to help better fault localization byoptimizing the combination of features .
in this work we adopt the learning to rank method and select most commonlyused sbfl techniques i.e.
tarantula ochiai and dstar to generate features for the spectrum based feature group.
theequationsofcalculatingsuspiciousscoresforthethreesbfl techniquesareasfollows where tf e tp e representsthenumber offailed passed testsexecutingcodeelement e whiletf e tp e represents the number of failed passed tests that do not execute e andtf tprepresents the number of all failed passed tests.
tarantula sus e tf e tf tf e tf tp e tp authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving fault localization and program repair with deep semantic features and transferred knowledge icse may pittsburgh pa usa ochiai sus e tf e radicalbig tf tf e tp e dstar sus e tf e tp e tf e mutation based features.
mutation based fault localization mbfl is another approach which calculates suspicious scores by analyzing the changes of execution results between the original codeelementanditsmutants.similartosbfl theoutputsofmbfl approaches can also serve as input features for learning to rank models .
mbfl approaches need to additionally specify the set of mutation operators as well as the granularities of failure outputs messages.
we adopt the four types of granularities proposed by trapt passed failed information exception type information exception type and message exception type message and the full stack trace of exception.
as described in metallaxis the formulae from sbfl approaches can be utilized to calculate suspicious scores for mutants and the highest score among all mutants is then selected as the suspicious score of the corresponding original code element.
equation takesochiai algorithm as anexample where m e denotes all mutants of code element e t m f e denotes the number of originally failed tests which are impacted by mutant m t m p e denotes the number of originally passed tests whichare impacted by mutantm and so on.
we choose the frequently used ochiai algorithm for metallaxis to extract the mutation based features.
finally mutation based features are extracted because types of granularities are considered which are mentioned above.
sus e max m m e t m f e radicalbigg t m f t m f e t m p e .
.
deepsemanticfeatures.
bothsuspiciousscoresgenerated by sbfl and mbfl approaches can be used as input features for alearning to rankmodeltoimprovetheeffectivenessoffaultlocalization.
however the semantic features have not been included yet whichcanprovideusefulinformationfromadifferentaspect.
infaultlocalizationresearcharea especiallywhenprogramdata iscompilableandexecutable thedynamicexecutioninformation is still the most frequently used feature .
in contrast the use of static semantic features is relatively preliminary such as deeprl4fl which simply uses the fully connected layer withtheconcatenationmatrixofwordembeddingsatthestatement level.
therefore our goal is to propose a more effective way of extractingand utilizingcontextualsemanticsto furtherimprovethe effectiveness of fault localization.
as described in section .
.
we have obtained the dimension deep semantic feature of each suspicious statement in the target dataset by applying the transferred knowledge learned from the large scale dataset fl.
.
.
faultlocalizationwithtransferredknowledge.
throughthe abovesteps threefeaturegroupsareobtained including3spectrumbased features mutation based features and deep semantic features.wecancombinethesefeaturesinalearning to rankmodelto predict the probability of being faulty for each suspicious statement in the target project.
compared with the task in section .
.
tojudgewhetherasuspiciousstatementcontainsbugswithspecific types thecurrenttaskcanalsoberegardedasabinaryclassification task to judge whether bugs exist in a suspicious statementno matter what bug type it is.
thus a model based on the mlp multi layer perceptron architecture is designed to achieve this goal which is shown in figure .
before fed into the model the spectrum basedandmutation basedfeaturesarenormalizedbythe ranking positions because the suspicious scores before normalizationarenotnecessarilyintherange whilethedeepsemantic features are.
the equation of calculating the normalized score of suspicious statement eis as follows sus e index e len suspicious list wheresuspicious listisasortedlistcontainingallsuspiciousstatements in the target project.
it is sorted according to the suspi cious score before normalization of each statement from biggestto smallest.
function len suspicious list returns the length of suspicious list andfunction index e returnsthepositionwhere the suspicious score of elast appears in the suspicious list.
for example if suspicious listcontains statements a b c d e andthecorrespondingsuspiciousscoresare .
.
.
.
.
then the normalized scores of the five statements are calculated as .
.
.
.
.
.thus thethreegroupsofnormalizedfeatures can now be fed into the model.
since the number of features indeep semantic group exceeds the other two groups a lot it mayhave an unexpected greater impact on the results.
thus we first putthe11semanticfeaturesintoanmlp semanticfusionlayerin figure the output dimension of which is set as .
then the new generated3 dimensionsemanticfeatureisconcatenatedwithother two feature groups to obtain a dimension vector which is then fedintoanothermlp multi sourcefusionlayerinfigure4 for automaticfeatureextraction.finally thedataflowstotheoutput layer and a dimension vector normalized by softmax activation function is generated.
the output vector gives the probability ofbeing faulty for the current suspicious statement which can beregarded as a new suspicious score.
a new suspicious list can be generated according to the suspicious scores of all statements.
.
transfer pr effective program repair based on transferred knowledge .
.
template based program repair.
template based automated program repairis widelystudied whichutilizes fix templates predefined or extracted from similar code snippets torepair specific bugs.
the repair process can be basically divided intofoursteps faultlocalization fixtemplateselection donorcode search and patch candidate validation corresponding to step tostep4inalgorithm1respectively.thefirst3stepsareclosely related to patch generation while the last step is for validation.
therefore underthepremisethatatemplate basedrepairtechnique has been selected that is the set of fix templates to be used has beendetermined wecanoptimizethefirst3stepstotunetherepair performance.
step corresponds to our attempt to optimize theeffectiveness of fault localization tasks in section .
.
for step a naive way is used to traverse all fix templates e.g.
predefined authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa xiangxin meng xu wang hongyu zhang hailong sun and xudong liu figure mlp based ranking model for fault localization orderorrandomtraversal intraditionaltemplate basedprogram repairtechniques whichisunabletogiveguidanceforwhichfix template should be selected first to generate patch candidates for a specificinput.thisleadstoaproblemduringbugfixing.assuming that the real faulty statement is reached the repair technique may still generate a plausible but incorrect patch candidate i.e.
a patch canpassalltestsbutisregardedasaincorrectpatchafteramanual check becauseawrongfixtemplateistriedearlier.onceaplausible patch is generated the entire repair process will be terminated accordingtothecommonly usedrepairsetup andfinallytheactual fix template has no chance to be selected.
therefore we convert thefixtemplateselectionproblemintoamulti classificationtask which will be described in detail below.
.
.
fix template selection with transferred knowledge.
in section .
.
we have obtained the transferred knowledge by training the multi classifier on large scale dataset pr.
for a target project we can first extract existing bug fix commits from its development history and then use the syntax checker to tag them with the unique labels just like what we have done to build dataset prin section .
.
then the newly extracted samples can be used to further fine tune the model parameters of the multi classifier which is already trainedondataset pr.inthisway wemergethetransferredknowledgelearnedfrom dataset prwiththespecificinformationofthe targetproject.forafaultystatementwithitscontextualmethod thefine tunedmulti classifierisusedtopredictwhichfixtemplates shouldbeselectedfirsttogeneratepatches whichisexpectedto optimize the fix template selection task at step in algorithm .
evaluation inthissection weconducttheextensiveexperimentstoevaluate theourapproachonthefaultlocalizationandprogramrepairtasks.
.
benchmark dataset weusedefects4j v1.
.
benchmark inourexperiments which iswidelyusedfortheevaluationoffaultlocalizationandautomated program repair tasks .
this benchmark is composed of open source projects containing real faults.algorithm the process of template based program repair input the project to be repaired pand its test cases t output the patch candidate cthat can pass all test cases start time get current time c null suspicious list fault localization p t step foreachpos suspicious listdo step foreachft fix templates do donor code list search donor code pos ft step foreachelement donor code listdo candidate generate patch pos ft element step ifvalidate candidate t istrue then c candidate returnc end if current time get current time ifcurrent time start time time threshold then returnc end if end for end for end for returnc .
experimental settings as shown in table columns to list the experimental setups for running the bilstm based binary classifiers in section .
.
model bi themlp basedrankingmodelinsection3.
model rk the bilstm based multi classifier trained on dataset prin section .
.
model mu andthebilstm basedmulti classifierfine tuned on defects4j in section .
still model mu respectively.
it should be noted that all hyper parameters are determined based on thecorresponding validation set through grid search.
for obtaining spectrum based andmutation based features forfault localization task weutilizegzoltar v1.
.
andpit v1.
.
tools.for pit we adopt the same modifications following trapt and deepfl .
whentrainingthemlp basedrankingmodel weadoptpairwise approachbecausethegoaloffaultlocalizationtaskistorankthe faulty statements higher than the correct ones while other relationsarenotconsidered.sincemostofthesuspiciousstatements arenotfaulty thenumberofpositivesamplesisfarlessthanthat of negative samples.
therefore during training we adopt downsamplingandrandomlyselect10negativesamplesforeachpositive sample togenerate samplepairs like spos sneg .
then the hinge function is utilized to calculate the loss of a sample pair.
when trainingthemulti classifiermodel duetotheimbalanceofsamples among different bug types on dataset pr the down sampling approach isalso adopted.wekeep upto samplesfor each authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving fault localization and program repair with deep semantic features and transferred knowledge icse may pittsburgh pa usa table setups for experiments setups model bi model rk model mu model mu dataset dataset fldefects4j dataset prdefects4j batch size epochs loss function ce hinge loss ce ce input dim hidden units optimizer adam adam adam adam learning rate 1e 1e 1e 1e dropout rate .
.
for l2 reg 1e 1e bug type.
finally we use fold cross validation on the fault localization column3 andprogramrepairtasks column5 toobtain the experimental results.
we set the running time of each repair process to hours which is the same as tbar .
all the experiments are conducted on ubuntu .
server with 20coresof2.4ghzcpu 384gbramandnvidiateslav100gpus with gb memory.
.
evaluation metrics we adopt the following common evaluation metrics used in the previous fault localization studies top n which represents the number of faults with at least one faulty statement located in the top n positions.
following previous researches top top and top are reported.
meanfirstrank mfr iftherearemultiplefaultystatements inafault localizingthefirstoneisimportant.themfrmetricof one project is the mean of the highest faulty statement s rank of each fault.
meanaveragerank mar whichiscomputedastheaverage rank of all faulty statements for each fault and the mar metric of one project is the mean of the average rank of all its faults.
amongthem thebiggerisbetterfortop 5whilethesmaller isbetterformfrandmar.fortheprogramrepairtask weusethe numberoffixedfaultstomeasuretheeffectivenessofaprogram repair technique.
.
results and discussion rq1 how does transfer fl perform in statement level fault localization?
to answer this research question we compare the effectiveness of transfer fl with three sbfl techniques i.e.
ochiai tarantula and dstar whose suspicious scores are usedtoformthespectrum basedfeaturegroupinthispaper and onembfltechnique i.e.
metallaxis formutation basedfeaturegroup andtwodeeplearning basedtechniques i.e.
deepfl and deeprl4fl .
note that the experimental results of deepfl are obtained after we make simple modifications i.e.
only semantic based and mutation based features are kept based onits open source repository to meet the needs of statement levelfault localization tasks which is originally designed for methodlevel.fordeeprl4fl thestate of the arttechnique sincetheopen source repository and relevant dataset are not publicly available table fault localization results techniques top 1top 3top mfrmar ochiai .
.
tarantula .
.
dstar .
.
metallaxis .
.
deepfl .
.
deeprl4fl transfer fl .
.
wearenotabletoreproduceitsresults.thus wedirectlycitethe experimental results reported in their paper .
table presents the detailed experimental results.
from the table we can see that transfer fl can perform all comparedtechniques in all metrics.
more specifically compared with the threesbfltechniques theincreasednumbersofthefaultshiton top are and while the improvements on mfr and mar are .
and .
.
when compared with the mbfl technique metallaxis the increased numbers on top are and while the improvements onmfr and mar are .
and .
.
sbfl and mbfl methods only consider the dynamic informationgeneratedbyexecutingtestcases andlacktheanalysesforprogramsemantics.whencomparedwiththetwodeeplearningbased methods the increased numbers on top are and while the improvements on mfr and mar are .
and29.
showingthattransfer flsignificantlyoutperforms thestate of the artdeeplearning basedmethods.sincesemantic features are not used or just simply used by concatenating the word embeddings in the existing deep learning based methods the transferredknowledgelearnedfromourbuiltlarge scaledataset andthedeepsemanticfeaturesgeneratedby11binaryclassifiers can significantly enhance the effectiveness of fault localization.
rq2 howeffectivearethemaincomponentsoftransferfl?
in this rq we explore the effectiveness of main components in transfer fl.
since transfer fl is based on the fusion of3 feature groups we design model variants each of which rep resents a specific combination of features groups.
as shown in table7 thefirst3variantsretainonlyonefeaturegroup andthe following2variantsretainthecombinations spectrum semantic and mutation semantic respectively.
thelast variantretainsall 3featuregroups i.e.
transfer .throughtheexperimentalresults we find that under the restriction of using only one feature group variantmutation performsbestonall5metrics and variantsemantic performsbetterthan varaintspectrumontop whiletheresultsare opposite on other metrics.
next compared with variantspectrum variantmutation variantspec sem variantmut sem achieves significant improvement indicating that the semantic features can beeffectively integrated with existing traditional features to generate richerinformation whichisbeneficialforfaultlocalization.finally the experimental results of variantallon all evaluation metrics 1note that we find that the mfr and mar results reported in deeprl4fl a r e strangelyverylow .32and28.
respectively .aftercheckingthecodeandconsultingtheauthorsofdeeprl4fl wehavetochoosenottocomparethesetwometrics with deeprl4fl.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa xiangxin meng xu wang hongyu zhang hailong sun and xudong liu table7 comparativeanalysiswithdifferentfeaturegroups techniques top 1top 3top mfrmar variantspectrum .
.
variantsemantic .
.
variantmutation .
.
variantspec sem4991120118.
.
variantmut sem7012115293.
.
variant all .
.
table repair results under perfect fault localization project dlfix coconut cure tbartransfer pr chart closure lang math time mockito total arebetterthanthoseofallothervariants provingthateachfeature group has a positive impact on the fault localization task.
rq3 how does transfer pr perform in program repair under perfect fault localization?
inordertoevaluatewhethertransfer priseffectiveornot we conduct experiments under perfect fault localization setup i.e.
theactualfaultystatementsaregiven .wethencomparetherepair resultsofdifferentmethods.asshownintable8 dlfix coconut cure areencoder decoderbaseddeeplearning methods while tbar is the state of the art template based method.transfer prisimplementedbasedontbar becausethe predefined fix templates used in this paper are derived from it.
the experimental results show that transfer pr can fix more bugs 67intotal thantbar whichreflectstheimprovementgainedfrom the optimized fix template selection mechanism.
when compared withdeeplearning basedrepairmethods transfer prcanfix more bugs than the state of the art method cure.
furthermore transfer pr achieves the best results on out projects.
the resultsshowthatusingpredefinedhigh qualityfixtemplatesand optimizing the selection of fix templates can improve the repair performance.
rq4 cantransfer asawhole improvetheperformance of program repair?
in this rq we evaluate the effectiveness of transfer both fl and pr in automated program repair.
as transfer pr is a template basedapproachderivedfromtbar andtbaristhe best performingrepairmethodasshownintable8 weusetbar as the baseline in this rq.
as described in tbar there are 71bugversionsthatcanbefixedwhenthefaultystatementsand the fix templates are both directly given.
however in actual repair scenario these two premises are not satisfied.
thus we preform a set of comparison experiments to explore how transfer fl and transfer primproveprogramrepairinactualrepairscenario both faulty statements and fix templates are unknown .
table shows the repair results in different fl approach pr approach table9 repairexperimentsindifferentlocalizationand repair setups localization repair not fixed bugs1 fixed approaches approaches timepos.pat.bugs ochiaitbar transfer pr transfer fltbar transfer pr 1reasons for not fixed bugs time timeout pos position and pat pattern .
setups.
we find that the number of fixed bugs under ochiai tbar setup which is the default setup in tbar is while the number under ochiai transfer pr setup is showing theeffectiveness of transfer pr method.
in addition the numberoffixedbugsunder transfer fl tbar steupis43 indicating that transfer fl can also help improve the repair performance.
then when both transfer fl and transfer pr are used i.e.
transfer there are bugs can be fixed which achieves the bestresult.the detailedstatisticsofthe fixedbugscorresponding to4setupsareshowninfigure5 a .figure5 b showsthebugs which can be fixed in all setups.
table also shows the number of not fixed bugs and the corresponding reasons.
we divide the reasons why a bug cannot be successfullyfixedintothreecategories timeout thefaultystatements are ranked too low in suspicious list to be found within a limitedtime.
position aplausiblebutincorrectpatchisgenerated in another suspicious statement when the real faulty statement has notbeen reached.
pattern a plausible butincorrect patch is generated due to a wrong fix template being selected.
table also shows that after adopting transfer fl the number of not fixed bugswiththereasonoftimeoutissignificantlyreduced from18 to10 .thisresultshowsthatmanybugsthatpreviouslyfailedto be located within a limited time have now been successfully found.
after adopting transfer there are still not fixed bugs caused by timeout position and pattern .
in our future work wewilladdressthesenot fixedbugsandfurtherimprovetherepair performance.
figure overlapping analysis for program repair exper iment c chart cl closure l lang m math moc mockito t time authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
improving fault localization and program repair with deep semantic features and transferred knowledge icse may pittsburgh pa usa discussion .
why does it work?
for the fault localization task previous spectrum based mutationbased anddeeplearning basedmethodseitherdonotconsiderdeep semanticfeatures orjustusesomesimplefeaturesbyconcatenating thewordembeddings whileourapproachincorporatesthedeep semantic features and transferred knowledge from the large scale open sourcebugdataset.specifically wedesign11binaryclassifiers to extract deep semantic features for predicting the probabilities of containing bugs of different bug types.
for the program repair task selecting the correct fix template forthestatementtoberepairedisimportant becauseifanincorrect fix template is selected a plausible but incorrect patch maybe generated and the whole fix process will be terminated.
ourapproach includes a multi classifier which learns deep semantic features from historical data that contains knowledge about which fixtemplateshouldbeselected.inthisway thenumberofplausiblebutincorrectpatchesdecreasesandtherepairperformanceis improved.
.
threats to validity one threat to external validity is the target programming language weuse i.e.
theselectedfixtemplatesandgenerateddatasetsareall forjavalanguage.however mostofthefixtemplatescanbegeneralized to other languages because of the generic representation of ast.ontheotherhand therearesufficientprojectsinopensource communities e.g.
github to build datasets for other languages.
the second threat to external validity is that we use one defect benchmark defects4j v1.
.
in our study.
although it is a widelyused benchmark durieux et al.
showed that fault localization and program repair techniques may overfit on this benchmark.
to reduce this threat we have conducted a preliminary experiment on a recent benchmark defects4j v2.
.
.
the results given in our project page show similar trend as that on defects4j v1.
.
and confirmtheeffectivenessoftheproposedapproach.inourfuture work we will conduct more comprehensive experiments to further evaluatethegeneralityofourmethodsonmoredefectbenchmarks.
onethreattointernalvalidityistheimplementationofthesyntax analyzer developed by ourselves.
in order to reduce the threat the analyzer is developed based on the widely used jdt framework .
another internal threat is the manual annotation for faulty statements in defects4j because the standards tojudge whether a statementisfaultyornotmaybedifferent.toreducethisthreat we choose the standard given by the authors of defects4j .
conclusion in this paper we propose a fault localization method transferfl thatincorporatesthedeepsemantic basedfeaturesextractedby learningthetransferredknowledgefromlarge scaleopen source data.wealsoproposeaprogramrepairmethod transfer pr foroptimizingtheselectionoffixtemplates whichcanbeusedtogether withthefault localizationmethodtoimprove theperformanceof existingtemplate basedprogramrepairtechniques.ourapproach transfer the combination of fl and pr can fix bugs on defects4j dataset which is more than that of the state of the art template based repair technique tbar .our source code and experimental data are publicly available at .
the code and data can facilitate replication of our study.
furthermore the large scale datasetsdataset flanddataset prbuilt by us can be utilized in future automatic software debugging research.