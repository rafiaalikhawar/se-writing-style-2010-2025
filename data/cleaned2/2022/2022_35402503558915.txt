sflkit a workbench forstatistical faultlocalization marius smytzek cispa helmholtz center forinformationsecurity saarbr cken germany saarlanduniversity saarbr cken germany marius.smytzek cispa.deandreas zeller cispa helmholtz center forinformationsecurity saarbr cken germany zeller cispa.de abstract statisticalfaultlocalizationaimsatdetectingexecutionfeaturesthat correlate with failures such as whether individual lines are part of the execution.
we introduce sflkit an out of the box workbench forstatisticalfaultlocalization.theframeworkprovidesstraightforwardaccesstothefundamentalconceptsofstatisticalfaultlocalization.itsupports fivepredicatetypes four coverage inspired spectra likelines and44similaritycoefficients e.g.
tarantula orochiai for statisticalprogram analysis.
sflkitseparatestheexecutionoftestsfromtheanalysisoftheresultsandisthereforeindependentoftheusedtestingframework.it leverages program instrumentation to enable the logging of events and derives the predicates and spectra from these logs.
this instrumentationallowsforintroducingmultipleprogramminglanguages andtheextensionofnewconceptsinstatisticalfaultlocalization.
currently sflkitsupportstheinstrumentationofpythonprograms.
sflkitis highly configurable requiringonly the loggingof the requiredevents.
ccs concepts softwareanditsengineering softwaretestinganddebugging softwarelibraries and repositories .
keywords statistical fault localization statistical debugging spectrum based faultlocalization similaritycoefficient acmreference format marius smytzek and andreas zeller.
.
sflkit a workbench for statistical fault localization.
in proceedings of the 30th acm joint european software engineering conference and symposium on the foundations of softwareengineering esec fse november14 18 singapore singapore.
acm newyork ny usa 5pages.
introduction the basic concept of statistical fault localization is easy to explain.
supposeaparticularlineintheprogramisexecutedprimarilyon failing runs.
in that case its execution correlates with a failure and permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthefirstpage.copyrights forcomponentsofthisworkownedbyothersthanthe author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
esec fse november 14 18 singapore singapore copyright heldby the owner author s .
publicationrightslicensed to acm.
acm isbn ... .
x3 y3 1defmiddle x y z z 2ify z ifx y returny elifx z returny 7else ifx y returny elifx z returnx 12returnz figure statistical fault localization .
themiddle functiontakesthreevaluesandreturnstheonethatisneitherthe minimumnorthemaximum line6moststronglycorrelates with failure.
givesessential hintsonthefailure causes notablyapossible location.
theseminal tarantula paper uses amiddle function to illustrate the concept shown in figure .middle x y z is supposed to return the middle of the three values x y z the value that is neither the minimum nor the maximum of the three middle for instance correctlyreturns .
however the middle code in figure 1is faulty as middle returns rather than .
by feeding middle various values and observing the executed lines we can determine that the execution of line has the strongest correlation with failure.
line also happens tobe the fault location itshouldreturn xrather than y. whatworkswellinasmallexampledoesnotnecessarilyscaleto largesystems.onalargescale statisticalfaultlocalizationcansuffer from reporting a multitude of potentially suspicious lines .
variousstatisticalapproacheshavebeensuggestedoverthepast two decades each improving over the previous benchmark results tomakefaultlocalizationmoreprecise .however eachofthese approachesintroducestheiruniqueinfrastructurethatwithcustom debuggingloggers custompredicates and customspectra .
yet for research we d like to be able to selectandcombinethese elements inamodular reusablefashion.
this paper introduces sflkit a modular statistical fault localization framework that provides easy to use essential concepts of statistical debugging and spectrum based fault localization.
sflkit esec fse november14 18 singapore singapore marius smytzek andandreas zeller ishighlyconfigurableandeffortlesstoextendwithnewapproaches makingitagreatbasefor future researchandeducation.
background .
spectrum basedfaultlocalization spectrum based fault localization sbfl is a technique to localize the code location of a fault founded on so called program spectra whichdescribeaprogram sexecution.typicallysuchan approachconsidersafaultyprogramandatestsetcomprisingat least one failing test.
this approach then collects coverage information for each test case as the spectrum and correlates each code element described by the coverage with the failure by calculating a suspiciousness score.
this score ranks how likely a specific code location is faulty.
the general idea behind sbflis that elements oftenexecutedinfailingtestcasesandnotsoofteninpassingones are more likely to be faulty.
in recent years this technique became more popular as part of automated program repair and was the subjectofsomestudiesinthis context .
in practice sbfltechniques consider executed lines and use a similarity coefficient to compute the suspiciousness.
different approaches vary only in the choice of this similarity coefficient.
thisresearchtrendresultsinanuncountablenumberofpossible coefficients .tarantula wasoneofthefirstmetrics introducedto sbflandisstillapopular choice.
sflkit implements four spectra and similarity coefficients that ausercan leverage see table .
.
statistical debugging in contrast to sbfl statistical debugging sd leverages predicates onthecodethat canbe true false or notexecuted.
dependingon theresultofthesepredicates sdallowsforderivingpropertiesthat needtoholdforproducingthefault.while sbflreliesonsimilarity coefficients to measure the suspiciousness of an element sdrelies onthe standardizedmetrics failure context andincrease .
failureistheprobabilityafailureoccursundertheconditionthat apredicate evaluates to true.
context istheprobabilitythatafailureoccurswhenthepredicate isobserved.
increase describeshowmuchthepredicatebeing trueincreases the probability of a failure occurring.
the increaseof a predicatepiscalculatedas increase p failure p context p the most common example of sdis to leverage the condition of branches whichwasintroducedbyliblit etal.
.
sflkitsupportsfivetypesofpredicatesthatcovervariousprogram properties allowing for tracking different program behaviors that could leadto afault see table .
design and implementation we designedour frameworksuch thatwe canseparate itinto two stages.thefirstisthecollectingofexecutionfeatures.thisstage representsa debugging logger where we collect eventsduring the program s execution to capture its behavior.
it is entirely independent of statistical fault localization and allows for using ourtarget.pypython visitor meta visitor line event factorybranch event factorymodificationsout.py figure a description of the meta level instrumentation used inour statistical faultlocalizationframework.
framework as a debugging logger.
we describe this phase in section3.
.thesecondstageisanalyzingthecollectedfeatureswith conceptsofstatisticalfaultlocalization.weexplainthisphasein section3.
.
.
collecting execution features the base of our statistical fault localization framework is an instrumentation of the source code that enables the logging of specified events.
this concept leverages the abstract syntax tree ast of the source code and an interface enabling the visiting of a node of the aston a meta level.
each event we use comes with a factory to produceit.thefactoryrepresentsthevisitoronthemeta leveland onlyproducestheinstrumentationforthesingleeventitrepresents.
for example we implemented a line event that gets triggered every time a line or a statement in other programming languages occurs.theoverallvisitor inthiscaseforpython callseverymetavisitorforeachnode.theeventfactoryknowstheinjectionsand modificationsofthecodeforeachnode.withthisdesign wecanextend our framework with new programming languages and events whilethe eventsare independent.
our framework accomplishes the instrumentation in three steps ontheast.
parse the source code to an abstract syntax tree ast .
visit eachnodeofthe ast.weleveragethe astmodulecoming withpythonfor our pythonsupport.
callthecorrespondingmeta levelvisitorontheastnode that knowsthe statements itneedsto inject.
combine all injections and changes to modify the source code.
the implementation of our instrumentation allows the extension with other programming languages without modifying the core functionalities by implementing the event factories for anew programminglanguageandanastvisitorvisitingallnodesand combining the results ofthesefactories.
figure2provides an overview of the instrumentation process in our statisticalfaultlocalizationframework.
ourcurrentimplementationsupportssolely pythonprogramsbecause we did our experiments and evaluation in this programming language.
1702sflkit a workbenchforstatisticalfaultlocalization esec fse november14 18 singapore singapore table the implemented concepts of statistical fault localization.
the first column describes the type of the concept the second thenumberofimplemented conceptsofthistype andthelastcolumn lists theconcepts.
type number concepts events lineevent branchevent defevent useevent functionenterevent functionexitevent functionerrorevent loopbeginevent loophitevent loopendevent conditionevent spectra lines functions defuse pairs loops similaritycoefficients ample ample2 anderberg arithmeticmean binary cbiinc cohen crosstab dice dstar euclid fleiss gp02 gp03 gp13 gp19 goodman hamann hammingetc harmonicmean jaccard kulczynski1 kulczynski2 m1 m2 naish1 naish2 ochiai ochiai2 pairscoring qe rogersandtanimoto rogot1 rogot2 russelandrao scott simplematching sokal sorensendice tarantula wong1 wong2 wong3 zoltar predicates branch scalar pairs variablepredicates returnpredicates condition thecoreofourstatisticalfaultlocalizationframeworkareevents collected during the execution of the program under test.
in detail aunittestissuitableforextractingtheexecutioneventswithour framework.theseeventsinjecttheirrequiredstatementsintothe target program as part ofthe instrumentation.
ourinstrumentationcancollecttheexecutioneventsduringa testrunandputthemasideforlateranalysis.thecriticalcomponent here is a shared library that is part of the instrumentation.
whentheprogramlogsanevent ittellsthesharedlibrarytowrite thedeterminedeventintothelog.theanalysiscanthenreadthe log and construct the needed data from this log.
this separation allowsfor using our framework as an executioneventlogger.
table1providesan overviewofthe implementedevents.
.
analyzingexecution features toanalyzetheexecutionfeatures weleveragetheloggedevents to rebuild amodelthat we can modify whilereplaying the events.
this model is a practical way of keeping track of the program s behaviorduringtheexecutionandenablesourframeworktoderive the spectraandpredicates usedfor future analysis.
foreachrun forwhichalogexists sflkitbuildsamodeland checkswhatspectraandpredicatesareobservedand inaddition howtheyevaluate i.e.
forpredicatesto trueorfalse.itleverages theseobservationstocalculateavarietyofsuspiciousnessscoresdefinedbytheuser.thesuspiciousnessscoresprovideanoverviewof howlikelyananalysisobjectcorrelateswiththefaulttoinvestigate.
weimplementedmanypreviouslyintroducedanalysisobjects likelines branches ordef usepairs.asanovelaspect weintroduce a new predicate we are not aware already exists to the best of our knowledge.
we based this novel analysis subject on existing coveragecriteria.
conditions we introducecondition predicatesderivedfrom condition coverage.
for this predicate we log sub condition events thatoccurwheneverasub conditionoccurs e.g.
all terms of the test of an if statement.
the predicate checks whetherasub conditionbeingtrue orfalse correlateswith the program s failure.
after extracting all analysis objects we evaluatethem with the defined similarity coefficients or in the case of predicates with the increasemetric as explainedinsection .
.
table1provides an overview of the supported program spectra predicates andsimilaritycoefficients.event logsmodelspectra predicatessimilarity coefficients figure an overview of the analysis stage of our statistical faultlocalizationframework.
tool usage we provide our workbench as a python package that is installable by running pip install .
inside the root directory of the framework.afterinstallingthepackage thevariousconceptsare accessible by importing sflkitin a python script.
the easy touse access points to sflkit are sflkit.instrument config and sflkit.analyze config thattakethepathtoaconfigfileandexecute the instrumentation and the analysis of the execution events.
consider the example in figure .
figure4shows an example of a config file for this scenario.
sflkit.instrument config leveragesthepredicatestoinvestigate extracttheneededevents and then instruments thetarget path asdescribed insection .1to the instrumentationpath.
sflkit.analyze config parsestheevents frompassingandfailingparameters buildsamodelforeachrun andthenanalysistheexecutedlinesandcomputestheinmetrics provided ochiai jaccard andtarantula onthese lines.
all these steps allow for an individual execution and can be interferedwithat any time to leverageintermediate results.
in addition our tool provides a command line interface that leveragestheseconfigurationfiles.toexecutethecommand line interface a user needs to run python sfl.py instrument c configandpython sfl.py analyze c config whereconfig isthe pathto the config file.
experimentalevaluation weinvestigatedbugsfromthebugsinpy benchmarktotest sflkit under authentic conditions.
this collection of real world faultypythonprogramscomprises501subjectswithpassingand failingteststhat wecanleverage.in addition thebenchmarkprovidesapatchfileforeachbugthatwecanusetoextractthecode locations that contributeto the fau 1703esec fse november14 18 singapore singapore marius smytzek andandreas zeller 2path middle.py 3language python 6predicates line 7metrics ochiai tarantula jaccard 8passing events passing 9failing events failing 12path tmp.py figure anexample ofaconfigfile forsflkit bugsinpy provides the test file for each bug that contains the tests that trigger it.
we used only the test cases in the provided file because these are more likely to relate to the fault.
in addition using only these tests instead of all provided test files significantly speedsupour evaluation.
we selected three bugs for each project included in bugsinpy to investigate ifpossible.severalprogramshavenofailingtests.even theteststhatshouldtriggerthebugdidnotfail soweskippedthem forourselection.moreover someapplicationshavenopassingtests which we excluded too because there would be no logical explanation for a particular code location to be faulty.
in addition we didnotinvestigatematplotlib matplotlibandpandas dev pandas because both come with a tremendous number of test cases that take too long to run in our cross validation setup for which we neededtoexecuteeachsubjectmultipletimes.moreover weneeded toexcludeexplosion spacy sincetherewerenosuitablesubjects as specified by our criteria.
however we want to investigate the subjects we skipped in further evaluating our statistical fault localizationframework.
besides this subject selection we could not leverage each provided test in our evaluation.
we excluded such test cases that changed theoutcome because ofour instrumentation.we noticed two reasons for this.
the first is that some ofthe tests verified the integrityofthesourcecode i.e.
itwasnotaltered whichwedid.
the other reason is that a few tests ran into performance issues wheninstrumented.theseperformanceissuesaresomethingwe want to investigate further.
table2providesan overviewofallthe bugsandtests we leveraged to test our framework.
we investigated subjects from of bugsinpy s projects with a combined number of test cases.
moreover the chosen subjects demonstrate the scalability of sflkit withsubjectscomprisingupto 801linesofcode.
we investigatedlines asananalysistargetfor thesereal world experimentations.
we calculated the precision recall precision k andrecall konthesuggestionstheanalysisreturnsconcerningthe actual faulty lines.
we leveraged the ochiai thejaccard andthe tarantula similaritycoefficientsfortheexperimental evaluation.
table 3demonstratesthe results ofthis evaluation.
sflkitproducedmeaningfulresultsfortheinvestigatedsubjects with an average precision of .
and a recall of .
aligning withsimilar experiments e.g.
jiangetal.
.table the subjects of bugsinpy we investigated.
bugs bugs tests linesdonatetothenumberofbugspersubject thebugsweinvestigated thenumberoftestsweleveraged and the average lines of code analyzed per bug respectively.
project bugs bugs tests lines cool rr pysnooper ansible ansible psf black cookiecutter cookiecutter tiangolo fastapi jakubroztocil httpie keras team keras spotify luigi huge success sanic scrapy scrapy nvbn thefuck tornadoweb tornado tqdm tqdm ytdl org youtube dl total table the results of the experimental evaluation.
p k donatestoprecision kandr ktorecall k respectively.
p andr are equivalent to precision and recall.
coefficient k k k k p r p r p r p r ochiai .
.
.
.
.
.
.
.
jaccard .
.
.
.
.
.
.
.
tarantula .
.
.
.
.
.
.
.
average .
.
.
.
.
.
.
.
conclusion in this paper we presented sflkit a statistical fault localization framework that is accessible and out of the box usable for realworld applications.
the framework provides all common key components of statistical debugging and spectrum based fault localization.
sflkit leverages extendable program instrumentation to log executionfeaturesasoccurringeventsandderivesamodelfrom these features.
leveraging this model our framework provides variousanalysesforstatisticallycorrelatingtheseexecutionfeatures withfailures.
sflkit opens the door for uniform and comparable future research in the area of statistical fault localization.
our framework is available as open sourceat data availability thedatarequiredtoreproducetheabovefindingsareopenlyavailableat reference number .
1704sflkit a workbenchforstatisticalfaultlocalization esec fse november14 18 singapore singapore