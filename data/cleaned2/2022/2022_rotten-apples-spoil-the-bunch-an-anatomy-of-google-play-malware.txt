rotten apples spoil the bunch an anatomy of google play malware michael cao univ.
of british columbia canada michaelcao ece.ubc.cakhaled ahmed univ.
of british columbia canada khaledea ece.ubc.cajulia rubin univ.
of british columbia canada mjulia ece.ubc.ca abstract this paper provides an in depth analysis of android malware that bypassedthestrictestdefensesofthegoogleplayapplicationstore and penetratedthe official android marketbetween january and july .
we systematically identified such malicious applications grouped them into families and manually analyzedoneapplicationfrom105distinctfamilies.duringourmanual analysis we identified malicious payloads the applications execute conditionsguardingexecutionofthepayloads hidingtechniques applications employ to evade detection by the user and other implementation level properties relevant for automated malwaredetection.asmostapplicationsinourdatasetcontainmultiple payloads eachtriggeredviaitsowncomplexactivationlogic we alsocontributeagraph basedrepresentationshowingactivation pathsforallapplicationpayloadsinformofacontrol anddata flowgraph.furthermore wediscussthecapabilitiesofexistingmalware detectiontools putthemincontextofthepropertiesobservedin the analyzed malware and identify gaps and future research directions.webelievethatourdetailedanalysisoftherecent evasive malware will be of interest to researchers and practitioners and will help further improve malware detection tools.
ccs concepts softwareanditsengineering softwaretestinganddebugging security and privacy software reverse engineering software security engineering.
keywords android malware dataset malware detection manual analysis acm reference format michaelcao khaledahmed andjuliarubin.
.rottenapplesspoilthe bunch an anatomy of google play malware.
in 44th international conferenceonsoftwareengineering icse may21 pittsburgh pa usa.
acm newyork ny usa 13pages.
introduction the popularity of mobile phones has increased rapidly in the past decade.togetherwiththeincreasedpopularity theirwideadoption equal contribution permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe firstpage.copyrights forcomponentsof thisworkowned byothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa copyright held by the owner author s .
publication rights licensed to acm.
acm isbn ... .
thecharacteristicsofsuchmalwareisanimportantsteptowards building effective malware detection tools.
while a number of android malware datasets were collected in recentyears e.g.
onlyafewauthors performedadetailedmanualanalysistoidentifyanddescribethe mechanisms employed by malicious applications a.k.a.
apps .
the mostprominentoftheseworksarethemalwaregenome and amd projects.
in the former the authors collected and manuallyanalyzed1 260androidmalwareappsfromofficialandalternative markets focusing on identifying payloads installation mechanisms and activation conditions for malicious behavior.
later the authors of amd performed a similar manual analysis on apps from distinct malware families.
these two annotated datasets collectively coverthetimeperiodbetween2010and2016.yet to thebestofourknowledge nosuchdetailedanalysiswasconducted since then for newer malware apps.
to address this gap we collect and manually analyze a set of difficult to detect malware apps that penetrated the official android google play store between january2016 and july .the googleplaystorearguablyhasthemostadvanceddefensesforan droidapps consideringthelowamountofmalwarethatitcontains compared with alternative markets .
we thus believe that analyzing the mechanisms which allowed this malware to avoid detectionbythestoreisavaluabledirectionwhichwillhelpfurther improve both academic and industrial malware detection tools.
tocollectmalwareapps wesystematicallyanalyzedthreatreports of the most prominent mobile security companies accordingtogartner identifyingreportsthatdescribemalwarewhich penetratedthegoogleplayappstoreduringourtargetdates.we identified1 238apps groupedtheminto134families andanalyzedoneappperfamilyfrom105distinctfamilies wecouldnotanalyze appsfromtheremainingfamiliesduetoobfuscation encryption etc.
we refer to the collected dataset as google play gp malware.
our malware analysis focused on collecting detailed information aboutmalware implementationstrategies andmechanisms it uses to avoid detection.
in addition as malware often has multiple payloads eachtriggeredunder potentiallymultiple complexactivation conditions e.g.
that rely on combination of sensor data andrandomevents wedefineda flow basedmalwaresignature a graph based representation showing activation paths and payloads for an app in a form of a control and data flow graph.
we thenmanuallygeneratedflow basedsignaturesfortheanalyzedapps.
we believe such signatures are useful to gain a proper understanding of malicious behaviors which is required for building effective detectiontools e.g.
thosebasedondynamicanalysis or static execution path exploration .
topresentourfindings weorganizemalwareanalysisresults around two main research questions ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa michael cao khaled ahmed and julia rubin rq1 malware characteristics what are the characteristics of the gp malware and how does it compare with prior findings?
rq2 malwareflowbehaviors howcomplexarethecontroland data flow behaviors implemented by the gp malware?
we then discuss our malware analysis results w.r.t.
the capabilities of existing malware detection tools and identify possible gaps and future research directions.
ouranalysisidentifiesnewpayloadsnotdiscussedinpriorwork such asclipboard hijacking and cryptomining.interestingly some ofthesepayloadsdonotrelyonanyplatform specificapis typically used as an anchor by many malware detection approaches.
forexample cryptominingcanbeperformedbyusingsimplemathematical operations only.
we also identify new malware activation conditions e.g.
checkingfordevicetemperature todecidewhenit isappropriatetominecryptocurrency andsophisticatedcombinations of multiple events and conditions required for a payload to execute e.g.
sensitive information is retrieved when a phone callisreceived storedinafile andthenreleasedonacompletely different event e.g.
when another app is installed.
triggering asubset of these events or even all events but in a different order willpreventdynamicanalysistoolsfromdetectingthemalicious behavior.
finally our analysis shows that some payloads spawn bytecode javascript andnativecode e.g.
obtaindatainawebview while leaking it via an android java api.
existing tools need to be augmented to track such cross technology patterns.
contributions.
our work identifies characteristics and precise flow based signatures of contemporary malware.
it can be usedto inform software engineering and security communities who develop efficient malware detection tools and also as a benchmarkfor evaluating such tools.
more specifically this paper contributes .
a systematically collected set of android malware apps from distinct malware families which bypassed googleplaydefenses between january and july .
to the best of our knowledge this is the first confirmed dataset of such malware.
.detailedreportsfromthemanualanalysisofonesamplefrom each of the distinct families as well as aggregated findings and a comparison of malware characteristics with those from earlier years to identify new and obsolete practices section .
.
flow based signatures for each analyzed malware sample whichinclude per flowconditionsthat guard eachpayloadand the location language of each flow element section .
.acategorizationandanalysisofexistingmalwaredetection toolcapabilities andadiscussionongapsandfutureresearchdirections in context of our collected malware dataset section .
data availability.
we responsibly share the collected dataset and our analysis results in an online appendix the latest citable release can also be found online .
methodology in this section we describe our methods for building the dataset and analyzing the malicious samples.
.
building the dataset typically malwareappsarecollectedbyeitherbrowsingblogsof securitycompanies or byscreeningapps foundinpublic repositories .
such screening relies on antivirus scanners e.g.
security blog posts post categories google play malware alternative markets malware non android malware technology news promotions 138posts w. malware indicators total identified families total 184identified apps families total manually analyzed samples total 105google play malware posts total av figure malware collection process from the virustotal online service which offers more than 70differentscanners.
inourwork we chosetheformerapproach because blogs of security companies already provide useful albeit partial informationaboutmalwarecharacteristics whichcanassist our manual analysis and help ensure the results are accurate.
westartedfromalistof21securitycompaniesreportedongartner s magic quadrant for best endpoint security platforms identifying for each company blog sites related to cyber threatintelligence we found such sites for companies.
for each site weextractedblogpostsdescribingandroidgoogleplaymalware using the following search terms android google playstore play store and malware malicious malice .we limit our search to the time period between january and july as we are interested in augmenting the body of knowledge collected in prior studies which looked at earlier periods.
to make our search approach repeatable and reproducible we implemented anautomatedwebcrawler whichisavailableonline togetherwith the full list of companies and their blogs sites .
runningourcrawlerinjuly2021resultedin6 377blogposts out of which we discarded where the main part of the text was not writteninenglish.twoauthorsofthepaperthenindependently read the remaining posts and classified each post based onits content.
we arrived at four categories of posts google playmalware alternative markets malware non android malware andtechnology news promotions.thecategorizationlistswere cross validated and all disagreements on posts .
wereresolved through a discussion with all authors of this paper.
the number of blog posts for each category is shown in our schematic representation of the data collection process in figure .
we further focused only on posts from the first category posts describing malware from the google play store.
the distri bution of google play malware blog posts per year is describedin figure .
for each post we looked for indicators of apps describedinthepost filehash sha sha md5 whichis auniqueidentifierofanapp apppackagename whichisthename identifier of an application and author and app name whichistheinformationpresentedtotheusers.wediscarded97 posts containing none of these indicators.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rotten apples spoil the bunch an anatomy of google play malware icse may pittsburgh pa usa analyzing the remaining posts we observed that a post can describe apps from one or more malware families e.g.
an eset post describesthreefamilies appsthatminecryptocurrency afterapresetperiodoftime appsthatphishforcryptocurrencycredentials andappsthatfakecryptocurrencyminingfunctionalityto aggressively push ads onto the user.
it is also possible that families described by two different posts refer to malware from the same family i.e.
bypostsreferencingeachotherdirectlyordescribing indicators pointing to the same apps.
we identified malware familiesintotal outofwhich51wereduplicates resultingin184 uniquefamilies.blogpostsprovidedthenamesforfamiliesinama jorityofcases .fortheremainingcases weusedavclass andassignednamesbasedonavclasslabels.thedistributionofposts with malware indicators and malware families per year is given in figure .
next we collected apps for each of the identified families by scanning the virustotal academic virus share and contagio malware repositories android alternative markets such asapkmonk andapkpure andandrozoo apopular repository with over .
million android apps from various markets.
our assumption was that these repositories may still contain the app even though it was already removed from the official store.
we prioritized apps found directly by the file hash.
if we couldnotfindsuchapps wesearchedusingtheapppackagename app name and author names and prioritized apps having a file hash identical to the one reported by the blog post.
for cases when thepostdidnotprovidethehash weuploadedtheidentifiedapp to virustotal and ensured the app was flagged as malicious by the same antivirus company that published the blog post and in the same family as reported in the post.
if we could not verify the app we marked it as not found.
attheendofthisprocess wecollectedatotalof1294identifiable appsfrom180blogposts.wefurtherexcludeappsmarkedbyfewerthan5antivirustools toensureourcollecteddatasetisreliable .
this eliminated apps resulting in a dataset of from 134uniquefamilies.thedistributionofretrievedappsperyearis also given in figure .
.
analyzing malware samples we first selected malware families and one sample app per family at random two authors of this paper manually analyzed the selected samples to arrive at a common reliable and reproducible analysismethodology.theanalysisreportswerediscussedandaugmentedbyallauthorsofthepaperinanumberofjointmeetings.
the remaining families were analyzed by the two authors individually while regularly validating each other s findings.
the summary reports were discussed with all the authors and augmented when needed.
similar to wei et al.
we used both focused and exploratory analysis of sample apps.
in focused analysis we read the blog post toobtainahigh leveldescriptionofthemalwareinplainhuman language noticing all malicious behaviors described in the post.
we then decompiled the app using jadx to collect decoded resources javasource code and nativebinaries and attemptedto map the described behavior to android implementation mechanisms.
for example if the post stated that the malware subscribesto premium numbers we looked for android api calls to android.telephony.smsmanager sendtextmessage .oncewelocated the api in the app we performed manual backwards reachabil ity analysis to identify paths leading to the payload we further analyzed all components found along the execution path.
we complemented focused analysis with an exploratory analysistounderstandtheoverallworkflowoftheapplicationandto find additional unexpected behaviors.
we observed that malicious payloadsareoftentriggeredinresponsetosystemevents e.g.
boot completed or phone unlocked likely because malware developers attempt to avoid detection by moving the payload execution away from the app main execution path while still ensuring the payload istriggered.wethusthoroughlyexploredcodetriggeredbysystem and user events in addition to the app main launch activity.
some malware apps utilize native code web assets and or bytecodeexecutablesfoundinapplicationresources.wetreatedthese files as an extension of the application code analyzing them to gether with the main code of the app.
we used ida disassembler toreverseengineernativebinariesandconvertmachine codeto human readableassembly code.we usedintellij ide which supports multiple programming languages to perform additional analysis tasks such as class hierarchy analysis.
dealingwithanti analysistechniques.
surprisingly onlyless than half of the malware in our dataset used renaming as an obfuscation technique i.e.
producing package method and variable names like a.aanda.b .
while apis of the android framework methods suchasregisteringforaneventoropeninganhttpconnection cannotbeobfuscated obfuscationofapplication specific code complicates analysis.
we used jadx s built in deobfuscation functionality to map obfuscated names to more readable unique identifiers which simplified the analysis of the code.
some of the malware apps used off the shelf and custom mechanismstoencodeandlaterdecodestringscomprisingreflectivecalls and network addresses.
we followed the logic implemented in the source code of the apps and re implemented the routine to decrypt thedataoutsideoftheapplication.inafewcases wherewecould notfullyunderstandtheparticularroutine weinstrumentedthe application to print out the decrypted strings.
inaddition severalappsusedandroidpackers whichencrypt dex files using elf binaries and decrypt them at runtime to increase the difficulty of reverse engineering the application .
in cases where malware apps used commercial packers e.g.
ji agu and bangcle we were able to decrypt dex files of these apps using android unpacker and drizzledumper .
furthermore some apps used encryption decryption mechanisms toobfuscate strings asset files andcode filesloaded fromlocal storage.
in the majority of the cases we could identify the decryption key which was simply stored in the apk file.
dependence on external code data.
several apps hide malicious functionalityincodedownloadedfromexternalsources e.g.
the developer sbackendservers.oncethemalwareisdiscovered internetserviceprovidersshutdownitsbackendserverpermanently.
as we could not access these servers and analyze the malicious behavior of the downloaded code we borrowed the descriptionof its payloads from the corresponding blog post.
we explicitly marked with star empty suchpayloads todifferentiatethemfromthosewe authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa michael cao khaled ahmed and julia rubin system user schedulingevent conditions ec device environment applicationcheck conditions cc hiding techniques h payloads p code properties cp location languagemalware characterizationexternal server figure malware characterization schema haveobservedindependently.for16apps thedescriptionofallapp payloads relied on the blog posts in additional cases part of the payloads wasobserved independentlyand partwas inferred from posts.foranother16cases noadequatedescriptionofapayload was given in the post and we marked it as unknown.
analysis report.
overall we were able to successfully analyze atleastoneappfrom105distinctmalwarefamilies.weexcluded fourfamilieswherewecouldnotidentifythemaliciousbehavior described in the blog post nine families whose apps used a commercialpackerwecouldnotunpack ninefamilieswhoseappswere heavily obfuscated and we could not reliably analyze five families whoseappsreliedonreflectivecallswecouldnottrack andtwo familieswhoseappscontainedstrings thatwereencryptedwitha customencryptionkeythatwasdynamicallydownloadedfromtheappbackendserverandwasnolongerfunctionalatthetimeofouranalysis.
the detailed breakdown of the apps we analyzed per year is given in figure .
attheendoftheanalysis weproducedadetailedreportforeach app describing a appmeta information includingthefilehash blog url and a brief description of the malware s behavior b therelevantsourcecoderelatedtotheexecutionpath s required to activate the payload s c a tabular form characterization ofthe malware app as described in section and d a flow based signatureoftheapp asdescribedinsection4.
malware characterization we augment and refine malware categorization schemas used in previouswork proposingthecategorizationinfigure2.
in what follows we first describe our schema using the example in figure3forillustrationpurposes.wethenusethecategorization to discuss the malware in our dataset.
.
malware characterization schema figure shows a simplified version of a malware app from the spybankerhufamily .inanutshell thismalwareintercepts smsmessagesandstealstheuser sbankingcredentials.itisactivatedwhentheuserunlocksthephoneorreceivesansmsmessage.
both events are handled by the onreceive ... method of the unlocksmsrecver component lines in figure .
using the intent parameter the method checks whether an sms was received lines .
if so the method checks if the field stealsms the name that wegavetothisvariableforillustrationpurposes issetto true to determine whether the sms stealing functionality is activated line1class unlocksmsrecver extends broadcastreceiver 2static boolean stealsms false 3void onreceive context ctx intent in 4if in.getaction .contains sms received 5if stealsms 6contentresolver cr ctx.getcontentresolver 7smsmessage sms smsmessage.createfrompdu in.getextra .get pdus 9cursor c cr.query uri.parse content sms new string id body while c.movetonext int id c.getint string body c.getstring if body.equals sms.getmessagebody cr.delete uri.parse content sms id string device context.getdeviceid connection con new url leaksms.com ?u device .open con.write sms 23string device context.getdeviceid 24connection con new url commands.com ?u device .open 25string commands con.read 26if commands.contains steal sms stealsms true 29string running getrunningprocesses 30if running.contains com.garanti.cepbank webview.loadurl fakebank.com figure spybankerhu malware .themethodthenretrievesallsmsmessagesonthedevice lines6 anditeratesoverthemtoidentifyanddeletethereceivedsms lines .
it further leaks the sms content to the developer s server together with the device id lines .
this is most likely done to steal the one time access passcode the bank might send to the userand to hidefrom the usermessages which couldindicate thatsomeoneelse i.e.
themaliciousparty ismanipulatingtheir bank account.
inanyevent whetheransmsisreceivedortheuserunlocks theirphone theappalsoattemptstocommunicatewiththecommand and control server and to steal banking credentials lines23 .
specifically the app retrieves the device id line and contacts its server to retrieve a set of commands lines .
if it receivesthe steal sms command theappsetsthefield stealsms totrue lines indicating that the user is going to be attacked andenablingthesmsleakingbehaviordescribedabove.theapp further checks if a process associated with the cepbank banking application is running lines and if so loads an html page that impersonates the login screen of the banking app line .
an unsuspecting user will enter their banking login credentials on the fake overlay which sends the credentials to the malicious server.
insummary theappcontainsthreedifferentpayloads itleaks the device id when an sms is received or the phone is unlocked lines18 20and23 itleaksthecontentanddeletessmsmessages when instructed by the server lines and it steals banking credential when the cepbank application is running lines .
each of the payloads is triggered under different conditions authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rotten apples spoil the bunch an anatomy of google play malware icse may pittsburgh pa usa andactivation events partof whichwe omittedforthe simplicity of the presentation.
we also omitted yet another payload ad abuse as well as additional events that the app intercepts to trigger the malicious behaviors e.g.
power change.
toaccuratelydescribethebehaviorofsuchmalware weusefive categories specified in figure .eventconditions ec areeventsthatanappinterceptsandthat triggertheactivationofamaliciouspath.wefurtherdividethem intosystemevents whicharetriggeredbytheandroidsystemwhen thedeviceisbooted ansmsisreceived etc.
userevents whichare triggered by the app user when logging in into the app pressing a particular button copying text etc.
and scheduling events which are triggered at specific time intervals.
our spybankerhu sample in figure intercepts sms and phone unlocking system events.
.checkconditions cc areconditionsthatneedtobesatisfied for the malicious behavior to fire.
these conditions can depend on anexternalserver e.g.
whenthemaliciouspayloadisexecutedonly when a particular command is received from the app backend like in the spybankerhu sample in figure .
further check conditions canbedevice dependent i.e.
relyonacertainhardwareorsoftware specification environment dependent e.g.
beexecutedatacertain time or location and application dependent e.g.
rely on a certain permission granted to the application or on a certain data format.
.hidingtechniques h areusedbytheapptohideitsmalicious actions from the user.
these include removing the app icon so the usercannotidentifyanduninstalltheapp andblockinginformation such as deleting sms messages in the spybankerhu sample.
.payloads p describethemainmaliciousfunctionalityoftheapp itself.
we identified a variety of payloads including stealing of personal device and banking information like in the spybankerhu sample in figure .
.code properties cp are the code level details describing how these behaviors are implemented.
we consider the locationof the code e.g.
being in the application directly hidden in resources or downloadedfromaremoteserverandthe language inwhichthe maliciouscodeisimplemented e.g.
bytecode nativecode orawebbased language html javascript .
for the spybankerhu app in figure the unlocksmsrecver class is implemented directly in bytecode whilethefakeloginoverlayisimplementedinjavascript and is loaded from a remote server.
next we outline for each of the categories the implementation strategiesthatmalwareinourdatasetemploys.section4furtherdescribes our malware signature which accurately relates the events conditions hidingtechniques andpayloadstoeachother inaform of a control and data flow graph.
.
malware characteristics figure shows the specific behaviors we observed for each of the categories in our schema.
we mark with an arrow arrow right categories thatwereintroducedbasedoninformationobservedinourdataset comparedwithpriorwork .wealsoprovidethenumberof analyzed sample apps exhibiting each of the behaviors.
as one app can contain multiple or no event and check conditions payloads etc.
itcanbecountedinmultiplecategories thus thenumberof appsinacategorydoesnotsumupto105.adetaileddescriptionof each analyzed sampleapp is availablein our online appendix .event conditions hidingtechniques system .
richfunctionality .
boot status .
iconmanipulation .
device status .
device admin .
network status .
information blocking .
arrow rightdeveloper defined .
arrow rightself uninstallation .
packagechanges .
arrow rightautomated gesture input .
arrow rightservice bind .
screen locking .
smsdelivery .
c battery status .
callstatus .
payloads usbstatus .
information stealing .
user .
ad abuse .
application launch .
premium charges .
arrow rightbuttonclick .
arrow rightcryptomining .
arrow rightsensitive input .
root exploit .
arrow rightpermissions .
arrow rightclipboard hijacking .
arrow rightappinstall .
arrow rightportforwarding .
arrow rightclipboard text .
ransom .
scheduling .
unknown .
scheduling .
d a check conditions code properties externalserver .
location internet .
direct .
sms .
arrow rightdownloaded remote .
device .
arrow righthidden resources .
softwarespecs .
language network .
bytecode .
arrow righthardware specs .
arrow rightweb .
arrow rightsensors .
native .
environment .
e time .
location .
application .
permissions .
dataformat .
arrow rightprobability .
arrow rightindicates categories identified in our work version .
compared with prior studies b figure characteristics of google play malware .event conditions figure 4a have three sub categories system events.
themajorityof theanalyzedsamplesaretriggered by at least one systemevent most commonly when the phone is booted or when the device status changes e.g.
from lockedtounlocked.similarsystemeventsincludenetwork battery call status and smsdelivery events.webelieve malwareuses system eventstoavoidexecutingthemaliciouspayloadonthe easierto trigger main application launch while still ensuring the malicious functionality is eventually triggered.
interestingly most system events we observed are less likely to happen on the emulator e.g.
lockstatuschange whichfurthercomplicatesthedetectionofthese apps at testing time.
weobservedtwonewtypesofsystemeventsnotdiscussedin earlier reports developer defined are custom events not defined by the android platform.
for example solid id is activated by the reception of a firebase message .
considering such custom event types could challenge dynamic analysis based tools.
service bindevents which allow the app to communicate with bound services e.g.
accessibility were described in the literature but we believe we are the first to observe them in practice.
forexample spybankerajz id abuses the accessibility service whichhasaccesstouserinteractionswithotherapps toactivate itself when the user interacts with a banking app and overlays a phishing browser to steal banking credentials.
user events.
while almost of the samples activate a payload oncetheuserlaunchestheapp weidentifiedadditionaluserevents authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa michael cao khaled ahmed and julia rubin triggering malicious behavior such as inputting specific data or copying text see figure4a for details .for example clipperc id triggers when the user copies text and checks if the text is formatted as a wallet address.
if so the app executes its payload.
scheduling events.
around half of the samples periodically repeat themaliciousbehavior.forexample hidenad id schedules analarmthatdisplaysfull screenadsevery15minutes evenwhile the user is interacting with other apps.comparison with earlier reports.
ouranalysisidentifiedtwotypes ofsystemevents developer definedandservicebind notdiscussed in earlier reports .
we also provided a more detailed characterization of user events according to their types.
.check conditions figure 4b have four sub categories external server.
three quarters of the analyzed sample apps execute malicious payloads on receiving particular data from an external server either through the internet or by an sms a.k.a.
command and control or c c malware .
most frequently the commandsareretrievedovertheinternet.intwocases theappsreceive ansmscommandtoenableinterceptingandleakingsmsmessages and calling premium numbers e.g.
acecard id .
device.threequartersofthesamplesalsoconditionpayloadson softwarespecsoftheunderlyingandroidsystem suchassystem version and whichapps are installed.
we identified several checks notdescribedinearlierreports hardwarespecifications i.e.
cpu and network operator and sensordata i.e.
battery temperature and motion.
for example aladdin id checks that the device contains more than cpu cores before generating ad traffic to an invisiblewebpage vilny id checksthephonetemperature and battery level before mining cryptocurrency presumably to not alarm the user by a sharp change of these parameters.environment.
these checks commonly known as time and logic bombs activate malicious payloads only at a certain timeand or location.
for example pletord id checks the user s location to ensurethattheuserisnotfromrussiaorukraine beforelocking the phone in silent mode and asking for a ransom.application.
application specificchecksinclude permissions data format and app version.
for example smsandroidoswesp id usesregularexpressionstocheckthatthereceivedsmscontains a pin before leaking it to the malware developer s server.
moreover we identified a number of samples that decide whether to activate the malicious payload probabilistically.
for example hiddenadhrxh id uses the java.util.random library to roll a numberbetweenoneand100andautomaticallyclickonadsonly if the obtained value is less than .
comparison with earlier reports.
previous work reported conditions based on commands retrieved from an external server installed apps time and location.
our detailed categorization reveals newchecks hardwarespecifications sensors andrandomnumbers.
.hiding techniques figure 4c .
the most prominent technique in our dataset is the inclusion of rich benign functionality which is employedbymorethanhalfofoursamples.thisisdonetoconvince the user that the app is legitimate e.g.
by presenting a weather forecast id orprovidingayoutube likevideointerface id .unlikerepackaging theseareuniqueappsandwearenotawareof other reports that explicitly identified such behavior.another frequent hiding technique is icon manipulation.
in additiontothepreviouslyobservedcaseofhidingtheappicon samples inourdatasetalsochangetheicon pretendingtobeanotherapp.
for example reputation1 id changes the icon and name to resemblegooglemaps.moreover whentheuserclicksontheicon theapplicationredirectstogooglemaps.meanwhile itperiodically pushes full screen ads to the user without the user being aware of the origin of these ads.
obtaining device admin privileges can make the malware harder toinstall.itcanalsoallowthemalwaretoperformprivilegedoperations such as changing the lock screen password or locking thescreen tofurtherincreasethedifficultyofuninstallation.for example spybankerhu id locks the screen when the user attempts to disable its admin privileges.
samples also employ informationblocking i.e.
hidinginformationproducedbythepayload from the user and screen locking to prevent the user from noticing suspicious behaviors on the device.
we also observed a new hiding approach via self uninstallation.
forexample banbraa id canreceivecommandsfromthemalwaredeveloper sservertouninstallitself.thisconfusestheuser aboutwhichappperformedthemaliciousbehaviorandreducesthe chancesoftheappreceivingabadreview.yetanothernewtechniqueisabusingaccessibilityservicestoperform automatedgesture inputtopreventthe userfromperformingcertainactions.for example spybankerajz id pressesthebackbuttonwhenever the user opens an antivirus.comparison with earlier reports.
similar to malware genome and amd weobservediconhiding informationblocking deviceadmin privileges and device screen locking hiding techniques.
we also observednewtrends implementinglegitimatebenignfunctionality changing the app icon self uninstalling and automated gesturing.
in addition the amd report described techniques which did not occurinourdataset cleaningsystemlogs killingantiviruses removing the app from the device administrator list and preventing uninstallation of the app.
.payloads figure 4d are divided into nine sub categories information stealing.
the most frequent payload in our dataset isinformation stealing e.g.
of sms accounts phone numbers contacts andstoredfiles.somemalwarealsoexplicitlytricksthe user into entering sensitive information.
for example reputation1 id presents a web page claiming that the user won a prize.
to redeem theprize thewebpageprovidesasurveythatsteals sensitive information from the user.
ad abuse.
sampleswith adabusearealsofrequentinourdataset.
weidentifiedthreeadabusepatterns a aggressiveadvertisement forcesadvertisementswhentheuserperformsacertainactionor periodically.forexample fraudapp id actsasafakecryptocurrency miner while pushing full screen ads.
b hidden ads loads webpagesthatcontainadstogainadditionalrevenue.forexample aladdin id opens an invisible webview to increase the number ofvisitsto themaliciousdeveloper swebsitethat containsads.
c ad clickfraudautomateclicksonads.forexample adclickerbn id retrieves a list of targeted websites and a javascript payload from a c c server and performs ad clicks.premium charge.
appsalsoimpose premiumcharges ontheuser bysubscribingthemtopremiumserviceswithoutuserconsent e.g.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rotten apples spoil the bunch an anatomy of google play malware icse may pittsburgh pa usa smsandroidoswesp id and sonyvpay id .
to perform the subscription the malicious app obtains up to date information about the service such as its subscription number subscription message andsubscriptionaccount.itthensendsarequesttothe service over sms call or internet.
a confirmation message is sent backtothedeviceoversmsandisinterceptedandconfirmedby the malware.
cryptomining.
severalsamplescommence cryptocurrencymining withouttheuser sconsent e.g.
coinminerq id andcpuminer id .to performcryptomining aminer receivesa hashpuzzle and its result they need to find the puzzle input value that leads to the given result.
the first miner to do so is rewarded with cryptocurrency.toincreasethechancesofgettingthemonetaryreward maliciousdevelopersleveragemobiledevicesofmanyunsuspectingusers synchronizingbetweentheusersviaaconfigurationobtainedfromaremoteserver.interestingly whileminingcryptocurrencyis a popular monetization tactic earlier studies did not identify such apps.
this could be because of the sharp rise in bitcoin prices in which falls outside of the date range of earlier reports.
root exploit.
malware exploits vulnerabilities in the android operating system togrant the app unrestricted access to the device s memoryspace.rootexploitsaretypicallyperformedinnativecode as bytecode runs in a virtual machine that is isolated from the operating system.
to perform root exploits the malware retrieves native binaries stored locally or over the internet.
it then executes the binaries and performs unauthorized actions such as silently installingothermaliciousapps.forexample godless id executesrootexploitsthendownloadsandinstallsanappwithsystem privileges to perform additional payloads.clipboard hijacking.
yet another technique not reported in previous studies is a clipboard hijacking attack when the malware changes the text clipboard so that the user pastes unintended text.
forexample theclippercmalwaredescribedearlier id uses this mechanism to replace a wallet address copied by the user with the malware developer s wallet address.port forwarding.
our samples also perform port forwarding a special form of information stealing where malware attempts to steal data from the user s internal network.
to this end malware createsanoutboundconnectiontothemaliciousdeveloper sserver retrieves a target address and network command forwards the networkcommand totheinternal networktocollect data andrelays the response back to the developer s server.
for example milkydoor id tunnelsusingsshintotheuser sinternalnetworkto steal enterprise data.ransom.
for monetization some apps ask for a ransom where the malware encrypts data or disables device functionalities to coercethevictimintopayingafee e.g.
usingabitcointransaction to release device functionalities that are being held captive.
for example pletord id locks the device into silent mode and opens awebview to ask for a ransom to unlock it.
unknown payload.
there are samples in our dataset that download code dynamically from a remote server.
such code might containmaliciousbehavior addingtootherpayloadsweobservedin these apps.
as we could not confirm the malicious behavior of the downloaded code we mark these payloads with unknown.comparison with earlier reports.
prior work did not report on the cryptocurrencymining clipboardhijacking andportforwarding payloads which were observed in our datasets.
the amd studyreported the ad abuse payload but did not elaborate on the dif ferent types of ad abuse that we found in our study aggressive advertisement hidden ads and ad click fraud.
.codeproperties figure4e aredividedintotwosub categories location.
checkconditions hidingtechniques andpayloadscan beimplemented directlyinthe apk.dexfile downloaded remote from a server or hidden resource where the code is packed in the app sresources.forexample hiddadbz id hidesitspayloadina text font file which is converted to apk and executed at runtime.
interestingly aroundhalfoftheanalyzedsamplesdownloadcode fromathird partyserver.thesamplestypicallyuse dexclassloader to load the downloaded bytecode and invoke it via reflection.
two samples droidplugin id and asiahitgroup id abuse the virtualinstallationtechnology originallydesignedtoinstall multiplecopiesofthesameapp tosilentlyinstallmaliciousapps.
other samples attempt to install the downloaded apks directly using social engineering to convince the user to allow installation.
for example anubisdropper id claims that the system is out of date and the user should install a secondary app to update it.
language.
checkconditions hidingtechniques andpayloadcan also be implemented in different languages java bytecode web javascript orin nativecode c c .wefoundthatwhilemostof theanalyzedsamplesimplementthemaliciousfunctionalityinjava bytecode somemaliciousbehaviors mostlyrelatedtoadabuse are implemented in javascript code loaded into webviews .
finally a few samples also employ native code.
comparison with earlier reports.
theanalysisperformedinearlier work was more coarse grained and only considered the location of thepayload.instead ourworkmapseachofthemaliciousactivities checkconditions hidingtechniques andpayloads basedon theircode location.thedetailedmapisinouronlineappendix .
to answer rq1 we observed that a high fraction of the analyzed samples implement information stealing and ad abuse.
we alsoidentified new payloads cryptomining clipboard hijacking and portforwarding.malwareshiftsitspayloadsoffthemainexecution path and hides them under a number of difficult to trigger checks complicating the detection of these samples.
furthermore samples alsosplittheirmaliciouspathsacrossmultiplelanguages.finally weobservedthatmalwareemploysnewhidingtechniques suchas self uninstallation and automated gesturing.
flow based malware signature themalwarecategorizationinsection3providesinformationabout event and check conditions hiding mechanisms and payloads employedbycurrentmalware understandinghowtheseactionsare combined together is an essential step towards building efficient tools for detecting such malware.
for the spybankerhu sample in figure3 presentingweb basedcontentina webview is byitself alegitimateapplicationbehavior common tomanybenignapps.however this behavior is executed only when a certain app i.e.
cepbank isinstalled on thedevice lines29 .
discovering such contextualinformationcanhelpatechniquedeemthissamplemali cious.likewise understandingtheinterplaybetweendeletingsms authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa michael cao khaled ahmed and julia rubin !
!
!
!
!
!
figure flow based malware signature of spybankerhu messagesandtheconditionreceivedfromtheserverwhichenables thisbehavior lines25 28and5 canhelpdistinguishbetween benign apps that manage users sms messages and apps that have amaliciousintent.understandingthepreciseorderofeventsand conditions that activate a malicious payload as well as implementationmechanisms suchasinformationflowsbetweenbytecode and javascript code in webviews and code level obfuscation techniques such as string manipulations and app and phone specific contentmanagementcode lines5 17infigure3 isalsoessential to build efficient techniques that can detect realistic malware.
to capture such contextual and path level information we manually created a flow based malware signature graph for each of the analyzedsamples.thesesignaturesgobeyondthecategorizationin section they rather capture control and data flow dependencies for paths related to each malicious behavior.
they also capture information about how each malicious component is implemented including implementation location and code language.
figure5showsanexampleofsuchagraphfor spybankerhu.
the nodes of the graph are the four actions from the malware categorization schema in figure event conditions ec check conditions cc hidingtechniques h and payload p .thesenodes are shown as rectangles with the corresponding event type in their names.
we add one additional type of node which we call data retrieval dr it is shown as an ellipse in figure .
each such node corresponds to the action of retrieving data e.g.
from an sms message the internet or user sensitive input.
the retrieved data is used either in evaluating the check condition or in a payload.
thegraphcontainstwotypesofedges control flow dottedlines anddata flow solidlines .similartothecontrol anddata flowconceptsfromtheprogramanalysisdomain control flowedgesin ourgraphdescribetheorderinwhicheventsareexecuted data flow edges describe the flow of information from data retrieval to either check condition or payload nodes.
for the example in figure the p information stealing node node in the figure is executed after dr sms node h information blocking node and dr device node the data flow edges show that the p information stealing node leaks sms and device related information.another important detail captured by the graph is that the info stealing payload is triggered only after an sms is received node andonlyifthecondition cc externalserver internet node evaluates to true.
the condition itself is dependent on the informationobtainedfromtheinternet node whichisretrievedwhen the user unlocks the phone ec system device status node .
finally wegroupnodes into regionscapturingthecodepropertiesofthenodes locationandlanguage.theregionsareindicated by dashed lines in figure .
in this example there are two regions the first contains nodes corresponding to the bytecode directlyloaded by the app from the .dex file nodes and the second contains nodes corresponding to web code html javascript downloaded from the remote server nodes .
whenweanalyzedthisapp theremoteserverwasdownand thus we have no access to the code downloaded from the server.
wedescribethebehaviorofthatcodebasedonthedescriptionin theblogpost upontheuserenteringtheircredentials node this info gets leaked to the malware developer s server nodes and .
as discussed in section .
we mark nodes for which we followedthepostdescriptionratherthanobservedthemalicious payload directly with a star star empty .
apathinourgraphisasequenceofnodesconnectedbycontrolflowedges.apathstartsfromanodewithnoincomingedge which is an event condition e.g.
node in figure .
a path ends with a node with no outgoing control flow edges which could be apayload a data retrieval node or a hiding technique node e.g.
node .theexampleinfigure5hasthreepaths p1isthepath fromnode 1to wheretheconditioninnode 2evaluatesto true.
p2isa shorter pathfromnode 1to 15wherethecondition evaluates to false.
finally p3is the path from node to .
apathcanincludemultipleeventconditions.forexample p3 requires the user to unlock the device node and provide sensitiveinput node .likewise apathcanincludemultiplecheck conditions e.g.
p1checksaservercommand node andinstalled apps node .finally apathcanhavemultiplehidingtechniques andpayloads e.g.
p2containstwoinformationstealingpayloads nodes and .
signatures of gp malware.
by analyzing the malware signatures of our samples we make three main observations overall thesampleshave14.9pathsonaverage forthiscalculation we excluded outlier samples with more than paths as the median number of paths is .
each path has multiple event and check conditions hiding techniques data retrieval nodes and payloads.
thereare .
event conditionsand .
checkconditions per path on average.
the relatively high number of conditions per path shows that malware conditions the execution on specific externalandinternalsettings seefigure4forthelistofconditions .
forexample vilny id whichminescryptocurrencyonthe device checksacommandfromtheserver phonetemperature battery level and that the screen is off all before starting the payload.
malware analysis tools that are based on dynamic and symbolic execution should account for all these conditions of different types to fully analyze trigger the malware.
thereare5.3dataretrievalnodesperpath onaverage.themajorityofthesedataretrievalsareforvalidatingthecheckconditions authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rotten apples spoil the bunch an anatomy of google play malware icse may pittsburgh pa usa andtherestareforretrievingsensitivedatafortheinformationleakagepayloads.interestingly around40 ofdataretrievalshappen onapathdifferentfromthetargetcheckconditionorpayload.that is theapplicationsretrieveandstoredatain say afile andthen usesitonanotherpath triggeredbyadifferentevent.weidentified severalcross pathdatastoragelocations globalvariables files and shared preferences.
for example bahamut id records the call audiointoafilewhenthecallisstarted.later inadifferentevent on network change it sends the stored file to a third party server.
this implies that malware analysis tools should be able to consider morethanonepathsimultaneously e.g.
totriggermultiplepaths during dynamic analysis and to analyze data flows across multiple paths during information flow analysis.
unfortunately some ofthe existing tools especially those based on formal methods and complex program analysis currently only consider one callback at atime e.g.
.furthermore toolsshouldconsiderinformation flows through multiple data types given above in addition to fields and local variables.
sampleshave3payloadsonaverage eachofwhichisreachable via .
paths on average.
multiple paths lead to the samepayload as malware typically triggers the payload from multipleevents to maximize the likelihood and frequency of the payloadactivation.
for example a milkydoor id payload which isnot reachable by simply opening the app can instead be reached from60differentpathsoriginatingfromphoneboot restart unlock wi ficonnectivitychange andcellularconnectivitychangeevents.
these events are more likely to occur on a user device rather than onanemulator asanemulatoristypicallyon unlocked andhas astableconnection.webelievemalwareusesthismechanismtoavoid detection while maximizing the likelihood to execute the payload.
in fact more than of the paths in our samples do not start on app opening.
to answer rq2 our samples have more than paths on average many of which originate from different events.
each path contains numerous conditions which need to be satisfied for the payload to execute.pathsalsocontainnumerousdataretrievalnodestoaccess datathat isvalidatedin theconditionsand thatflowsto payloads.
somedataretrievaloperationscrossmultiplepathsby temporarily storingdatainglobalvariables files andsharedpreferences.
understanding the set and order of these behaviors is needed to build accurate malware detection approaches.
discussion and implications in an attempt to understand why such malware still makes its way tothegoogleplaystore weanalyzehowexistingtoolsdealwith the different characteristics of malware in our dataset.
we focuson academic tools only because intellectual property ip rights security by obscurity to prevent malware authors from attacking the tools and other restrictions prevent us from analyzing commercialofferings.yet asallmalwarecollectedinourdataset bypassed google play defenses we observe that commercial tools are also limited in detecting such malware.
to identify relevant academic tools we systematically analyzed proceedings of top conferences and journals in software engi neering and security focusing on publications between january 2010andjuly2021 icse fse ase issta tse forced execution condition detection hiding detection payload specific repackaged malware malware detection toolsinfo leakage phishing privilege abuse inter app attack generic malware dynamic code loading sandboxing ad abuse ransom figure the space of malware detection tools empirical se journal ieee software jss information and software technology tosem ccs s p usenix security acsac ndss tifs computers security information security security and privacy journal andtrans.ondependableandsecurecomputing .
thissearchresultedin414papers.wefurtheraugmentedourlistof paperswithtechniquesfromsevenrecentsurveysonandroidsecurity to cover papers that were published in other venues identifying additional papers.
twoauthorsofthispaperreadtheabstract introductionofthe identified papers selecting those that propose approaches for flagging apps as malicious vs. benign.
the disagreements werediscussed and resolved either in a mutual discussion or with the helpofathirdarbitrator.attheendofthisprocess weidentified 237relevantreportswhichwefurthercategorizedbythetypeof malware analysis they perform.
the resulting categorization is showninfigure6anddiscussedbelow thefulllistofpapersand their categories is available online .
genericmalware.
themajorityofpapersinourlist arein this category.
they introduce techniques that aim to detect malwarebylearningfromalargesetofmaliciousandbenignapps.the techniques vary by the type of features they extract the way of extracting these features statically dynamically or using a hybrid approach andthetypeofmachinelearningtechniqueusedforcre atingtheresultingmalwareclassificationmodel.featuresextracted from the apps include permissions e.g.
java android api calls e.g.
system calls e.g.
properties extracted from control and data flow graphs of the application e.g.
or combinations of the above e.g.
.
these techniques rely on the assumption that malware apps havesimilarfeatures whicharedifferentfromthefeaturesofbenign applications.
our analysis shows that of the analyzed malware implement rich benign functionality to penetrate into the store and further avoid detection by the user.
in such situations features extracted from the benign portion of the apps may outweighfeaturesfromthemaliciousportion tippingtheclassification outcome towards the benign class.
future research could benefit from identifying more targeted features that highlight specific maliciousbehaviors.approachesforpre processingapps toremove knownbenigncode e.g.
usinglibraryorrepackagedcodedetec tion could also be used in tandem with generic malware detection techniques.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa michael cao khaled ahmed and julia rubin payload specific.
another major line of work papers focuses on looking for a specific payload in an app.
out of those most approaches papers identify information leakages.
while informationleakageisindeedthemostprevalentpayloadinouranalysis other payloads do not seem to receive similar attention.
in particular onlya fewtechniques e.g.
focuson adabuse detection the second most common payload in our analysis samples .
moreover while these techniques work on the java bytecode level 29samplesinouranalysisimplementthepayloadinjavascriptand in native code.
a handful of approaches have also been proposed to detect privilegeabuse overlayphishing andransom.yet theseapproaches cannotdetectthefullrangeofrelatedmaliciousbehaviorsidentifiedinourdataset.forexample ransomwaredetection focuses on identifying apps that perform encryption while samples in our datasetratherforcethedeviceintosilentmodebeforerequesting ransom.
finally no payload specific techniques exist for other payloads in our dataset such as cryptomining clipboard hijacking account stealing via accessibility services and more.
condition detection.
a few papers focus on detecting the check conditionsthatleadtoactivatingmaliciouspayloads.thislineof work assumes that code that is executed under narrow conditions isindicativeformaliciousbehavior.forexample triggerscope identifiessensitiveapisconditionedbychecksconstrainedbyaconstant value mostly targeting logic and time bombs.
hsominer observes that malicious and benign branches under a narrow condition usually exhibit different characteristics and thus trains a classifier to learn the difference between malicious and benign branches.
enmobile detects data and control flows between commandsreceivedfromtheinternetandsensitiveapisusedby the app targeting command and control malware.
we believe these are promising directions.
yet our analysis shows that these techniques might miss existing samples e.g.
because both conditioned branches can be malicious as in our spybankerhuexampleinfigure5.moreover around30 ofthe sampleswe analyzedemploy newcheckconditions thatwerenot consideredbefore suchconditionswouldbedifficulttointegrate intoexistingapproaches e.g.
checkingfortheinternetorscreen status is a common behavior of benign apps as well.
finally to avoidfalsepositives techniquesinthiscategoryoftenapproximate malicious behaviors by the usage of sensitive apis executed under conditioned checks.
yet the precise list of sensitive apis is hardto define we found samples that use even the most na ve apisfor malicious purposes e.g.
an api to set clipboard data.
at the sametime appscandeliverpayloadswithoutrelyingonanyapi atall e.g.
theycanusemathematicaloperationsonlytominecryptocurrency on the device.
we thus believe it would be beneficial tocombinethislineofworkwithtechniquesthatlookatspecific payloadsandalsoidentifystrategiesforincorporatingadditional condition checks that are common in benign apps as well.
forcedexecution.
anotherinterestinglineofworkaimsatdynamically forcing the app execution into a malicious path.
for example intellidroid and appintent use symbolic execution to findthepathconstraintsthatleadtoexecutingsensitiveapis thensolvetheconstraintsandprovidetheappropriateinputthattriggersthe path.
fuzzdroid and dualforce use concolic execution to simplify unsolvable constraints.
in addition to the problem of triggering the right conditions in the right order discussed in section4 themainlimitationofthesetechniquesisthat toscale condition resolution via symbolic or concolic execution they limit the scope of the analysis e.g.
to analyze each application event entry point separately.
our analysis shows that malicious behaviors cross entry points in of the analyzed samples to detect suchbehaviors itisessentialtoanalyzepathsthatcrossmultiple entry points including cases where data is transferred from one pathtoanother.moreover constraintsforsomeconditionsarehard to infer statically.
for example in the bahamut sample id the response from the server is processed in a loop which extracts and parses each response line separately towards retrieving a command.
analyzing such code requires guessing the right structure of the response and the desired number of loop iterations which is a nontrivial task.
hidingdetection.
severalpapersinthiscategorymostlyfocus on flagging the difference between the behavior of the app and its presented user interface .
shan et al.
propose scanning the apps for identifying self hiding behavior blocking phone calls text messages or removing calls and messages from logs.
yet theauthors noticethatbenign appsalsosometimes employthese behaviors.
thus hiding techniques on their own do not providesufficient evidence of maliciousness and can be combined with other techniques e.g.
for trigger and payload detection.
dynamic code loading.
a few papers focus on detecting dynamic code loading where code that is not in the apk s bytecodeis fetched either fromlocalstorage orfrom theinternet and loaded at runtime.
while dynamic code loading can indeed be used maliciously it can still be used by benign apps for legitimate reasons such as patching or loading add ons.
analyzing the dynamicallydownloadedcodeon demand asitisbeingloadedand executed could be a productive direction for possible future work.
sandboxing.
toolsinthiscategoryaimtocreateanalysisplatforms to aid researchers in analyzing malware apps e.g.
.
our analysis shows that in almost of our samples a payload is activated on receipt of a command from the application server.
as the malicious developer may turn their servers off or simply notsend the right command until the app passes the vetting stage sandboxing will have limited abilities to detect such apps.
repackagedmalwareandinter appattacks.
toolsinthesecategoriesfocusondetectingrepackagedapps i.e.
appsthatresemblebenignappsavailableinthestore andappsthat collude witheach other to perform a joint attack.
as our dataset does not contain such apps we omit a discussion of papers in these categories.
anote onprogramminglanguages.
mostexisting toolsfocus on java bytecode with a few analyzing native code as well .whilemorethanaquarterofoursamplessplitthemalicious executionbetweenjavabytecodeandweb nativecode noneofthe tools perform an end to end analysis of such executions e.g.
to identifyconditionsinbytecodethatconstrainweb nativepayloads.
as malware becomes increasingly more sophisticated developing such tools could be a direction of possible future work.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rotten apples spoil the bunch an anatomy of google play malware icse may pittsburgh pa usa summary.
the majority of existing tools focuses on identifying features and training machine learning classifiers to tell malicious andbenignappsapart.payload specifictoolsfocusmostlyoninformationleakages leavingagap inidentifyingadditionalpayloads.
a number of approaches also look at analyzing and triggering conditions that lead to payloads as well as at hiding techniques.
a productive research direction could be to combine condition payload and hiding specific techniques providing a holistic detectionapproachthatcananalyzethefullbehaviorofapps.tools looking at cross platform malware behaviors as well as dynamically downloaded code are also needed.
limitations and threats to validity themainthreattothevalidityofourresultsstemsfromthemanual analysis we performed when identifying blog posts describing the malware we could have misinterpreted the findings in a post or missedsomerelevantblogposts.wecouldalsohavemissedormisclassifiedsomeoftheanalyzedtools.tomitigatethesethreats two authorsofthispaperperformedtheblogsandtoolsclassification independently and then cross validated each other s results.
whenperformingmanualanalysisofapps wecouldhavemissed some payloads or incorrectly interpreted the findings.
to mitigate this threat two authors of this paper worked collaboratively onanalyzing a number of apps to establish a common process and methodology.
thefindingsfrom allanalysissteps werediscussed withallauthorsofthepaperinperiodicmeetings toidentifyandfix misinterpretations and omissions.
we make all our results publicly available to facilitate reproducibility.
wecouldnotperformadetailedmanualanalysisforsomeofthe appsduetoheavyobfuscation theuseofcommercialpackers miss ing encryption keys and more see section .
.
we excluded theseappsfromouranalysis toensurethevalidityofourresults.forappsthat rely on a server that is now down we used descriptions of malicious behaviors taken from the blog post when available.
as the posts may not describe all event conditions check conditions and payloadsthatthedownloadedcodeuses wecouldhavecaptured the paths in these apps only partially.
we explicitly mark nodes with star empty in our flow signatures .
of all nodes to distinguish them from behaviors we observed directly.
our findings might not generalize beyond the dataset that we considered.
yet as we carefully designed the data collection process and selected a large number of apps from several top security company blogs we believe that our results are reliable.
finally our discussion of implications on malware detection tools is based on paper analysis rather than concrete evaluation.
as we identified relevant tools with around being opensourced performing proper evaluation requires a good toolsampling strategy including a strategy for evaluating tools that are not open sourced and proper training testing methodology as the majority of the tools are based on machine learning see section .
we thus leave such a study for possible future work.
related work felt et al.
were likely the first tomanually analyze and report on the behavior of android malware apps as well as ios and symbianapps collectedbetween2009and2011.later jiangandzhou collectedandmanuallyanalyzedappsfromantivirus company blogs between and contributing a comprehensive set of labeled android malware apps from malwarefamilies the malware genome dataset .
wei et al.
applied a similarmethodologytocollectalargesetof24 650appsthatbelong to 71malware families the amd dataset and manuallyanalyzed of these apps.
the dataset contains malware between and .
while our work is similar we collected and manually analyzed a newer set of apps identifying new payloads and activation mechanisms as discussed in section .
we also outlined hidingtechniques and code level app properties and provided detailedinformation on the end to end malware activation mechanisms section which was not done before.
similartous kissetal.
performedadetailedmanualanalysis of samples from seven malware families spanning describingeventsandactivationconditionsrequiredtotriggerthemalicious behavior.
yet our dataset is substantially newer and larger allowing us to identifya larger set of malware characteristics.we also created a schema to capture information about path sensitive behaviors.
recently xiaetal.
andwangetal.
studiedpayloads in cryptocurrency and covid related apps from various markets.
unlikeourwork theseanalysesdidnotprovideactivationconditionsandthecode levelpropertiesofmaliciousbehaviors focusing onhigh levelcharacteristicsofthepayload.wealsodonotlimit our analysis to apps in a particular category.
anumberofauthorscollectedlargedatasetsofmalwarefrom various sources mostly using antivirus scanners to distinguish maliciousandbenignapps .otherscollected datasets of malware barring particular payloads e.g.
piggybacking adware ransomware orbankingmalware .
whilethesedatasetsareusefulfortoolevaluation theauthorsdo not perform a detailed manual analysis to extract the exact properties of the collected apps as we do in our work.
several authorsfocused on studyingthe space of featuresused for malware classification e.g.
as well as biases in malware classification e.g.
.
others built generic and dedicated techniques for identifying malicious applications as discussed in section .
our work is orthogonal as we do not study datasetsatscalebutratherperformadetailedmanualanalysisof apps that evaded detection by the google play store.
conclusion in this paper we systematically built a dataset of malwareapps that penetrated the official google play app store between january2016andjuly2021.wemanuallyanalyzedsamplesfrom 105distinctfamilies collectingdetailedinformationaboutactivationconditions hidingtechniques payloads andcodeproperties original location and language that malware employs.
we comparedourcharacterizationtopriormalwareanalysisreportsand furtherproduced detailedmalware signaturesthat accuratelycapturemaliciousexecutionpathsofeachsampleapp.wediscussed the properties of existing malware detection tools in the contextof our analysis and identified gaps and possible future research directions.webelieveourdetailedanalysisofmalwarebehaviors can help develop more efficient malware detection tools.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa michael cao khaled ahmed and julia rubin