zurich open repository and archive university of zurich university library strickhofstrasse ch zurich year configuration smells in continuous delivery pipelines a linter and a six month study on gitlab vassallo carmine proksch sebastian jancso anna gall harald c di penta massimiliano posted at the zurich open repository and archive university of zurich zora url conference or workshop item published version originally published at vassallo carmine proksch sebastian jancso anna gall harald c di penta massimiliano .
configuration smells in continuous delivery pipelines a linter and a six month study on gitlab.
in esec fse 28th acm joint european software engineering conference and symposium on the foundations of software engineering virtual event usa november november .
acm .
smells in continuous deliverypipelines a linter and a six monthstudy ongitlab carminevassallo universityof zurich zurich switzerland vassallo ifi.uzh.chsebastian proksch delft universityof technology delft the netherlands s.proksch tudelft.nlanna jancso universityof zurich zurich switzerland anna.jancso uzh.ch harald c. gall universityof zurich zurich switzerland gall ifi.uzh.chmassimiliano di penta universityof sannio benevento italy dipenta unisannio.it abstract an effective and efficient application of continuous integration ci and delivery cd requires software projects to follow certain principlesandgoodpractices.configuringsuchaci cdpipeline ischallenginganderror prone.therefore automated lintershave beenproposedtodetecterrorsinthepipeline.whileexistinglinters identifysyntacticerrors detectsecurityvulnerabilitiesormisuse ofthefeaturesprovidedbybuildservers theydonotsupportdevelopers that want to prevent common misconfigurations of a cd pipeline that potentially violate cd principles cd smells .
to this end we propose cd linter a semantic linter that can automatically identify four different smells in pipeline configuration files.
we have evaluated our approach through a large scale and long termstudythatconsistsof i monitoring145issues opened in as many open source projects over a period of months ii manually validating the detection precision and recall on a representative sample of issues and iii assessing the magnitude of the observed smells on open source projects on gitlab.
our results show that cd smells are accepted and fixed by most of the developersandourlinterachievesaprecisionof87 andarecallof .thosesmellscanbefrequentlyobservedinthewild as31 of projectswithlongconfigurationsareaffectedbyatleastonesmell.
ccs concepts software and its engineering agile software development automatedstaticanalysis softwarelibrariesandrepositories software testinganddebugging.
keywords continuous delivery continuous integration devops antipattern configuration linter.
esec fse november 8 13 virtual event usa associationfor computing machinery.
thisistheauthor sversionofthework.itispostedhereforyourpersonaluse.not for redistribution.
the definitive version of record was published in proceedings of the28thacmjointeuropeansoftwareengineeringconferenceandsymposiumonthe foundationsofsoftwareengineering esec fse november8 13 virtualevent usa .
introduction continuous integration ci and delivery cd are widely adopted practices in software development.
a ci cd pipeline automates theprocessofbuilding testing anddeployingnewsoftwareversions.
there is plenty of empirical evidence for the positive effects of using ci cd including early defect discovery increased developer productivity and fast release cycles .
to achieve thesebenefits itisrecommendedtofollowvariousprinciplesand best practices.
for example developers should build and test the software on every change that is committed to a project s version control system .
several catalogs of ci cd best practices exist .however whiletheiradoptionhasbeenadvocated inresearchpapers whitepapers andbooks developershavedifficultiestoapplytheminpractice deviatingfromprinciples andgeneratinganti patterns .
some of these anti patterns are related to the way developers use a ci cd pipeline.
for example developers do not integrate their changes frequently or they remove failed tests to repair a build failure and previous researchers implemented tools that help developers avoid those bad practices by analyzing logs and past changes.
other anti patterns emerge when the ci cd pipeline is configured.
to support developers when configuring ci cd pipelines devops build servers such as gitlab can validate their configuration files using online linters .
however those tools only spot basic syntactic errors such as the use of reservedkeywordswhen naming buildsteps.
previous works have proposed approaches for detecting misuses of specific configuration options.
gallaba et al.
achieved a high user acceptance when pointing out the misuse of four different configurationoptions likeexecutingcommandsinthewrongbuild step.
rahman et al.
focused on security related issues and sharma et al.
on infrastructure as code iac smells.
while theseworksshowthatsemanticlintingofcdpipelinesisuseful they do not solve the problem of avoiding cd anti patterns in configurationsfiles.forexample asystematicmanualjobexecution isnot amisuse but itviolates acd principle.
in this work we want to help developers avoid violations of acceptedcdprincipleswhenconfiguringcdpipelines.wepropose a novel semantic linter named cd linter to detect process related violations of cd principles in the following referred to as cd smells .cd linter is currently capable of detecting four typesesec fse nov ember8 13 virtualevent usa carmine vassallo sebastian proksch annajancso harald c.gall andmassimiliano di penta of cd smells that are related to violations of principles and best practices described in the literature .
we evaluated cdlinterthrough a large scale and long term study consisting of issues opened in as many projects.
we monitored the reactions to those issues over a period of months and found that of the projectmaintainers agreedwith the reported cdsmells either accepting the issues or directly fixing them .
we also analyzedthereasonsforrejectingissuesandusethemtofurther improvecd linter .finally wemeasuredtheaccuracyofthelatest versionof cd linter andinvestigatedtheoccurrenceofthefour cd smellsinthe wild.
the contributionsofthis paper can be summarizedas follows the operationalization of four violations of cd principles in pipeline configurations cd smells and the empirical validation oftheirrelevance.
cd linter an open source semantic linter that can detect these cd smells in configuration files of gitlabpipelines.
we show that overall cd linter has a precision of and arecallof94 .
alarge scaleempiricalinvestigationoftheextenttowhich theconsideredcdsmellsoccurinalargesetof5 312opensourceprojects.
all datasets and scripts used in our studies together with cdlinterimplementation are available in a replication package .
methodologyoverview this paper investigates the problem of violating cd principles i.e.
cd smells in configurationfilesof cd pipelines.
we propose cdlinter a semantic linter that detects cd smells and evaluate its usefulnessbyansweringthe following researchquestions rq1are the cd smells detected by cd linter relevant to developers?
rq2howaccurateis cd linter ?
rq3howfrequent are the investigatedcd smells inpractice?
figure1providesahigh leveloverviewofthedifferentpartsofthis paper thedetailsoftheempiricalstudydesignwillbecoveredin section4.
inspired by existing literature in this area we started by selectingfourcdsmellsthataffectthedefinitionofcdpipelines section .2provides more details about the selection .
to study thesecdsmells weselectedadatasetof5 312open sourceprojects that are publicly available on the gitlabplatform .
we built detectors ranthemagainstthedataset andincrementallyimproved thecorrespondingdetectionstrategies .thefourcdsmellstypes andtheirdetection strategies willbe introducedinsection .
initially wedetected5 237smellsinourdataset .tovalidate the relevance of the selected cd smells and the correctness of our detectors we started opening issues in the issue trackers of the affectedopen source projects.weusedfeedback fromthe early iterationstofurtherimprovethedetectionstrategies.oncewewere confident thatthedetectorsworkproperly wecreated abalanced sample of issues .
after validating the reports manually we rejected issues and posted the approved issues to the issue trackers of the corresponding open source projects.
we then monitoredhowprofessionaldevelopersreactedtotheopenedissues for6months .insection .
wewillanswerrq 1byanalyzingtheinternal rating ofthe authors and thereactions oftheoriginal developers to our reports .
the feedbackthatwe receivedthrough rejectedissuesalsoenabledustofurtherimproveourdetectionstrategies whichreduced thetotalnumberofidentifiedissuesto5 .wecreatedastratified sample of issues to validate the precision of our detectors onalargescale whilewevalidatetherecallbymanuallyinspecting projects .
the sample size made it infeasible to open further issues on gitlab because we could not have followed up on all of them soweonlyratedthevalidityoftheseissuesinternally.our rating provided the required data to answer rq which will be discussedinsection .
.
finally we analyzed the results for the complete dataset of projects toinvestigate how frequently cd smells occur in practice .theseresults willbe discussedinsection .
.
cdlinterdescription organizations implement cd pipelines using piecesof technology suchasjenkins travisci orgitlab.whilethispapercopeswith build server agnostic smells we implement cd linter ongitlab.
gitlabisanintegratedplatformthathostsboththerepositoryand theissuetracker whichisparticularlyinterestingforourevaluation.
in february a search via the gitlabapi revealed that the sitehostedmorethan1.57mprojects.as gitlabcanalsobeused in private installations this makes it a very popular solution for enterprises .bysupporting gitlab cd linter targetsindustrial andopen sourceprojectsalike.
.
background inthefollowing weprovidesomebackgroundinformationabout the relevantconfigurationparts for this work.
build server.
a build server is a reusable infrastructure which enables developers to define custom cd pipelines and is configured through configuration files.
in gitlabthe configuration file is .gitlab ci.yml otherbuildservers have similar configurationfiles.
an exampleofsuchaconfigurationfileisshowninfigure .in the top part of the file the stages of the build that every change committedtoaversioncontrolsystemas githastopassduringthe build aredefined.ifnostagesaredefined thedefaultstagesin gitlabarebuild test anddeploy.theautomationtasksaredefined asjobs the basic unit of the cd pipeline.
the example defines two jobs code quality andunit test which invoke specific scripts that are defined in the scriptline.
for example a javaproject could include the script line script mvn test to start all unit tests through the mavenbuild tool.
developers can also configure when to run a job e.g.
when manual how many times a job can beauto retriedincaseoffailures e.g.
retry andwhethera jobisallowedto fail i.e.
allow failure true .
specialized build tools.
in addition to the configuration of the high level orchestration of the build pipeline most cd pipelines usespecializedbuildtools toperform the actual automation tasks whichrequireseparateconfigurationparameters.incontrasttothe buildserver thesebuildtoolsdependontheprogramminglanguage that is used in the project.
for this paper we chose to support the typical build tools of javaandpythonto have two representativesconfigurationsmellsin continuous delivery pipelines esec fse november8 13 virtualevent usa existing literature fake success retry failure manual execution fuzzy version selected anti patterns5 ci cd projectsgitlab projects pr issues rc projects representative sampledetection issuesvalidation sample detector validation rq1 linting accuracy rq2 issuesall detected issues study of cd smells in practice rq3 refinement issues authors developers2 figure methodologyoverview stages build test ... code quality stage build script mvn sonar sonar when manual manual execution unit test stage test script mvn test retry retry failure allow failure true fake success figure example excerptof gitlabconfiguration for strictly typed and dynamically typed languages.
the typical configurationdiffersbetweentheselanguagesandistoocomplex to be covered here.
we will introduce the relevant bits once we have describedthe cd smellsthat we are going to support.
.
selectionofrelevant cdsmells cd linter featurestheimplementationofaninitialsetofcdsmells to be evaluated.
clearly there may be many smells in cd pipelines e.g.
duvall defined50anti patterns .practicallyspeaking a cd linter can detect a limited subset of smells and being a linter only those that can be statically identified.
therefore we aimed to find a set of suitable cd smells not all the most relevant ones.
we collectedallthegoodandbadpracticesthatareillustratedinthe foundations part of humble and farley a well known book about cd practices.
some cd smells require historical information for the detection using artifacts like logs or repositories which is onlyavailableafterthecdpipelineisbeingusedandnotwhenitis configured .thisisout of scopeforastaticlinter sowejudged the feasibility of detecting the anti patterns from configurationfilesalone withoutrelyingonother artifacts.thecompletelistis availableinourreplicationpackage andweselectedfourcd smells.
fake success.
each stage of the cd pipeline checks for several categoriesofdefects.forexample jobsexecutedinthecodequality stagecanrevealthepresenceofpoorly writtencodesnippets while jobs in the test stage typically spot bugs at unit and integration levels.
every executed job should be able to fail the build.
if not developers can miss or ignore the underlying issue which adds technical debt and might result in problems later.
a fake success ariseswhenafailureinajobdoesnotaffecttheoverallbuildresult.
retry failure.
the build process has to be deterministic.
flaky behavior e.g.
teststhatsometimesfail shouldbeavoidedat any cost because they hinder development experience slow down progress andhiderealbugs.somepipelinesaddressthisissueby rerunning ajobmultipletimesafter failures.however thismight not only hide an underlying problem but makes issues also harder to debug when they only occur sometimes.
manualexecution.
cdmeanstokeepthecodebaseinadeployable stage at any given time.
thus a fully automated build process up until the deploy stage is required.
manual jobs might introduce errors and delay the delivery of code changes to the customers.
thiscdsmelloccurswhenajob thatisexecutedbeforethedeploy stage needsto be manually startedbyauser.
fuzzyversion.
developersshouldalwaysspecifytheexactversion of the external libraries that are used.
if not a build could not be reproduced.
failing to be specific on versions also leads to an occasional long debugging session tracking down errors due to the use of different library versions.
using the terminology of semantic versioning we differentiate between the following sub types of the smell i missingversion noversionnumberisdefined ii only major version only a major release number is defined iii any minor version any equal or higher minor release with the sameesec fse november8 13 virtualevent usa carmine vassallo sebastian proksch annajancso harald c.gall andmassimiliano di penta project modelversion .
.
modelversion groupid a groupid artifactid b artifactid version .
.
snapshot version properties x.version .
.
x.version properties dependencies dependency !
correct groupid foo groupid artifactid x artifactid version x.version version dependency dependency !
missing version groupid bla groupid artifactid blubb artifactid dependency dependencies modules module module example module modules project figure example ofa pom.xml major version is allowed or iv any upper version every equal or higher versioncan be used.
.
parsingcdconfigurationfiles to detectthecdsmells we parse theconfiguration files andmap their content onto meta models that we have created for each type ofconfigurationfiles cd linter supports.thesemeta modelscover theparts of theconfiguration files that matter for the detection of thecdsmells.
cd linter considersthreetypesofconfiguration files used for gitlab .gitlab ci.yml maven pom.xml andpip requirements.txt .inthefollowing wedescribehowweparsethese configurationsfor our purposes.
gitlab configuration.
from the .gitlab ci.yml file we capture the list of jobs the stages and the variables.
for each job we record the name the stage and thescript lines script before script after script as well as the retry allow failure when and environment parameters.
for the retryparameter we keep track of the maximum number of retries max and for which kinds of failures the job is allowed to be retried when .
we filter out dotprefixedjobsas gitlabdoes not processthem.
mavenandpipconfigurations.
themavenbuildtoolisverypopular among javaprojects.mavencan automate various tasks such asthedependencyresolutionandtheautomateddownloadfrom a centralized repository.
figure 3shows a configuration excerpt pom.xml inwhichtwodependencies foo.xandbla.blubb are being defined.
from the pom.xml we capture the unique coordinates of the artifact artifactid groupid version alldefinedproperties and thecoordinates ofalldependencies.allpropertiesareautomatically replaced with their actual value.
we also include all referenced modulesrecursivelyandlinkthemtogether.valuessuchasversions are then inheritedfrom ancestorpoms where available.
as regards pip the most used package manager for pythoncode two things are relevant.
first the file requirements.txt is often used to define all dependencies that are required in the pythonenvironmenttorunaparticularpieceofsoftware.theserequirementfiles can be hierarchical and include other requirement files that are inherited.
second the scriptline in the gitlabconfiguration file often contains manual calls to pipto download external dependencies.
to find these we search for the keyword pip install stripother pipoptions andremovequotesfromthearguments.it isalsopossibletospecifydependenciesbypointingtofiles folders andurlstoversioncontrolsystems.weusesimpleheuristicsto detectthesecasesandexclude themfrom the linting.
.
detectionofthecdsmells having access to the parsed information in the meta models we canproceedtoimplementvariousstrategiesthatdetectinstances ofthe fourcd smells.
fakesuccess.
theallow failure parametersetto trueallowsa jobtofailwithoutimpactingtherestofthebuild.figure 2showsan exampleinwhichthebuildexecutioncansucceeddespitepotential errorsinthe unit test job.wedetectafakesuccesseverytime a job s definition contains allow failure true .
note that we donotreportfakesuccessforthestages sast staticapplication securitytesting and dast dynamicapplicationsecuritytesting .
gitlabdefines templates that contain allow failure set totruefor the defaultjobusedinthesestages.
retry failure.
theretryparameter allows developers to configure how many times a job is going to be retried in case of a failure seetheexampleinfigure .wedetectallcasesinwhich retryissettoapositivevalue.theproposedsolutionforsucha caseistocontrol retrybymatchingaspecificfailurecause e.g.
when runner system failure .
we only found very few cases in whichprojectsused when sowedecidedtosimplifythedetectionin cd linter and reportall such usagesof retryfor now.
handling thesecasesproperly isasimplematterof implementation.
manual execution.
thewhenparameter can also be used to specifywhenajobshallbeexecuted.todetectmanualtriggersofsteps weselectedalljobsthatcontain when manual intheirdefinitions.
for example job code quality in stagebuild figure2 needs to be manually startedbyauser.
notallmanualtriggersare aproblemthough.
ci cdadvocates the automated execution of all stages to ensure a releasable project stateateverypointintime however itisacceptabletomanually decide when this release should happen.
therefore we do not report cases in which the manual execution only affects deploy stages.
apart from using the default deploystage gitlabusers canalsodefinecustomdeploystages .tobuildacomprehensive list of deploy stage names we extracted the stage names from a random project sample of our dataset see section .
we identified allkeywordsthathintatadeploystagesuchas deploy release or publish and exclude jobs and stages that contain these keywords intheirname.also wedidnotreportmanualexecutionforjobs in thetriageandreviewstages because gitlabsuggests that thesestages should bestartedmanually .furthermore we excludedcaseswherethe actionparameterof environment isset tostop whichisamanualwaytoshutdownanenvironmentused inthe build.configurationsmellsin continuous delivery pipelines esec fse november8 13 virtualevent usa table fuzzy versionsyntaxin pythonandmaven fuzzy version type python maven correct .
.
.
.
missingversion empty empty onlymajor version any minor version .
n a any upperversion .
.
.
.
fuzzy version.
the way dependencies are declared is specific to the programming language and the corresponding dependency managementtool.forwhatconcernsversioning cd linter supportspythonandjavaprojects the latter using maven .
table1 showsacomparison ofthe versionsyntax.
pythonprojects typically use pipto manage their dependencies andourmeta modelcontainsinformationaboutalldependencies thatareeitherdefinedinthe requirements.txt fileorthroughdirectinvocationsof pip install .cd linter distinguishesbetween several fuzzy version subcategories.
i if no version is defined we report amissing version ii if a version specifier only consists of a singlenumber wereportan onlymajorversion violation iii an anyminorversion whentheminorreleasenumberisanasterisk and iv any upper version if the version number only defines a lower bound but omits the upper bound e.g.
numpy .
.
injavaprojects dependencyresolutionistypicallyhandledby thebuildtool.in thecase of maven dependencies aredefinedin pom.xml.
to detect missing version we identify dependencies that do not specify a version tag.
in dependencies that define the tag we detect only major version as we do in pythonprojects and anyupperversion checkingwhethertheupperversioninarangeis missing e.g.
.
.
.anyminorversion isimpossiblebydesign because at least a range will be always declared for minor releases.
when analyzing dependencies cd linter handles transitive dependencies bytraversingthe pomhierarchyrecursively.
when reviewing the detection strategies step of figure werealized howsomelibraries suchas springboot self manage dependency versioning .
we have compiled a list of affected dependenciesforwhichwedonotreportafuzzyversioncdsmell because omitting the versionisacceptable inthesecases.
as a reaction to developers feedback rq we differentiate between libraries used in production code and tools used in the pipeline.
not specifying a version for a tool is less critical because nosourcecodereliesonanapithatmightbreakinnewerversions.
onthecontrary havinganewversionwithfixedbugsandupdated features might even be advisable.
to this end we compiled a list of toolsusedfor pythonandjavaprojects.theseinclude forexample pipenv pytest pylint andpip forpython and junit findbugs checkstyle andpmd forjava the complete listisinour replication package .
empiricalstudydesign thegoalof this study is to evaluate cd linter and determine whether it can be useful for developers to avoid cd smells in their cdpipeline.the qualityfocus istwo fold theperceivedusefulness from original developers of projects where cd smells are detected andtheaccuracyof cd linter .theperspective isofresearchersthathave developed cd linter and want to transfer it to practice.
the contextconsistsof5 312open sourceprojectshostedon gitlaband usingcd.morespecifically thestudyanswersthethreeresearch questionsformulatedinsection .
.
context selection toanswerourresearchquestions weselectedopen sourceprojects hostedon gitlab.
usingthe gitlabapi wefilteredprojects that do not have at least one star or that are forked from other projects toavoidduplicates.fromtheresulting26 984projects weremoved all the projects that do not contain a .gitlab ci.yml file in their repositories i.e.
do not use gitlabas cd server .
the last filter leftuswith5 312projectsthatwecouldanalyzeforthepresence of cd smells.
these projects have a diverse team size from to members with a median of and age from to thousand commitswithamedianof75 .regardingthelanguages ourdataset mainly includes javascript python c java go and ruby .
repositories.
also there are projects with diversecd adoption history.
.
monitoring oftheopenedissues we first run cd linter on the dataset of projects that has beendescribedinsection .
.then weidentifiedarandomsetof cd smells in a way toachieve a balancedset of cd smells of each typeandatmostonecdsmellperprojectowner toavoidflooding the same owner with many issues.
for manual execution we could detect a maximum of smells across owners and we ended up detecting atotalof168cd smells.
once the detected cd smells were uploaded to the cd linter web basedplatform whichcanautomaticallyreportissues each issuewasshowntotwoindependentevaluators twooftheauthors oneofwhichwasnotinvolvedinthe cd linter implementation to remove false positives object of a different study in section .
.
examples of false positives which received a negative assessment are manually triggered deployment jobs that were erroneously reported as manual execution incidents.
each evaluator could read thereportgeneratedby cd linter browsethefileinwhichthecd smellwasfound and ifneeded browsetheentirerepositoryand its history through a gitlablink.
once two evaluators reported a positiveassessment theissuewasautomaticallypostedandopened ongitlab.
the disagreement cases were discussed and in case of positive agreement anissuewasalso opened.in total we opened 145issues.
wehavemonitoredtheissuesoveraperiodof6months from august to february .
during this period we collected reactions countingissuesthathavebeenupvoted downvoted commented assigned orclosed.59projectsdidnotshowanyactivity duringtheobservationperiod sowedecidedtoignoretheminour analysis.theresponserateoftheremaining activeprojectswas .weperformedacardsorting ofthereceived120comments toidentifyagreementsanddisagreementswithourissuesandtheir motivations.the card sorting was performed bytwo authorsthat after a first round of independent tagging met and merged their annotations.esec fse november8 13 virtualevent usa carmine vassallo sebastian proksch annajancso harald c.gall andmassimiliano di penta inadditiontothereactions wecheckedthesourcecodetosee whetherareportedsmellwasremovedorreintroducedintheobservationperiod.insomecases thesmellwas fixeddespitea negative reactionorwithoutany reactionto the issuewhatsoever.
based on the developers reactions issues have been classified intothe following 5categories.
ignoredthe issuehas been closedwithoutany further reaction.
rejectedtheissuehasbeenclosedwithamajorityofdownvotes orwithanegative feedbackfrom the comments.
pendingthe issue is still open and under discussion among the maintainerswithoutaclear agreement disagreement.
accepted the issue has been assigned for fix has a majority of upvotes orapositive feedback.
fixedthe smellreportedinthe issuehas been removed.
to address rq we report and discuss the responses to the opened issuesforeachsmelltype.wereportthenumberandpercentagesof positiveandnegativereactions therationaleforrejectingtheissues and provide examples of positive feedback and false positives.
the results ofrq 1directlyimproved cd linter see section .
.
.
manual validationofcdsmells we executed the enhanced version of cd linter on the projects which resulted inthe detectionof5 cd smells.then we formed a sample to be manually validated.
we selected for each owner one cd smell of each type if detected.
since for fuzzy versionwehavefoursub categories weconsideredoneofeachsubcategory missingversion onlymajorversion anyminorversion andanyupperversion ifpresent.asresult weobtainedasample that consists of issues and achieves an error margin of settingaconfidencelevelof95 andapercentageof50 .then similarlytowhatwasdoneinrq eachissuewasindependently validatedbytwo authors.aftereachannotator concludedthetagging wemeasuredthecohen skappainter rateragreement k .
weobtained k .
i.e.
ahighagreement thereforenore coding wasnecessary.finally thetwoannotatorsdiscussedandsolvedthe disagreementcases.toaddressrq wereporttheoverallprecision ofcd linter on the validated sample defined as tp tp fp wheretp true positives and fp false positives.
we also computed the recall defined as tp ttp ttp total true positives using a randomly selected sample of projects methodology similar to gallaba et al.
making sure that those projects were not the same usedto calculatethe precision.
.
measurementofcdsmell occurrences to address rq we runcd linter on the latest snapshot of the 312projectsdescribedinsection .
.theanalysishasbeenperformed on an intel xeon r cpu e5 with .50ghz cores with 4gb of available main memory and took a total of seconds.
we report the number of cd smells of different types we detected aswellasthepercentageofprojectsandownersaffectedbyatleast onecdsmellofeachtype.thelatterprovidesuswithanideaof the diffuseness ofthe consideredcd smells.
empiricalstudyresults in this section we will answer the three research questions and report onthe results ofthe study definedinsection .
figure reactionsto the opened issues over6 months .
arethecdsmells detectedby cd linter relevant to developers?
duringtheobservationperiodof6months 64projectsreactedto our issues response rate of figure 4illustrates the reactions.
overall of the project maintainers reacted positively to our issues acknowledged thepresence ofa problem andare about to solve it and fixed the reported cd smells.
we have also verified that the fixes were not reverted later and could not find casesinwhichthe reportedcd smellswere re introduced.
developers took on average days to fix a cd smell with a maximum of .
months and a minimum period of hour.
this highvariationisunsurprisingforopen sourceprojectsbecausethe activity level or the commitment of contributors strongly depends on each project.
the mean resolution time for different kinds of smellswas31daysforfakesuccess 55daysforretryfailure days for manualexecution and65 days for fuzzy version.
looking at the negative cases of the issues were closed withoutreactions i.e.
ignoredissues and32 wererejected.several projectmaintainersthatrejectedissuesprovideduswithreasons whytheywanttokeepthecdsmell.wefoundothercasesinwhich developersrejectedourissuessimplybecauseofalackoftrustin automatedissue reportingtools.inthefollowing wedescribethe reactions to each cd smell type see figure the feedback we received when the issues were rejected and how we refined our detectionstrategiesbasedontheanalyzedcomments.wealsoreport the percentage of false positives that we found during the assessment stage.
fake success.
we found onlyone false positive case and opened issues that report fake success cases achieving a response rate of70 .noissueswereignored ofthemwereaccepted andthe cd smell was removed in of the projects.
opened issues of the total were instead rejected by the project maintainers.
in severalcases developersgenerallyagreedonourreportedviolation but decided to acceptthecdsmell nevertheless.
somedevelopers prefer that non essential jobs may fail for example checks for outdateddependencies executionofstaticanalysistools orexternal toolswhichmightfailforunknownreasons.otherdevelopersallowjobs thatarenotfullyimplementedyetand thus shouldnot impactthefinalbuildstatus tofail.theseprojectstypicallystate that they plan to remove the cd smell when the pipeline design iscompleted.anotherdeveloper whileagreeingontheviolation configurationsmellsin continuous delivery pipelines esec fse november8 13 virtualevent usa did not fix the cd smell because allow failure true is recommended for certain jobs that run static and dynamic application securitytests providedby gitlab.itisnolonger necessarytouse thisconfigurationflagexplicitly ithasbeenmovedtoatemplate andwillbeusedimplicitlythroughinheritance butoldtutorials still describe it as a best practice.
while failing the overall build because of warnings raised by static analysis tools or errors in externaltoolsisakeycdprinciple wecompletelyagreethat projects should follow configuration recommendations of their cd provider.
cd linter recognizes these cases and does not report them.
retry failure.
we found false positives for retry failure issues whichcorrespondsto16.
ofthevalidatedsample.wereported theremaining19smellswithareturnrateof58 thelowestrate among all cd smell types .
of the maintainers confirmed the existenceoftheproblemand55 removedthecdsmellfromthe configurationoftheirprojects.only4issues wererejected.
this cd smell seems to be introduced to hide flakiness instead of solving it thus we decided to not modify our detection strategy.
one developer mentioned that she deploys her application to a remote service that is randomly failing.
because the tool is out ofhercontrol shedecidedtoautomaticallyretrythejobmultiple timeshopingthatitwillsucceedwithoutbreakingtheoverallbuild.
manualexecution.
manualexecutionisthe category wherewe found the largest percentage of false positives .
due to some periodic deployment jobs that cd linter did not recognize.
we opened issues and achieved a response rate of .
while of thereportedcdsmellswereacceptedand38 werefixed were ignored.only2issues wererejected.inbothcases developers agreed on the importance of detecting this cd smell but they also providedreasons forrejecting it.
oneof themset when manual in a job executed in a stage that is not fully integrated yet with the restofthepipeline.thiscanbeaddressedbyallowingdevelopers todirectlyconfigure cd linter andignorejobsthatarenotpart of the cd pipeline.
the other developer rejected the issue because of a lack of trust in an automated reporting tool.
while this can be a threat to the study it does not constitute a problem in a usage scenario where developers use the toolthemselves.
fuzzyversion.
weonlyfound3fuzzyversionfalse positiveinstances andwecouldopen24issuesachievingthehighestresponse rate among all cd smell types.
of the reported cd smells wereacceptedand48 fixed.whilewecannotlearnfromthe9 of the issues that were ignored we used the comments from the remaining28 rejectedissuestorefineourdetectionstrategy.most complaintsconcernthereportsabouttoolsforwhichtheversion is left unspecified.
in contrast to libraries tools that are invoked in the pipeline e.g.
tools that compute code coverage should always beupdatedtothelatestversion especiallybecausetheymightcontainsecurityimprovements.furthermore toolsaredependencies oftheprojectratherthanofthesourcecode.thus inthecaseof uncontrolledupdates suchtoolswouldnotaffecttheoutcomeof the build nor introduce errors so we decided to incorporate this feedbackandexclude toolsfrom the detection offuzzy version.table detection precision forthe four cdsmells cd smell type tp fp precision fuzzy version .
fake success .
manual execution .
retry failure .
overall .
table detection precision forthe fuzzy versionsubtypes type tp fp precision missingversion .
any upperversion .
onlymajor version .
any minor version .
rq1summary wereceivedreactionsfrom74 oftheprojects.
of the project maintainers reacted positively to our issues either accepting or fixing the reported cd smells.
in therejectedissues wereceivedprecioussuggestionsonhowto improvecd linter whichweincorporatedwheneverpossible.
.
howaccurate is cd linter ?
table2reports thedetectionprecisionof cd linter .asthetable shows the detection precision varies between of manualexecution and of retry failure and fakesuccess withan81 for fuzzyversion.lookingattheresultsofdifferentfuzzyversionsubtypes table 3indicatesthatthedetectionprecisionisthelowest forthemissingversioncategory which however isthemost common one.
instead when a version is not fully specified i.e.
anyupperversion onlymajorversion oranyminorversioncd smell the cd linter accuracyraisesto orabove.
in the following we discuss false positives.
as shown in table wefoundnofalsepositivesforretryfailureandfakesuccess.note thatthisdoesnotmeanthat cd linter wouldalwaysbecorrect in such cases because developers might use these options for a specific valid purpose.
for manual execution false positives were mostly related to cases where the job name content or even comments added to the .gitlab ci.yml filesuggestedthatthejobisrelatedtoadeployment activity that developers intentionally perform periodically andthereforemanuallytrigger e.g.
issuingarelease .despitefiltering out jobs relatedto deployment as explainedin section .
we stillencounteredunforeseen cases.examplesincludeajobnamed test prerelase the typo in the job name made our filtering fail butalsoajobnamed push whichwaspushing dockerimagesto arepository thiscasemayormaynotbefullyautomated .also the names of several jobs with the whenparameter set to manual suggest that they should not be manually triggered.
however both theimplementationandacommentleftthereindicatethatdevelopers intentionally configured a manual job.
future work could improvecd linter byusingnaturallanguageprocessing nlp esec fse november8 13 virtualevent usa carmine vassallo sebastian proksch annajancso harald c.gall andmassimiliano di penta techniques to analyze comments in cd configuration files to infer the rationaleofchoicesmadebydevelopers.
false positivesoffuzzy version mostlyrelateto casesinwhich dependenciesforpipeline relatedtoolswerelackingaversionnumber.as aconsequenceofthe preliminary analysisconductedwith developers in rq we argue that libraries used in production code should specify an exact version of a dependency to avoid build failures or introducing bugs.
however this may not be strictly necessary for tools because developers may want to always use the latest version that have fixed bugs and enhanced features.
we have derived an initial list of such tools after the feedback from developers and exclude tools like coala rule based linter sphinx documentation generation and wheel packagingutility .
we estimated the recall of cd linter on a sample of randomly selected projects.
two authors individually inspected the configuration files and agreed on the presence of cd smells.
weapplied cd linter tothesamesampleandcoulddetect85of the manually identified incidents achieving a recall of .
false negatives were fuzzy version smells.
two of them were not occurring inscriptlines while the other affected a requirements.pip file a configuration file that is not considered by our tool.
the remaining 2false negatives weremanualexecutionsmells.those smells were not detected by our tool because their names contain deploy related keywords.
however they were executed in the stages metrics andbuild unit test .
section3.4established name based inclusion exclusion criteria through inspecting a sampleofprojects butitisnotfeasibletoderiveasimpleheuristicthat can cover all cases.we believe thatfuture iterations of cd linter canremovethesefalsenegativesbyconsideringotherfeaturesof the.gitlab ci.yml e.g.
non script lines in jobs or other files that are currently not supported and by enabling developers to configuretheirinclusion exclusioncriteriaforjobandstagenames.
rq2summary cd linter hasaprecisionof87 andarecall of with a perfect precision for retry failure and fake success.
the false positives for manual execution and fuzzy version were caused by the current limitations of the tooling andcan be addressedinthe future.
.
howfrequentaretheinvestigated cd smells in practice?
to understand the frequency of cd smells in practice we analyzed the latest snapshot of projects as described in section .
.
amongthem 863projectsareeitherwrittenin java andbuiltwith maven orinpythonand therefore qualifyfor ananalysisofthe existence of cd smells in the wild including fuzzy version which is the only language specific smell.
note that of the initially consideredprojectswerethendeletedandwerenotavailablefor our analysis.
table4illustratestheoccurrenceofcdsmellsintheanalyzed projects.wedetected2 874instancesofcdsmellsthataffect13 of the projects of the investigated owners .
fuzzy version is the most common cd smell .
and is present in .
of theanalyzedprojects.fakesuccessandretryfailureaccountfor and .
of the identified cd smells respectively.
while fake success occurs in .
ofthe projects retry failure is present intable cdsmellsinprojectsand owners is numberof and is percentage of the analyzable instances projects owners smell occurrences fuzzy version .
.
.
fake success .
.
.
retry failure .
.
.
manual execution .
.
.
overall .
.
table cdsmellsacross different .gitlab ci.yml sizes staysfor numberof and is the percentage respect to the total .gitlab ci.yml size small medium long smell fuzzy version .
.
.
fake success .
.
.
retry failure .
.
.
manual execution .
.
.
overall .
.
.
projects .
.
.
.
of them.
.
of the cd smells were manual execution and affected69 projects .
of the total .
humbleandfarleyadvocatethatacdpipelineshouldbecomposed of at least three separate stages i.e.
compile test and deploy .however organizations cancall those stages differently introduce additional stages and they can define multiple jobs within one stage.
this begs the question of whether more complex pipelines are also more prone to contain cd smells which wouldmakeatoollike cd linter evenmorerelevant.aqualitative insight from our manualanalysis of section .2indicated that longer.gitlab ci.yml files seem to contain more complex cd pipeline definitions.
we decided to split the analysis and discuss the differentsubgroupsseparately.
wedistinguishthreegroups small medium andlong anddefine thesecategoriesthroughthefirstandthirdquartileoverthelength distribution of all .gitlab ci.yml files.
small .gitlab ci.yml files have up to lines .
of the smelly projects have them while a long .gitlab ci.yml file is of at least lines .
of the files with cd smells are long .
the other projects .
are medium.intable weillustratehowcdsmellinstancesarespread acrossthedifferentclustersanditisimmediatelyclearthattheclusteroflong .gitlab ci.yml filescontainsmostofthecdsmells.
theclusterwithsmall .gitlab ci.yml filesincludes7.
ofthe detectedcdsmells with .
ofthe totalfuzzy version smells .
of the manual execution incidents and a few of the other cd smell types.
projects with medium .gitlab ci.yml sizes contain .
of the fuzzy version smells around of the fakeconfigurationsmellsin continuous delivery pipelines esec fse november8 13 virtualevent usa table break downoffuzzy versionsmell yaml is .gitlab ci.yml pom ispom.xml req isrequirements.txt filetype category yaml pom req total missingversion .
.
.
onlymajor version .
.
.
any minor version .
.
any upperversion .
.
.
overall .
.
.
files .
.
.
success and manual execution problems and of retry failure achieving smells .
of the total .
the last cluster with long.gitlab ci.yml files contains the majority of the identify cd smells .
.
.
of the fake success smells .
of manualexecution incidents andeven .
of the retryfailure affect this cluster.
more than half of the fuzzy version instances affect long.gitlab ci.yml files.
within this cluster we find that oftheprojectshavefuzzyversionsmells havefakesuccess incidents are affected by retry failure and contain manual execution.overall oftheprojectsareaffectedbyatleastone cdsmell.whileallothercdsmellshavemoreoccurrencesthan fuzzyversion thedensityoffuzzyversion inlongfiles is similar to the densityinthe wholedataset see table .
beingthemostcommonsmell wefurtheranalyzedfuzzyversion and investigated its sub categories concerning the different filesthatitcanaffect .overall thefuzzyversionincidents are mainly detected in requirements.txt files.
those files were affected by allany minor version and almostall any upper version that we found while only major version is also present in severalpom.xmlfiles.missingversionisthemostfrequentfuzzy versionsmell anditisspreadacrossthedifferentfiles.while .gitlab ci.yml hasthehighestnumberofmissingversionoccurrences .
of the total this fuzzy version type has and instancesin requirements.txt andpom.xmlrespectively.based on these results fuzzy version very frequently affect files different from .gitlab ci.yml .
thus also cd pipelines that are not so complex i.e.
small .gitlab ci.yml can contain several fuzzy version incidents which explains why this cd smell is not only concentratedinlongconfigurationfiles .
rq3summary the most frequent cd smell is the fuzzy version .
oftheinstances .overall cdsmellsaffect13 of the analyzed projects and of the owners mainly occurring inlongconfigurationfiles.
threats to validity threats to construct validity are related to possible imprecisions in ourmeasurements.theycanbemainlyrelatedtopossiblemistakes inthecd linter simplementation beyondwhatwecoulddiscover bytestingit.theextensivemanualevaluationperformedinrq mitigates this threat.
in addition the results of rq as well as thefeedback provided by developers rq gave us indications on how to makecd linter more accurate.
threatsto internalvalidity concernfactors internaltoourevaluation that could influence the results.
one threat is the subjectivenessof the manual validationof detectedsmells in rq precision andrecall .tolimitthisthreat weemployedtwoevaluators which discussed and resolved the cases of disagreement.
also for the coding of comments that developers posted on opened issues rq having two coders limited the subjectiveness of the results.
the reactions we got in rq 1and the results of rq 3may depend on thecharacteristicsoftheanalyzedprojects.inparticular projects withdifferentdegreesofmaturitymayadoptcdpipelinesofdifferentcomplexity andmayormaynotadheretocdprinciplesand goodpractices.wehavemitigatedthisthreatthroughtheproject selection criteriaillustratedinsection .
.
threatsto externalvalidity concernthegeneralizationofourfindings.
while we are aware that gitlabis not as popular as github itsadoptionandnumberofrepositoriesareincreasing.asexplained in section .
gitlabgives the advantage of analyzing projects using the same cd infrastructure.
besides considering a sample though relatively large of projects our evaluation is limited to gitlabconfigurationfiles mavenbuilds and pythondependencies.
however thedetection principles explainedinsection 3can be appliedto other pieces oftechnology and the underlying conceptswouldnotchange.inthispaper ourpurposewastostudythe reaction of developers to the detection of cd smells rather than copingwithany possible technology.
discussion the empirical evaluation of cd linter especially the developers feedbackcollectedinrq allowedustodistillusefullessons learned and formulate implications for future research in this area.
lintersarefastandcansupportthepipelinedefinition.
undoubtedly a paramount advantage of linters is that they are fast and that they can already be applied in early development phases.
our experimentshaveshownthat cd linter cananalyzeconfiguration filesfromthousandsofprojectsintheorderofseconds.manyof the contacted developers have acknowledged and often fixed cd smells that we have pointed out in their projects.
we can conclude that using linters to support the pipeline definition and to catch smellsearly onis indeed apromisingresearch direction.
issuereportingisuseful butitmustbecarefullydosed.
oneproblem we encountered in our empirical evaluation is that some developers are irritated by and tend to discard automatically posted issues.
while we tried to elaborate on the opened issues that these weretheresultofamanualreviewprocess somedevelopersstill consideredourissuesasortofspam evenwhenthesuggestionwas meaningful.relatedresearchshowspromisingresultswhenbots areusedtoaidsoftwareengineers butwefoundthatdevelopers seem to be sensitive in the context of issue trackers.
despite somenegativereactions oureffortsweregenerallywell received by developers though.
to mitigate the negative effect described above one author followed up on all comments on the opened issues to explain the purpose of cd linter justify the opened issue and most importantly show that there was a human in theesec fse november8 13 virtualevent usa carmine vassallo sebastian proksch annajancso harald c.gall andmassimiliano di penta loop.
overall involving open source developers in our research was valuable for both sides but it was crucial to take the time and talk to developersto show respectandemphasize the importance ofthe research.
lintersareintrinsicallyimprecise.
acommonissueoflintersis their intrinsic imprecision.
not every deviation from an advocated principle is a smell and often a violation can only be assessed when the specific context is being considered.
such decisions have to be taken on a case by case basis for a project and go beyond the scopeofstaticanalysistools.thisphenomenonisnotspecificto cd linter though lowprecisionofstaticanalysistoolshasalready beenreportedasanadoptionbarriermultipletimes .in our case cd linter seems to balance precision and recall well.
despitemanyrejectedsmellreports thenumberoffixedreports and the generally positive feedback that we have received from developersindicatethatdevelopersappreciatetheeffortandthat toolslike cd linter can have apositive effectoncd practices.
long and complex cd configurations are often smelly.
while we find relatively few instances of the cd smells in simple configuration files the density increases with the length and complexity .
one explanation could be that developers have to cope with phenomena such as flakiness the need for manual job triggers acceptingfailuresfromsomejobs orspecialrequirementsfor dependency management.
for such reasons we expect cd linter to be particularlybeneficialfor projectswithacomplex pipeline.
findings should be reported quickly.
one of our lessons learned from rq 1was that identified issues need to be reported timely otherwisetheissuemaydisappearornotbevalid.insomecases the cd smell was resolved already by the time we were done with validating it so the reported issues were unnecessary.
generally timely reportingis essential in case of issues that involve line numbers because these are fragile due to frequent source code changes and can be soon outdated.
in these cases it might be helpful not to link to the latest version in the repository but to the exact commit that has been analyzedfor the issue.
overall thispapershowsapromisingfutureforlintersofci cd pipelines.futurelinterscanextendtheideasinseveralways for example not only considering dependency versions but also other versionedentitiesinthebuildconfiguration likebuildpluginsor containerimages inwhichthebuildisrun.theresultsinthispaper emphasizethe needfor more researchonlinters inthis domain.
related work thissectiondescribesrelatedworkaboutbadpracticesandtheir identification inci cdandinfrastructure as code scripts.
.
bad practices in ci cd in their landmark books about ci and cd previous researchers outlined wrong decisions while applying ci cd.
the lack of build automation and project visibility together with the inability to create deployable software are a few examples of those practicesthatpreventorganizationsfromachievingtheexpected benefits.
duvall collected these and other bad practices in a catalog of anti patterns and their corresponding patterns thatoccur during several steps of a ci cd pipeline .
zampetti et al.
empirically characterized ci bad practices finding commonalities but also differences with the ones advocated by duvall .
anti patternsalsooccurbecausedevelopersfaceseveralbarriers when adopting ci cd .
for instance developers need to debug failures occurring ona remoteserver andmaintain complex build infrastructures.
the catalogs of anti patterns and the studies discussed above constitutethefoundationsofourwork asweusethemtoderive principlesfor which cd linter detectssmells.
.
detectionofsmells in development workflows several researchers have proposed approaches to automate the identification and in some cases the removal of problems arising inbuildand more ingeneral infrastructure as code iac scripts.
gallabaetal.
developedanapproachfordetectingandeliminating misuses such as the presence of unused properties and bypassed security checks in travis ci build scripts.
while we also statically analyze configuration files our approach detects those anti patternsthat are violations of ci cdprinciples.
deviationsfromsuchprincipleshavebeenalsoinvestigatedby vassallo et al.
.
they proposed ci odor a tool that analyzes artifacts produced during ci such as logs and revisions to detect anti patterns e.g.
builds become slow developers work on feature branchesforalongerperiod thatoccurovertimeandcauseaci decay.
differently from this work we focus on the anti patterns that can be staticallydetectedinconfigurationfiles.
troubleshooting build failures is challenging and often causes delaysinthedeliveryprocess.apreviouswork hasproposeda taxonomy of build failures based on their root causes.
researchers haveimplementedsolutionsthatautomaticallyrepairsomeofthese build failure types .
another tool improves the understandability of build failures through log summarization.
despitethoseapproaches developersstillallowfailures .this strengthensourmotivationforincludingfakesuccessinourlinter.
finally otherrelatedworksaredevotedtothedetectionofsmells iniacscripts.sharmaetal.
leveragedbestpracticesassociated withcodequalitymanagementtoassessconfigurationcodequality and derived a catalog of configuration smells for iac scripts developed inpuppet.
while those smells are more similar to traditional codesmells i.e.
theyconcernwithmaintainabilityandunderstandability of puppetcode cd linter detects smells specific to the ci cd configuration where developers violate principles.
rahman et al.
implemented a linter that detects seven types of security problems in iac scripts.
their work is complementary to ours as it dealswithaveryspecificcategoryofproblemsrelatedtoiacscripts.
manyoftheirsecurity smellscan alsooccur inci cdpipelines.
summary previous work has introduced generic or specialized lintersthatcanhelpdeveloperstoimprovetheircdconfigurations.
incontrasttopreviousworkoncismellsthatreliesonhistorical information in this paper we proposed cd linter a static analysistoolabletoidentifyfourtypesofcdsmellsincdpipelines right when they are introduced inthe pipeline configuration.
ourconfigurationsmellsin continuous delivery pipelines esec fse november8 13 virtualevent usa empiricalevaluationhasshownthatthesupportedcdsmellsare relevantinpractice that cd linter isaccurate andthatthesupported smells frequently occur in the wild.
linters generally suffer from many false positives sometimes up to and more butcd linter reaches a precision of and recall of which represent acceptable results and a good compromise.
in a large set of 312projects we foundthat ofpipelines with longconfiguration files are affected by at least one instance of the detected smells.
the empirical evaluation of cd linter and the developers feedbackthatwehavereceivedforrq 1illustratedtheusefulnessof cd linter andallowed ustodistill usefulinsightsthat canfoster the adoption of cd linter in practice and stimulate research on similar toolsto further advancethis area.