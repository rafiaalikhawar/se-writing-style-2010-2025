jsisolate lightweight in browser javascriptisolation mingxue zhang chinese universityof hong kong hong kong sar china mxzhang cse.cuhk.edu.hkwei meng chinese universityof hong kong hong kong sar china wei cse.cuhk.edu.hk abstract modern web applications commonly include third party scripts from external hosts.
while enabling code reuse and enhancing the functionalities the reliability of client side javascript code can be impairedbytheinclusionofotherscripts.sinceallscriptsrunin the sameexecution environmentinthebrowser executingthem all together may cause unexpected effects.
for example global variables with the same name might be defined by multiple scripts causing the actual valueto be unpredictable.
inthispaper wedesignalightweightbrowser basedframework jsisolate thatprovidesanisolatedandreliablejavascriptexecutionenvironment.
jsisolate injectsscriptsintodifferentisolated environments based on their dependency relationship.
in this way itexecutesscriptswithindependentfunctionalitiesindifferentcontexts effectively preventing them from interfering with each other.
we further evaluated the compatibility and performance overhead ofjsisolate on alexa top 1k websites and showed that it can efficiently isolate scripts whilepreservingthe functionalities.
ccs concepts software and its engineering software organization and properties software reliability .
keywords javascript scriptisolation webbrowser acmreference format mingxue zhang and wei meng.
.
jsisolate lightweight in browser javascript isolation.
in proceedings of the 29th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse august 23 28 athens greece.
acm new york ny usa 12pages.
introduction itis acommonpracticein developingwebapplicationsto include scriptsfromdifferenthosts.arecentstudyofalexatop75kwebsites shows that external scripts are prevalent with a median numberof9andthemaximumnumberof202persite .over90 of thewebsitesincludeatleastoneexternalscript.includingscripts permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
esec fse august 23 28 athens greece associationfor computing machinery.
acm isbn ... .
jquery script to facilitate domtraversingandmanipulation.
unfortunately including multiple external scripts together may causeundesiredeffects.inthebrowser allthescriptsinthesame frame e.g.
the main frame run in a shared environment.
this meansanyscriptcaninterferewiththeexecutionofotherscripts inthesameframe.existingworkshaverevealedthatnameconflicts couldexistbetweenjavascriptlibrariesandanynormalscripts and areprevalentontheweb .builtinmethodsandproperties couldalsobeoverridenandaffectthedefaultbehaviorsofallscripts .meanwhile somesensitivedatacouldbestoredattheclientside andcanbeaccessedandmodifiedbyanyincludedscript.executing scriptsfromdifferentpartiesinthesamecontextcouldsignificantly affectthe functionalities hence the reliabilityof webapplications.
priorworkshaveinvestigatedtheproblemofprotectingjavascript codeintegritybyisolatingthenamespace i.e.
executionenvironment of scripts.
in the authors sandboxed untrustedthird party scripts iniframes preventingthemfromaccessingobjectsinthemainframe.however astheiframesuseaseparate dom from the embedding page special care must be taken to handletherenderingofcontentsgeneratedbythesandboxedscripts.
also the events from the embedding page must be specifically forwarded to the iframes.
they therefore introduced a high latency in page rendering.
another branch of research works emulated an isolated execution environment by restricting the accesses to objects defined by first party scripts from untrusted scripts .
theyrely on aruntimeaccess monitor which incurs asignificant overheadonthe basic operations like function invocation.
inthispaper weaimtodesignalightweightmechanismthatprovides an isolated javascript execution environment in the browser topreventfunctionalityinterferenceinmashups.wefacethefollowing challenges.
first scripts included on the same page may be functionally dependent.
we need to carefully determine the executionenvironmentforeachscripttomaintainthefunctionalities.second javascript codecan be dynamically included invarious ways forexample throughjavascripturls eval orasynchronously invoked as event listeners.
the event listeners and javascript urls canbedefinedasattributesofdomelements whichcanalsobe dynamicallymodifiedbyjavascript.itisnon trivialtocaptureall thedynamicallyincludedscriptsandisolatetheminanappropriate environment.
finally in order to make our scheme deployable and practical weneedtominimizetheperformanceoverheadandthe requiredmodificationto applications whichischallenging.
toovercometheabovechallenges wedevelop jsisolate alightweight browser based isolated javascript execution framework for improving script reliabilities.
it operates in two modes a dynamic script dependencyanalysis mode anda policyenforcementmode 193esec fse august athens greece mingxue zhang andweimeng that separatesjavascriptin isolated executionenvironments contexts to providehigher reliability.
inthefirstmode jsisolate analyzesthedependencyrelationshipbetweenscripts.itfirstusesanopen sourcedomainrelationshiplistasthegroundtruthofscriptdependencies.itthendynamicallymediatesallscriptaccessestojavascriptobjectstoinferthe dependency between scripts not on the list.
based on the dependency analysis it automatically generates policies that specify the execution context for each statically included third party script.it alsogeneratesauxiliaryinformationtohelpthedevelopersvalidate theisolationpolicies.
jsisolate cangeneratetwotypesofisolation policies domain levelpolicies wherescriptsofthesamedomain areassignedthesamecontextforeasymanagement andurl level policies whereeachscriptidentifiedbyitsurlisassignedacontext for fine grainedisolation.
inthesecondmode foreachgroupoffunctionality dependent scripts jsisolate spawns an isolated execution environment the isolated world which has been used to confine content scripts of browser extensions.
it also tracks the dynamic inclusion of javascript code toidentify the initiator scriptof each dynamically includedscript which would be executed in the same context as theinitiatorscript.thisprevents anisolatedscriptfromescaping its execution environment by dynamically injecting new scripts.
the isolation is seamlessly and securely performed without the overheadofinterceptingeachjsobjectaccess.
weimplementedaprototypeof jsisolate basedonthechromium browserversion71 andtesteditonalexatop1kwebsites.wewill release the prototype as an open source software.
we demonstrate withrealworldandsyntheticexamplesthat jsisolate isabletoseparate functionality independent javascript code.
we further show jsisolate canisolatescriptswhilepreservingtheintendedfunctionalities of real world websites using url level resp.
domain level policies script isolation caused exceptions on resp.
out of the top websites.
jsisolate also introduces limited performance overhead.usingurl levelpolicies weobserveda1.
average increaseinmemoryconsumptionanda7.
averageslowdownon page loading.
when using domain level policies the average memoryandpageloadingoverheadis1.
and6.
respectively.the results show that jsisolate caneffectively andefficiently provide a reliable executionenvironment for client sidejavascript.
in summary we make the following contributions.
we design and develop jsisolate a light weight isolated javascriptexecutionframeworkforimprovingthereliability ofclient sidejavascript.
we systematicallyanalyzethe dependency relationshipbetween scripts on the alexa top 1k websites.
the analysis results show the feasibility of isolating scripts in separate executionenvironments.
we evaluatetheeffectiveness compatibilityand theperformance overhead of jsisolate on real world websites and demonstratethe practicalityofour design.
overview inthissection wefirstintroducethebackgroundknowledge 2. we then describe the motivating examples of our design 2. and finally discuss the researchchallenges 2. .
main frame postmessage script a dom script b context 3context context script c script d dom 2figure asimplified browser architecture.
.
background javascript execution environment in the browser.
the highlevelarchitectureofawebbrowserisdepictedin figure1.inmodern webbrowsers abrowsingcontextiscreatedforeachopenedtab andcanbenestedusingiframes .eachframe themainframeor an iframe has its own window object and the cross window communicationisusuallyaccomplishedviathe postmessage interface.
the browsing context encloses theweb content to be displayed to theusers.italsoincludesajavascriptexecutionenvironment in whichjavascriptcodeis interpretedandexecutedonajavascript engine.scriptsincludedinthesameframeruninasingleexecution context.asa result a script can accessany globalobject defined byanotherscript that resides inthe same frame.
security policies in the browser.
the same origin policy sop specifiesthataframeinoneoriginshouldnotbeallowedto access the resources in a different origin which is recognized as a tuple of scheme e.g.
https host name e.g.
xyz.com and port number e.g.
.
it prevents cross frame script access but still permits intra frame script access or interference.
the cross origin resourcesharing cors relaxesthesopbyallowingarestricted setofresourcesfromoneorigintobeaccessedbyanotherorigin .itenablesthedeveloperstoembedcross originresources e.g.
imagesandvideos inamore flexibleway.
thecontentsecuritypolicy csp allowsdeveloperstospecify theoriginsofresourcesthatarepermittedtobeloadedonawebsite .
it is designed to mitigate the cross site scripting xss attacks and other content injection attacks.
however it has suffered from misconfiguration of developers and its static nature and therefore receivesonlyalowadoptionrateontheweb .comparedwith csp scriptisolation provides a more flexible approach tolimiting privilegesofscripts to interfere witheachother.
thesubresourceintegrity sri wasintroducedasaw3c recommendationtoprotectdataintegrityduringthenetworktransmission.
adevelopercan specifyan integrity attribute which is a cryptographic hash value with an external resource such as ascriptorastylesheet.thebrowser uponfetchingtheresource wouldthenvalidate thehash valueto ensure theresourcehasnot been tampered with.
however the sri cannot protect javascript objects from being overwritten by other scripts already running in the same frame.
.
motivating examples global identifier conflicts.
the use of a shared namespace grantsscripts the privilegeto redefine globalobjects i.e.
functions orvariables definedbyotherscripts.suchanoverwritecouldresult 194jsisolate lightweightin browser javascript isolation esec fse august athens greece ocanvas.js function a b c a.logs array window document aframe.js 5window.logs function e ... function client.js 8logs.push log runtime typeerror listing an example of conflicting variable definitions between javascript libraries.
a.js 2regexp.prototype.test function returntrue client.js 5if https?
i .test ... security check evaded listing2 pollutingjavascriptprototypetobypasssecurity checks.
indisruptivebehaviors consequentlyimpairingthereliabilityof web applications.
one such case is discussed in where two javascript libraries define window.logs with values of different types.asshownin listing1 whentheselibrariesareincludedin aspecificorder aruntimeexceptionwouldbethrownbecauseof inconsistent types.
similar examples are also presented in e.g.
theglobalfunction addhtml isdefineddifferentlybytwoscripts whichcauses differenthtmlcontentsto be injected.
prototype poisoning attacks.
each javascript object has an associated prototype object from which it inherits its properties andmethods.javascriptprototypeallowsdeveloperstoeasilydefine properties and methods on all the objects initiated from the same constructor.
however it can also be overwritten and cause undesired effects.
one such vulnerability was reported on myvidoop which is a bookmarklet based password manager .
as shown in listing myvidoop uses a simple regular expression https?
i tocheckifaurlstartswith http or https .however the regular expression is evaluated at the client side and therefore is subject to prototype poisoning attacks.
once the native function regexp.prototype.test isoverridenasshown thesecurity checkwould bebypassedand makethe bookmarkletsusceptible to xss attacks.
this demonstrates the unexpected interference between first party and third party code makes it hard for web applicationsto reliably perform the intendedfunctionalities.
therootcauseoftheaboveproblemsistheuseofasinglecontext i.e.
namespace in the browser.
any not necessarily malicious scriptcanpotentiallyinterferewiththeexecutionofallotherscripts executedinthesamecontext.thisindicatestheneedofanisolation mechanism that runs scripts with independent functionalities in separatecontexts suchthatscriptscannotinterferewiththeobjects andcode inthe otherexecutionenvironments.
.
research challenges we face the following challenges inisolating client sidescripts.
context assignment.
scripts included in the same frame usually depend on each other to accomplish their tasks.
for example a script may call jquery methods to facilitate dom manipulation and event handling.
it is non trivial to determine the context in whichascriptshouldbeexecuted.separatingscriptsdependingon eachotherwouldbreakthefunctionalityofawebsite.inparticular some scripts e.g.
library scripts might be required for multiple analysis script a write foo script b read bar script foo script script if bar ... script global context script foo script context script a context script b context domain relationship list context script if bar ... script figure overview ofjsisolate.
functionalities.we need a way toprecisely assignscriptstoappropriatecontexts.further javascriptcodecanbedynamicallyloaded.
itisinsufficientto staticallydeterminethe contextfor eachscript.
coverage.
there are many ways to execute javascript code in the browser.
except for the inline and external scripts included via script tags javascript code can also be loaded through javascript urls inline event handlers and the eval function etc.for example when a user clicks on an anchor element a src javascript alert clicked themethod window.alert will be invoked.
in order to capture and isolate all the code executed inthebrowser weneedtocoveralltheabovecases whichisdifficult.javascripturlscanbedefinedwithvarioustypesofdom elements whichcould alsobedynamicallycreatedbyotherscripts.
similarly the inline event handlers can be registered and modifiedbymultiplescripts.therefore weneedtopreciselytrackthe creation andmodificationof any javascript code.
deployability.
many existing works e.g.
sandbox scripts in iframes to provide an isolated execution environment.
thesemechanismsrequiremanymodificationstotheoriginalpage andextraeffortsmustbemadetohandlethecross frameinteraction especiallyoneventforwardingandcontentrendering.weaimto developa system that requiresminimal changeson theweb pages and minimizes the performance overhead to lower the deployment difficulty whichischallenging.
design and methodology in this section we present jsisolate a browser based framework that isolates scripts in separate execution contexts.
we consider in our design two execution contexts a first party context for scripts serving first party functionalities and a third party context for scriptsprovidingotherindependentfunctionalities.nevertheless morecontextscanbecreatedforprovidingafiner grainedisolation mechanismwhenfeasible.weassumethatscriptsfromdifferent entities are not related and shall be separated.
the overview of jsisolate isdepictedin figure .
jsisolate determines the execution contexts of scripts based ontheirdependencyrelationship.
adomainrelationshiplist that groupsdomainsbelongingtothesameentity isusedastheground 195esec fse august athens greece mingxue zhang andweimeng truth.
it is maintained by disconnect which is a tracker blockingapplication.for instance facebook.com andfb.meare bothin group facebook .
jsisolate considers two situations when handling context assignment for a script.
first both the script domain andthewebsitedomainareonthislist.ifthescriptandthewebsite are in the same group it is executed in the first party context else if it is statically included it is isolated in the third party context to prevent cross entity interference otherwise it is assigned to the context of its initiator script.
second the website script domain is not on the list i.e.
the ground truth is unavailable.
jsisolate analyzes the object dependency between a statically included thirdparty script with the first party scripts and assigns the context accordingly andexecutesa dynamicallyincluded third partyscript in the same context as the initiator script.
with such a strategy jsisolate allows the dependent scripts including the dynamically loaded ones to function correctly while prohibiting cross context interference throughdynamicscript inclusion.
in the following we describe our design using the chromium browserasanexample.specifically weshowhow jsisolate records javascriptobjectaccessestoanalyzedependency 3. andhow it tracksthe dynamic inclusion ofa script 3. .
we then describe ourmethodologytogeneratetheisolationpolicies 3.
.finally wedemonstratehow jsisolate createsseparateexecutioncontexts basedonthe policies 3. .
.
recording javascriptobject accesses readingandwritingobjects i.e.
functionsandvariables defined in each otheris the most explicit evidence of the dependency relationship between scripts.
for instance a script relying on a cookiemanagementlibrary scripttoadd removecookies wouldusually call i.e.
read cookie related functions defined in the library script.
jsisolate aimstorecordanyaccesstotheobjectsdefinedbyany script to determinethe dependency relationship.
inthechromiumv8javascriptengine everyjavascriptobject is represented as an instance of the objectclass which could have multiple properties.
for instance a global function foois represented aswindow.foo which is a property of the windowobject.
therefore tointerceptall theaccessestoobjects jsisolate monitorsthegetterandsettermethodsofthe objectpropertiesinv8 fromwhich itcan get the names of objects and properties being accessed.however variablesofnon primitivetypearecopied passed byreferenceinjavascript thusscriptsdonotnecessarilyneedto accessanobjectusingthesamename.forexample objy objx makes variableobjyan alias of object objx and any script can thereafteraccess objxviaobjy.in particular the keyword thisin javascript points to different objects when used in different scopes.
forexample whenaccessedinanobjectmethod thisreferstothe owner object and when used in a normal function scope it points to the global object window.jsisolate uses the memory address of the accessed object in v8 to uniquely identify an object.
as long as an identifier points to the same object the memory address will be the same regardless ofthe variable name being used.
for each write operation to an object property which is accomplishedbyinvokingthesettermethod jsisolate alsorecordsthe value to be assigned to the property.
once an access to an object isintercepted itfurtherinspectsthecurrentjavascriptcallstackto locate the bottom script as the script that initiates the access.
jsisolate recordsthescriptid ofascriptasitsuniqueidentifier.
note that the declaration of a global function or variable is also representedasawriteoperationtotheglobalobject window.therefore jsisolate is able to capture all the declarations and write operations to the objects that might be referenced by other scripts.
forread operations however jsisolate recordsthe readtoobjects but not the read to their named properties.
we make this design choice to mitigate the prototype poisoning attacks.
if a script overwrites a prototype object e.g.
by adding new properties oroverwritingbuiltinmethodsthatarelateraccessedbyanother script jsisolate does not record the read to the overwritten properties methods otherwise thetwoscriptswouldbeconsideredas dependent allowing the prototype to be poisoned.
for example whenowner.property isbeingreadbyscript a jsisolate onlylogs a read toowner.
this does not affect our ability in capturing object dependenciesbetweenscripts.wewilldemonstratethedetailswith our dependency analysisin 3. .
.
trackingdynamicscriptinclusion therearemanywaystoincludejavascriptcodeinawebpage.first ascriptcanbeloadedvia script tags eitherasaninline embeddedaspartofthehtmlcode oranexternal loadedfromanexternaljavascriptfile script.the script tagscanalsobedynamically created by other scripts via document.createelement script etc.second javascriptcodecanbedefinedasanattributeofadom element e.g.
asajavascripturloraneventhandler.inbothcases theattributecanbemodifiedbyjavascriptaftercreation.inaddition by callingeval a string will be executed as javascript code.
weneedtohandleallthepossiblecasesthatjavascriptcodecan be loadedinawebpage.
.
.
html script elements.
a script can create new script elements by calling apis like document.createelement script anddocument.write script src ... script or directly setting theouterhtml attribute of an existing element to replace it witha scriptelement.
alternatively a script canalso injectnew scripttagsviainnerhtml e.g.
byreplacingtheinnercontentofa div element with script ... script .
jsisolate monitorsalltheaboveapisinthebrowsertofindthe scriptthatcreatesascriptelement.eachtimesuchanapiiscalled jsisolate locatesthescriptthatinitiatestheapicallatthebottom javascriptcallstackframe andrecordsthecorresponding scriptid as its unique identifier.
jsisolate also intercepts any access to the outerhtml andinnerhtml attributestotrackthereplacementofexistingelements.the parentscriptid attribute thatisinitializedas null ofadynamicallycreatedscriptelementissetasthe scriptid of the initiator script.
in this way it can attribute the dynamic creation ofany script element to a specificscript.
thisallows us todifferentiatebetweenscriptelementscreateddynamicallyand thoseinsertedstaticallybydevelopers.
.
.
javascript urls.
in the browser javascript urls could be definedwithmultipletypesofdomelements.welistthetagnames andthecorrespondingattributesin table1.theseattributescan bestaticallydefinedbythewebdevelopers ordynamicallydefined and modified by scripts.
for example a script can modify the href 196jsisolate lightweightin browser javascript isolation esec fse august athens greece modifying on event attribute 2a.onclick function console.log clicked calling addeventlistener 5a.addeventlistener click function console.log clicked creating elements with an inline event listener 8document.write a onclick function ... a listing waysto register eventlisteners on an element.
attributeofananchorelementinvariousways.firstly ascriptsets thehrefattribute of an anchor element ato a javascript url by callinga.setattribute href javascript url .ascriptcan also assign a newvalue to hrefthrougha.href javascript url ora.attributes javascript url .
moreover a script candirectlycreateanewanchorelementwitha hrefattributein the same wayas itcreates script elements.
jsisolate hooks all the dom apis that could be used to modify theattributesin table1.specifically itassignsan nidattributeasa uniqueidtoeachdomelement.everytimeaninvocationtothese apisisintercepted itchecksiftheattributevalueisajavascript url.
if so it identifies the scriptid of the accessing script and updates a map from nidtoscriptid to keep track of the script thatlastmodifiesthecorrespondingattributeofadomelement.
the dynamiccreation ofelements in table 1are monitoredinthe same way as described in 3. .
.jsisolate specifically records the scriptid astheinitiator attributeofthesedomelements.when any of these elements is created jsisolate records thenidand initiator inthe mapif the attribute isajavascript url.
.
.3eval .injavascript eval isacommonlyusedfunction that evaluates the argument string as javascript code.
the code generated byeval is granted the same privilege as the caller function thus can also overwrite other scripts.
fortunately the code generated by eval is intrinsically executed in the same context as the caller script.
therefore a script cannot escape the contextassignedto itbygeneratingnewcode via eval .
.
.
javascripteventlisteners.
insteadofcalling eval andcreating modifying script tagsandjavascripturls ascriptcanalso registeraneventlisteneronanhtmlelementtointroducenew javascriptcode.
theeventlistener isa javascriptcodesnippetthat willbeexecutedwhenthecorrespondingeventisfired.specifically ascriptcanregisteraneventlistenerby modifyingtheon event attributes of a dom element calling the addeventlistener apitoaddanewevent listener or3 directly creatingan element with an inline event listener see listing .
fortunately jsisolate does not need to monitor javascript event listeners specifically becausetheyare registered in thesamejavascriptexecution environment as the scripts registertheminchromium.
.
generating isolationpolicies in this section we describe our method to determine the object dependency between scripts and generate script isolation policies according to the objectdependency.
.
.
objectdependency.
jsisolate identifiesdependentscripts based on the javascript object access logs.
there are four possibilities that twoscripts can read orwritethe same object.
readafterwrite raw onescriptwritesanobjectandanother script reads itafterwards.
readafter read rar one script reads an objectand another script alsoreads itafterwards.
writeafterwrite waw one script writesanobject and after that anotherscript alsowritesit.
write after read war one script reads an object and after that anotherscript writesit.
we consider a script depends on another if we detect a raw condition.
the rarandwarconditions however do not necessarily suggest direct object dependency although the scripts are alsoaccessingthesameobject.forexample supposescriptareads an object after script b reads it.
in this case both scripts directly depend on another script c that defines or declares that object.
further the wawconditionindicatesaconflictingwritethatcould impairthecodereliability.
jsisolate reportsanydetectedconflicts to the developers to help them adjust the generated script isolation policies when necessary.
recallthat jsisolate doesnotrecordreadstonamedobjectproperties which still allows it to capture all dependencies.
first when thereisa rawonanobject jsisolate cancapturethedependency asitrecordsallthereadsandwritestoobjects.second whenthere isarawonanamedproperty e.g.
areadsapropertywritten by b bothaandbhavetofirstlygetareferencetotheownerobject.
if the owner object is defined by b there is a rawon the owner object whereareadsb if the owner object is defined by another scriptc bothaandbwill be considered as dependent on cas they bothreadanobjectdefinedby c.inaprototypepoisoningattack however theprototypeobjectisnotexplicitlydefinedbyanyscript thus no dependency will be captured.
therefore the attack can be mitigatedas the poisonedprototype can be isolated.
.
.
context assignment.
to determine the context of a script we first classify scripts into three categories based onhow they are loadedinawebpage first partyscripts scriptsthatareincludedfromthefirst party domain includinginline scripts written bythe developer static third party scripts scripts that are statically included from athird partydomain dynamicthird partyscripts third partyscriptsthataredynamically includedbyanotherscript.
we assume that the first party scripts serve the first party functionalities.wedeterminethecontextofa staticthird partyscript based on the ground truth domain relationship list and whether its functionalityrelatestofirst partyfunctionalities.the staticthirdparty scripts can be further divided into three classes scripts loaded from domains belonging to the first party entity scripts thatreadorarereadby first partyscripts scriptsthatdonothave objectdependencywith first partyscripts .scriptsofthefirsttwo classes are functionality dependent with first party scripts and are putinthefirst partycontext.thedependencyis transitive therefore a third class script that has dependency with a script in the first two classes is also executed in the first party context.
the rest staticallyincludedscriptsshallbeexecutedinaseparatecontext as theirfunctionalities are independent from the first partyones.
a static third party script could intentionally read objects definedbyafirst partyscripttogetitswayintothefirst partycontext.
197esec fse august athens greece mingxue zhang andweimeng table dom attributes that could include javascript urls.
tagname attribute example invokecondition anchor href a href javascript alert anchor clicked a click area href area shape rect coords href javascript alert area clicked click button formaction button formaction javascript alert button clicked click button click form action form action javascript alert form submitted method get submit iframe src iframe src javascript alert iframe loaded iframe load input formaction input type submit formaction javascript alert input clicked click consequently not only the static script itself but also any dynamic scriptit includes would be capableto make arbitrary accessto the first partyobjects.nevertheless itisverydifficult ifpossible to exclude these intentional accesses without the knowledge of the intendedfunctionalitiesofeachscript.therefore werelyonthedeveloperstovalidateandadjustthecontextassignedtostaticscripts.
todothat wealsosummarizethecross scriptreadsthatleadtothe context assignments.
this helps the developers with the validation which is described at length in 3. .
.
we will demonstrate in 5. that the number of scripts that need a manual inspection is limited and they make a moderate number of cross script reads.
therefore it is practical for the developers to validate the isolation policies to prevent such scripts from being executed in the first party context.
in ordertoprevent scriptsfrom escaping itscontextby dynamicallyinjectingotherscripts weexecutethe dynamicthird party scriptsinthesamecontextasthescriptthatcreatesthem unless thedynamicscriptsareloadedfromadomainthatbelongstothe first party entity.
in particular javascript urls are executed in the contextwhere the scripts that last setthemare executed.
jsisolate maintainsacontextid attributewitheveryscriptina webpage whichisauniqueidofthecontextassignedtothescript.
bydefault thescriptsaredividedintotwogroups witha contextid of 1 for scripts implementing first party functionalities and 3 for the other scripts.
in the following a context with contextid of 1 and 3 are called a first party context andthird party context respectively.
one special case is library scripts e.g.
jquery which might define objects that are read by scriptsinboth contexts.
in ordertopreservethefunctionalitiesofsuchlibraryscripts jsisolate in particular sets the contextid attribute of them as both .
it then loads a copy of these scripts in both the first party and third party contexts.
note that the developers can also configure the isolation policies to separate scripts inafiner grainedmanner.
anexample.
consider the html page in listing4 which containsananchorelementandthreestaticallyincludedscripts.inthe following we call the scripts a l4 b l5 and c l6 respectively.
script b depends on script a as b calls function myfuncdefined by a in line .
therefore a shall be executed in the same context as b which is a first party script.
script a also creates another script dinline12 whichwillbeexecutedinthesamecontextasa.script bandcbothmodifythe hrefattributeoftheanchorelementby assigningdifferentjavascripturlstoit.asscriptcistheonethat lastmodifiesthe attribute the javascript urlshall be executedin the same context as c. similarly the click event listener registered by script c in line shall be executed in the same context as c. in summary the contextassignedto eachscript isas follows.
first partycontext script a bandd.
third partycontext scriptc javascripturlinline20andevent listenerinline22.
html body a id anchor1 click me a script src script script src script script src script body html a.js 11function myfunc return 12document.write script alert new script script b.js 15var myobj myfunc 16document.getelementbyid anchor1 .href javascript alert second script c.js 19var myanchor document.getelementbyid anchor1 20myanchor.href javascript alert third script 21myanchor.click 22myanchor.onclick function alert event listener 23myanchor.click listing html page notethatwedonotgeneratepoliciesforscriptd thejavascript urlandtheeventlistenerintheaboveexample astheyaregenerated on the fly by script aand c.rather thedynamic creation of thesescript code are trackedby jsisolate which will determine the contextfor themaccording to the initiator scripts.
.
.
isolation policies.
jsisolate creates an isolation policy for a webpagebasedonthepreviousdependencyanalysis.oncefinalized thepolicy canbe sentwiththepagesource htmlcode e.g.
likethecspheader toinstructthebrowsertoenforcethepolicy.
inadditiontothecontextassignedtoeachscript jsisolate alsoincludes in the policies necessary auxiliary information which helps the developers understand and adjust the policies.
in the following we describe the auxiliary information we report inthe policies.
tofacilitatetheinterpretationandenforcementofisolationpolicies for each statically included third party script jsisolate reports in the policy its script source url and the corresponding contextid .atenforcementtime jsisolate willthendeterminethe context for each third party script by matching the url.
however the script sourceurl mightcontain random strings whichcould change frequently.
for example website includes multiple scripts from ssl ccstatic.highwebmedia.com which have almost the same urls except for a random suffix.
in order to fixthis jsisolate alsoperformsanapproximatematchonscript urls whichwedescribein 4.meanwhile asstaticallyincluded inline scripts are all by default considered as first party scripts jsisolate does not include them in the isolation policies but directlyexecutestheminthefirst partycontext.notethatawebpage maycontainmultipleframes i.e.
amainframeandmultipleiframes.
ascriptmightbeincludedinboththemainframeandiframes and could be assigned different contexts in different frames.
in order 198jsisolate lightweightin browser javascript isolation esec fse august athens greece match context read read by id a match context read read by id b match context read read by id c listing isolationpolicy of to distinguish the scripts included in different frames jsisolate furthergroupsthe policiesbasedonthe urlof the frameinwhich thescriptsareincluded.wealsoperformanapproximatematchon frame urls as they may contain random strings.
details are in 4. to help the developers understand and adjust the isolation policies jsisolate furtherincludesalistofreadoperationsthatleadto thedecision ofthecontextforstatic third partyscripts.each read operationisrepresentedasareadtargetandtheuniqueidofthe script that definesthe read target.
listing presents the isolation policy generated for scripts a bandcin listing4.weincludescriptbheretodemonstratethe auxiliaryinformationgeneratedforwebdevelopers.inpractice we do not generate policies forstatic first party scripts as they are all executedinthe first partycontext.
.
creatingisolationenvironments jsisolate leveragesthe isolatedworld sinthechromiumbrowser to isolate javascript in separate contexts.
in order to isolate content scripts from browser extensions chromium executes content scriptsfromeachextension inan isolated world while thenormal scriptsfetchedfromthewebareexecutedinthe mainworld .the isolated world is a concept in v8 binding and is used to isolate theglobalvariablescopesanddomwrappersforeachextension.
scriptsinanisolatedworlduseaseparatevariablescopeandprototype chain.
meanwhile each isolated world has its own dom wrapper while sharing the same underlying c dom object.
the eventlistenersregisteredbyscriptsinoneisolatedworldwillbe executedinthe contextofthat specific world.
jsisolate is inspired by the idea of confining content scripts in isolated worlds.
it creates an isolated world for each context using thecontextid specified intheisolation policies andinjects the corresponding javascript code in the world.
as the interaction betweendifferentworldsisprohibitedbythebrowser thescriptsin oneworldcannotinterferewithscriptsinanotherworld.also they cannot escape their worldsbyinjectingotherjavascript code e.g.
byregisteringeventlisteners becausescriptsindifferentworlds work ondifferentdomwrappers.
implementation weimplementedaprototypeof jsisolate inthechromiumbrowser version .
.
.
using around2k lines ofc code.we plan to open sourceour prototype implementation.
we implemented an isolationinjectionhost object to inject scripts in different isolated worlds.
we added several custom attributes e.g.
nid initiator parentscriptid andcontextid in the blink rendering engine to recordthe creation relationship and theexecutioncontextassignedtoeachscript.thecustomattributes are not exposed tov8 therefore cannot be modified byjavascript.
we used the gremlins.js1library to perform a monkey testing after a full page loading.
the library emulates real user visits by performingrandominputs scrollsandclicksonapage.thisallowed us to trigger as much javascript code as possible and consequently capture more dependencies inan automatedyetscalablefashion.
parsingandenforcingisolationpolicies.
ourprototypeparses ascriptisolation policyfilewhenitstartstoloadapage.weplan to implement a new http header to enclose the isolation policies inourfuturework.whenparsingandrenderingthehtmlpage itloads ascript inan isolatedworld according to the policy.
jsisolate generatesscriptisolationpoliciesattwogranularities domain level and url level.
whenusing the domain level policies itmatchesscriptsusingonlythedomainname.ifanyscriptfrom onedomainisassignedtothefirst partycontext jsisolate loads all scripts from that domain in the first party context.
we adopt suchanapproachbecausescriptsfromthesamedomainareusually writtento cooperatebythe samedeveloper.as scripturlsmight containrandomstrings thisalsohelpstoeliminatethemismatches.
whenconfiguredtousetheurl levelpolicies jsisolate matches eachstaticscriptagainstthepolicyusingthewholeurl.specifically to tacklewiththe random script urls jsisolate matches a script frame in two modes i.e.
the strict and loose matching mode.
inthestrictmatchingmode amatchisfoundiftheurl excluding thefragment ofanexternalscript frameispresentinthepolicy.
whennomatchisfound jsisolate switchestotheloosematching mode where itperforms a character by character comparison under the constraint that the domain names should be the same.
the upperboundofdifferent character ratioinscript frameurlswas selected as .
whichwas determined based on our experiments onreal worldwebsites.nevertheless thedevelopersoruserscan configure adifferentthreshold.
developerscouldconfigure jsisolate toenforcepoliciesineither level according to their preferences.
we will discuss in 5how differentpolicygranularities affectthe compatibilityof jsisolate .
notethat if there is no exactor approximate matchfor a script jsisolate assignsafallbackcontextforit.in 5. wewilldemonstrate how different choices of fallback context affect the compatibilityofjsisolate onreal worldwebsites.insomecases jsisolate mayfailtofindamatchfortheembeddingframeurlandtherefore cannotlocatetheisolationpolicies.
jsisolate executesallscriptsin thatframeinthefirst partycontextforcompatibilityconcerns.ina realdeployment thepolicieswillbeincludedinanhttpresponse header see 6 which would avoid the mismatches on embedding frameurls.toaccuratelymeasuretheoverheadandcompatibility in our current evaluation we disabled script isolation in iframes.
199esec fse august athens greece mingxue zhang andweimeng table2 contextassignmentresults scripts websites of static third partyscripts.
w groundtruth w ogroundtruth url level 3rd party context 1st party context bothcontexts domain level 3rd party context 1st party context bothcontexts nonetheless the developers can easily deploy jsisolate to isolate scripts inallframes.
evaluation in this section we first describe our analysis on script dependency relationshipofpopularwebsites 5.
.wethenpresenttheevaluation answeringthefollowingquestions whether jsisolate can improve client side javascript reliability 5. whether jsisolate is compatible with real world websites 5. and whatthe performance overheadof jsisolate is 5. .
.
dependency analysis amongthealexatop1kwebsitedomains 142arepresentonthe domain relationship list.
on these websites if the script domain is alsoonthelist jsisolate determinesexecutioncontextforitbased onthedomaindependenciesinthelist.fortheotherscriptswhose domainsarenotonthelist jsisolate analyzesscriptdependencies as described in 3. .
for instance domain yimg.com belongs to the same entity yahoo!
as yahoo.com butgstatic.com does not.
therefore script wasassignedtothefirst partycontextonwebsite whilescript wasisolatedin the third partycontext.
we also used jsisolate to collect the javascript object access logs on alexa top 1k websites for analyzing the script dependency.
excluding inaccessibleand timeoutedwebsites we gatheredvalid log files on websites.
the logs and the automatically generated isolationpoliciesareavailableat .
intotal weobserved12 516staticthird partyscriptson960websites.
we analyzed the access logs and generated url and domainlevel isolation policies.
we also compared the results with and withoutthedomainrelationshiplist andfoundthelisthelpedto identify more scripts that belong to the first party organization on resp.
websites in the url level resp.
domain level policies.
for example on website a static script from vimeocdn.com wouldbeassignedtothefirst partycontextwiththe list as ground truth.
we list the context assignment results of static third party scripts in table .
all static scripts from the first party domainare executedinthe first partycontext.
infigure3 wevisualizethedependencyrelationshipbetweenall staticallyincludedscriptsonthewebsite .
numbersingreycirclesarethe scriptid ofstaticfirst partyscripts whichareexecutedinthefirst partycontext.thewhitecirclesrepresentotherscriptsstaticallyincludedfromathird partydomain.
figure script dependency relationship on an arrow from a to b indicates some object s defined by b is readbya.asshown script 48definedaglobalobject googletag which was read by script 74viagoogletag.fifwin .
specifically script74and48werestaticallyincludedfromathird partydomain googletagservices.com and the first party domain rakuten.co.jp respectively.inthiscase script 74and48wereapparentlydependent.
therefore we assigned 74to the first party context.
in contrast scripts17and154were put inthe third party context because they didnothavedependencywithanyscriptsinthefirst partycontext.
note that a jquery script 25read objects defined by script 168and183.
we believe script 25is a customized jquery script that reliedonotherscripts to achieve its functionalities.
as itwas alsoreadbyfirst partyscripts jsisolate loadeditinthefirst party context.asaresult scripts 80and168werealsoexecutedinthe first party context as they all called the jqueryfunction defined by25.
script183was read by both 25and the first party script .
thus itwasalsoexecutedinthe first partycontext.
wealso detectedonwebsite one staticscript jsthatwasreadbyanotherstaticscript afromcdn .tstatic.net .as scriptareadmultipleobjectsdefinedinascriptfromthefirst party domain weclassified aasafirst partycontextscript.meanwhile scriptfirebase app.js was also read by multiple scripts that did not have any functional dependency with first party scripts.
we therefore treated these scripts as third party scripts.
since firebaseapp.jsdid not read any script and was read by both first party and third partyscripts we assigneda contextid of both to it.
.
reliability improvement weevaluatetheeffectivenessof jsisolate inmitigatingthereliability problems describedin 2using several webmashupexamples.
avoiding global object overwrites.
for the global identifier conflict in listing as the libraries are not expected to interact witheachother jsisolate naturallyrunthemindifferentcontexts.
althoughclient.js will be automatically recognized as dependentonaframe.js jsisolate willreporttheconflictingwritesto developers whohavesufficientknowledgetodeterminewhether aframe.js shallbe allowedto overwrite ocanvas.js .
further consider the example in listing where two scripts assignvaluesofdifferenttypestothesameglobalidentifier dropdown .
as the external script redefined dropdown as a boolean value a 200jsisolate lightweightin browser javascript isolation esec fse august athens greece 1function dropdown ... a.js 3var dropdown false b.js 5if dropdown ... client.js runtime typeerror listing anexample ofconflictingvariable definitions.
calltoitwouldcauseruntimeexceptionsandmayleadtodenialof service dos .
similarly givenknowledge of detected conflicts developers may decide whether b.jsshould run in a separate executioncontext.
therefore jsisolate effectively avoids conflicting definitionsofglobalobjectsacrossdifferentscripts andisableto improve the reliability.
however a script can intentionally read first party objects to build fake dependencies.
we mitigate the risk throughdevelopervalidationoftheisolationpolicies.specifically jsisolate reports each cross script read operation that leads to the context assignment of third party scripts in the policies.
the developersthuscanidentifyanyunexpectedreadsandadjustthe contextid s.accordingtoourobservation inthedomain level resp.
url level policies each page contains on average .
resp.
.
staticthird partyscriptsthathavedependencyrelationshipwith first partyscriptsandareinvolvedinreadoperations eachsuch script is involved in on average .
resp.
.
read operations.
therefore itispracticalforwebdeveloperstovalidatetheisolation policies as itisaone timecost.
mitigatingprototypepoisoningattacks.
considertheprototypepoisoningattackin listing2 wherea.jsreadsregexp.prototype andthenwritesregexp.prototype.test .afterthat client.js calls i.e.
reads method testfromregexp.prototype .jsisolate does notrecordthereadtoobjectpropertiestoavoidrecognizing a.js andclient.js as dependent.
therefore jsisolate can prevent the attackbyisolating a.jsinthethird partycontext sothattheprototypeaccessedbythefirst partyscriptswouldnotbeaffected.inthis way we mitigate the unexpected interference and provide a higher level of reliability.
again a script can deceive jsisolate by forging thedependencieswithfirst partyscripts.wereportanyconflicting write and read operations in each static third party script to the developers whowoulddecidewhether to adjust the policies.
similar vulnerabilities have also beendiscovered on other password managers e.g.
passpack and mashedlife and have been discussedin .
they could be mitigatedinasimilar way.
.
compatibility the concernon thecompatibilityof jsisolate liesintwo folds whether jsisolate iscompatiblewithwebsitesthatdonotenforce script isolation and whether jsisolate breaks the functionality ofwebsitesafterscriptisolation.theanswertothefirstquestion isobviously yes because jsisolate bydefaultexecutesallscripts inthesamemainworldwhennopolicyisexplicitlyspecified.to measure the compatibility with real world websites after script isolation we used a vanilla chromium browser and our prototype tovisitalexatop1kwebsites andrecordedtheruntimeexceptions separately.weenforcedthedefaultpoliciesautomaticallygenerated fromthescriptdependencylogs.westudyhowdifferentchoicesof fallback contextin jsisolate can affectthe website compatibility.
to make the evaluation scalable we opted for an automatic testingapproachthatperformsbasicinteractionsuchaspagescrolling after loading.
we did not use monkey testing in the experiment asitcanrandomlytriggerdifferentcode hencedifferentexceptions indifferentruns whichmakesitdifficulttomakeafaircomparison.
we acknowledge that some exceptions might not be observed due toincompletecodecoverage.aswediscussin 6 thiscanbesolved byintegratingthedependencyanalysisandcompatibilitytestsin theapplicationregressiontestingprocess.wedidmanuallyinspect the exceptions on top 1002websites and identified the websites on whichwe observednewexceptions after isolating scripts.
first party context as fallback for url level policies.
we firstly assigned a fallback contextid of 1 to unmatched scripts.
outofthetop100websites weobservedon1websitenewjavascript exceptions.withourmanualanalyses theexceptionsdidnotbreak any critical functionality and all the compatibility issues could be resolved.
specifically website generatedexceptionsbecausescriptsdynamicallygeneratedimplicitly depended on scripts in a different context.
this shows a current limitation of jsisolate as it did not consider inline event listeners and the dynamic scripts in the dependency analysis which we will discussin 6.theexceptionscouldbemitigatedbychangingthe contextid ofthethird partyscriptfrom to or both .we leave this as an option to the developer who has sufficient information to decide the context of scripts.
the problem can also be fixed by allowing developers to specify the related origins using first partysets .
more details are discussedin 6. third partycontextasfallbackforurl levelpolicies.
we further tested jsisolate by assigning acontextid of 3 to unmatched scripts.
except for the above website we observed more websites that threw exceptions after script isolation.
the exceptions were generated because a long random string is contained in the url of an external script from a third party domain or in the url of the embedding iframe of the script.
although these scriptswereexplicitlydependentonfirst partyscripts theywere mistakenlyclassifiedasthird partyscripts.forinstance theurlof script containedarandomquerystringthatwas11characterslong which made our url match fail because the query string was updated periodically.
we could not exclude the query strings during the matching as a frame may include multiple scripts whose urls only differ in the query strings.
as a result the script from the third partycdndomainwasmisclassifiedasathird partyscript on website although it was read by first party scripts.
nevertheless the exceptions did not affect other scripts andnocriticalfunctionalitywasbroken.theseproblems canbefixedbyrecollectingthelogsandgeneratingthelatestisolationpolicies.alternatively wecouldleveragemechanismslike sritomatchthecontentofascript bycomputingahashvalue insteadofonlyitsurl.wecouldalsoperformanapproximatematch on external script source code in the browser to tackle with the randomstrings.inaddition asthosescriptsareincludedbythewebsite developers they could permanently set the script contextid attributes justonceregardless of the urls that willbe used.
domain levelpolicies.
whenjsisolate isdeployedtoenforce domain levelisolationpolicies wedidnotfindanyofthetop100 website throw more exceptions.
note that the choice of fallback 2exceptfor thatisinaccessible wegatheredvaliddataon99 websites.
201esec fse august athens greece mingxue zhang andweimeng table average logcollection overheadon page loading.
round vanilla s jsisolate s inc .
.
.
.
.
.
.
.
.
table average logcollection memory overhead.
round vanilla mb jsisolate mb inc .
.
.
.
.
.
.
.
.
contextdoesnotaffecttheresults asthemismatchescanonlybe causedbyscriptsfromnewdomainsabsentfromthepolicies which we didnot encounteronthe top 100websites.
summary.
our evaluation shows that jsisolate entails very few andfixable compatibilityissuesandworks wellwithpopularreal world webapplicationsingeneral.
.
performance tomeasuretheperformanceoverheadof jsisolate weusedthe selenium chromedriver to run a vanilla chromium browser and jsisolate to visit the alexa top 1k websites.
we set a timeout of 160secondsandforwebsitesthattimeoutedafterseveralretries we enlargedthetimeoutto360seconds.werecordedtheaveragepage loading time based on the window.performance.timing interface andcomputedthe averagememory consumption in3runs.
.
.
logcollectionoverhead.
weranjsisolate inthelogcollection mode to measure the overhead when collecting the javascript objectaccesslogsandscriptinitiatorrecords.wesuccessfullygathered valid data on and websites in the runs.
the results are presentedin table3andtable4.
inthelogcollectionmode theslowdownonpageloadingvaries from .
to .
and is averaged at .
.
the memory overhead ranges from .
to .
with an average of .
.
wefurthertested jsisolate onindustry standardbenchmarks and the evaluation results are listed in table .
as shown the most significant overhead was observed on the sunspider benchmark which tests the core javascript language features like hashing and matrix processing etc.overall 45scriptswere staticallyincluded on the test page and jsisolate recorded over 230k read write operations.on theother two benchmarks however theoverhead wascomparable withwhat we observedonreal world websites.
note that a developer would need to recollect the logs only if she he changes the included scripts or a script changes its interactionwithotherscriptssignificantly.anyruntimeerrorscaused bythechangescanbereportedtohelpthedevelopersquicklyset a new isolation policy and or easily identify a suspicious script.
therefore the overhead is acceptable as the log collection needs not to be performedfrequently.
.
.
script isolation overhead.
we ranjsisolate in policy enforcementmodetoevaluatetheperformanceoverheadincurredfor isolatingscripts.
jsisolate readstheisolationpoliciesfromlocal 3allthe testcases areavailable at log collection overhead on industry standard javascript benchmarks.
the test results represent the geometricmean ofrun sec foreachindividual test.
benchmark3vanilla jsisolate dec dromaeo .
.
.
sunspider .
.
.
v8 test suite .
.
.
table6 slowdownonaveragepageloadingtimeduringscript isolation url levelpolicies .
round vanilla s jsisolate s inc .
.
.
.
.
.
.
.
.
table7 increaseofaveragememoryconsumptioninscript isolation url levelpolicies .
round vanilla mb jsisolate mb inc .
.
.
.
.
.
.
.
.
table8 slowdownonaveragepageloadingtimeduringscript isolation domain level policies .
round vanilla s jsisolate s inc .
.
.
.
.
.
.
.
.
filesandassigns contextid toscriptsaccordingtothestrategyin 3. we successfully collected performance data for all websites.
specifically wemeasuredtheoverheadusingboththeurl level and domain level policies.
the experiment results are presented in table6 table7 table8andtable9.
when using url level policies the average slowdown is .
andon47.
websitesthepageloadingtimeincreasedbynomore than .
for domain level policies the average slowdown is .
.
this demonstrates that jsisolate incurs small overhead on page loading.
using url level policies the average memory overhead is .
andtheoverheadisnogreaterthan1 on48.
websites.
fordomain levelpolicies theaveragememoryoverheadis1.
.
as shown the memory overheadisalsonegligible.
summary.
theexperimentsshowthat jsisolate canefficiently isolate scripts withvery limitedoverhead.
discussion and futurework we discuss our work scurrentlimitationsandour future work.
policy deployment.
jsisolate reads the isolation policies from local files in our current prototype.
in the future we plan to enable developers to use a new http response header for the policies.
alternatively thepoliciescanbeembeddedinthehtmlpage like internalcss.moreover thepoliciescanbeintegratedwithexisting websitesthroughminimalchanges e.g.
byasimpleupdateofthe template usedinwebdevelopmentframeworks e.g.
angular .
202jsisolate lightweightin browser javascript isolation esec fse august athens greece table9 increaseofaveragememoryconsumption inscript isolation domain levelpolicies .
round vanilla mb jsisolate mb inc .
.
.
.
.
.
.
.
.
dependencyanalysis.
jsisolate excludes dynamicscriptsand event listeners from the dependency analysis which may cause exceptions after script isolation.
we adopt this design for preventing cross contextinterferencethroughdynamicscriptinclusion and eventlistenersareintrinsicallyisolatedindifferentdomwrappers as explained in 3. nevertheless to mitigate theexceptions developers can adjust the policies with limited manual efforts see 5. .
we leave it as a future work to investigate other possible solutions.
codecoverage.
jsisolate performsmonkeytestingtocapture and analyze script dependencies in a scalable way.
the monkey testing however does not promise a full code coverage.
therefore thedependencyanalysismightbeincompleteandcausesomeexceptions after script isolation.
however the automatic dependency analysis can be integrated with the current website regression testingprocess whichthoroughlyteststheapplication.thisintroduces verylimitedoverheadinthedevelopmentcycleandcouldhelpidentify possible compatibilityissuesandimprove code reliability.
classificationofscripts.
jsisolate reliesonthedomainrelationshiplistfromdisconnecttoidentifyscriptsfromdomainsrelatedto the first party domain.
as shown in 5. only of the evaluated domainswerepresentonthelist.however weexpectthatwiththe contribution of the community the list would be more comprehensiveinthefuture.meanwhile googlehasproposedfirst partysets that allows developers to explicitly specify related domains ina.jsonfile andwillbeimplementedinthechromiumbrowser in the near future.
we believe the first party sets would further improve our abilityto precisely classifyscripts.
applicability in other browsers.
in addition to the chromium browser otherfull fledgedbrowsersalsoprovidejavascriptcode isolation mechanisms.
for instance the safari browser also executesscriptsinjectedbyappextensionsinisolatedworlds.mozilla firefox supports the xray vision feature that uses separate contextsforcontentscriptsandnormalscripts.therefore thedesignofjsisolate canbeeasilyextendedtootherpopularbrowsers.
related work javascript isolation.
confined malicious javascript code using a reference monitor and restricted the interaction between adobe actionscript and javascript code.
magazinius et al.
fixed several design flaws of in .
agtenet al.sandboxed sensitive dom objectsto isolate third party scripts with the page loading overhead of over .
treehouse and safejs usedwebworkerstorunscriptsinseparatethreads.however they requiredthedeveloperstospecifythepermittedoperationsofeach isolated script which is non trivial for normal web developers.
some other works isolated scripts using iframes .
theyneedtointerposetheinteractionbetweenscriptsanddom of the original page.
in contrast jsisolate utilizes isolated worlds to separate functionally independent scripts which does not affectthe way that scripts are executed.
further it is able to generate isolation policies automatically which ismore efficient andeasier todeploy.adam etal.proposedtoisolatecontentscriptsofbrowser extensionsusing isolatedworld infirefoxbrowser whichhas adifferenttargetfrom jsisolate .breakappconfinesjavascript modulesinprotectedcompartments .jsisolate canalsoisolate normal webscripts andany javascript code createddynamically.
limitingjavascriptprivileges.
escudoorganizedjavascript principalsandresourcesinringswithdifferentprivileges .itpreventsprincipalswithlowerprivilegesfromaccessingresourceswith higherprivileges.meyerovich etal.registeredadviceforsecuritysensitivefunctionslike evaltorestrictthecallstothem .webjailusesdeepadvicetoenforceleast privilegeintegrationofscripts .snyder etal.developedanextensiontoblockunsafejavascript featuresbasedonpre definedpolicies .flowfoxinterceptsdom apicallsthrough secure multi execution to protect dataconfidentiality .
cowl enforces label based access control to prevent scripts from exfiltrating sensitive data .
chudnov et al.implemented an inlined information flow control ifc monitor to protectdataconfidentialityandintegrity .browsershield and jate rewrite html pages and scripts to safe equivalents.
theseworkshaveadifferenttargetfrom jsisolate whichseparates scripts withdifferentfunctionalities to providehigher reliability.
isolation in the browser.
prior works have proposed to renderuntrusted webcontent inlowerprivilegedrendererprocesses .
they limited the capability of attackers that compromisetherenderer.however thebrowserstillloadscontentfrom different websites in the same renderer process thus attackers can accesscross sitedata.arecentworkofgooglerendersuntrusted content fromdifferentwebsites inseparate processes .fission further enforces the isolation at the granularity of origins.
narayan etal.sandboxedvulnerablec c librariesusedbythe rendererinlightweightwebassemblysandboxes .theseworks are orthogonalto jsisolate whichassumesatrustedbrowser.
conclusion third partyscriptsareprevalentlyusedonwebapplicationtoenhancethefunctionalities.however thecurrentbrowserarchitecture allows all scripts to access a shared context causing unexpectedeffects.inthispaper wepresent jsisolate abrowser based frameworkthatimprovesjavascriptcodereliabilitybyexecuting scriptsinisolatedexecutioncontexts.
jsisolate analyzesthedependencyrelationshipbetweenscriptsonawebpage andidentifiesthe scriptsfromthird partydomainthatarenotfunctionallydependent onfirst partyscripts.itthenexecutesthescriptsinaseparateisolatedenvironmenttopreventthemfrominterferingwithfirst party scripts.wedemonstratewithrealworldexamplesthat jsisolate offersapracticalapproachtoenhancingjavascriptreliabilityand separating functionality independent code.
our experiments on alexa top 1k websites further prove that jsisolate is backward compatible andintroduces limitedperformance overhead.
acknowledgment the work described in this paper was partially supported by a grant from the research grants council of the hong kong special administrative region china projectno.
cuhk24209418 .
203esec fse august athens greece mingxue zhang andweimeng