exploring how deprecated python library apis are not handled jiawei wang li li jiawei.wang1 li.li monash.edu monash university australiakui liu kui.liu nuaa.edu.cn nanjing university of aeronautics and astronautics chinahaipeng cai haipeng.cai wsu.edu washington state university usa abstract in this paper we present the first exploratory study of deprecated python library apis to understand the status quo of api deprecation in the realm of python libraries.
specifically we aim to comprehend how deprecated library apis are declared and documented in practice by their maintainers and how library users react to them.
by thoroughly looking into six reputed python libraries and github projects we experimentally observe that api deprecation is poorly handled by library contributors which subsequently introduce difficulties for python developers to resolve the usage of deprecated library apis.
this empirical evidence suggests that our community should take immediate actions to appropriately handle the deprecation of python library apis.
ccs concepts software and its engineering software evolution .
keywords deprecated api deprecation python library evolution.
acm reference format jiawei wang li li kui liu and haipeng cai.
.
exploring how deprecated python library apis are not handled.
in proceedings of the 28th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse november virtual event usa.
acm new york ny usa pages.
.
introduction application programming interface api offers a communication protocol for different programs to interact with each other.
nowadays apis have often been regarded as the standard means providing interfaces of modern software development kits sdks or libraries to support and simplify the development of software.
when using apis developers do not necessarily need to understand the underlying implementations of apis that could be super complicated and could involve interacting with many other apis.
li li and kui liu are the corresponding authors.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse november virtual event usa association for computing machinery.
acm isbn xxxx x .
.
.
.
like the fast evolving nature of software e.g.
for providing new features or fixing bugs and vulnerabilities apis need to be continuously maintained and updated as well .
indeed the implementation of apis can also come with bugs or vulnerabilities that if not being fixed can propagate the same problems to their consumers i.e.
the software that accessed these apis .
since multiple consumers can access the same apis all of them will benefit from the changes in those apis.
while changing in order to not break the access of their consumers certain parts of the apis i.e.
signatures including the name and parameter numbers of the apis cannot be altered.
in such cases e.g.
it is unavoidable to change the signatures of apis the recommended approach is to introduce new apis and encourage the consumers of the apis to migrate to the new ones meanwhile the old apis will be marked as deprecated.
api deprecation has become a common practice for evolving unwanted apis which are discouraged from using in new developments and which will still be kept for a while before removed to preserve backward compatibility for existing consumers of the apis.
there are many valid reasons to deprecate apis the apis are insecure buggy highly inefficient or encourages poor coding practices or will not be maintained anymore .
taking these reasons and the natural progression of apis in mind our fellow researchers in the software engineering community have proposed various approaches to characterize the impact of api deprecation .
unfortunately despite that the literature has proposed numerous approaches targeting various aspects of deprecated apis covering many programming languages such as java android c etc.
the deprecation of python library apis have never been the main focus.
it is even more astonishing concerning that python is the most popular programming language according to the rank enumerated by ieee spectrum .
ieee spectrum attributes python s success to its explosion of new users in recent years driven by easy to use yet capable python libraries such as numpy pandas etc.
indeed python third party libraries hereafter python libraries play an essential yet critical role in supporting the implementation of python applications.
apis in such python libraries just like any other programming language can also be deprecated.
indeed as manifested in our empirical observation on stack overflow discussions api deprecation in python libraries has been continuously posted by developers and the number of such discussions is even continuously increasing.
this evidence shows that python developers concern about api deprecation just as much as developers of other major programming languages.
therefore the deprecation of python library apis should not be neglected byesec fse november virtual event usa jiawei wang li li kui liu and haipeng cai the community.
there is a strong need to understand the status quo of deprecated python apis.
in this work we attempt to fill the gap by presenting to the community the first exploratory study on the deprecation of apis in popular python libraries.
we manually look into the implementation of six python libraries that are among the top popular libraries based on the study of pimentel et al.
and that in total have been used by over python projects hosted on github.
we first aim at manually understanding how python library contributors deprecate their apis.
based on the manual observation we further summarize the deprecated apis and check against the official library documentation to examine if the deprecated library apis are properly documented.
if so we go one step further to check if replacement messages are given in the documentation of deprecated apis.
finally we perform a large scale study on the reaction of python developers to deprecated library apis.
we select python projects on github top projects per library to search for the usage of deprecated apis and possible historical fixes of deprecated library apis.
we achieve this by introducing to the community a prototype tool called dlocator to automatically characterize the usage of deprecated apis in python repositories.
the core contribution of dlocator is to statically resolve the challenges brought by the flexibility of python s api accessing mechanism i.e.
python developers often map the long fully qualified api names to shorter ones which has been deemed as a long run challenge by the literature .
overall our investigation into the deprecated python apis seeks to answer the following research questions rqs rq1 how do popular python libraries deprecate their apis?
in this very first research question by investigating the deprecation strategies of popular python libraries we aim at understanding the current practices adopted by python developers in the hope of observing the root causes bearing the continuous increase of python deprecation related discussions on a developer oriented online discussion website.
main findings despite there is a specific package to deprecate python library apis python library contributors often ignore the recommended solution and implement ad hoc strategies to deprecate apis.
these strategies are further different from libraries to libraries and each library may adopt several strategies at the same time yet in an inconsistent manner to deprecate their no longer supported apis.
rq2 how are deprecated apis documented in the python libraries?
the fact that python libraries adopt ad hoc strategies to deprecate apis motivates us to investigate further how are the deprecated apis documented.
the ad hoc implementations for deprecating python apis make it hard to invent automated approaches for managing the deprecated apis including their documentations.
as a result library contributors may have to rely on ad hoc solutions as well to document the deprecated apis which however may be prone to mistakes.
main findings there are a significant number of deprecated library apis that are not mentioned in the official library documentation.
for the documented ones unfortunately not all of them have been provided with explicitly replacement messages for helping library users to avoid the usage of deprecated apis.
rq3 how are deprecated library apis used by python projects?
the findings of the previous two research questions further motivate us to go one step deeper to examine the impact brought by the fragmented implementation of api deprecation strategies and poor documentation of deprecated apis.
to this end we are interested in knowing the python developers reactions to api deprecation when maintaining their python projects involving libraries with deprecated apis.
main findings python projects indeed use deprecated library apis for which the usage is positively correlated with the number of total accessed library apis.
unfortunately the usages of deprecated library apis are rarely changed during the evolution of python projects.
motivation python is an interpreted high level general purpose programming language .
since python has become one of the top most popular programming languages listed by tiobe index .
from january it is listed as the third most popular language following java and c. furthermore python won the programming language of the year award in and respectively.
many organizations including google cern nasa are using python to build their rich software platforms and applications .
in the python package index pypi repository there are more than python projects released with over versions as of january which can assist developers in addressing a broad range of tasks.
the more libraries being leveraged by python developers the greater influence the deprecation of python library apis may lead to.
hence there is a need to understand and quantify such influences.
to better motivate this necessity of this we now present a preliminary study on the extent of developer discussions related to the deprecation of python library apis.
.
deprecation in developer discussions as a preliminary study in understanding to what extent are deprecation problems discussed by software developers we resort to public posts provided by developers on the famous developer questions answer q a website stack overflow .
we perform a search using composite conjunctions of keywords including programming languages i.e.
java c python c and c and a category of deprecation related keywords i.e.
deprecate deprecated and deprecation with sotorrent dataset an official data dump of stack overflow .
we limit the search space into the questions that were posted from january 1st to december 31st of .
in total posts are identified in this search.
we first assess how frequently the deprecation of each programming language is discussed on stack overflow by the numbers of q a posts that contain the deprecation related keywords of which results are presented in figure .
we observe that deprecation related to java programs present is more discussed than that of the other four programming languages.
nevertheless when reaching a peak in the number of discussions started to decrease.
as can be seen from the figure only the deprecation discussions related to python are constantly increased over the period.
this empirical 1the rounded time slightly earlier than the moment when we started to work on this project.exploring how deprecated python library apis are not handled esec fse november virtual event usa evidence shows that python s deprecation problems have attracted more and more attention from python developers in recent years.
q aaboutdepreccationjavacpythonc c figure distribution of deprecation related q a for the top popular programming languages in the last decade.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
java c python c c negative neutral positive figure sentiment distribution of developer attitudes concerning the deprecation problems of the top popular programming languages.
.
developers sentiment reaction to deprecation we then investigate the developers emotional attitude towards the discussions with respect to the deprecation relying on senti4d a tool for analyzing sentimental polarity from software development corpus .
we apply senti4d to all the deprecation related posts we have identified previously.
developers sentiment reacted to deprecation problems will be grouped into three categories i.e.
negative neutral or positive .
the experimental results are illustrated in figure .
we observe that python has the lowest positive discussions about its deprecation problem compared with the other four programming languages.
additionally for the negative sentiment the related discussions for python are close to or higher than figure complaining the deprecation in python library excerpted from q a on stack overflow.other languages.
it implies that python developers are not happy with the current deprecation mechanism provided by or largely implemented in the python community.
indeed figure illustrates such an exmaple simplified from a stack overflow page where a developer complains about the deprecation of a library api is not properly documented2.
python becomes popular in the software community and pythonrelated issues such as problems related to the deprecation of python apis are increasingly discussed on the online question answer site.
like the reactions of other popular programming languages python developers lean to be negative as well when posting deprecation related issues therefore there is a need to empirically understand the status quo of deprecation in the python realm so as to recommend actionable steps to help developers better handle deprecation related issues.
study design we now present the design details of our study specifically including the study subjects and the methodology of identifying deprecated apis in python codebase.
.
subject selection in this work we are interested in understanding the deprecation of python library apis.
as one of the most popular programming languages nowadays python has attracted a lot of attention from software developers who have already developed plenty of python projects including a large number of reusable packages i.e.
libraries .
indeed there are at least python libraries available in the python community which are readily accessible for developers to choose from.
it is nonetheless challenging to investigate all of the available libraries.
hence we decide to leverage the famous python libraries to form our study.
in a recent study pimentel et al.
have reported the top leveraged python libraries concerning their imported frequencies in their large scale empirical study.
among the ten libraries four of them are provided as python s built in modules which should not be considered as third party libraries.
therefore we focus on our study on the remaining six python libraries.
table information of subjects six python projects.
subjects version kloc commits stars forks numpy .
.
.9k .3k matplotlib .
.
.8k .8k pandas .
.
.6k .4k scikit learn .
.
.3k .2k scipy .
.
.8k .1k seaborn .
.
.8k .2k table enumerates the selected six python libraries which are briefly described below numpy is a fundamental package for scientific computing .
november virtual event usa jiawei wang li li kui liu and haipeng cai matplotlib is a python 2d plotting library which produces publication quality figures in a variety of hardcopy formats and interactive environments across platforms .
pandas is a python package providing fast flexible and expressive data structures designed to make working with relational or labeled data both easy and intuitive .
scikit learn is a famous python library that is frequently leveraged to implement machine learning approaches.
scikitlearn is built on top of scipy and is distributed under the 3clause bsd license .
pandas and scikit learn are popular frameworks for data science and statistical machine learning with highly efficient modules of data prepossessing machine learning algorithms.
scipy is an open source software depending on numpy for mathematics science and engineering .
scipy provides users with great convenience for scientific computing covering fast matrix operations.
seaborn is a python visualization library implemented on top of matplotlib.
both seaborn and matplotlib provide highlevel interfaces for drawing attractive statistical graphics .
the second column in table presents the version of the selected libraries.
since all of the selected libraries are open source and are available on github the following columns further present their lines of code the number of commits stars and forks.
the fact that all the selected libraries have received more than stars and forks shows that they are indeed popular libraries in the python community and hence should be representative to fulfill our study.
.
methodology we now briefly summarize the methodology we adopt in order to answer the three research questions we enumerated in section .
initially we plan to write python scripts to characterize the deprecation of python library apis automatically.
however as we will detail in the next section python library contributors do not follow the same strategy to deprecate apis or provide means to programmatically document the deprecated apis making it hard to automatically achieve the purpose i.e.
identifying deprecated apis and their documentation .
therefore we resort to a manual approach to answer the first two research questions.
regarding the third research question which concerns the developers reaction to deprecated python apis one of the core tasks api calling type from sklearn.feature extraction.text import tfidfvectorizer tf idfv tfidfvectorizer api calling type from sklearn.feature extraction import text tf idfv text.tfidfvectorizer api calling type from sklearn.feature extraction import text as t tf idfv t.tfidfvectorizer api calling type import numpy as np a np.array a.reshape figure examples of four api calling types in python code.towards answering this question is to check if a given deprecated api is used in a python project.
to achieve this purpose we design and implement a prototype tool called dlocator to automatically characterize the usage of library apis in python projects.
as acknowledged by zhang et al.
in their recent study about the evolution of python framework apis it is non trivial to achieve such a purpose.
indeed as justified by them when accessing into python library apis developers often map the long fully qualified api names to shorter ones e.g.
from sklearn.feature extraction.tex.tfidfvectorizer totfidfvectorizer .
furthermore apis can be shortened in different methods such as the four different api callings types shown in figure depending on developers programming behavior.
subsequently such usages of shortened api versions cannot be statically reflected back to their fully qualified versions and can impede the identification of the same apis with different usages.
to resolve this challenge we formatted the api calls presented in python projects before characterizing them.
formatting api calls.
we propose to format all api calls into the fully qualified name style that generally present apis in a python library in the form of a.b.c.api name such assklearn.fe ature extraction.text.tfidfvectorizer where each identifier is separated with .
which represents the hierarchical structure of the full api path including the location where the api is declared and the relationship between a class and its members.
the process of formatting api calls is illustrated in algorithm .
given a python program we first parse it into an abstract syntax tree ast to facilitate traversing each entity of the program.
we first collect the full paths including the specific module names for all api calls.
if an ast node in the entire ast of the python program is an import statement node its information related to api will be extracted.
if the import statement node has an alias the alias such as 3rd one in figure is extracted as the retrieving key for api mapping cf.
line .
otherwise the import item is collected as the retrieving key cf.
line .
if the import statement node represents an import statement the full module name is identified as the path value for api mapping cf.
line .
while if the import statement node is a from import statement the full module name concatenated with the import item is identified as the related value for api mapping cf.
line .
we then collect and format all api calls from the python program code.
for each ast node in past if it is a function call node the related function name is collected as an api call candidate cf.
line .
after checking all ast nodes each api call candidate is validated whether it is invoked as an api call from a library.
if so the related full qualified name is concatenated to format each api call.
study results we now provide the experimental results along with the key insights observed for answering aforementioned research questions.
.
rq1 declaration of deprecated apis our first research question concerns the declaration of deprecated apis.
we want to understand how python library contributors deprecate their library apis.
we hence manually look into the open source repositories of the selected six libraries.exploring how deprecated python library apis are not handled esec fse november virtual event usa algorithm formatting api calls.
input p a python program.
output af a set of formatted api calls.
1function format p 2a initmap initiate a map for api calls.
3af initlist initiate a list for formatted api calls.
4ass initmap initiate a map for assignments.
5c initlist initiate a list for function calls.
6past parsepythoncode p parse the python code into an ast.
nast an ast node in past.
foreachnast inpast do ifisimportstatementnode nast then ifhasalias key then key getalias nast else key getimportitem nast ifisimportstatement nast then value getmodulename nast else ifisfromimportstatement nast then value getmodulename nast .from nast .import a.put key value else ifisfunctioncallnode nast then c.add getfunctioncallname nast foreachcincdo fullqualifiedname retrievefullqualifiedname a iffullqualifiedname !
null then formattedapicall format c fullqualifiedname af.add formattedapicall returnaf our observation reveals that python apis are deprecated at different granularities which are summarized into four categories function parameter parameter s value and others.
function a function class defined in a library is simply no longer supported by the library such as the three examples shown in figure .
the deprecated python class is grouped into this category as the invocation of python class is similar to the function call like constructor calls in java .
parameter the positional or keyword argument defined in an api can be deprecated in python.
for example parameter numeric only of function pandas.dataframe .min in figure is deprecated and will be replaced with skipna .
parameter s value this type refers to the cases where an argument of an api will no longer accept certain value s as input.
for example values full and economic for argument mode of apinumpy.linalg.qr will no longer be supported lines in figure .
comparing with other popular programming languages e.g.
java python api deprecations present a finer granularity.
except the code entities i.e.
classes and functions that can be deprecated by developers in different programming language code the parameter and its value could be discarded by python contributors as well.
table illustrates the distributions of api deprecations at each of the three granularities.
overall functions are the main entities that will be deprecated by python contributors it is similar to the deprecated entities in other programming languages.
in pandas scikit learn and scipy the deprecated parameters hold a significant share of api deprecations.
only a small number of deprecated api cases are caused by the parameter s value.
nevertheless the deprecated apis with respect to parameters raise a challenge in maintaining tasks for developers.table distributions of deprecated apis in each category.
subject function parameter parameter s value total numpy matplotlib pandas scikit learn scipy seaborn total we further investigate how the deprecated apis are declared in python programs by developers.
according to our investigation the api deprecations are generally declared in three strategies parameter deprecate kwarg old arg name numeric only new arg name skipna def min self skipna true parameter s value example from numpy.linalg.qr def qr a mode reduced ...... mode reduced complete r raw full economic ...... full alias of reduced deprecated economic returns h from raw deprecated.
figure examples of deprecated apis at parameter and parameter s value levels.
decorator the strategy used by library contributors to declare the deprecation of python apis is through the so called python decorator mechanism.
similar to the java annotation mechanism python decorator provides a means to extend the behavior of a function without explicitly modifying it.
figure presents a concrete example showing how the python decorator is used to deprecate apis in class logtransformbase e.g.
line .
unfortunately different library contributors tend to maintain their own decorator implementations instead of adopting a common one such as the deprecation project hosted on pypi the official third party software repository for python.
this ad hoc decorator implementation makes it hard to invent generic scripts to automatically characterize deprecated apis for python libraries.
hard coded warning the declaration of api deprecation is realized by providing hard coded warning messages to api users at runtime.
figure demonstrates such an example where the deprecated api gradientboostingclassifier one of its parameters is deprecated is highlighted by a hard coded warning message line .
comments the deprecation is declared as comments i.e.
natural language in the source code.
let us take figure again as an example in line the comments of api slepian explicitly note readers that the api is deprecated in scipy .
.
table summarizes the declaring strategies of deprecated apis adopted by the selected popular python libraries.
it is interesting to observe that generally most of the libraries except seaborn leverage python decorator to declaring the deprecation of apis.
similar methodologies have been adopted by java as well via deprecated annotation which has been demonstrated toesec fse november virtual event usa jiawei wang li li kui liu and haipeng cai decorator matplotlib lib matplotlib scale.py cbook.deprecated .
alternative logtransform class logtransformbase transform ... ... hard coded warning scikit learn sklearn ensemble gb.py class sklearn.ensemble.gradientboostingclassifier ... if self.presort !
deprecated warnings.warn the parameter presort is deprecated and has no effect.
it will be removed in v0.
.
you can suppress this warning by not passing any value to the presort parameter.
we also recommend using histgradientboosting models instead.
futurewarning comment scipy scipy signal windows windows.py def slepian m width sym true .. note deprecated in scipy .
.
slepian will be removed in a future version of scipy it is replaced by dpss which uses the standard definition of a digital slepian windo.
figure examples of declaring of deprecated apis in python libraries.
table the declaring strategies of deprecated apis in six python libraries.
subject decorator hard code warning comments numpy np.decorator matplotlib mp.decorator pandas pd.decorator scikit learn sk.decorator scipy np.decorator seaborn np pd mp and sk represent numpy matplotlib pandas and scikit learn that define the decorators.
be effective.
unfortunately unlike what occurs in java where all the projects use the same mechanism to manage deprecated apis python library contributors maintain their deprecation decorator that is different from the ones adopted by other libraries except for scipy which leverages the decorator supported by numpy .
all six libraries attempt to describe api deprecation via developer comments.
however when commenting on the deprecation of apis python libraries do not provide structural mechanisms such as deprecated javadoc to help in maintaining the up to date documentation of deprecated apis resulting in difficulties to propagate the deprecation to the api users.
to mitigate this problem all the libraries have decided to warn library users at runtime about their usages of deprecated apis.
among the six selected libraries four of them have leveraged all the three strategies to declare the deprecation of apis.
these three strategies seem to complement each other decorator allows maintainers to programmatically manipulate the deprecated apis but does not provide a detail explanation on why is the api deprecated.
comments can then be leveraged to fill the gap by providing natural language explanation to library developers.
finally the hard coded warning provides an effective means to further propagate the deprecation message to library users.
to check if library contributors are actually using different strategies to complement each other whendeprecating apis we are further motivated to answer the following question to what extent are the identified strategies adopted to declare deprecated apis?
table summarizes our empirical findings.
the majority of deprecated apis in all the selected libraries is declared by a single strategy as shown in columns .
the remaining deprecated apis are mostly declared by two strategies a large part of them are deprecated by hard coded warnings plus comments column while a small number of them by decorator plus comments column .
there are no deprecated apis that are declared by both decorator and hard coded warning strategies column and column .
this evidence suggests that python library contributors have poorly handled api deprecation in the community.
although different strategies are leveraged they do not take efforts to ensure the consistency among them missing the opportunities to complementarily and hence thoroughly declare the deprecation of apis.
this problem also explains why the number of python deprecation discussions on developer q a site continuously increases as disclosed in section .
table the number of deprecation occurrences in the subject dataset by different ways subject c w d c w c d d w c d w total numpy matplotlib pandas scikit learn scipy seaborn total c w d represent comments hard coded warning and decorator declaring strategies respectively.
the deprecation of python library apis is mainly declared via three strategies decorator hard coded warning and comments.
library contributors nevertheless do not follow the same paradigm but resort to different strategies which are often customized and maintained by their contributors to deprecate apis.
moreover there are cases that deprecated apis may be declared by two strategies.
nonetheless there is no single api that is deprecated via all the three identified complementary strategies i.e.
lacking consistency between the adopted deprecation strategies.
.
rq2 documentation of deprecated apis for the future evolution and maintenance of programs it is worthy of providing clear documentation for deprecated apis .
indeed as stated in the literature it is essential to provide sufficient information concerning deprecated apis for library users.
mainly documenting apis is known as one of the most effective methods to resolve deprecated apis since they can convey the intentions of why apis are deprecated .
therefore in the second research question we concern about the documentation of deprecated python library apis.
the first task is to identify the artifacts that document the deprecation of library apis.
in this work we resort to the official documentation also known as api reference and release notes to check if theexploring how deprecated python library apis are not handled esec fse november virtual event usa deprecation messages are timely conveyed to library users.
if so we consider the api deprecation is well documented otherwise we regard the deprecation of apis as undocumented ones.
table summarizes the number of undocumented deprecated apis.
there are in total of deprecated apis among the six selected popular libraries that are not documented by developers.
specifically concerning the three deprecation strategies i.e.
comments hard coded warning and decorator the numbers of undocumented apis are and respectively.
concerning each library along to the best only of deprecated pandas apis are not documented to the worst the undocumented rate of deprecated scipy apis reaches as high as .
table the number of undocumented total deprecated apis in the six subjects.
subjecct comments warning decorator total numpy matplotlib pandas scikit learn scipy seaborn total undocumented api deprecations are declared with both comments and warning strategies or both comments and decorator strategies thus the number in column total is slightly lower than the sum of the previous related three columns.
the same as table .
we further investigate whether the alternatives to deprecated apis are provided when their documents are available of which results are summarized in table .
the correctness of the results were confirmed by two phd students who have python as their primary programming language for daily tasks but have been unaware of the deprecation study for python.
these two phd students are invited to independently verify all of the documented deprecated apis among which they have agreed on of them after reading documentation text of these apis giving a substantial inter rater agreement as suggested by cohen s kappa coefficient kappa .
.
the disagreements are mainly related to semantic differences of the descriptive language mentioning of these apis without explicitly mentioning the deprecation or removal of the api .
overall around one third of documented api deprecations do not provide alternatives for users which is in line with the results reported by brito et al.
in a contemporary study for the deprecated apis in java programs.
we observe that of deprecated apis declared with decorator are not provided with the alternatives that is much higher than comments and hard coded warning.
furthermore in deprecated apis that are not provided with replacements half of them are declared with the decorator that is followed by the comments and hard coded warning strategies.
while going through the documents of deprecated apis we further observe that some of such documents are un clearly vaguely or even incorrectly described.
for example figure presents an example of unclear documentation of deprecated apis where parametermin impurity split is deprecated in all the tree based estimators are deprecated that actually refers to deprecated apis in the context.
however the apis are not clearly described in thistable the number of deprecated apis that are documented but not provided with replacement messages.
subject comments warning decorator total numpy matplotlib pandas scikit learn scipy seaborn total figure example of unclear presentation of a deprecated api excerpted from scikit learn s documents3.
figure example of incorrect document of a deprecated api excerpted from matplotlib s documents4 the deprecated api naturallogtransform is incorrectly presented as naturallogtransformlog .
document.
developers will take more efforts to figure out what are the all tree based estimators for their programming tasks.
without giving explicit and definitive information it is inconvenient for developers to avoid the usage of those deprecated library apis.
in figure the deprecated api naturallogtransform is incorrectly presented as naturallogtransformlog in figure which can confuse even mislead the library users.
around one quarter of deprecated apis are not mentioned in the library s official documentation making it hard for library users to mitigate the usage of deprecated apis.
for such deprecated apis that are documented of them further come up with alternatives which is in line with other major programming languages.
november virtual event usa jiawei wang li li kui liu and haipeng cai .
rq3 usages of deprecated apis the findings we have observed for answering the previous two research questions show that deprecated apis are declared in a disordered manner multiple non generic ad hoc strategies and yet are also not well documented.
hence we hypothesis that this disorganization may be propagated to python library users.
to this end in the last research question we are interested in exploring how are these deprecated apis are used in real python projects and to what extent do developers address them.
a dataset of github repositories.
to support the experiments we resort to github to collect open source python project clients of each subject selected in this work.
in particular we crawl the top best match ranked projects returned by the github search with the composite searching condition of the subject library name and python repositories only.
note that the official repositories of the six subjects are excluded from the searching results.
the search engine of github is only a simple text based tool that receives as input a list of query words thus the searched results are not fully related to the searching condition .
to reduce the noise the searched projects are further purified by checking whether they indeed invoke the api calls from the related subject library.
eventually as presented in table a total of python projects that invoke 200k api calls from six python libraries are collected as their client projects.
with the selected repositories we first collect commits with respect to fixing deprecation by matching commit messages with fix related and deprecation related keywords i.e.
fix and deprecat .
for all the commits of selected python projects we observe that commit messages mentioning deprecation only account for a very small portion less than .
.
yet the number of commit messages mentioning both keywords indicating possible fixes of deprecated apis is even much smaller.
dlocator for locating deprecated apis.
motivated by this finding for which python developers are rarely fixing deprecated library apis from the commit messages point of view we go one step deeper to directly look at the evolution of python code since commit messages may not necessarily reflect the exact changes of the code due to the diversity of human language e.g.
word choices or presentation styles for conveying the knowledge.
to this end we propose to the community a prototype tool called dlocator5 which takes as input a python git repository and a set of deprecated apis and outputs the set of deprecated apis that are currently used by the project.
to resolve the challenges demonstrated in figure dlocator implements the api call formatting algorithm as shown in algorithm as one of the core contributions to locate the usage of apis.
by looking at the evolution of the project e.g.
visiting all the commits dlocator can further spot all the historical deprecated apis that are no longer presented at the lasted version of the project and are hence regarded as fixed ones.
table summarizes the usages of deprecated apis in the latest version of all client python projects where the threshold x columns mean that the client project using the deprecated apis for at least x times is considered.
projects columns list the number of projects that are using the deprecated any api calls.
for example the cell in column and row shows that in client 5available at seabornscipyscitkit learnpandasmatplotlibnumpynon decreaseddecreasedfigure distribution of projects with respect to the evolution of deprecated api calls.
seabornscipyscikit learnpandasmatplotlibnumpypresenthistorical figure distribution of deprecated apis that are presently historically used by the client projects.
projects of numpy library of them are using the deprecated apis for at least one time in their latest version.
columns deprecated api calls list the number of distinct all deprecated api calls used in the client projects.
for example the cell in column and row presents that distinct deprecated apis are used times in those client projects.
we observe that overall out of deprecated apis of six libraries are still used in client projects for times.
from the aspect of spread that the number of client projects using deprecated apis the deprecated apis of pandas are most widely by its client projects which is followed by scikit learn and seaborn.
from the aspect of depth that the times of used deprecated apis the deprecated apis in pandas are most recurrently used in client projects which is followed by scikit learn and scipy.
while from the aspect of the number of distinct used deprecated apis the main merchants of deprecated apis swift to scipy scikit learn and matplotlib.
when increasing the threshold to and deprecated api usages present the same distributions as the threshold .
these results indicate that the recurrent usages of deprecated apis mainly focus on some specific api deprecations.
figure presents the distribution of the client projects with respect to changing deprecated api calls where decreased represents that the number of deprecated apis called in the present versions of all client projects is decreased comparing with the deprecated apis invoked in the whole evolution histories of all client projects.
non decreased denotes that opposite situation.
as shown in figure the majority of client projects do not remove any deprecated apis during their evolution process which suggests that python developers do not pay enough efforts to address the deprecated api calls.
figure further illustrated the times of the deprecated apis invoked by the client projects in the present time i.e.
present exploring how deprecated python library apis are not handled esec fse november virtual event usa table the usage of deprecated apis in the latest version of selected client projects.
subjects deprecated threshold threshold threshold threshold apis projects deprecated api calls projects deprecated api calls projects deprecated api calls projects deprecated api calls numpy matplotlib pandas scikit learn scipy seaborn total table overview of selected datasets.
only such projects that have accessed at least one library api are considered.
subject numpymatplotlibpandasscikitlearnscipyseaborntotal crawled projects200 considered projects181 total api calls112 table the top most recurrently used apis in the present historical versions of client projects.
present history numpy.loads numpy.loads numpy numpy.asscalar numpy.asscalar numpy.mirr numpy.mirr matplotlib.cbook matplotlib.cbook .is string like .is string like matplotlib matplotlib.cbook.dedent matplotlib.cbook.dedent matplotlib.mlab.prctile matplotlib.mlab.prctile pandas.concat pandas.concat pandas pandas.to datetime pandas.to datetime pandas.dataframe.astype pandas.dataframe.astype sklearn.linear model.lars path sklearn.preprocessing.imputer scikit learn sklearn.utils.mocking sklearn.linear model.lars path .checkingclassifier sklearn.utils.mocking sklearn.preprocessing.imputer .checkingclassifier scipy.misc.comb scipy.misc.comb scipyscipy.diag scipy.diag scipy.stats.chisqprob scipy.stats.chisqprob seaborn.factorplot seaborn.factorplot seaborn seaborn.despine seaborn.despine seaborn.tsplot seaborn.tsplot bars and their whole histories i.e.
present and historical bars .
note that historical bars show the numbers of deprecated apis that are called in the old versions of client projects and have been removed from the latest versions.
comparing with the deprecated apis currently used by client projects only a small part of deprecated api usages have been resolved in the evolution process.
table further shows that top most recurrently used api deprecation in the whole evolution history are equivalent to the usages of deprecated api calls in the latest version of client projects.
these results further confirm that python developers are not willing to address the deprecated api calls.
python projects indeed use deprecated library apis for which the usage is positively correlated with the number of total accessed library apis.
unfortunately the usages of deprecated library apis are rarely changed during the evolution of python projects.
discussion .
implication based on our empirical findings we now discuss possible implications that our community could build upon for appropriately handling deprecated python library apis.
built in python module to handle api deprecation.
overall our investigations reveal that in popular python libraries deprecated apis are generally declared through three categories decorator hard coded warning and comments.
yet the library contributors do not follow the same paradigm but resort to different strategies to deprecate apis which makes it more complicated to maintain the deprecated apis in python libraries than the deprecation of many other programming languages.
to mitigate this problem we argue that there is a strong need to invent a generic deprecation paradigm that is acceptable to all the python developers and library contributors.
ideally it would be great if such a paradigm can be provided as a built in python module and thereby contributing to the long term health of third party libraries in the python ecosystem.
enforce consistency among the complementary deprecation strategies.
as discussed earlier the three deprecation strategies currently leveraged by library contributors are complementary to each other.
indeed the strategies provide different functions to the deprecation of python apis.
therefore we suggest that python library contributors should declare deprecated apis with all the three strategies simultaneously and should make efforts to ensure consistency among the declarations.
structured rules to generate and maintain the documentation of python deprecated apis.
the fact that python library s official documentation including its api