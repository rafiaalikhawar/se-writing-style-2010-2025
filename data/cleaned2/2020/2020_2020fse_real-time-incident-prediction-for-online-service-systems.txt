real time incident prediction for online service systems nengwen zhao tsinghua university bnrist beijing chinajunjie chen college of intelligence and computing tianjin university tianjin chinazhou wang bizseer beijing university of posts and telecommunications beijing china xiao peng gang wang china everbright bank beijing chinayong wu fang zhou zhen feng china everbright bank beijing chinaxiaohui nie tsinghua university bnrist beijing china wenchi zhang bizseer beijing chinakaixin sui bizseer beijing chinadan pei tsinghua university bnrist beijing china abstract incidents in online service systems could dramatically degrade system availability and destroy user experience.
to guarantee service quality and reduce economic loss it is essential to predict the occurrence of incidents in advance so that engineers can take some proactive actions to prevent them.
in this work we propose an effective and interpretable incident prediction approach called ewarn which utilizes historical data to forecast whether an incident will happen in the near future based on alert data in real time.
more specifically ewarn first extracts a set of effective features including textual features and statistical features to represent omen alert patterns via careful feature engineering.
to reduce the influence of noisy alerts that are not relevant to the occurrence of incidents ewarn then incorporates the multi instance learning formulation.
finally ewarn builds a classification model via machine learning and generates an interpretable report about the prediction result via a state of the art explanation technique i.e.
lime .
in this way an early warning signal along with its interpretable report can be sent to engineers to facilitate their understanding and handling for the incoming incident.
an extensive study on real world online service systems from a large commercial bank demonstrates the effectiveness of ewarn outperforming state of the art alert based incident prediction approaches and the practice of incident prediction with alerts.
in particular we have applied ewarn to two large bnrist beijing national research center for information science and technology junjie chen is the corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse november virtual event usa association for computing machinery.
acm isbn .
.
.
.
banks in practice and shared some success stories and lessons learned from real deployment.
ccs concepts software and its engineering maintaining software .
keywords incident prediction online service systems real time prediction acm reference format nengwen zhao junjie chen zhou wang xiao peng gang wang yong wu fang zhou zhen feng xiaohui nie wenchi zhang kaixin sui and dan pei.
.
real time incident prediction for online service systems.
in proceedings of the 28th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse november virtual event usa.
acm new york ny usa pages.
introduction nowadays online service systems such as online shopping ebank and search engines have become an indispensable part in our daily life.
although tremendous efforts have been devoted to software service maintenance e.g.
collecting various monitoring data for a service system such as metrics logs traces and alerts due to their large scale and complexity incidents i.e.
unplanned interruption outage to a service are still inevitable which could lead to system unavailability and huge economic loss .
for example according to a recent survey the average cost per hour of server downtime is between and .
to reduce the influence of incidents and guarantee the quality of software services there are two widely used ways in both academia and industry i.e.
predicting the occurrence of an incident in advance so that engineers can take some proactive actions to prevent it and mitigate the already happened incident as soon as possible .
our work focuses on the first way since this way is able to directly avoid the occurrence of service unavailability rather than reduce the time of service unavailability.esec fse november virtual event usa nengwen zhao and junjie chen et al.
in the literature many efforts have been devoted to the first way i.e.
predicting the occurrence of incidents in advance but they still suffer from various limitations in practice.
first the vast majority of prediction approaches target at the prediction of a specific type of failures such as disk failures node failures switch failures and equipment failures and thus are restricting in practice.
moreover these prediction approaches utilize logs or metrics to extract omen patterns for predicting the specific type of failures.
however tens of tbs of logs and more than thousands of metrics tend to be generated per day for a large scale system which could bring great challenges and costs to learn a prediction model from massive data.
second airalert was proposed recently to predict general incidents and relies on lightweight alert data but its performance is unsatisfactory since it just considers the number of different types of alerts for prediction which has been demonstrated to be ineffective in our study to be presented in .
.
therefore designing an effective and lightweight prediction approach for general incidents is very essential.
in this paper we aim to propose a novel approach to predicting general incidents in real time.
similar to airalert we also utilize lightweight alert data for prediction since alerts are more highlevel and comprehensive.
more specifically alerts are generated to report anomalies from other monitoring data e.g.
metrics logs and traces and thus avoid processing massive logs or metrics.
however predicting incidents based on alert data in practice also faces several challenges as follows.
practical alert data contain tens of attributes to be introduced in .
and thus how to extract useful information from them is challenging.
not all alerts before the occurrence of an incident are helpful for prediction and the existence of noisy alerts could destroy the prediction performance and thus how to reduce the influence of noisy alerts is the second challenge.
in addition to accurately predicting the occurrence of an incident an interpretable prediction result should be provided to engineers in order to facilitate them to understand and handle this incident which is also challenging.
to overcome these challenges in this paper we propose ewarn short for earlywarn ing an approach utilizing historical data to predicting incidents in real time based on alert data.
in particular we formulate the problem of incident prediction as a binary classification task of observation windows to be presented in .
where positive and negative samples refer to whether an incident will occur or not within a particular time horizon based on the alert data within the corresponding observation window respectively.
in detail ewarn first conducts feature engineering to extract a set of effective and interpretable features from alert data within an observation window.
then ewarn incorporates multiinstance learning to reduce the influence of noisy alerts by assigning smaller weights to noisy alerts.
next ewarn processes the data imbalance problem due to the small frequency of incidents in practice and builds a classification model via machine learning xgboost .
after getting the prediction result in real time by the learned model an early warning would be sent to engineers if an incident is predicted to occur in the near future.
along with the prediction result ewarn also utilizes lime a state of theart explanation technique to generate a report for engineers to interpret the prediction result in a visualization manner.we conducted an extensive study to investigate the performance ofewarn based on real world online service systems in a large commercial bank named ain this paper due to the double blind policy which supports more than one hundred million users and includes hundreds of service systems.
for each system engineers provided us three year alert data and incidents.
our experimental results show that ewarn performs the best by comparing with the state of the art alert based incident prediction approach i.e.
airalert a novel approach to predicting a specific type of failures based on logs we adapted it to fit our problem i.e.
general incident prediction based on alerts and the current practice of incident prediction with alerts in bank a. for example the average f1 score of ewarn is .
while those of the other three approaches are .
.
and .
respectively.
also our results confirm the contributions of main components in ewarn i.e.
the multi instance learning component the feature engineering component and the classification model building component to the overall performance of ewarn .
in particular we have applied ewarn to two large commercial banks including a and indeed achieved great effectiveness in practice.
we have presented four specific cases in practice and discussed lessons learned in .
to sum up this work has the following major contributions we propose an effective and interpretable approach called ewarn to predicting general incidents in real time based on alert data which could send an early warning signal about an incoming incident including an interpretable prediction result for engineers to facilitate them to adopt proactive actions to avoid the incident in advance.
we conduct an extensive study based on real world online service systems engineers provided us three year alert data and incidents for each system by comparing state of the art incident prediction approaches and the current practice for incident prediction based on alert data.
our experimental results demonstrate the effectiveness of ewarn and confirm the contributions of main components in ewarn .
we have applied ewarn to two large commercial banks both of which support more than one hundred million users and indeed achieved great effectiveness.
we also shared four specific cases during the practical usage of ewarn .
motivation problem formulation .
background alert and its management for online service systems alerts are a key data source for recording the anomalies generated from various system components.
more specifically monitoring systems continuously collect various data e.g.
metrics logs and traces from various service components and engineers manually define many rules to check these monitoring data to ensure service availability.
when a certain rule is violated an alert would be generated to report the anomaly.
for example when a metric e.g.
cpu utilization exceeds a pre defined threshold or some keywords e.g.
error failed or timeout appear in logs alerts would be generated.
table shows examples of alerts from epay service in bank a. each alert has many attributes and we only show several important attributes due to the space limit.
in this table the columns represent the occurring time of an alert the detailed textual description about an alert thereal time incident prediction for online service systems esec fse november virtual event usa table examples of alerts with multiple attributes time content server service severity type others authentication failure for snmp request from host p13.
p10 epay network ... can t get weblogic queue epayapp .
timeout.
p31 epay middleware ... the utilization of file system home etl441 is exceeding .
p72 epay os ... business success rate is lower than .
p2 epay application ... server generating an alert1 the service generating an alert the severity of an alert refers to the highest severity the type of an alert respectively.
due to the importance of alerts an alert management system is important for service system maintenance.
usually when alerts are sent to the alert management system the system handles them by three main steps alert pre processing which filters out duplicate and redundant alerts by the means of alert denoising compression and or correlation .
alert diagnosis which prioritizes alerts and then assigns each alert to the responsible team and engineers in the team diagnose it as soon as possible .
alert post processing which writes diagnosis reports and gains insights to guide the future improvement of alert management.
.
practice of incident prediction with alerts by communicating with our industry partners i.e.
two top commercial banksaandbin the country both of them confirmed the importance and feasibility of incident prediction based on alerts so that some proactive actions can be adopted in advance to avoid incidents and the corresponding economic loss.
moreover both of them have tried to adopt some simple methods to predict incidents based on alerts in practice.
the practice of incident prediction with alerts in ais that they use the technique of association rule mining e.g.
fpgrowth to automatically discover omen alerts for incidents.
for example if an alert always happens before an incident this alert would be used to predict the incident.
however according to feedback from engineers this method can only cover a very small set of incidents since most incidents do not have frequently associated alerts and cannot be accurately predicted in this way.
the practice of incident prediction with alerts in bis that they devote many efforts to manually summarize a set of prediction rules based on their experience and domain knowledge.
table presents some examples of rules summarized for incident prediction in b. taking the first one as an example no.
if the alerts with the keyword tcp is not responding appear at least once matching last for at least three minutes duration involve four different servers servers and do not happen in the period of software change change engineers infer that the involved servers would be down incident .
however the rule based incident prediction method performs not well in practice due to the following reasons.
first it is time consuming and tedious to manually summarize these rules from a large amount of historical data.
second the design and maintenance of the rules require experienced experts with rich domain knowledge and in the meanwhile different engineers tend to have their own preference when designing rules.
third the 1due to confidentiality we do not disclose the ip addresses and use p to denote different servers.
observationwindowwpredictionwindow t leadtimet currenttimetime?tt t t t t t wfigure problem formulation of incident prediction rule based method cannot adapt to the dynamic environment and concept drift can largely affect manually summarized rules causing that engineers have to spend many efforts in manually checking and re summarizing the rules.
in summary it is indeed important to predict incidents based on alert data but the current practices are very unsatisfactory.
thus it is necessary to propose an effective automatic incident prediction approach based on alert data largely motivating our work.
.
problem formulation motivated by existing related works we formulate the problem of incident prediction as time window classification .
we use figure to illustrate the problem formulation.
to ensure the real time online prediction we adopt the strategy of moving time window with size wand a fixed step t. for the current time t we get the observation window .
then we use alert data within the observation window to predict whether an incident will occur within the prediction window .lead time tl in figure is the minimum time interval that engineers need to react to an early warning e.g.
master standby switch .
that is we have to leave enough time i.e.
lead time for engineers to handle the early warning after predicting an incident.
to complete the prediction task collecting training data is required.
in historical data if there is an incident occurring within the prediction window the corresponding observation window is labeled as a positive sample i.e.
an omen window .
otherwise it is labeled as a negative sample i.e.
a non omen window .
note that we adopt the moving window strategy to ensure realtime prediction and thus an incident could appear in several prediction windows since ttends to be smaller than tp some prediction windows have overlaps .
that is we could obtain several adjacent positive windows omen windows for an incident and the number of positive windows is tp t. the larger smaller the size of a prediction window is the more less positive windows we can obtain.
that is the value of tpcould directly affect the labeling quality which will be discussed in detail in .
.
other parameter settings i.e.
t w and tl will be presented in detail in .
.
.
approach in this section we propose a real time and lightweight approach named ewarn short for earlywarn ing to predicting incidentsesec fse november virtual event usa nengwen zhao and junjie chen et al.
table illustrating examples of rule based incident prediction with alerts no.
keywords matching severity duration servers change incident tcp is not responding 3min no server may be down cpu currently 5min no system performance degradation sessions exceeds threshold 5min no transaction with long response time historicalalertdataincidentticketstrainingdatafeatureextractionfeatureaggregationfeatureengineeringwithmilonlinedataclassifierearlywarning trainingprediction interpretableanalysis figure overview of ewarn in advance based on alert data.
according to .
for a system we collect a set of time windows i.e.
observation windows with historical alert data and their labels as training data.
however to solve the problem ewarn has to overcome the following challenges since an alert contains many attributes presented in .
which alert information should be identified as the features for effectively predicting incidents is the first challenge since an observation window contains a number of alerts and not all the alerts are helpful to anticipate incidents how to reduce the influence of noisy alerts is the second challenge after predicting an incident it is also important to interpret the relationship between the predicted incident and the alerts in the observation window which is helpful for engineers to understand and handle this incident in practice and is also the third challenge.
figure shows the overview of ewarn .ewarn consists of four main steps.
first ewarn conducts feature engineering to identify a set of effective and interpretable features from alert data in an observation window to overcome the first challenge.
second ewarn incorporates multi instance learning mil to distinguish helpful alerts and noisy alerts in an observation window to overcome the second challenge.
third based on the set of training data with identified features and labels ewarn further processes them i.e.
dealing with class imbalance and builds a classification model via machine learning which is used to predict whether an incident will occur within a prediction window based on incoming alert data in real time.
fourth after predicting an incident ewarn sends an early warning to notify engineers.
in the meanwhile ewarn adopts lime a state of the art explanation technique to interpret the prediction results for engineers to facilitate the understanding and handling of the incident which is used to overcome the third challenge.
in the following we present each step in detail.
.
identifying features we identify two types of features from alert data to predict incidents inewarn i.e.
textual features and statistical features .
.
.
textual features.
as shown in table the most informative attribute in alert data is its textual content and the rule based incident prediction method also focuses on the alert content keywords in table .
therefore we extract textual features from alert contents as the first type of features in ewarn .
in the literature many existing methods have been proposed for textual feature extraction or text representation which canbe divided into two categories.
the first one is statistical method such as term frequency inverse document frequency tf idf and topic model which are based on word frequency.
the second one is neural network based method such as word2vec textcnn and fasttext .
here we choose topic model in the first category to extract textual features in ewarn due to the following reasons.
first the neural network based methods depend on a huge amount of training data and suffer from high computation costs.
moreover it is difficult to gain interpretable insights from black box models built via neural networks.
second the classical tf idf method could produce a very high dimensional feature vector leading to the curse of dimensionality problem in machine learning.
in particular ewarn adopts the widely used topic model latent dirichlet allocation lda to extract textual features.
in lda each document referring to all the alert contents within a time window in ewarn is viewed as a mixture of various topics with different probabilities and the topic probability distribution is used as the feature vector of the time window.
each topic is characterized by a distribution of words that frequently co occur in the document.
hence lda can find hidden semantic information existing in the window which is helpful for incident prediction since positive windows may have similar topic distributions.
more specifically ewarn first treats all the alert contents within a time window as a document by concatenating these contents after stop words removal and tokenization then uses historical time windows to build an lda model and finally obtains feature vectors based on the lda model for both incoming time windows and historical time windows.
note that lda requires an input i.e.
the number of topics denoted as k .
the setting of kshould consider the trade off between more coarse grained smaller k and more fine grained topics larger k .ewarn determines the number of topics based on thecoherence score which is a popular metric to evaluate the quality of output topics and the corresponding keywords.
as a result after feature representation via lda ewarn obtains the textual feature vector with kdimensions for each time window where each element refers to the probability of each topic.
.
.
statistical feature.
in addition to textual features extracted from alert contents inspired by table some other attributes are also important for incident prediction and we identify them as the second type of features in ewarn called statistical features .
in particular we summarize the extracted statistical features in ewarn into the following four categories alert count refers to the number of alerts that occur within a time window including the total number of alerts the number of alerts with different severities the number of alerts with different types e.g.
application database memory middleware network hardware etc.
.
we infer that the more alerts there are in the window the more likely incidents will occur.real time incident prediction for online service systems esec fse november virtual event usa window time refers to the time of a window.
considering the occurrence of incidents may be related to time e.g.
some incidents tend to occur during business hours we collect a series of time features including hour of the day weekend or not day of week business hours or not etc.
inter arrival time refers to the average time interval between contiguous alerts in a time window.
intuitively if alerts occur more intensively an incident is more likely to occur.
others .
inspired by table and domain knowledge we also consider additional features such as the number of alerting servers during a time window the more servers involved the more likely an incident will occur whether in the software change period software change is error prone and needs more attention .
in summary all these features used in ewarn are identified based on careful data analysis and domain knowledge from experts.
discussions with several industry partners demonstrate the generality of these features in ewarn .
furthermore ewarn also supports adding or removing some features according to the application scenarios but the core idea and pipeline of ewarn are general.
in particular we also conduct an experiment to investigate the performance of each type of feature which will be presented in .
.
.
.
bypassing noisy alerts via multi instance learning usually features are directly extracted from each observation window.
however not all alerts in an observation window are helpful to predict incidents and the omen alerts may be flooded in the nonomen alerts.
due to the existence of noisy alerts in an observation window directly extracting features from the observation window could lead to performance degradation .
to reduce the influence of noisy alerts ewarn adopts multiinstance learning mil .
it splits an observation window into multiple small instance windows where an observation window is regarded as a bag and each bag contains multiple instances i.e.
instance windows .
mil explores more fine grained time windows i.e.
instance windows with size ti to bypass noisy alerts.
that is under the framework of mil ewarn first extracts features from each instance window instead of extracting features from the whole observation window and then aggregates the features of these instances into the features of a bag that is used for building a classification model.
if an instance window does not contain many helpful alerts it is feasible to assign a small weight to the instance during the aggregation process and thus reduce the influence of noisy alerts.
in the following we present the brief background of mil and how to aggregate instance features to a bag feature.
brief background of mil.
mil assumes that negative bags contain only negative instances and positive bags contain at least one positive instance.
formally let ybe the label of a bag xcontaining a set of instances x x1 x2 xm .
each instance xicorresponds to a label yi.
the label of the bag is given by y if yiyi if yiyi .
for incident prediction it is also more reasonable to assume that at least one instance before the occurrence of an incident carries an omen signature than to assume that all the instances in theobservation window carry an omen signature which is another reason why mil is helpful to reduce the influence of noisy alerts.
clustering based feature aggregation.
there are some existing works about bag feature aggregation in the field of mil e.g.
simple feature averaging or using minimum maximum feature using neural network to learn instance weights and adopting some statistical methods to compute instance weights .
inewarn it directly uses feature averaging to obtain bag features for negative bags since all the instances in a negative bag are nonomen and they would share the same weight.
for positive bags the instances that contain many omen alerts omen instances should be assigned to larger weights while the instances that contain a lot of noisy alerts non omen instances should be assigned to smaller wights.
here ewarn distinguishes omen alerts and noisy alerts by the method of clustering based on the observation that omen instances tend to be similar and appear more than once in training data while non omen instances tend to be various and even chaotic.
more specifically ewarn adopts hierarchical clustering to cluster the instances from all the positive bags in training data.
actually ewarn is not specific to this clustering algorithm and we choose it since it does not require to pre define the number of expected groups.
with our above mentioned observation we suppose the clusters with more instances are more likely to be the clusters of omen instances and thus the instances in these clusters should get larger weights while the clusters with few instances also called outliers in clustering are more likely to be the clusters of non omen instances.
formally for the bag x x1 x2 xm the weight of the instance xi i .
.
.
m is calculated as wi w i m j 1w j w i n cxi n where the left formula aims to normalize the weight w i cxiis the cluster that xibelongs to n cxi is the size of the cluster cxi mis the number of instances in this bag and nis the total number of instances from all the positive bags in training data.
for the instance windows in testing data with unknown bag labels we assign each instance window to the corresponding cluster based on the distance between the instance to each cluster center and the weight can also be obtained using eq.
.
after obtaining the weight of each instance in a bag the aggregated feature for this bag is calculated as fb m i wi fi where fiis the feature of the instance xi.
we also conduct an experiment to investigate the necessity and effectiveness of mil in ewarn which will be presented in .
.
.
.
building a classification model after obtaining bag features ewarn will build a classification model via machine learning.
before that it first addresses the problem of data imbalance.
more specifically for an online service system the occurring frequency of incidents is very low otherwise the service quality and user experience would be destroyed.
therefore the number of positive observation windows and negative ones are very imbalanced which leads to a significant challenge to theesec fse november virtual event usa nengwen zhao and junjie chen et al.
currenttime 00warning there is a probability of .76that incidentof longresponsetimeofthisservice willoccurduring10 .pleasetakeactions!predictionprobabilitynegpos0.
.76topi c 27oracle aas averageactivesession sql lock connection...topi c 5switch port unaccessible network ping...topi c 4response packet order accounting communication...topic .5topic .08topic .01level31weekend0hour101topic .00server2negpostopic .01topic .01topic .01level30.00weekend0.00hour100.00topic .00server0.00lowhighfeaturecontributionfeaturevalue topi candkeywords1 figure an example interpretable report on a prediction objective of simultaneously achieving both high precision and high recall for machine learning based incident prediction.
to better handle imbalance data ewarn adopts the widely used smote oversampling strategy to balance the positive samples and negative ones in which the minority class positive windows is over sampled by creating synthetic examples through finding k nearest neighbors along the minority class.
in particular we also conduct an experiment to show the effectiveness and necessity of adopting smote in ewarn which will be presented in .
.
.
based on the processed training set ewarn adopts the gradient boosting tree based model xgboost to build a classification model.
xgboost is fundamentally a regression tree that has the same decision rule as the traditional decision tree model.
some of the major benefits of xgboost are its high scalability parallelism efficiency and outstanding performance.
besides tree based models naturally have the ability of feature selection.
with the built classification model in the running process of the system ewarn predicts whether an incident will occur within the prediction window in real time based on the current observation window.
.
interpretability analysis when an incident is predicted by ewarn an early warning will be sent to notify engineers so that they can adopt some proactive actions in advance.
in addition ewarn also provides an explanation report about the prediction along with the early warning to facilitate engineers to understand and handle this incident in practice.
here ewarn adopts local interpretable model agnostic explanations lime to explain a prediction result by providing relative feature contributions for a single sample to the prediction result.
more specifically lime is developed to identify an interpretable model that is locally faithful for each individual prediction.
it learns a locally weighted linear model on this neighborhood data to explain each of classes in an interpretable way.
we illustrate an example report for engineers generated by ewarn in figure .
the generated report contains four parts.
the first part reports the predicted probability that an incident will occur within the prediction window based on an observation window.
the second part reports feature contributions whose values are the weights calculated by the linear model in lime approximating thetable statistical information of datasets system alerts incidents positive negative s1 s2 s3 s4 s5 s6 s7 s8 s9 s10 s11 behavior of our xgboost classifier .
the value of each feature is presented in the third part ranking based on feature contributions.
the report also contains detailed information corresponding keywords of each topic the fourth part so that engineers can understand each topic intuitively.
in particular the most important feature may be related to the root cause of the predicted incident which may assist engineers in incident troubleshooting.
for example the most important feature in this example is topic whose keywords are all related to database and thus we infer that the root cause comes from database we will discuss the real case in detail in .
.
therefore with an explainable report engineers not only benefit from early warnings of incidents but also gain some inspiration for incident diagnosis.
evaluation in the study we aim to address the following research questions rq1 how does ewarn perform in predicting incidents?
rq2 does each main component in ewarn contribute to ewarn ?
rq3 how does ewarn perform in terms of efficiency?
rq4 how the choice of parameters affects ewarn ?
.
experimental setup .
.
dataset.
in the study we used representative online service systems from bank a which supports more than one hundred million users and includes hundreds of service systems we do not disclose the service names due to the confidentiality in the bank.
.
for each system engineers provided us three year alert data and incidents.
table presents the details of the datasets used in our study including the number of alerts the number of incidents and the number of positive negative windows for each online service system.
note that if an observation window contains too few alerts i.e.
less than alerts it is virtually impossible to extract either the omen pattern or the non omen pattern from it and thus we discarded these windows in the study.
we split these data into training validation and testing sets with a ratio of in the chronological order.
note that the positive samples and negative samples are indeed imbalance ranging from to .
.
.
measurements.
in the study we adopted the widely used classification metrics i.e.
precision recall and f1 score as our measurements.
precision t p t p f p measures the percentage of incidents really occurring within the prediction windows among all the predicted incidents.
recall t p t p f n measures the percentagereal time incident prediction for online service systems esec fse november virtual event usa of incidents that are correctly predicted in advance among all the incidents.
f1 score is the harmonic mean of precision and recall.
in addition a classification threshold is required to give a binary result from probability and compute precision recall and here we decided the threshold based on the best performance on the validation set.
actually false negative is much severer than false positive for incident prediction since the cost of missing an incident is much larger than that of investigating a false alarm.
therefore we pay more attention to recall in our study.
furthermore considering the practicability of our proposed approach in the real world we also measured the time efficiency of ewarn .
we recorded the time spent on the offline training stage which learns a classifier for observation window classification and the time spent on the online prediction stage which provides a prediction result for the current observation window in real time.
.
.
parameters and environment.
there exist several parameters in the problem formulation of ewarn i.e.
observation window size w step of moving window t lead time tl prediction window size tp and instance size ti .
based on grid search of parameters and the discussions with our industry partners i.e.
banks aandb we set t 10min ewarn conducts a prediction every minutes w 60min tl 10min andti 10min.
the selection of prediction window size will be discussed in .
.
about the parameters in ewarn the number of topics is decided based on coherence score presented in .
.
.
the positive samples are oversampled by smote with a sampling rate.
we used the default settings of xgboost provided by the xgboost library .
for the compared approaches to be introduced in .
we set the support threshold in fp growth to be .
and used the parameter settings of airalert and tf idf lstm provided by their papers respectively .
for the hyperparameters of textcnn .
.
we set them as follows the word embedding size is the kernel size and stride of d convolution layer are and respectively the pool size and stride of the average pooling layer are and respectively the hidden size of the fully connected layer is .
for the hyperparameters of fasttext .
.
we set them as follows the embedding model is cbow the size of the context window is and the size of word vectors is .
for the compared deep neural network method for building a classification model .
.
we used three fully connected layers and the hidden size is .
all these three neural network based methods adopt the adam optimizer with the learning rate of .
and epochs.
we set these hyperparameters based on the grid search and the validation set.
ewarn and all the compared approaches are implemented by python with widely used libraries including numpy pandas scikit learn xgboost and keras .
our study was conducted on ubuntu .
.
with core intel xeon r cpu e5 v3 .40ghz gb memory bit operating system.
.
overall performance of ewarn to answer rq1 we compared ewarn with the following existing approaches to demonstrate the effectiveness of ewarn in incident prediction based on alert data.
airalert which is the state of the art alert based incident prediction approach uses the number of different kinds of alertswithin an observation window as features and utilizes xgboost to conduct binary classification.
tf idf lstm is proposed to predict a specific type of failure cluster failure based on log data which can be adapted to our problem incident prediction based on alert data .
it uses tf idf to extract textual features from the observation window and uses long short term memory lstm to predict incidents.
although some other recent works also focus on predicting a specific type of failures they are designed for a specific scenario and thus cannot be applied to alert data.
fp growth is a classical association rule mining method and can be used to predict incidents by mining the correlated alerts that always occur before incidents occur.
this approach is the practice of bank apresented in .
.
more specifically it mines the frequent alerts with high support and confidence from historical data before the occurrence of incidents.
during the process of online prediction once these alerts occur it predicts that an incident will occur within the prediction window.
table shows the precision recall and f1 score comparison results between ewarn and these compared approaches for online service systems.
from this table we find that ewarn outperforms all the three compared approaches on average in terms of all the measurements i.e.
precision recall and f1 score .
in particular the best f1 score of ewarn achieves .
and its average f1 score is .
while the average f1 score of airalert tf idf lstm and fp growth is only .
.
and .
respectively.
please note that not the incidents of all systems can be predicted with very high precision and recall e.g.
s3 and s8 .
this is because some incidents may occur by chance due to some unexpected factors and thus can not be predicted in advance which will be discussed in detail in .
.
besides considering false negative is more important than false positive in our problem ewarn indeed achieves stably high recall compared with the three compared approaches in general.
in particular the worst recall of ewarn is .
while the worst recall of airalert tf idf lstm and fp growth is .
.
and even respectively.
actually ewarn can achieve higher recall e.g.
recall with no false negatives by tuning the classification threshold but this will also lead to precision degradation.
we further analyzed the reasons why the compared approaches perform not well.
for airalert it only utilizes the number of each kind of alert as features which cannot represent the complex alert data very well.
the hidden semantic features of alerts alert time and some other information should also be considered.
tf idflstm extracts textual features by tf idf which is based on only word frequency and in the meanwhile tf idf could produce highdimensional feature vectors which is unfriendly for classification.
besides the moving time window formulation in ewarn presented in section .
has considered the time dependency and thus lstm cannot make additional contributions to the performance compared with ewarn and it also increases the computation costs to be presented in .
.
for fp growth it performs rather poorly since omen patterns are very complicated and cannot be captured by simple alert matching.
besides since an alert data has multiple attributes shown in table and the alert content has many parameters e.g.
different metric values ports api names ip addresses etc.
it is very hard to find frequent alerts from historical positiveesec fse november virtual event usa nengwen zhao and junjie chen et al.
table precision p recall r and f1 score f comparison between ewarn and compared approaches approach ewarn airalert tf idf lstm fp growth w o mil system p r f p r f p r f p r f p r f s1 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s2 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s3 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s4 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s5 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s6 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s7 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s8 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s9 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s10 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
s11 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
average .
.
.
.
.
windows.
more importantly all of the three approaches do not deal with the negative effect caused by noisy alerts.
overall compared with the three approaches ewarn is indeed able to predict incidents with higher precision recall and f1 score.
.
contributions of main components to answer rq2 we investigated the contributions of three main components in ewarn to its overall performance including the multi instance learning formulation the feature engineering component and the classification model building component.
.
.
contribution of multi instance learning formulation.
as presented in .
ewarn adopts multi instance learning to reduce the influence of noisy alerts.
to investigate the contribution of mil in ewarn we compared ewarn with a variant of ewarn that directly extracts features from each observation window without splitting it into multiple instance windows.
the last column w o mil in table shows the performance of the variant of ewarn .
we find that the variant of ewarn without mil indeed performs worse than ewarn in terms of all the measurements i.e.
precision recall f1 score in general.
in particular the average f1 score drops from .
to .
after removing mil from ewarn .
in the meanwhile the performance of the variant of ewarn is the same as that of ewarn for two online service systems i.e.
s6 and s9 probably because there are little noisy data for them.
overall our multi instance learning formulation is indeed effective to bypass noisy data and is able to improve the f1 score by nearly on average.
.
.
contribution of feature engineering.
faced with complex alert data with multiple attributes ewarn extracts a set of powerful features to represent alert patterns including textual features and statistical features.
to demonstrate the contribution of our feature engineering we first investigated the effectiveness of each type of feature used in ewarn i.e.
textual features and statistical features .
that is we evaluated the effectiveness of ewarn using only one type of feature whose results are shown in table the third and fourth columns .
we find that ewarn incorporating both kinds of features achieves an average f1 score of .
while the average f1 score ofewarn with only textual features is .
and that of ewarn with only statistical features is only .
.
the results demonstrate thetable f1 score comparisons to demonstrate the effectiveness of feature engineering in ewarn system ewarnonly textualonly statisticaltextcnn fasttext s1 .
.
.
.
.
s2 .
.
.
.
.
s3 .
.
.
.
.
s4 .
.
.
.
.
s5 .
.
.
.
.
s6 .
.
.
.
.
s7 .
.
.
.
.
s8 .
.
.
.
.
s9 .
.
.
.
.
s10 .
.
.
.
.
s11 .
.
.
.
.
average .
.
.
.
.
contribution of each type of feature and textual features are more powerful than statistical features for incident prediction.
we then investigated the effectiveness of our white box interpretable method for textual feature representation i.e.
lda compared with two popular black box neural network based textual feature representation methods i.e.
textcnn and fasttext whose results are shown in the last two columns in table .
we find that ewarn using lda significantly outperforms the two neural network based methods.
the average f1 score of the former is .
while those of the latter two are only .
and .
respectively.
this is because the two methods designing for natural language rely on a sufficiently large training corpus.
however strictly speaking alert contents are domain specific it operations and semi structured short texts so the two methods perform not well in our scenario.
more importantly ewarn does not use the two methods since features extracted from these black box models are hardly associated with domain knowledge directly.
in contrast ewarn carefully designs a set of effective textual features and statistical features based on the white box interpretable method and domain experience which not only have physical significance but also can be easily understood by engineers.real time incident prediction for online service systems esec fse november virtual event usa s1 s2 s3 s4 s5 s6 s7 s8 s9 s10 s11 system0.
.
.
.
.
.0f1 scoreewarn dnn rf w o smote figure f1 score comparisons to demonstrate the effectiveness of the classification model building in ewarn .
.
effectiveness of classification model building.
we evaluated the effectiveness of the classification model building in ewarn from two aspects building a classifier via xgboost and handling the data imbalance problem.
to investigate the effectiveness of building a classifier via xgboost in ewarn we compared xgboost with two widely used machine learning algorithms i.e.
deep neural network dnn the used network structure has been introduced in .
.
and random forest rf whose results are shown in figure .
we find that xgboost indeed outperforms the other two algorithms and rf also performs well in terms of f1 score indicating that our features can be modeled well by tree structures.
the results demonstrate the effectiveness of xgboost for incident prediction.
to investigate the necessity of dealing with the data imbalance problem we compared ewarn with a variant of ewarn that does not deal with this data imbalance problem i.e.
removing smote from ewarn whose results are shown in figure w o smote .
we find that ewarn performs better than its variant without smote for all the studied online service systems.
without smote the f1 score ofewarn drops about .
.
demonstrating the contribution of dealing with the data imbalance problem in ewarn .
to sum up our classification model building component in ewarn is effective in both building a classifier via xgboost and handling the data imbalance problem.
.
efficiency as a real time incident prediction approach time efficiency is a vital factor.
for incoming alert data if the prediction result cannot be provided in time it could cause that engineers cannot take immediate actions to prevent the incident.
table presents the average time costs of ewarn and three compared approaches for all the online service systems including offline learning time and online prediction time.
we find that the average online prediction time of all these approaches are quite small i.e.
no more than .
seconds.
that is it is very efficient for ewarn to provide the prediction result for the current observation window.
although the training time ofewarn i.e.
.
minutes is slightly larger than airalert i.e.
.
minutes and fp growth i.e.
.
minutes the time cost is actually acceptable since the training process is conducted offline.
among these approaches tf idf lstm has significantly longer training time up to .
minutes which could take up many resources during training and cannot be conducive to efficiently update the learned model.
overall ewarn has acceptable offline training time and negligible online prediction time indicating that ewarn is indeed practical in the real world.table average time cost comparison between ewarn and compared approaches approaches offline learning min online prediction s ewarn .
.
airalert .
.
tf idf lstm .
.
fp growth .
.
prediction window size0.
.
.
.
.
.0f1 score a s2 prediction window size0.
.
.
.
.
.0f1 score b s8 figure two examples to show the effect of different prediction windows sizes minutes on f1 score .
effect of parameters some parameters in ewarn have been introduced in .
.
.
here we mainly discuss the effect of the prediction window size on prediction performance.
as mentioned in .
the prediction window size tp is a vital parameter since it directly affects the labeling quality.
due to the space limit we took two online service systems as examples to illustrate the influence of tpon the performance of ewarn whose results are shown in figure .
in the figure the x axis represents different prediction window sizes while the y axis represents f1score.
intuitively the size of prediction windows has a significant influence on the performance of ewarn since it directly affects the quality of labeling.
more specifically too large tpmay lead to an increase of false positive observation windows during labeling while too small tpmay lead to missing some positive windows.
from figure the influence of tpis indeed confirmed and also the best tpvaries for the incidents of different systems.
for example the best tpfor s2 and s8 is and respectively.
therefore it is necessary to set an appropriate prediction window size for each system.
in our study we identified the best prediction window size based on the performance on the validation set for each system which is also applicable in practice since the historical data is usually accessible especially in large companies.
more discussions about the prediction window size can be found in .
.
discussion .
success stories .
.
incident prediction.
we have successfully applied ewarn to two top commercial banks i.e.
aandb in the country.
based on the feedback from engineers ewarn is appreciated to be able to successfully assist them to anticipate incidents in advance so that proactive actions can be taken to prevent system unavailability.
in the following we present four success cases collected from practice.
case i long service response time caused by slow sql.
response time is a key performance indicator of a service and long response time would destroy user experience.
root cause of thisesec fse november virtual event usa nengwen zhao and junjie chen et al.
databasecomputationwebserverlongserviceresponsetime serverload network i o logfile ... databasemetrics waitingevent databaseservermetrics ... middlewarerelatedmetrics relatedservermetrics logfile ...incidentrootcauseincidentpredictionincidentdiagnosisservicecomponent figure an example to illustrate the relationship between incident prediction and incident diagnosis incident is database index fault so it took a long time to execute several large sql statements.
before the incident happens ewarn successfully forecasted it based on database related alerts.
case ii frequent failed transactions caused by fullgc.
frequent failed transactions in banks would lead to user complaint and huge economic loss.
more specifically this incident was caused by buggy code imported by a recent software change which created many objects occupying too much heap space and led to frequent fullgc.
it was successfully predicted in advance by ewarn based on some resource metric alerts e.g.
memory usage and jvm heap usage and jvm garbage collection gc log alerts.
case iii success rate of service degradation due to unexpected stress.
for business in banks low success rate is critical and would affect the amount of transactions leading to economic loss.
due to an unexpected burst of user requests cpu utilizations of related servers were influenced.
ewarn effectively captured the omen patterns and predicted the incident accurately in advance.
case iv server hang up due to scheduled tasks.
server hangup is a common incident in the real world because of system overload which would cause related tasks on this server to fail.
in this case running scheduled tasks led to system overload and the server was unresponsive.
this incident was predicted accurately based on the alerts of related server resource metrics e.g.
i o waiting time and cpu utilization .
in summary ewarn has the ability to identify omen patterns from alert data and forecast incidents accurately in practice which can earn some bonus time for engineers to take some proactive actions to prevent the incidents as soon as possible.
.
.
incident diagnosis.
although ewarn is designed for incident prediction it can also assist engineers for incident diagnosis.
even though interpretable results provided by ewarn may not directly pinpoint the root cause e.g.
hardware errors misconfigurations or software bugs of an incident they can provide useful clues to narrow down the search space of diagnosis.
when ewarn gives a positive result the interpretable analysis component will tell engineers which feature makes the largest contribution to the predicted result.
the most important feature may be closely related to the root cause of the incident.
figure takes case i above as an example to illustrate the relationship between incident prediction and incident diagnosis.
ewarn identifies the omen patterns from alert data to predict the incident of long service response time precisely.
also ewarn tells engineers the most important feature i.e.
topic with keywords oracle aas average active session sql etc.
shown in figure .
in this way engineers can infer that the possible root cause is related to database which indeed narrows down the search space of diagnosis.
subsequently they can take further actions to locate the root cause in database and prevent the incident as soon as possible.
.
lessons learned we summarize some lessons learned from our study.
not all incidents can be predicted well in advance.
in spite of the effectiveness of ewarn in predicting incidents we have to admit that not all incidents can be predicted well in advance.
more specifically some sudden incidents caused by unexpected factors e.g.
power outages are difficult to be predicted.
in our study we find that application level high level incidents are much easier to be predicted.
this is because high level incidents are generally caused by faults in low level components e.g.
server database and network.
thus ewarn can identify omen patterns from low level alerts to predict high level incidents.
prediction window size is important for incident prediction.
as presented in .
and .
the size of prediction windows tp has a significant influence on the performance of ewarn since it directly affects the quality of labeling.
in general increasing the value of tpmay increase the probability that an incident is predicted e.g.
when tpis set to simply predicting that an incident will occur would be always correct .
if tpis too large the prediction is useless since it is not clear when exactly the incident will occur.
therefore it is important for incident prediction to set an appropriate prediction window size.
incremental updating.
online service systems are complex and dynamic as developers continuously commit code and introduce new features.
consequently new types of alerts and new omen patterns of incidents may be introduced accordingly.
this may cause significant performance degradation if the prediction model is trained based on a fixed set of historical data.
to make ewarn adapt to the dynamic environment and maintain the prediction performance we build an incremental training pipeline where our model is trained with newly arriving alert data and incidents periodically so that new patterns can be captured properly in time.
besides retraining a model on new data from scratch suffers from high costs but our xgboost based approach can be incrementally updated to achieve stably good performance with negligible cost.
.
threats to validity we identify the following threats to validity in our study subject systems in our study we used alert data and incidents from different systems in a large commercial bank a. however the results might not represent other systems from other companies.
actually it is very challenging to get access to data from companies.
the bank we collaborate is very large scale which supports more than one hundred million users and includes hundreds of service systems and thus we believe our results can demonstrate the value of our proposed approach.
moreover we have applied ewarn to another large bank b besidesa presented in .
further demonstrating the generality of ewarn .
in the future we will reduce this threat by evaluating ewarn on more subject systems.
measurements to demonstrate the effectiveness of ewarn we used precision recall f1 score as measurements which have beenreal time incident prediction for online service systems esec fse november virtual event usa widely used in the prediction problem .
besides we also consider the efficiency of ewarn .
in the future we will reduce this threat by considering more comprehensive metrics such as precisionrecall curve fpr tpr metrics and how far ahead we can raise a true early warning.
noisy in labeling for a well performing machine learning model the training set and testing set should follow the same data distribution.
however some incidents are caused by some other unexpected or external factors where there are no omen patterns before the incidents.
these cases violate the assumption of independent and identical distribution and cannot be effectively predicted in advance.
in our study we ignored the effect caused by other factors and regarded them as positive samples.
in the future we will reduce this threat by incorporating detailed information of incident tickets and engineers experience to remove noisy positive labels.
related work incident prediction.
the most related work to ours is airalert which also aims to predict general incidents based on alert data.
however it just simply considers the number of different kinds of alerts and does not deal with noisy alerts which has been demonstrated to be ineffective in our study.
different from it ewarn systematically overcomes main challenges in alert based incident prediction by careful feature engineering mil for bypassing noisy alerts and an interpretable generated report for a prediction result significantly outperforming airalert in our study.
there are also a great deal of efforts spent on predicting a specific type of failures which tend to be designed for a specific domain .
moreover these works utilize system logs or metrics for prediction.
for example prefix proposed in utilizes switch log data to predict switch failures cdef and ming utilizes related metrics to predict disk failures and node failures respectively.
it is common for a large scale system to generate tens of tbs of logs and more than thousands of metrics per day leading to bringing great challenges to learn and incrementally update a prediction model and consuming a large amount of storage space and computing resources.
different from them our work proposes a novel approach to predicting general incidents based on lightweight alert data which are generated to report anomalies from other monitoring data such as metrics and logs and thus avoid processing massive raw monitoring data.
our experimental results have demonstrated the effectiveness of ewarn .
alert management.
in recent years tremendous efforts have been devoted into alert management in both academia and industry.
as introduced in .
alert management techniques can be categorized into three stages alert pre processing alert diagnosis and alert post processing.
existing works mainly focus on how to reduce the number of alerts alert pre processing .
this is because various service components could generate an overwhelming number of alerts and the majority of alerts are duplicate or correlated.
the popular techniques of alert reduction include alert correlation and alert clustering .
there are also some works about alert prioritization which aims to recommend severe alerts to engineers because the number of alerts is much more than what engineers can properly investigate in practice.
different from them our work aims to utilize alert data to conduct incident prediction.
conclusion we propose ewarn a novel approach to predicting general incidents based on alert data so as to take proactive actions to prevent the incoming incidents and ensure the quality of software services.
three key ideas of ewarn are an effective feature engineering component to deal with complex alert data multi instance learning to handle noisy alerts and interpretable analysis to generate an interpretable report about the prediction result to facilitate the understanding and handling of incidents.
an extensive study on online service systems in a large commercial bank demonstrates the effectiveness of ewarn the average f1 score of .
outperforming three compared approaches.
besides our results also confirm the contributions of main components in ewarn .
in particular real deployments of ewarn in the real world further demonstrating its practical performance.
acknowledgement we thank the anonymous reviewers for their valuable feedbacks.
this work has been supported by the beijing national research center for information science and technology bnrist key projects and national key r d program of china 2019yfb1802504.