studying the useofjava logging utilities inthe wild bo yuanchen york university toronto canada chenfsd cse.yorku.cazhenming jack jiang york university toronto canada zmjiang cse.yorku.ca abstract softwareloggingiswidelyusedinpractice.logshavebeenused for a variety of purposes like debugging monitoring security compliance and business analytics.
instead of directly invoking the standardoutputfunctions developersusuallyprefertouselogging utilities lus e.g.
slf4j whichprovideadditionalfunctionalities likethread safetyandverbositylevelsupport toinstrumenttheir source code.
many of the previous research works on software logging are focused on the log printing code.
there are very few worksstudyingtheuseoflus althoughnewlusareconstantly being introduced bycompanies andresearchers.
in thispaper we conductedalarge scaleempiricalstudyontheuseofjavalusin the wild.
we analyzed the use of lus from projects ingithubandfoundthatmanyprojectshavecomplexusagepatternsforlus.forexample .
ofthe large sizedprojectshave implemented their own lus in their projects.
more than of theseprojectsuseatleastthreelus.weconductedfurtherqualitative studies to better understand and characterize the complex use of lus.
our f indings show that different lus are used for a varietyofreasons e.g.
internationalizationofthelogmessages .
some projects develop their own lus to satisfy project speci f ic loggingneeds e.g.
de f iningtheloggingformat .multipleusesof lus in one project are pretty common for largeandvery large sized projects mainly for context like enabling and con f iguring the logging behavior for the imported packages.
interviewing with industrialdevelopersshowedthatour f indingsarealsogenerally trueforindustrialprojectsandareconsideredasveryhelpfulfor themtobettercon f igureandmanagetheloggingbehaviorfortheir projects.
the f indings and the implications presented in this paper will be useful for developers and researchers who are interested in developingandmaintaininglus.
keywords empirical software engineering logging code logging practices acmreference format boyuanchenandzhenming jack jiang.
.studyingtheuseofjava loggingutilitiesinthewild.in 42ndinternationalconferenceonsoftware engineering icse may23 seoul republicofkorea.
acm new york ny usa 12pages.
permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forpro f itorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe f irstpage.copyrights forcomponentsofthisworkownedbyothersthanthe author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspeci f icpermission and or afee.
request permissionsfrom permissions acm.org.
icse may seoul republic ofkorea copyright heldby the owner author s .
publication rightslicensed to acm.
acm isbn ... .
introduction execution logs a.k.a.
logs have been used widely in practice for a varietyofpurposes e.g.
systemmonitoring failurediagnosis and business analytics .
logs are generated duringruntimebytheoutputstatementsthatdevelopersinsertinto thesourcecode.insteadofdirectlyinvokingthestandardoutput functionslike system.out.print developersprefertoinstrument their systems using logging utilities lus e.g.
slf4j for java andspdlog for c due to additional functionalities like thread safety synchronized logging in multi threaded systems data archival con f iguration automated rotation of the log f iles andverbosity levels controlling the amount of logsoutputted .
unlike many of the software engineering tasks e.g.
code refactoring andreleasemanagement therearenowell de f ined guidelines for software logging.
recently there have been many researchworksdevotedtotheareaofwhere to log decidingthe appropriateloggingpoints what to log providing sufficient execution context in the logging code and how to log developing and maintaining high quality logging code .
however all of these works focus on improvingthequalityoflogprintingcode e.g.
log.info quotedbl.varuser quotedbl.var username quotedbl.var authenticated quotedbl.var .thereareonlytworesearch works on the migration and the con f iguration of the lus.
itis important to study the use of lus dueto these three reasons measuring the adoptions of the lus although there are already many lus available e.g.
new lus are continuously introduced by companies e.g.
flogger from google and researchers e.g.
nanolog and log .
it is not clear whether theselus are adoptedandusedinthe wild.
understanding the complex use of the lus incorporating multiplelus inone project may causevarious issues during compilation deployment andruntime .however manysoftwaresystemsstillusemorethanonelusintheir projects .forexample hadoop whichisaverywell maintained popularopensourcebigdataplatform containsnotonlysixexternal lus apache commons logging java.util.logging log4j .x log4j slf4j jetty logging andimplementstheirown luintheirproject.
intellij idea whichisaverypopularide uses12lusintheirproject.itisimportanttostudythisphenomena in order to suggest best practices for the system developers and to identifyfuture directions for the lu designers andresearchers.
assessing the impact of lus on the logging code on one hand the structure of logging code is a result of adopting certain lus.for example itisgenerally recommendedtospecify the logging needs as rules via aspect oriented programming aop constructsto improve system modularity and use centralized logging tosupportinternationalization a.k.a.
outputtingthe logmessagesindifferenthumanlanaguages .ontheotherhand extra care are needed in order to cope with the complex use of lus ieee acm 42nd international conference on software engineering icse icse may seoul republicof korea bo yuan chen andzhenming jack jiang inoneproject.forexample manyprojectsnowadaysreuseexisting functionalitiesbyimportingthird partypackages whichalsouse lus.however thereisnoempiricalstudytoassesstheimpactof the logging code due to the use of the lus.
inthispaper wehaveperformedalarge scaleempiricalstudy ontheuseofjavalusinthewild.wefocusonjava becauseitis currentlyrankedasthemostpopularprogramminglanguageinthe world basedon the tiobeindex .
many popularsoftware systems e.g.
android basedmobileapplications ides webservers andbigdataplatforms areimplemented injavaandloggingisprelevantinthesesystems .wehave examined11 194opensourcejava basedprojectsingithub which uses lus.
we have uncovered four important f indings and implications.toensuretheusefulnessandgeneralizabilityofour f indings from open source systems we also interviewed industrial developers on the use of lus.
we summarize our main contributionsand f indingsas follows thisisthe f irstempiricalstudyonthecomplexuseoflus in the wild.
lus are currently being used by projects in github.thenumberofusedlusincreasesasthesystems growbigger aslarger sizedprojectsusuallyreuseexisting functionalitiesbyimportingthird partypackages whichalso use lus.
many projects also implement their own lus to satisfy project speci f ic needs.
our f indings raise developers awareness onthe complexity of thelus in their systems as well as the need to manage these lus to better monitor and debug systems runtime behavior.
inadditiontothequantitativestudy wehavealsoconducted a qualitative study to understand and characterize the rationalesbehindthecomplexuseoflusfordifferentprojects.
such results can guide researchers to propose more general logging solutions for variouslogging context.
tosupportindependentveri f icationorfurtherresearchon the use of java lus we have provided a replication package inthispaper.thispackagecanbeusefulforother researcherswhoareinterestedinstudyingandimproving the logging practices.
paperorganization.
therestofthispaperisorganizedasfollows.
section provides an overview of our approach and describes our studied projects.
section and quantitatively and qualitatively studytheuseofthelusinthewild.section5explainsourinterview process anddescribes ourobservations.
section 6discusses the signi f icance of our f indings and presents some future work.
section7describestherelatedworks.section8explainsthethreats to validity andsection 9concludes the paper.
overview in this section we will provide an overview of our approach to empiricallystudyingtheuseofjavalusinthewildanddescribe our studiedprojects.
.
ourapproach wefollowedamixed methodsapproachcharacterizedbyasequential explanatory strategy to analyze the use of lus.
we f irst extractedthesourcecodefrompopularjava basedgithubprojects section .
then we performed a quantitative study on measuring the degree of adoption of different lus as well as comparing the numberofusedlusacrossdifferentprojects section3 .wealso tracked the number of projects which also implement their own lus.afterwards weperformedaqualitativestudy section4 by manuallystudyingtheuseoflusamongdifferentprojects.since our study is performed on open source projects we also crossvalidatedour f indingsbyinterviewing13experienceddevelopers whowork oncommerical systems section .
.
studied projects to studytheuse ofjavalus inthewild we focused on analyzing java basedprojectsfromgithub.githubiscurrentlythelargest codehostingsitewithmorethan100millionprojectsasofapril .webuiltalocalghtorrent databasefromthemysql dump.thisdatabase whichwaslastupdatedon2019 containsthemetainformationofaprojectsuchasthecorresponding github url the project name and the main programming language s .
we extracted a list of github urls for all the java based projectsfor post processing.
we further f iltered the list of github projects to avoid potential perils in our analysis .
one github project may be forked or clonedbyothers whosesourcecodecanbeidenticalorverysimilar totheorignalone.thiswouldintroducenoiseintoourstudy.hence we only selected projects which are neither a fork nor a clone of other projects.
furthermore the number of stars that a project has indicatesitspopularity.similartopriorworks wefurther f ilterd the list of projects to ensure they have at least or more stars.
we endedup with25 javaprojects.
we downloadedthe sourecodeforthemostrecentreleasesoftheseprojectsbyinvoking the githubapis.
quantitative study in this section we f irst analyzed the selected projects to identify thelist of lus thatare used.then we measured the degree of lus whichareadoptedandused.finally wecomparedtheuseoflus among differentprojects.
.
identifying lus in each project wedevelopedaheuristic basedtechniquetoidentifylusineach project.first weexcludedjava f iles whichwereeitherina test folder or containing the keyword of test in their f ile names as they are probably not related to the core features of the projects under study.
then we used jdt to parse the remaining java f ilestoidentifya listof importedstatementsand functioninvocations for eachjavaclass.we made sure these imported classes are used by checking if there is one or more methods been invoked in that class.
we further f iltered the list of import statements in each java class so that only packages or java classes whose names contain patterns like logging logger or .log.
were kept.
these packagesorclassesareconsideredaslus.forlogginginaspectoriented programming aop we f irst identi f ied java f iles with import statements that contain aspectj .
since aspectj can do more thanlogging we subsequently parsed the java f iles to check whether they use any ofthe lus identi f iedbythe above rules.
398studying the use of java loggingutilities in the wild icse may seoul republic of korea if a project used more than one lus and their package names weresimilar wemergedthemasonelu.forexample ifthefollowingtwolus foo.bar.baz.consolelogger andfoo.bar.baz.file logger wereidenti f iedinoneproject wemergedthemintoone lu foo.bar.baz .
toverifythecorrectnessofourheuristic basedtechnique we randomly sampled f iles and manually examined the identi f ied lus.
our technique yield an precision of .
some of the java classes are misclassi f ied as lus as the identi f ied log related java classes did not implement log printing functions.
for example loggerprovider.java intheninjaframework wasnot considered as an lu since this class did not provide any log printing functions other than a utility function that returns an slf4j logging object.
.
measuringtheadoptionsoflus we further classi f ied the size of these projects into the following f ivebinsbasedontheirnumberofjavaclassesusingthede f initions from .
table shows the results.
for example there are a total of761large sizedprojects whosenumberofjavaclassesisbetween and .
among them projects a.k.a.
.
adopt oneor morelus.thereis acleartrend ofincreasingadoptionsof lus as the size of the projectsgetbigger.
forthesubsequentstudies weremovedalltheprojectswhich didnotuseanylus sincetheyarenotrelevanttothispaper.we alsoexcludedtheprojectswhosesizewas verysmall asmanyof them are not considered as useful projects e.g.
trial projects for self studying andcollectionsofcodesnippets .after f iltering there were11 194javaprojectsremaining whichused3 856distinctlus.
table measuring the adoptions of lus among the javabased githubprojects.
bins total of ofprojects ofclasses projects used lus very small .
small .
medium .
large .
very large .
total .
.
comparingtheuse oflus amongprojects depending on where these lus were implemented we further classi f ied the list of used lus in each project as external lu elu s orinternal lu ilu s. it is an elu if the implementation of this lu is not inside the project under study.
otherwise it is an ilu.
for example hadoopuses f ive different elus apache commons logging java.util.logging log4j .x log4j slf4j jetty logging and implements its own ilu which is mainly used for auditingpurposes.table2showstheresultsofthepercentageof projectsthatuseelus ilus orboth.forexample amongallthe 728large sized projects that used lus .
of them are elus .
ofthemimplementedtheirownilusintheirprojects and05101520 mall edium arge arge size number of lus figure1 thedistritbutionsofthenumberofadoptedlus in each projectgrouped by the sizeofthe projects.
.
used bothtypes of lus.
overall there are elus used by projects.
.
of the studied projects have implemented their ownilus.
thepercentageofprojectsthatadoptedelusandilusshown inthesecondandthethirdcolumnsincreasesasthesizeofprojects increases.
when comparing the lus within the same bins there arealwaysmore projectsusingelusthanilus.however almost allofthe verylarge sizedprojectsimplementedtheirownlus.the combineduseofilusandelusalsoincreasedramaticallyasproject sizes become largeorverylarge.
table comparing the complexity of the uses of lus among projects.
project ofprojectsusing size e lu ilu both small .
.
.
me dium .
.
.
large .
.
.
very large .
.
.
total .
.
.
we further examined the number of lus that were used in each project.
for each project we counted the number of lus which included both elusand ilus.we grouped projects based on their sizesandvisualizedtheirdistributionsusingboxplotsinfigure1.
the width of the boxplot is proportional to the number of projects in that group.
since there are much more small sized projects in ourstudy itisthewidest.thereddashedlineconnectsthemedian points for eachbin.
the medianusagefor the small sizedprojects is one.
it increases as the size of the project increases.
for the very large sized projects the median number of lus used is four.
the project that adopts the biggestnumber of lus is within the group ofverylarge sizedprojects.
it isan enterprise webplatform in which21 lus are used!
399icse may seoul republicof korea bo yuan chen andzhenming jack jiang we conducted a kruskal wallistest to statistically checkif their distributions are identical.
the p valuewas smaller than .
whichindicatedstatisticallysign f icantdifferencesamongthedistributions of lus across different project sizes.
this clearly demonstrates the complexityof the use of lus in our studiedprojects.
the f indingsinourquantitativestudiesmotivatedustoconduct the subsequent qualitative studies section to f igure out the rationales behindthem.
findings thereare3 856lus ofwhich866areelus being usedbyover11 000projects.
.
ofthestudiedprojectsadopt atleastoneeluand26.
adoptatleastoneilu.
astheproject sizebecomes larger morelus willbeintegrated intothe project.
this isespeciallythe casefor largeandverylarge sizedprojects.
implications the lus are used widely among different java projects.however asthesizeoftheprojectincreases thecomplexitityoftheuseoflusalsoincreases.multiplelusareusedinmany of themediumtovery large sized projects.
this is contradictive to the common understanding of developers and researchers asonlyahandfulofpopularjavalus e.g.
log4j .x log4j and slf4j are comparedanddiscussed.
qualitative study in this section we conducteda qualitativestudy onthe useof the lus.wemanuallyexaminedtheirsourcecodeinordertoanswer the following rqs rq1 whataretheexternallusbeingusedinthewild?
asshowninsection3 therewere866elusbeingusedby projects.
the goal of this rq is to characterize the rationales of differentelus.
rq2 whydodevelopersimplementilusintheirprojects?
.
ofthe studiedprojects have implementedtheir own internal lus.
this is especially the case for the largeorvery large sizedprojects inwhich75.
and .
ofthemcontainilus.thegoalofthisrqistoextracttheproject speci f ic logging needsby studyingthe use of ilus.
rq3 how are multiple lus used in the wild?
manyof the studied projects especially for the largeorvery large sized projects use multiple lus.
the goal of this rq is to characterizetheusagecontextassociatedwithusingmultiple lus inone project.
.
rq1 whataretheexternallus beingused in thewild?
in this rq we will characterize the rationales behind the use of individualelus.foreachelu wecalculatedthenumberofprojects that adopted it.
we sorted elus by their popularities a.k.a.
the numberofprojectsthatusedthem andselectedthetop 100most popular elus whichare used by95 of the studiedprojects.
foreachofthese100elus wemanuallyexaminedtheonline documentation release notes and blog posts for these elus to understandtheirfeaturesandcapabilities.thenwestudiedthesource codeoftheprojectswhichusedthemtoextracttheirusagecontext.
our f indings are summarized in figure .
generally there are four reasons behind the use of elus general purpose logging lu interactions internationalization and modularization.
.
.
general purposelogging.
general purposelogging refersto themostcommonloggingusagecontext whichrequires verbositylevels whicharetocontroltheamountoflogmessageoutputted con f igurations whichareusedtospecifyvariousoptions and policies to format and output the logs and thread safety which is to ensure the logs are recorded in sequence for a multithreadedsystem.
amongthetop 10most popular lus 8are forgeneral purpose logging.sixelus slf4j log4j .x log4j java.util.logging apache commons logging andlogback areconsideredasgeneralpurpose lus for desktop or server based systems and two elus android.util.log and timber are general purpose lus for android based systems.
as shown in figure a log printingfunctionfromageneral purposeelugenerallyconsistsoffourparts theloggingobject log theverbositylevel debug thestatictexts describingtheloggingcontext quotedbl.varparsing file quotedbl.var andthedynamic contents revealingthe runtimeinformation file .
among all the desktop or server based elus slf4jis the most popular elu due to its improved performance and compatibility withotherlus .therearemanyandroidprojects in our study.
most of them are small sized projects that used the defaultelufrom android sdk i.e.
android.util.log .
.
.
lu interactions.
lu interactions concerns about con f iguratingandcontrollingtheloggingbehaviorfortheimportedpackages.
many java based projects are built on top of existing packages many of which contain ilus.
in order to con f igure and control the logging behavior for one imported package developers have to invoketheloggingapisfromthispackage.forexample 161projects use theokhttp3 to send and receive data from network.
in order to enable logging for the okhttp3 package developers of thebitcoin wallet project whichisabitcoinpaymentapp forandroid invokesthe addinterceptor methodfrom okhttp3 s ilu as shown in figure .
out of the top elus in this study are used for thisreason.
hence lu interactions is the main reason why there are somanyelususedin the wild.
.
.
internationalization.
internationalization concernsaboutadaptingthelogstootherhumanlanguages e.g.
germanorchinese .in ordertosupportinternationalization developers f irstneedtocreate a centralized f ile which stores a list of pre de f ined log message templates.eachofthelogmessagetemplatecomprisesfourparts the verbosity level the parameterized string the logging methods andthe messageid.
the third row of figure shows one such example.
this code snipeetisfrom hibernate orm whichisapopularobject relational mapping orm framework.insidethecentralized f ile coremessage logger.java therearetwoannotations logmessage and message for each logging method and the message id.
logmessage contains a key value pair which de f ines the verbosity level level warn of this log message.
message provides the parameterizedstring whichcontainsthestatictexts i o reported cached file could not be found andplaceholdersforparameters s. the message id is an integer that can be used to uniquely identify thislogmessage.theloggingmethodwhichimplementsthislog messageis cachedfilenotfound .ittakesintwoparameters the f ilepathandtheerrormessage.inordertooutputthislogmessage thecachedfilenotfound methodneedstobeinvoked.thecode 400studying the use of java loggingutilities in the wild icse may seoul republic of korea rationales of top100 elus of projectstop lus where applicable code examples generalpurpose12 .
androi .util.log slf4j lu interactions .
okhttp3.logging.httplog ginginterceptor io.netty.handler.logging.
logginghandler internationaliza tion4 .
jboss logging org.glassfish.jersey.
logging modularization .
aop logging static final logger log loggerfactory.getlogger configuration.class ... log.debug parsing file file coniguration.java hadoop using slf4j around execution org.unitedinternet.cosmo.service .
contentservice.getrootitem .. args user public object checkgetrootitem proceedingjoinpoint pjp user user throws throwable log.debug in checkgetrootitem user ... public class standardcontentservice implements contentservice ... public homecollectionitem getrootitem user user ...securityadvice.java cosmo using aop logging standardcontentservice.java cosmo using aop logging logmessage level warn message value i o reported cached file could not be found s s id void cachedfilenotfound string path filenotfoundexception error ... catch filenotfoundexception e log.cachedfilenotfound serfile.getname e coremessagelogger.java hibernate orm using jboss logging cacheablefilexmlsource.java hibernate orm using jboss logging httplogginginterceptor logginginterceptor new httplogginginterceptor ... final okhttpclient.builder httpclientbuilder new okhttpclient.builder ... httpclientbuilder.addinterceptor logginginterceptor constants.java bitcoin wallet using okhttp3.logging.httplogginginterceptor figure the rationales behindthe use of top most used elus.
snippetin cacheablefilexmlsource.java showsoneexampleof how this log message can be invoked during runtime.
it is used within acatch blockto handle an exception.
to translate the log messages into different human languages developers need to create a translation property f ile and de f ine internationalized labels for each log message.
for example the property f ile log en fr.properties wouldcontainallthefrench labels for allof the above english logmessages.
the most common elu for internationalization is jboss logging .althoughtherearethreeotherelus whichalsosupport this usage context they are just wrappers of the jboss logging.
.
.
modularization.
modularization concerns about improving the modularity of the logging code.
logging code is a cross cutting concern as it inter mixes with the feature code.
only one elu aop based logging is used for this reason.
aop is a programming paradigm which is designed to improve modularity by reducing theamountofcross cuttingconcerns .loggingisconsidered as one of its common use cases.
in order to perform aop based logging developers need to provide rules through aspect f iles.
a typical aspect f ile consists of pointcuts and advice.
a pointcut is to de f ine the point of execution where thecross cutting concern e.g.
logging needs to be applied.
an advice is the additionalcode e.g.logging code instrumented.figure shows a real world example from cosmo a calendar server that implements caldav protocol.
the f ile security advice.java istheaspect f ile.theinstrumentedpoints pointcuts arede f inedthroughtheannotation.inthisexample theannotation around means both the beginning and the end of the methods will be instrumented.
the value within the brackets specify the instrumentedmethods.inthisexample anymethodswiththename getrootitem withinpackage org.unitedinternet.cosmo.serv ice.contentservice and parameter type as userwill be instrumented.
the instrumented code advice is de f ined via method checkgetrootitem .itcontainsalogprintingstatementwiththe message in checkgetrootitem and the user name.
the code snippet in standardcontentservice.java shows how a log message is actually generated.
this class implements the interface contenservice which is within the speci f ied package.
it contains a method getrootitem of which the parameter is user.
therefore thismethodquali f iesthepre de f inedinstrumentedruleabove.
hence duringruntime theaboveloggingstatmentwillbeexecuted while entering and exiting this method.
in general only of our studied projects adopted aop based logging.
this matches with previous empirical studies which indicated the very limited use ofaopin the wild.
401icse may seoul republicof korea bo yuan chen andzhenming jack jiang findings therearefourmainreasonsbehindtheuseofelus general purpose logging lu interactions internationalization and modularization.
majority of the projects use elu for general purposelogging.83outofthetop 100mostlyusedelus areusedfor luinteractions.someelusprovideuniquefeatures likeinternationalization andmodularization buttheyareonlyused by avery small number of projects.
implications many elus are used as developers need to enable andcon f iguretheloggingbehaviorfortheimportedpackages.it is important to manage these lus to better monitor and debug systems runtimebehavior.
an existing study showsthat log con f igurations are one of the main source of errors for java based projects.unfortunately onlyonetool is developedtodetect invalid loggers in the con f iguration f iles.
to effectively monitor anddebugsystems behavior developersneedto f igureouthow tocon f igure theloggingbehavior for theimportedpackages and how to interact these lus with the lus in their own projects.
hence techniquestorecovertheloggingarchitectureandconduct automaticcon f iguration are needed.
.
rq2 why do developersimplement ilus in their projects?
it is not clear why many projects have still implemented their ilus eventhere are 866elus available in the wild.
to investigate the rationalesbehindthis outof2 990projectswhichhaveimplemented ilus we randomly selected of them for close manual examination.thiscorrespondstoacon f idencelevelof95 withacon f idence interval of .
we used the strati f ied samplingtechnique to ensurerepresentativesamplesareselectedfromprojectsofdifferentsizes.theportionofthesampledprojectswithindifferentsized projectsisequaltotherelativeweightofthetotalnumberofthe projects with that size.
for example there are a total of smallsizedprojectswhichcontainilus.hence82 small sized projectsare selected.
foreachselectedproject wecarefullystudiedhowtheirilusare being used by reading through the source code.
we also examined the relevant commit logs issue reports and pull requests to lookfortherationalesonwhyilusareimplemented.intheend we haveidenti f iedthreeproject speci f icloggingneedsasshowninfigure de f ining the logging format compatibility with other lus and easeof con f iguration anddependency management.
.
.
defining the logging format.
log messages are generally loosely structured which contain free formed texts.
many projects de f inetheirownformatofthelogmessages sothattheycanbeautomaticallyparsedandanalyzed.forexample the hadoopproject introducesauditlogginginordertosatisfythesecuritycompliance requirements.
the format of the auditing logs vary across different hadoopcomponents.forexample in hadoop common component showninfigure3 aninterface kmsauditlogger is f irstde f ined withamethod logauditevent whichde f inestheauditingmethods tobeinvoked.tofacilitatecodereuse simplekmsauditlogger implements this interface by using the adapter pattern.
it implements thelogauditevent method by invoking the infomethod from anslf4jlogger object.
the logauditevent method contains a switchstatement inwhichdependingontheactualevent differentauditlogswillbeoutputted.theresultingauditlogsaremuchmore structuredcomparedtotheregularlooselyde f inedlogmessages.
other ilus like cassandra sstatuslogger also fall into this case.
.
.
compatibility with other lus.
many of the studied projects can be packaged and used by other projects.
for reusable packages it is preferred to be f lexible and compatible with different elus asdevelopersalwayswanttousethemostup to datelusin theirprojects.sincelumigrationsrequirehighmanualeffortsand are error prone developers usually implement their ilus to separate the coupling of their logging code withthe lus.
vert.x is a popular tool kit for building reactive applicationsonthejvm.itreceivesmorethan 000starsongithub.it suppports four general purpose java elus java.util.logging log4j .x log4j andslf4j.thisfunctionalityisrealizedby implementing the strategy design pattern to unify the apis among these four elus.
these four elus do not share the same set of verbositylevels.therefore theiluneedstoprovideauni f iedinterface logdelegate for their logging methods.
the logdelegate interfacede f inesasetofcommonloggingapis e.g.
info error .separateimplementationclassesareintroducedtowraparoundthefour popular general purpose elus java.util.logging log4j .x log4j andslf4j.
figure shows a code snippet for jullogdel egate which adapts the functionalities of java.util.logging to the common interfacede f ined by logdelegate .
to implement the errormethod it calls the logmethod along with the verbosity levelsevereandthe variable message fromjava.util.logging.
.
.
ease of configuration and dependency management.
one of the common errors associated with logging is the con f iguration oflus .themaincauseofthisisduetocomplexdependency structures .hence about29.
oftheilusare implemented to ease the con f iguration and dependency management issues.
they are usually built from the ground up using only thestandardjdklibrariesandarenotdependentonanyelusto minimizetheefforttomanagedependencies.figure3showsoneexample.thiscodesnippetisfrom slick2d whichisa2djavagame library.
this ilu is designed to be lightweighted and easy to use.
it logsthecompleteerrorinformationwithtimestampstotheconsole.
findings there are three project speci f ic needs which lead to the implementation of ilus de f ining the logging format compatibility with other lus and ease of con f iguration and dependency management.
among these three needs de f ining the logging format is the most common one.
.
of the sampled projectsimplementedilusforthisspeci f icneed.asthesizeofthe projects grow larger more projects implement ilus to satisfy the needsofcompatability withother lus.
implications althoughmorethan20 ofthesampledprojects implemented theirown ilus from theground up.
these ilus are mainlyusedinternallyfordebuggingpurposes.theyareusually not intended to be used by other projects since they might not satisfythegeneralloggingneeds e.g.
notthread safe .additional tools and techniques need to be developed to automatically warn developers whoimportedpackages whichimplement ilus.
402403icse may seoul republicof korea bo yuan chen andzhenming jack jiang kieruntimelogger logger kieservices.factory.get .
getloggers .newfilelogger session log correlation b correlationexample.java pen usingkieruntimelogger pipeline.addlast logger new logginghandler loglevel.info a inboundconnectioninitiator.java cassandra using nettylogginghandler figure5 anexampleofusingmultiplelusfor interaction with lus from theimported packages.
import org.apache.maven.plugin.logging.log ... public file resolvebyid string id log log throws mojofailureexception ... log.debug resolving artifact id from projectrepositories dependency31helper.java karaf figure an example of using multiple lus for managing the logging contents.
.
.
interaction with lus from the imported packages.
many javabasedsoftwaresystemsusethirdpartypackages whichalsocontain lus.
in order to have full observability of the resultingsystems it is important to enable logging across all the components.figure showstwodifferentexamplesonhowtocon f igureorenablelogging for the imported packages.
however due to the api variabilitiy of these lus different techniques are needed in order to enable or con f igure their logging behavior.
for example nettyuses eventbasedprogramming.toenabletheloggingofthe nettypackage thecassandra developer needs to add the logginghandler .
in order to enable logging for kie theopennmsdeveloper needs to create a new logger to output the logs to a f ile.
the more third partypackagesareused themoreinteractionstherearewiththe lus from these imported packages.
this is one of the main reasons whymany largeorverylarge sizedprojectsusemorelusthanthe smallersizedprojects.
.
.
managing the logging contents.
in addition to con f iguring andenablingtheloggingbehaviorfortheimportedpackages sometimesthestudiedprojectsalsousethelusfromtheimportedpackagesforadditionallogging.thisismainlytoensuretherelevant loggingcontentsarestoredinthesamelocation.
mavenisapopular tool to build and manage java projects.
the core of mavenconsists ofasetofplugins.eachpluginisreponsibleforaparticularfunctionality.forexample clean whichisusedtocleanupthebuild arti f icats and compiler which is used to compile java sources are two default plugins.
during execution the logs generated from these plugins will be redirected to the same storage location.
if other projects intend to develop mavenplugins they are advised to use the lus from mavento generate build related logs so that maven related information can be aggregated to one centralized location which is easy to analyze and archive.
figure shows one such example.
on one hand karafuses their own lu to record system speci f ic information.
on other hand it uses the lu from mavento recordbuildrelatedlogs.
.
.
forma t ting logging messages across different components.
in somecases onelumaynotsatisfyalltheloggingneedsforonefor instancestatus status instancestatuslist if instance running !
status.getinstancestate .getcode logger.debug instances are up but not all of them are in running state.
return false asgroupstatuscheckertask.java cloudbreak figure an example of using multiple lus for de veloper convenience.
project.
for example as shown in figure hadoopusesslf4j forgeneratingexecutionlogs whichareusedfordebuggingand monitoring purposes.
it also uses ilu to generate audit logs to satisfy security requirements.
.
.
developer convenience.
some of the top projects use aop basedlogging.however thedevelopersalsoincludelogging code whichisinstrumentedusinggeneral purposeelus.thisis mainly due to developer convenience.
for example cloudbreak uses aop based logging but it also uses slf4j.
figure shows one such example.
since checking the instance state is a very localized concern itis much fasterto instrumentwith thegeneralpurpose luthanaop basedlogging.similarcasesalsoapplytolus which are used for internationalization.
for example hibernate uses the jboss logging to support internationalization.
however instead of putting the log messages into the centralized f ile the developer chose to place their log message along with the feature code for debugging purposes.
findings thereare fourusage contextsbehindthe useof multiple lus in one project interaction with lus from the imported packages managingtheloggingcontents formattinglogging messages across different components and developer convenience.exceptfor developerconvenience thepercentageof these usage contextsincreasesas the projectsizes increase.
implications loggingisconsideredasacross cuttingconcern as the logging code scatters across the entire system and intermixeswiththefeaturecode.tocopewiththischallenge aopis introduced.however aopcannotbeusedtosatisfythecurrent logging needs due to their inconvenience on specifying localized logging context.
more importantly for large scale projects which usemanythirdpartypackages itisnecessarytoenableandcon f igure the logging behavior for these imported packages in order togainfullobservabilityoftheentiresystems.themanagementof the logging behavior for these packages is rather complex and introduces another form of cross cutting concerns.
further research is urgently needed to develop tools or techniques to automatically manage andmodularize such concerns.
interviews although we have analyzed java based projects our study focuses on java based open source projects in github.
in order to assess the generalizability of our f indings we conducted a semistructured inteview with experienced industrial developers.
we decidedtoconductsemi structuredinterviewsinsteadofsurveysso 404studying the use of java loggingutilities in the wild icse may seoul republic of korea thatwecaninteractwiththeparticipantsinamore f lexibleway.for example we have prepared a set of questions before hand.
during the interview we sometime asked follow up questions based on participants answers onthe f ly .
.
participants similar to the participants are from the authors personal contacts.allofthemareworkingatlarge scalesoftwarecompanies.
thedevelopmentexperienceoftheparticipantsrangesfromoneto eight years.
the types of projects that participants are working on vary from server side projects frameworks and client application .
all these projects have been widely used by millions of usersworldwide.theprogramminglanguagesthattheparticipants use daily include java php c c python andgo.
.
findings all of the participants have inserted deleted updated logging code in their development activities.
it reaffirms that software logging is apervasive practice .
.
.
cross validationofourfindings.
wepresentedour f indings ontherationalesbehindtheuseofelusandilus aswellasthe usage context for multiple lus.
then we asked the participants whether their projects adopt one or more of the studied lus whether our characterized usage context and the logging needs wouldbe usefulfor them and ifthere areany additionalinformation to add or comment on.
someparticipantsmentionedthattheydidadoptoneormoreof thestudiedlusinthispaper.however therationales e.g.
jbossstylelogging isabitdifferent.allparticipantsfeltthatthe f indings and code examples from this study can help them better con f igure andmanage the logging behaviorfor their projects.
elus allparticipantsacknowledgedthatthegeneral purpose logging is the most commonly used logging need.
however they also acknowledge the challenges on co evolving the loggingcodewiththerapidlychangedfeaturecode asthe logging code is inter mixed with the feature code.
although theparticipantsaggreedthataop basedloggingisagreat idea only two of the interviewed participants used aopbasedloggingintheirprojects.thisismainlydueto high learning curve of a different programming paradigm dif f icult to translate logging concerns into rules a.k.a.
advice and lack of automatedsupport for legacylogging code.
comparedtoopen sourceprojects thereisamuchhigher portion of industrial projects that adopted the lus that centralize the log messages a.k.a.
jboss style logging .
oneparticipantmentionedthatinadditiontointernationalization thecentralizedlogging stylecan improvethe accuracyand thespeedofthelog processingtask and attach additional meta information e.g.
issue resolution strategies withthe message id for better f ield support.
ilus the participants mentioned that the choice of lus weredecidedbythesoftwarearchitectsorseniordevelopers.
once the luswere set up only under very rare cases that theywillmigrateormodifylus.noneofthemhavedirectly modi f iedtheexistinglus.weaskedtheparticipantswhat type of luswere used in theirprojects.threeof themsaidthey directly use open source lus such as log4j java andlog4net c .therestofthemuseilusincluded in their project.
the rationales behind implementing ilus are similar to our f indings from the open sourceprojects.
the use of multiple lus the participants are surprised abouttheuseofmultiplelus.fiveofthemdidnotrealize the need to do this until we presented our f indings.
they complained about the challenges on debugging and monitoring theirprojects whichusemanythird partypackages.
by leveraging our f indings and code examples they can enable and manage the logging behavior from these imported packages which will greatly improve the observability of the overallsystems.
.
.
beyond logging.
five participants mentioned that they have integrated tracing tools e.g.
opentracing or application performancemonitoring apm tools sentry google f irebase etc.
intotheirsystems.theyappliedthesetoolstoreplacesomeof theloggingfunctionalitiessuchascrashreportingandcollectionof thepro f ilingdata.unlikelogging mostofthesetoolsdonotneeddevelopers to arbitrarily write code to record the desired information.
for example one participant mentioned that they adopted springsleuth .
it is a distributed tracing tool which can automatically recordtheinteractionsbetweenmultiplesprintbootmicroservices.
thesetoolspre instrumentoutputstatementstorecordinformation such as rpc calls and stack traces and they need minimum con f igurationefforts.theparticipantsalsomentionedthatalthoughthese tools are useful they still cannot completely replace the needs for software logging in theirprojects.
discussions logs have been used extensively in practice.
instead of invoking outputfunctionslikesystem.out.println developersprefertouse logging utilities lu to instrument their systems.
this paper categorizesthecomplexuseoflusinthewildandpresentsmultiple implications which are useful for developers and researchers.
in this section we will discuss the signi f icance of our f indings and present somefuture work.
.
complex use oflus there are generally four reasons to use lus general purpose logging luinteractionswithimportedpackages internationalizationofthelogmessages and modularizationofthelogging code.
larger projects tend to use multiple lus in one project to satisfyoneormoreofthefollowingusagecontext interactionwith lusfromvariousimportedpackages managingtheloggingcontents formattingloggingmessagesacrossdifferentcomponents and developerconvenience.manyprojectsalsoimplementtheir own lus to satisfy project speci f ic needs like de f ining the logging format compatibility and easeofcon f igurationand dependency management.
such f indings would be useful for developers and researchers who are interested in developing and maintaining lus our f indings raise developers awareness that their systems can contain multiple lus due to the imported packages.
it is importanttomanagetheselustobettermonitoranddebug systems runtime behavior.
405icse may seoul republicof korea bo yuan chen andzhenming jack jiang toeffectivelymonitoranddebugsystems behavior developersneedto f igureouthowtocon f iguretheloggingbehavior for the imported packages and how to interact these lus with the lus in their own projects.
hence techniques to recover the logging architecture are needed.
toensureqos bestpracticesandanti patternsformanaginglusareneeded particularlyinthefollowingareas selecting the appropriate default verbosity levels for lus for good observability with low overhead and correlating logging information acrossdifferentlus in one project.
in addition to common lus e.g.
log4j or slf4j many projects also use additional elus orimplement ilus.
these lus are project dependent and require implementation maintenance effort.
the f indings in the paper can guide researchers to propose more general techniques to satisfy such logging needs.
.
beyondlus certain f indingsinthispapermaybeapplicabletootherutilities.
it is important to study the use of different utilities in the wild due to a multipleutilities e.g.
database testingframeworksandadlibraries withsame similarfunctionalitiescanbeusedinoneproject and b cross cuttingconcerns e.g.
logging analyticsandsecurity areimplementednotonlyintheprojects codebutalsointheimported packages.
effectively managing such concerns is an open problem which is important for development and maintenance of such systems .
related work in this section we discuss tworealtedresearchareas.
.
empirical studies on logging practices there are no well established logging guidelines inneither industrial noropensourcesystems .hence itisimportant to derive best practices and common mistakes by studying the currentloggingpractices.shangetal.
foundthattheamount of logging code is correlated with the amount of post release bugs.
kabinna et al.
studied the logging library migrations for apache based java projects.
they found that migrating logging libraries requires high manual efforts and is error prone.
zhi et al.
conducted an exploratory study on the con f iguration aspectsof the lus.
our work is different from the above studies in the following threeaspects thispaperisthe f irststudyontheuseoflus which includesbothelus a.k.a.
logginglibraries aswellasilus.
the scaleofourstudyismuchbiggerthanthepreviousones aswehave studiedover11 194java basedgithubprojects whichuses3 lus.
different from all of the above works which are mainly quantitative studies we have performed both the quantitative and the qualitative studiesonthe use of java basedlus.
.
improvingthequality ofthelogging code this area can be further divided intothree parts where to log what to log and how to log.
where to log isrelatedtotheproblemofselectingappropriateloggingpointsinthesourcecode.fuetal.
proposedadata miningbasedapproachtoautomaticallyextractthe important attributes which affect the locations of the logging points.
zhu et al.
proposed a machine learning basedtechniquetolearncommonloggingpointsbasedon the code structures.
yuan et al.
proposed a programanalysis based method toadd logging points for debugging purposes.dingetal.
proposedaconstraintsolvingbased methodtoselecttheoptimalloggingpointswhichincurminimumperformanceoverheadwhilekeepingthemaxmium runtime information.
zhao et al.
came up with a tool log20 which automatically places the logging points under certain overheadthreshold.
what to log isrelatedtotheproblemofprovidingcomplete runtime information in the logging code.
yuan et al.
proposed a program analysis based approach to add additionalvariablesintoexistingloggingstatementssothatmore complete execution paths can be recovered thus improving thediagnosability.heetal.
characterizedthestatictexts insideloggingstatementsfor10javaand7c projects.they providedannlp baseddescriptiongeneration tooltoautomaticallygeneratestatictextsinlogging statements.
how to log isrelatedtotheproblemofdesigningandmaintaininghighqualityloggingcode.yuanetal.
partially studiedtheinconsistentverbositylevelproblemthrougha clone based approach.
li et al.
learned from code changes in history to predict just in time logging code changes andtosuggestthemostapproapriateverbositylevels through machine learning based approaches.
chen et al.
summarizedsixtypesofanti patternswithinloggingstatements andproposed a tool to automaticallydetect them.
li et al.
proposed an automated tool to detect duplicate loggingcodesmells.chenetal.
proposedanapproach to extract the logging code issue introducing changes.
our study lies within the category of how to log but differs with the above works in the sense that our focus is on the lus instead of the log printingcode.
threats to validity in this section we willdiscuss the threatsto validity.
.
external validity we conducted our study only on java based open source projects.
we cross validated our f indings by interviewing with industrialdevelopers.althoughourapproachcanbeeasilyadapted toanotherstudyontheuseoflus our f indingmaynotbegeneralizable to projectswritten in otherprogramming languages.
.
internalvalidity in our study we removed all of the very small sized projects since only a small fraction of them use lus and most of them are trial projects for self studying and collections of code snippets.
we also removedforkedprojects sincetheyarelikelyduplicationsofthe base ones.
we also removed unpopular projects which contain few stars.
this practice is similar to many of the previous empirical studiesongithub based proejcts .
406studying the use of java loggingutilities in the wild icse may seoul republic of korea .
construct validity in our study we used a heuristics based approach to count the adoptions of lus.
we made our best efforts to avoid bringing in anyfalsepositives.throughmanualveri f icationoftherandomly selectedsamples our approach yieldsan precision of96 .
conclusion in this paper we conducted a large scale empirical study on the use of java lus in the wild.
we studied java based projects in the github.
these projects use lus.
our f indings suggest thatthecomplexityoftheuseoflusincreasesastheprojectsizeincreases.
although many projects only use lus for general purpose logging the actual logging needs vary from project to project.
the main reason behind multiple use of lus is to enable or manage the loggingbehavior of the imported packages.
many projects choose toimplementtheirownilumainlyforde f iningtheproject speci f ic formatoftheirloggingcode.the f indingsandtheimplicationspresentedinthispaperwillbeusefulforludesignersandresearchers as well as systemdevelopers.