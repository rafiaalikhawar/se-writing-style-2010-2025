m3 semantic api migrations bruce collie school of informatics university of edinburgh edinburgh united kingdom bruce.collie ed.ac.ukphilip ginsbach github software uk oxford united kingdom ginsbach github.comjackson woodruff school of informatics university of edinburgh edinburgh united kingdom j.c.woodruff sms.ed.ac.uk ajitha rajan school of informatics university of edinburgh edinburgh united kingdom arajan inf.ed.ac.ukmichael f.p.
o boyle school of informatics university of edinburgh edinburgh united kingdom mob inf.ed.ac.uk abstract librarymigrationisachallengingproblem wheremostexisting approaches rely on prior knowledge.
this can be for example informationderivedfromchangelogsorstatisticalmodelsofapi usage.
thispaperaddressesadifferentapimigrationscenariowhere thereisnopriorknowledgeofthetargetlibrary.wehavenohistori calchangelogsandnoaccesstoitsinternalrepresentation.totackle this problem this paper proposes a novel approach m3 where probabilisticprogramsynthesisisusedto semantically modelthe behavior of library functions.
then we use an smt based code searchenginetodiscoversimilarcodeinuserapplications.these discoveredinstancesprovidepotentiallocationsforapimigrations.
weevaluateourapproachagainst7well knownlibrariesfrom variedapplicationdomains learningcorrectimplementationsfor functions.
our approach is integrated with standard compiler tooling andweusethisintegrationtoevaluatemigrationopportunities in existing c c applications with over 1mloc.
wediscover over instances of these functions of which more than represent migration opportunities.
ccs concepts softwareanditsengineering softwaremaintenancetools software verification and validation compilers.
acm reference format bruce collie philip ginsbach jackson woodruff ajitha rajan and michael f.p.o boyle.
.m3 semanticapimigrations.in 35thieee acminternationalconferenceonautomatedsoftwareengineering ase september virtualevent australia.
acm newyork ny usa 13pages.
work performed while at the university of edinburgh permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe firstpage.copyrights forcomponentsof thisworkowned byothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
ase september virtual event australia copyright held by the owner author s .
publication rights licensed to acm.
acm isbn ... .
introduction .
api migration libraries are a fundamental feature of software development.
they allowthesharingofcommoncode separationofconcernsanda reduction in overall development time.
however libraries are not static.theycontinuallyevolvetoprovideincreasedfunctionality security and performance.
unfortunately upgrading software to matchlibraryevolutionisasignificantengineeringchallengefor large code bases.
given the wide scale nature of the problem there is much prior work in the area under various headings e.g.
library upgrade api evolutionorlibrarymigration .workintheseareasaimstoanswer the same question when and how can a program using api xbe transformed to one that uses api ywhile preserving its behavior?
thisisadifficultproblemevenwhen xandyhavesimilarinterfaces.
itbecomesmorechallengingiftheir behaviors donotmatch and requires surrounding code to be factored in.
thereareseveralapproachestothismigrationproblem ifexamplesexistofprevioussuccessfulmigrations thentheseexamples canbeusedtoderivemappingrules .thisapproachrequires thatafullhistoryoftheapplication ssourcecodeisavailable annotated with the libraries in use at each commit.
neural models have beenusedsuccessfully topredictpropertiesofprograms basedon learned vector space embeddings .
however these approaches require large training sets and are imprecise with respect to program semantics.
a more precise but less automatic approach is to useexpertknowledgetoencodeknownmigrationpatterns .
allthesepriorapproachesrequiresomeknowledgeoftheapi.in this paper we tackle the challenging task of api migration without any prior knowledge of the source or target libraries.
here wedo not have access to the library s source code nor to a corpusof example usages of the library.
while this scenario may seemdraconian it is often the case in practice .
libraries may be closed source ordistributedinbinariesforconvenience and could even be implemented as hardware .
in this paper we proposeanovelapproachwhichautomaticallylearnspattern based semantic migrations but without up front expert knowledge.
35th ieee acm international conference on automated software engineering ase application original source code library source functionslapplication llvm ir with calls synthesized llvm irprograms lapplication llvm ir constraint descriptioncandlapplication candidate new calls compile synthesize synthesizemodel matchmigrateinline inline generalizetest application verified new calls library target functionsl synthesized llvm irprograms l figure a summary of the m3workflow.
models for library functions are synthesized.
source functions are inlined while synthesized target functions are generalized into constraint descriptions which are then used to search compiled user code for potential migrations.
.
m3 model match and migrate the key to our approach is to derive a model that is actual executable code.
we call such an approach semantics based migration.
givenaspecificationforalibraryfunction typesignature function name library binary containing its implementation m3attempts toautomatically modelitsbehaviorusingprogramsynthesisand checks correctness with respect to automatically generated inputoutput examples.
it inlines the learned program models then uses compiler based constraint analysis to matchregions of application code with compatible libraries.
finally we migratethese regions by replacing application code with library calls.
a useful feature of this approach is that as well as library migration it allows the refactoring of library free user code to uselibraries.
this is because the synthesized models are themselves code and are inlined and analyzed together with application code.
complexrefactoringsthatintegratecontextualcodearoundanapi call are enabled by this approach.
our approach while having the benefit of not requiring library vendors to release their source code relies on the ability to synthesize programs in a reasonable time.
we build on methods from sketch basedsynthesis todiscoverprogramstructurebefore performing a directed enumerative search.
we incorporate new probabilisticmodelstomoreeffectivelynavigatethelargesearch space.
we evaluate our approach across libraries synthesizing functions and match them to over old library calls across applications with up to 1mloc.
we were able to successfully migrate more than of these calls to another library.
summary of contributions.
we provide a novel and efficient program synthesizer for real world library functions.
additionally we detail a method for matching similar code in applications using solver aidedtechniques.usingthisprocedure weareabletodiscover opportunities for usages of a source library lor application codectobemigratedtoatargetlibrary l .furthermore wecan migrate source libraries with surrounding contextual code c l to target libraries.
this is achieved without any knowledge about the implementation of either library.
overview in this section we first present a high level summary of the m3 workflow thenshowanexampleofthetypeofmigrationsitenables in practice.
.
m3workflow figure shows the flow of data through m3.
it takes as input an application along with specifications for source and target library apis currently used land potential targets l .
the end result is a modified application that