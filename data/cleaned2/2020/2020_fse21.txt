an exploratory study of autopilot software bugs in unmanned aerial vehicles dinghua wang university of technology sydney australia southern university of science and technology china dinghua.wang student.uts.edu.aushuqing li southern university of science and technology china lisq2017 mail.sustech.edu.cnguanping xiao nanjing university of aeronautics and astronautics china gpxiao nuaa.edu.cn yepang liu guangdong provincial key laboratory of brain inspired intelligent computation southern university of science and technology china liuyp1 sustech.edu.cnyulei sui university of technology sydney australia yulei.sui uts.edu.au abstract unmanned aerial vehicles uavs are becoming increasingly important and widely used in modern society.
software bugs in these systems can cause severe issues such as system crashes hangs and undefined behaviors.
some bugs can also be exploited by hackers to launch security attacks resulting in catastrophic consequences.
therefore techniques that can help detect and fix software bugs in uavs are highly desirable.
however although there are many existing studies on bugs in various types of software the characteristics of uav software bugs have never been systematically studied.
this impedes the development of tools for assuring the dependability of uavs.
to bridge this gap we conducted the first large scale empirical study on two well known open source autopilot software platforms for uavs namely px4 and ardupilot to characterize bugs in uavs.
through analyzing bugs from these two projects we observed eight types of uav specific bugs i.e.
limit math inconsistency priority parameter hardware support correction and initialization and learned their root causes.
based on the bug taxonomy we summarized common bug patterns and repairing strategies.
we further identified five challenges associated with detecting and fixing such uav specific bugs.
our study can help researchers and practitioners to better understand the threats to the dependability of uav systems and facilitate the future development of uav bug diagnosis tools.
dinghua wang is a student in the joint ph.d. program of uts and sustech.
yepang liu is the corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse august athens greece association for computing machinery.
acm isbn .
.
.
.
concepts software and its engineering software defect analysis general and reference empirical studies keywords unmanned aerial vehicles software bugs empirical study acm reference format dinghua wang shuqing li guanping xiao yepang liu and yulei sui.
.
an exploratory study of autopilot software bugs in unmanned aerial vehicles.
in proceedings of the 29th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse august athens greece.
acm new york ny usa pages.
a plane b vtol c copter figure example drone types supported by px4 .
introduction in recent years the use of unmanned aerial vehicles uavs is becoming more and more popular in daily life .
as a typical cyberphysical system cps uavs are context aware.
a uav system perceives the external physical environment through various sensors and reacts in accordance with the external information .
there are three steps for a cps to interact with physical environment namely sensing decision making and action taking .
since uavs are highly correlated with physical environment the underlying software of a uav differs significantly from traditional software whose inputs are mostly stable and not interfered by external environment.
on the one hand the system inputs of a uav can be dynamically fluctuating and uncontrollable with respectesec fse august athens greece dinghua wang shuqing li guanping xiao yepang liu and yulei sui figure root causes of uav specific bugs.
to the changes of environment.
it is necessary for developers to consider the changes of environment proactively making it challenging to build a reliable uav system .
on the other hand various configurations of sensors and hardware e.g.
the sensing range of a temperature sensor should be taken into account during uav s software development.
ignoring these configurations e.g.
parameters and limits can cause reliability issues.
in addition some uav systems are designed for more than one types of hardware.
for example as an open source flight control software for autopilot px41supports multiple types of drones including planes vtols vertical take off and landings and copters as shown in fig.
.
since different devices may have different functional limitations developers also need to consider the correspondence between different functions and hardware models to ensure the reliability of the whole system.
although a lot of progress has been made in developing advanced uavs the reliability and safety of such systems are still major concerns due to the aforementioned challenges .
software bugs in uav systems have caused property damage to the users .
hence there is an urgent need to analyze and understand the characteristics of bugs in uav software in order to guide developers to build more reliable and secure uav systems.
existing studies have explored some common bugs that might appear in both uav software and traditional software but they do not focus on uav specific bugs.
this work we present the first empirical study of uav specific bugs.
our study aims to provide practical yet systematic knowledge of uav specific bugs summarized and categorized from two major open source autopilot software platforms i.e.
px4 and ardupilot for drones.
for our study we collected bugs from these two popular platforms on github.
among those bugs are uavspecific.
we manually analyzed these bugs by investigating their bug reports source code patches and historical development data.
through our analyses we observed eight types of root causes of uav specific bugs as shown in fig.
.
we have also summarized five challenges in detecting and fixing these bugs as highlighted below.
challenge it is difficult to design general test oracles to help locate bugs in uav systems due to the unpredictability of system outputs and the need to evaluate system behavior from multiple perspectives.
challenge many bugs in uav systems are difficult to reproduce in the presence of a dynamically changing physical environment.
challenge developing uav software to support a variety of hardware often causes compatibility and dependence problems which are hard to detect via code analysis.
challenge fixing low level software bugs related to hardware and various system configurations is highly challenging.an exploratory study of autopilot software bugs in unmanned aerial vehicles esec fse august athens greece figure flight stack of px4.
challenge comparing the expected value with the actual value at a specific program point is a common method of fault localization.
however fault localization is generally difficult for uav systems since a value or state at a specific program point is often unpredictable.
our study can help researchers and developers to gain a better understanding of uav specific bugs and provide assistance for future uav system development and research.
to conclude our paper makes the following contributions we conduct the first empirical study of the root causes of uavspecific bugs which could assist future research on detecting and fixing software bugs in uav systems.
we make an analysis of the challenges in detecting and fixing uav specific bugs.
we release the replication package and the dataset of uav specific bugs collected from px4 and ardupilot at zenodo.
.
the rest of the paper is organized as follows.
section briefly gives the background knowledge of cps dependability and the two examined projects px4 and ardupilot .
section describes the methodology of our empirical study including the data collection and bug classification procedures.
section presents the analysis of the root causes firstly and then presents the challenges of uav specific bugs detecting and fixing.
section discusses our suggestions to practitioners.
section summarizes the threats to validity while section introduces the related work.
finally section concludes the paper.
background .
cyber physical system dependability the term cyber physical system cps widely referred in pervasive computing was proposed in the 1990s by weiser .
recently the development of cpss has undergone considerable progress especially in relation to drones self driving cars and various iot devices.
however developing and deploying a dependable cps is still a difficult problem.
the three most important factors that affect the dependability of cpss are context inconsistency uncertainty and faults in the system .
a cps uses context to capture dynamic changes inthe external physical environment.
context such as pressure location and temperature is captured by sensors.
context inconsistency means the inconsistency between the physical environment and the perceived context of the system which is often manifested as environment noises.
to explain conveniently in our paper we do not divide uav systems into the physical system a.k.a.
the plant in control systems and the controller when we talk about system input and output.
specifically in our paper the inputs of uav systems involve the user input e.g.
command line inputs and the input from the physical environment.
when we talk about the nondeterminism problem of uav system inputs we are referring to the system input disturbances in the physical environment.
uav systems outputs in our paper are continuous physical trajectories .
.
px4 and ardupilot our study is performed on two popular open source uav platforms on github namely px4 and ardupilot.
px4 is an open source flight control system for drones and other unmanned vehicles.
this is an active and well maintained platform.
it represents state of the art in the field of open source uav system development.
fig.
shows the flight stack of px4 which is a collection of guidance navigation and control algorithms for autonomous drones.
as a typical cps px4 consists of three subsystems sensing decision making and action taking.
we introduce several major components of the subsystems in the following.
the estimator computes a vehicle state mainly including position and attitude using sensor inputs.
the controller takes a setpoint from the navigator and an estimated state from the estimator as inputs.
it controls the vehicle state until it matches the setpoint.
for example the position controller takes a position setpoint and an estimated position as inputs and outputs the attitude and thrust setpoint to move the vehicle towards a desired position.
the mixer translates the force commands into the individual motor commands and feeds motor commands to the actuator .
ardupilot is another open source uav platform for drones and unmanned vehicles.
ardupilot works on a wide variety of hardware to support multiple types of unmanned vehicles.
it is constantly evolving based on rapid feedback from a large community of users and developers.
the online community also provides massive bug data for our research.esec fse august athens greece dinghua wang shuqing li guanping xiao yepang liu and yulei sui table the statistics of the subjects collected in our study project name stars commits lines of code number of files closed issues bugs uav specific bugs px4 ardupilot methodology .
data collection to obtain our initial taxonomy of uav software bugs we considered two popular and well known open source uav systems px4 and ardupilot.
we did not choose other open source projects e.g.
openpilot and paparazzi because they are not actively maintained and the number of issues is small.
to collect bugs from the two projects we defined the selection criteria consisting of the following rules rule .
the issue is closed.
a closed issue means it has been resolved therefore such an issue report contains information that is helpful for bug classification and understanding.
rule .
the issue is labeled with bug.
developers usually label issue reports according to the characteristics of the reported issues.
a report with a buglabel typically means that the described issue is caused by a system software defect not other external factors.
rule .
there is a patch to fix the reported bug.
the patch normally contains developers comments and the code to fix the bug which allows us to understand the root cause of bugs more easily.
based on the above rules we collected real bugs out of closed issues from the projects px4 and ardupilot on github.
among them px4 contains closed issues and bugs and ardupilot has closed issues and bugs.
as shown in table these two projects contain more than two million lines of code and over commits.
.
bug classification to characterize the root causes of the uav specific bugs we analyzed the data by following the widely adopted open coding procedure .
specifically we performed an iterative manual labeling process that lasted half a year involving two annotators i.e.
co authors of the paper whom all have several years of cps development experience.
the iterations are as follows iteration .
for the bugs we analyzed three sources of data i.e.
bug reports including comments from developers and users commits and bug patches on github.
according to our own understanding we described and labeled each bug independently.
we then compared the respective labeling results and analyzed those with large differences.
with this iteration we came up with a preliminary classification and labeling strategy.
iteration .
we independently labeled all bugs for a second round based on the preliminary classification and labeling strategy.
we then compared the results and found that there were still a few differences in the labels.
to resolve the differences we discussed to clarify the boundaries between the labels.
in the end we slightly revised our bug classification and labeling strategy.iteration .
we carried out a third iteration by going through all bugs following the revised classification and labeling strategy.
finally we reached a consensus on the taxonomy of bug root causes.
after three iterations each bug is labeled as one leaf category of our root cause taxonomy2 which is shown in fig.
.
as explained later the leaf categories in our taxonomy are orthogonal meaning that no bugs in our dataset can be classified into multiple categories from the perspective of root causes.
with the analysis of root causes we identified uav specific bugs from the bugs following two rules.
first we considered a bug as uav specific if its root cause rarely exists in traditional software e.g.
bugs caused by the noisy physical environment .
second if the root cause of a bug exists in traditional software but the bug has a much higher probability of appearing in uav systems we also considered it as uav specific.
for example the bugs in the category hardware support appear frequently in uav systems due to the need to support many hardware platforms.
for the characteristics of traditional software bugs we referred to two previous empirical studies on bugs in linux mozilla projects and apache projects.
due to the page limits our subsequent discussion will focus on uav specific bugs.
root causes and challenges with the identified uav specific bugs we conducted an empirical study to understand the bugs root causes and the challenges in dealing with these bugs.
specifically we explore the following three research questions rqs rq1 what are the common root causes of uav specific bugs?
rq2 what are the challenges in detecting uav specific bugs and how to address them?
rq3 what are the challenges of fixing uav specific bugs and how to address them?
by studying rq1 we will understand how uav specific bugs arise.
the root causes will guide the explanations of the findings for rq2 and rq3.
besides in rq2 and rq3 we will investigate the new challenges imposed by the key differences between uav systems and traditional software.
after answering the three rqs we also provide several suggestions to help developers build and debug uav systems.
.
rq1 root causes of bugs after conducting the manual classification described in section .
we observed that the root causes of the uav specific bugs can be classified into eight categories limit math inconsistency priority parameter hardware support correction and initialization.
fig.
2note that this is not the only way to categorize the bugs in our dataset.
our current taxonomy is derived based on our knowledge and cps development experience.an exploratory study of autopilot software bugs in unmanned aerial vehicles esec fse august athens greece table example limits of px4 name description min max default units hdrift horizontal drift speed to use gps .
.
.
m s vdrift vertical drift speed to use gps .
.
.
m s ekf2 req epv required epv to use gps m fw acro z max acro body z max rate degree mt fpa min minimal flight path angle setpoint .
.
.
degree shows the number of bugs of these root causes.
in the following we will discuss each type of root causes in detail.
.
.
root cause limit.
definition limit bugs are those caused by improper parameter limits.
a uav system is often compatible with a variety of different hardware hence it is accompanied by a number of hardware limits.
for example px4 has limits some of which are shown in table .
in practice it is difficult for developers to handle a large number of limits correctly.
when they make mistakes the uav systems may suffer from various types of limit bugs.
in particular we observed the following three subtypes of bugs of root cause limit conflict.
definition developers set parameter limits that are in conflict with each other.
due to various relationships between limits two limits may have conflicts in their scope when set by developers.
a typical example is issue in px4.
in this issue pitch limits are applied before applying setpoint offset which means that the pitch limit does not consider the offset of pitch setpoint.
this conflict will cause the pitch limit value to increase by one unit of the setpoint offset.
listing shows the patch to fix the bug .
to eliminate the conflict the pitch limits need to subtract the offset.
limit checking missing.
definition developers miss the limit checking for the computation result.
limits checking is frequently required in a uav system but developers may forget to check certain limits.
in issue of px4 developers missed the limit checking of the setpoint after the velocity computation has been done.
this issue caused the drone to fly away.
listing shows that the developers added the constraints for all directions of the velocity setpoints to fix the bug.
limit range.
definition the range of the limit is not right for some hardware or violates certain system requirements.
the range of some limits profoundly impacts the system behavior.
due to the lack of hardware knowledge the limit range set by developers may compromise the stability of a uav system.
an example is issue of px4.
the developers set the range of the actuator control parameter to be to which will enable the negative thrust.
a right range should be to .
in listing the developers set the correct range to fix the problem of wing throttle because a drone with fixing wings will crash with a negative thrust.
.
.
root cause math.
definition math bugs arise from the misuse of mathematical formulas.
uav systems often rely on various complex control and estimation algorithms.
comparing to traditional software uav software is more prone to math bugs.
radians parameters .
pitch limit min radians parameters .
pitch limit max radians parameters .
pitch limit min parameters .
pitchsp offset rad radians parameters .
pitch limit max parameters .
pitchsp offset rad listing the fix of issue .
special velocity setpoint limitation for smooth takeoff after slewrate !
if in takeoff in takeoff takeoff vel limit vel sp ramp vertical velocity limit up to takeoff speed takeoff vel limit params .
tko speed dt takeoff ramp time .
get takeoff vel limit vel sp dt takeoff ramp time .
get limit vertical velocity to the current ramp value vel sp math max vel sp takeoff vel limit make sure velocity setpoint is constrained in all directions xyz float vel norm xy sqrtf vel sp vel sp vel sp vel sp if vel norm xy vel max xy vel sp vel max xy vel norm xy vel sp vel max xy vel norm xy vel sp math constrain vel sp params .
vel max up params .
vel max down listing the fix of issue .
sometimes it can be very difficult for developers to accurately select the most suitable mathematical formula.
in our dataset there are two major subtypes of math bugs wrong calculation method.
definition developers use the wrong mathematical formulas operations.
developers use the wrong calculation formula which can produce abnormal system outputs.
in issue of px4 the developer incorrectly computed the mixing tables which are a part of the output in mixer.
as we mentioned in the background section the mixer outputs the value to the actuator.
due to this bug the drone will exhibit abnormal flight status.
listing shows the fix of issue .
need improvement.
definition the mathematical formulas used in program are imprecise or inefficient.
in some cases there is no obvious error in the use of mathematical formulas or operations but the calculation results are not accurate enough.
this canesec fse august athens greece dinghua wang shuqing li guanping xiao yepang liu and yulei sui fixed wing scale throttle to .. and other channels to .. if actuators .
output pwm default min if i !
scale pwm out pwm default min .. pwm default max us to .. for normal channels msg .
controls actuators .
output pwm center pwm default max pwm default min else scale pwm out pwm default min .. pwm default max us to .. for throttle msg .
controls actuators .
output pwm default min pwm default max pwm default min listing the fix of issue .
float out roll rotors .
roll scale pitch rotors .
pitch scale roll pitch scale yaw rotors .
yaw scale thrust boost thrust boost rotors .
thrust scale out rotors .
out scale listing the fix of issue .
the lower the voltage the more adjust the estimate with it to avoid deep discharge const float weight v 3e 4f remaining voltage remaining weight v remaining weight v remaining voltage directly apply current capacity slope calculated using current remaining discharged mah loop capacity .
get remaining math max remaining .f listing the fix of issue .
be solved by using a better calculation method.
for instance as shown in listing developers fixed the issue of px4 by changing the old battery estimation algorithm to a more precise algorithm.
besides such cases some math bugs are caused by inefficient computations and can be solved by fine tuning the inefficient algorithm.
.
.
root cause inconsistency.
definition the root cause of the bugs is related to inconsistency between hardware and software.
bugs often arise when developers are not familiar with the consistency between hardware and software in a uav system.
a typical case is that developers incorrectly use the function with a wrong drone models.
listing gives an example .
the developers intended to use the function land detector with multi copter.
since land detector is a function for another drone model vtol the drone cannot take off with this inconsistent function.
in addition to the inconsistency between functions and drone models there are also inconsistencies between hardware interfaces and interface protocols inconsistencies between sensors and libraries and so on.
we observed that inconsistency bugs are more commonly found in the uav system designed for multiple devices and may cause drone crashes when critical functions fail to work.
even worse due to various complex and diverse inconsistencies between hardwarepwm out sim mode pwm sensors start commander start land detector start multicopter land detector start vtol navigator start ekf2 start vtol att control start listing the fix of issue .
m sensor data .
pressure pa convertpressure pressure from sensor .
m sensor data .
temperature c converttemperature temperature from sensor .
m sensor data .
pressure pa convertpressure pressure from sensor .
m sensor data .
last read time usec driverframework offsettime m sensor data .
read counter listing the fix of issue .
and software it could be very difficult for developers to completely avoid such bugs.
.
.
root cause priority.
definition the root cause of the bugs is related to hardware or software priority issues.
unlike traditional software priority bugs some of the uav specific priority bugs are caused by the hardware priority.
these types of bugs are hard to be observed because there are no obvious mistakes in the program logic and most such bugs do not cause significant deviation of system performance.
listing gives a typical example of this type of bugs .
the patch which fixes the bug changes the order of pressure and temperature conversion.
as we can see from the code snippet the affected two statements have no common variables and it seems that such a fix would not cause any semantic changes.
however in many uav systems according to the bmp280 data sheet and the sample pressure and temperature conversion code the temperature conversion must be done before the pressure conversion as the latter uses some results from the former .
in other words there exists hidden data dependence between the two sensors.
such priority bugs require developers to have sufficient knowledge of the underlying hardware.
unfortunately due to the diversity of hardware in uav systems e.g.
different sensors and development boards this requirement is often impractical for uav software developers.an exploratory study of autopilot software bugs in unmanned aerial vehicles esec fse august athens greece parameter handles .
land slope angle param find fw lnd ang parameter handles .
land h1 virt param find fw lnd hvirt parameter handles .
land flare alt relative param find fw lnd fl alt parameter handles .
land flare alt relative param find fw lnd flalt parameter handles .
land flare pitch min deg param find fw lnd fl pmin parameter handles .
land flare pitch max deg param find fw lnd fl pmax parameter handles .
land thrust lim alt relative param find fw lnd tlalt listing the fix of issue .
.
.
root cause parameter3.definition the root cause of bugs is related to improper handling of parameters.
the parameters in a uav system are very complicated.
for instance px4 has more than parameters.
most parameters include a limit and a default value which are defined by developers based on the relevant function module attribute.
as parameter settings affect the performance of a uav system improper handling of parameters may induce bugs.
in our study we found the following two major subtypes of root causes for parameter of bugs parameter missing.
definition the parameter setting is not enough to meet the requirements of system functions.
parameter setting is generally based on existing functional requirements.
with the increase of system functions if some relevant parameters are not set accordingly the uav system may exhibit unexpected behavior.
in addition the existing parameters may also be insufficient if developers fail to consider all possible scenarios when setting the parameters.
in issue of px4 the drone started to plummet when the users wanted to nudge the drone during landing.
to fix this bug the developers added a parameter to allow users to operate the stick during landing.
parameter misuse.
definition such bugs are caused by the misuse of certain parameters.
since parameters have diversified characteristics in order to use them correctly developers need to understand the functions related to the parameters the naming of the parameters as well as the scope of the parameters.
this is a non trivial task and we observed various parameter misuses.
for example in issue of px4 the mistaken use of the two parameters fw lnd fl alt andfw lnd flat was caused by a similar naming.
the patch to fix the bug is shown in listing .
.
.
root cause hardware support.
definition the root cause of the bugs is related to the flawed support of certain hardware.
for this category we only included the bugs related to the driver programs of a uav s underlying hardware.
there are also hardware support bugs in traditional software systems.
we found that the hardware support bugs in uav systems are no different to those in traditional systems.
most of them are caused by driver defects e.g.
compatibility issues .
we call this type of bugs uavspecific because the proportion of such bugs in a uav system is 3we did not put limit related bugs in the root cause parameter because not all parameters have the limit property.ap notify flags .
pre arm check true ap notify flags .
pre arm gps check true initialise battery battery .
init init baro before we start the gcs so that the cli baro test works barometer .
set log baro bit mask log imu barometer .
init listing pull request .
large i.e.
.
as the uav hardware support is generally not as good as in a traditional system e.g.
linux .
.
.
root cause correction.
definition the root cause of the bugs is related to the correction of sensor data.
the data obtained by some sensors need to be corrected before they are used.
for example the gps data can be disturbed by various environmental conditions e.g.
temperature and therefore need to be corrected to ensure accuracy.
since intensive data corrections are required in a uav system developers may easily miss some correction process resulting in various unexpected bugs.
.
.
root cause initialization.
definition the root cause of bugs is related to the initialization or reset of certain values.
similar to data correction we found that missing initialization is also a typical type of mistakes made by developers.
even some developers remember to do the initialization but they may often forget to redo the initialization i.e.
reset values during the computation.
listing shows an example where the developer forgets to initialize the battery during the calculation .
.
rq2 challenges in bug detection to address rq2 we first classified the uav specific bugs by answering the following two questions can the bugs be triggered by deterministic inputs?
can the bugs cause severe abnormal behavior e.g.
uav crash uav unexpected trajectories ?
the first question concerns whether the bugs can be triggered easily while the second question concerns whether the bugs can be observed or captured easily.
if the answers to both questions are yes the chances of detecting such bugs are relatively high.
if the answers to both questions are no the bugs could be very difficult to detect.
for rq2 we focused on analyzing bugs with two no answers.
besides we also analyzed the bugs with multiple pages of comments on github because sometimes this means that developers need a lot of discussions to determine the location and cause of bugs before bug fixing.
based on the characteristics of uav systems and the studied bugs we identified three challenges for detecting uav specific bugs.
.
.
challenge test oracle design.
in traditional programs an input usually corresponds to one or more specific outputs.
this relationship can help check the correctness of a program when inputting a value if the program outputs an unexpected state or value the program is considered buggy.
here the expected output of the program is a test oracle.
it is known that designing an oracleesec fse august athens greece dinghua wang shuqing li guanping xiao yepang liu and yulei sui figure which trajectory a or b is correct?
for bug detection is a difficult problem when testing traditional software .
the test oracle design is even harder for uav systems because the relations between the input and the output of a uav is often non deterministic.
typically the input of a uav can be divided into two parts the user input and the input from the physical environment.
the user input such as the input from the drone s controller and the input from the command line interface of a simulator is generally well defined.
but the input from the physical environment is obtained by sensors.
these inputs are highly dynamic and cannot be precisely defined or predicted.
although many developers have used parameter constraints to limit the range of the inputs from the physical environment the vast volume of combinations of such inputs are still hard to be explored during testing.
on the other hand the uav outputs generally contain continuous physical trajectories .
given a command input to a drone e.g.
fly from point a to point b if the drone outputs two different trajectories that both complete the task as shown in fig.
it would be hard to determine which trajectory is correct.
furthermore even if a drone outputs a physical trajectory that is exactly the same as in a previous successful test the behavior can be wrong when other factors e.g.
wind speed are considered.
because of this reason to effectively test uav systems one has to holistically consider multiple factors.
this is clearly challenging and it could be very difficult to determine an ideal oracle for uav testing.
in a recent study the authors presented a trajectory prediction method to generate the test oracle for uav systems.
however the application scenario of this method is limited to continuous and differentiable physical trajectories and the correctness of the system is determined by simply judging whether the physical trajectory is smooth or not without considering other factors.
by studying the bug comments we found that uav developers heavily relied on experts to judge the correctness of uav outputs.
as the judgment of the experts highly depends on their experience and domain knowledge such human oracles may not be reliable.
it is also difficult for experts to determine the correctness of uav behaviors from one single output e.g.
trajectory .
future research may focus on the oracle problem of uav testing and explore how to automate the testing process.
we believe that it is also important to design testing frameworks that allow experts to clearly define criteria to judge the correctness of uav behavior so as to improve the reliability and reusability of human oracles.
.
.
challenge bug reproducing.
being able to reproduce a bug is crucial for verifying the correctness of bug detection in uav systems .
the physical environment of uav systems isnon deterministic and it is possible that two executions behave differently in different physical environments.
when reproducing a uav specific bug the first step is typically to reproduce the running environment.
however the physical environment is highly dynamic and noisy which means that it cannot be reproduced perfectly in the real world.
via our analysis of bug reports we found that uav developers mainly rely on simulators to reproduce bugs.
usually a physical environment level simulation is available and simple enough.
nonetheless the simulation of drone systems is often simplified and unable to catch all the imperceptible changes either system level or environment level for bug detection.
implementing highly realistic simulation is expensive in terms of human effort and there are also many technical challenges e.g.
how to model and simulate uncertainty .
besides the simulators may have bugs which could bring new problems when reproducing uav specific bugs.
traditional software also suffers from the non determinism problem.
however in uav systems the problem becomes much more common because almost every execution could be affected by nondeterminism.
this problem needs more research attention.
.
.
challenge hardware dependence.
hardware dependence is a situation where there is data dependence between different hardware in a uav system.
while the data dependence problem in traditional software has been well explored we observed that the uav bugs caused by hardware dependence cannot be detected with the existing techniques.
this is because some data dependence in uav systems could be hidden in the hardware level.
in the issue mentioned earlier the developers triggered the bad performance of the drone.
because of hardware dependence no bug can be found by analyzing the source code.
this bug was discovered by a developer who was working on the bmp280 data sheet which describes the hardware dependence between the pressure sensor and temperature sensor.
the computations in a uav system are driven by the sensor inputs which are limited by the parameter settings see table for examples .
however the parameter settings rarely include the hardware dependence or the priority of sensors.
finding bugs caused by implicit hardware dependence could be a huge challenge for uav software developers who lack knowledge of the underlying hardware.
future research may study how to address this challenge to ease bug finding in uav systems.
.
rq3 challenges in bug fixing to address rq3 we first classified the uav specific bugs by answering the following questions a is the bug fixed quickly i.e.
in a week ?
b is the bug fixed with less than three patches?
question a concerns the fixing time and question b concerns the difficulty of fixing.
for rq3 we then manually analyzed the bugs that have at least one no answer of the two questions we call them naandnbbugs to find out the reason why developers took a long time to fix the bugs and why the bug fixing requires many three or more patches.
with the analysis we identified two challenges in fixing bugs in uav systems.an exploratory study of autopilot software bugs in unmanned aerial vehicles esec fse august athens greece .
.
challenge hardware related bugs fixing.
developers took a lot of time to fix some hardware related bugs.
for example uav specific bugs in px4 took developers more than one week to fix and out of the bugs are hardware related bugs4.
bug fixing in a traditional program often aims to find solutions in the source code.
however in a uav system it is difficult for developers to find solutions from source code to fix hardware related bugs.
for example in relation to issue which we have mentioned in section .
.
there is no obvious fault at the code level.
hence it is hard for the developers to find a solution to such bugs in source code.
even if the developers know the properties of the hardware it could still be difficult to fix such bugs.
due to the interdependence of hardware and software unilateral compliance with hardware properties does not solve some bugs in uav systems.
for the issue the hardware parameter limits can be set to to according to the hardware properties but in practice the drone s thrust cannot be set to a negative value.
therefore when fixing such bugs developers need to have both software and hardware knowledge and also need to consider the usage scenarios of the system.
what s more considering that uav systems also need to be compatible with different drone models fixing hardware related bugs could be more difficult.
when attempting to fix issue of px4 the developers said that however for so i think i need to know more about fw and vtol.
can you elaborate a bit more about vtol and landdetector?
when is a vtol using mc and when fw?
why do we need to check for rotary wing in the mc landdetector i thought that if we have a rotary wing then we use mc landdector ?
from the above comment it can be inferred that the developer was confused about what strategies to take when fixing bugs for different drone models.
in the future it is highly desirable to design tools to give developers assistance to help them fix uav specific bugs more effectively.
.
.
challenge fault localization.
whether a bug is naornb developers could spend a lot of time on fault localization.
nbbugs have multiple fixing patches which usually means multiple modules are involved.
nabugs contain many hardware related bugs e.g.
in px4 .
all these have brought challenges to uav fault localization which is a critical step for debugging .
a typical way to localize a fault in a program is to examine the program output at several program locations and compare the output values with the expected ones.
however as discussed earlier in a uav system it is difficult for developers to predict the expected value state at a certain program location.
although the expected values states can be given by experts it could still be difficult for developers to judge the correctness of uav behavior due to nondeterminism.
to understand how to overcome the challenge we further analyzed px4 bugs for which we can identify the developers strategies of localizing faults by reading the bug reports.
interestingly we observed four strategies that the developers often use to localize bugs as summarized in table .
in the following we discuss each of these strategies in detail.
4these hardware related bugs include parameter bugs limit bugs priority bugs initialization bugs correction bugs and inconsistency bugs.table identified fl strategies from px4 uav specific bugs fl strategy number of bugs percentage flight log .
changing parameters .
bug reproducing .
changing code .
unknown .
figure sequence of events from issue .
strategy referring to the data in multiple flight logs.
a flight log often includes many details of the uav system s runtime behavior.
by inspecting multiple logs developers can usually pinpoint the bug location more accurately.
in issue of px4 the developer described a priority bug.
the drone crashed after the sequence of events as shown in fig.
.
as we know knowing the sequence of events that triggers a bug in an event driven program can effectively help locate the faults.
however knowing the event sequence is not enough for fault localization in a uav system.
this is because unlike the clearly defined events e.g.
clicking a button in event driven programs uav system events are usually vaguely described by developers or users.
the description is often not detailed enough making it difficult to locate the buggy modules and pinpoint the potential faults.
in this case of issue the developer located the bug by examining the log of the inertial measurement unit imu and the selected sensor.
through the abnormal timeout of the imu and sensor the developer located the fault at a system module i.e.
sensors which can handle the sensor s timeout.
strategy changing parameters.
in px4 issue the drone drifted when estimating attitude and the reporter said i ve already tried changing parameters in attitude q estimator via qgroundcontrol but these changes don t seem to affect it.
as the comment indicates a drone user or developer may change some related parameters like the parameters in attitude q estimator in this case to test the drone behavior and localize faulty modules when the drone exhibits unexpected behavior.
in the above case although the system behavior was not influenced by the changes changing parameters still guided the developer to locate the bugs as shown in the fig.
.
strategy bug reproducing.
bug reproducing is a widelyused method to help locate faults in many software systems but it is not observed in our studied uav projects.
in px4 only three of the bugs were located using bug reproducing.
in issue of px4 the reporter reproduced the bug in the simulator and all critical uav runtime events are given to guide the fault localization.
withesec fse august athens greece dinghua wang shuqing li guanping xiao yepang liu and yulei sui figure the conversation between the bug reporter and the developer in px4 issue .
the detailed bug report and the information obtained by reproducing the bug the developers located and fixed the bug quickly.
although reproducing bugs can provide valuable information to help locate and fix the bugs we found that similar to many other projects the data provided in many uav bug reports are often very limited.
to facilitate fault localization uav project maintainers may define standards to guide bug reporting i.e.
what information should be included .
strategy changing code.
as uav developers and users may not be professionals when they localize faults they may simply rely on code changing rather than using sophisticated techniques or tools.
in px4 issue the uav s takeoff could not be detected in altitude mode.
the bug reporter tried to locate the fault by uncommenting some code lines to observe the uav s behavior.
suggestions for practitioners based on our empirical analysis we provide the following six suggestions for uav practitioners.
developers should pay attention to the output from the controller or the underlying hardware.
these outputs typically should be constrained within a reasonable range.
for example no matter what velocity or thrust computation has been performed the output needs to fall within in a correct value range.
developers should also pay attention to the correction of sensor data.
although data correction may only slightly adjust certain values it may significantly affect the dependability of the system.
for example temperature sensitive sensors gps sensors magnetic sensors and pressure sensors are all strongly related to flight control.
a small error in collecting and processing data from these sensors can cause serious consequences.
changing the values or properties of global parameters should be done very carefully.
even if the parameters cause bugs it may not be desirable to directly changing the parameters.
for example if the range of a parameter tis from to and a bug can be fixed by allowing tto take a value beyond it is preferred to fix this bug with new variables like a max t max instead of directly changing the range of t which may cause problems when other parts of the system also use t. developers should pay special attention to the initialization of hardware.
proper initialization of the underlying hardware could make a uav system more stable.
as mentioned in section .
.
flight logs can be very useful for fault localization.
uav users may include critical log data when reporting bugs to facilitate bug diagnosis.
nonetheless it requires sufficient expertise and debugging experience to ensure the accuracy of fault localization via log analysis.
in the future it is desirable to design useful tools to help developers effectively analyze flight logs.
developers should be careful when using functions in a uav system that supports multiple hardware models.
for example in px4 most of the functions applicable to multi rotor and vtol do not support the plane model since the plane s flight style is very different from that of multi rotor and vtol.
threats to validity the validity of our study results may be subject to several threats.
project selection.
first our empirical study only involved two open source uav projects.
the collected bugs may not be representative and comprehensive.
hence our findings may not be generalizable.
in fact we tried to find more projects but most other uav systems are either closed source or do not have enough bug data for our analysis.
we found that there are only five well known and large open source uav systems on github and the two projects studied in our paper are the most active ones with a total of closed issues.
to mitigate the threat we collected and thoroughly analyzed uav specific bugs in the two projects.
future studies may investigate more projects to further understand the characteristics of uav software bugs.
bug selection.
second similar to the previous studies e.g.
we only collected the issues with the bug label from the two project for our research.
while the developers and maintainers of the two projects have good labeling habits it is still possible for us to miss some real bugs that do not have the bug label.
in our future extension of this work we will consider studying issues with other labels or no labels.
manual analysis of bugs.
in our work all bugs are analyzed manually and it is inevitable that we could bring subjective judgment into the process.
to reduce the threat we had a lot of discussions when analyzing and classifying bugs and we also tried to find