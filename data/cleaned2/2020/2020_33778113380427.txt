cpc automaticallyclassifying and propagatingnatural language comments viaprogramanalysis juanzhai purdue university rutgers universityxiangzhexu nanjing universityyu shi purdueuniversity guanhong tao purdueuniversityminxue pan nanjing universityshiqing ma rutgers university lei xu nanjing universityweifeng zhang nanjing universityof posts and telecommunicationslin tan purdueuniversity xiangyuzhang purdueuniversity abstract codecommentsprovideabundantinformationthathavebeenleveragedtohelpperformvarioussoftwareengineeringtasks suchas bugdetection speciicationinference andcodesynthesis.however developers are less motivated to write and update comments making it infeasible and error prone to leverage comments to facilitate softwareengineeringtasks.inthispaper weproposetoleverage program analysis to systematically derive reine and propagate comments.forexample bypropagationviaprogramanalysis comments can be passed on to code entities that are not commented such that code bugs can be detected leveraging the propagated comments.
developers usually comment on diferent aspects of code elements like methods and use comments to describe various contents such as functionalities and properties.
to more efectivelyutilizecomments aine grainedandelaboratedtaxonomy of comments and a reliable classiier to automatically categorize a comment are needed.
in this paper we build a comprehensive taxonomyandproposeusingprogramanalysistopropagatecomments.
we develop aprototype cpc and evaluate iton 5projects.
the evaluation results demonstrate new comments can be derivedbypropagationfromothercodelocationswith88 accuracy.
among them we can derive precise functional comments for native methods that have neither existing comments nor source code.leveragingthepropagatedcomments wedetect37newbugs inopensourcelargeprojects 30ofwhichhavebeenconirmedand ixedbydevelopers and304defectsinexistingcomments bylookingatinconsistenciesbetweenexistingandpropagatedcomments including incomplete comments and wrong comments.
this corresponding authors.
permission to make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forproitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation ontheirstpage.copyrights forcomponentsofthisworkownedbyothersthanthe author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspeciicpermission and or afee.
request permissions from permissions acm.org.
icse may 23 29 seoul republic ofkorea copyright heldby the owner author s .
publication rightslicensed to acm.
acm isbn ... .
the efectiveness of our approach.
our user study conirms propagated comments align well with existing comments in terms of quality.
acmreference format juan zhai xiangzhe xu yu shi guanhong tao minxue pan shiqing ma lei xu weifeng zhang lin tan and xiangyu zhang.
.
cpc automaticallyclassifyingandpropagatingnaturallanguagecommentsvia program analysis.
in 42nd international conference on software engineering icse may23 29 seoul republicofkorea.
acm newyork ny usa pages.
introduction modernsoftwaresystemsusuallycontainalargevolumeofcode comments .
commentingcode hasbeenrecognized asa good programming practice which facilitates both code comprehensionandsoftwaremaintenance.forexample theresearchers in conductedexperimentsshowingthatcodecomments can help improve code readability while the researchers in demonstratedthatcodecommentsplayedasigniicantroleinmaintainingsoftware.moreover codecommentsprovideabundantinformation that can be leveraged to help perform a wide range of software engineering tasks such as bug detection speciication inference testing and code synthesis .
however as far as we know existing workbarelyutilizesprogramanalysistosystematicallyderive reine and propagate commentsthat provide rich semantics beyond traditionalartifactsthathavebeenusedinprogram analysissuch astypes controllowanddatalow.forexample bypropagation through program analysis comments can be passed on to code entities that are not commented such that code bugs can be detected by cross checking code withthe propagatedcomments.
due to the lack of standard of composing documentation developershave substantiallexibilityand theytend tousearbitrary ways to compose documentation.
they usually comment on diferent aspects of code elements like classes methods and variables and use comments to describe various contents such as summarizingthefunctionality explainingthedesignrationaleandspecifying theimplementationdetails.inaddition ascommentsarewritten in natural language they are intrinsically ambiguous and accurate ieee acm 42nd international conference on software engineering icse icse may 23 29 seoul republicof korea zhai et al.
linguistic analysis is needed to acquire their exact meanings and scopes.tobetterunderstandcodeandmoreefectivelypropagate comments wemustirstknowwhichcodeelementstheycomment onandwhatkindofinformationtheyconvey.thatistosay itis imperative to design a ine grained and elaborated taxonomy of code comments and develop a reliable classiier to automatically categorize acomment.
therehavebeenefortsinsoftwaredocumentationclassiication.
padioleauetal.
builtataxonomybasedonmeaningsofcomments.
the work in proposed a taxonomy of knowledge types inapireference documentation andusedthetaxonomytoassess theknowledgetheycontain.basedonthistaxonomy researchersin developed a set of textual features to automatically categorize theknowledge.in researchersstudiedcommentcategorization to provide better quantitative insights for comment quality assessment.featuresaremanuallygivenformachinelearningtechniques to automatically classify comments.
researchers in irst manually classiied more than code comments and then used supervised learning to achieve about classiication accuracy.
their taxonomies are not designed to be coupled with program analysis.
it is unclear how to propagate and infer comments based ontheirclassiication.
hence ourgoalistoirstbuildacomprehensivetaxonomyfrom diferent perspectives e.g.
what and why and diferent code entities e.g.
class and method and then design a uniform analysis to enable bi directional analysis program analysis propagates and updates comments and comments provide additional semantic hints to enrich program analysis.
multiple software tasks can beneit from the bi directional analysis.
for example leveraging program analysis to propagate comments can provide automation supportinmaintainingdocumentationwhichisdiicult and leveraging comment analysis can help detect software bugs by checking the comment semantics against sourcecode.
in this paper we propose cpc a principled and sophisticated software reasoning method that couples comment analysis and program analysis.
it automatically classiies comments based on diferent perspectives and code entities namely builds a comment taxonomy and thus each comment is attributed to a code element and becomes a irst class object just like other classic objects in program analysis e.g.
variables and statements .
based on the taxonomy cpcleveragesprogramanalysistechniquestopropagate comments from one code entity to another to update infer and associatecomments with code entities.
then cpcextracts semanticsfromthepropagatedcommentstofacilitatevarioussoftware engineering tasks such as code bug detection.
our contributions are as follows weconstructacomprehensivecommenttaxonomyfromdifferentperspectiveswithvariousgranularitylevels andtrain sixclassiiersusingthreealgorithmstoautomaticallycategorizecommentsintoappropriateperspectivesandgranularity levels.
we propose a novel bidirectionalmethod ofleveraging programanalysistopropagatecommentsandleveragingcommentanalysistofacilitatebugdetection whichachievesa seamlesssynergyofcommentanalysisandprogramanalysis.
we develop a prototype cpc based on the proposed idea andevaluateiton5largereal worldprojects.theevaluationresultsdemonstratethat41573newcommentscanbederived bypropagationfromothercodelocationswith88 accuracy.
amongthem wecanderiveprecisefunctionalcommentsfor native methods that have neither existing comments nor source code.
our user study shows propagated comments are as useful as existing comments inhelping developers.
motivation modern software provide abundant natural language nl comments and there is substantial existing work on analyzing nl commentsandleveragingtheminawiderangeofsoftwareengineering applications.
however as far as we know existing work hardly leveragesprogramanalysistechniquestoderive reine andpropagatecommentssystematically.suchpropagatedcommentscontain wealthy semantics beyond traditional artifacts that have been widelyusedinprogramanalysislikedatatypes.forexample by usingprogramanalysistechniques wecanpasscommentsonto codeentitiesthatarenotcommentedandleverageinformationcontainedinthepropagatedcommentstodetectcodebugs.ouroverall goal is to achieve code comment co analysis program analysis propagates and updates code comments and code comments provideadditional semantic hints to enrich program analysis.
softwaredeveloperstendtocommentondiferentaspectsofdifferentcodeelements .commentsofdiferentperspectivesentail diferentpropagationrules.considerthetwocomments throws indexoutofboundsexceptioniftheindexisoutofrange index index size .
and shits any subsequent elements to the let subtracts one from their indices .
of method remove int index .
the former can be propagated through data low while the latter cannot.
suppose we have an assignment o list.remove i by propagating the irst comment fromthe methoddeinition tothe statement wecanknowthatifthecondition i i size holds theassignmentstatement willthrowan indexoutofboundsexception which can be used to check the code.
however the second commentdescribesthe implementationdetailsinvolvingthedata structure used in remove int index which would be misleading and make no sense if propagated to the assignment.
hence the irststeptowards commentspropagation and inference is to build acomplete taxonomy for comments.
there have been eforts in software documentation classiication .theresearchersin proposeataxonomy basedonthefollowingfourdimensions commentcontents commentauthors users commentlocations e.g.
beforealooporina macro and comment composition time.
in researchers manuallyclassifyapidocumentationbasedontheknowledgetypes e.g.
functionalities concepts directives and code examples to help humansunderstandandgaugethequalityofapidocumentation.
theyalsostudythedistributionofdiferentkindsofcomments.the taxonomies in are similar and both include categories like purpose thefunctionalityofthecode underdevelopment topic related to ongoing future development and metadata authors license etc.
.
they are produced to facilitate quality analysis of comments.thetaxonomyin isproposedtoinvestigatedevelopers documentation patterns while the work studies comment categorization to provide better quantitative insights about the documentation forcomment qualityassessment.
theirtaxonomies 1360classifying andpropagatingnatural languagecomments viaprogram analysis icse may 23 29 seoul republic of korea creates a new array with the specified component type and length.
... exception negativearraysizeexception if the specified code length is negative 05publicobject newinstance class ?
componenttype intlength throwsnegativearraysizeexception 06returnnewarray componenttype length ... 08private static native object newarray cl ass ?
componenttype intlength throws negativearraysizeexception new comment creates a new array with the specified component type and length.method2st propagation st2callee propagation method what figure comment defect detection class arraylist e implements all optional list operations and permits all elements including null.
01private finallist collection e all newarraylist collection e ... 02publicintsize intsize for finalcollection e item all size item.size returnsize permit null elements class property may be null instantiation propagation throw nullpointerexception if item is nullcontainer propagation figure codebug detection however donotdistinguishcommentsofdiferentcodeentitiesand are not designed to be coupled with program analysis.
it is unclear where and how to propagate and infer comments based on their classiication.forourpurpose weproposeacommenttaxonomy according to the commented subjects e.g.
classes methods and statements andperspectives e.g.
what why andhow .foreach kind of comments we develop speciic rules to propagate them through program analysis.
we will use cases todemonstrate the beneitsofpropagatingcommentsaccordingtotheircategories.ina nutshell ourtechniquecanrevealbugsinbothcodeandcomments.
code bug detection.
propertiesarecriticalinformationembedded incomments thatdeine intended behaviors of codeelements.
thetopboxoffig.1showsthecommentofclass arraylist e from jdk.thisclasspermitsallelementsincluding null denotedwith green background as items in the list.
here the description of permittingnullelements is recognized as a property comment by our technique step .asapropertycomment itcanbepropagatedto the code where class arraylist is actually used.
the bottom box of fig.
is the code snippet from apache commons collections where theclassield allisinstantiatedasan arraylist instanceatline1.
the class property permitting nullelements ishence propagated from class arraylist to its instance step applying the instantiation propagation rule detailed in section .
.
when variable allis accessedlaterintheprogram line4 thesamepropertyshouldalso hold.
since variable allhas the property of allowing nullelements each of its elements itemis permitted to be null step3 .
as the size methodof element itemisinvokedtomeasure the size with itembeingnull itwillcausenullpointeraccessandhencetriggera nullpointerexception.
this is a new bug detected by our technique step4 .intotal wedetect29suchbugswhichcannotbedetected byexistingtechniquessincetheyonlyuseinformationcontained in existing comments which rarely comment on local variables especiallycontrolvariablesonlyusedduringiteration.allthe29bugs have been conirmed and ixed by developers.
in addition we detectanother8 bugsbasedonour propagatedcomments.
commentdefect detection.
comments are critical for code understanding.
they also serve as instructions manuals for third party developers to utilize classes and methods.
defective commentscanmisleaddevelopersandevenincurcriticalbugs.fig.
demonstrates a real world case where comments are missing for nativemethods.method newarray isimplementedusingnative code line and ithas two arguments componenttype andlength.
although comments are highly desirable here due to the black box natureofnativeimplementation thereisnocommentforthenative method which can potentially lead to bugs e.g.
pass to parameterlength .
such native methods are implemented in other languages e.g.
c and assembly where the source code in general is unavailable.
comments of these methods cannot be generated using existing techniques since they either summarize source code toinfercomments oranalyzeexistingsoftwarerepositoriesanduse the comments from similar code.
we showcase how our technique can address this problem using the example in fig.
.
firstly there is only one statement in method newinstance line .
hence wecanapplyrule property method2st detailedinsection6.
to propagate the what comment lines meaning the functionality associatedwithmethod newinstance tothestatement at line step .
secondly the statement at line only invokes the native method newarray which satisies the preconditions of ruleproperty st2callee detailed in section .
.
thus the commentcan befurther propagatedfrom thestatementat line06 toitscalleemethod newarray step2 .throughthepropagation anewcommentcanbegeneratedforthenativemethod specifying thefunctionalityof newarray isto createa newarraywiththe specified component type and length.
.
using our technique we are able to infer comments for native methods that have neither source code nor comments in jdk.
note that these native methodsmaybeinvokedbymanyotherjavamethodssuchthattheir generated comments can be usedto help theseinvocations.
wrong propagation without classiication.
a comment taxonomy is vital for comment propagation as diferent kinds of comments convey diferent semantic perspectives.
as such some of them cannot be directly propagated.
for instance even if two code snippetsareexactlythesame propagatingcommentfromoneto the other may be problematic.
consider the two code snippets in fig.
a and fig.
c .
the method in fig.
c has a propertycomment thismethodwillblockuntilthebytecanbewriten.
.
although the two code snippets are syntactically identical we cannot propagate the property comment from the method in c to the methodin a .thisisbecausethemethodinvokedatline4of a and that invoked at line of c have diferent implementations whichhavediferentcharacteristics.speciically line4in a calls the write method in fig.
b that is non blocking.
in contrast line in c calls the write infig.
d that is blocking indicated by the synchronized keyword in fig.
e .
therefore it is incorrect to propagate the aforementioned property comment.
however existing techniques use the comment in c as comment for the method in a as they work by identifying code clones and sharing comments across all clones.
in contrast our technique does not allow propagatingproperty comments insuch cases.
1361icse may 23 29 seoul republicof korea zhaiet al.
03public void write byte b intoff intlen throwsioexception ... while !def.needsinput deflate d java.util.zip.deflataeroutputstream.write byte b int off int len 04publicvoidwrite intb throws ioexception byte buf newbyte buf byte b 0xff write bu f a java.util.base64.
write int b writes a byte to the compressed output stream.
this method will block until the byte can be written.
public void write intb throwsioexception byte buf newbyte buf byte b 0xff write bu f c java.util.zip.deflataeroutputstream.
write int b 04public int deflate byte b intoff intlen intflush ... synchron ized zsref ... intn deflatebytes zsref.address b off len flush ... e java.util.zip.deflataer.
deflate byte b int off int len int flush 04public void write byte b intoff intlen throwsioexception ... while nbits24 ... out.
write base64 ... b java.util.base64.
write byte b int off int len cannot be pr opagated method property code clone does not block the method block the methodcall callcall figure wrong propagation withoutclassiication table examples ofsoftware commentstaxonomy entity perspective comment example proje ct class methodor field classwhat this classis a member of thejava collectionsframework.
jdk arraylist why thisenables eicientprocessing when most tasks spawnother subtasks.
jdk forkjoinpool how it is done resizable array implementation of thelistinterface.
jdk arraylist property implements all optional listoperations andpermitsall elements includingnull.
jdk linkedlist how to usebut using thisclass one mustimplement onlythecomputenext method and invokethe endofdata method when appropriate.guava abstractiterator methodwhat pushes an item ontothetop of thisstack.
jdk stack push eitem why iteliminatestheneed for explicitrangeoperations.
jdk arraylist sublist intfrom intto how it is done shifts any subsequent elementsto theleft.
jdk linkedlist remove int index property thismethod is not a constant time operation.
jdk concurrentlinkeddeque size how to use thismethod can be called only onceper callto next .
jdk iterator remove statementwhat make a new arrayof a sruntime type butmy contents.
jdk arraylist toarray t a why toget betterand consistentdiagnostics we calltypecheck explicitly oneach element.
jdk collections checkedcopyof collectioncoll how it is done place indices in thecenter ofarray thatis not yet allocated .zou jdk workqueue workqueue forkjoinpool forkjoinworkerthread property thisshouldn t happen since we are cloneable.
jdk arraylist clone how to use use as randomseed.
jdk workqueue registerworker forkjoinworkerthreadwt variablewhat the number of charactersto skip.
guava charstreams skipfully longn why helps prevent entries that endupin thesamesegmentfromalsoending upin thesamebucket.
guava localcache intsegmentshift how it is done modiied onadvance split.
guava charbuferspliterator intindex property theindex must be a valuegreater thanor equal to .
jdk vector setelementat eobj intindex how to use thecollectionto be iterated.
jdk collections collectioniterate the taxonomyofcomments as aforementioned taxonomy is critical for comment propagation.
however existingtaxonomiescannotbeleveragedtofacilitatecomment propagation due to two main reasons.
the irst one is that commentsarenotassociatedwiththecorrespondingcodeentities makingitimpossibletoleverageprogramanalysistopropagatecomments.
forexample weneedtomakesureacommentiscommentingona variablebeforewecanpropagateitthroughadeinition userelationofthevariable.thesecondreasonisthat thetaxonomiesare not designed to be coupled with program analysis and comments in a category byexistingwork tendtodescribemultipleperspectivesofa codeentitysuchthatitisunclearhowtopropagatesuchcomments .
henceweproposetoconstructacommenttaxonomybyclassifying comment texts based on twodimensions code entity andcontent perspective where code entity means elements like classes and methods and content perspective means functionalities rationales implementationdetails etc.suchataxonomyisvitalsincediferent commentsdescribediferentcodeentitiesfromdiferentperspectives e.g.
what why and how which entail diferent propagation rules.
to develop a comprehensive and rigorous taxonomy we performed a content analysis which is a methodology for studying the contentsofdocumentsandcommunicationartifacts section4 .
ourinaltaxonomy is illustratedintable1.the irst column lists the code entities namely class method statement and variable which are the subjects that are commonly commented by developers.
for each code entity we are interested in the following ive perspectives what why how it is done propertyandhow to use.
what.thewhatperspectiveprovidesadeinitionorasummaryof functionalityofthesubjectand oritsinterface.criticalsemanticscanbeextractedfrom whatinformation suchassecuritysensitivity which is important for vulnerability identiication.
by reading such type of comments developers can easily understand the main functionality of the corresponding code entity without diving into implementation details.
for example the comment pushes an item onto the top of this stack in the seventh row of table describes the main functionality of method push e item .
why.thewhyperspective explains the reason why the subject is provided or the design rationale of the subject.
there are two scenarios in which whyperspective is important.
first it helps developersunderstandmethodswhoseobjectiveismaskedbycomplex implementation.
for example the comment helps prevent entriesthatendupinthesamesegmentfromalsoendingupinthe samebucket ofthemethod segmentshift conveyswhyweneed this method while from the implementation we can only tell it movessomeobjects.second thereexistmultiplemethodsthatlook similarbutservediferentpurposes.inthiscase developersoften providewhycommentstopointoutwhythesesimilarmethodsare neededandexplainwhy they are not plain redundancy.
how it is done.
thehow it is done perspectivedescribes theimplementationdetailslikethedesignorthework lowofthesubject.
suchinformationiscriticalfordeveloperstounderstandthesubject especially when the complexity is high.
detecting inconsistencies between how it is done comments and implementation is a way to ind bugs.
moreover many program analyses avoid analyzing complexlibraryimplementationduetotheentailedspaceandtime overhead.
instead program analysis developers often rely on howit is done commentstosynthesize muchsimpler codesnippetto 1362classifying andpropagatingnatural languagecomments viaprogram analysis icse may 23 29 seoul republic of korea model library functionalities.
for example the comment shits the element currently at that position if any and any subsequent elementstotheright addsonetotheirindices .
ofmethod add int e impliesthatwecanimplementthefunctionalitybymanipulating an array within a loop statement e.g.
for int i size i index i i elements elements .
while the original library code is usually highly optimized and hence complex and diicult to analyse the modelcode is simpleandmucheasier to analyze.
property.
thepropertyperspectiveassertspropertiesofthesubject e.g.
pre conditions post conditions of a function and even some statements.
pre conditions specify the conditions that should hold in orderto usethe subject whilepost conditions indicatetheresult of using the subject.
such comments are of importance as they canbe usedin many software engineering tasks such asprogram veriication defect detection and program testing.
for example the comment the index must be a value greater than or equal to .
of the variable index a parameter of setelementat e int speciiesapre condition index 0thatmustbesatisiedformethod setelementat e int to work properly.
how to use.
thehow to use perspective describes the expected set upofusingthesubject suchasplatformsandcompatibleversions.forexample thecomment butusingthisclass onemust implement only the computenext method andinvoke theendofdata method when appropriate.
of the abstract class abstractiteratorclearly points out the required implementation in its concrete classes.thesecommentsareimportantforcode commentinconsistency detection .
taxonomyconstruction inthissection wediscusshowweperformalargescalestudyof program comments to derive the aforementionedtaxonomy.
.
commentsampling we collected a sample set of natural language comments from four frequently used libraries namely jdk guava apache commons collections and joda .
all the four projects are open sourced.
the size of the projects varies from to classes and from to kloc and of the lines of code arecomments whichclearlyindicatesthatdocumentationisnot anecdotal inthoseprojects.
due to the lack of standard of composing documentation developers have substantial lexibility.
they tend to have arbitrary ways of composing comments and comment on diferent aspects of code elements like methods and parameters.
to ensure our study has good coverage we performed stratiied random sampling to collect comments for distinct code entities classes methods statementsandvariables.foreachsourceile werandomlysampled comments from each kind of code element in proportion to the number of such elements in the ile.
this ensured that comments of diferent kinds of code entities were covered.
developers usually write both single line and multi line comments comment blocks and the sentences in a multi line comment tend to provide diferenttypesofinformationlikewhatthefunctiondoesorhow the function is implemented.
as such we choose to use sentenceas the comment unit to construct the sample set.
in total we collected comment units.
.
coding procedure in this section we illustrate the coding procedure that we followed to construct the comment taxonomy.
coding procedure is a standardanalyticalprocessthatcanbeutilizedtodeineandclassify asubjectdataset.tominimizesubjectivity wefollowedthedefault setting oftheprocedure andmade use offour coders participants in a coding procedure .
all the coders had at least four years of programming experience and were acquainted with program comments.withtheintentionofspecifyingastartingcodingframework onecodercarriedoutapilotstudyon200commentsofthe sampling set by identifying diferent content perspectives with the correspondingcharacteristics.thisstudybroughtforththeinitial comment taxonomy which covered the majority of the inal taxonomy.
some categories shown in table did not occur in the comments and we reined the taxonomy in the later phrase.
based ontheinitialtaxonomy thiscoderhelda60 minutesessiontotrain theremainingcoderseitheron siteorthroughvideoconferences.
during the session we discussed the meaning and the examples of eachcategory andclariiedmisunderstandingsthat arose.
the comment units were randomly and evenly assigned to allthecoders whichensuredthateachcodercategorizedcomments of all the four projects.
for each comment unit the coders identify its subject the type of code entity and analyze its content e.g.
to identify information like the functionality .
each comment unit may target at diferent code entities and fall into multiple content categories.
for example the comment returns the head of this deque or null if this deque is empty of method pollfirst not only describes the functionality what of this method but also impliestheimplementation how it is done ofthismethod.insuch cases the coders would mark the comment with two labels.
as mentioned earlier it is possible that the coders would identify some categories that were not in the initial taxonomy.
thus the to be completed taxonomy was shared among coders via an online spreadsheet whichallowedeachcodertoaddnewcategoriestothe taxonomy.
once a new category was identiied and included in the taxonomy alltheothercoderswouldbenotiiedandtheywould discussandverify.ifallthecodersagreeonthenewcategory then the taxonomy wouldbe updatedto include the newone.
as we manually processed comments it is inevitable to introduce subjectivity.
to minimize such subjectivity we utilized crossveriicationbyassigningeachcommentunittotwodiferentcoders.
whendisagreementoccurs allthecoderswouldinvolvetohave anopendiscussiontoresolveit.sincetowhatextendtwocoders agreed on the categories of each comment unit is a direct measurement of both the reliability of the comment taxonomy and the quality of the labeled comments we calculated the kappa metric to measuretheagreementbetweentwo coders.the result percentage is .
representing substantial agreement .
commentclassification in this section we introduce how we train a classiier according to the taxonomy proposed in section to automatically categorize comments.wecollect5000commentsfrom4projectsasmentioned in section .
since our classiier works at the sentence level the 1363icse may 23 29 seoul republicof korea zhai et al.
table featuresforcommentsclassiication feature type description tokennum numeric number of tokens in acleaned comment classnum numeric number of classesmentioned in acleaned comment tree string adepthirsttraversalof stanford parse tree npnum numeric number of noun phrasesin parse tree vpnum numeric number of verbphrasesin parse tree ppnum numeric number of prepositional phrasesin parse tree casenum numeric number of case marking relations preconjnum numeric number of preconjunction relations root sinv vp vbz getsnp np dt thenn valuepp in fornp dt thenn entry a stanford parse tree root sinv vp np vbz np pp dtnn innp dtnn b thebfssequence of stanford parse tree figur e parsetree and bfs collected comments are split into sentences.
each comment is manually annotated with the subject being commented and with the perspective see table1 .
.
wordembeddingandcommentcleaning the irst step towards comment classiication is to train a word embedding basedonthecollectedcomments.textwords are represented as ixed length vectors in word embedding and thus words close to each other in the vector space share more similarities.existingwordembeddingsaretrainedfromnewsarticles and hardlyrepresent thedomain speciicfeatures insoftware.
for example the word newmay be a verb e.g.
new an object in software comments but not in general english.
hence we propose to train a word embedding based on our collected comments using word2vec .thetrainedwordembeddingwillbeusedtotrain comment classiiers introducedin section .
.
beforetrainingtheembedding wecleanthecollectedcomments toremoveunnecessaryinformationandnormalizetextstoacquirea more accurateand higher qualityword embedding.mainly weperformthefollowingfourtasks substitutingclass method variable names with three corresponding placeholders to make theembedding more general removing stop words common words appearing frequently which include will the a an it its and alsoin our case reducing derived words to their word stem namelyrootform byapplyingtheporterstemmingalgorithm .
for example the word inserts is transformed into insert and lowercasingallthe words.
.
featureextraction to train models to classify comments we extract eight features shownintable2.theirstcolumnliststhefeatures andthesecond column gives the type of each feature namely numeric and string.
thelastcolumndescribeseachfeature.notethatallthefeaturesare automatically extracted meaning that no human efortis required to use our trained classiiers to categorize comments.
featuretokennum isthenumberoftokenscontainedinacleaned comment and classnum is the number of classes mentioned in acomment.
a comment which mentions more classes tends to have ahigherprobabilitytobeanexplanationofimplementationdetails indicating itself to be a how it is done comment.
the remaining six features are extracted from parse trees and stanford dependencies generated by stanford parser .
the stanford parser parses a sentenceanddeterminespart of speech pos tags associated withdiferentwordsandphrases.parsetreesrepresentgrammatical structure of sentences and stanford dependencies represent grammaticalrelationsbetweenwordsinasentence.forexample fig.
a showsthestanfordparsetreeofthecomment getsthe valuefortheentry where np vp pp etc.
arepostags.feature treeis a string representation of a parse tree which is composed of nodes that are traversed using breadth irst search bfs .
for example fig.
b is the bfs of the tree in fig.
a .
the features npnum vpnumandppnumcount the number of nounphrase np nodes verb phrase vp nodes and prepositional phrase pp nodes respectively.stanfordparseralsoprovidesdependencytypesforeach pair of adjacent words .
we extract the relations casenum and preconjnum whicharethenumberoftype caseandtypepreconjcontainedinasentence.the caserelationisusedforanycase marking element which is treated as a separate syntactic word including prepositions postpositions andcliticcasemarkers .preconjunctionis the relation between the head of an np and a word that appearsatthebeginningbracketingaconjunctionandputsemphasis on it such as either both neither .
the six features are utilized since based on our experiments we observe that these six features have positive importance on the classiication while the other elements contained in parse trees and dependencies have little positive importanceoreven have negative importance.
.
algorithmsandevaluation totrainclassiierstocategorizecommentsintodiferentcodeentities and diferent perspectives we leverage the following three algorithms decisiontree randomforest andconvolutional neural network cnn .
the three algorithms are frequently used to train classiication models and they are proven to have highaccuracyinclassiication .thedecisiontreealgorithm andtherandomforestutilizetheextractedfeaturestotrainmodels while thecnn algorithmdoes not use anyfeature.
as mentioned earlier acommentmayfallintodiferentcategoriesandthuswe trainmulti labelclassiicationmodels forbothperspectivesand code entities.
the multi label classiication problem is transformed into a set of binary classiications and each binary classiication checkswhether acomment can be classiiedintoone category.
to evaluate the classiiers we apply the standard fold cross validation namelywerandomlyselect20 commentscollected insection4asthetestingsetandtheremainingcommentsasthe training set.
the performance of perspective code entity classiicationissummarizedintable3.thecolumns dtc rfcandcnn respectively show the performance of decision tree random forest and cnn.
the four metrics we use are precision recall f1 score andhamming loss which are calculated using sklearn metrics .
speciically precisionmeasures the ability of the classiier correctly labelsacomment anditiscalculatedas tp tp fp wheretp is thetotal numberof correctly classiied comments and fpis the totalnumberofcommentsthatareclassiiedintowrongcategories.
the metric recallmeasures the ability of the models to correctly 1364classifying andpropagatingnatural languagecomments viaprogram analysis icse may 23 29 seoul republic of korea table comment classiication result perspective codeentity dtc rfc cnn dtc rfc cnn precision .
.
.
.
.
.
re call .
.
.
.
.
.
f1 score .
.
s .
.
.
s .
hamming loss0.
.
.
.
.
.
classifyallthecommentsthatbelongtoonecategoryanditiscalculated astp tp fn wherefnis the number of comments that are notclassiied asone categorywhile infacttheybelong to that category.
the f1 scoreis a weighted average of precision and recall andthehammingloss isthefractionoflabelsthatareincorrectly predicted.
for the irst three metrics the higher the better while for the hamming loss the lower the better.
fromthistable wecanseethatthethreealgorithmsachievehigh precision recall and f1 score and low hamming loss in classifying comments into correct perspectives which indicates the efectivenessofourclassiiers.forthecodeentityclassiication thedecision treeandtherandomforestalgorithmshavehighprecision recall andf1score andlowhamming loss.in contrast cnnhasrelative lowerprecision recallandf1scoreandrelativehigherhamming loss compared with the other two algorithms.
the classiication ofcodeentityismoresensitivetoinputfeatures.cnnsperforms their own feature abstraction which may miss important features.
propagation in this section we will introduce the rules that are used to propagate comments based on their corresponding code entities and perspectives.
these propagation rules achieve the goal of leveragingprogramanalysistechniquestoupdateexistingcomments infernewcommentsandassociatecommentswithcode.wehave diferentrulesfordiferentcodeentitiesandperspectives.eachrule isheadedbyitsname followedbyafractionwiththenominator the conditions andthe denominator the derived comment.
.
property commentpropagation theproperty commentpropagationrulesaresummarizedinfig.
a whichinvolverulesforpropagatingcommentsofdiferentlevelsof granularity namely class method statement and variable level.
class levelpropagation.
ruleproperty instan deinesthepropagation between a class and its instantiation.
that is if a comment cis associated with a class oand a variable vinstantiates class o thentheproperty commentispropagatedfromclass otovariable v. the expression c means the occurrence of oincis replaced withv.forexample the property comment permitsallelement including null of the class arraylist is propagated to the instance alldeclaredatline1infig.
.rule property inher speciiesthat if acomment cisassociatedwithsuperclass q and thereis aninheritancerelationbetweensubclass pandsuperclass q then property comment cispropagatedfromsuperclass qtosubclass p withtheclassname q superclass occurringin csubstitutedwith the class name of p subclass .
rule property impl is analogous to ruleproperty inher where the property comment cassociated withinterface iispropagatedto its implementationclass o. method levelpropagation.
ruleproperty callee2st isapplied to propagate a property comment if a comment ccontains properties regarding a callee method mandmis invoked by a statements then the property comment cis propagated from the calleemethodmto the statement swith the formal parameters fpinc substitutedwiththeactualparameters apusedins.rulepropertymethod2st deines the scenario that a comment cassociated with a method mis propagated to a statement swhen the statement sis theonlystatementin m.forexample infig.
thestatement return newarray componenttype length at line is the only statement of the method newinstance and thuswe canpropagate the propertycomment exceptionnegativearraysizeexceptionifthespecified codelengthisnegative.
at lines3 4to the statementat line6.
statement level propagation.
ruleproperty st2callee speciies that if a statement sinvokes a callee method m and shas no additional operations other than returning the result of thecallee m then the property comment cispropagated fromthe statement sto the callee method mwith the actual parameters apsubstituted with the formal parameters fp.
consider the aforementioned statement line in fig.
which invokes the method newarray anddoesnothaveoperationsexceptreturningtheresult ofnewarray .sincethetwoconditionsaremet wecaninferanew property commentforthenativemethod newarray bypropagating exception negativearraysizeexception if the specified code length is negative.
from the statement to the callee newarray .
we can observe that comments of a caller method can be propagated from a callee method via the invocation statement based on ruleproperty method2st and rule property st2callee.
ruleproperty st2method deines propagating comments from a statement stoamethod mwhichcontains s underthecondition thatthesetofactualvariables apcontainedin sisasubsetofthe parametersof m.supposethatthe property comment cdescribes a property of a variable that is not a parameter of mand thus it wouldbe inappropriate for cto be acomment of m. variable levelpropagation.
variable levelrulesincludetwocases deinition useandcontainer element.rule property defuse deines the case that if a comment cis associated with a variable v andvisusedincode u thenthe property comment cispropagated fromdeinition vtouseu.ruleproperty container speciiesthat if a comment cis associated with container landlhas element e then a element related property comment is propagated from container lto eachelement e. .
what commentpropagation therulestopropagate what commentareshowninfig.
b .similar totherulesof property comment theyarealsocategorizedbased onclasses methods statements andvariables.
class levelpropagation.
rulewhat inher issimilarto propertyinher wherea what comment cassociatedwithasuperclass qis propagated to asubclass p.rulewhat impl isalsosimilar.
method levelpropagation.
rulewhat callee2st speciiesthat if a comment cis associated with a method m and there is a methodinvocationrelationbetweenastatement sandthe callee methodm thenthe what commentispropagatedfromthecallee m tothestatement swiththeformalparameters fpincsubstituted with the actual parameters ap.
rulewhat method2st denotes the propagation from a method mto a statement sinside.
two preconditions are required to be satisied for the propagation.
the irstconditionisthatthestatement sisthelaststatementofmethod 1365icse may 23 29 seoul republicof korea zhai et al.
class level propagationrules property instanpropcomment o c instantiation v o propcomment v c property inherpropcomment q c inheritance p q propcomment p c property implpropcomment i c implementation o i propcomment o c metho d level propagationrules property callee2stpropcomment m c invocation s m propcomment s c property method2stpropcomment m c onlyst s m propcomment s c statement le vel propagationrules property st2calleepropcomment s c invocation s m nootherop s propcomment m c property st2methodpropcomment s c contain m s ap fp propcomment m c variable level propagationrules property defusepropcomment v c defuse u v propcomment u c property containerpropcomment l c contain e l propcomment e c a property propagation rulesclass levelpropagationrules w hat inherwhatcomment q c inheritance p q whatcomment p c w hat implwhatcomment i c implementation o i whatcomment o c metho d level propagationrules what callee2stwhatcomment m c invocation s m whatcomment s c what method2st whatcomment m c lastst m s prests empt setalt2 prests exsts whatcomment s c statement le vel propagationrules what st2callee whatcomment s c invocation s m nootherop s whatcomment m c what st2method whatcomment s c lastst m s prests empt setalt2 prests exsts whatcomment m c v ariable levelpropagationrules what defusewhatcomment v c defuse u v whatcomment u c b what propagation rules method level propagationrules ho w clonehowcomment m c clone m m howcomment m c ho w difftypehowcomment m c clone m m difftype m m howcomment m c c how it is done propagation rulesnote ccomment uco de that uses a variable v oclass apactual parameters psubclass fpformal parameters qsuperclass lcontainer variable iinterface eelementcontained in thecontainer l m m method t t type sstatement prests statements before thecurrent statement vvariable exsts exception handling statements figure comment propagation rules m. the second one canbe either there are no statements before s namely prests or all the previous statements are for exception handling prests exsts .
if the two conditions are met thewhat comment ccan be propagated from themethod mto the statement s.considertheexampleshowninfig.
.the statement atline6isthelaststatementofthemethod newinstance lines5 meaning the irst condition is satisied.
also the method body does nothavestatementsbeforeline6 meaningthesecondcondition holds.
hence the what comment creates a new array with the specifiedcomponenttypeandlength.
canbepropagatedfromthe methodnewinstance to the statementat line6.
statement level propagation.
rulewhat st2callee describes propagation from a method invocation statement to the callee.
speciically astatement sinvokesamethod mandhasnoadditional operationsotherthanreturningtheresultof m.ifacomment cis associated with s thenccan be propagated to mwith the actual parameters apsubstituted.forexample thestatementatline6of methodnewinstance infig.2invokesmethod newarray andit doesnotinvolveotheroperations andthuswecanpropagatethe what comment createsanewarraywiththespecifiedcomponent typeandlength.
propagatedtothestatementbasedonrule whatmethod2st to newarray at line .
rule what st2method is symmetric to rule what method2st anddiscussioniselided.
variable levelpropagation.
variable levelpropagationisdeined by rulewhat defuse.
that is if variable vis associated with a comment candthere isadeinition userelation between vandu thencispropagatedfrom deinition vto useu.
.
how it is done comment propagation the propagation rules for how it is done comment are given in fig.
c and they only involve method level propagation.
comments canbepropagatedin otherlevels butin practice most howit is done commentsareinmethod level.theirstrule how clone speciies the scenario that if a how it is done comment cis associated with a method m and the method body of mis the same as the body of another method m thencis propagated from mto m .thesecondrule how difftype speciiesthatifmethod m is acodecloneofmethod mbutwithdiferenttypesofvariablesor formal parameters then comment cis propagated from mtom withthe type information substituted.
evaluation weimplementaprototypecpc leveragingtheeclipsejdttoolkit andthecodeclonetoolnicad andempiricallyevaluateitto address the following questions rq1 howefectiveiscpcinpropagatingcommentsofdiferent perspectives andcode entites?
rq2 howuseful is cpc inhelping developers?
rq3 howefective iscpcinimprovingcomments?
rq4 howefective iscpcindetecting code bugs?
theevaluationwasconductedonamachinewithintel r core tm i7 8700kcpu .00ghz and32gbmainmemory.theoperating systemis macos high sierra .
.
andthe jdkversionis .
1366classifying andpropagatingnatural languagecomments viaprogram analysis icse may 23 29 seoul republic of korea table comment propagation accuracy perspectiveaccuracy dist dist .
dist .
property .
.
.
what .
.
.
ho w it is done .
.
.
table comment propagation summary perspectiv eprojectsimilarity with existingcomments dist dist .
dist .
c m ec pc cmt cmt cmt propertyjdk .
.
.
collections .
.
.
guava .
.
.
joda time .
.
.
apachedb .
.
.
whatjdk .
.
.
collections .
.
.
guava .
.
.
joda time .
.
.
apachedb .
.
.
how itis donejdk .
.
.
collections .
.
.
guava .
.
.
joda time .
.
.
apachedb .
.
.
.
efectiveness in commentspropagation toanswerrq1 wepropagate property comments what comments andhow it is done comments in ive projects.
the results are summarizedintable4 whichpresentsthecommentperspective column the projects column the number of classes methods whose comments are propagated columns cand m the number ofexistingcomments propagatedcomments columns ecand pc the similarity between an existing comment and an propagated comment columns7 .notethatthecomparisonisconducted onlywhenthereisanexistingcomment.thesimilarityismeasured using the word mover s distance wmd algorithm .
a zero distance means the existing comment and the propagated commentareliterallythesame.ifthedistanceisbetween0and0.
it meanstwocommentsareliterallysimilarandifthedistanceismore than0.
itmeanstwocommentsareliterallydiferent.thelongest distance is .
for each distance range the columns cmtand presentthenumberofpropagatedcommentsandtheratiobetween cmtandthe totalnumber of propagatedcomment column pc .
fromtable4 wemakeafewobservations.firstly thenumber ofpropagated commentsis larger than that of existingcomments sinceonecommentmaybepropagatedtodiferentplaces.secondly the number of propagated property comments is much larger than that ofwhat comments and how it is done comments.
this is due tothefactthatdeveloperstendtocommentonexception related behaviors and one method may contain several diferent exception behaviors and these exception related comments belong to propertycomments.thirdly thenumberofpropagated how it isdone commentsisrelativelysmallerduetotwofactors.theirstone isthatthenumberofcodeclonesissmallandthesecondoneisthat fewer comments are about implementation details how it is done .
fourthly thepercentageofpropagated property commentsthatare literally the same with existing comments distance is higher than the other two perspectives on average vs .
this is mainly because property comments have limited contents with relatively ixed sentence patterns while the other comments describe variousaspectsandtendtobedepictedusingdiferentsentences toexpressthesamesemantic.fifthly morethan88 propagatedcomments are literally similar with existing comments distance lessthan0.
whichindicatesourpropagationtechniqueisfeasible andeicientinmanipulatingcommentsasirst classobjects.lastly the percentage of comments with distance larger than .
in the projectjoda time is much higher than the others.
by checking the comments we found that there are ten code snippets which sharethesamecodeandoneofthemhasacommentthatisliterally diferent from the comments of the remaining ones and there are some other similar cases.
such cases contribute a lot to the high percentage given the small number of propagatedcomments.
tofurtheranswerrq1 wemanuallymeasuretheaccuracyof propagated comments for diferent distance ranges summarized in table .
the irst column gives the perspective of comments and the remaining columns show the accuracies of diferent distance ranges.
due to the large number of propagated comments we cannotmanuallycheckallofthem.instead foreachdistancerange we randomlysampled500commentsofeachperspectiveandmanually checkedwhetherthepropagatedcommentsarecorrectornot.if a propagated comment is inconsistent with the source code it is considered as false positive.
table shows that we achieve accuracy when the distance is0andanaverageof75 accuracywhenthedistanceislargerthan .
this demonstrates that our propagation technique is efective in inferringcomments.notethateventhoughthedistanceislarger than or even larger than .
it does not mean the propagated comments are incorrect since the same semantics can be expressed using diferent sentences.
for example the comment returns the node ornullifnotfound ispropagatedtomethod remove ofclass concurrentskiplistmap and thismethod hasan existingcomment returnsthepreviousvalueassociatedwiththespecifiedkey or null if there was no mapping for the key.
.
the two comments are literally quitediferent but they have the same semantics.
.
usefulness in helping developers to answer rq2 we conducted a user study involving users graduatestudentsand8developersfromindustry toparticipate.
we randomly selected code entities that have both existing commentsandpropagatedcomments withatotalof160comments .
the generated comments are propagated from other places and must be syntactically diferent from the existing ones.
they are mainlyfromcommonscollections jdk andguava andhaveeven coverageforthethreecommenttypes.todiversifyourselection these code entities are selected from diferent source iles.
to avoid bias we mix the propagated comments and the existing comments and thus the users are unaware of whether a comment is propagatedorexisting.foreachcomment weprovidethecorresponding code andaskuserstoevaluatethecommentsfromthefollowing threeperspectives meaningfulness isacommentofhighquality in helping developers understand code consistency is a comment consistent with code and naturalness does a comment efectively convey information as anaturallanguagesentence .
the users are asked to evaluate each comment based on the widely adopted ive point likert scale and the scores separately represent strongly disagree disagree neither agree nor disagree agree and strongly agree.
note that the numerical results of these questions are not important as theyare dependent on the 1367icse may 23 29 seoul republicof korea zhai et al.
table comment propagation improvement projectpersp ective property what how it is done n i w n i w n i w jdk 242n.a.
collections n.a.
guava n.a.
jo da time n.a.
apachedb n.a.
table code bug detection project version bugs buggy method conirmed collections .
29comp ositecollection.iterator yes compositemap.removecomposited inal map k v yes.
.
.
guava .
6throwables.getrootcause throwable no.
.
.
apachedb .
2utilities.printclasspath yes consolefileoutput.getdirectory no .
.
.
.
.
.
.00consistency mea ningfulness naturalnesspropagated existing figure user study comparison result quality of the original comments recall our propagated comments alsooriginatefromexistingcomments .instead thecomparative resultsofthetwokindsofcommentsareimportant.fig.6shows thecomparisonresultsbetweenpropagatedcomments blue and existingcomments red .88vs3.86forconsistency .85vs3.
formeaningfulness and3.98vs4.00fornaturalness.overall the resultsindicatepropagatedcommentsalignwellwithexistingones intermsofquality.furtherinspectionshowsthattheslightlyworse results regarding naturalness are due to our sampling bias the propagatedcommentsare16.
shorterthantheexistingcomments and the users seem to consider longer comments are more natural.
.
efectiveness in improvingcomments toanswerrq3 weevaluatetheefectivenessofourcommentpropagationinthreeaspects inferringnewcommentsforcodeentities thatdonothaveexistingcomments identifyingincompletecomments which may be misleading for users or developers and detectingwrongcommentsthatmightleadtobugs.theresultis shownintable6 andthecolumns n iand wpresentthenumberofnewcomments incompletecommentsandwrongcomments respectively.
here a new comment means the code entity where thecommentispropagatedtodoesnothaveanycommentbefore.
note that we do not give the number of incomplete how it is donecommentssinceitisunnecessaryandimpracticaltocommentall the implementationdetails.
basedonthenumberofnewcommentsshownintable6andthe accuracyintable5 wecanseethatourtechniquecanefectively generate new comments which can be further used to facilitate understandingandmaintaindocumentation.bymanuallychecking some of the newly generated comments we ind that manycomments describe exceptional behaviors including the type of exception and the corresponding exception trigger condition.
such commentsareusuallyconsideredveryimportantsinceamajority ofbugsarecausedbytriggeringexceptions.forexample wecan generatethenewcomment throwsillegalargumentexceptionif thesizeislessthan1 forconstructor circularfifoqueue collection which conveys that the parameter collection should have a size larger than .
without such a comment bugs are easily introduced sinceveryfewmethodshavesuchrequirementsanddevelopersare insensitivetothem.moreover amongthenewcomments precise functional commentsareinferred for nativemethods thathave neithercommentsnorsourcecode.thesecommentscanserveas manuals for developers to leveragethesenative methods.
we also identify incomplete comments which can be seen as inconsistencies between comments and code.
our propagated comments can be used to complement existing comments to address such inconsistencies and reduce the risk of introducing bugs when the code is used.
for example returns true if this list changed as a result of the call.
is the existing comment of method addall in classrolelist and returns true if the rolelist specified is null.
is onepropagatedcommentofthemethod.byanalyzingthecode we canseethepropagatedcommentiscorrect meaningtheexisting oneisincomplete.inaddition wedetectmanywrongcomments that would be misleading and even lead to bugs.
for example in the project apache commons collection we generate the propagatedcomment throwsindexoutofboundsexceptionifindex orindex size whichisinconsistentwiththeexistingcomment throws indexoutofboundsexception if index or index size ofmethod setiterator inclasscollatingiterator.weconirmedour propagatedcommentiscorrect and developersalsoconirmedthis and corrected the existing wrongcomment .
.
efectiveness in bug detection to answer rq4 we write a script to extract code whose propagated comments describe behaviors related to nullpointerexception andindexoutofboundsexception basedonbuggypatterns.for nullpointerexception the buggy pattern is the code that does not check whetherthereturnvalueofamethod whosecommentsstateanull value may be returned is null before dereferencing it.
for indexoutofboundsexception the buggy pattern is the code that does not check if the returned value of a method whose comments state maybe returned is before using itto access an array.
table reports the bug detection results including from left to right the project the project version the number of detected bugs thebuggymethodandwhetherthereportedbugisconirmed.
duetothespacelimitations notallthebugsarepresentedinthe table.
in total our script reports bugs.
by manually checking them webelieve37ofthemaretruebugs.wehavereportedthe bugs to the developers among which bugs have already beenconirmedandixedbydevelopers whiletheremaining ones await conirmation.
for the false positives the main reason is thatouranalysisscriptisnotcontext sensitiveandhencecannot identifycasesinwhichuserswillneverpassparametersthattrigger the function to return null or .
it is a limitation of our scanner not comment derivation.
1368classifying andpropagatingnatural languagecomments viaprogram analysis icse may 23 29 seoul republic of korea threats to validity the threattoconstruct validityisthebias that maybe introduced during the manuallabelingofcomments section .tomitigate this threat each comment was categorized by two developers independently and a third developer would manually resolve all cases when two developers disagreed.
we assessed the labeling reliabilitybymeasuringtheinter coderagreement section .inthe future we will further minimize the threat by inviting more developers to categorize comments.
the threat to internal validity is the potentialoverittingproblemofthemachinelearningalgorithms.
tominimizethis werandomlyselected80 ofthedatasetasthe training data and applied a ive fold cross validation.
the threat to external validity is that it is plausible the classiiers produced onourtraining datawouldhavelowaccuracywhencategorizing commentsfromotherprojects.toalleviatethisthreat weprepared labeled comments from four diferent software projects that cover diferent types of functionalities e.g.
java collection framework and calendar system .
while we believe that the comments from these software systems well represent comments in other software projects we do not intend to draw any general conclusions.
in the future we will train the classiiers with more labeled comments of other kinds of systems to improve the generalizability.
the user study was conducted with users and code entities.
while we taskedeachuserwithalotofcodeandcomment wewillextend the study to alarger usergroup.
related work comment classiication.
researchersin proposedataxonomy based on meanings of comments and manually classiied comments.
they found52.
of these commentscanbe leveraged toimprovesoftwarereliabilityandincreaseprogrammerproductivity.
in researchers empirically studied api directives which are constraints about usages of apis and built a corresponding taxonomy.theauthorsof leveragedgroundedmethodsandanalyticalapproachestobuildataxonomyofknowledgetypesinapi referencedocumentationandmanuallyclassiied5574randomlysampleddocumentationunitstoassesstheknowledgetheycontain.
based on this taxonomy the researchers in trained a classiier for each knowledge type and assigned only one label to each document unit based on nine features and their semantic and statistical combinations.
in comparison each classiier in our work classiies comments into diferent perspectives and code entities.
the work built a taxonomy of comments to investigate developers commenting habits while the work studied comment categorizationtoprovidebetterquantitativeinsightsaboutcomment qualityassessment.researchersin producedataxonomy ofcommentsandinvestigatedhowofteneachcategoryoccursby manuallyclassifyingmorethan2 000codecomments.unlikethem wedevelopthetaxonomytotreatacommentasanattributeofa code entity and thus we can leverage program analysis techniques toinfer propagate updateandreasonaboutcomments.itisunclear how to propagatecomments basedonexisting taxonomies.
commentgeneration.
thereareefortsofgeneratingcomments from source code code changes based on manually crafted templates information retrieval and machine translation .
the techniques are most closely related and they generated comments for a code snippet byusing commentsof its code clone.
however they didnot distinguishbetweencomments ofdiferent perspectives and thus may generate many wrong comments.
also they did not utilize techniques like data low analysis to propagate comments whichisournovelty.ourtechniquedifersfromcommentgenerationinafewaspects.commentgenerationproduces comments from code.
however diferent projects have diferent codingandcommentstyles.agenerationtechniquetrainedonaset of projects or based on rules may not generate good comments on otherprojects.insteadofgeneratingcommentsfromcode wepropagateexistingcommentstocodeentitiesthatarenotcommented byleveragingprogramanalysis.ourtechniqueislesssensitiveto such styles as it only classiies comments instead of generating them.
comment propagation is deterministic and rigorous through programanalysis.secondly generatingcommentsforcomplexcode thatevenhumanscanhardlyunderstandiserror prone.forsuch cases ourtechniquecanleverageexistingcomments fromother places .thirdly evaluatingqualityofgeneratedcomments such astheirnaturalness isahardchallenge.ourtechniqueislargely immune to this.
finally our technique can propagate comments to methods without code while existing work requires code as input.
ontheotherhand commentgenerationandcommentpropagation are complementary.
through propagation we can produce a much larger training set for generation techniques.
generated comments can be propagated throughour technique.
comment code inconsistency detection.
research has been conductedon improving apidocumentation maintenancesuchas reportingpotentialcode commentinconsistenciesascodeevolves detecting existing code comment inconsistencies 77 79 and enriching documentation e.g.
with code samples .theydonotaimtoexplicitlypropagatecomments as irst class objectsandthus our efortsare complementary.
conclusion we build a comprehensive comment taxonomy from diferent perspectives with various levels of granularity and propose using programanalysistopropagatecomments.wedevelopaprototypecpc.
ourexperimentsshowthatcpccangenerate41573newcomments with accuracy.
the derived comments are used to detect newcodebugsin5real worldprojectswith30conirmedandixed bydevelopers.wealsoidentify304defectsinexistingcomments including incomplete comments and wrong comments.
our user study conirms propagated comments align well with existing comments regarding quality.