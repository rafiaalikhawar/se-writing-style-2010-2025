alloymax bringing maximum satisfactionto relational specifications changjian zhang carnegie mellonuniversity pittsburgh usa changjiz andrew.cmu.eduryan wagner carnegie mellonuniversity pittsburgh usa rrwagner cs.cmu.edupedroorvalho inesc id ist universidadedelisboa lisboa portugal pedro.orvalho tecnico.ulisboa.pt davidgarlan carnegie mellonuniversity pittsburgh usa garlan cs.cmu.eduvascomanquinho inesc id ist universidadedelisboa lisboa portugal vasco.manquinho tecnico.ulisboa.ptruben martins carnegie mellonuniversity pittsburgh usa rubenm andrew.cmu.edu eunsukkang carnegie mellonuniversity pittsburgh usa eskang cmu.edu abstract alloyisadeclarativemodelinglanguagebasedonafirst orderrelational logic.
its constraint based analysis has enabled a wide range of applications in software engineering including configuration synthesis bug finding test casegeneration and securityanalysis.
certain types of analysis tasks in these domains involve finding an optimalsolution.
for example in a network configuration problem instead of finding any valid configuration it may be desirable to findonethatismost permissive i.e.
itpermitsamaximumnumber of packets .
due to its dependence on sat however alloy cannot be usedto specifyandanalyze these types of problems.
we propose alloymax an extension of alloy with a capability to expressandanalyzeproblemswith optimalsolutions.
alloymax introduces asmalladditionoflanguageconstructsthatcanbe used to specify a wide range of problems that involve optimality and anewanalysisenginethatleveragesa maximumsatisfiability maxsat solvertogenerateoptimalsolutions.toenablethis new type ofanalysis we show how a specification ina first order relationallogiccanbetranslatedintoaninputformatofmaxsat solvers namely a boolean formula in weighted conjunctive normal form wcnf .wedemonstratetheapplicabilityandscalabilityof alloymaxonabenchmarkofproblems.toourknowledge alloymax is the first approach to enable analysis with optimality in a relational modeling language and we believe that alloymaxhas the potential to bringawide range ofnewapplicationsto alloy.
esec fse august 23 28 athens greece copyright held by the owner author s .
acm isbn .
concepts softwar e and its engineering specification languages software system models formalmethods.
keywords alloy sat maxsat relationalspecifications modelsynthesis acmreference format changjian zhang ryan wagner pedro orvalho david garlan vasco manquinho rubenmartins andeunsukkang.
.alloymax bringingmaximum satisfaction to relational specifications.
in proceedings of the 29th acm joint european software engineering conference and symposium on thefoundations ofsoftwareengineering esec fse august 23 28 athens greece.
acm newyork ny usa 13pages.
.
introduction alloy is a declarative modeling language based on a first order relational logic with transitive closure.
thanks to its expressive power along with the analysis capability provided by its back end engine thealloyanalyzer ithasbeenappliedtoawiderangeof problemsinsoftwareengineering includingprotocolverification configurationanalysis test casegeneration bug finding andsecurity analysis .
the types of analysis that can be performed with a high level modelinglanguagelikealloydependonthecapabilityofitsunderlying engine.
the alloy analyzer is at its core a finite model finder givenasetoffirst orderlogic fol constraintsthatcorrespondto a system specification mand user query s e.g.
s find a valid network configuration the analyzer translates formula m sto anequisatisfiablebooleanformula fsuchthatasatisfyinginstance tofis also a solution to m s. this analysis is then performed byanoff the shelfbooleansatisfiability sat solver.ingeneral there may be multiple satisfying instances f the alloy analyzer also provides a way to enumerate these solutions by repeatedly invokingthesolverwithadditionalconstraintsthatareintended to blockthe previously seen instances.
155this work is licensed under a creative commons attribution international .
license.
esec fse august athens greece changjianzhang ryan wagner pedro orvalho david garlan vasco manquinho rubenmartins andeunsuk kang the reliance on the sat based analysis means however that the alloy analyzer cannot be used to automatically perform the following types ofanalysis generationofoptimalsolutions itissometimesdesirableto findnotonlyanysolutionbutonethatis minimalormaximal dependingontheproblembeingmodeled.forinstance inthe contextofsecurityexploitgeneration itmaybedesirable to synthesize the smallestpossible exploit that can demonstrate a security violation.
in a network firewall configuration problem aconfigurationsettingthat maximizes thenumberof allowed packets while satisfying a security policy is typically considered more desirable than a less permissive solution.
however sincethe alloyanalyzer returnsinstances in anarbitrary order finding such an optimal solution can only be done by enumerating the typicallyvery large spaceofallinstances.
analysis with soft constraints certain problems are naturallyexpressedusingacombinationofboth hardandsoftconstraints where a desirable solution should satisfy as many of the soft ones as possible.
for example a meeting scheduling problemmayconsistofhardconstraints e.g.
allparticipants mustbe present aswellassoftones e.g.
participants time preferences if it is not possible to satisfy all of the latter a solutionthatfulfillsasmanyoftheseoptionalpreferencesisstill more desirablethanothers.
since all of the constraintsin alloy aretreatedashardconstraintsthatmustalwaysbesatisfied it iscurrently not possible to analyze such types ofproblems.
analysis with priorities when a problem has multiple incomparable optimal solutions it may be helpful to rank these solutionsusingsomenotionof priorityamongconstraints.for instance intheaforementionedschedulingproblem aparticipantmayhaveahigherpreferencetowardsmeetingtimesinthe morningrather than intheafternoon.
again since alloy treats all of the constraints equally it is not possible to solve problems where such anotionofpriority plays an importantrole.
in this paper we propose alloymax an extension of alloy that overcomes these limitations by enabling an analysis of alloy specificationswithoptimalsolutiongeneration.inparticular wepropose both a languageextension toallowthe usertospecifysoftconstraints and indicate parts of an alloy specification that must be optimized and a new analysis back end that leverages a maximum satisfiability maxsat solver to perform the analysis.
to enable this analysis we also provide a new translation mechanism from a high level alloymaxspecification in fol to an equivalent maxsatproblem.
the proposed extension significantly extends the range of analyses that can be performed over alloy specifications.
it is also a strict generalization of alloy it introduces no semantic changes toexistingalloyspecificationsandincludesonlyasmallnumber of syntactic extensions and thus should be easily adoptable by existing alloy users.
we demonstrate the added analysis capability of alloymaxon a varietyofcasestudies includingexploitgenerationonmicroprocessors similartothewell knownspectre andmeltdown attacks gracefuldegradationinsecurity aweddingseating assignment andataskschedulingproblem .weshowthat not onlycanour extensionbe used toperform analysesthatweretable the course timetable ofthe schedulingproblem.
montue wedthu fri amcs101ml compiler cs101ml compiler pmseos seos cs101 notpossibleinalloybefore buttheperformanceofouranalysis engine iscompetitive to the existing alloy analyzer.
the contributionsofthis paper are as follows an extension to alloy called alloymax and an accompanying analysisenginethatcanbeusedtogenerateoptimalsolutions and solve problems with soft prioritized constraints section a translationmechanism from a first orderrelational logicto a weightedboolean formula section anoptimizationtechniquethatuseshigh levelinformationin an input alloy specification to guide a maxsat solver more efficiently towardsoptimal solutions section and acollectionofcasestudiesdemonstratingthenewtypesofanalyses inalloymax and a set of benchmark results demonstrating its performance onproblems of varyingsizes section .
examples asamotivatingexample consideramodelofa coursescheduling probleminalloy figure .auniversityoffersasetofcoursesthat studentscanregisterforeachsemester inthismodel weassume the school is offering five courses named cs101 compiler os ml andse lines6 .eachlecturecantakeplaceduringthemorning am orafternoon pm betweenmondaytofriday lines1 .aset ofall availablelectureslots lines andtheirrelations tothe dayandtimearedefinedonlines17 andthetimetableforthe courses isdefinedonline20.eachstudentisassociated with a set of corecourses that are required for their major.
for simplicity weconsidertheschedulingproblemforoneparticular student alice whoisassignedcs101as acore course.
eachstudent sregistrationschedulemustsatisfythefollowing requirements eachstudentmusttake at leastthree courses line35 each student must take all of the corecourses that they are assigned and line36 a student cannot take courses whose lecture times conflict with eachother line37 .
giventhismodel wecanusea runcommand line47 inalloy to generate a valid course schedule for alice that satisfies all of the requirements.
figure 2ashows the first generated instance indicating that alice could take compiler cs101 os and se to satisfy the requirements.
.
solving optimization problems suppose that we wish to extend this model to encode students interests in subjects i.e.
every student is interested in a set of courses .thegoalistobeabletogenerateaschedulethat maximizes thenumberofcoursesthatmatchastudent sinterest inaddition to satisfyingthethreebasicrequirements.thefollowingcodesnippet shows the new definition for student and alice where alice is interestedinse andml.
156alloymax bringing maximum satisfaction to relational specifications esec fse august athens greece 1abstract sig day the set of days for mon to fri. 2one sig mon tue wed thu fri extends day 3abstract sig time the set of times am and pm .
4one sig am pm extends time 6abstract sig course the set of courses.
each course has several lectures in a week.
8lectures setlecture 10one sig cs101 compiler os ml se extends course in total days x am pm lecture slots.
13abstract sig lecture day oneday time onetime 14one sig monam monpm tueam ...extends lecture 15fact the full day time definition is omitted.
17day monam mon monpm mon ... 18time monam am monpm pm ... the full timetable definition is omitted.
20lectures se monpm se wedpm ... 23abstract sig student the set of students.
each student is assigned a set of core courses.
25core setcourse each student may register for a set of courses.
27courses setcourse 29one sig aliceextends student 30core cs101 alice has to take cs101.
the predicate for the three requirements.
33predvalidschedule 34allstu student stu.courses stu.core instu.courses all disj c1 c2 stu.courses notconflict 40predconflict 41somel1 l2 lecture l1inc1.lectures andl2inc2.lectures l1.day l2.day andl1.time l2.time generate a valid schedule.
47run validschedule figure analloy modelforthecourse schedulingsystem.
a b c d figure instancesofthecourse schedulingproblem.1abstract sig student 2core setcourse courses setcourse courses that this student is interested in.
4interests setcourse 6one sig aliceextends student 7core cs101 8interests ml se interested in ml and se.
even though this maximization problem can be expressed in alloy as follows it contains a higher order quantification line over possible relations from studenttocourse which cannot be solved bythe alloy analyzer1 1run 2validschedule 3nocourses student course validschedule somestu student stu.interests stu.courses stu.interests stu.courses thisoptimizationproblemcanbesolvedbyourextension alloymax.
the following code snippet shows a run command that uses our newmaxsome multiplicity construct 1runmaxinterests1 2validschedule 3allstu student maxsome stu.interests stu.courses the meaning of the constraint on line is that for any student there exist someelements in the intersection of set stu.interests and setstu.courses that should be maximized i.e.
find an instance that maximizesthe number of elements inthis intersection.
an alternative way of specifying the optimization problem is by using our new maxsome quantifier 1runmaxinterests2 2validschedule 3allstu student maxsome comm setcourse comminstu.interests andcomminstu.courses figure2bshowstheinstancegeneratedbyamaxsatsolver which suggeststhatalicecouldtakecs101 ml os andse whereml andse are the courses that alice isinterestedin.
.
solving problemswith soft constraints wewishtoextendthemodelfurthertoallowstudentstoindicate preferencesoverlecturetimesfortheircourses.forexample supposethatalicedoesnotwanttotakecoursesonthursdaymornings and friday afternoons.
the following code snippet shows a run commandwithaconstraintthatencodesalice spreferences.when thecommandisexecuted thealloyanalyzerfailstofindanyvalid schedule i.e.
theresulting formulais unsatisfiable becausealice has to take cs101 whichhas lectures onfriday afternoons.
1runwithprefer 2validschedule 3allstu student maxsome stu.interests stu.courses no lecture on thu am.
1another extension of alloy called alloy can be used to solve higher order quantification but does not support other types of analysis shown in sections .2and .
.
weprovideamoredetailed comparison of alloymaxand alloy in section .
157esec fse august athens greece changjianzhang ryan wagner pedro orvalho david garlan vasco manquinho rubenmartins andeunsuk kang 5thuam !
inalice.courses.lectures no lecture on fri pm.
7fripm !
inalice.courses.lectures one way to find a satisfying instance is to relax some of the constraints forinstance alice could beasked to giveuponsome ofherpreferencestosatisfytherequirements.however alloydoes notprovideawaytospecifysuchdesirablebut optionalconstraints.
inalloymax weintroduceanotionof softconstraints i.e.
asetof constraints that are not required but should be satisfied as much as possible.
the following code shows a new type of construct called softfact whichcontains alistofsoft constraints 1soft fact 2thuam !
inalice.courses.lectures 3fripm !
inalice.courses.lectures 5runwithsoftprefer 6validschedule 7allstu student maxsome stu.interests stu.courses given the above run command alloymaxwill attempt to find an instance that maximizes the number of satisfied soft constraints in additiontotheotherhardconstraintsthatencodethethreebasic requirements.
figure 2cshows an instance where alice could take cs101 os andse i.e.
alicegivesupherfridayafternoonsinorder to registerfor cs101 but herthursday mornings are freedup.
.
solving with priorities however alice is not entirely satisfied with the above schedule.
although her thursdays are free she has to give up the ml course which she is interested in.
given a choice between two conflicting goals keeping thursday mornings free and studying ml she wouldratherchoosethelatter i.e.
mlhasahigher priorityforher.
currently in alloy there is no way to express and analyze with such anotionof priorities among constraints.
inalloymax priorities canbeexplicitlyassignedtomaximalor softconstraints toindicate theuser spreferencesonwhichofthe possibly conflicting constraints must be satisfied first.
for example inthefollowingsnippet maxsome indicatesthatmaximizingthe numberof interestedcourseshasahigherprioritythansatisfying the time preferences i.e.
softfactisassigneddefaultpriority of0 .
1soft fact 2thuam !
inalice.courses.lectures 3fripm !
inalice.courses.lectures 5runwithsoftpreferandprior 6validschedule 7allstu student maxsome stu.interests stu.courses figure2dshows the instance generated by the solver i.e.
alice could take cs101 ml os and se which maximizes her course interestsover hertime preferences.
in summary our extension expands the rangeof analysesavailableinalloy including generatinganinstancethatmaximizes or minimizesa given relation which can be used for optimization problems defining soft constraints and finding an instance thatsatisfiesasmanyoftheseoptionalbutdesiredconstraints and specifying priorities among differentsoft ormaximal constraints.
backgroundon maxsat apropositionalformulain conjunctivenormalform cnf isdefined asaconjunctionofclauses whereeachclauseisadisjunctionof literals such that a literal is either a propositional variable vior its negation vi.
a clause is satisfied if at least one of its literals issatisfied.finally acnfformulaissatisfiedifallitsclausesare satisfied.givenacnfformula thesatisfiability sat problem corresponds to deciding if there is an assignment such that is satisfiedorprovingthat nosuch assignment exists.
themaximumsatisfiability maxsat isanoptimizationversion ofthesat problem.given acnfformula thegoalisto findan assignment that maximizes the number of satisfied clauses in .
in partialmaxsat clausesin aresplitinhard handsoft s.givena formula h s thegoalistofindanassignmentthatsatisfies all hard clauses in hwhile minimizing the number of unsatisfiedsoftclausesin s.thisproblemcanbefurthergeneralizedto weightedmaxsat whereeachsoftclausehasapositiveweight and thegoalbecomestominimizethesumoftheweightsofunsatisfied soft clauses.
maxsat algorithms have seen a remarkable improvement in the last decade and can be used to solve problems in domains such as planning data analysis security andbioinformatics .inthispaper weleverageexistingmaxsat technology andextend alloy to handle optimization problems.
syntax and semantics thissectiondescribesthesyntaxandsemanticsof alloymax.italso presentstheformaltranslationrulesfroman alloymaxspecification to amaxsat problem.
.
abstractsyntax figure3shows the abstract syntax of alloymax.
analloymaxproblemisatuple p a d f fs whereaisthe setof atoms in the universe disasetofrelationdeclarations fisanalloyformula that defines the hardconstraints that must be satisfied fsis asoft alloyformulathatdefinesthe softconstraintsthatmayormaynot be satisfied.
a hard alloy formula may contain keywords such as maxsome for generatingoptimal solutions.
optimization operators.
alloymaxextends the existing somemultiplicityoperatorwith maxsome andminsome formaximizationand minimization respectively.informally someristruewhenrelation risnotempty butwith maxsome minsome thesolverreturnsa modelwithanon empty rthathasamaximal minimal number oftuples.
alloymaxalsoextendsthe nomultiplicityoperatorwith softno.
informally noris true when ris empty.
for softno the solver tries to find a model with an empty r but if no such satisfying instance exists the solver instead returns a model where rhas the minimal number of tuples.
the difference between minsome andsoftnois thatminsome requires the relation rto have at leastone tuple.
in addition the existential quantifier i.e.
some is also extended withmaxsome andminsome.
in alloy somee r fis true when there exists a tuple in relation rthat makes formula ftrue.
in alloymax whenmaxsome minsome isusedinplaceof some the 158alloymax bringing maximum satisfaction to relational specifications esec fse august athens greece problem univdecl reldecl formula softformula expr rel var unary binary comprehension softformula softformula soft formula compositesoft unary unopexpr compositesoft softformula andsoftformula unop binary expr binopexpr univdecl atom binop .
reldecl rel arity comprehension vardecl formula vardecl var expr constant tuple formula elementary composite quantified tuple atom elementary expr inexpr mult expr mult some maxsome maxsome minsome minsome no softno softno one arity ... composite notformula formula logopformula atom identifier logop and or rel identifier quantified quantifiervardecl formula var identifierquantifier all some maxsome maxsome minsome minsome figure abstract syntaxof alloymax.bolded textare existing keywordsinalloy textinblue are new keywords in alloymax.
solverfindsamodelwhere rcontainsatleastonetupleandtriesto maximize minimize the number oftuples in rthat makeftrue.
soft constraints.
alloymaxintroduces the softfact keyword to specifyasoftconstraint i.e.
softfactfwherefisanalloyformula but becomes soft.
when multiple soft factare present in a given specification the overall soft constraint fsis the conjunction of thosesoft alloy formulas.
priority.a priorityp n0may be specified along with every oneofthenewoperatorsin alloymax.whenitisleftunspecified a defaultlowestpriority0isassignedtotheassociatedalloyformula.
.
translation overview.
figure4formally defines the translation rules for alloymaxas an extension to the existing translation process in alloy .
due to limited space we focus on the parts of the translation processthat are mostrelevantfor alloymax.
a relation in alloy is translated into a matrix of boolean variables each ofwhichis true if and onlyif the tuplerepresented by thisparticularvariableisintherelation andarelationalexpression e.g.
dotjoin isrepresentedbyoperationsoveroneormore matrices.
in alloy a folproblemwith bounds istranslated intoa booleanformula whichiseventuallyconvertedintoconjunctive normal form cnf .
in alloymax the idea is to instead convert it intoweighted conjunctive normal form wcnf where hard boolean formulas are assigned the special weight of to ensure that they are satisfied in every instance and soft formulas are assigned different weights depending on the user specified priorities to guide the solver towards an instance that maximizes the totalsum ofweights.
translationsteps.
first analloymaxproblemistranslatedinto a boolean formula with priorities denoted by boolp.
a prioritized boolean formula fkis the boolean formula fwith an optional priority k which is used in a later part of the translation to assign weights to the corresponding wcnf clauses.
when kis omitted it represents ahardformula that mustbe satisfied.in figure functionmsis used to translate soft constraints i.e.
constraintsthataredefinedaspartof softfactinalloymax.given a soft constraint soft factfwith priority k iffisa conjunction of alloy formulas mstranslates each conjuncts into a soft constraint alsowithpriority k line17 otherwise mstranslatesthecontained alloy formula fby callingmand assigns kas its priority line .
functionmis used to translate alloy formulas.
keywords in vanillaalloyfollowtheexistingtranslationrules.foreachofthe new keywords in alloymax e.g.
maxsome minsome the translation rule is similar to the existing rule except additional prioritized boolean formulas are introduced to instruct the solver to search for a maximal or minimal solution.
for instance on line maxsome pistranslatedby statingthat pmustnotbeempty as it is done for somein vanilla alloy line and including aprioritizedbooleanformulaforthepresenceofeachtuplein p given the corresponding wcnf a maxsat solver attempts to find asolution that maximizesthe number of tuples in p. each prioritized boolean formula is transformed into a cnf formulawithapriorityforeachclausebyusingthetseitintransformation .finally acnfformulawithpriorityistranslated into a wcnf formula to be solved by a maxsat solver.
to guarantee that a soft clause with a higher priorityis always satisfied first before the clauses with lower priorities its weight is assigned to begreaterthanthesumofweightsofalltheclauseswithsmaller priorities.formally let cirepresentalltheclauseswithpriority i. then theirweight wiisassignedas wi i summationdisplay.
j 0wj cj .
where cj is the number of clauses of cjandw0 .
this kind ofoptimizationiscalled lexicographicoptimization andusingthis weightdistributionisaknownwayofconvertingittomaxsat .
example.
we use an example to illustrate one of the translation rules inparticular rulefor maxsome online21infigure .consider two relations p a bandq b c wherea a1 a2 b b1 andc c1 .supposethatwewishtofindamodelthat 159esec fse august athens greece changjianzhang ryan wagner pedro orvalho david garlan vasco manquinho rubenmartins andeunsuk kang p problem boolp m e logicalandtext.
x e x e r reldecl univdecl matrix m e logicalortext.
x e m formula env boolp m p e m e logicalandtext.
x e k ms softformula env boolp m p e m e logicalandtext.
x e k x expr env matrix m e exactlyone x e env quantvar relvar matrix m e logicalandtext.
x e m p e logicalandtext.
x e k x i1 ... ik vectors m e m e matrix int setofindicesofmatrix m m e m e m e m matrix dim dimensionofmatrix m m e m e m e m dim int boolp matrix constructor m e let m x e in logicalandtext.
x m m e v m m x m sd f m m sd x ... s d m f x m e let m x e in logicalortext.
x m m e v m m x m dim int matrix constructor m v p f e m e logicalandtext.
x e k m sd x m sd y.if y xthentrueelsefalse m v p f e m e logicalandtext.
x e k x e x e x e p lete uniontext.1n i ri r a in m e ms e x e x e x e r a m a k x .freshvar x e x e x e x e x e x e ms e ms e ms e x e x e x e ms fandg e ms f e ms g e x e x e t ms f e m e k wherefisnot aconjunction x e iterativesquare x e x e let m x e in m m x .m m e v m m x figure4 translationrules.boolpisabooleanformulawithprioritywhere p n0.whenpisomitted theformularepresents ahard formulathat mustbe satisfied.inother words ithasan infinite priority i.e.
f f .
satisfiesthe following formula maxsomep.q relationpis represented by a set of boolean variables p00 p10 where forexample p00istrueifandonlyif a1 b1 isatupleinp similarly qis represented by q00 .
then the formula is translated intoaprioritizedboolean formula as follows p00 q00 p10 q00 p00 q00 p10 q00 where the first top level conjunct says that p.qmust contain at least one tuple equivalent to some p.q the next two conjuncts areformulaswiththelowestpriorityof0statingthat p.qshould contain as manyofthe twopossible tuples as possible.
to translate the above formula into cnf the tseitin transformationintroduces freshvariables that represent sub formulas a p00 q00 b p10 q00 where a b can also be seen as the variables representing the tuples in relation p.q.
then after the transformation the following prioritizedcnfisproduced a b a0 b0 a p00 a q00 a p00 q00 b p10 b q00 b p10 q00 finally we translate this formula into wcnf to be solved by a maxsatsolver.specifically prioritiesarereplacedwithweightsbyequation .
.sincea0andb0havepriority0 thustheyareassigned weight1inthe final wcnfformula.
.
correctnessoftranslation amodelor aninstanceof an alloy formula is an assignment of tuples torelationsthat makes the formulatrue.analloyproblem mayhavemultiplemodels.wecallthesetofallmodelsthe solution spaceof a problem.
when two problems have the same solution space we say that they are semantically equivalent .
theorem .
.
analloymaxproblemp a d f fs is semantically equivalent to the problem p a d f true wherefs the soft constraints is replaced by true andf is the formula that results from replacing maxsome andminsome infbysome and softnobytrue.
proof.toprovethistheorem wefirststatethefollowinglemma lemma4.
.
aprioritizedbooleanformula fkwithapriorityofa finiteinteger i.e.
asoftformulathatcanbesatisfiedornot issemantically equivalent to truein the corresponding non prioritized boolean formula.
accordingtothislemma byreplacingthesoftformulasinthe translation ruleswith true we have soft f figure4 line18 issemantically equivalentto true 160alloymax bringing maximum satisfaction to relational specifications esec fse august athens greece maxsome p line and minsome p line are semantically equivalentto somep line20 softno r line25 issemantically equivalentto true maxsome v p f line31 and minsome v p f line32 are semantically equivalentto somev p f line30 .
then given an alloymaxproblemp letp be the problem that results from replacing all the soft facts with true maxsome and minsome withsome andsoftnoformulaswith true.based onthe above list of statements about semantic equivalence it follows that amodelisasolutionto pifandonlyifitisalsoasolutionto p .
theorem .
.
given a maxsat solver that maximizes the total weight of agiven wcnf formula alloymaxgenerates the optimal solution to the corresponding fol problem.
proof.this theorem can be proved by showing the correctness of each optimization operator.
we show the correctness for maxsome only otheroperators can be provedsimilarly.
givenmaxsome p wherepisarelation let p0 p1 ... pn be the boolean literals that represent the presence of tuples in p. then the formula willbe translatedinto p0 p1 ... pn p0 k p1 k ... pn k bymaximizingthetotalweightsofthisformula thenumberofsatisfiedclausesofform pi fori n isalsomaximized.thus alloymax returns amodelwhere the size ofthe relation pismaximized.
optimization byencodingproblemsinmaxsat alloymaxcanpotentiallytake advantageofadvancesinmaxsattechnologytomoreefficiently solve the underlying optimization problem.
however when encoding theproblem toa low levelwcnf thehigh level structure of the problem may be lost and become unavailable for maxsat algorithms to take advantage of.
prior approaches try to recover thisinformationbyclusteringsoftclausesintopartitionsandusing them during solving .
however these approaches are heuristic based and sometimes fail to capture meaningful relationships between soft clauses.
in this paper we propose to extract the partitioninformationdirectlyfromthe alloymaxsyntaxandgive this information to existing partition basedmaxsat algorithms.
.
partition basedmaxsatsolving webrieflypresentanoverviewofunsatisfiability basedmaxsatalgorithmsthatusepartitionstrategies .unsatisfiability based algorithmsworkbyfindingasequenceofunsatisfiablesubformulas that correspond to increasing a lower bound on the number of falsified soft clauses until the formula becomes satisfiable and an optimal solution is found.
these algorithms can be extended with partition strategies by taking as input the maxsat formula andpartitioningthisformulaintoformulas 1 ... nwithdisjoint set of soft clauses.
different approaches have been proposed to partition a maxsat formula but they are mostly based on having a graph representation of the formula and then using graph partitioning algorithms to create the partitions .
the maxsat solver then takes as input these partitions and startsbysolving 1.iftheformulaisunsatisfiable thenthelowerbound onthe number of falsifiedsoft clauses isincreased and the formula is refined to allow one additional soft clause to be falsified.
this loopisrepeated until the formulabecomessatisfiable.
in this case the algorithm found a solution to the formula that may or maynotbeoptimal.ifnomorepartitionsareleft thenthissolution is guaranteed to be optimal.
otherwise the next partition is added to the solver and this process is repeateduntil an optimal solution is found.
partitioning has the benefit of potentially finding smaller unsatisfiable subformulas at each iteration of the algorithm which often leads to a sequence of unsatisfiable formulas that is easier to solve than without partitions.
for further details on maxsat algorithms we refer the interestedreader to the literature .
.
extracting partitions from alloymax ourapproach whichwecall spec basedpartitioning changesthis existingprocessbyusingpartitionsthatcanbeextracteddirectly fromalloymaxasthetranslationtomaxsatisperformed rather than trying to guess good partitions at the wcnf level.
in particular partitionscan be generatedas follows.
when adding a hard clause to the wcnf it is assigned group .
allthe hardclauses inthe wcnfbelong to the same group.
when translating an alloy formula with optimization operators i.e.
maxsome minsome andsoftno alloymaxcreatesanewgroup g. then all the soft clauses associated with this optimization operator are assignedgroup g. when translating a soft constraint i.e.
soft factf alloymax creates a new group g for it.
thus each soft constraint is in its owngroup.
a common pattern that we leverage for creating partitions in alloymaxis to use the allkeyword.
for example consider set p andq andarelation r p q.forformula allp p maxsomep.r theall operator will be expanded to generate a maxsomep.r formulaforeach p p.eachmaxsome formulawillbeinaseparate group and we can easily partition the soft clauses by the tuples in setp.
for example recall the course scheduling problem in section .
.the soft fact formula 1soft fact 2thuam !
inalice.courses.lectures 3fripm !
inalice.courses.lectures is first translated into two soft facts figure line and a group iscreatedfor eachofthesesoft facts.
in addition the formula 1allstu student maxsome stu.interests stu.courses generatesagroupforeachstudent.then thesolverwillfirsttryto optimize each group individually and merge the results to find the globaloptimal solution.
insection .
wecomparethegraph basedpartitioningstrategy usedinmaxsatalgorithmswith alloymaxpartitioningandshow the benefitofextracting partitionsfrom ahigh level model.
evaluation we evaluate alloymaxbasedonthe following research questions rq1 how useful is alloymaxfor modeling different types of problems?for usefulness we focuson applicability andscalability .
rq2 is spec based partitioning more efficient than no partitioning and graph based auto partitioning?
161esec fse august athens greece changjianzhang ryan wagner pedro orvalho david garlan vasco manquinho rubenmartins andeunsuk kang rq3 isalloymaxmoreefficientthan alloy forgeneratingoptimal solutions?
alloy is an extension that enables an analysis with higher orderquantifiers soitcould inprinciple be usedtosolve problemsthatgenerateanoptimalsolutionastheoneinsection .
.
this question aims at comparing which approach is more efficient inthis particulartype ofproblem.
toanswertheseresearchquestions weapply alloymaxtofive case studies from different domains.
section .2gives brief introductions to eachcasestudy andpresents the optimization goals.
.
implementation we implemented alloymaxbased on alloy .
.
which in turn relies on kodkod a general purpose relational model finder .
we extended alloy to support the new syntax and also modified kodkodtosupportthenewtranslationprocess.weuseopen wbo asourbackendmaxsatwiththesamealgorithmforbothpartitioningandnon partitioning.forspec basedpartitioning weextended thewcnfformattoallowspecifyinggroupindexatthebeginning ofeachclause.wemodifiedopen wbotoreadthisnewfileformat andchangedthepartitionstrategytousetheonespecifiedinthe file.
all the experiments were run on a linux machine with a core .6ghz cpu and gb memory.
every problem was run times each with a minutes timeout from which the average was computed and reported in table .
the benchmark and tool are available for reproduction2.
.
casestudies .
.
coursescheduling.
recallthecourseschedulingmodeldescribed in section .
in this benchmark we randomly generate problemswith ccoursesand sstudents acourseshouldhaveeithertwoorthreelectures among a week each student should take at mostrcore courses andisinterestedinat most icourses.
theoptimizationgoalistomaximizethenumberofinterested courses that a student is registered for.
the problem names in table2follow the pattern course c s r i .
the size of the alloymaxspecifications ranges from 252to 552loc.
.
.
checkmate.
checkmate isanautomated toolbasedon alloy for synthesizingproof of concept exploit code forhardware securityattackssimilartomeltdown andspectre .itusesa micro architecturallyhappens before graph denotedas hb to model and analyze the execution process of micro operations.
in a cpu an instruction goes through a sequence of stages to be executed e.g.
fetch exec.
and commit .
then a hb graph representstheexecutionprocessofaseriesofprograminstructions.
an attack pattern e.g.
meltdown or spectre is represented as a sub graphpatternin hb.checkmatemodelsthemicro architecture ofacpu theeventsofinstructions andtheattackpatterninalloy and uses the alloy analyzer to generate a hb graph that contains theattackpattern.
moreover checkmateaimstosynthesize security litmus tests i.e.
most compactprograms that can demonstrate a security attack.
however since this optimization goal cannot be solvedbyalloy theauthorsofcheckmatedevelopedanadditional pythonprogramtoenumerateallthepossibleinstancesandfind the litmus tests.
the relation that represents the hb graph.
in particular thisgoalismodeledbyusing softno allisusedforleveragingpartitioning asshownbelow andthereturnedinstancecontainsthe smallest hbgraph whichrepresents asecurity litmus test.
1run ... checkmate constraints 3alln node softno n.uhb the original checkmate model is around loc in alloy to specify the optimization goal it only involved adding the above softnoformula to the specification.
.
.
graceful degradation.
in networksecurity asimple way of mitigating an on going attack is to shut down the entire system.
inpractice however thisisunacceptablebecausethesystemwill loseallofitsfunctions.
gracefuldegradation isanapproach fordynamicallyre configuringpartsofasystemunderanattack to maximize the remaining uncompromised functions.
typically thisisachievedby shuttingdownonlythosecomponentsthat have been compromised and replacing these components with backups ifavailable tomaintaintheaffectedfunctions.thisreconfiguration process also involves removing network connections to thecompromisedcomponentsandaddingnewonestothebackups.
alloycanbeusedtomodelandanalyzetheproblemofgenerating avalidnetworkreconfigurationthatmaintainsallsystemfunctions.
however dependingontheextentofanattack itmaybeimpossible torestoresomeofthosefunctions.todeterminewhichofthemcan berestored thealloyusercouldmanuallycommentoutaselection of constraints that correspond to the functions but the process to findanoptimalsolution i.e.
onethatrestoresasmanyfunctions as possible wouldbe tedious.
withalloymax we usesoft factto model the functions as soft constraints line .giventhese thesolverwilltrytomaximize the functions and give up on ones that are unsatisfiable.
moreover in practice every change to the architecture could have a cost and the total cost the number of architectural modifications should also be minimized.
thus we use maxsome to maximize the overlapping connections between the degraded architecture and the initial one line and use softnoto minimize the new connections addedtothedegradedarchitecture line .furthermore system function is considered more important than cost.
thus soft constraintsrepresentingthefunctionsareassignedahigherpriority.
the following snippetshowsour optimization goals.
1sigcomponent 2init setcomponent degraded setcomponent 4soft fact 5noncriticalfunction andcriticalfunction 7run 8validarchitecture 9maxsome degraded init 10softno degraded init in our benchmark each problem has ccomponents including backupones theattacker scapability intermsofthedegreethat thesystemmightbecompromised issetto k and eachproblemhas ainitiallycompromisedcomponents.theproblemnamesfollow 162alloymax bringing maximum satisfaction to relational specifications esec fse august athens greece thepattern degrade c k a .thesizeofthespecifications ranges from 240to 326loc.
.
.
wedding table seating.
consider a wedding table seating problem where eachtableseatsaminimumandamaximum numberofguests eachpersonshouldbeassignedtoonlyone table eachpersonisassociatedwithasetoftagsindicatingtheir interests.thehardconstraintistogenerateaseatingassignmentfor each person and the optimizationgoal is to minimize the number ofdifferenttags between allpeople sitting at the same table.
alloycanbeusedtomodelthisproblemandgenerateanarbitraryassignment.thefollowingsnippetshowsrelevantconstraints.
1sigtag 2sigperson tags settag 3sigtable seat setperson seat max num person maximum number of guests.
seat min num person minimum number of guests.
one seat for one person.
8fact allp person oneseat.p 9run however withthismodel wecannotfindtheoptimalsolutionthat minimizesthenumberofdifferenttagsatatable.with alloymax this optimization goal can be modeled by using softno.
in particular to take advantage of the partitioning optimization the goal isspecifiedas foreachtable itshouldhavenoorminimizedtags.
the following expresses this optimization goal.
1runtablebased allt table softno t.seat.tags for the benchmark we randomly generated problems with g tags ttables and ppeople where each table has minimum l and maximum hpeople and each person has maximum mtags.
the problem names follow the pattern seat g p m t l h .
the size of the specifications ranges from to loc.
.
.
singlemachinescheduling sms .
inmanyreal timesystems it is often impossible to schedule tasks to make them meet all their timerequirements.inpractice onemustschedulethetasksinsuch a way to can maximize the number of on time tasks .
consider a real timesystem with a setof ntasks 1 ... n to be executed onauni processormachine i.e.
onlyonetaskcanbeexecutedata time.eachtaskisatriple ri pi di whereriisthereleasetime i.e.
the earliest start time pithe processingtime and dithe deadline.
taskscanbesplitintofragmentssothatonetaskcanbeinterruptedinordertoexecutefragmentsofothertasks.however the executionorderofthefragmentsofonetaskshouldnotbechanged.
formally atask ihaskifragmentsandeachfragment fj iwhere j ... ki has process time pj i and we have summationtext.1ki j 1pj i pi.
finally ataskmaydependonothertasks.thus ifatask idepends ontask j imustbe executedonly after jhas been completed.
alloycanbeusedtomodelthisproblemandfindanarbitrary subset of tasks that can complete within their deadlines.
however themaximalityisnotguaranteed.with alloymax weusemaxsome tofindtheoptimalschedulewhichmaximizesthenumberofontime tasks.the following snippetshowsthe optimization goal.
1sigtask sigcompleted intask 2run 3completeontime 4maxsome completed inourbenchmark werandomlygenerateproblemswith ntasks.
thereleasetimeofeachtaskiswithinatimeframe r eachtaskhasa maximumprocessingtime p andamaximumnumberoffragments f. a slack factor sis used to compute the deadline for each task wheredi ri random s pi.
finally a task depends on a maximumnumberof dtasks.theproblemnamesfollowthepattern sms n r p f s d .
the size of the specifications ranges from 192to 259loc.
.
results .
.
rq1 howusefulis alloymaxformodelingdifferenttypesof problems?
we successfully modeled the aforementioned problems withalloymax or migrate from existing ones .
it only requires appendingtheoptimizationformulastotheoriginalruncommands inplain alloy withoutany reconstruction.
table2 firstcolumnshowstheproblemsusedinourbenchmark.
theproblemnamereflectsthescaleofeachproblem.specifically the size of the alloymaxspecifications for these problems ranges from loc to loc.
the number of variables in the generatedwcnfrangesfrom2 236to24 andthenumberof clauses ranges from to .
although translating from a high level language like alloymaxmay not produce the most succinct maxsat formulas it can solve all these problems within a minutestimeout.
.
.
rq2 is spec based partitioning more efficient than no partitioning and graph based auto partitioning?
the results in table 2show that spec based partitioning outperforms both no and auto partitioning in course checkmate and seating problems.
on sms spec based partitioning shows little improvement over nopartitioningbecausetheseproblemsdonothaveanatural problemspecific way of partitioning as a result the solver falls back to no partitioning.ontheotherhand spec basedpartitioninghasa negativeimpactonthefirstthreedegradationproblems.moreover we have the following observations andinsights when partitioning is applicable spec based partitioning outperformsauto partitioning because theformerdoesnotsuffer from the overhead introduced by the heuristic for guessing partitions which can be significant for large problems and the heuristicmayfailandfallbacktono partitioning e.g.
incheckmateanddegradation and auto partitioningmightfailto guess effective partitions e.g.
seating problems where specbasedimproves the performance but autodoes not .
whenpartitioningisnotapplicable i.e.
onlyonepartitionexists spec based partitioning falls back to no partitioning.
on theotherhand forcingauto partitioninginthissituationmay have negative impact onperformance e.g.
sms .
we hypothesize that partitioning works well if the optimal solution of a sub problem hard clauses plus some partitions is part oftheglobaloptimalsolution.thecourseproblemshavethis property since there are no registration limits on the number of students for each course and the registration for each student is completely independent of one another.
we observed in the degradation problems that if a partition addedtotheiterativeprocessdoesnothelprefinethesolution towardstheoptimalone theoverheadoftheiterationmayexceed the time of solving the problem at once.
in other words 163esec fse august athens greece changjianzhang ryan wagner pedro orvalho david garlan vasco manquinho rubenmartins andeunsuk kang table results for comparing maxsat non partitioning vs. maxsat partitioning vs. alloy .
the numbers in the table are the solving time of the maxsat solver or the solver for alloy i.e.
excluding the translation time .
there is no significant difference in translation time among these methods.
indicates auto partition fails because the problem is too large and it falls backto no partition.
indicates onlyonepartition existsintheproblemanditfalls backto no partition.
problem no part.
solve s auto part.
solve s spec part.solve s alloy solve s coursecourse 30 40 3 6 .
.
.
.
course 40 50 3 6 .
.
.
.
course 50 60 3 6 .
.
.
.
course 60 70 3 6 .
.
.
.
course 70 80 3 6 .
.
.
t o course 80 90 3 6 .
.
.
t o course 90 100 3 6 .
.
.
t o checkmateflush reload .
.
.
n a meltdown .
.
.
n a spectre .
.
.
n a seatingseat 7 28 7 6 3 7 .
.
.
.
seat 7 30 7 6 3 7 .
.
.
.
seat 8 30 8 7 3 7 .
.
.
.
seat 8 32 8 7 3 7 .
.
.
t o smssms 34 20 6 3 3 2 .
.
.
.
sms 38 20 6 3 3 2 .
.
.
.
sms 42 20 6 3 3 2 .
.
.
.
sms 46 20 6 3 3 2 .
.
.
t o sms 50 20 6 3 3 2 .
.
.
t o sms 52 20 6 3 3 2 .
.
.
t o degradationdegrade 10 2 1 .
.
.
n a degrade 26 2 1 .
.
.
n a degrade 20 3 1 .
.
t o n a degrade 26 2 2 .
.
.
n a partitioning works well when every sub problem contributes towardsthe optimal solution.
.
.
rq3 is alloymaxmore efficient than alloy for generating optimalsolutions?
asshownintable bothwithorwithoutpartitioning alloymaxoutperformsalloy onoptimizationproblems that can be specified using higher order quantifiers.
alloy is a general purposehigher ordersolver canbeusedtosolveproblems thatalloymaxis not applicable to and so its analysis method basedoncounterexample guidedinductivesynthesis cegis isnotspecificallytargetedforsolvingoptimizationproblems.on the other hand since maxsat is designed for solving optimization it is expected that alloymaxoutperforms alloy on such problems.
we did not apply alloy to checkmate because it would require significantly reconstructing the specification to express a higher orderformulathatquantifiesoverallrelevantrelationsto be searched e.g.
relations representing various properties of an attackgraphtobeminimized .duetothecomplexityofthisproblem there are such relations and so this would result in a formula withaquantifierdepthof40 notanalloyexpressionthatauser can reasonably be expected to write.
in contrast alloymaxintroducesonlyonelineofanoptimizationformulawithoutchangingtheexistingspecification thisalsoshowsthebenefitofthebuilt in constructsinalloymaxfor specifying optimization tasks.
alloy is not applicable to degradation problems which contain soft constraintsthat cannotbe specifiedinorsolvedbyalloy .
.
.
validation of implementation.
we manually checked the correctnessoftheresultsfrom alloymaxfortheproblemswherethe optimalsolutionsareknown includingcheckmate gracefuldegradation andsomesubsetofthecoursescheduling seating andsms problems.
also for those problems in table 2that can be solved byalloy we checked that alloymaxandalloy produce the same optimal solutions.
.
.
threatstovalidity.
ourselectedcasestudiesmightnotbe representativeenoughtodemonstratetheapplicabilityof alloymax.
we believe that our benchmark contains a diverse set of examples from realistic domains including exploit generation network reconfiguration and task scheduling and of varying sizes from relatively simple models like wedding seating to complex ones like checkmate .however weplantocontinuallyexpandourbenchmarktoexploreotherpotentialapplicationsof alloymaxandfurther refine ormodify the languageas neededfor newuse cases.
in addition the size of the problems in our benchmark might not be large enough to show how well alloymaxscales to other 164alloymax bringing maximum satisfaction to relational specifications esec fse august athens greece alloy problems in practice.
given that checkmate is one of the most complex alloy specifications available based on our past experiencewithalloy andalsohasbeenusedtogeneratepracticalattacksonrealsystems webelievethatourexperiments show that alloymaxscales well to realistic problems.
in addition since its scalability depends on the efficiency of the underlying maxsat solver alloymaxwill likely benefit from further advances inmaxsattechnology whichisan active area ofresearch .
related work extensions to alloy.
alloy is an alloy extension that enables analysis of alloy specifications with higher order quantifiers.
although alloy isdesignedforadifferentpurposethan alloymax mainly enablingsynthesisproblemsinalloy itcouldbeusedto encode certain types of optimization problems by using higherorderquantifiers asshowninsection .
.however asshownin section6.
alloymaxoutperforms alloy on these problems in partbecausetheformerleveragesmaxsatsolvers whicharedesignedforfindingoptimalsolutions.inaddition alloymaxprovides additionalanalysesinvolving soft constraintsandpriorities.
aluminum is an extension of alloy that supports generation ofminimal instances .
aluminum and alloymaxare designed for different purposes and differ on the notion of minimality.
in particular theformerworksbyautomaticallyremovingasmany tuplesaspossiblesuchthattheresultinginstanceremainsavalid instance of the given alloy specification and allows the user to influence theorder in which alloygenerates its next instances by augmentingthe currentinstancewithan additionaltuple.
cunhaet.al proposeanapproachcalled target orientedmodel finding wherethegoalistoallowtheusertoprovideapartialspecificationofa targetinstance anduseasolvertogenerateaninstance thatisas closetothetargetaspossible.theirworkalsoleverages anextensionofkodkodwithamaxsatsolverastheunderlying engine although its overallgoalisdifferentfrom alloymax.
other types of solvers.
there is a large body of work on constrained optimization problems cops a generalization of constraintsatisfactionproblems csps withanadditionalnotionofan objective function to be optimized .
the state of the art tools in this domain e.g.
gurobi cplex employ solving techniques that are different from maxsat such as branch and cut algorithms .sincethealloyanalyzeralreadyreliesonsat we found maxsat to be a natural choice for bringing optimization to alloy.
using a cop solver as an alternative backend to alloymax is an interesting open problem although it would involve a significantly differenttranslation thanthesat basedoneinkodkod whichalloymaxbuilds on .
minizinc isaconstraintmodelinglanguagethatiscapableof solving various types of csps including optimization.
built on top ofsolverssuchgurobiorcplex minizincisintendedtobeahighlevellanguageforspecifyingcspsandprovidesconvenientbuilt in such as functions data types and global constraints.
minizinc providescertainfeatures e.g.
floatingnumbers thataremissing fromalloymax while the relational core of alloy is better suited for specifying complex structures that ariseinsoftware.
answer set programming asp is a line of work on extending logic programming with capabilities for expressing andsolvingsearchproblems includingthoseinvolvingoptimization .
although both are declarative in nature asp and alloymaxsupport distinct styles of modeling the logic programming paradigm underlying asp is typically used for data and knowledge representation whilealloywasdesignedformodelingsoftwaredesigns.
therearerecentworksonextendingsatisfiabilitymodulotheories smt solvers with optimization capabilities such as optimathsat symba andz3 .thesesolverscouldserveas analternativebackendfor alloymax.onebenefit ofthisapproach is that they operate over unbounded domains and for formulas involving decidable theories e.g.
integers can provide a stronger analysisguaranteethanasat basedbackend.ontheotherhand dedicatedmaxsatalgorithmshaveshowntobemoreefficientthan thesmt basedmethods .amoresystematicinvestigationof thesealternative backends for alloymaxremainsfuture work.
conclusion and limitations wehavepresented alloymax anextensionofthealloymodeling languagethatleveragesmaxsattosolveoptimizationproblems.
wehavedemonstratedthatdespiteintroducingonlyasmallnumber ofnewlanguageconstructs alloymaxcanbeusedtospecifyand solveadiversesetofproblemsthatwerepreviouslynotpossible in alloy.
by enabling these new types of analyses we believe that alloymaxhasthepotentialtobringawiderangeofnewapplications to alloy and its analysis capability will continue to grow as it benefitsfrom rapid progress inthe maxsat technology.
the translation rules shown in section 4support a richer semanticsthanthecurrentsyntaxof alloymaxallows.forexample the rules support defining softpredicates e.g.
softpred p and reusethem inother formulas.we planto explore thesericher semantics throughfurther syntactic extensions whilealso consideringthe possiblerisk of complicating thesyntax andinvestigate additionalclassesofproblems that alloymaxcould be appliedto.
the current version of alloymaxsupports only priorities among constraints.however maxsatsolversgenerallyuseweights which support more fine grained optimizations.
adding weights to alloy requires more subtle investigation on its semantic impact but it could support a larger set of problems such as modeling and maximizingutilityfunctions e.g.
thoseusedinself adaptivesystems planners andautomateddata mismatchrepair .