why security defects go unnoticed during code reviews?
a case control study of the chromium os project rajshakhar paul asif kamal turzo amiangshu bosu department of computer science wayne state university detroit michigan usa fr.paul asifkamal amiangshu.bosug wayne.edu abstract peer code review has been found to be effective in identifying security vulnerabilities.
however despite practicing mandatory code reviews many open source software oss projects still encounter a large number of post release security vulnerabilities as some security defects escape those.
therefore a project manager may wonder if there was any weakness or inconsistency during a code review that missed a security vulnerability.
answers to this question may help a manager pinpointing areas of concern and taking measures to improve the effectiveness of his her project s code reviews in identifying security defects.
therefore this study aims to identify the factors that differentiate code reviews that successfully identified security defects from those that missed such defects.
with this goal we conduct a case control study of chromium os project.
using multi stage semi automated approaches we build a dataset of code reviews that successfully identified security defects and code reviews where security defects escaped.
the results of our empirical study suggest that the are significant differences between the categories of security defects that are identified and that are missed during code reviews.
a logistic regression model fitted on our dataset achieved an auc score of .
and has identified nine code review attributes that influence identifications of security defects.
while time to complete a review the number of mutual reviews between two developers and if the review is for a bug fix have positive impacts on vulnerability identification opposite effects are observed from the number of directories under review the number of total reviews by a developer and the total number of prior commits for the file under review.
index terms security code review vulnerability i. i ntroduction peer code review a.k.a.
code review is a software quality assurance practice of getting a code change inspected by peers before its integration to the main codebase.
in addition to improving maintainability of a project and identification of bugs code reviews have been found useful in preventing security vulnerabilities .
therefore many popular open source software oss projects such as chromium android qt ovirt and mozilla as well as commercial organizations such as google microsoft and facebook have integrated code reviews in their software development pipeline .
with mandatory code reviews many oss projects e.g.
android and chromium os requireeach and every change to be reviewed and approved by multiple peers .
although mandatory code reviews are preventing a significant number of security defects these projects still report a large number of post release security defects in the common vulnerabilities and exposure a.k.a.
cve database1.
therefore a project manager from such a project may wonder if there was any weakness or inconsistency during a code review that missed a security vulnerability.
for example she he may want to investigate i if reviewers had adequate expertise relevant to a particular change ii if reviewers spent adequate time on the reviews or iii if the code change was too difficult to understand.
answers to these questions may help a manager pinpointing areas of concern and taking measures to improve the effectiveness of his her project s code reviews in identifying security defects.
to investigate these questions this study aims to identify the factors that differentiate code reviews that successfully identified security defects from those that missed such defects.
since code reviews can identify vulnerabilities very early in the software development pipeline security defects identified during code reviews incur significantly less cost as the longer it takes to detect and fix a security vulnerability the more that vulnerability will cost .
therefore improving the effectiveness of code reviews in identifying security defects may reduce the cost of developing a secure software.
with this goal we conducted a case control study of the chromium os project.
case control studies which are common in the medical field compare two existing groups differing on an outcome .
we identified the cases and the controls based on our outcome of interest namely whether a security defect was identified or escaped during the code review of a vulnerability contributing commit vcc .
using a keyword based mining approach followed by manual validations on a dataset of chromium os code reviews we identified code reviews that successfully identified security defects.
in addition from the chromium os bug repository we identified security defects that escaped code reviews.
using a modified version of the szz algorithm ieee acm 43rd international conference on software engineering icse .
ieee followed by manual validations we identified vccs and corresponding code reviews that approved those changes.
using these two datasets we conduct an empirical study and answer the following two research questions rq1 which categories of security defects are more likely to be missed during code reviews?
motivation since a reviewer primarily relies on his her knowledge and understanding of the project some categories of security defects may be more challenging to identify during code reviews than others.
the results of this investigation can help a project manager in two ways.
first it will allow a manager to leverage other testing quality assurance methods that are more effective in identifying categories of vulnerabilities that are more likely to be missed during code reviews.
second a manager can arrange training materials to educate developers and adopt more effective code review strategies for those categories of security vulnerabilities.
findings the results suggest that some categories of vulnerabilities are indeed more difficult to identify during code reviews than others.
the identification of a vulnerability that requires an understanding of a few lines of the code context e.g.
unsafe method calculation of buffer size and resource release are more likely to be identified during code reviews.
on the other hand vulnerabilities that require either code execution e.g.
input validation or understanding of larger code contexts e.g.
resource lifetime and authentication management are more likely to remain unidentified.
rq2 which factors influence the identification of security defects during a code review?
motivation insights obtained from this investigation can help a project manager pinpoint areas of concern and take targeted measures to improve the effectiveness of his her project s code reviews in identifying security defects.
findings we developed a logistic regression model based on code review attributes.
the model which achieved an auc of .
found nine code review attributes that distinguish code reviews that missed a vulnerability from the ones that did not.
according to the model the likelihood of a security defect being identified during code review declines with the increase in the number of directories files involved in that change.
surprisingly the likelihood of missing a vulnerability during code reviews increased with a developer s reviewing experience.
vulnerabilities introduced in a bug fixing commit were more likely to be identified than those introduced in a non bug fix commit.
the primary contributions of this paper are an empirically built and validated dataset of code reviews that either identified or missed security vulnerabilities.
an empirical investigation of security defects that escaped vs. the ones that are identified during code reviews.
a logistic regression model to identify relative impor tance of various factors influencing identification of security defects during code reviews.
an illustration of conducting a case control study in the software engineering context.
we make our script and the dataset publicly available at paper organization the remainder of this paper is organized as follows.
section ii provides a brief background on code reviews and case control study.
section iii details our research methodology.
section iv describes the results of our case control study.
section v discusses the implications based on the results of this study.
section vi discusses the threats to validity of our findings.
section vii describes related works.
finally section viii provides the future direction of our work and concludes this paper.
ii.
b ackground this section provides a brief background on security vulnerabilities code reviews and case control studies.
a. security vulnerabilities a vulnerability is a weakness in a software component that can be exploited by a threat actor such as an attacker to perform unauthorized actions within a computer system.
vulnerabilities result mainly from bugs in code which arise due to violations of secure coding practices lack of web security expertise bad system design or poor implementation quality.
hundreds of types of security vulnerabilities can occur in code design or system architecture.
the security community uses common weakness enumerations cwe to provide an extensive catalog of those vulnerabilities.
b. code reviews compared with the traditional heavy weight inspection process peer code review is more light weight informal toolbased and used regularly in practice .
in addition to their positive effects on software quality in general code review can be an important practice for detecting and fixing security bugs early in a software development lifecycle .
for example an expert reviewer can identify potentially vulnerable code and help the author to fix the vulnerability or to abandon the code.
peer code review can also identify attempts to insert malicious code.
software development organizations both oss and commercial have been increasingly adopting tools to manage the peer code review process .
a toolbased code review starts when an author creates a patch set i.e.
all files added or modified in a single revision along with a description of the changes and submits that information to a code review tool.
after reviewers are assigned the code review tool then notifies selected reviewers regarding the incoming request.
during a review the tools may highlight the changes between revisions in a side by side display.
the review tool also facilitates communication between the reviewers and the author in the form of review comments which may focus on a particular code segment or the entire patchset.
by uploading a new patchset to address the review comments the author 1374can initiate a new review iteration.
this review cycle repeats until either the reviewers approve the change or the author abandons.
if the reviewers approve the changes then the author commits the patchset or asks a project committer to integrate the patchset to the project repository.
c. case control study case control studies which are widely used in the medical field is a type of observational study where subjects are selected based on an outcome of interest to identify factors that may contribute to a medical condition by comparing those with the disease or outcome cases against a very similar group of subjects who do not have that disease or outcome controls .
a case control study is always retrospective since it starts with an outcome and then traces back to investigate exposures.
however it is essential that case inclusion criteria are clearly defined to ensure that all cases included in the study are based on the same diagnostic criteria.
to measure the strength of the association between a given exposure and an outcome of interest researches who conduct case control studies usually use odds ratio or which represents the odds that an outcome will occur given an exposure compared to the odds of the outcome occurring in the absence of that exposure .
although case control studies are predominantly used in the medical domain other domains have also used this research method.
in the se domain allodi and massaci conducted case control studies to investigate vulnerability severities and their exploits .
in a retrospective study where two groups naturally emerge based on an outcome the case control study framework can provide researchers guidelines in selecting variables analyzing data and reporting results.
we believe that a case control design is appropriate for this study since we are conducting a retrospective study where two groups differ based on an outcome.
in our design each of the selected cases is a vulnerability contributing commit forming two groups cases vulnerabilities identified during code reviews and controls vulnerabilities escaped code reviews.
iii.
r esearch methodology our research methodology focused on identifying vulnerability contributing commits that went through code reviews and had its security defects either getting identified or escaping.
in the following subsections we detail our research methodology.
a. project selection for this study we select the chromium os project for the following five reasons i it is one of the most popular oss projects ii it is a large scale matured project containing more than .
million source lines of code sloc .
iii it has been conducting tool based code reviews for almost a decade iv it maintains security advisories2to provide regular updates on identified security vulnerabilities and v it has subject to prior studies on security vulnerabilities .
b. data mining the code review repositories of the chromium os project is managed by gerrit3and is publicly available at https chromium review.googlesource.com .
we wrote a java application to access gerrit s rest api to mine all the publicly available code reviews for the project and store the data in a mysql database.
overall we mined code review requests spanning march to march .
using an approach similar to bosu et al.
we filtered the bot accounts using a set of keywords e.g.
bot ci jenkins build auto and travis followed by manual validations to exclude the comments not written by humans.
to identify whether multiple accounts belong to a single person we follow a similar approach as bird et al.
where we use the levenshtein distance between two names to identify similar names.
if our manual reviews of the associated accounts suggest that those belong to the same person we merge those to a single account.
c. building a dataset of cases i.e.
vulnerabilities identified during code reviews we adopted a keyword based semi automated mining approach which is similar to the strategy used by bosu et al.
to build a dataset of vulnerabilities identified during code reviews.
our keyword based mining was based on the following three steps step i database search we queried our mysql database of chromium os code reviews to select review comments that contain at least one of the security related keywords table i .
bosu etal.
empirically developed and validated a list of keywords to mine code review comments associated with the common types of security vulnerabilities.
using bosu etal s keyword list as our starting point we added additional keywords to this list based on the nist glossary of security terms .
our database search identified code review comments that included at least one of these keywords table i .
step ii preliminary filtering two of the authors independently audited each code review comment identified during the database search to eliminate any reviews that clearly did not raise a security concern.
we excluded a review comment in this step only if both auditors independently determined that the comment does not refer to a security issue.
to illustrate the process let s examine two code review comments with the same keyword overflow .
the first comment no check for overflow here?
potentially raises a concern regarding an unchecked integer overflow and therefore was included for a detailed inspection.
while the second comment i m not sure but can specifying overflow hidden to a container hide scroll bars?
seems to be related to ui rendering and was discarded during this step.
this step discarded comments 1375table i keywords to mine code reviews that identify security defect vulnerability typecwe id keywords race condition race racy buffer overflow buffer overflow stack strcpy strcat strtok gets makepath splitpath heap strlen integer overflow190 integer overflow signedness widthness underflow improper access22 290improper unauthenticated gain access permission hijack authenticate privilege forensic hacker root cross site scripting xss cross site css xss malform denial of service dos crash248 755denial service dos ddos crash deadlock deadlock sql injection sql sqli injection format string format string printf scanf cross site request forgery352 cross site request forgery csrf xsrf forged encryption 320327encrypt decrypt password cipher trust checksum nonce salt common keywords security vulnerability vulnerable hole exploit attack bypass backdoor threat expose breach violate fatal blacklist overrun insecure scare scary conflict trojan firewall spyware adware virus ransom malware malicious risk dangling unsafe leak steal worm phishing cve cwe collusion covert mitm sniffer quarantine scam spam spoof tamper zombie approximately half of the keywords in this list are adopted from the prior study of bosu et al.
.
keywords in italic are our additions to this list.
and retained the remaining comments for a detailed inspection.
step iii detailed inspection in this step two of the authors independently inspected the review comments identified from the previous step any subsequent discussion included in each review and associated code contexts to determine whether a security defect was identified in each review.
if any vulnerability is confirmed the inspectors also classified it according to the cwe specification .
similar to bosu et al.
we considered a code change vulnerable only if a a reviewer indicated potential vulnerabilities b our manual analysis of the associated code context found the code to be potentially vulnerable and c the code author either explicitly acknowledged the presence of the vulnerability through a response e.g.
good catch oops!
or implicitly acknowledged it by making the recommended changes in a subsequent patch.
agreement between the two inspectors was computed using cohen s kappa which was measured as .
almost perfect4 .
conflicting labels were resolved during a discussion session.
at the end of this step we identified total code reviews that successfully identified security vulnerabilities.
4cohen s kappa values are interpreted as following .
as slight .
.
as fair .
.
as moderate .
.
as substantial and .
as almost perfect agreementd.
building a dataset of controls i.e.
vulnerabilities escaped during code reviews we searched the monorail based bug tracking system hosted at to identify a list of security defects for the chromium os project.
we used the bug tracker instead of the cve database since the bug tracker includes more detailed information for each security defect e.g.
link to fixing commit and link to gerrit where the fix was code reviewed .
moreover some of the security defects may not be reported in the cve if it was identified during testing prior to its public release.
we used the following five step approach to build this dataset.
we also illustrate this process using an example security defect .
step i custom search we use a custom search i.e.
type bug security status fixed os chrome to filter security defects for the chromium os projects with the status as fixed .
our search result identified total security defects.
we exported the list of defects as a comma separated values i.e.
csv file where each issue is associated with a unique id.
step ii identifying vulnerability fixing commit the monorail page for each fixed issue includes detailed information e.g.
commitid owner review url list of modified files and reviewer regarding its fix.
for example details the information for the security defect including the id of the vulnerability fixing commit i.e.
56b512399a5c2221ba4812f5170f3f8dc352cd74 .
we wrote a python script to automate the extraction of the review urls and commit ids for each security defect identified in step i. finally we excluded the security fixes that were not reviewed on chromium os s gerrit repository e.g.
third party libraries .
at the end of this step we were left with security defects and its corresponding fixes.
step iii identifying vulnerability contributing commit s we adopted the modified version of the szz algorithm to identify the vulnerability introducing commits from the vulnerability fixing commits identified in step ii.
our modified szz algorithm uses the git blame andgit bisect subcommands and is adopted based on the approaches followed in two prior studies on vccs.
for each line in a given file the git blame subcommand names the commit that last commitid that modified it.
the heuristics behind our custom szz are as following ignore changes in documentations such as release notes or change logs.
for each deleted modified blame the line that was deleted modified since if a fix needed to change a line that often means that it was part of the vulnerability.
for every continuous block of code inserted in the bug fixing commit blame the lines before and after the block since security fixes are often done by adding extra checks often right before an access or after a function call.
if multiple commits are marked based on the above steps mark commits as vccs based on higher amount of lines 1376fig.
.
a vulnerability contributing commit vcc for the security defect and the code review that missed it table ii attributes of a code review that may influence identification of a vulnerability type name definition rationale locationnumber of files under reviewnumber of files under review in a review request.
changes that involve greater number of files are more likely to be defect prone yet more time consuming to review.
number of directory under reviewnumber of directory where files have been modified in a review request.ifthe developers group multiple separate changes into a single commit the review of those comprehensive changes could be harder.
code churn number of lines added modified deleted in a code review.larger changes are more likely to have vulnerability and require more time to comprehend.
lines of code numbers of lines of code in the file before fix.
larger components are more difficult to understand.
comple xity mccabe s cyclomatic complexity .
difficulty to comprehend a file increases with its cyclomatic complexity.
isbugfix code review request that is submitted to fix a bug abug fix review request may draw additional attention from the reviewers as bugs often foreshadow vulnerabilities participantauthor s coding experiencenumber of code commits the author has submitted i.e.
both accepted and rejected prior to this commit.experienced authors code changes may be subject to less scrutiny and therefore may miss vulnerabilities during reviews.
reviewer s reviewing experiencenumber of code reviews that a developer has participated as a reviewer i.e.
code not committed by him her prior to this commit.experienced reviewers may be more likely to spot security concerns.
reviewer s coding experiencenumber of code commits that a reviewer has submitted i.e.
both accepted and rejected prior to this commit.experienced developers provide more useful feedback during code review and may have more security knowledge.
review processreview time the time from the beginning to the end of the review process.
we define the review process to be complete when the patchset is merged to the main project branch or is abandoned .acursory code review is more likely to miss security defects that require thorough reviews.
number of reviewers involved nr f number of reviewers involved in reviewing file f aslinus s law suggest the more eyeballs the less likelihood of a defect remaining unnoticed.
historicalreview ratio rra f the ratio between the number of prior reviews from developerato a filefand the total number of prior reviews to that file.
if the developer aparticipated in i of therprior reviews in file fthen rra f i radeveloper who has reviewed a particular file more may have better understanding of its design.
commit ratio cra f the ratio between the number of commits to a file fby authoraand the total number of commits to that file.
if authoramakesiof thecprior commits then cra f i cadeveloper who makes frequent changes in a file may have better understanding of its design weighted recent commits rca f ifa filefhas totalnprior commits and author a makes three of three of the prior n commits e.g.
i j k where n denotes the latest commit then rca f i j k n i j k n n adeveloper who makes recent commits may have better understanding about the current design.
total commit total number of commits made on the current file files that have too many prior commits might require extra attention from the reviewers.
mutual reviews number of reviews performed by the current reviewer and authorbetter understanding about the author s coding style might help the reviewer to investigate defects.
number of review commentstotal number of review comments in the current file higher number of review comments indicate the file has gone through a more detailed review.
file ownership foa f the ratio between the number of lines modified by a developer and total number of lines in that file.
if developerawritesiof totalnlines in filef thenfoa f inthe owner of a file may be better suited to review that file.
1377until at least lines are accounted for.
we manually inspect each of the vccs identified by our modified szz algorithm as well as corresponding vulnerability fixing commits to exclude unrelated commits or include additional relevant commits.
at the end of this step we identified total vccs.
figure shows a vcc for the security defect identified through this process.
step iv identifying code reviews that approved vccs a git repository mirror for the chromium os project is hosted at with a gitiles5based frontend.
we used the rest api of gitiles to query this repository to download commit logs for each vcc identified in the previous step.
using a regex parser we extract the urls of the code review requests that approved vccs identified in step iii.
for example figure also includes the url of the code review that missed the security defect .
at the end of this step we identified total code reviews that approved our list of vccs.
step v cwe classification of the vccs out of the vccs in our dataset had a cve reported in the nist nvd database6for example cve corresponds to the security defect .
for such vccs we obtained the cwe classification from the nvd database.
for example nvd classifies as a cwe improper input validation .
for the remaining vccs two of the authors independently inspected each vcc as well as its fixing commits to understand the coding mistake and classify it according to the cwe specification.
conflicting labels were resolved through discussions.
e. attribute collection to answer the research questions motivating this study we computed attributes for each of the code reviews i.e.
cases controls .
majority of the attributes selected in this study have been also used in prior studies investigating the relationship between software quality and code review attributes .
table ii presents the list of our attributes with a brief description and rationale behind the inclusion of each attribute to investigate our research objectives.
those attributes are grouped into four categories vulnerability location participant characteristics review process historical measures.
we use several python scripts and sql queries to calculate those attributes from our curated dataset and our mysql database of chromium os code reviews.
iv.
r esults following subsections detail the results of the two research question introduced in the section i based on our analyses of the collected dataset.
rq1 which categories of security defects are more likely to be missed during code reviews?
for both identified and escaped security defects cases we either obtained a cwe classification from the nvd database or manually assign one for those without any nvd reference.
the vccs i.e.
both identified and escaped cases in our dataset represented categories of cwes.
however for the simplicity of our analysis we decreased the number of distinct cwe categories by combining similar categories of cwes into a higher level category.
the cwe specification already provides a hierarchical categorization scheme7to represent the relationship between different categories of weaknesses.
for example both cwe integer overflow or wraparound and cwe incorrect pointer scaling belong to the higher level category cwe incorrect calculation .
using the higher level categories from the cwe specification we reduce the number of distinct cwe types in our dataset to .
during this higher level classification we also ensured no common descendants among these final categories.
table iii shows the fifteen cwe categories represented in our dataset their definitions and both the number and ratios of identified escaped cases in a descending order based on their total number of appearances.
the results of a chi square test suggest that some categories of cwes are significantly .
p value more likely to remain undetected during code reviews than the others.
chromium os reviewers were the most efficient in identifying security defects due to cwe use of potentially dangerous function .
for example following c functions are strcpy strcat strlen strcmp sprintf unsafe as they do not check for buffer length and may overwrite memory zone adjacent to the intended destination.
as the identification of a cwe is relatively simple and does not require much understanding of the associated context no occurrences of dangerous functions escaped code reviews.
reviewers were also highly efficient in identifying security defects due to cwe improper resource shut down or release that can lead to resource leakage.
cwe incorrect calculation which includes calculation of buffer size and unsecured mathematical operation i.e.
large addition multiplication or divide by zero were also more likely to be identified during code reviews .
the other categories of cwes that were more likely to be identified during code reviews include improper exception handling cwe and synchronization mistakes i.e.
cwe and cwe .
on the other hand chromium os reviewers were the least effective in identifying security defects due to insufficient verification of data authenticity cwe as all such occurrences remained undetected.
insufficient verification of data can lead to an application accepting invalid data.
although improper input validations cwe were frequent occurrences i.e.
those remained undetected during code reviews.
improper input validation can lead to many 1378critical problems such as uncontrolled memory allocation and sql injection.
approximately security defects caused by improper access control cwe also remained undetected as reviewers were less effective in identifying security issues due to improper authorization and authentication and improper user management.
the other categories of cwes that were more likely to remain unidentified during code reviews include operation on a resource after expiration or release cwe and exposure of resources to wrong spheres cwe .
our manual examinations of the characteristics of these cwe categories suggest that security defects that can be identified based on a few lines of the code context e.g.
unsafe method calculation of buffer size and resource release are more likely to be identified during code reviews.
on the other hand chromium os reviewers were more likely to miss cwes requiring either code execution e.g.
input validation or understanding of larger code contexts e.g.
resource lifetime and authentication management .
finding the likelihood of a security defect s identification during code reviews depends on its cwe category.
observation a security defects related to the synchronization of multi threaded application calculation of variable and buffer size exception handling resource release and usage of prohibited functions were more likely to be identified during code reviews.
observation b security defects related to the user input neutralization access control authorization and authentication management resource lifetime information exposure and datatype conversion were more likely to remain undetected during code reviews.
b. rq2 which factors influence the identification of security defects during a code review?
to investigate this research question we developed a logistic regression model.
logistic regression is very efficient in predicting a binary response variable based one or more explanatory variables .
in this study we use the factors described in the table ii as our explanatory variables while our response variable is a boolean that is set to true if a code review s security defect was identified by reviewer s and false otherwise.
being motivated by recent software engineering studies we adopt the model construction and analysis approach of harrell jr. which allows us to model nonlinear relationships between the dependent and explanatory variables more accurately.
the following subsections describe our model construction and evaluation steps.
correlation and redundancy analysis if the explanatory variables to construct a model are highly correlated with each other they can generate a overfitted model.
following sarle s v arclus variable clustering procedure we use the spearman s rank order correlation test to linesofcode totalcommit reviewratio fileownership commitratio weightedrecentcommit isbugfix reviewerreviewingexperience reviewercodingexperience authorcodingexperience mutualreviews complexity numofdirectoryunderreview codechurn numoffilesunderreview reviewtime numofreviewcomments numofreviewersinvolved1.
.
.2spearman fig.
.
hierarchical clustering of explanatory variables according to spearman s j jand sarle s v arclus.
the dashed line indicates the high correlation coefficient threshold j j determine highly correlated explanatory variables and construct a hierarchical representation of the variable clusters figure .
we retain only one variable from each cluster of highly correlated explanatory variables.
we use j 7j as our threshold since it has been recommended as the threshold for high correlation and has been used as the threshold in prior se studies .
we found four clusters of explanatory variables that have j j total lines of code totalloc and number of commits totalcommit commit ratio weighted recent commit and file ownership reviewer s coding experience and reviewer s reviewing experience amount of code churn directory under review and number of files under review.
from the first cluster we select total number of commit in the file.
from the second cluster we select file ownership.
from the third and fourth cluster we select reviewer s reviewing experience and number of directory under review respectively.
despite not being highly correlated some explanatory variables can still be redundant.
since redundant variables can affect the modelled relationship between explanatory and response variables we use the redun function of the rms r package with the threshold r2 to identify potential redundant factors among the remaining variables and found none.
degrees of freedom allocation a model may be overfitted if we allocate degrees of freedom more than a dataset can support i.e.
number of explanatory variables that the dataset can support .
to minimize this risk we estimate the budget for degrees of freedom allocation before fitting our model.
as suggested by harrell jr. we consider the budget for degrees of freedom to bemin t f where t represents the number of rows in the dataset where the response variable is set to true and f represents the number of rows in the dataset where the response variable is set to false.
using this formula we compute our budget for degrees of freedom since our dataset has true instances and false instances.
for maximum effectiveness we allocate this budget among 1379table iii distribution of chromium os cwe s identified escaped code reviews cwe id cwe definition identified identified escaped escaped improper synchronization .
.
concurrent execution using shared resource with improper synchronization race condition .
.
incorrect calculation .
.
improper input validation .
.
improper check or handling of exceptional conditions .
.
improper resource shutdown or release .
.
improper access control .
.
operation on a resource after expiration or release .
.
improper restriction of operations within the bounds of a memory buffer .
.
use of potentially dangerous function .
.
exposure of resource to wrong sphere .
.
incorrect type conversion or cast .
.
insuf ficient verification of data authenticity .
.
improper initialization .
.
data processing errors .
.
all the survived explanatory variables in such a way that the variables that have more explanatory powers i.e.
explanatory variables that have more potential for sharing nonlinear relationship with the response variable to be allocated with higher degrees of freedom than the explanatory variables that have less explanatory powers.
to measure this potential we compute spearman rank correlations between the dependent variable and each of the surviving explanatory variables figure .
based on the results of this analysis we split the explanatory variables into two groups we allocate three degrees of freedom to three variables i.e.
number of directory under review review ratio and reviewer s reviewing experience and we allocate one degree of freedom for the remaining nine variables.
although isbugfix has higher potential than reviewer s reviewing experience we cannot assign more than one degree of freedom for isbugfix as it is dichotomous.
as suggested by harrell jr. we limit the maximum allocated degree of freedom for an explanatory variable below five to minimize the risk of overfitting.
logistic regression model construction after eliminating highly correlated explanatory variables and allocating appropriate degrees of freedom to the surviving explanatory variables we fit a logistic regression model using our dataset.
we use the rcs function of the rms r package to fit the allocated degrees of freedom to the explanatory variables.
model analysis after model construction we analyze the fitted model to identify the relationship between the response variable and each of the explanatory variables.
we describe each step of our model analysis in the following.
assessment of explanatory ability and model stability to assess the performance of our model we use area under the receiver operating characteristic auc curve .
our model achieves an auc of .
.
to estimate how well the model fits our dataset we calculate nagelkerke s pseudo r2 .
our model achieves a r2value of which is considered to be a good fit .
power of explanatory variables estimation we use the wald statistics wald to estimate the impact of each explanatory variable on the performance our model.
we use theanova function of the rms r package to estimate the relative contribution wald and statistical significance p of each explanatory variable to the model.
the larger the wald 2value is the more explanatory power the variable wields on our model.
the results of our wald 2tests table iv suggest that number of directory under review wields the highest predictive power on the fitted model.
reviewratio isbugfix reviewerreviewingexperience and totalcommit are the next four most significant contributors.
number of review comments number of mutual reviews cyclomatic complexity of the file and review time also wield significant explanatory powers.
however experience of code author number of reviewers involved in the review process and proportion of ownership of the file do not contribute significantly on the fitted model.
we use the summary function of the rms r package to analyze our model fit summary.
table iv also shows the contributions of each explanatory variable to fit our model using the deviance reduced by values.
for a generalized linear model deviance can be used to estimate goodness badness of fit.
a higher value of residual deviance indicates worse fit and a lower value indicates the opposite.
a model with a perfect fit would have zero residual deviance.
the null deviance value which indicates how well the response variable is predicted by a model that includes only one intercept i.e.
the grand mean is estimated as for our dataset.
the deviance of a fitted model decreases once we add explanatory variables.
this decrement of residual 8for ordinary least square ols regressions adjusted r2is used to measure a model s goodness of fit.
since it is difficult to compute adjustedr2for a logistic regression model the pseudor2is commonly used to measure its goodness of fit.
the advantage of using nagelkerke s pseudor2is that it s range is similar to the adjustedr2range used for ols regressions .
1380deviance would higher for a variable with higher predictive power than for a variable with lower predictive power.
for example the explanatory variable directory under review which has the highest predictive power reduces the residual deviance by .
with a loss of three degrees of freedom.
we can imply that the variable directory under review adds explanatory power to fit the model.
similarly reviewers experience reduces the residual deviance by .
with a loss of three degrees of freedom.
therefore reviewers experience adds104 explanatory power to fit the model.
overall our explanatory variables decrease the deviance by with a loss of degrees of freedom.
hence we can imply that our explanatory variables add571 explanatory power to fit the model which can be considered as a significant improvement over the null model.
examination of variables in relation to response since odds ratio or is recommended to measure the strength of relationship between an explanatory variable and the outcome we compute the or of each explanatory variable in our fitted model table iv using confidence interval.
in this study the or of an explanatory variable implies how the probability of getting a true outcome i.e.
a vulnerability getting identified increases with a unit change of that variable.
therefore an explanatory variable with or would increase the probability of a security defect getting identified during code reviews with its increment and vice versa.
since the explanatory variables used in our model have varying ranges i.e.
while number of directory under review varies between from to the reviewing experience varies between to several hundreds we cannot draw a generic conclusion by comparing the numeric or value of an explanatory variable against the or of another variable that has a different range.
table iv shows that the or of number of directory under review is .
i.e.
indicating that if the number of directory under review increases a code review is more likely to miss a security defect.
on the other hand the odds ratio of the variables reviewratio andisbugfix are well above which imply that if the review request is marked as a bug fix commit or the review conducts a significant number of prior review to that file the security defect is more likely to be identified during code review.
since isbugfix is a dichotomous variable interpretation of its or value .
is straightforward.
it indicates that vulnerabilities in a bug fix commit were .
times more likely to be identified during code reviews than a non bug fix commit.
the results also suggest positive impact of review time on vulnerability identification.
surprisingly the overall reviewing experience of a developer does not increase his her ability to identify security defects.
numofdirectoryunderreview reviewratio isbugfix reviewerreviewingexperience totalcommit authorcodingexperience numofreviewcomments mutualreviews numofreviewersinvolved complexity reviewtime fileownership .
.
.
.20spearman 2 response is identified adjusted 2fig.
.
dotplot of the spearman multiple 2of each explanatory variable and the response.
the larger values of 2indicate higher potential for a nonlinear relationship.
finding our model has identified nine code review factors that significantly differ between code reviews that successfully identified security defects and those failed.
number of directories impacted by a code change has the most predictive power among those nine factors.
observation a the probability of a vulnerability getting identified during a code review decreases with the increase in number of directories number of prior reviews by the reviewer number of prior commits in the file and number of review comments authored on a file during the current review cycle.
observation b the probability of a vulnerability getting identified during a code review increases with review time number of mutual reviews between the code author and a reviewer cyclomatic complexity of the file under review if the change belongs to a bug fix and a reviewer s number of priors review with the file.
v. i mplications in this section we describe the implications of our findings.
a. findings from rq1 table iii suggests that reviewers detect cwe and cwe in most of the cases.
both of the cwes are related to the security issues for multi threaded applications improper synchronization and race condition .
hence we can infer that chromium os developers have adequate expertise in securing multi threaded programs.
developers are also detecting issues related to improper calculation of array buffer or variable size in most of the cases which can overcome the possibility of potential buffer and or integer overflow underflow.
however identifying security issues with user input sanitization remains a concern.
most of the issues related to improper input validation have been escaped during code review which can lead to security vulnerabilities such as sql injection attack crosssite scripting attach and idn holograph attack.
chromium os project manager may tackle this problem in two possible ways.
first they may leverage additional quality assurance 1381table iv explanatory powers of the code review attributes to predict the likelihood of a vulnerability to be identified during code reviews allocated d.f.
deviance residual deviance deviance reduced by odds ratio pr chi null .
numofdirectoryunderre view .
.
.
.
.
reviewerreviewingexperience .
.
.
.
.
reviewratio .
.
.
.
.
isbugfix .
.
.
.
.
totalcommit .
.
.
.
.
numofre viewcomments .
.
.
.
.
reviewtime .
.
.
.
.
mutualre views .
.
.
.
.
comple xity .
.
.
.
.
authorcodingexperience .
.
.
.
.
fileownership .
.
.
.
.
numofre viewersinvolved .
.
.
.
.
total .
.
statistical significance of explanatory power according to wald 2likelihood ratio test p .
p .
p .
practices such as static analysis fuzzy testing that are known to be effective in identifying these categories of vulnerabilities.
second education training materials may be provided to reviewers to improve their knowledge regard these cwes.
b. findings from rq2 herzig and zeller find that when developers commit loosely related code changes that affect all related modules the likelihood of introducing bug increases .
such code changes are termed as tangled code changes.
our study also finds that if the code change affects multiple directories the security defect is more likely to escape code review.
reviewing tangled code changes can be challenging due to difficulties in comprehension.
to tackle this issue we recommend trying to avoid code changes dispersed across a large number of directories when possible spending additional time during such changes as our results also suggest positive impact of review time on vulnerability identification and integrate a tool such as the one proposed by barnett et al.
to help reviewers navigate tangled code changes.
our results also suggest that chromium os reviewers who have participated in higher number of code reviews for were less likely to identify security defects.
there may be several possible explanations for this result.
first developers who participates in a large number of reviews may become less cautious i.e.
review fatigue and miss security defects.
second developers who review lot of changes may have to spend less time per review as code reviews are considered as secondary responsibilities in most projects.
therefore such developers become less effective in identifying security defects due to hasty reviews.
finally identification of security defects may require special skillsets that do not increase a developer s participation in non security code reviews.
while we do not have a definite explanation we would recommend project managers to be more aware of review fatigue and avoid overburdening a person with a larger number of reviews.
the likelihood of file s vulnerability escaping increases with the total number of commit it has encountered during itslifetime.
a file with higher number of commits indicates more frequent changes in that file than others due to bugs or design changes.
since bugs often foreshadow vulnerabilities developers should be more cautious while reviewing files that frequently go through modifications.
interestingly if a code change is marked as a bug fix developers are more likely to identify security defects if exists during code reviews which suggests extra cautions during such reviews.
therefore an automated model may be used to predict and assign tags e.g.
security critical to code changes that are more likely to include vulnerabilities to draw reviewers attentions and seek their cautiousness.
unsurprisingly the likelihood of a security defect getting identified increases with review time i.e.
time to conclude a review .
although taking too much time to complete a review would slow the development process reviewers should make a trade off between time and careful inspection and try to avoid rushing reviews of security critical changes.
the number of mutual reviews between a pair of developers also has a positive effect on the likelihood of security defect identification.
when two developers review each other s code over a period of time they become more aware of each other s coding styles expertise strengths and weaknesses.
that awareness might help one to pay attention to areas that he she thinks the other has a weakness or where he she may make a mistake.
since mutual reviews have positive impact we recommend promoting such relationships.
vi.
t hreats to validity since case control studies originate from the medical domain one may question whether we can use this study framework to study se research questions.
we would like to point out that prior se studies have adopted various research designs such as systematic literature review controlled experiment ethnography and focus group that have originated in other research domains.
although the results of this study do not rely on the case control study framework we decided to use this design since our study satisfies the criteria 1382for using this framework and following a established methodological framework strengthens an empirical research such as this study.
our keyword based mining technique to identify whether a code review identifies security defect or not poses a threat to validity.
we may miss a security defect if the review comments do not contain any of the keywords that we used.
however as we are only considering those reviews that belong to security defects and ignoring the rest we are considering that falsenegative labeling of security defect will not make any impact on our study.
nevertheless as we manually check all the security defects while assigning cwe id we find no falsepositive labelling a code review as related to security defect.
another threat to is the categorization of cwe id.
as one of our authors manually checks all the codes to find weakness type and assign the best match cwe id for each weakness that author might categorize a weakness with a wrong or less suited cwe id.
to minimize the effect of this threat another author randomly chooses source code files and manually assign cwe id following a similar process without knowing the previously labeled cwe id.
we find that out of labels fall in the same group of cwe ids that were labeled earlier.
so we are considering that this threat will not make any significant change in our results.
another threat is the measure we take to calculate the developer s experience.
we can interpret the term experience in many ways.
and in many ways measuring of experience will be complex.
for example we cannot calculate the amount of contribution of a developer to other projects.
although a different experience measure may produce different results we believe our interpretation of experience is reasonable as that reflects the amount of familiarity with current project.
finally results based on a single project or even a handful of projects can be subject to lack of external validity.
given the manual work involved in the data collection process it is often infeasible to include multiple projects.
moreover historical evidence provides several examples of individual cases that contributed to discovery in physics economics and social science see five misunderstandings about case study research by flyvjerg .
even in the se domain case studies of the chromium project apache case study by mockus et al.
and mozilla case study by khomh et al.
have provided important insights.
to promote building knowledge through families of experiments as championed by basili we have made our dataset and scripts publicly available .
vii.
r elated work code review technologies are widely used in modern software engineering.
almost all the large scale projects have adopted peer code review practices with the goal of improving product quality .
researchers have justified the benefit of code reviews to identify missed defects .
prior studies also find that peer code review can be very effective in identifying security vulnerability .
that is why developers use of their working hours in reviewing other s code .
however despite the popularity and evidence in support some researchers explore that peer code reviews are not always performed effectively which decelerates the software development process .
despite putting lots of efforts in code review to keep product secured a significant number of security vulnerability is reported every year and the number is ever increasing.
although some prior studies have questioned about the effectiveness of peer code review in identifying security vulnerabilities they did not explore the factors that could be responsible for this ineffectiveness.
researchers have introduced several metrics of code reviews over time that can be used to identify security vulnerability .
however they did not investigate the state of those attributes when code review cannot identify security vulnerabilities.
meneely and williams find that the engagement of too many developers to write a source code file can make that file more likely to be vulnerable termed that situation as too many cooks in kitchen .
but they do not explore what characteristics of code review was responsible.
munaiah et al.
use natural language processing to get the insights from code review that missed a vulnerability .
they investigate code review comments of chromium project and find that code reviews that have discussions containing higher sentiment lower inquisitiveness and lower syntactical complexity are more likely to miss a vulnerability.
to the best of our knowledge no prior study has sought to identify the difference in security defects that are identified in code review and security defects that are escaped.
also no prior studies introduce attributes that can be impactful in distinguishing code reviews where security defects get identified and code reviews where security defects get escaped.
viii.
conclusion in this case control study we empirically build two datasets a dataset of code reviews where security defects were successfully identified and a dataset of code reviews where security defects were escaped.
the results of our analysis suggest that the likelihood of a security defect s identification during code reviews depends on its cwe category.
a logistic regression model fitted on our dataset achieved an auc score of .
and has identified nine code review attributes that influence identifications of security defects.
while time to complete a review the number of mutual reviews between two developers and if the review is for a bug fix have positive impacts on vulnerability identification opposite effects are observed from the number of directories under review the number of total reviews by a developer and the total number of prior commits for the file under review.
based on the results of this study we recommend adopting additional quality assurance mechanisms to identify security defects that are difficult to identify during code reviews trying to avoid tangled code changes when possible assisting the reviewers to comprehend tangled code changes balancing review loads to avoid review fatigue and promoting mutual reviewing relationship between developers.
1383references l. allodi and f. massacci comparing vulnerability severity and exploits using case control studies acm transactions on information and system security tissec vol.
no.
pp.
.
h. alves b. fonseca and n. antunes software metrics and security vulnerabilities dataset and exploratory study in 12th european dependable computing conference edcc .
ieee pp.
.
a. bacchelli and c. bird expectations outcomes and challenges of modern code review in proceedings of the international conference on software engineering.
ieee pp.
.
m. barnett c. bird j. brunet and s. k. lahiri helping developers help themselves automatic decomposition of code review changesets in2015 ieee acm 37th ieee international conference on software engineering vol.
.
ieee pp.
.
v .
r. basili f. shull and f. lanubile building knowledge through families of experiments ieee transactions on software engineering vol.
no.
pp.
.
m. beller a. bacchelli a. zaidman and e. juergens modern code reviews in open source projects which problems do they fix?
in proceedings of the 11th working conference on mining software repositories pp.
.
v .
bewick l. cheek and j. ball statistics review logistic regression critical care vol.
no.
p. .
c. bird a. gourley p. devanbu m. gertz and a. swaminathan mining email social networks in proceedings of the international workshop on mining software repositories pp.
.
m. borg o. svensson k. berg and d. hansson szz unleashed an open implementation of the szz algorithm featuring example usage in a study of just in time bug prediction for the jenkins project proceedings of the 3rd acm sigsoft international workshop on machine learning techniques for software quality evaluation maltesque .
.
available a. bosu and j. c. carver impact of developer reputation on code review outcomes in oss projects an empirical investigation in acm ieee international symposium on empirical software engineering and measurement ser.
esem torino italy pp.
.
a. bosu j. c. carver c. bird j. orbeck and c. chockley process aspects and social dynamics of contemporary code review insights from open source development and industrial practice at microsoft ieee transactions on software engineering vol.
no.
pp.
.
a. bosu j. c. carver h. munawar p. hilley and d. janni identifying the characteristics of vulnerable code changes an empirical study in proceedings of the 22nd acm sigsoft international symposium on foundations of software engineering pp.
.
a. bosu m. greiler and c. bird characteristics of useful code reviews an empirical study at microsoft in ieee acm 12th working conference on mining software repositories.
ieee pp.
.
f. camilo a. meneely and m. nagappan do bugs foreshadow vulnerabilities?
a study of the chromium project in proceedings of the 12th working conference on mining software repositories.
ieee press pp.
.
j. cohen a coefficient of agreement for nominal scales educational and psychological measurement vol.
no.
pp.
.
j. czerwonka m. greiler and j. tilford code reviews do not find bugs.
how the current code review best practice slows us down in2015 ieee acm 37th ieee international conference on software engineering vol.
.
ieee pp.
.
m. di biase m. bruntink and a. bacchelli a security perspective on code review the case of chromium in ieee 16th international working conference on source code analysis and manipulation scam .
ieee pp.
.
a. edmundson b. holtkamp e. rivera m. finifter a. mettler and d. wagner an empirical study on the effectiveness of security code review in international symposium on engineering secure software and systems.
springer pp.
.
h. fe regression modeling strategies .
b. flyvbjerg five misunderstandings about case study research qualitative inquiry vol.
no.
pp.
.
j. a. hanley and b. j. mcneil the meaning and use of the area under a receiver operating characteristic roc curve.
radiology vol.
no.
pp.
.
f. e. harrell jr regression modeling strategies with applications to linear models logistic and ordinal regression and survival analysis.
springer .
k. herzig and a. zeller the impact of tangled code changes in 10th working conference on mining software repositories msr .
ieee pp.
.
d. hinkle h. jurs and w. wiersma applied statistics for the behavioral sciences .
b. d. o. hub summary of chromium os project https .
f. khomh t. dhaliwal y .
zou and b. adams do faster releases improve software quality?
an empirical case study of mozilla firefox inproceedings of the 9th ieee working conference on mining software repositories.
ieee press pp.
.
r. kissel glossary of key information security terms.
diane publishing .
o. kononenko o. baysal l. guerrouj y .
cao and m. w. godfrey investigating code review quality do people and participation matter?
in proceedings of the 31st international conference on software maintenance and evolution icsme .
ieee pp.
.
a. krutauz t. dey p. c. rigby and a. mockus do code review measures explain the incidence of post release defects?
empirical software engineering vol.
no.
pp.
.
r. lagerstr om c. baldwin a. maccormack d. sturtevant and l. doolan exploring the relationship between architecture coupling and software vulnerabilities in international symposium on engineering secure software and systems.
springer pp.
.
s. lewallen and p. courtright epidemiology in practice case control studies community eye health vol.
no.
p. .
m. v .
m antyl a and c. lassenius what types of defects are really discovered in code reviews?
ieee transactions on software engineering vol.
no.
pp.
.
t. j. mccabe a complexity measure ieee transactions on software engineering no.
pp.
.
g. mcgraw software security building security in volume .
addison wesley professional .
automated code review tools for security computer vol.
no.
pp.
.
s. mcintosh y .
kamei b. adams and a. e. hassan the impact of code review coverage and code review participation on software quality a case study of the qt vtk and itk projects in proceedings of the 11th working conference on mining software repositories.
acm pp.
.
an empirical study of the impact of modern code review practices on software quality empirical software engineering vol.
no.
pp.
.
a. meneely h. srinivasan a. musa a. r. tejeda m. mokary and b. spates when a patch goes bad exploring the properties of vulnerability contributing commits in acm ieee international symposium on empirical software engineering and measurement.
ieee pp.
.
a. meneely a. c. r. tejeda b. spates s. trudeau d. neuberger k. whitlock c. ketant and k. davis an empirical investigation of socio technical code review metrics and security vulnerabilities inproceedings of the 6th international workshop on social software engineering pp.
.
a. meneely and l. williams secure open source collaboration an empirical study of linus law in proceedings of the 16th acm conference on computer and communications security pp.
.
mitre corporation common weakness enumeration org .
a. mockus r. t. fielding and j. herbsleb a case study of open source software development the apache server in proceedings of the 22nd international conference on software engineering .
acm pp.
.
n. munaiah and a. meneely vulnerability severity scoring and bounties why the disconnect?
in proceedings of the 2nd international workshop on software analytics.
acm pp.
.
n. munaiah b. s. meyers c. o. alm a. meneely p. k. murukannaiah e. prud hommeaux j. wolff and y .
yu natural language insights from code reviews that missed a vulnerability in international symposium on engineering secure software and systems.
springer pp.
.
n. nagappan and t. ball use of relative code churn measures to predict system defect density in proceedings of the 27th international conference on software engineering pp.
.
using software dependencies and churn metrics to predict field failures an empirical case study in first international symposium on empirical software engineering and measurement esem .
ieee pp.
.
n. j. nagelkerke et al.
a note on a general definition of the coefficient of determination biometrika vol.
no.
pp.
.
r. paul a. k. turzo and a. bosu a dataset of vulnerable code changes of the chormium os project feb. .
.
available h. perl s. dechand m. smith d. arp f. yamaguchi k. rieck s. fahl and y .
acar vccfinder finding potential vulnerabilities in open source projects to assist code audits in proceedings of the 22nd acm sigsac conference on computer and communications security pp.
.
p. c. rigby and c. bird convergent contemporary software peer review practices in proceedings of the 9th joint meeting on foundations of software engineering pp.
.
w. sarle sas stat user s guide the varclus procedure.
sas institute inc. cary nc usa .
m. s. setia methodology series module case control studies indian journal of dermatology vol.
no.
p. .
t. j. smith and c. m. mckenna a comparison of logistic regression pseudo r2 indices multiple linear regression viewpoints vol.
no.
pp.
.
l. statistics spearman s rank order correlation laerd statistics .
p. thongtanunam s. mcintosh a. e. hassan and h. iida review participation in modern code review empirical software engineering vol.
no.
pp.
.