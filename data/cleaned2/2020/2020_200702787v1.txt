model based exploration of the frontier of behaviours for deep learning system testing vincenzo riccio software institute usi lugano switzerland vincenzo.riccio usi.chpaolo tonella software institute usi lugano switzerland paolo.tonella usi.ch abstract with the increasing adoption of deep learning dl for critical tasks such as autonomous driving the evaluation of the quality of systems that rely on dl has become crucial.
once trained dl systems produce an output for any arbitrary numeric vector provided as input regardless of whether it is within or outside the validity domain of the system under test.
hence the quality of such systems is determined by the intersection between their validity domain and the regions where their outputs exhibit a misbehaviour.
in this paper we introduce the notion of frontier of behaviours i.e.
the inputs at which the dl system starts to misbehave.
if the frontier of misbehaviours is outside the validity domain of the system the quality check is passed.
otherwise the inputs at the intersection represent quality deficiencies of the system.
we developed deepjanus a search based tool that generates frontier inputs for dl systems.
the experimental results obtained for the lane keeping component of a self driving car show that the frontier of a well trained system contains almost exclusively unrealistic roads that violate the best practices of civil engineering while the frontier of a poorly trained one includes many valid inputs that point to serious deficiencies of the system.
ccs concepts software and its engineering software testing and debugging .
keywords software testing deep learning model based testing search based software engineering introduction deep neural networks dnns have been applied successfully to complex tasks such as image processing speech recognition and natural language analysis.
the range of applications of dnns is huge and includes autonomous driving medical diagnosis financial trading and automated customer services.
as a consequence the problem of testing deep learning dl systems to ensure their dependability has become critical.
existing approaches to generate tests for dl systems can be split into two groups techniques that directly manipulate the raw input data and techniques that derive input data from a model of the input domain .
in the former case the result is a so called adversarial example while in the latter case it can be regarded as a critical test scenario .
in both cases test generation is guided by the criticality of the produced inputs measured either directly as a misclassification inconsistent behaviour or mediated by a proxy such as surprise or neuron coverage .
adversarial examples e.g.
images obtained by manipulation of the pixels of an image taken from the camera of an autonomous car may produce very unlikely or even impossible cases whose resolution might have no impact on the system s reliability.
critical test scenarios obtained by model based input generation tend to be more realistic.
however the existing model based approaches do not aim at covering thoroughly and characterising the region where the dl system misbehaves.
the iso pas standard on safety of autonomous and assisted driving prescribes that unsafe situations should be identified and be demonstrated to be sufficiently implausible.
when unsafe situations are plausible countermeasures must be adopted.
manual identification of unsafe conditions for dnns is challenging because their behaviour cannot be decomposed via logical conditions as done e.g.
with root cause analysis .
this motivates our work on the automated identification of the frontier of behaviours of dl systems we aim to support engineers in identifying and checking the plausibility of the frontier of behaviours.
in this paper we introduce a novel way to assess the quality of dl systems based on a new notion the frontier of behaviours .
the frontier of behaviours of a dl system is a set of pairs of inputs that are similar to each other and that trigger different behaviours of the dl system.
it represents the border of the input region where the dl system behaves as expected.
for instance the frontier of a classifier of hand written digits consists of the pairs of similar digits that are classified differently one correctly and the other incorrectly .
the frontier of behaviours of a low quality dl system may include pairs of inputs that intersect the validity domain being similar to nominal cases for which the system is expected to behave correctly according to the requirements.
on the contrary a dl system of high quality will start to misbehave on inputs that deviate substantially from the nominal ones with small or no intersection with the validity domain e.g.
a digit is misclassified only when it becomes unrecognisable or indistinguishable from another digit such as .
we have adopted a model based input generation approach to produce realistic inputs under the assumption that a high fidelity model of the input is available for the dl system under test.
there are several domains in which the development of input models is standard practice among which safety critical domains such as automotive and aerospace engineering .
in other domains such as image classification input models can be constructed e.g.
in unity or reverse engineered.
our tool deepjanus implements a multi objective evolutionary algorithm to manipulate the input model with the overall goal of achieving thorough exploration of the frontier of behaviours.
to this aim one of its two fitness functions promotes diversity so as to spread the solutions along thearxiv .02787v1 jul 2020esec fse november sacramento california united states vincenzo riccio and paolo tonella entire frontier and minimises the distance between the elements in each pair.
the other fitness function pushes the solutions to the frontier.
the output of deepjanus provides developers with a thorough and human interpretable picture of the system s quality.
in fact the elements of each pair in the frontier may be deemed as within or outside the validity domain of the system in the latter case they are irrelevant for the reliability of the dl system .
when used to compare alternative dl systems that solve the same problem metrics of the frontier size e.g.
its radius are useful to show quantitatively if the region contained in one frontier is substantially smaller larger than the region contained in the other.
the proposed technique was evaluated on both a classification problem hand written digit recognition and a regression problem steering angle prediction in a self driving car .
the frontier of the digit classifier was evaluated by 20human assessors recruited on a crowdsourcing platform.
results show that a high quality classifier has a smaller intersection with the validity domain with respect to a poorly trained one.
the frontier of the self driving car was evaluated by assessing the conformance of the shapes of the roads at the frontier to the guidelines for the design of american highways .
frontier roads obtained for a high quality system violate such guidelines showing that the system misbehaves only in extreme cases.
such results were confirmed by quantitative measures of the frontier radius which was larger for the high quality than for the low quality dl system and qualitative assessment of the frontier images roads which are more challenging for humans when taken from the high quality system frontier.
we compared our results with those produced by dlfuzz a tool that generates boundary adversarial inputs by pixel manipulation and found that it generates corner cases that are more concentrated and less realistic than those of deepjanus .
background .
deep learning systems in this work we refer to software systems that include one or more dnns as dl systems .
their behaviour is defined both by the code that implements them and by the data used to train their dnn components.
a dnn can be considered as a black box component that transforms a numeric input vector into a numeric output.
it can accomplish various tasks such as the prediction of the steering angle of a self driving car starting from the image captured by a camera sensor .
in a regression problem the output is a continuous value whereas in a classification problem the output is a discrete class.
a dnn consists of a collection of computation units called neurons organised into layers that are connected sequentially i.e.
neurons of layer nare only connected to neurons of layer n .
each connection of the network has a weight which determines the propagation of a neuron s output to the next neuron.
among the layers of a dnn the input layer receives external data the output layer produces the final result while internal hidden layers perform intermediate processing e.g.
feature extraction .
each neuron computes its output by applying an activation function e.g.
sigmoid to the weighted sum of its inputs.
to accomplish a task dnns are iteratively trained through a large set of labelled training data.
during training a dnn learns figure four pairs of elements in the frontiers of the considered dl systems.
the first column shows two original samples from the mnist data set.
the second and third columns show the pairs in the frontier of system lq fourth and fifth columns show the frontier pairs of system hq.
how to perform a prediction i.e.
a label for classification problems or a real value for regression problems by adjusting the weights of the network.
the number of training iterations in which the whole training set is processed by the network is a hyper parameter called epochs .
the number of epochs influences how the network fits the training data and how it will be able to generalise to unseen inputs.
another fundamental hyper parameter is the learning rate which defines the amount of corrections that are applied to the weights at each training iteration.
.
evolutionary search and novelty search evolutionary algorithms are a family of meta heuristic optimisation algorithms that evolve a population of individuals i.e.
candidate solutions to an optimisation problem by means of genetic operators such as mutation andcrossover .
afitness function provides an approximate heuristic distance of each candidate solution from the searched optimum.
during evolution the best individuals are selected for the next population based on the fitness function values.
multi and many objective evolutionary algorithms generalise the basic evolutionary algorithms to multiple fitness functions.
since in such a case there is no single dimension on which to compare individuals during selection the best ones are obtained by pareto front analysis as those that are not dominated by any other individual.
multi and many objective genetic algorithms have proved to be particularly effective in test case generation .
the solutions found by search algorithms might be concentrated in a small portion of the input space especially when the search landscape includes local optima with a large basin of attraction.
if the goal is not only to find good solutions according to the fitness functions but also to find solutions spread across the entire input space as in our case evolutionary algorithms can be combined with novelty search .
novelty search algorithms reward individuals that exhibit diversity of behaviours instead of promoting only those that contribute to progress toward the optimum .
they trade off a lower pressure toward optimal fitness values with a higher diversity in the population being evolved.
motivating example in this section we provide a motivating example that shows how the frontiers of behaviours can help characterising the quality ofmodel based exploration of the frontier of behaviours for deep learning system testing esec fse november sacramento california united states dl systems.
let us consider the frontiers of behaviours of two dl systems that perform the same task but exhibit different levels of quality in terms of test accuracy namely hq high quality lq low quality .
both systems consist of a classifier of handwritten digits that predicts which digit is represented by an input image.
in a classification problem such as this one the frontier is represented by pairs of similar inputs that are classified differently one correctly the other incorrectly .
to assess the difference between the frontiers of these two systems we consider two images of handwritten digits taken from the mnist dataset that are labeled correctly i.e.
as number by both systems.
they are shown in the first column of fig.
.
then we apply slight changes to the shape of the two inputs.
technically this is achieved by first extracting a vector model of the digits and then manipulating the control points of such model.
the result consists of two pairs of samples in the frontier of each considered system i.e.
lq second and third column and hq fourth and fifth column .
we can notice that the inputs in the frontier of lq are very similar to the original samples.
moreover all the misclassified inputs in its frontier are still clearly recognisable as digit .
instead the frontier of hq contains inputs that are probably challenging to classify even for humans.
in particular the first element of the fifth column has the general shape of a five but it could also be considered as a nine since the upper part of the figure forms a circle.
the second element of the fifth column does not look like any reasonably classifiable digit despite its similarity with the corresponding member of the pair on the other side of the frontier.
to summarise the frontier of a low quality dl system is expected to contain samples that are quite close to those that the system is supposed to classify correctly indicating a poor generalisation capability.
differently the frontier of a high quality dl system includes cases that are difficult or impossible to handle even for humans being outside the validity domain.
model based input representation we aim at generating inputs at the behavioural frontier of a dl system and we want them to be realistic and representative.
therefore we adopt a model based approach that produces test inputs starting from a model representation of the input domain and enforces the compliance with domain specific constraints.
this may require the transformation of a concrete input into an abstract model that can be manipulated by the exploration algorithm in case no domain specific model of the input is available.
the transformation from models to concrete inputs is instead always required.
to illustrate how our approach works in practice we consider both an exemplary classification problem and a regression problem.
the classification problem consists of handwritten digit recognition while the regression problem is steering angle prediction for selfdriving cars.
in the latter case we focus on systems that perform behavioural cloning i.e.
the dl component learns the lane keeping behaviour from a human driver .
in detail the dl system is able to autonomously keep the lane since it contains a dnn that is trained with images captured by the camera sensors of the car paired with the steering angles provided by a driver.
figure bitmap and vector image model representation of the image returned by potrace .
image classification we use the inputs available from the mnist database and originally encoded as x images with greyscale levels that range from to .
we adopt scalable vector graphics svg as their model representation.
svg is an xml based vector image format for two dimensional graphics that can represent shapes as the combination of cubic and quadratic b zier curves .
by modelling handwritten digits as a combination of b zier curves we ensure that the smoothness and curvature of handwritten shapes is preserved and that images remain realistic even after minor manipulation of the b zier curve parameters.
to transform an original input image into its svg model representation we use the potrace algorithm .
this algorithm performs a sequence of operations including binarisation despeckling and smoothing to produce a smooth vector image starting from a bitmap.
figure shows an mnist image paired with its svg model and its description.
the control parameters that determine the shape of the modelled digit are the start point the end point and the control points c1andc2that define each b zier segment.
in the other direction we use rasterisation to transform a vector model into a x grayscale image.
this operation exploits the functionality offered by librsvg2and cairo3 two popular open source graphic libraries.
.
steering angle prediction we consider a self driving car that is trained and tested in the beamng simulation environment.
it features an accurate driving physics engine and it is freely available and research oriented.
the input to the steering angle predictor is an image captured by the onboard sensor camera in the simulated environment.
therefore the test input is determined by the scenario in which the car drives.
such simulated scenario can be modelled as the composition of the roads the driving task i.e.
start point end point and lane to keep and the environment which includes the weather and lightness conditions.
for the sake of simplicity let us consider scenarios consisting of single plain asphalt roads surrounded by green grass on which the car has to drive keeping the right lane.
the environment is always set to a clear day without fog.
the roads are composed of two lanes with fixed width in which there is a yellow center line plus two white lines that separate each lane from the non drivable area.
november sacramento california united states vincenzo riccio and paolo tonella figure the model of a road and the corresponding road figure a test case rendered by the beamng simulation engine is composed by the road the driving task the environment and the car abstractedly a road can be represented as a sequence of contiguous points in a bi dimensional space assuming constant elevation .
to produce a smooth and realistic shape for the road being modelled we use catmull rom cubic splines and then we interpolate such curves to obtain the 2d point sequence.
figure shows the splines that define a road as well as its interpolated 2d points marked as grey dots .
the control parameters that determine the shape of the splines in figure are the coordinates of the control points of the center line spline marked as larger red dots .
the concrete representation of the driving scenario is strictly dependent on the simulator.
beamng exposes an intuitive api for programmatically configuring virtual roads and controlling the simulations4.
in beamng a scenario is described by a json file that contains the set of points to render the roads.
the simulation engine renders the road by creating polygons starting from the points provided in the scenario description and sets up the environment as shown in figure .
to transform the abstract model into the road to be rendered in the simulator we calculate its points by exploiting the recursive algorithm for the evaluation of catmull rom cubic splines proposed by barry and goldman and the functionality offered by the shapely library for manipulation and analysis of planar geometric we also enforce the following domain specific constraints the start point and the end point of a driving task should be different the road should fall within a square bounding box of fixed size and a road should not self intersect.
the deepjanus technique deepjanus explores the behavioural space of a dl system to find pairs of inputs at its frontier one input on which the dl system behaves as expected and another similar input on which it misbehaves.
by generating a pair of similar inputs that trigger different behaviours we ensure that the failure inducing inputs are close to the validity domain and are likely to represent valid corner cases on which the system misbehaves.
otherwise by generating single inputs that trigger misbehaviours without staying close to corresponding ones for which the system behaves well it would have been more likely to produce uninteresting test cases that are far from the frontier and do not intersect the validity domain.
deepjanus aims at exploring the frontier at large i.e.
as thoroughly as possible so as to report a broad picture of the boundary behaviours to developers.
to perform such exploration it aims at producing inputs at the frontier of behaviours and at maximising the diversity among the elements that are moved toward the frontier so as to achieve thorough frontier exploration.
at the same time it also maintains high similarity within each pair of inputs crossing the frontier.
therefore the problem solved by deepjanus can be cast as a multi objective search problem .
to obtain a diverse set of solutions we hybridise traditional multi objective search based algorithms with novelty search .
the idea is to measure the diversity between the population being evolved and the archive of the best individuals.
algorithm outlines the top level steps implemented in deepjanus .
our algorithm is based on nsga ii a multi objective evolutionary search algorithm quite popular in search based software testing research extended with hybridisation with novelty search achieved by defining a fitness function that includes a measure of sparseness of the solutions see section .
.
use of an archive to avoid cycling and to promote frontier exploration at large lines and of algorithm use of re population to escape from stagnation line of algorithm .
moreover we defined domain specific mutation operators to evolve the candidate solutions.
we implemented deepjanus in python on top of the deap evolutionary computation framework v. .
.
.
the code of deepjanus is available online as open source .
.
fitness functions the algorithm optimises two fitness functions which measure respectively the quality of an individual consisting of its cross pair diversity and within pair similarity and the closeness of the inputs to the frontier of behaviours.
.
.
quality of an individual.
the quality of an individual is measured by two factors namely the distance between the two members of a pair and the sparseness of an individual with respect to the individuals in the archive measure the quality of a exploration of the frontier of behaviours for deep learning system testing esec fse november sacramento california united states algorithm overall algorithm of deepjanus input s set of input seeds max max number of generations popsize population size output a archive of best individuals at the frontier 1generation g 2a 3population p initialisepopulation s popsize 4evaluate p 5a updatearchive p assign crowding distance to individuals 6p select p popsize 7while max do tournament selection based on dominance and crowding distance offspring q seltourdcd p popsize foreach q qdo q mutate q end substitute the most dominated individuals p repopulation p s a evaluate p q a updatearchive p q p select p q popsize 17end 18return a given individual.
since both are distances between inputs we can combine these two measures additively into the fitness function f1 to be maximised max f1 x spars x a kdist x.m1 x.m2 where ais the archive and x.m1 x.m2are the members of the pair in the individual x. both functions spars anddistreport a measure of distance between inputs.
hence the constant kis a pure number that can be safely set to .
it can also be experimentally tuned by decreasing it to values less than to give more importance to the sparseness component of f1 especially when preliminary runs of the algorithm show that the final archive contains a small number of individuals.
function distmeasures the similarity of the inputs within an individual as the distance between its members.
this distance is computed on the input instances and is domain specific.
for the image classification problem we compute the euclidean distance between pixel matrices .
for the regression problem we use a weighted levenshtein distance that takes into account the edit operations on the sequences of angles and points sampled on the spines of the roads being compared.
this distance metric is suitable for the comparison of road shapes since it takes into account the order of the points along the curves as well as the relative angle between consecutive points.
function spars measures the sparseness of an individual i.e.
its minimum distance from the solutions in the archive a.spars x is defined as the distance from the closest individual in the archive a miny adist x y .dist x y is computed from the distances between individual members asthe minimum between dist x.m1 y.m1 dist x.m2 y.m2 and dist x.m1 y.m2 dist x.m2 y.m1 .we introduced the sparseness in the quality measure to promote diversity within the solution.
this was motivated by preliminary experiments we ran in which the search tended to get stuck in local optima covering only a tiny portion of the frontier if sparseness was not included in the fitness function.
.
.
closeness to the frontier.
the fitness function f2measures the closeness of an individual to the frontier min f2 x eval x.m1 eval x.m2 if otherwise computation of f2requires the execution of the dl system under test on the two members belonging to the individual.
this is represented by the invocation of function eval on each member.
the quality of the behaviour exhibited by the dl system under test is measured during its execution.
we design f2so that such quality is a positive number if the system exhibits the expected behaviour a negative number otherwise.
the definition of function eval is domain problem specific.
for the image classification problem we exploit the confidence level provided by the output layer of the dnn as eval function.
in fact the output of a classification dnn is usually the array returned by the softmax activation function containing the confidence levels assigned to each of the possible classes .
more specifically eval is calculated as the difference between the confidence level associated with the expected label and the maximum confidence level associated to any other class.
for the steering angle prediction problem we use a metric similar to that proposed by gambi et al.
.
the behaviour of the dnn is characterised by the distance of the car from the center of the lane during the simulation of the corresponding input scenario.
more specifically evalis calculated as min w d where wis the width of the lane and dthe distance of the car from the lane centre.
the position of the car is approximated by its centre of mass.
function eval returns its maximum value w when the car has distance zero from the center of the lane it returns a negative number when an out of bound episode occurs.
.
initial population function initialisepopulation line in algorithm returns the initial population given a set of seeds and the population size.
seeds are inputs on which the dl system under test exhibits a correct behaviour.
the two members of an individual are obtained by copying the same seed twice and applying the mutation operator to one of the two copies.
more specifically for image classification seeds are chosen from the mnist samples that are correctly classified by the system under test.
for steering angle prediction we generate valid roads and evaluate the system on them.
the ones on which the car does not depart from the lane are considered as seeds positive eval .
.
archive of solutions the best non dominated individuals encountered during the search are kept in the archive .
this prevents the search for noveltyesec fse november sacramento california united states vincenzo riccio and paolo tonella from cycling a phenomenon where the population moves from one area of the behavioural space to another and back again without any memory of the areas it has already explored .
at the end of the exploration the archive contains the final solution.
the archive is managed by the updatearchive function lines and of algorithm .
an individual of the population is considered as a candidate to be included in the archive if it is at the frontier of behaviours.
when a new input pair at the frontier is found it is compared with its nearest neighbour in the archive.
if the distance from the nearest neighbour in the archive is higher than a threshold ta the new individual is kept in the archive.
instead if the distance from its nearest neighbour is lower than the threshold the new candidate competes locally with its nearest neighbour in the archive.
the local competition rewards individuals outperforming the most similar ones in the behavioural space .
in our case local competition is based on the distance between the members of each pair only the individual that has the closest members is kept in the archive.
the threshold tais a parameter that determines the granularity of the final frontier so it can be adjusted by the tester so as to obtain a frontier with the desired size a high value of tamakes it difficult for new individuals at the frontier to enter the archive because they must be extremely different from those already included.
lowering the value of taincreases the granularity of the frontier and a higher number of similar individuals are added.
to choose empirically the value of ta we recommend to compute the minimum distance among a randomly selected set of diverse inputs choose a value greater than this number iteratively adjust this value based on the final archive size.
.
selection operator we use the select operator from nsga ii lines and in algorithm .
this selection operator favours individuals with smaller non domination rank and when the rank is the same i.e.
the individuals belong to the same pareto front it favours the one with higher crowding distance less dense regions to promote diversity.
since we use tournament selection the offspring of the current population is obtained by choosing the winner among the two individuals being compared in each tournament seltourdcd at line in algorithm .
.
mutation the individuals selected for the offspring are mutated by the mutate operator lines in algorithm .
this operator manipulates the control parameters of the model representation of each input it chooses one of the two members of the individual and it applies a perturbation to the model parameters representing the input.
the extent of the perturbation is uniformly sampled in a customisable range.
after applying the operator we verify if the mutant complies with the constraints of the input domain.
moreover we also verify that once concretised into an actual input for the dl system the mutant is different from its parent and from the other member of the pair.
if any of these checks fails the operator is applied repeatedly until a valid input is obtained.for the classification problem the mutation operator randomly chooses a start point an end point or a control point of the svg model and applies a displacement to it in the two dimensional space.
the mutation operator for the regression problem is similar and it is applied to the control points that define the road shape.
.
repopulation operator the exploration could get stuck in local optima despite the mechanisms used to promote diversity e.g.
sparseness in fitness function f1 .
to mitigate this undesirable situation and further vary the population deepjanus uses the repopulation operator line in algorithm inspired by the shotgun hill climbing meta heuristic algorithm .
it replaces nof the most dominated individuals in the current population with individuals newly generated from the seeds.
the aggressiveness of this operator can be tuned by setting the range from which the value of nis uniformly sampled.
when repopulation is applied each new individual is generated starting from one of the seeds that have not yet produced any solutions in the archive.
if all the starting seeds have produced at least one solution the new individuals are generated starting from a randomly chosen seed.
experimental evaluation .
subject systems we evaluate deepjanus on two dl systems addressing different tasks and domains.
the first system performs a classification task which consists of recognising handwritten digits from the mnist dataset .
the second system solves a regression problem.
specifically it predicts the steering angle of a self driving car given the image of its onboard camera using the beamng simulator .
hereafter we refer to such objects of study simply as mnist and beamng .
we chose these problems because of their representativeness and because they have been widely used in the literature to evaluate testing techniques for dnn systems .
moreover self driving cars are an example of safety critical usage of dnns.
to assess the usefulness of the frontier when computed for a high quality hq vs a low quality lq dl system we trained two versions of each of the two considered systems.
themnist case study consists of a dnn model that predicts which digit is represented by an input image.
we considered the deep convolutional network provided by keras 6because of its popularity simplicity and effectiveness.
deepjanus crosses the frontier of mnist when the input image is misclassified.
the hq version of mnist has .
test accuracy and was obtained by training the dnn on the images of the mnist training set with the default settings provided by keras i.e.
12epochs with batches of size and with a learning rate equal to .
the lq version was trained on the same training set and with the same hyper parameters with the exception of the learning rate that was set to .
.
in fact such a learning rate is associated with an accuracy drop i.e.
the model s test accuracy goes down to .
.
thebeamng case study is a self driving car equipped with a lane keeping assist system lkas running in the beamng simulator .
it adopts a behavioural reflex approach i.e.
the dl exploration of the frontier of behaviours for deep learning system testing esec fse november sacramento california united states component learns a direct mapping from the sensor camera input to the steering angle value to be passed to the actuators .
the dnn driving the beamng ego car utilises the dave architecture designed by bojarski et al.
at nvidia consisting of three cnns followed by five fully connected layers .
the dnn was trained with images captured by the camera sensors of the ego car paired with the steering angles provided by the simulator s autopilot which takes advantage of global knowledge and computes the optimal steering angle geometrically.
deepjanus crosses the frontier of beamng if the ego car goes out of bound when driving in the input road.
for beamng we also produced two versions hq and lq.
both versions were trained for 600epochs with batches of size 128and with a learning rate equal to .
.
to train the lq version we used a training dataset obtained by letting the autopilot drive up to mph on a sinusoidal road y sin x where unit corresponds to meter .
the hq version was instead trained on an enriched training set including 30diverse types of roads made of control points that were automatically generated.
unrepresentative training data is a common fault in dl systems .
.
research questions rq1 effectiveness what is the intersection between the frontier reported by deepjanus and the input validity domain of the dl system under test?
this is the main research question of our empirical evaluation since it focuses on the use of deepjanus to check if the frontier behaviours of the dl system under test are outside the validity domain which indicates the system has reached an adequate quality level or within the validity domain which points to issues that might affect the dl system in real executions.
metrics assessing whether a frontier input is or is not part of the valid inputs is in general a domain dependent task which requires human judgment and deep knowledge of the requirements behind the dl system.
for mnist we resort to a human study in order to understand if and to what extent a given digit is recognisable correctly by a human.
when this is not the case the input image is deemed as outside the validity domain of the classifier.
for beamng we refer to the guidelines from the american association of state highway and transportation officials aashto which prescribes among other things the minimum recommended radius of curvature by speed limit in particular ft at mph the car speed in the simulations run on beamng .
when the generated inputs violate the road design guidelines on the minimum curvature radius we deem the frontier input as outside the validity domain.
human assessment to determine whether the frontier of mnist intersects its validity domain we asked humans to recognise the digit images taken from the frontier and to declare their confidence in such recognition.
we created 20surveys made of questions to be presented to human assessors 9assessment questions asq and 1attention check question acq .
the difference between asq and acq is that the former involves a frontier image while the latter is by construction a nominal image whose classification is trivial and unambiguous for humans.
to this aim we used the digits delivered with the freestyle script font 7a computer font that resembles handwritten characters.
we double checked that the asqs were indeed unambiguous to classify.
to obtain the images featured in the asqs we ran deepjanus on both versions of mnist hq and lq once for each digit class.
then we considered the member of the pair outside the frontier i.e.
the misclassified image .
we took 90images for each of the two mnist frontiers.
we sorted the elements in the frontier based on their distance from the corresponding nominal freestyle font digit the same image used in the acq and divided them into 9buckets of the same size.
we selected the same number of samples for each digit by randomly selecting one sample from each bucket.
in total we selected 180inputs from the obtained frontiers.
each of the selected inputs appeared in a single survey.
the order of appearance of hq asqs lq asqs and the acq was randomised in the surveys.
in total this assessment involved 20different human assessors one for each survey.
for each image we asked humans to answer the following questions what digit does the image represent?
.
.
.
how confident are you in your answer?
not at all not much borderline quite confident very confident .
rq2 discrimination does deepjanus provide discriminative information about the dl systems under test?
in this research question we compare the frontiers of two dl systems one exhibiting good performance hq and one having poor performance lq .
we measured the size of the region identified by each frontier to assess whether hq systems have a larger frontier than lq ones.
metrics to answer this research question quantitatively we defined the metric radius let us consider the archive aat the end of the execution of algorithm and let us assume that each individual x astores the input on which the dl system misbehaves in its second member x.m2.
we define the outer frontier of misbehaviours assout x.m2 x a and the inner one as sin x.m1 x a .
the radius measures the average distance of inputs in the frontier from the reference input an elementary nominal input that the system is expected to handle correctly by the requirements radius s m sdist m s for mnist we considered as reference image the corresponding digit in freestyle script font converted to the same format as the mnist dataset.
for beamng the reference sample is a straight road with no curves.
we also evaluated hq s vs lq s frontiers qualitatively by involving humans in a survey in which they performed pairwise comparisons between images taken from the two frontiers i.e.
one image from hq s and one from lq s frontier .
human assessment for the qualitative assessment of hq s vs lq s frontiers we provided human evaluators with two images taken respectively from each of the two frontiers.
for mnist we asked them to decide which of the two digit images is easier to recognise.
for beamng we asked them to decide which of the two roads is easier to drive.
each pair of inputs was assessed by two human evaluators.
then we measured the number of answers in which both subjects agreed in considering as easier to recognise drive the element on the frontier of hq resp.
lq .
this would support our conjecture that manual inspection of the frontier is an effective way to discriminate between good and poor performanceesec fse november sacramento california united states vincenzo riccio and paolo tonella dl systems.
for each system we published 10surveys made of questions 9discriminative questions dsq and 1attention check question acq consisting of a pair of inputs for which the human choice is obvious and completely predictable.
each survey made of 10questions was answered by 2evaluators.
in total this assessment involved 40different evaluators i.e.
20for each system.
rq3 comparison isdeepjanus able to characterise the frontier of the behaviours better than the state of the art tool dlfuzz ?
dlfuzz is a state of the art tool for the generation of boundary values by means of fuzzing.
among the techniques proposed in the literature dlfuzz is the most related to deepjanus since it produces boundary inputs by manipulation of existing seeds.
dlfuzz uses gradient ascent optimisation to maximise a custom loss function that takes also into account the distance between the new input and the seed.
it should be noticed that dlfuzz is not a model based input generator as it operates directly on the raw input i.e.
image pixels .
hence its boundary inputs are supposedly less realistic and less representative than deepjanus .
metrics we compare the radius as defined above of deepjanus frontier w.r.t.
dlfuzz s boundary inputs.
.
experimental procedure our experimental procedure consists of generation of the frontiers for the dl systems under test mnist hq lq beamng hq lq and computation of the radius for the generated frontiers generation of boundary inputs using dlfuzz and comparison with deepjanus s frontiers human assessment of the inputs in the frontiers by means of two surveys a digit recognition survey for rq1 and a pairwise image comparison survey for rq2 .
generation of the frontier with deepjanus we ran deepjanus 10times on each version of each system under test.
at the end of the runs we collected the values of the radius metric as well as the representation of the input pairs that belong to the frontiers.
the configurations of deepjanus were obtained in a few preliminary runs and are reported in table .
before each run we obtained a different set of initial seeds by sampling the inputs under the constraint that they have to produce a correct behaviour of the systems under test.
for mnist each set of seeds was obtained by randomly selecting 100correctly classified inputs from the mnist test set all belonging to the same class digit .
similar results have been obtained for digits other than five but we do not report them for space reasons.
for beamng each initial set consisted of 12valid seed roads on which the considered model was able to keep the lane.
a seed road was defined by 10control points in which the initial point was always at a fixed position whereas the others were placed at a random position meters away from the previous one.
generation of boundary inputs with dlfuzz we generated boundary inputs for mnist using dlfuzz starting from the same seeds used by deepjanus .
however we could not consider beamng in the comparison because dlfuzz is not able to test a system in the simulation loop on a sequence of images.
it can only evaluate the output of the dnn component on a single statically collected image which is fuzzed by the tool.
this means that it is not possible to simulate out of bound episodes which would require a sequence of images to be fuzzed dynamically.
we adoptedtable deepjanus configurations parameter mnist beamng population size generations mutation lower bound .
mutation upper bound .
archive threshold ta repopulation upper bound parameter kof fitness function f1 .
.
thedlfuzz configuration that is reported as the one achieving the best performance .
human assessment of the frontier we outsourced our surveys to a crowdsourcing platform in order to have a diverse pool of respondents .crowdsourcing has recently become quite popular in software engineering to automate tasks that can only be performed by humans.
a problem is specified in the form of small human intelligence tasks hits and made available in a crowdsourcing platform where registered workers can choose to complete hits for a small remuneration .
we selected the amazon mechanical turk platform8for our two surveys resp.
for rq1 and rq2 because it is well known well documented and widely used to gather qualitative feedbacks .
we applied two methods to ensure the quality of the answers added an attention check question acq to each survey see above and restricted the participation to workers with high reputation above approval rate .
we only accepted answers from users that passed the acq.
results .
rq1 effectiveness table reports the intersection between the input validity domain and the outer frontier of behaviours for each version of the considered systems.
the upper part of the table reports the results for the mnist system.
as shown in the first two rows out of the images generated by deepjanus on mnist hq 69are recognised by the crowdworkers as the digit classes to which the corresponding seeds belong whereas 21are recognised incorrectly.
on the other hand on mnist lq deepjanus generated 82frontier inputs that are recognised correctly by crowdworkers.
this indicates that the frontier of mnist lq has a larger intersection with the set of valid inputs than mnist hq.
the classification performed by the crowdworkers was subjected to the fisher s exact test to determine the statistical significance of the effect of the version hq vs lq on the validity of the frontier inputs.
the p value lower than the usual threshold .05indicates statistical significance of the difference between mnist hq and mnist lq.
the odds ratio indicates that the expected relative proportion of valid vs invalid is much lower in the mnist hq system.
the last column contains the confidence mean standard deviation expressed by the crowdworkers when classifying the images.
the scale is between with min confidence and max exploration of the frontier of behaviours for deep learning system testing esec fse november sacramento california united states table rq1 invalid inputs found at the frontier.
the metrics in the last column are different since the validity domains of mnist and beamng are assessed through system specific metrics i.e.
human assessment confidence and curvature radius respectively object validity number confidence mnist hqvalid .
.
invalid .
.
mnist lqvalid .
.
invalid .
.
p value .394e .48e odds ratio .
effect size .
large object validity number curv.
radius ft beamng hqvalid .
invalid .
.
beamng lqvalid .
.
invalid .
.
p value .787e .52e odds ratio .
effect size .
large confidence .
human assessors had a significantly higher confidence in classifying the valid inputs belonging to the frontier of mnist lq and were more uncertain when recognising valid inputs belonging to the frontier of mnist hq.
this confirms that the frontier of a high quality dl system contains elements that are difficult to classify confidently even for a human.
we assessed the statistical significance of the confidence comparison by applying generalised linear modelling glm .
the dependent variable of the glm model is confidence whereas the independent variable is a numeric encoding of the system hq lq .
the results of the statistical test are a small p value way below .
and a large cohen d effect size i.e.
a large difference between the means normalised by the pooled standard deviation conventionally the threshold for a large cohen d effect size is set to .
.
the lower part of the table shows the results for the beamng system.
as reported in the third column the self driving car equipped with the hq lane keeping assist system goes out of bound misbehaves only on one valid road from the frontier indeed the minimum radius of curvature of this road is greater that the aashto threshold by just .
feet .
instead there is a significant number of valid frontier roads when the car is equipped with the lq system.
the fourth column reports the minimum radius of curvature mean standard deviation .
its values for the roads on the hq frontier are significantly lower than the radius values on the lq frontier.
this confirms that roads in the hq frontier are substantially more difficult or even impossible to drive than those in the lq frontier.
also for the results of beamng we applied the fisher s exact test and glm to assess the statistical significance of the results.
p values indicate statistical significance of the difference between hq and lq with a low odds ratio valid invalid proportion in hq vs lq andtable rq2 top middle discriminating hq from lq by deepjanus dj s inner outer radius and by dlfuzz dlf rq3 bottom comparing deepjanus vs dlfuzz inner radius outer radius djmnisthq .
.
.
.
lq .
.
.
.
p value .96e .61e effect size .
large .
large beamnghq .
.
.
.
lq .
.
.
.
p value .8e .34e effect size .
large .
medium dlf mnisthq .
.
lq .
.
p value .
effect size .
small dj vs dlf hq p value .14e effect size .
large dj vs dlf lq p value .25e effect size .
large a large cohen d effect size large normalised difference between minimum curvature radii .
summary many elements at the frontier of behaviours identified by deepjanus intersect the input validity domain when the quality of the system under test is low.
for a high quality system the valid inputs at the frontier are challenging to handle even for humans mnist case study or are very close to being invalid beamng case study .
.
rq2 discrimination the top rows of table show the inner outer frontier radii returned by deepjanus for the systems under test mean standard deviation .
for each system under test we compare the values of the frontier radii obtained for hq vs lq to understand if the frontier volume can help discriminate between different quality levels.
we assessed the statistical significance of this comparison by applying glm with radius as dependent variable and the quality of the system hq lq as independent variable.
for mnist the radius for the lq version of the system is significantly smaller than the one of the hq version with low p value and large cohen d effect size .
this means that on average the higher quality system tolerates larger changes to input images before exhibiting a misbehaviour.
similarly for beamng the radius for the lq version of the system is significantly smaller than the one of the hq version with low p value and large medium cohen d effect size resp.
for inner outer radius showing again that the frontier can discriminate the hq version from the lq one.esec fse november sacramento california united states vincenzo riccio and paolo tonella table rq2 human discrimination of lq from hq based on frontier inputs mnist easier to recognise digit beamng easier to drive road object lq hq disagree p value p success mn ist .2e .
beamn g .152e .
table shows the results obtained from the crowdsourced survey on the discrimination of easier to recognise digits and easier to drive roads.
in the lq column it reports the number of answers in which both crowdworkers comparing the same pair of images agreed in considering as qualitatively easier to classify drive the input on the frontier produced by the lq system.
the hq column reports the number of answers in which both subjects agreed in considering as qualitatively easier to classify drive the input on the hq frontier.
the next column reports the number of cases in which the two subjects did not agree with each other.
crowdworkers were able to determine the relative quality of the systems by looking at the inputs on their frontiers with very high accuracy.
in fact the large majority for mnist and for beamng of inputs found by deepjanus on the outer frontier of the lq system are perceived as qualitatively easier to classify drive than those of the hq systems.
statistical significance of the classification performed by the users was assessed by applying the binomial exact test .
the returned p values for mnist and beamng are very low showing that the choice between lq frontier input and hq frontier input as the easier to classify drive is very unlikely to be random and uniform i.e.
.
summary the frontier of behaviours allows developers to discriminate a system with higher from one with lower quality the radius is significantly larger for the former.
a larger frontier means that the system is able to generalise correctly the learned behaviour to a larger set of valid input data.
this is confirmed by the human study where inputs from the larger frontier were deemed to be more difficult to handle than those from the smaller frontier.
.
rq3 comparison in order to address rq3 we compare the frontier identified by our approach with the boundary inputs returned by dlfuzz .
the middle part of table shows the radius of the outer boundary inputs returned by dlfuzz for the mnist classifier inner boundaries are not returned by dlfuzz .
we can notice that differently from the frontier produced by deepjanus the boundary inputs of dlfuzz do not exhibit any statistically significant difference between hq and lq s frontier radius high p value .
.
actually the difference between the radii seems to go in the opposite direction than in the case of deepjanus negative small effect size .
this indicates that dlfuzz cannot reliably discriminate hq from lq by generating a larger frontier for the former than for the latter.
figure seed and frontier images generated respectively by deepjanus and dlfuzz the starting seed is the same figure a pair of inputs at the frontier of the beamng system top .
the left input triggers a misbehaviour i.e.
the car goes out of bounds as depicted in the bottom picture as reported in the lower part of table for both lq and hq the radius of the frontiers identified by dlfuzz is always significantly smaller than the radius of deepjanus .
this indicates that deepjanus can explore the frontier more thoroughly than dlfuzz.
indeed dlfuzz applies small perturbations to the pixels of the input image that cause the classifier to fail but it does not attempt to explore the input space thoroughly by promoting diversity when new inputs are generated the only way to promote diversity in dlfuzz is by selecting different initial seeds at each run which we did in our experiments .
on the contrary deepjanus is guided by a fitness function f1 that accounts explicitly for the sparseness of the generated inputs hence exploring the behavioural space more thoroughly.
as a consequence the inputs generated by dlfuzz are closer to the reference than the ones produced by deepjanus .model based exploration of the frontier of behaviours for deep learning system testing esec fse november sacramento california united states from a qualitative point of view the boundary inputs found by dlfuzz are quite different from those found by deepjanus as apparent from fig.
.
in fact the same seed is manipulated as a shape of calligraphic traits modelled in svg by deepjanus two rightmost pictures in fig.
while raw pixel manipulation is performed by dlfuzz leftmost pictures .
the images generated by deepjanus simulate quite realistically the traits that can be found in a hand written digit while dlfuzz s images look like blurred noisy versions of the original ones.
as regards the steering angle prediction task we cannot perform a direct comparison with existing techniques.
in fact existing modelbased techniques can find system failures but do not aim at finding frontier inputs as shown at the top of figure .
instead techniques that perform raw data manipulation just manipulate individual camera images and test the steering angle predictor in isolation.
thus they cannot assess whether an incorrect prediction causes an out of bound episode as the one shown at the bottom of figure .
summary deepjanus explores a significantly larger frontier than dlfuzz.
the images produced by deepjanus for mnist look more realistic than those of dlfuzz.
.
threats to validity construct validity the choice of the reference input for the computation of the radius in a given domain is conventional.
we have tried different choices of in both domains mnist and beamng and found that the experimental results reported in section are not sensitive to the specific choice of the same conclusions were drawn when a different choice of was made.
the choice of the distance metrics is also crucial.
we did not fine tune the metrics for the case study domains but we adopted metrics that have been used in previous studies from the literature i.e.
we used euclidean distance when comparing matrices of grayscale values mnist and levenshtein distance when comparing sequences of road points beamng .
finally the eval function called within our fitness function f2is also domain specific.
also in this case we chose sound metrics that have been already adopted in the literature i.e.
confidence of digit classification and distance from the center of the road.
external validity the choice of subject dl systems is a possible threat to the external validity .
to mitigate this threat we chose two diverse dl systems.
one is a dnn that solves a classification problem while the other is a self driving car equipped with a dnn component that solves a regression problem.
however our results might not generalise to other dl systems and further studies with a wider set of systems should be carried out to fully assess the generalisability of our findings.
to ensure reproducibility of our results the source code of deepjanus our objects and the experimental data are available online making the evaluation repeatable.
related work raw input data manipulation several works generate test inputs for dl systems by applying perturbations to the availabletraining test data.
these approaches aim at generating inputs that trigger inconsistencies between multiple dl systems or between the original and a transformed test input .
they require white box access to the activation levels of the dnn if they are guided by coverage criteria such as neuron coverage or the more fine grained k multisection neuron coverage .
one of the limitations of these approaches is the lack of realism of the generated inputs.
while these corrupted images are useful for security testing as adversarial attacks they are not representative of data captured by sensors of a real dl system.
to generate realistic inputs we adopted a model based approach which ensures that data are generated only within the constraints of the model.
another limitation of the existing input generators is that they do not attempt to delimit the region of misbehaviour but they just provide a way to sample it regardless of the distance from the region of nominal behaviour.
on the contrary we sample the entire frontier of misbehaviours as thoroughly as possible.
kim et al.
designed a test adequacy criterion named surprise adequacy to capture the novelty of the input with respect to the training data.
however it has been used for test case selection and retraining but not for test input generation.
moreover a surprise adequate test set is not necessarily one that covers also our frontier of misbehaviours so we view the two approaches as complementary.
model based input generation abdessalem et al.
combine genetic algorithms and machine learning to test advanced driver assistance systems in an industrial setting.
gambi et al.
propose asfault a search based approach to test the lane keeping system of self driving cars.
the goal of these techniques is to generate extreme and challenging scenarios maximising the number of detected system failures.
deepjanus is also model based but it differs from existing approaches because it aims at reaching the frontier without surpassing it and because it spreads the generated inputs along the frontier.
its output is not just a set of critical inputs it is also a thorough characterisation of the frontier of behaviours.
conclusions and future work deepjanus characterises the quality of a dl system as its frontier of behaviours i.e.
pairs of similar inputs that trigger different behaviours of the system and are far from each other.
experimental results show that frontier inputs provide the developers with both quantitative and qualitative information useful to assess the quality of a dl system and to identify valid inputs that it cannot handle properly.
our empirical study shows that deepjanus is more effective in characterising the frontier of behaviours than the state of the art tool dlfuzz.
in our future work we plan to extend the validity of our results by considering a wider sample of dl systems with increasingly complex input domain including industrial ones.