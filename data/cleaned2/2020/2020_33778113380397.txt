a comprehensive study of autonomous vehicle bugs joshua garcia yang feng junjie shen sumaya almanee yuan xia and qi alfred chen university of california irvine california usa nanjing university nanjing china joshug4 yang.feng junjies1 salmanee yxia11 alfchen uci.edu abstract self driving cars or autonomous vehicles a vs are increasingly becoming an integral part of our daily life.
about corporations are actively working on a vs including large companies such as google ford and intel.
some a vs are already operating on public roads with at least one unfortunate fatality recently on record.
as a result understanding bugs in a vs is critical for ensuring their security safety robustness and correctness.
while previous studies have focused on a variety of domains e.g.
numerical software machine learning and error handling concurrency and performance bugs to investigate bug characteristics a vs have not been studied in a similar manner.
recently two software systems for a vs baidu apollo and autoware have emerged as frontrunners in the opensource community and have been used by large companies and governments e.g.
lincoln v olvo ford intel hitachi lg and the us department of transportation .
from these two leading a v software systems this paper describes our investigation of commits and a v bugs and introduces our classification of those bugs into root causes bug symptoms and categories of software components those bugs often affect.
we identify major findings from our study and draw broader lessons from them to guide the research community towards future directions in software bug detection localization and repair.
keywords bugs defects autonomous vehicles empirical software engineering acm reference format joshua garcia yang feng junjie shen sumaya almanee yuan xia and qi alfred chen .
.
a comprehensive study of autonomous vehicle bugs.
in icse international conference on software engineering may seoul south korea.
acm new york ny usa pages.
introduction self driving cars or autonomous vehicles a vs are increasingly becoming an integral part of our daily life.
for example a vs are under rapid development recently with some companies e.g.
google yang feng is the corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee pro vided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
icse may seoul republic of korea association for computing machinery.
acm isbn .
.
.
.
already serving customers on public roads .
in total there are already about corporations actively developing a vs .
a vs consist of both software and physical components working jointly to achieve driving automation in the physical world.
unfortunately like any system relying upon software they are susceptible to software bugs.
as a result faults or defects in such software are safety critical possibly leading to severe injuries to passengers or even death.
for instance an a v of uber has already killed a pedestrian in .
a vs with lower levels of autonomy have resulted in another set of fatalities during recent years .
given the safety criticality of such vehicles it is imperative that the software controlling a vs have minimal errors.
unfortunately the nature of a v software bugs is currently not well understood.
it is unclear what the root causes of bugs are in a v software the kinds of driving errors that may result and the parts of a v software that are most often affected.
these kinds of information can aid a v software researchers and engineers with the creation of a v bug detection and testing tools the localization of faults that result in a v bugs recommendations or automated means of repairing a v bugs measurement of the quality of a v software and mechanisms to monitor for a v software failures.
previous empirical studies have investigated bug characteristics in a variety of domains including numerical software libraries machine learning libraries concurrency bugs performance bugs and error handling bugs .
none of these studies have focused on bugs in a v software systems.
this paper presents the first comprehensive study of bugs in a v software systems.
currently there are two a v systems that achieve high levels of autonomy and have extensive issue repositories i.e.
baidu apollo and autoware .
both of these systems have representative designs and are practical for baidu apollo its design is selected by udacity to teach start of the art a v technology can be directly deployed on real world a vs such as lincoln mkz and has already reached mass production agreements with v olvo and ford .
for autoware it is an open source system for a vs run by the autoware foundation whose members include a variety of industrial organizations including intel hitachi lg and xilinx.
recently autoware has been selected by the usdot us department of transportation to build their reference development platform for intelligent transportation solutions .
we have studied a v bugs from commits across the apollo and autoware repositories.
from a manual analysis of these bugs and commits we have identified root causes symptoms the bugs can exhibit and categories of a v software components that exhibit a significant amount of bugs.
we further assess the relationships among the three phenomena.
based on these results ieee acm 42nd international conference on software engineering icse icse may seoul south korea trovato and tobin et al.
we suggest future research directions for software testing analysis and repair of a v systems.
this paper makes the following contributions we conduct the first comprehensive study of bugs in a v systems through a manual analysis of a v bugs from commits in the two dominant a v open source software systems.
we provide a classification of root causes and symptoms of bugs and the a v components these bugs may affect.
we discuss and suggest future directions of research related to software testing and analysis of a v systems.
we make the resulting dataset from our study available for others to replicate or reproduce or to allow other researchers and practitioners to build upon our work.
our artifacts can be found at the following website .
the rest of the paper is organized as follows.
the next section provides further background on a v software systems.
section discusses the methodology we use to conduct our study the root causes symptoms and affected components we identified and overviews and motivates the research questions we investigate.
we then cover the results of our empirical study section follow that with a discussion drawing broader lessons from those results section and detail threats to validity section .
finally we describe related work section and conclude.
autonomous vehicle systems the society of automotive engineers sae defines levels of vehicle autonomy with level l0 being the lowest i.e.
no autonomy and level l5 being the highest i.e.
full autonomy in any driving environment.
level l4 is the highest autonomy level for which no human drivers are required to stay alert and ready to take over control anytime the system cannot make driving decisions.
compared to l5 l4 s autonomy is limited to certain driving scenarios e.g.
certain geofenced areas but it is already enough to enable a number of attractive use cases in practice such as highway driving truck delivery and fixed route shuttles while being easier to ensure safety than l5.
thus nearly all a v companies aiming for high level autonomy are focusing on l4 a v development e.g.
google uber lyft baidu gm cruise ford aurora tusimple etc.
and some of them are already available to the general public e.g.
the google waymo one self driving taxi service .
in this work we focus on l4 a v systems since they have the highest autonomy level among the a vs in production today and thus their software bugs and defects have the highest importance in terms of safety and robustness.
in l4 a v systems software plays a central role to achieve intelligent driving functionality.
for example fig.
shows the general a v software system architecture based on state of the art designs referenced in most popular a v development classes such as udacity selfdriving car engineer classes and used in representative realworld a v systems such as baidu apollo and autoware .
as shown such a software system is in charge of all the core decisionmaking steps after receiving sensor input.
detailed functionality of each component in an a v software system is as follows perception processes lidar camera and radar inputs and detects obstacles such as vehicles and pedestrians.
a v systems often adopt multiple object detection pipelines to avoid false detection.
for example baidu apollo consists of a camera based and alidar based object detection pipeline which uses segmentation models based on convolutional neural networks cnns .
the detected obstacles from different pipelines are then fused together using algorithms such as a kalman filter.
aside from detecting obstacles the perception component is also in charge of traffic light classification and lane detection.
localization provides an estimation of the a v s real time location which serves as the basis for driving decision making.
it accepts location measurements from gps and lidar.
particularly a lidar point cloud matching algorithm e.g.
ndt and icp finds the best match of the lidar input in a pre built high definition map hd map to get the lidar based location measurement.
it then uses a multi sensor fusion algorithm e.g.
error state kalman filter to fuse location measurements.
prediction estimates the future trajectory of the detected obstacles.
neural networks e.g.
mlps and rnns are commonly used to evaluate the probabilities of the possible trajectories.
planning calculates the optimal driving trajectory considering factors such as safety speed and comfort.
it incorporates various constraints e.g.
distances to obstacle trajectories distance to lane center smoothness of the trajectory etc.
and solves a linear programming lp or quadratic programming qp problem to calculate the future trajectory that the a v needs to follow.
control enforces the planned trajectory with lateral and longitudinal control.
it uses control algorithms such as mpc and pid to calculate the required steering and throttling.
can bus handles the underlying communication between the software and the vehicle to send control commands and receive chassis information.
infrastructure provides the necessary utilities andtools for the software such as sensor calibration tools and cuda .
it also includes a robotics middleware e.g.
ros cyber rt which supports the communication among components.
high definition map hd map is queried during runtime for information such as lane boundaries traffic sign locations stationary objects routing etc.
some a v systems such as baidu apollo use a centralized component called map engine to handle the queries while others such as autoware handle the map queries separately in each module.
human machine interface hmi collects and visualizes system status and interfaces with developers and passengers.
this is not required for the autonomous driving function but real world a v software systems e.g.
those in both apollo and autoware generally have it for usability.
methodology and classification .
data collection we collect all commits issues pull requests of apollo and autoware that are created on or before july via the g ithubapis as shown in table .
in total we obtain 335commits 414closed pull requests and 216issues for apollo and collect 516commits closed pull requests and issues for autoware.
given that the goal of this paper is to characterize defects of a v systems we identify closed and merged pull requests that fix defects.
such pull requests allow us to confirm that a bug or fix was 386a comprehensive study of autonomous vehicle bugs icse may seoul south korea perception e.g.
object det.
trk.
data fusion localization e.g.
lidar locator sensor fusion prediction e.g.
future obstacle traj.
planning e.g.
moving traj.
planning control e.g.
lat.
long.
control can bus e.g.
send recv can msg.
hmi e.g.
monitoring gui hd map e.g.
road structure routing lidar radar camera gps imuwheel brake gas infrastructure e.g.
ros cyber rt utilities tools autonomous vehicle software system figure state of the art autonomous vehicle a v software system architecture from most popular a v development classes such as udacity self driving car engineer classes and real world a v systems such as baidu apollo and autoware .
accepted by developers and analyze the modified source code related issues and the discussion of developers.
note that on g ithub pull requests are used for various purposes e.g.
new feature implementation enhancement and refactoring .
to categorize the purpose of pull requests developers often employ some keywords to tag them.
however because tagging is often project specific directly filtering bug fix pull requests based on the tag may introduce bias.
to avoid such bias we employ a method that helps us to obtain as many bug fix pull requests as possible.
to that end we adopt a method similar to that used in previous studies to identify bug fix pull requests.
specifically we set up a list of bug related keywords including fix defect error bug issue mistake incorrect fault and flaw and then search for these words in both the tags and titles.
if any tags or title of a pull request contain at least one keyword we identify it as a bug fix pull request.
this process resulted in336and430merged pull requests for apollo and autoware that meet the criteria respectively.
table statistics of apollo and autoware from github system start date end datesloc1 c c sloc python commits issues bugs apollo autoware 1sloc source lines of code .
classification and labeling process to characterize a v defects we focus on analyzing them from three perspectives the root causes that reflect the mistakes developers make in code the symptoms that bugs exhibit as represented by incorrect behaviors failures or errors during runtime and the a vcomponent in which a bug resides.
our manual analysis focused on merged pull requests because these types of issues contain the code changes discussions links to related issues code reviews and other information that can assist us with gaining a comprehensive understanding of bugs and their fixes.
to reduce the subjective bias during the labeling process we assign each of the and merged bug fix pull requests identified in the data collection step to two authors of this paper.
our process required each set of two authors to analyze the defect separately.
they manually inspected the source code commit messages pullrequest messages and issue messages to identify the root causes symptoms and affected a v components.
prior research has summarized the causes of software defects and bugs .
in this paper we initially adopted the taxonomyof root causes presented in to analyze a v defects.
we then enhanced that taxonomy by using an open coding scheme to expand the list of root causes.
specifically for pull requests whose root causes did not fit into the initial taxonomy each author conducting the manual analysis selected her own label for the root cause.
once all the author s pull requests were labeled she met with the author sharing her assigned pull requests to resolve differences in labeling.
for bug symptoms we followed a similar process starting with an initial taxonomy of symptoms e.g.
crash and hang derived from existing literature .
we found multiple symptoms may arise per bug cause.
a single issue may have multiple bug symptoms.
bugs may be counted twice if they fall under two different categories.
for a v components labels were stable for top level components e.g.
planning and localization .
however certain sub components appeared frequently e.g.
object detection and multi sensor fusion .
as a result for a v components we also had authors meet to resolve discrepancies in labeling.
using this overall process resulted in a final list of bugs in apollo and bugs in autoware.
multiple issues may be mapped to the same pull request root cause symptom and component.
if we remove these duplicate issues we have bug instances for autoware instead of .
.
root causes of a v bugs using the process described in the previous section the full list of root causes for a v bugs are as follows incorrect algorithm implementation alg the implementation of the algorithm s logic is incorrect and cannot be fixed by addressing only one of the other root causes.
incorrect numerical computation num this root cause involves incorrect numerical calculations values or usage.
incorrect assignment assi one or more variables is incorrectly assigned or initialized.
missing condition checks mcc a necessary conditional statement is missing.
data the data structure is incorrectly defined pointers to a data structure are misused or types are converted incorrectly.
misuse of an external interface exter api this cause involves misuse of interfaces of other systems or libraries e.g.
deprecated methods incorrect parameter settings etc.
misuse of an internal interface inter api this cause involves misuse of interfaces of other components such as mismatched calling sequences violating the contract of inheritance and incorrect opening reading and writing.
incorrect condition logic icl this occurs due to incorrect conditional expressions.
387icse may seoul south korea trovato and tobin et al.
concurrency conc this cause involves misuse of concurrencyoriented structures e.g.
locks critical regions threads etc.
.
memory mem this cause involves misuse of memory e.g.
improper memory allocation or de allocation .
invalid documentation doc this cause involves incorrect manuals tutorials code comments and text that is not executed by the a v system.
incorrect configuration config this cause involves modifications to files for compilation build compatibility and installation e.g.
incorrect parameters in docker configuration files .
other ot causes occur highly infrequently and do not fall into any one of the above categories.
.
symptoms of a v bugs using the process described earlier in this section we obtained the following a v bug symptoms crashes terminate an a v system or component improperly.
hangs are characterized by an a v system or component becoming unable to respond to inputs while its process remains running.
build errors prevent correct compilation building or installation of an a v system or component.
display and gui dgui errors show erroneous output on a gui visualization or the hmi of the a v system.
camera cam errors prevent image capture by an a v camera.
stop and parking stop errors refer to the incorrect behaviors occurring when the a v attempts to stop or park the vehicle e.g.
sudden stops at inappropriate times failure to stop in emergency situations and parking outside of the intended parking space .
lane positioning and navigating lpn errors involve incorrect behaviors shown in lane positioning and navigating e.g.
failing to merge properly into a lane and failing to stay in the same lane .
speed and velocity control svc symptoms involve incorrect behaviors related to the control of vehicle speed and velocity e.g.
failure to enforce the planned velocity and failing to follow another vehicle at high speed .
traffic light processing tlp errors represent any incorrect behaviors involving handling of traffic lights.
launch lau symptoms occur when an a v system or component fails to start.
turning turn symptoms occur when an a v behaves incorrectly when making or attempting to make a turn e.g.
turning at the wrong angle and problems with turn signals .
trajectory traj symptoms involve incorrect trajectory prediction results e.g.
incorrect trajectory angles or predicted paths .
ioerrors involve incorrect behaviors when performing inputs or outputs to files or devices.
localization loc errors refer to incorrect behaviors related with multi sensor fusion based localization and may manifest as incorrect information on a vehicle s map.
security safety ss symptoms involve behaviors affecting security or privacy properties e.g.
confidentiality integrity or availability damage to the vehicle or injury to its passengers.
obstacle processing op errors occur when a vs incorrectly process detected obstacles on the road e.g.
failure to correctly estimate distance from an object .
logic errors represent incorrect behaviors that do not terminate the program or fit into the aforementioned symptom categories.
documentation doc symptoms include any errors in documentation including manuals tutorial code comments and other text intended for human rather than machine consumption.
unreported un symptoms cannot be identified by reading issue discussions or descriptions source code or issue labels.
other ot symptoms occur highly infrequently and do not fit into the above categories.
.
affected a v components after the aforementioned labeling process the following a v components described in section had a significant amount of bugs perception localization prediction hd map planning control and can bus.
both systems structure directories into components shown in figure and share the same reference architecture.
table shows other core components found to have a significant number of bugs after the labeling process was completed.
table additional core components with significant bugs component description sensor calibration checks adjusts or standardizes sensor measurements drivers contains the hardware drivers necessary for operating the a v robotics mw contains robotics middleware utilities tools contains shared functionality that supports the core functionality of other components docker contains the docker image housing an instance of the a v system documentation othersa catch all component category for representing documentation and sub components with secondary functionality that have few bugs and do not fit into other components.
perception localization and can bus components had major sub components with significant amounts of bugs.
table depicts those sub components.
table a v sub components with significant bugs component sub component description perceptionobject detection identifies objects around the a v object tracking tracks object around the a v data fusion fuses data from different object detection pipelines localizationmulti sensor fusionfuses location measurements lidar locator obtains location measurements from lidar can busactuation handles can bus operations involving vehicle actuation communication handles general can bus transmission and receipt of data monitor tracks information exchanged across the can bus .
research questions to conduct our study we answer the following research questions that are concerned with root causes of a v bugs the symptoms they exhibit and the components affected by a v bugs.
previous work that has extensively studied different types of bugs in other application domains have discussed different causes of bugs.
understanding such causes can aid in localizing a fault and is 388a comprehensive study of autonomous vehicle bugs icse may seoul south korea necessary for creating correct fixes of bugs.
consequently we study the following research question rq1 to what extent do different root causes of av bugs occur?
the effects of the bugs themselves are critical for triaging them and assessing their impacts.
in particular the domain specific symptoms of bugs in this case as they involve a vs are of special interest in this study.
as a result we study the following research question rq2 to what extent do different av bug symptoms occur?
the kind and frequency of bug symptoms and their root causes are a first step toward better understanding bugs in a v systems.
however the extent to which a particular root cause may produce a specific symptom allows engineers to determine more actionable information as to how to address a bug.
this leads us to study our next research question rq3 what kinds of bug symptoms can each root cause produce?
the reference architecture of an a v system allows us to better understand the manner in which functionality and processing is decomposed into components of a software system.
certain components may be more prone to bugs or are more important than others for bug identification and repair.
this information further allows researchers to know which parts of an a v system require further effort in terms of predicting detecting and repairing bugs.
thus we investigate the following research question rq4 to what extent do av components contain bugs?
closely related to rq4 are the specific symptoms that occur in a v components.
understanding the relationship between symptoms of bugs and the a v components they affect allows engineers to allocate more resources e.g.
developer time and effort to the components that exhibit the most critical errors or contain the most risky faults.
due to conway s law i.e.
the structure of a software system often reflects the groups of people working on the system this relationship can also inform managers and technical leads as to how different bug symptoms will affect different teams of an a v system.
rq5 to what extent do bug symptoms occur in av components?
experimental results given the previously described methodology classification and research questions we now discuss our study s results.
.
rq1 root causes we begin discussing experimental results by covering the frequency of a v bugs root causes in apollo and autoware which is depicted in table .
for both a v systems incorrect implementations of algorithms alg and incorrect configurations config are the most frequently occurring root causes bugs are due to incorrect algorithm implementations in apollo and in autoware bugs are caused by incorrect configurations in apollo and in autoware.
for incorrect algorithm implementations repairing their resulting errors often requires non trivial and extensive code modifications potentially affecting many lines of code i.e.
lines of code on average .
as a result localizing faults in these cases or automatically repairing them are likely to be highly challenging .table root causes of bugs in a v systems root cause apollo autoware total cause algorithm alg numerical num assignment assi missing condition checks mcc data external interface exter api internal interface inter api incorrect condition logic icl concurrency conc memory mem incorrect documentation doc incorrect configuration config others total system finding incorrect algorithmic implementations often involving many lines of code cause .
of a v bugs.
incorrect configurations which involve building compilation compatibility and installation receive a very high amount of attention in open source a v systems.
they are particularly frequent in autoware with such bugs occurring.
this result indicates that configuring compiling ensuring compatibility and enabling installations of a v systems is highly challenging and deserves greater attention by the software engineering research community.
finding incorrect configurations causes a substantial number of a v bugs i.e.
.
of such bugs.
root causes of a v bugs that occur a relatively frequent amount but much less frequently than alg config or doc causes are those involving improper assignments or initializations assi incorrect condition logic icl numerical issues num and missing condition checks mcc with each category occurring a total of and respectively across both systems.
these kinds of root causes typically involve a relatively small number of lines of code e.g.
lines or less and are more amenable to existing fault localization and automatic program repair techniques .
finding root causes of bugs involving relatively few lines of code i.e.
or fewer lines cause .
of bugs.
.
rq2 a v bug symptoms the next research question we discuss covers the symptoms that a v bugs exhibit.
table shows the types of bug symptoms we identified that occur for apollo and autoware.
symptoms specific to the domain of a vs mainly involve errors related to driving navigating or localizing the vehicle itself or perceiving the environment around the vehicle.
in total these bug symptoms have instances across both a v systems and specifically include the following types of symptoms lane positioning and navigation speed and velocity control traffic light processing vehicle stopping turning trajectory and localization and obstacle processing.
it is notable that apollo s bugs exhibit significantly more of these types of symptoms.
however this does not necessarily indicate that apollo has more driving bugs than 389icse may seoul south korea trovato and tobin et al.
autoware.
apollo developers may focus more on identifying and fixing these kinds of bugs than autoware developers.
table symptoms of bugs in a v systems symptom apollo autoware total symp crash hang build camera cam lane positioning and navigation lpn speed and velocity control svc launch lau traffic light processing tlp vehicle stopping and parking stop vehicle turning turn vehicle trajectory traj io localization loc obstacle processing op invalid documentation doc display and gui dgui security and safety ss logic unreported un others ot total system among the driving bugs the symptoms that occur most frequently involve speed and velocity control trajectory and lane positioning and navigation with and total instances across both systems respectively.
these results indicate that these kinds of functionality are difficult to implement correctly.
at the same time they are also among the core functionality one would expect an a v to perform and are inherently safety critical.
for example the following bug description was extracted from one of autoware s issues where one developer noticed an unexpected behaviour of the steering control and velocity plan1 correction of angular velocity plan at the waypoint end...at the waypoint end point the steering angle control becomes unstable software testing bug detection and localization and automatic repair for such a v bugs would likely be highly beneficial for the a v development community.
finding .
of bugs directly affect driving functionality of a vs with speed and velocity control trajectory and lane positioning and navigation occur the most frequently at .
.
and .
respectively.
among the types of symptoms in our classification the one that appears the most are actually build errors with in the case of apollo and in the case of autoware.
autoware bugs resulting in build errors largely involve changes to upstream components.
for instance new versions of ros are released requiring major changes to ensure compatibility in autoware.
moreover the build error differences might be related to the underlying build systems used by and autoware.
in particular autoware uses the native ros build system which reuses the cmake syntax when specifying the compilation configurations.
apollo on the other hand adopts the newer bazel build system developed by google.
however given that both autoware and apollo are built on top of robotics middleware e.g.
ros or cyber rt an interesting direction for future work includes determining what aspects of autoware s design or the developers decision making processes result in them making such extensive updates.
bugs that crash an a v software system occur relatively frequently as well with occurrences across both a v systems.
note that the bug reports that specify these crashes rarely indicate whether or not they may directly affect the safe operation of the a v on a road.
as a result it is not clear that these crashes are necessarily safety critical.
for example the reports do not identify whether the bugs would result in the vehicle stalling being unable to move stuck accelerating etc.
one interesting future research direction is determining the extent to which a v crash bugs result in safety or security critical errors.
logic errors occur frequently with instances in total for both a v systems.
often there is no indication that there are any runtime errors that necessarily occur for the bugs reporting logic errors.
however developers for this symptom often report that there is enough potential for a runtime error occurring in the future.
display or gui errors are another frequent and notable type of symptom that occurs in both a v systems totalling instances.
apollo and autoware each provide simulations or guis to allow the user or developer to configure or assess the functionality of an a v .
finding build errors crashes logic errors and gui errors are among the most frequently occurring domain independent errors in a v systems amounting to .
of bugs for build errors .
for crashes .
for logic errors and .
for gui errors.
along the lines of safety and security our explicit category that denotes the number of bugs that are clearly identified as safetyor security oriented only totals .
we found very few instances where the bug reports clearly specify that a particular bug is in fact a definite safety or security issue in either a v system.
in fact many of the aforementioned driving bugs e.g.
speed and velocity control trajectory and lane positioning and navigation are likely to be safety critical.
however we conservatively marked bugs as security or safety issues only if the bug report clearly denotes the bug in question as being safety or security related.
there is significant amount of work that should be conducted to further assess the safety and security properties of a v systems.
finding bugs reported with explicit safety or security symptoms occur highly infrequently constituting only of a v bugs.
.
rq3 causes and symptoms a better understanding of the relationship between root causes symptoms and the frequency at which a particular root cause may produce a specific symptom can guide engineers and researchers working on a vs to prevent detect localize and fix a v bugs.
to that end we examine the results of rq3.
table illustrates the extent to which a particular root cause resulted in a specific symptom across both a v systems.
recall that 390a comprehensive study of autonomous vehicle bugs icse may seoul south korea table frequency of symptoms that each root cause of a bug may exhibit across apollo and autoware.
root causesymptomcrash hang build cam lpn svc lau tlp stop turn traj io loc op doc dgui ss logic un ot algorithm alg numerical num assignment assi missing condition checks mcc data external interface exter api internal interface inter api incorrect condition logic icl concurrency conc memory mem incorrect documentation doc incorrect configuration conf others total incorrect algorithm implementations were the most frequently occurring root cause in our classification scheme.
unsurprisingly that cause resulted in a wide variety of symptoms producing out of of the symptoms in our classification scheme.
this root cause results in many symptoms directly affecting the correct driving of a vehicle i.e.
lane positioning and navigation speed and velocity control traffic light processing stopping and parking vehicle turning and trajectory localization and obstacle processing .
symptoms especially affected by incorrect algorithm implementations include lane positioning and navigation occurrences speed and velocity control occurrences and trajectory occurrences .
this indicates that implementing such algorithms has a high complexity compared to other aspects of a v driving.
other symptoms that occur frequently due to incorrect algorithm implementations include crashes occurrences display and gui errors occurrences and logic errors occurrences .
given that many lines of code i.e.
lines of code on average often need to be added or modified to fix a v bugs arising due to incorrect algorithm implementations a wide variety of a v specific and safety critical bugs are likely to be inapplicable for state of the art fault localization and automatic program repair techniques .
finding incorrect algorithm implementations involving many lines of code caused all types of symptoms that directly affect the driving of a vehicle and caused out of all symptoms in our classification scheme.
the second most frequently occurring cause is incorrect configurations involving compilation building compatibility and installation config as described in section .
.
despite the total number of bugs due to this cause instances being similar to the number for incorrect algorithm implementations instances incorrect configurations only caused out of of the symptoms in our classification schema with a vast majority of those symptoms being build errors i.e.
out of .
.
this result further reinforces that simply building or compiling such systems is highly non trivial and can benefit from software engineering research that aids in this process e.g.
bug detection and repair for handling upstream changes .
besides build errors incorrect configurations caused a significant number of crashes inability of components ofthe a v system to launch lau display and gui errors dgui and logic errors.
finding incorrect configurations caused a wide variety of bug symptoms out of with a vast majority resulting in build errors out of .
indicating that properly configuring building and compiling these a v systems is a nontrivial maintenance effort.
recall that bugs caused by incorrect assignments or initializations occurred relatively frequently across both a v systems i.e.
instances out of a total of .
.
this root cause produced out of of the symptoms in our classification scheme.
this cause was particularly prominent for logic errors crashes display and gui errors io errors errors involving speed or velocity control and trajectory errors.
a relatively wide variety and significant amount of such errors may be automatically repaired or at least identified and localized using existing state of the art approaches.
misuse of conditional statements and incorrect condition logic mainly produced errors involving lane positioning and navigation speed and velocity control and crashes.
such root causes also resulted in logic errors that may lead to a future runtime error but did not necessarily occur at the time of the bug report.
fixing these combinations of bugs and symptoms often involve a relatively small number of changes to code i.e.
about lines of code or less making them particularly amenable to existing fault localization and automatic program repair approaches.
finding incorrect assignments of variables conditional statements or condition logic caused out of a v bug symptoms.
concurrency and memory errors are infrequently reported indicating that they also likely occur infrequently in a v systems.
such root causes also had little effect on the actual successful driving of the vehicle with only two instances occurring a concurrency issue and a memory issue caused a bug involving speed and velocity control respectively.
however no other driving symptom arose due to such potentially serious errors.
note that as expected memory errors did cause a reasonable number of crashes i.e.
in our study.
391icse may seoul south korea trovato and tobin et al.
finding concurrency and memory misuse caused relatively few bug symptoms i.e.
out of bugs .
.
.
rq4 bug occurrences in a v components in this section we examine the frequency of bug occurrences in a v components of the reference architecture introduced in section .
table presents the number of occurrences for each top level component as described in sections and or sub component of the perception localization or can bus components for apollo and autoware.
bug occurrences for sub components are shown if a significant number of bugs were found in them.
table frequency of bug occurrences for each a v component component sub component apollo autoware total comp perceptionobject detection object tracking data fusion localizationmulti sensor fusion9 lidar locator trajectory prediction map planning control sensor calibration drivers can busactuation communication monitor robotics mw utilities and tools docker documentation and others total system the number of bugs found in the planning components of the a v systems far exceed that of others totalling bugs out of i.e.
.
of all bugs .
for comparison the second most bugridden component type perception only contains bugs across both systems i.e.
.
of all a v bugs resulting in planning having .
more bugs than perception.
it is reasonable that developers focus a significant amount of their effort on planning because it makes major driving decisions about the safety speed and passenger comfort of an a v .
bugs are generally found in three perception sub components object detection object tracking and data fusion.
the number of bugs in object detection far exceeds the number of bugs found in either object tracking or data fusion .
perception must handle sensor input from a variety of sources e.g.
lidar camera and radar and use complex algorithms e.g.
convolutional neural networks and kalman filters .
the module must also detect obstacles classify traffic lights and detect lanes.
due to this complexity it is sensible for perception to have such a high number of bugs.
following perception in terms of bug occurrences are localization components which account for bugs out of total .
.
localization estimates an a v s real time location basedon a variety of location measurements and fuses them together.
multi sensor fusion and lidar locator sub components each have a similar number of bugs across both systems with instances and instances respectively.
finding the core a v components with the greatest number of bugs across both systems are planning perception and localization ordered from most bug ridden to least with .
.
and .
bugs respectively.
a substantial number of bugs involve functionality that does not provide core logic that fits into the major components as described in section .
out of bugs .
occur in components that provide utilities or tools that support core functionality and are often used by a variety of other components.
for example figure was obtained from one of autoware s issues2and it shows a bug related to the runtime manager which is one of the utilities responsible for starting and terminating autoware s functional components.
this bug prevented the runtime manager parameters from getting saved.
another significant number of bugs are either documentationoriented or occur infrequently and do not fit into other component categories constituting bugs across both a v systems .
.
finding many bugs do not occur in the core domain specific functionality of a v systems constituting bugs .
in the case of utilities and bugs .
involving documentation bugs or bugs that do not occur frequently enough to fall into a major component category.
figure a bug found in one of autoware s utilities.
.
rq5 bug symptoms in a v components the final research question we study relates symptoms of bugs with the a v components they affect.
studying such a relationship allows engineers to better distribute engineering effort and other development resources e.g.
testing budget to the components that exhibit the most bugs or the bug types that are of greatest importance to a v stakeholders.
table illustrates the extent to which different bug symptoms occur in components and sub components across both apollo and autoware.
symptoms involving driving and operation of the vehicle are largely associated with bugs in planning.
specifically out of bugs directly affecting driving of the vehicle of them affect planning.
five particular driving symptoms i.e.
lane positioning and navigation lpn speed and velocity control svc stopping and parking stop vehicle turning turn and trajectory traj that appear particularly frequently in planning constitute of the driving bugs .
.
as an example the following code snippet from apollo illustrates a driving bug in planning3 if init trajectory point .v 392a comprehensive study of autonomous vehicle bugs icse may seoul south korea table occurrences of bug symptoms in components of apollo and autoware component sub componentsymptom crash hang build cam lpn svc lau tfp stop turn traj io loc op doc dgui ss logic un ot perceptionobject detection object tracking data fusion localizationmulti sensor fusion lidar locator prediction map planning control calibration drivers can busactuation communication monitor robotics mw utilities docker documentation others qp spline path config .
uturn speed limit !
is change lane path qp spline path config .
reference line weight .
specifically the first conditional statement ensures that the current speed is less than the speed limit enforced for a u turn.
besides the sheer number of bugs in planning identified in the previous section the symptoms of bugs exhibited in the component indicate its high importance for assuring an a v system with low errors and high quality.
finding planning components have both a high number of bugs and exhibit many symptoms that are particularly important for safe and correct driving of a vs .
of driving bugs .
many bugs that crash a v components occur mainly in perception bugs localization bugs planning bugs and utilities bugs .
the fact that a vs can potentially be crashed substantially through the component that processes sensor inputs i.e.
perception is particularly concerning a skilled malicious adversary with enough time may be able to turn a crash into an attack.
additionally crashing components that let the a v know its position in the environment i.e.
localization or even prevent it from making decisions i.e.
planning may cause the a v to stop functioning think it is somewhere it is not or make dangerous decisions.
finding crash bugs occur throughout critical a v components especially perception localization and planning making them susceptible to more dangerous secondary effects.
build errors affect the overwhelming majority of a v component types i.e.
out of in our classification scheme.
this result further corroborates the non trivial nature of properly building and compiling a v systems providing further evidence that solving and automating this challenge is an open and important research problem.finding build errors affect many components out of .
.
few bug symptoms affect more components or sub components i.e.
more than of components in our classification scheme.
besides crashes and build errors the only symptoms that occur that frequently include speed and velocity control svc display and gui errors dgui and logic errors.
svc bugs in particular span or more components which is quite high for a domain specific symptom focused on a particular type of functionality of a vs. dgui and logic errors are relatively general and not domain specific so their high occurrence across components is less surprising.
finding bugs exhibiting speed and velocity control errors affect a significant number of a v components i.e.
out of components .
.
discussion using the major findings of the previous section we will discuss the larger implications of our study s results.
in particular we will draw lessons from the findings that can guide future work in areas related to software testing analysis and repair of a vs. findings .
and involve incorrect configurations or build errors.
to summarize those findings .
of bugs occur due to incorrect configurations while .
of bugs result in build errors.
incorrect configurations cause a wide variety of symptoms out of and build errors affect many components out of .
this suggests that a major amount of time and effort expended by engineers are spent simply dealing with compatibility and compilation issues upstream changes and ensuring proper installation.
if software engineering research can aid engineers with such a problem this would potentially open up a substantial amount of time 393icse may seoul south korea trovato and tobin et al.
that engineers can spend actually ensuring safe secure and correct autonomous driving functionality.
incorrect algorithm implementations cause many bugs .
of a v bugs often involve many lines of code lines of code on average and cause many symptoms out of including all eight domain specific driving symptoms as corroborated by findings and .
these findings strongly suggest that existing bug localization and repair approaches likely need to be augmented with domain specific information and the ability to conduct repairs that involve many lines of non trivial code.
despite this there is evidence that a significant amount of bugs may be applicable to existing bug detection localization and repair techniques.
specifically bugs involving relatively few lines of code constitute about .
of bugs finding and simpler bugs e.g.
incorrect assignments and condition logic and missing condition checks cause out of a v bug symptoms finding .
these results indicate that our study s dataset consisting of a v bug causes and symptoms would significantly aid researchers with assessing or constructing bug detection localization and repair techniques.
with few bugs being reported that explicitly identify safety and security concerns in a v systems findings it is unclear how safe or secure open source a v systems are.
this strongly indicates the need for researchers to focus more effort on assessing and ensuring these critical properties in a v software.
particularly certain bugs e.g.
crashes in finding may have security and safety implications and should be further explored in future work.
software testing and analysis research for a vs have heavily focused on only a sub component of perception i.e.
object detection .
however our study provides significant evidence that many bugs especially those that most involve actually driving the vehicle occur in many other components findings and especially planning and localization findings and .
with planning having the overwhelmingly largest proportion of bugs .
and affecting out of driving symptoms it is arguable that researchers should focus more on planning than perception.
even in the case of perception object tracking and data fusion two sub components that are not studied in terms of software testing and analysis as far as we are aware constitute .
of bugs in perception while object detection covers the remaining perception bugs.
threats to validity internal threats.
the primary internal threat to validity involves subjective bias or errors in classification of bugs.
to reduce this threat we initiate our labelling process with classification schemes from existing literature and adopt an open coding scheme to assist us in expanding the initial schemes.
to ensure that we focus on real bugs and fixes we selected only accepted and closed issues e.g.
when determining issues related to a pull request or merged and closed pull requests and used bug tags when available.
further each bug is inspected and labelled by two authors independently.
any discrepancy is discussed until a consensus is reached.
when issues pull requests or code were insufficient for facilitating classification into a particular category we assigned the corresponding bug to the ot other category.
we also had discussions with apollo developers about their bugs allowing us to improve our classification reducing subjective bias and error in the process.external threats.
one external threat is the generalizability of the data set we collected.
we have adopted several strategies to mitigate this threat.
first the raw data we collected includes all pull requests commits and issues from the creation of subject a v systems until july .
this strategy assures this study covers a comprehensive set of data.
second we have adopted a method similar to those used in existing bug studies to identify as many bug fix pull requests as possible in the data pre processing step.
third we have only studied the merged pull requests that fix bugs to ensure that the studied bugs as well as their corresponding fixes are accepted by developers.
another threat to external validity is the generalizability of our findings.
we study two a v systems apollo and autoware which are developed by two independent groups.
although there are only two systems in our study they are the most widely used open source a v systems containing over lines of code over commits and more than issues.
additionally these a v systems are used by about corporations and governments including the us government google intel v olvo ford hitachi and lg .
furthermore the number of labeled bugs in this study is similar in size to that of other recent bug studies in other domains e.g.
and for deep learning and for numerical libraries .
given that we focus on l4 a v systems apollo and autoware are the only systems that achieve that high level of autonomy and have extensive as well as publicly accessible issue repositories .
given the high level of autonomy and sizes of data in our study its findings are more likely to be representative and generalizable to other a v software aiming for l4 autonomy.
related work empirical study on bugs.
a great number of work has been conducted that studies bugs in different types of software systems.
franco et al.
studied the bugs that occur in numerical software libraries such as numpy scipy and lapack.
islam et al.
thung et al.
and zhang et al.
investigated machine learning and deep learning frameworks e.g.
caffe tensorflow opennlp etc.
.
leesatapornwongsa et al.
and lu et al.
analyzed concurrency bugs in distributed systems such as hadoop and hbase.
jinet al.
and selakovic et al.
studied performance bugs in large scale software suites such as apache chrome and gcc.
different from this prior work we are the first to perform an empirical study on bugs in emerging a v software systems.
across existing empirical studies bugs are often characterized based on multiple dimensions including bug types root causes and bug symptoms.
some work has categorized bugs using domain specific characteristics such as the triggering of timing conditions for concurrency bugs .
compared to this prior work we apply and adapt these bug characterization methods to bugs in a different domain i.e.
a v software systems.
a v software robustness.
for a vs ensuring the robustness of its software system is the top priority as any software bugs may incur serious damage to both the road entities and the a v itself.
unfortunately many fatal accidents have occurred in recent years due to the lack of software robustness.
for example tesla s autopilot system has been the culprit of several deaths over recent years .
uber s a v system reportedly failed to prevent 394a comprehensive study of autonomous vehicle bugs icse may seoul south korea the crash after detecting the pedestrian seconds before the accident in tempe az .
moreover machine learning models used in a v systems e.g.
in perception have been found vulnerable to attacks e.g.
physical world perturbations or sensor attacks .
compared to these case by case discoveries of a vsystem robustness issues we are the first to systematically collect taxonomize and characterize bugs in a v systems which is a critical first step towards eliminating them in a principled manner.
conclusion a v systems are increasingly operating throughout our daily lives.
given the fact that a v systems are designed for safety critical tasks it is vital that software engineering researchers build robust qualityassurance techniques and methods for them.
in this paper we characterized and taxonomized bugs for a v systems identifying root causes and symptoms across components for bugs from apollo and autoware the only two open source a v systems achieving high levels of autonomy l4 .
both researchers and developers of the a v systems can benefit from this study.
for developers we summarize findings from this study to help them deal with bugs.
for researchers we distill challenges from our findings that call for more research effort.
our findings offer both developers and researchers a principled and improved understanding of a v bugs.
for future work we aim to reproduce bugs we found in this study.
achieving this reproduction requires overcoming numerous research challenges including understanding and specifying driving scenarios in a simulator and controlling it carefully to precisely trigger bugs.
additionally we aim to construct techniques for automatic testcase generation and test oracle construction for a v systems and assessing the degree to which fuzzing search based testing and symbolic execution are applicable to a v software systems.
lastly we are refining our study s results to produce a benchmark dataset for facilitating automatic program repair for a v software systems.
acknowledgement this work was supported in part by awards cns cns1850533 cns and cns from the national science foundation and the national natural science foundation of china .