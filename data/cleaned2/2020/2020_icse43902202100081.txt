fast parametric model checking through model fragmentation xinwei fang department of computer science university of york uk xinwei.fang york.ac.ukradu calinescu department of computer science university of york uk radu.calinescu york.ac.uk simos gerasimou department of computer science university of york uk simos.gerasimou york.ac.ukfaisal alhwikem department of computer science university of york uk faisal.alhwikem york.ac.uk abstract parametric model checking pmc computes algebraic formulae that express key non functional properties of a system reliability performance etc.
as rational functions of the system and environment parameters.
in software engineering pmc formulae can be used during design e.g.
to analyse the sensitivity of different system architectures to parametric variability or to find optimal system configurations.
they can also be used at runtime e.g.
to check if non functional requirements are still satisfied after environmental changes or to select new configurations after such changes.
however current pmc techniques do not scale well to systems with complex behaviour and more than a few parameters.
our paper introduces a fast pmc fpmc approach that overcomes this limitation extending the applicability of pmc to a broader class of systems than previously possible.
to this end fpmc partitions the markov models that pmc operates with into fragments whose reachability properties are analysed independently and obtains pmc reachability formulae by combining the results of these fragment analyses.
to demonstrate the effectiveness of fpmc we show how our fpmc tool can analyse three systems taken from the research literature and belonging to different application domains with which current pmc techniques and tools struggle.
index terms parametric model checking discrete time markov chains non functional properties i. i ntroduction parametric model checking pmc is a formal technique for analysing the reliability and performance of systems with stochastic behaviour.
the underlying concepts are very simple.
consider a foreign exchange trading fx system that obtains up to date currency exchange rates from two external web services by first invoking one of the services and only invoking the other service if the first service is busy i.e.
if its invocation times out .
if the probabilities that the two services are not busy are p1andp2 then the system will successfully obtain the exchange rates with probability psucc p1 p1 p2.
expressing the non functional properties of software systems as closed form formulae1like this has numerous benefits.
1i.e.
mathematical expressions containing constants variables and simple binary operations etc.
that can be computed in constant timeat design time the pmc formulae can be evaluated very efficiently to compare architectures associated with different parameter values e.g.
in software product lines .
at runtime they can be used to efficiently re verify the satisfaction of non functional requirements after environmental parameter changes and to select new optimal values for the configuration parameters .
they also enable the analysis of the non functional property sensitivity to variations in the system parameters and the computation of confidence intervals for the analysed non functional properties .
for instance if the fx system from our earlier example must operate with psucc 99and its developers know e.g.
from service level agreements that p1 they can compute the minimum acceptable success probability for the second web service asp2 .
as another illustration if unit testing is used to establish as a confidence interval for both p1andp2from our fx example then a 9confidence interval for psuccis given by psucc max p1 p22 psucc .
of course for non trivial systems neither the pmc calculations nor the formulae they produce are this simple.
in fact they both become so complex that despite significant advances in recent years current pmc methods and model checkers do not scale well i.e.
time out run out of memory or yield formulae that are too large to evaluate for many realistic systems with more than a few parameters.
our paper introduces a fast pmc fpmc technique that complements the advances from enabling the efficient parametric model checking of reachability properties for parametric discrete time markov chains pdtmcs of systems with more complex behaviour and larger numbers of parameters than previously possible.
fpmc extends andautomates a recently proposed theoretical framework for efficient parametric model checking .
as shown in fig.
fpmc uses a divide and conquer strategy to partition a pdtmc under analysis into fragments i.e.
subsets of model states and transitions that satisfy well defined rules detailed later in the paper accompanied by fragment8352021 ieee acm 43rd international conference on software engineering icse .
ieee pdtmc model fragmentation standard pmc reachability property abstract model fragment pmc formulae fragment pmc formulae abstract model pmc formula fragment reachability properties standard pmc fragment reachability properties standard pmc fpmc closed form analytical modelfig.
fast parametric model checking process level reachability properties and derives an abstract model for the analysed pdtmc by replacing each of its fragments with a single state.
the fpmc fragments and abstract model are pdtmcs in their own right and can be analysed individually using standard pmc techniques to produce a set of pmc formulae whose combination provides a closed form analytical model for the system level property of interest.
the main contributions of our paper are the first model fragmentation algorithm for the automated partition of pdtmcs into fragments with the characteristics defined by our theoretical framework from which shows how model fragments can be exploited but does notprovide a generally applicable model fragmentation technique.
new theoretical results that allow the formation of model fragments from subsets of pdtmc states that do not initially meet the definition of a fragment.
the new results define valid pdtmc structural modifications that enable the formation of model fragments of the right size for their standard pmc analysis to be feasible.
a prototype fpmc tool that implements the new model fragmentation algorithm and theoretical results introduced in the paper.
the fpmc tool invokes the storm model checker for the pmc of model fragments fully automating the synthesis of closed form analytical models for the analysed reachability properties.
an extensive evaluation that demonstrates the fpmc effectiveness at analysing pdtmc reachability properties for systems from three application domains.
we organised the rest of the paper as follows.
section ii provides the required background on parametric model checking.
section iii introduces a running example that we use to illustrate the use of our fpmc technique which are detailed in section iv.
sections v and vi describe our fpmc implementation and evaluation respectively.
finally section vii discusses related work and section viii summarises our results and suggests directions for future research.
ii.
p reliminaries a. parametric model checking parametric model checking pmc is a formal technique for the symbolic analysis of markov chains whose transitionprobabilities are specified as rational functions over a set of continuous variables .
formally a parametric discretetime markov chain is a tuple d s s0 p l where sis a finite set of states s02sis the initial state p s s!
is a transition probability matrix such that for any states s s02s p s s0 gives the probability of transitioning from s tos0 and for any s2s p s02s p s s0 l s!2ap is a labelling function that maps every state s2sto elements of a set of atomic propositions ap that hold in that state.
a states2sisabsorbing ifp s s andp s s0 for alls6 s0 and a transient state otherwise.
when used in software performance and reliability engineering the pdtmc states map to relevant configurations of the modelled system and pdtmc transitions capture possible transitions between those states corresponding to the feasible changes between their associated configurations.
pmc is supported by the probabilistic model checkers param prism and storm .
these tools compute closedform formulae for pdtmc properties specified in probabilistic computation tree logic pctl and defined as in probabilistic model checking by the grammar truejaj j jp ?
x j u j u k where is astate formula and is apath formula k2n is a timestep bound and 2ap is an atomic proposition.
the pctl semantics is defined using a satisfaction relationj over the states s. given a state sof a markov chaind sj means holds in state s and we have alwayssj true sj aiffa2l s sj iff sj andsj 2iffsj 1andsj .
the time bounded until formula 1u k 2holds for a path iff 1holds in the firsti k path states and 2holds in the i th path state and the unbounded until formula 1u 2removes the boundkfrom the time bounded until formula.
the next formulax holds if is satisfied in the next state.
the state formulap ?
specifies the probability that paths starting at a chosen state ssatisfy a path property .reachability propertiesp ?
are equivalently written as p ?
orp ?
wherer sis the set of states in which holds.
for a full description of the pctl semantics see .
b. parametric model checking using model fragments we summarise the concept of a pdtmc fragment and its exploitation by the pmc approach introduced in where the results from this section are taken from.
as shown in fig.
a fragment of a pdtmc d s s0 p l is a tuple f z z0 zout where z sis a subset of transient mc states z0is the only input state off i.e.
fz0g fz2zj 9s2 snz p s z 0g zout fz2zj9s2snz p z s 0g is the non empty set of output states off and all outgoing transitions from the output states are to states outside znfz0g i.e.
p z z0 for all z z0 2zout znfz0g .
836output states input state inner states z0 zout zn fz0g zout f f f outgoing transitions to states insnz incoming transitions from states in snz f ffig.
fragment of a pdtmc model fragments are not strongly connected components sccs of the graph induced by the pdtmc2states and transitions.
for instance the inner states region of the fragment from fig.
can contain one or more sccs and an outgoing transition from an output state in zoutcan reach a state s comprising an outgoing transition back to the input state z0.
any subset of model states satisfying the constraints described earlier in this section form a fragment.
however partitioning a pdtmc or a part of a pdtmc into fragments is not always possible.
for example fully connected subsets of states cannot be split into fragments because none of their states can be an inner fragment state as shown in fig.
as it will have incoming transitions from outside states and outgoing transitions to outside states restructuring using the techniques described later in section iv b is not possible either as the premises for these techniques are violated.
the theoretical framework from shows that if a fragment fof a pdtmc dis identified then the monolithic onestep pmc of reachability unbounded until and not covered in our paper reward properties of dcan be replaced by the following equivalent steps compute pmc formulae for the probabilities of reaching all the output states of fragment fstarting from its input statez0 this amounts to the pmc of zoutreachability properties of a pdtmc built from fremoving the incoming transitions of z0and by replacing the outgoing transitions of each output state in zoutwith a self loop transition of probability .
build an abstract pdtmc model d0fromdby replacing the states in zand their internal transitions with a single statez0whose incoming transitions and transition probabilities are those of z0.
additionally state z0has outgoing transitions to every state that one or more states fromzouthave outgoing transitions to in d and the probabilities of these transitions can be expressed in terms of the reachability properties computed in step .
due to space constraints we do not provide the expressions for these transition probabilities in the paper the interested reader can find them in .
2i.e.
the directed graph comprising a vertex for each pdmtc state and an edge between each pair of vertices that correspond to pdtmc states between which a transition is possible3 compute the pmc formula for the original property under analysis for the abstract model from step .
combine the pmc from step and the pmc formula from step into a system of equations.
the system of equations from step provides a closed form analytical model for the analysed property.
this analytical model is equivalent to the pmc formula obtained by analysing the original pdtmc in one step.
because the pmc analyses from steps and are performed on models that are smaller and simpler than d this four step pmc approach is often faster produces much simpler closedform expressions or succeeds for more complex models than monolithic pmc can handle.
however no method for partitioning pdtmcs into fragments is proposed in .
instead the approach is only exploited for specific types of componentbased systems i.e.
service based systems and multi tier architectures for which i pdtmcs can be obtained by combining manually pre built pdtmc models of their components and ii the component pdtmcs form fragments in the system pdtmc.
this limits the applicability of the approach to specific types of systems for which new pdtmcs are assembled following this recipe requires additional effort and expertise and can be error prone due to the manual steps involved.
iii.
r unning example we illustrate our fpmc approach using a six operation service based system from the area of foreign exchange trading fx introduced in .
the fx system implements the workflow shown in fig.
and described briefly below.
fx description.
a trader can use fx in two execution modes.
in the expert mode fx runs a loop that analyses market activity identifies patterns that satisfy the trader s objectives and automatically carries out trades.
thus the market watch operation extracts real time exchange rates bid ask price of selected currency pairs.
this data is used by a technical analysis operation that evaluates the current trading conditions predicts future price movement and decides if the trader s objectives are i met causing the invocation of an order service to carry out a trade ii not met resulting in a new market watch invocation or iii an error occured triggering analarm operation to notify the trader about discrepancies opportunities not covered by the trading objectives .
in the normal mode fx assesses the economic outlook of a country using a fundamental analysis operation that collects analyses and evaluates information e.g.
news reports economic data and political events and provides an assessment on the country s currency.
if satisfied with this assessment the trader can use the order operation to sell buy currency then a notification operation confirms the completion of the trade.
given its business critical nature assume that the software architect aims at designing an fx system with high reliability.
thus for the i th operation fx uses two functionallyequivalent service implementations and adopts a sequential execution strategy with retry seq r based on which the two services per operation are invoked in order.
if the first service fails it is re invoked with probability ri1 whereas 837market watchtechnical analysisfundamental analysis alarmorder notification expert modenormal mode x1 xdo transcation objectives not meterrorobjectives metretry end y1 y2y2y1z1z21 z1 z2fig.
fx service based system where x y1 y2 z1 z2are the unknown probabilities of different execution paths service implementations parameters dtmc const double x const double y1 const double y2 const double z1 const double z2 const double p11 const double r11 const double p12 const double r12 const double p21 const double r21 const double p22 const double r22 const double p31 const double r31 const double p32 const double r32 const double p41 const double r41 const double p42 const double r42 const double p51 const double r51 const double p52 const double r52 const double p61 const double r61 const double p62 const double r62 module work owfx s init0 fx state rtr init1 retry status of each service implementation op1 init1 op2 init1 op3 init1 employed service implementation op4 init1 op5 init1 op6 init1 for each operation op1..op6 start expert or normal mode s !x s x s operation market watch s op1 rtr !p11 s op1 rtr p11 rtr s op1 rtr !r11 s op1 rtr r11 op1 rtr s op1 rtr !p12 s op1 rtr p12 rtr s op1 rtr !r21 s op1 rtr r21 s operation technical analysis s op2 rtr !p21 s op2 rtr p21 rtr s op2 rtr !r21 s op2 rtr r21 op2 rtr s op2 rtr !p22 s op2 rtr p22 rtr s op2 rtr !r22 s op2 rtr r22 s ... ... technical analysis result s !y1 s y2 s y1 y2 s fundamental analysis result s !z1 s z2 s z1 z2 s s !
.
s s !
.
s endmodule operational pro le sequential execution strategy with retry for the market watch operation decision based on technical and fundamental analysis outcomes fx nal states trade completed successfully or failed fig.
pdtmc model of the fx system.
the operation is attempted using the second service with probability ri1.
if the execution of the second service fails it is retried with probability ri2 otherwise with probability ri2 the entire system execution fails.
finally assume that the selected service implementations per fx operation is based on the analysis results of the system level probability of successfully completing the handling of a request.
fx pdtmc.
fig.
shows the pdtmc of the fx system specified in the modelling language of the prism model checker .
the model comprises a workflowfx module modelling the fx workflow lines and the parameters associated with the operational profile line and with the initialsuccessfxfailedfxfig.
the directed graph induced by the fx pdtmc from fig.
showing the initial failedfx and successfx states.
service implementations for each fx operation lines pij andrijsignify the probability of successful execution and the probability of retrying the i th operation using the j th service implementation respectively.
the model uses parameters both for the operational profile of the system and for its configurable aspects because the former is typically unknown when the model is produced and the latter enables the exploration and selection of good configuration parameter values.
within the workflowfx module the local variable s line models the state of the fx system while opi line and retry line encode the employed service implementation per operation and the retry status of a service implementation respectively.
following the selection of the expert fx mode line the market watch operation with retry and two service implementations is executed lines .
the first service implementation succeeds with probability p11and fx moves to the technical analysis operation fails with probability p11and retries with probability r11 lines otherwise the second service implementation is executed and succeeds or is re invoked with probabilities p12andr12 respectively.
if both service implementations fail the fx execution terminates line .
the other fx operations function similarly lines but we omit their details due to space constraints.
the pdtmc model of the fx system produces the directed graph shown in fig.
which comprises states and transitions and with the initial failed and successful states coloured in blue red and green respectively.
given this pdtmc model we used prism and storm to obtain the closed form pmc formula for the probability of successfully handing a request i.e.
to reach the succeed state encoded in pctl as p ?
.
despite the small number of states and transitions neither model checker was able to compute the formula within an hour on a computer with the specification from section vi b .
we explain next how fpmc supports the computation of those formulae through automated model fragmentation.
iv.
fpmc a pproach a. markov chain fragmentation algorithm the fpmc partition of a pdtmc into fragments is performed by function f ragmentation from algorithm .
this function takes three arguments the graphg v e induced by the pdtmc the set of states rwhose reachability p ?
is being analysed athreshold parameter 1whose role is described below and returns a set of pdtmc fragments fs i.e.
a set of tuples with the structure from equation .
as not all pdtmc states can be included into a fragment that follows the definition from section ii b e.g.
states whose only outgoing transition is a self loop transition do not satisfy the constraints associated with any type of fragment state we extend this definition to include single state fragments f fsg s fsg for any pdtmc state s. the algorithm starts by placing into fssingle state fragments for each state in the reachability set r line .
we preserve the elements of ras single state fragments so they end up as states in the fpmc abstract model see fig.
and the description from section ii b so the reachability property p ?
which refers to these states can be analysed for the abstract model.
next the algorithm generates additional fragments in each iteration of the for loop from lines as follows.
first a node z0not yet included in any fragment is selected3 line and inserted into the fragment state set z while the fragment output set zoutis initialised to the empty set line .
a stack tis then populated with the states reached by outgoing transitions from z0by invoking in line the function t raverse from algorithm .
each state wfrom this stack is processed by the while loop from lines ending up inzoutif it satisfies the constraints associated with output fragment states lines and .
when wdoes not satisfy these constraints two options are possible lines ifzhas accumulated fewer states than the threshold the graph traversal function t raverse is invoked again to add to the stack the predecessor and successor vertices ofwthat are not already in the fragment line .
otherwise a restructuring of the graph see section iv b is invoked line to force winto becoming an output state and thus to enable the formation of a fragment.
in this way the threshold provides a soft upper bound for the fragment size deciding whether fpmc will continue model traversal adding states into the stack or attempt model restructuring by forcing the currently analysed state to become an output state.
as the result a larger is expected to lead to larger fragments.
when this bound is reached the model restructuring techniques detailed in section iv b are used to force the formation of a valid fragment.
the fragment candidate z z0 zout finalised by the while loop is then downgraded to a single state fragment if it does not meet the definition from section ii b lines after which it is added to the fragment set fs line .
additionally the states zof this fragment are added to the set rof states already assigned to fragments line ensuring that the loop starting in line does not reuse them to form other fragments.
3the selection order for z0has an impact on the fragmentation of the pdtmc and thus on its parametric model checking time however finding the best selection order is outside the scope of this paper.algorithm pdtmc model fragmentation function fragmentation g v e r fs f frg r frg jr2rg for allz02vnrdo z fz0g zout fg t empty stack traverse g z0 t fs r z true .alg.
while empty t do w t pop iffij i w 2eg z foj w o 2eg vnzthen zout zout fwg else if z then traverse g w t fs r z false .alg.
else restructure g w .section iv b end if end if z z fwg end while if valid fragment z z zout then z fz0g zout fz0g end if fs fs f z z zout g r r z end for return fs .set of fragments end function finally the t raverse function from algorithm takes a vertexwand examines its incoming edges if wis not the initial fragment state z0 lines and its outgoing edges at all times lines .
vertices connected to wby these incoming and outgoing edges and not already in the set of fragment states zare collected into the input vertex set i line and output vertex set o line respectively.
the former are then added to the stack tif none of them belongs to an existing fragment lines and .
otherwise the noninput vertex whas incoming edge s from another fragment violating the condition that incoming transitions to inner and output fragment states are only allowed from states within the same fragment hence wbecomes a single state fragment and the graph traversal is terminated lines .
lastly if the output set ohas at least a vertex not in other fragments line growing the fragment under construction with w s successors may be feasible and thus the for loop in lines places the overtices not in other fragments on the stack t line and attempts to restructure the graph to allow fragment formation if these vertices are already part of other fragments line .
due to space constraints the full analysis of algorithms and is provided as supplementary material on our project webpage.
here we note that the algorithms are guaranteed to produce a set of valid fragments comprising i the degenerate single state fragments created in lines and of f ragmentation and in line of t raverse ii the fragments that pass the validation from line of f ragmentation which we assume correct.
furthermore both algorithms terminate.
t raverse terminates because each of its statements including the assembly of the vertex sets i a auxiliary state insertion to force formation of fragment containing the new states among its output states b transition replacement to force creation of output fragment state fig.
model restructuring techniques supporting fragment formation algorithm traversal of pdtmc induced graph function traverse g v e w t fs r z isinput if isinput then .
w is not the fragment s input i fiji 2z i w 2eg ifi vnrthen t push i else fs fs f fwg w fwg g r r fwg return end if end if o fojo 2z w o 2eg ifo6 rthen for allo2odo ifo 2rthen t push o else restructure g w .section iv b end if end for end if end function ando and its only for loop operate with a finite number of vertices.
f ragmentation terminates because i each iteration of its for loop adds at least one vertex i.e.
z0 tor in line until vnr fgin line since vis a finite set and the loop terminates ii its while loop terminates since it iterates over the elements of stack tthat can only contain one instance of vertices from the finite set vand is therefore finite too and iii r estructure invocations can only add a finite number of vertices to v as we show in the next section.
b. model restructuring to aid fragment formation while the model fragmentation from iv a is guaranteed to produce valid fragments the success of fpmc also depends on these fragments being neither too small nor too large.
small fragments may yield a large abstract model that may be unfeasible to analyse using standard pmc however in our experience the pdtmcs whose pmc we want to speed upcomprise many loops cf.
fig that preclude the formation of only small fragments.
in contrast fragments that are too large for standard pmc are more likely to be obtained.
as such fpmc uses the threshold to decide when to attempt to force the formation of a fragment in line from algorithm and further attempts to enable fragment formation in line from algorithm in the two scenarios below.
when a state zof a fragment under construction has both outgoing transitions to inner fragment states and n outgoing transitions of probabilities p1 p2 .
.
.
pn to states s1 s2 .
.
.snnot in the fragment fig 6a left .
in this case the addition of one auxiliary state z0 ifor each outgoing transition to a statesi i n fig 6a right enables the formation of a fragment that includes the auxiliary states as output states.
each auxiliary state z0 ihas an incoming transition of probability pifrom statez and an outgoing transition of probability 1going to state si.
when a non input state zof a fragment under construction hasm 1incoming transitions of probabilities pi1 pi2 .
.
.
pim from states si1 si2 .
.
.simoutside the fragment andn 1outgoing transitions of probabilities po1 po2 .
.
.
pon to statesso1 so2 .
.
.sonnot in the fragment fig 6b left .
in this case each of the mtransitions from a state sij toz j m can be replaced by ntransitions from statesijto statesso1 so2 .
.
.son fig 6b right where the probability of transition from sijtosok k n is set topijpok.
note that the restructuring process is invoked halfway through the construction of a fragment when zouthas not yet been finalised.
thus the model restructuring process can apply to any state zthat satisfies one of the above scenarios and that we may want to include into zout but cannot because one of the constraints from the definition of a fragment is violated.
theorem .
applying the model restructuring techniques from 4using a single auxiliary state z0obtained by combining states z0 z0 .
.
.
z0 nis also possible but leads to more complex expressions for the new transition probabilities so we did not opt for it in the current version of fpmc.
840fig.
to a pdtmc does not affect its reachability properties.
proof.
consider the sets and 0of all paths i.e.
sequences of possible states and state transitions that satisfy a reachability property pof a pdtmc d s s0 p l before and after model restructuring is applied to change it to d0 s0 s0 p0 l respectively.
according to the semantics of pctl we need to show that prs0 pr0 s0 where prs0is a probability measure defined over all paths s0s1s2 snstarting in the initial state s0of pdtmcdsuch that prs0 qn i 0p si si and pr0 s0 is a similarly defined probability measure for d0.
we focus on the paths that differ between and and show that prs0 n pr0 s0 0n for each technique in turn.
a path from n 0has the form s0!1zsi!2for somei2f1 ngand subpaths !
!
with!2ending in one of the states from the reachability state set.
for any such path there is a corresponding path s0!1zz0 isi!
0n and the other way around .
we have prs0 prs0 s0!
p z si prs0 si!
pr s0 s0!
piprs0 si!
pr0 s0 s0!
p0 z z0 i p0 z0 i si pr0 s0 si!
pr0 s0 so the theorem holds for the first restructuring technique.
a path from n 0has the form s0!1sojzsik!
withj2f1 mg k2f1 ng and subpath !
ending in one of the states from the reachability state set.
path has a corresponding path s0!1sojsik!
0n and the other way around and it is straightforward to show that prs0 pr0 s0 sincep sij z p z sok p0 sij sok which completes the proof.
from the two model restructuring techniques only the first increases the number of pdtmc states with as many auxiliary states as there are ougoing transitions from state zto states outside the fragment under construction.
because i the pdtmc has a finite number of states each with a finite number of outgoing transitions and ii the auxiliary states do not require the application of the first technique as they have a single outgoing transition it follows that the maximum number of auxiliary states that fpmc may create is also finite.
c.fpmc application to the running example applied to the pdtmc and reachability property for the fx system from our running example which current parametric model checkers cannot analyse cf.
iii our fpmc tool run for generated the model fragmentation from fig.
.
the five single state and eight multi state fragments fragments in total comprise states and transitions compared to the states and transitions of the original pdtmc with the additional states and transitions due to the model restructuring techniques from iv b. the end to end computation of a closed form analytical model for the fx success probability took fpmc .43s and the algebraic formulae of this model contain arithmetic operations and took .002s to evaluate in matlab on a computer with the specification from section vi b .
as for all fpmc experiments presented in the paper we carefully checked the correctness of our pmc formulae by ensuring that their evaluation for randomly initialsuccessfxfailedfxfig.
fragmentation of the pdtmc model from the running example with the fragments depicted in different colours generated combinations of parameter values produced the same numerical results subject to negligible rounding errors as those obtained by running the probabilistic model checkers prism and storm to analyse the non parametric markov chains obtained by replacing the pdtmc parameters with these random values.
v. i mplementation to ease the evaluation and adoption of fpmc we developed a prototype java tool that implements algorithms and from iv.
the tool invokes the model checkers prism and storm to obtain the pdtmc transition probability matrix and to compute the pmc formulae for the pdtmc fragments and abstract model respectively.
the open source fpmc prototype the full experimental results summarised next additional information about fpmc and the case studies used for its evaluation are available on our project webpage at icse.
vi.
e valuation a. research questions we carried out experiments to answer the following three research questions rqs .
rq1 effectiveness can model fragmentation improve pmc efficiency and extend its applicability?
we assessed whether fpmc can speed up pmc compared to prism and storm and whether our approach enables the analysis of models that these model checkers cannot handle.
rq2 scalability how does the number of parameters in a pdtmc model affect the ability of fpmc to fragment the model and compute closed form formulae?
as the number of pdtmc model parameters is a factor influencing the performance of current pmc solutions we investigated how fpmc performs as the number of such parameters increases.
rq3 configurability what is the impact of the hyperparameter on fpmc?
we examined how different threshold values i.e.
the only fpmc hyperparameter cf.
algorithm affect fpmc in terms of the number of operations in the computed closed form analytical model and execution time.
841b.
experimental setup we evaluated fpmc for three software systems and processes taken from related research and belonging to different application domains.
we selected these systems because i their markov models include hyperparameters that can be tuned to devise pdtmcs with various numbers of states sand transition probability matrices p and ii without changing the pdtmc structure several nontrivial transition probabilities in pcan become parameters thus increasing the number of parameters within the model.
due to space constraints we only provide brief descriptions of these systems full details are available from .
fx system.
we have presented the high level overview of the fx system in section iii and the pdtmc corresponding to the sequential execution strategy with retry seq r in fig.
.
we also consider the strategies below for executing between functionally equivalent service implementations per operation seq the services are invoked in order stopping after the first successful invocation or after the last service fails.
par all services are invoked in parallel i.e.
simultaneously and the operation uses the result returned by the first service terminating successfully.
prob a probabilistic selection is made among the available services with the total probability being equal to .
prob r similar to prob but if the selected service fails it is retried with a given probability as in seq r .
pl system.
this product line system pl models the process in various vending machines that enable a user to insert coins and select a beverage based on which the vending machine delivers the beverage and if needed gives changes.
the features of this system comprises the beverage type soda tea or both payment mode cash or free and taste preference e.g.
add lemon sugar enabling the derivation of vending machines and accordingly the definition of pdtmcs whose structures contain between and features.
com process.
we consider a communication com process among nidentical individuals inspired by the way that honeybees emit an alarm pheromone to recruit workers and protect their colonies from intruders.
due to the selfdestructive defence behaviour in social insects the recruited workers die after completing their defence actions.
hence a balance between efficient defence and preservation of a critical workers mass can be found.
the induced pdtmc is a stochastic population model with nparameters.
the quantitative analysis of such stochastic models of multi agent systems is often challenging because the dependencies among the agents within the population make the models complex.
we compare fpmc against the leading pmc model checkers prism version .
and storm version .
.
both with their default settings.
for a fair comparison we ensured that both prism and storm can process at least the simpler pdtmcs of these systems.
we run each experiment using fpmc prism and storm and observe i the time requiredto compute the pmc formulae with a minute timeout the lower the execution time the better and ii the number of arithmetic operations in the devised formulae formulae with fewer arithmetic operations can be evaluated faster .
all experiments were performed on a macbook pro early with .7ghz dual core intel i5 processor and 8gb ram.
the source code the full markov models and reachability properties and all experimental results are publicly available at icse.
c. results discussion rq1 effectiveness .
table i shows the execution time the number of arithmetic operations of the computed closed form formulae and the number of fragments devised by fpmc using fx system variants with different execution strategies and number of functionally equivalent service implementations per operation.
the size of the derived pdtmcs ranges from states and transitions seq with service implementation to states and transitions par with services .
for all pdtmcs of fx variants fpmc succeeded in computing all closed form formulae within the minutes timeframe fpmc column taking 5sfor the simplest models and just under 240s for most models with the exception of seq r with services for which fpmc took 1560s.
in contrast storm computed the formulae for eight of pdtmcs with the majority being the simplest models across all execution strategies except from prob variants for which storm produced all formulae.
finally prism computed the pmc formulae for four of the pdtmcs which again were the pdtmcs with the fewest states and transitions.
similar results were obtained for the four analysed pl system variants with and features whose results are shown in table ii.
considering column p100 for instance the most difficult case in which the transition probability matrix pcomprises only parameters i.e.
no transition is set to a constant value fpmc returned the closed form formulae in less than 94sin the worst case.
neither storm nor prism succeeded in any of the four pl system variants for p100.
while fpmc outperforms both storm and prism when handling complex models with several parameters we noticed an interesting behaviour with simpler models for fx and pl and simpler properties for com .
in particular for the simplest fx models with seq par and prob strategies and services cf.
table i mostly storm and occasionally prism computed the formulae faster than fpmc.
this behaviour occurs for pl system models up to p40in table ii of the total pdtmc parameters were maintained and propertiesp1 p7 p16 p21for the com process table iii .
since both storm and prism represent internally the induced pdtmcs with advanced data structures e.g.
sparse matrices binary decision diagrams and use sophisticated reachability analysis algorithms this behaviour is logical for models and reachability properties that can exploit these features.
as we have demonstrated however these features alone cannot handle reachability properties for pdtmcs with characteristics similar to those of the most complex models 842table i parametric model checking for the fx system showing the execution time the number of arithmetic operations of the closed form formulae and the number of fragments devised by fpmc.
stg srv s ttime s arithmetic operations fragments fpmc fpmc storm prism fpmc fpmc storm prism fpmc fpmc seq1 .
.
.
.
.
.
.
.
.
.
t t .
.
t t .
.
t t par2 .
.
.
.
.
.
t t .
.
t t .
t t t prob2 .
.
.
.
.
.
.
t .
.
.
t .
.
.
t seq r2 .
.
t t .
t t t .
t t t .
t t t prob r2 .
.
.
t .
t t t .
t t t .
t t t notation stg strategy adopted for the functionally equivalent service implementations per fx operation srv available service implementations per operation s pdtmc states t pdtmc probabilistic transitions fpmc fpmc with except from seq r srv where fpmc fpmc variant where the invocation of the r estructure function in algorithm is disabled t timeout no result returned in 60min.
table ii parametric model checking for four variants of the pl system with and features showing the execution time and the number of arithmetic operations op of the computed closed form formulae for different percentages of pdtmc model parameters.
for the pdtmc with and features and for the pdtmc with features .
percentage of parameters in the pdtmcpdtmc model checkerp01 p10 p20 p30 p40 p50 p60 p70 p80 p90 p100 time s .
.
.
.
.
.
.
.
.
.
.063fpmc op time s .
.
.
.
.
.
t t t t tstorm op time s .
.
.
.
.
.
t t t t t4 features s t params prism op time s .
.
.
.
.
.
.
.
.
.
.790fpmc op time s .
.
.
.
.
.
t t t t tstorm op time s .
.
t t t t t t t t t16 features s t params prism op time s .
.
.
.
.
.
.
.
.
.
.471fpmc op time s .
.
.
.
.
.
t t t t tstorm op time s .
.
.
.
.
.
.
t t t t18 features s t params prism op time s .
.
.
.
.
.
.
.
.
.
.467fpmc op time s .
.
.
.
.
t t t t t tstorm op time s .
.
.
t t t t t t t t22 features s t params prism op notation s pdtmc states t pdtmc probabilistic transitions params total number of pdtmc parameters p01 p100 percentage of pdtmc parameters maintained the others are set to random values preserving the pdtmc structure t timeout no result returned within minutes.
in tables i iii.
this observation indicates the potential of a hybrid probabilistic model checker that uses fpmc and storm prism interchangeably based on the pdtmc structure and reachability property.
considering the complexity of the derived closed form formulae as a factor of the number of involved arithmetic operations we observe that for all systems and all variants the complexity increases as the model complexity states and transitions increases.
for instance for the fx system withseq r strategy the motivating example the arithmetic operations for the fpmc computed formulae increase from to 386kas the number of functionally equivalent services increases from two to five.
in general the fpmc produced formulae contain fewer operations than those produced by storm or prism.
this observation is evident in table iii where the closed form analytical models derived from fpmc include 98k 208koperations for all properties whereas in many cases the formulae produced by storm and prism are 843table iii parametric model checking of reachability propertiesp1 p 21from for the com process with n individuals parameters and showing the execution time and the number of arithmetic operations of the derived formulae.
the pdtmc has states and transitions.
p time s arithmetic operations m megabytes fpmc storm prism fpmcfpmc abstract model storm prism .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
2m .
.
om 2m .
.
om 5m .
.
om 12m .
.
om 101m .
.
om 150m .
.
om .
.
om 167m .
.
om 130m .
.
om 82m .
.
.
9m .
.
.
3m 4m .
.
.
1m 1m .
.
.
.
.
.
.
.
.
very large between several megabytes and 167mb and could not be analysed using our experimental machine.
these findings indicate that fpmc underpinned by the model fragmentation algorithm significantly speeds up the parametric model checking of reachability properties by several orders of magnitude produces closed form analytical models of modest complexity and enables the analysis of pdtmcs that leading probabilistic model checkers cannot handle.
also the use of systems from different application domains whose induced pdtmcs have distinct characteristics in terms of model structure and complexity provides evidence supporting the general applicability of fpmc.
this conclusion is reinforced by the fact that the fragmentation is completely automated and does not require any domain knowledge or human intervention cf.
algorithms and .
rq2 scalability .
we answer this research question by analysing how increasing the number of parameters in a pdtmc i.e.
the number of transition probabilities specified as rational functions affects the execution time and complexity of formulae computed by fpmc storm and prism.
we used the four pl system variants and varied the number of parameters in these models as a percentage of the total model parameters setting the remaining parameters to randomly selected constant values that preserve the pdtmc structure.
for all pdtmcs we started from p01 continuing in increments of p10 p20 etc.
until all transition probabilities are given by rational functions p100 .
table ii shows the pmc results for the four pl variants.
for all pmc approaches as expected increasing the number of pdtmc model parameters incurs a corresponding increase in the execution time and formulae complexity.
both stormand prism however exhibit exponential growth in these two metrics until p60 and fail to produce any formula from p70 thereafter.
in fact some of the formulae comprise as many as .91m and .17m arithmetic operations for prism and storm respectively.
in contrast fpmc terminates successfully in all cases consuming at most 94s indicating that fpmc is barely influenced by the increase in model parameters.
this insight is also supported by the result that the fpmc computed closedform analytical models contain at most 261k operations.
considering these results we have strong empirical evidence indicating that the higher the percentage of transition probabilities specified as rational functions over the total number of transition probabilities the more apparent is the performance gap favouring fpmc over storm and prism.
accordingly fpmc can support the derivation of closed form analytical models for reachability properties whose associated pdtmcs specify as much as transition probabilities as rational functions in the evaluated pdtmcs.
rq3 configurability .
columns fpmc and fpmc in table i compare the fpmc performance with the soft upper bound for the fragment size enabled and disabled respectively.
clearly using extends the applicability of the fpmc reduces its execution time and produces analytical models with a smaller number of operations.
fig.
shows the execution time and number of operations for the closed form analytical models for threshold 2f1 29gfor the fx system from our running example.
the general pattern indicates that larger values contribute to longer execution times and larger formulae thus negatively influencing the fpmc performance.
since for larger the model restructuring techniques are invoked less often the computed formulae are unsurprisingly more complex.
however we observe a sweet spot for 2f3 14g signifying that fragments of those sizes produce the most effective pdtmc fragmentation.
these findings illustrate that enhancing fpmc with mechanisms enabling the automated selection of values e.g.
based on the pdtmc structure can extend further its applicability this is left for future work.
d. threats to validity we limit construct validity threats that may originate from simplifications and assumptions made when establishing the experimental methodology using the pdtmcs and reachability properties from three publicly available software systems and processes also used in related research .
we mitigate internal validity threats that could introduce bias when identifying cause effect relationships in our experiments by designing independent research questions and evaluating the effectiveness scalability and configurability sensitivity of fpmc.
to further reduce the risk of biased results we compared fpmc against the latest versions of the leading probabilistic model checkers storm and prism that were available when we conducted the evaluation.
we also performed experiments using multiple variants of the studied software systems and process and evaluated the correctness of all the fpmc computed formulae by adopting the approach 844151015202529the value of the hyperparameter 100101102time in seconds log scale 151015202529the value of the hyperparameter 103104105number of operations log scale fig.
impact of the threshold on the fpmc time top and fpmc expression complexity bottom for the fx system described in section iv c. finally we enable replication and verification of our findings by making all experimental results publicly available online.
we limit external validity threats that could affect the generalisability of our findings by evaluating fpmc using pdtmcs of systems and processes from three different application domains i.e.
service based systems software product lines communication processes .
furthermore we carried out experiments to check that fpmc can work with pdtmcs containing up to parameters incurring modest increase in execution time with the computed closed form analytical models containing significantly fewer arithmetic operations than those produced by the model checkers prism and storm.
we reduce further the risk that fpmc might be difficult to use in practice by developing an fpmc prototype tool that requires the same domain expertise for specifying pdtmcs as for using prism and storm.
however additional experiments are needed to confirm that fpmc can analyse pdtmcs modelling other software systems and processes than those employed in our evaluation.
vii.
r elated work introduced by daws less than two decades ago parametric model checking has been significantly advanced through the use of rational pmc expression characteristics such as symmetry and cancellation properties and of polynomial factorisation and strongly connected component decomposition .
both the former advance implemented by the model checkers param prism and storm and the latter implemented to the best of our knowledge only by storm have greatly improved the scalability of pmcby ensuring that simpler expressions than those from are produced during the parametric model checking process.
however the objective of all these pmc techniques is to compute a single closed form expression.
the size and complexity of this expression grow rapidly as the analysed pdtmcs become larger and have more parameters until its computation is no longer feasible or the expression is so large that its evaluation is impractical.
our fpmc technique employs a divide and conquer strategy that is completely different from the pmc techniques from .
as such for many large or complex models and for models with many parameters fpmc replaces the often unfeasible task of computing extremely large expressions with feasible tasks that involve the computation of multiple much simpler expressions.
by additionally leveraging the existing pmc techniques for the computation of these simpler expressions fpmc manages to successfully handle much larger pdtmcs than previously possible.
our pmc theoretical framework from which fpmc extends and automates is complementary to the work presented in this paper.
as detailed in ii b this approach requires manual assembly of the analysed pdtmc by an expert which is time consuming error prone and only feasible for specific classes of component based systems.
to the best of our knowledge fpmc is the first approach that can tackle the pmc of parametric markov models of the complexity and with the number of parameters illustrated in vi.
viii.
c onclusion we presented implemented and evaluated fpmc an automated model fragmentation technique that enables the fast parametric model checking of reachability properties for systems with complex stochastic behaviour and large numbers of parameters.
fpmc complements leverages and extends the applicability of current pmc techniques and tools so that closed form analytical models can be computed for additional classes of systems.
given the usefulness of such analytical models in software engineering and other disciplines we plan to continue to develop fpmc.
our next steps in this project will focus on extending the types of properties handled by fpmc with unbounded until ii a and reward pctl properties on developing additional model restructuring techniques to support the fpmc model fragmentation and on investigating how the selection of nodez0affects the performance of fpmc thus improving model fragmentation further via z0 informed selection strategies.
finally we will extend fpmc with support for hierarchical fragmentation so that large fragments and abstract models are further partitioned into smaller models making pmc applicable to even larger systems.
acknowledgement this project has received funding from the orca hub prf project continual verification and assurance of robotic systems under uncertainty the ukri project ep v026747 trustworthy autonomous systems node in resilience and the assuring autonomy international programme.
845references c. daws symbolic and parametric model checking of discrete time markov chains in first international conference on theoretical aspects of computing ictac pp.
.
e. m. hahn h. hermanns and l. zhang probabilistic reachability for parametric markov models international journal on software tools for technology transfer vol.
no.
pp.
.
n. jansen f. corzilius m. v olk r. wimmer e. abrah am j. p. katoen and b. becker accelerating parametric probabilistic verification in 11th international conference on quantitative evaluation of systems qest pp.
.
r. calinescu c. a. paterson and k. johnson efficient parametric model checking using domain knowledge ieee transactions on software engineering vol.
pp pp.
.
c. ghezzi and a. m. sharifloo model based verification of quantitative non functional properties for software product lines information and software technology vol.
no.
pp.
.
verifying non functional properties of software product lines towards an efficient approach using parametric model checking in 15th international conference on software product lines splc pp.
.
g. su d. s. rosenblum and g. tamburrelli reliability of run time quality of service evaluation using parametric model checking in 38th international conference on software engineering icse p. .
a. filieri c. ghezzi and g. tamburrelli run time efficient probabilistic model checking in 33rd international conference on software engineering icse pp.
.
a. filieri and g. tamburrelli probabilistic verification at runtime for self adaptive systems.
assurances for self adaptive systems vol.
pp.
.
a. filieri g. tamburrelli and c. ghezzi supporting self adaptation via quantitative verification and sensitivity analysis at run time ieee transactions on software engineering vol.
no.
pp.
.
r. calinescu c. ghezzi k. johnson m. pezz e y .
rafiq and g. tamburrelli formal verification with confidence intervals to establish quality of service properties of software systems ieee transactions on reliability vol.
no.
pp.
.
r. calinescu k. johnson and c. paterson fact a probabilistic model checker for formal verification with confidence intervals in 22nd international conference on tools and algorithms for the construction and analysis of systems tacas pp.
.
e. m. hahn h. hermanns b. wachter and l. zhang param a model checker for parametric markov models in 22nd international conference on computer aided verification cav pp.
.
m. kwiatkowska g. norman and d. parker prism .
verification of probabilistic real time systems in 23rd international conference on computer aided verification cav pp.
.
c. dehnert s. junges j. p. katoen and m. v olk a storm is coming a modern probabilistic model checker in computer aided verification .
springer international publishing .
h. hansson and b. jonsson a logic for reasoning about time and reliability formal aspects of computing vol.
no.
pp.
sep. .
a. bianco and l. de alfaro model checking of probabilistic and nondeterministic systems in foundations of software technology and theoretical computer science vol.
.
springer berlin heidelberg pp.
.
f. ciesinski and m. gr o er on probabilistic computation tree logic invalidation of stochastic systems a guide to current research vol.
.
springer pp.
.
c. baier and j. p. katoen principles of model checking .
mit press .
j. p. katoen advances in probabilistic model checking in 11th international workshop on verification model checking and abstract interpretation p. .
m. kwiatkowska g. norman and d. parker stochastic model checking in formal methods for the design of computer communication and software systems performance evaluation sfm vol.
.
springer pp.
.
probabilistic model checking advances and applications in formal system verification state of the art and future trends .
springer international publishing .
advances and challenges of probabilistic model checking in48th annual allerton conference on communication control and computing .
s. andova h. hermanns and j. p. katoen discrete time rewards model checked in international conference on formal modeling and analysis of timed systems .
springer pp.
.
s. gerasimou g. tamburrelli and r. calinescu search based synthesis of probabilistic models for quality of service software engineering in30th international conference on automated software engineering ase pp.
.
s. gerasimou r. calinescu and g. tamburrelli synthesis of probabilistic models for quality of service software engineering automated software engineering vol.
no.
pp.
.
m. hajnal m. nouvian d. safr anek and t. petrov data informed parameter synthesis for population markov chains in international workshop on hybrid systems biology .
springer pp.
.
a. classen p. heymans p. y .
schobbens a. legay and j. f. raskin model checking lots of systems efficient verification of temporal properties in software product lines in 32nd international conference on software engineering icse pp.
.
d. ameller m. galster p. avgeriou and x. franch a survey on quality attributes in service based systems software quality journal vol.
pp.
.
c. sun r. rossing m. sinnema p. bulanov and m. aiello modeling and managing the variability of web service based systems journal of systems and software vol.
pp.
.
p. clements and l. northrop software product lines .
addison wesley boston .
s. apel d. batory c. k astner and g. saake software product lines infeature oriented software product lines .
springer pp.
.
f. dressler and o. b. akan a survey on bio inspired networking computer networks vol.
no.
pp.
.
bio inspired networking from theory to practice ieee communications magazine vol.
pp.
.