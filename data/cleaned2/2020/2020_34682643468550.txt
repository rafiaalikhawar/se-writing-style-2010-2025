algebraic datatypetainttracking with applications to understanding android identifierleaks sydurrahaman new jersey institute of technology new jersey usa sr939 njit .eduiulianneamtiu new jersey institute of technology new jersey usa ineamtiu njit .eduxin yin new jersey institute of technology new jersey usa xy258 njit .edu abstract current taint analyses track flow from sources to sinks and report theresultssimplyassource sinkpairs orflows.thisisimprecise andineffectiveinmanyreal worldscenarios examplesincludetaint sources that are mutually exclusive or flows that combine sources e.g.
imeiandmacaddressareconcatenated hashed leakedvs.
imeiandmacaddresshashedseparatelyandleakedseparately .
theseshortcomingsareparticularlyacuteinthecontextofandroid wheresensitiveidentifierscanbecombined processed andthen leaked in complicated ways.
to address these issues we introduce a novel algebraic datatype taint analysis that generates rich yet concise taint signatures involving and xor hashing akin to algebraic product andsum types.
we implemented our approach as a static analysis for android that derives app leak signatures an algebraic representation of how and where hardware software identifiers are manipulated before being exfiltrated to the network.
we perform six empirical studies of algebraic datatype taint tracking on top apps from google play and their embedded libraries including discerning between raw and hashed flows which eliminates a source of imprecision in current analyses finding apps and libraries that go against google play s guidelines by ab usinghardwareidentifiers showingthatthird partycode rather than app code is the predominant source of leaks exposing potentialde anonymizationpractices andquantifyinghowapps have become more privacy friendly over the pasttwoyears.
ccs concepts security and privacy information flow control mobile platformsecurity softwaresecurityengineering software andits engineering automated static analysis .
keywords android mobile security static analysis taint analysis fingerprinting identifier leak acmreference format sydur rahaman iulian neamtiu and xin yin.
.
algebraic datatype taint tracking with applications to understanding android identifier leaks.in proceedingsofthe 29th acm jointeuropean softwareengineering permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
esec fse august 23 28 athens greece associationfor computing machinery.
acm isbn ... .
.org .
.3468550conferenceandsymposium on the foundationsof softwareengineering esec fse august 23 28 athens greece.
acm new york ny usa 13pages.
.org .
.
introduction currenttaint analyses forandroid thisincludes flowdroid taintdroid amandroid trackwhetherdatafromaprivacysensitive sourceflows toan insecure sink.
the analysis resultfor a sink e.g.
aleaktothenetwork isalistofsources optionally flows thatreachthatsink.first thisisineffective thesameleakreportcan be too alarmist or not alarmist enough depending on the context.
second this is inadequate as it does not capture the relationship betweensources e.g.
mutuallyexclusivesources neitherdoesit capturesource processingortheseverityoftheleak e.g.
hashing canbeappliedtoeachsourceinturnorhashingcanbeappliedtoa concatenationofsources.finally rich convoluted leaksignatures are ubiquitous in android apps but cannot be exposed by existing android taint trackers.
our approach produces expressive leak signatures ratherthansimply enumerating sources e.g.
imei macaddress androidid as in current taint trackers our approach uses formulas indicating relations between andoperations on sources e.g.
imei hash androidid hash macadresss considerforinstancethe com.appsee mobileanalyticslibrary which leaks the hashed phone identifier imei onto the network vs. the io.fabriclibrarywhichleakstherawimeiontothenetwork.whilea conventionaltaintanalysiswouldconsidertheseleaksasequivalent theyarenot therawimeileakisdangerous asitallowstheserver toidentifythemanufacturerandphonemodel thehashedleakis less dangerous since the phone information cannot be identified atleastnotdirectly .ouranalysisdistinguishesthesetwoflows encoding the former as e 1and the latter as h e capturing the difference.infact ourstudyontopandroidappsshowsthat23 ofidentifier leaksare hashedleaks not raw leaks.
as another example consider the likes followers instagram app that leaks the hashed imei and androidid signature h e h a whichisdifferentfromapp jcpenney thatleakstherawimeiand androidid signature e a whichisdifferentfromapp aarpnow thatleakseithertheimeiortheandroidid butnotboth signature e a andfinallyapp mooncalendar withsignature h e a notethe crucialdifferencefrom h e h a especiallyrelevantinthecontext of homomorphic encryption.
current flow analyses would conflate all these cases declaring imei and androidid are leaked .
our study section .
quantifies this conflationon1 topgoogle 1for conciseness we use shorthands for android unique identifiers efor the imei a for the androidid gfor guid etc section .1defines the full list.
esec fse august 23 28 athens greece sydurrahaman iulian neamtiu xinyin play apps a conventional analysis would conflate apps whose signatureis h a g with70appswhosesignatureis a g simply declaringthat all170apps leakthe androidid andthe guid.
our taint analysis produces a leak signature that corresponds to an algebraic finite non recursive datatype our logical and and xor connectives encode product and sum types respectively.this algebraic datatype encoding allowsusto define subsumption whatitmeansforanapptoleaklessthananother app rigorously viasubsetsemantics.
in androidapps leak patterns such as leak if available otherwise leak abound we capture this viaxor.considerthe cbsnews appwhichleakseithertheimei or theandroidid butnotboth.traditionalanalyseswouldreportthis app s signature as e a i.e.
both identifiers are leaked which is imprecise.ouranalysisconstructstheprecisesignature e a.more generally usingourapproach developerscancheckpropertiessuch as the app only leaks the imei on a real device otherwise it leaks the androidid .
precisely capturing taint as logically connected raworhashedidentifiersiscrucial ourstudyshowsthattwo thirds of leaks are due to leaking identifier combinations of flows leak combinations of ids and only of flows leak individual ids .
our algebraic representation isdefinedinsection .
section4presents the design of our static analysis.
we use a noveldataflow centriccallgraphtoproduceanover approximation of app flows followed by two refinement phases separating raw leaksfromhashedleaks andapp sownflowsfromthird partyflows finally yielding an algebraic leak representation aka signature.
while we focus on hardware identifiers in this work our implementation is generic other privacy sensitive sources e.g.
gps location canbetrackedbysimplyindicatingtherelevantsource methodsinour sourcedefinitionfile.
in section 5we evaluate our approach.
the main dataset consistedof1 000topappsfromgoogleplay chosenfrom19categories andthe821librariestheseappsembed.wefoundthattheapproach is effective.
first when compared to the state of the art flowdroid staticanalyzer ourapproachdiscovers2.1xasmanyleaks while sheddinglightonthenatureandlocationoftheleak.second when compared with ground truth our approach attains .
precision and recall.
the approach is also efficient with a median analysistime per app of347seconds.
insection weconductaseriesofempiricalstudiestoexamine a thelandscapeandevolutionofthe1 000topgoogleplayapps interms of privacy leaks involvingnon resettable hardware and resettable software ids and b their embedded libraries with a focusontop libraries financial advertising analytics .
an analysis of worst case leaks i.e.
hardware identifiers sent raw has found that of the apps leak at least one of the raw hardware ids imei imsi serial mac address which is at odds with google s id usage guidelines.
in fact out of the top most common signatures involve hardware ids.
wefoundthatoutoftop 25leakiestapps 13appsleakhardware idswithnofinancial justification among top 20leakiestlibraries only3arefinancial wheregoogleguidelinespermithardwareids .
certain identifiers e.g.
imei tend to be leaked by libraries whereasothers e.g.
macaddress byowncode.overall of leaks are due to third party libraries and leaks are due to apps own code.
this has important implications because leaks due tothird partycodecangetanappremovedfromgoogleplay even though the developer app s own code has followed the guidelines.
finally bycomparingapps versionsfrom2018withtheir2020 counterparts we found a decrease in the use of raw hardware identifiers indicating that apps have become more privacy friendly.
our work makesseveral contributions a novel algebraic datatype taint representation enabling expressive yetconcise leaksignatures andleakanalysis.
an implementation of algebraic taint tracking as a static analysisfor android.
a six part empiricalstudy characterizing identifier ab use intopandroidappsandlibraries.thestudydemonstrates the flexibilityandprecision of our algebraic representation.
our implementation along with the signatures found for the apps usedinthe evaluation are available as open source.
motivation and design choices taint analyses determine whether data from a privacy sensitive source e.g.
macaddress flowstoaninsecuresink e.g.
internet .
currentanalyses imprecision affectstheir usability.for example applyingastandardandroidtaintanalysisproducesthesameresult imei internet inthree differentscenarios theappexfiltratestheimeitoathird partyserver e.g.
blink healthrx thispracticeisdiscouragedorforbiddenby google play guidelines depending on the nature of the app.
the app e.g.
carezone links with a financial library that uses the imei for payment fraud prevention this is allowed bythe guidelines.
theapp e.g.
spectrumtv concatenatestheimeiwith another identifier e.g.
androidid hashes the result and uses this hash value for customer identification.
since the actualimeicannotbereverse engineered theprivacyloss islower comparedto the firstandsecondscenarios.
conflating these three use cases is problematic as they are very differentintermsofguidelinescomplianceandprivacyimplications.
we combine a precise static analysis with an algebraic representationthat can distinguishbetween these andother scenarios.
android identifiers.
our analysis considers the seven popular android ids described in table .
the first four are hardware identifiers i.e.
tied to the specific phone hardware and cannot be reset changed in software the remaining three are resettable identifiers.google androiddeveloperguidelineshavespecificpoliciesdesignedtoprotectuserprivacy bydiscouraging oreven forbidding access to hardware identifiers such as avoid using hardware identifiers onlyuse an advertisingid for userprofiling orads use an instance id or guid whenever possible for all other use cases except for payment fraud prevention and telephony byits nature fraudprevention requires proprietary signals to sum up the only acceptable use of hardware identifiers is financial fraud detection all other scenarios e.g.
advertising or analytics requiretheuseofresettableidentifiers.manyappsviolate theseguidelines tocounterthisabuse asshownintable s mac .com sujon335 algebraicdatatypetainttracker 71algebraic datatype taint tracking withapplicationsto understandingandroid identifier leaks esec fse august 23 28 athens greece apkidentifier apidata flow control flow analysis imei imsi....androidid dataflow centric call graphamandroidsha md5 nameuuidfrombyteshashed leakraw leak third party library code own codehash analysis signature output imei imsi h imei h androidid h imei h androidid imei imsithird party vs. own analysis hashing methods.
.
.
network api cfg algebraic taint figure overview.
table identifiersconsidered andtheir semantics.
id semanticshardwareimei meid digit identifies mobilephone imsi digit identifies sim network subscriber mac bit identifies the network card address actualvaluereportedbyandroid 02 00 reported by android randomized valuereported byandroid serial manufacturer assigned identifies deviceresettableandroidid android unique for an app orapp group android uniqueuser devicecombination guid identifies app instance advertisingid identifies userfor adtrackingpurposes address line the android platform s recent versions took increasinglystringentmeasures firstreportingaconstant macaddress and then a randomized one.
android version used by .
of android devices as of february 25th per android studio restrictsaccesstohardwareidentifierstoprivileged e.g.
system vendor apps this does not affectthe generalityofour approach.
algebraic datatype representation forsignatures in type theory a product type is the type of an n ary tuple e.g.
in ocaml the tuple .
foo has type int float string .
a sum typeis thetypeofaunion e.g.
inc unionu inti floatf orthe ocaml variant typenumber intofint floatoffloat have producttype int float eitheran intorafloat butnotboth inhabit the variant .
our core insight is an algebraic datatype definition of taint identifiers are base types and leak signatures are finite non recursive algebraic types over basetypes.
.
definitions we define these shorthands for the android identifiers efor the imei sfortheimsi afortheandroidid rforserial mformac address vfor advertisingid gfor guid.
signatures can be identifiers hashes or combinations thereof introduced via and or xor.
we use sandtas metavariablesfor signatures.
henceour signature grammarisdefinedsimply as identifier i e s a r m v g signature s i h s s s s sand denoted s t indicatesthat bothsandt whichcanbe identifiersorsignatures areused.thiscorrespondstoaproduct type in type theory and cartesian product in set theory.
note that we deliberately use instead of the standard type theory symbol as itismore suggestive inour context.
xor denoted s t indicates that either sortis used but not both.
this corresponds to a sum type in type theory 3and disjoint set union in set theory.
we use instead of the standard from type theory as itismore suggestive inour context.
hash.
the hash denoted h s indicates that an identifier s hash orthehashofanidentifiercombination isleaked nottheactual raw identifier s e.g.
h e couldbecomputedviahashingmethods nameuuidfrombytes imei.getbytes ormd.digest imei.getbytes .
.
properties defining formally what it means for a program to leak lessthan anotherprogramiskey.forthispurposeweintroducethe subsumptionrelation inducedbysubsetsemantics.informally app a leaks less than app b akabsubsumes a if the set of all possible valuesleakedby aisasubsetofthesetofallpossiblevaluesleaked byb.
we now define subsumption for the algebraic representation.
subsumption and .
anappwhosesignatureis sleakslessthan anappwhosesignatureis s t thisisdenoted s s t.similarly anappwhosesignatureis tleakslessthananappwhosesignature iss t this isdenoted t s t. subsumption xor .
an app with signature s tleaks less than an app whose signature is s t. subsumption hash .
anappwithsignature h s leaksless4than an app withsignature s this isdenoted h s s. first notehowsubsumptionintroducesapartialorder incertain cases a total order on apps leaking properties its power becomes apparent in section 6when we use it to check whether a signature subsumesanother i.e.
anappleaksmorethananotherapp ormore than a different version of the same app .
second the algebraic representation naturally induces equivalence classes apps with the same signature will leak the same identifiers and semantically the identifiers are manipulatedinthe same way e.g.
hashed .
3technically inthe curry howard isomorphism sum typescorrespond to or in logic not to xor.
however or is not our intended semantics since a true ina b truedoes not force bto befalsewhereas in our semantics it does mutualexclusion alongerexplanationisavailablehere .oursemanticsisreadily apparent in the church boolean function xor i.e.
a. b.a not b b where if areduces to true not b mustreduce to falsefor the xor to reduce to true.
4 leaks less in aprivacy cryptographic sense ratherthan strictly h s s. 72esec fse august 23 28 athens greece sydurrahaman iulian neamtiu xinyin 1string gettelephonydeviceid context context string deviceimei telephonymanager context.getsystemservice phone .getdeviceid returndeviceimei 4string getandroidid context context string androidid secure.getstring context.getcontentresolver android id returnandroidid 7string getwifimacaddress contextcontext ... string mac wifimanager.getconnectioninfo .getmacaddress returnmac 10string getuniquedeviceid contextcontext returngeneratedeviceid gettelephonydeviceid context getwifimacaddress context getandroidid context 13string generatedeviceid string str string str2 string str3 if !
textutils .isempty str str3 a str3 str str3 e else if !
textutils .isempty str2 !textutils .isempty str3 str3 a str3 newuuid long str3.hashcode long str2.hashcode .tostring str3 h m h a else if textutils .isempty str3 str3 a str3 uuid.randomuuid .tostring str3 g returnstr3 str3 e a h m h a g 23voidsenddeviceinfo ... httpparamap.put deviceid getuniquedeviceid context .tostring ... figure uuidgenerationinthe audiobooks.com app.
approach the architecture ofour systemis shown infigure .
givenanandroidapp apkfile weperformachainofanalysestoconstruct the app s leak signature control and data flow analyses that computeandpropagate algebraictaint asecondaryanalysis todetect hashing andathird partyvs.ownanalysis.theinitialcontrol flow graphisproducedbytheamandroidstaticanalyzer shown ingray not acontributionofthis work .
our approach operates from generic sources sinks any variable or api method can be used as source similarly for sinks.
these are specifiedinasourceinputfileandsinkinputfile respectively asis common for flowtrackers.
.
motivating example weillustrateourapproach andcontrastitwithpriortaintanalyses ontheaudiobooks.com app.therelevantsourcecodeisshown infigure .theappattemptstoleakanuniquedeviceid akauuid onto the network via senddeviceinfo lines 23 25 .
the uuid is the imei ifavailable retrievedonlines1 3 ifnotavailable thehashes ofmacaddressandandroididiftheyareavailable lines4 12 otherwisetheguid ifavailable line20 finally ifnoneofthese conditions are met androidid isthe uuid.
traditionaltaintanalyzers e.g.
flowdroidoramandroid performtaintanalysisofeachsourceseparatelyandreporttheleaks separately.
for the aforementioned code snippet such tools performfourtaintedpathscalculationsforfourdifferentsources imei macaddress androidid andguid asillustratedinfigure top .
eventually they produce a report stating that all four identifiers areleaked.this however isimprecisefortworeasons.first theidentifiers hashedvalues are leaked which isless dangerousthan rawleaks.
second the tools fail to report the aggregation actually macaddressandandroididareused together exclusiveofimei andguid i.e.
asignature whereasthetoolsreportseparateleaks.
in contrast our analysis produces the correct signature.
the high levelviewisshowninfigure bottom lower leveldataflow analysis will be discussed shortly.
instead of simple taint propagation we propagate algebraic taint.
for the example shown in the figure instead of four different leaks we report one precise signature the leakactually present here that is e h m h a g a .
dataflow centric callgraphconstruction andanalysis while other static taint analyzers perform interprocedural control and data flow analyses as we do their taint facts and propagationarebothimpreciseandinsufficientforourpurposes.
we address this via a series of analyses the first of which is call graphextraction as explainednext.
.
.
call graph extraction.
we start our analysis from the amandroid generated control flow graph and soundly5extract thesub graphwherethealgebraictaint relevantdatapropagates.
we illustrate our approach in figure the top shows the source codewhilethebottomshowsourdataflow centriccallgraph the greyedges verticesdepict thepartsofthecontrolflowgraphthat can be soundly abstracted away .
in the source code the imei is obtained via the android api on lines and and stored in hardwaredeviceid .
on line the imei flows into the putuuid method asaparameter theimeiissavedintoa jsonobject online11.our graph capturesthis dataflow.we can see a dataflow edgebetween thehardwaredeviceid andjsonobjectvariables where the imei data is savedaskey valuejsondata.next ifwefollowthedataflowofthe jsonobjectcurrentlyholdingtheimeidata thedataissavedintoa newvariable uuidonline14inthe getpersistentuuid method.thisis captured by the edge between jsonobject anduuid.
finally on line thehashmapcreates an entry key value pair with deviceidas key andimeiasvalue resultinginanedgefrom uuidtohashmapinthe graph.
next our dataflow analysis forward may a variant of reachingdefinitions propagatesalgebraictaintontopofthe graph.
.
.
dataflow analysis.
we illustrate our dataflow analysis on the program in figure method generatedeviceid .
a simplified for legibility version of the out s sets limited to variablestr3areshownascommentsontherightsideofthecode.at the beginning the set contains the value a i.e.
androidid.
at line str3is assigned a new value which contains the imei e .
theout s setforthestatementatline18containsthecombined hash value signature h m h a str3is then assigned g guid at line .
for each statement the union of the out s of all the predecessors s ofsgivesthe in s value .inourexample line22 spredecessorsetislines ofcourse intheactualanalysis conditionalstatementsaremorefine grainedhence 5technically soundy our approach is sound up to native code because we leverage amandroid which is sound up to native code which is par for the course for java android analyses.
73algebraic datatype taint tracking withapplicationsto understandingandroid identifier leaks esec fse august 23 28 athens greece h a h m h a deviceimeimac source androidid source imei androididsource mac address getuniquedeviceid generatedeviceid str2 generatedeviceid generatedeviceid str3 strreturn registersink senddeviceinfo source guid prior analyses m a eg str3 deviceimeimac source androidid source imei androididsource mac address getuniquedeviceid generatedeviceid str2 generatedeviceid generatedeviceid str3 strreturn register sink senddeviceinfo source guid m a eg str31.
leak of m .
leak of a .
leak of e .
leak of g hashing conditional block concatenation h m e h m h a g a e h m h a g a our analysis figure prior taintapproaches top vs.our approach bottom .
1public class persistentuuid 2jsonobjectjsonobject newjsonobject 3private static final string uuid key nr uuid ... private void generateuniqueid contextcontext ... telephonymanager tm telephonymanager context.getsystemservice phone hardwaredeviceid tm.getdeviceid putuuid hardwaredeviceid ... protected void putuuid stringuuid ... jsonobject.put uuid key uuid ... publicstring getpersistentuuid ... uuid jsonobject.getstring uuid key ... returnuuid 18public class androidagentimpl public void senddeviceinformation ... hashmap.put model build.model hashmap.put deviceid persistentuuid.getpersistentuuid ... tm generateuniqueid imeiapi ....dataflow centric call graph hardwaredeviceid generateuniqueid jsonobject putuuid uuid getpersistentuuid hashmap senddeviceinformation .... figure source codeandits dataflow centriccallgraph.
we typicallyperforms two way joins ratherthanafour way join .
hence at program joint point line the inset in this case identical to the outset whichrepresents the uuidsignature is e h m h a g aakeyfactor thatinformedouranalysisdesign andhelpskeep the analysis precise was our observation drawn from manual taint analysis section .
.
that apps code for constructing the signature such as the code discussed above tends to lack back edges whichhelpscontain dataflowsetssize.
.
hash analysis as illustrated in figure hashed leaks are leaks that flow through hashing methods e.g.
md5.
we detect such flows by setting up another flow analysis as follows.
first we set the entry of hash methodsas sinks.next wesetthereturnofhashmethodsas sources and network api methods as sinks.as a result we separate the underlyingidentifiersleaksinto rawleaks andhashedleaks .notethat ouranalysistakesa hashingmethods listasinput weconstructed this list based on an exhaustive analysis of hashing functions practices available in java and practices used by manually analyzed android apps.
for example some common hashing java api methodsinclude md5 shaandnameuuidfrombytes orjavaclassessuch asmessagedigest .thislistisuser configurablehenceeasilyextended.
.
third party vs. own codeanalysis to separate own leaks from third party leaks we used a predefined list of common third party libraries as reference 6along with flow partitioning.
specifically if an identifier s entire flow involves only third party library methods we tag that leak as third party leak otherwisewetagitas owncodeleak.wehavenotfoundanycrossflowbetweenthird partycodeandowncodeinourexaminedapps.
.
example in figure we show an example that illustrates both hashing andthird partyvs.ownanalysis fromapp cgtn.theimeiisbeing hashed by the cryptographic hashing method messagedigest sha lines4 7and8 .theleakhappensinsidetheapp sownpackage sowe categorize itas own .the leaksignature is therefore h e 6the same library can appear under different names in different apps due to obfuscation we mapped obfuscated libraries names to a unique name common across all apps for that library.
74esec fse august 23 28 athens greece sydurrahaman iulian neamtiu xinyin 1public static string getdeviceid context me telephonymanager telephonymanager telephonymanager me.getsystemservice phone string imei telephonymanager.getdeviceid messagedigestmd messagedigest.getinstance sha byte dat null if imei null return md.update imei.getbytes returnhashbyte2string md.digest figure cryptographichashingin evaluation weevaluatedourapproach andperformedsixstudies on1 000top apps from google play.
the apps span popular categories from google play.
the distribution number of apps per category is shown in table .
the number of apps varied slightly across categoriesaswefavoredpopularapps.fortheevolutionstudyonly section6.
wecomparedapps year2018versionswiththeiryear counterparts i.e.
apks.
.
effectiveness wefirstevaluatetheeffectivenessofourapproachbycomparing on the1 apps with state of the artflowdroid next we compare withgroundtruthon64appswhereflowsweretrackedmanually.
.
.
comparisonwithflowdroid.
weranthejuly2020version of flowdroid from its official github page on our app dataset.we configuredflowdroidto match our configuration we enabled implicit flow analysis and context sensitivity.
dataflow analysis callback collection during call graph construction and resultcollectiontimelimitsweresetto1000seconds 1000seconds and seconds respectively.
as a point of reference our analysis mediantimeperappwas347seconds section .
sowebelievethe aforementioned time limits are reasonable.
we directed flowdroid to use sources and sinks that match ours.
as sources we used the api methods responsible for retrieving the identifiers we track .
for sinks we used the susi list i.e.
all possible sinks under network information category as we are only interestedinexfiltrationtothenetwork.notethattheapimethods that read the serial and advertisingid cannot be expressed in flowdroid staint sourceformat sowe markedthoseas n s .
we show the results in table the number of apps where leaks werefound byflowdroidandourapproach respectively.wemake threeobservations.first flowdroidmissesasubstantialnumberof leaks asitreports46 oftheleakswereport 1083vs.
forthose fiveidswecouldrunflowdroidon priorworksuggeststhatfalse negatives root causes in flowdroid susi include inter component communication icc and imprecise sink source lists .
our approachhandlesiccbydefault viaamandroid .evenwiththe generoustimelimitsweset flowdroidtimedoutandcouldnotfind alltheleaks.second flowdroidcannotdistinguishbetweenraw andhashedleaks asourapproachdoes thirdandfourthrowsshow theraw hashedsplit .third ourapproachhassomefalsenegatives compared to flowdroid i.e.
we miss leaks that flowdroid does notmiss asdepictedinthelastrow.wefoundthatfalsenegatives originateinthecfgprovidedbyamandroid whenamandroidmissed some control flow edges our approach missed those edges as well.
.
.
comparison with ground truth.
we measured the false positives fp and false negatives fn by comparing the results of our static analysis with ground truth known flows found in prior workviaamanualanalysison64apps 7these groundtruthflows are not acontributionofthis work.
the confusionmatrixis true positives 186false positives falsenegatives 0true negatives thesefigures a72 precisionand100 recall areparforthecourse for astaticanalysis indicating that our approach iseffective.
we also show a comparison of our approach with flowdroid on these64groundtruthappsintable .ourapproachfoundmore leaksthanflowdroid ontheseapps as well.
.
efficiency weconductedtheexperimentsonamacbookpro .5ghzdualcore intel core i7 with 16gb ram running mac os x .
.
.
we show statistics computed across the entire app dataset of analysis runningtime alongwithappbytecodesize intable .atypicalapp took about minutes to analyze median seconds geometric mean seconds which is efficient for a static analysis the longestanalysistimewas13hours whichwebelievecanbereduced substantially with more engineering.
the app bytecode statistics median16.6mb geometricmean 15mb maximum103mb show that our approach iscapableof analyzing large apps.
applications we now present six studies that provide evidence for the expressiveness andeffectiveness of algebraic datatype taint tracking.
.
whatids areleaked andin whatform?
we first studied the frequency and nature of identifier leaks.
in table6we show the percentage of apps that leak that identifier andtheformoftheleak.threecriticalidentifiers imei serial mac address areleakedby40 51 oftheapps whichisthefirstreason forconcern.thesecondreasonforconcernisthatidentifiersare leakedrawby75 88 oftheappsthatleakthem 23 46 ofapps leak these ids hashed in lieu of or in addition to the raw leak.
on a more positive note the imsi is leaked to a lesser extent only ofthe apps andmostly hashed .
for the remaining three resettable identifiers we found that theandroididandguidareleakedroutinely by91 and92 of the apps respectively.
the advertising id is seeing a reduced leak rate of the apps .
raw leaks are the norm for these identifiers 96 100 ofthe leaksare inraw form.
we observed that certain apps leak boththe raw and hashed id lastrowoftable .notethatforimei imsi serial andandroidid thisfigureisquitehigh 12 37 oftheapps.webelievethispractice to be particularly pernicious because such apps essentially have theh id idmapping.iftheseappscommunicatethemapping 7themanualflowanalysiswasexhaustive e.g.
wentsofarascapturingandrewriting networkpackets.
75algebraic datatype taint tracking withapplicationsto understandingandroid identifier leaks esec fse august 23 28 athens greece table app distribution across categories.
category financebookseducation ent ment.eventfoodhealthhomelifestylemapsmedicalmusicnewsshoppingsocialsportstoolstravelweather apps table the number of top google play apps where flowdroid andour approachrespectively foundleaks.
imeiimsiserialmacand.idadvidguidflowdroid n s n s our approach total raw hashed falsenegatives n a n a table4 thenumberofgroundtruthappswhereflowdroid andour approachrespectively foundleaks.
imeiimsiserialmacand.idadvidguidflowdroid n s n s our approach table efficiency results.
analysistime seconds bytecodesize mb min max median mean min max median mean .
.
.
table identifiersstats.
imeiimsiserialmacand.idadvidguidapps raw hashed raw hashed to other apps that only have h id then the raw id value unique to the device canbede anonymized .
.
multiple identifier leaks we now study cases where multiple identifiers are leaked by a single app.
we present the most frequent signatures in table .
on a positive note out of top most common signatures are h a g a g anda v thatis resettableidentifiers andtable most commonmulti id leaks r raw h hashed.
imeiimsiserialmacand.idadvid guid appsr h r h r h r h r h r r .
respectively .theflipsideisthattheother7outoftop 10use hardwareidentifiers wehave h e h r h a thenh m h a thene a at4 and above.
we have h r h a thenh e h s thenh e h m thenh e h a g at .
andabove.
notehowthesefindingsunderlinetheeffectivenessofourapproach.astandardtaintanalysiswouldconflatethe100appswhose signatureis h a gwiththe70appswhosesignatureis a g and would conflate the apps using h e h s h r h m h a withthe 4apps using e s r m a. examples complex yet common signatures.
our prior work on manual taint analysis section .
.
has revealed groups of apps withcommonsignatures appsusethesamemechanismforconstructing a unique deviceid .
our analysis can group apps into equivalence classes induced by app signatures this has a variety ofapplications fromfindinggroupsofappswithcommonbehavior to groupsofapps with commondevelopers etc.
we show twosuchexamplesinfigure .theleftside firststage ofthefigure listsall theidentifiersinvolvedin signatureconstruction.
thesecondstage shows how those identifiers are combinedor processed to generateahashedunique deviceid whichisthen exfiltrated.
76esec fse august 23 28 athens greece sydurrahaman iulian neamtiu xinyin string deviceid new uuid imei.tostring .hashcode imsi.hashcode androidid .hashcode .tostring string androidid secure.getstring ...android id string imsi telephonymanager .
getsubscriberid string imei telephonymanager.getdeviceid signature h e h s h a identifier read identifier processingexfiltration to the network string deviceid imei or new uuid androidid .hashcode macaddress .hashcode .to string or androidid or macaddress or guidstring androidid secure.getstring ...android id string imei telephonymanager.getdeviceid string macaddress wifiinfo .
getmacaddress signature e h a h m a m g string guid uuid.randomuuid .tostring figure deviceidsignatures.
table8 third partyvs.owncodestatistics numberandpercentageofleaks t third party o owncode .
imei imsi serial mac and.id t o t o t o t o t o r183 h97 r h signature1 app texasroadhousemobile createsadeviceid from the combination of imei imsi and androidid.
since all identifiersare used the signature uses ands h e h s h a signature2 library io.intercom isquitecomplex asthedeviceid is exactly one of either the imei or the androidid or the mac address ortheguid ortheandofhashedandroididandhashed mac address.
our representation captures this effectively e h a h m a m g .
libraryleaks vs. app sown leaks we motivate this analysis via two scenarios.
in the first scenario a developer submits an app for publishing onto google play and the app isrejectedforviolatingguidelines e.g.
a rawhardwareleakin anon financialapp.eventhoughthedeveloperhasusednoids the appislinkedwitha leaky advertisinglibrarythatcausestheid leak.thedevelopershouldbeabletoextractthelibrary ssignature and the app ssignatureto determine the leak s causeand courseof action.inthesecondscenario thegoogleplaymarketplaceitself tries to determine whether a raw hardware leak is allowable or not prior to publishing an app.
if the app uses a payments services library the leak would be allowed in the name of fraud prevention.
hence itisessential to find whethera leakis causedbya libraryor1 jcpenney app 2staticstring g context context ... hashmap.put di telephonymanager.getdeviceid .digest ... jsonobject.put di hashmap.get di ... dunkinapp 9finalhttpparametermap getriskbodyparametermap ... httpparametermap.add imei telephonymanager context.getsystemservice phone .getdeviceid true ... returnhttpparametermap figure7 hashedleak top vs.rawleak bottom inthesame com.threatmetrix library.
the app itself.
our analysis isolates the source of the leak figure andattributes itto either third party library code or owncode.
in table8we present the results of leak attribution in our examinedapps.foreachid weshowthenumberofthird party t vs. own o leaks whether the leak is raw or hashed as well as the percentage distribution.all the hardware identifiers imei imsi serial and mac address as well as the androidid are leaked more by libraries thanown code respectively .foridentifiersadvertisingidandguid omittedfromthe tableforspace leaksweresubstantialbutbalanced 297third party vs. 291ownfor advertisingid and639vs.
631for guid.
this finding hardware id leaks are attributable more to thirdparty code than own code is important because it shows that apps could unwittingly be the source of problematic leaks e.g.
due to leaky libraries and could be unfairly blamed for leaks that apps own developersdid not introduce orwere notevenawareof.
.
leakiest libraries as mentioned previously libraries are a significant source of leaks.
summarizing leaks in libraries is non trivial however because ofcontext sensitivity aleakwouldmaterialize ornot depending on how an app invokes the library.
we illustrate this in figure onlibrary com.threatmetrix .whenthelibraryisinvokedfromthe jcpenney app top the imei is leaked hashed on line the imei isreadanditshash digest addedto hashmap.however whenthe library is invoked from the dunkinapp bottom the imei is leaked raw on line10the imeiisread andadded raw to httpparametermap .
therefore intable 9wepresenttheresultsofourlibraryanalysis of the libraries used in our apps we show the top leakiest for each library and each id we show the number of library methods that leak the raw id and the number of library methodsthatleakthehashedid.forexample library com.paypal has methods that leak the hashed imei methods that leak the raw imei methodsthat leakthe hashedimsi etc.
foreachlibrary wealsopresentthelibrary spurpose asindicatedonthe library swebsiteorgithubpage.note thatonlythree libraries are financial com.paypal com.tune com.adjust hardware id leaks are expected and allowed in these libraries.
however the analysis shows that most leaks are in non financial libraries the overwhelming majority of whichare advertisingandanalytics.
77algebraic datatype taint tracking withapplicationsto understandingandroid identifier leaks esec fse august 23 28 athens greece table third party libraries the number of methods leaking each id and the form of the leak h hashed r raw .
raw hardware leaks innon financiallibrariesshowninred.
library imei imsi serial mac androidid advid guid purpose h r h r h r h r h r r r com.paypal finance io.fabric analytics net.hockey.app analytics com.apps.flyer ads com.kochava ads com.threat.metrix analytics com.google ads io.intercom analytics io.branch analytics com.appsee analytics bo.app analytics com.tune finance com.segment analytics com.adjust finance com.leanplum analytics com.nielsen analytics com.iovation analytics com.startapp ads com.newrelic analytics com.mobvista analytics table9paintsagrimpictureoftheandroidlibrarylandscape when it comes to privacy advertising and analytics libraries make heavyuseofhardwareids butthisuseappearsaimedatidentifying users and devices rather than preventing fraud.
ironically financiallibraries com.tuneandcom.adjust areamongthemostprivacyfriendly libraries leastintensive usersofhardware ids .
.
leakiest apps weexaminedthe leakiest appsinlightofthegoogleguidelines for acceptable use of hardware ids.
we focus on the top apps thatmanagetoleak allhardwareidentifiers raw .moreover manyof theseappsalsoleakhashedversionsofhardwareidentifiers leaking bothrawandhashedversionsisaconcernforde anonymization.
weshowtheresultsintable .foreachappweshowthepopularity the floor of the number of installs as indicated on google play onfebruary 25th the app category andthe listofleaks.
we identified those apps that have a legitimate financial reason tousehardwareidsasfollows appsthatareinthefinancecategory orappsthatlinkwithafinanciallibrary andtheleaksareduetothe library third party coderatherthantheappcode.theappsthat didnotmeettheseconditions showninredinthetable potentially violateidusageguidelines.ourapproachdistinguishesbetween raw and hashed and between third party vs. own leaks helping spotpotentialviolations.incontrast anapproachthatmissesthese nuances might flag a substantial number of benign policy abiding apps as problematic i.e.
ahigh rateoffalse positives .
altogether ourdatasethad190appsthateitheruseafinancial library ortheappitselfisinthefinancecategory.theseappsmight needhardwareidentifierinformationforfraud abusecheckingpurposes soleaksfromtheseappscanbeaccepted.however outofthese190apps leakat leastone raw hardware idviaanonfinancialthird partylibrary whichisaconcern.
.
longitudinal study 2018vs.
to investigate whether apps are becoming more guidelinescompliant and privacy friendly we conducted a longitudinal study comparingthe2018versionsof1 appdatasetwiththeir2020 counterparts.
.
.
identifier centric study.
we first investigate how the prevalence use of a certain identifier has changed over two years.
we tabulatethefindingsintable .foreachid eachcodelocation third party tp orown o andeachleaktype hashedorraw we showthenumberofappsthataddedthatidleakwith andthe numberofappsthatremovedthatidleakwith .forexample for raw imei we have in third party code apps have added this leak and45appshaveremovedthisleak yieldinganetchangeof whereasinowncode 19appshaveaddedthisleakand59appshave removedthisleak yieldinganetchangeof .theresultsreveal several trends.
first the use of raw ids has decreased across the board noticethenegativenetfiguresforimei serial macaddress androidid.twogroupssawanincrease advertisingidandguid especially in own code as well as hashed own code androidid serial mac .theseresults alsocorroboratedbytheapp centric study in section .
.
indicate a move away from hardware 8we keep the values for advertisingid and guid in the table for uniformity since these idswerenot used in the hashed form to beginwith therewas nochange.
78esec fse august 23 28 athens greece sydurrahaman iulian neamtiu xinyin table leakiest apps.
non financial appswith no financial librariesshowninred r raw h hashed.
app installs category imei imsi serial mac andrid advid guid million r h r h r h r h r h r r spectrumtv entertainment cgtn news magazines gps navigation system maps navigation wifimap productivity bitcoin cryptonews finance cheapoair travel local greyhoundlines travel local jcpenney shopping cbsnews news magazines wendy s food drink zipcar maps navigation lyft rideshare maps navigation western union finance nj transit maps navigation curb the taxiapp maps navigation apartments.com house home carezone medical burger king food drinks fox now entertainment one dollar .
shopping sam s club shopping aaptiv health fitness letgo shopping amber weather weather blinkhealth rx .
medical table identifier centric studyresults changesinidentifier use.
imei imsi serial mac androidid advid guid tp o tp o tp o tp o tp o tp o tp o raw net hashed net identifiersandtoward resettableidentifiers and replacingraw withhashedvalues whichisencouraging.
.
.
app centric study.
the second part of our study is appcentric.
assuming the signature of an app in was s2018while in2020thesignatureis s2020 wecheckwhether s2020 s2018.we showhowournotionofsubsumptionallowsforflexibledefinitions hencewecangauge alongseveraldimensions whethertheapps have become more privacy friendly.
weshowtheresultsintable .westartwith andsubsumption e.g.
e s e s rindicates a reduction in hardware identifiers wefoundthat108appsexhibitthiscondition whichisencouraging asitmeansdroppingtheuseofoneormorehardwareidentifiers.
when relaxing the subsumption notion to allow for increases insoftwareids wefoundafurther11appsthatexhibitthiscondition which is still positive as the use of software ids is preferred to the useofhardwareids.wealsoshowthenumberofappsthatdrop eachid imeiandmacaddressarethemost droppedhardware identifiers and apps respectively while androidid was droppedby107apps.
hash subsumption e.g.
e h id e id indicates that the apphasswitchedfromleakingtherawidtoleakingthehashedid.
whilefewapps exhibitthissubsumption forhardwareids for androidid itisneverthelessaprivacy gain.
reverse subsumption.
finally apps were in the undesirable reverse subsumption situation at least one hardware id leak was addedinthe2020version.weshowthesefindingsinthelastfive rows of table .
of the apps thatwent from a hashed to a raw 79algebraic datatype taint tracking withapplicationsto understandingandroid identifier leaks esec fse august 23 28 athens greece table app centric study results subsumption kind informal definition and ofappsexhibiting subsumption.
kind subsumptiondefinition apps andhardware id leaksdecreased hardware id leaksdecreased software id leaksincreased raw imei leakremoved raw mac addressleakremoved raw serial leakremoved raw imsileakremoved raw androidid leakremoved 107hashraw hardware id leak hashedhw.id leak raw imei hashedimei raw imsi hashedimsi raw mac address hashedmac address raw serial hashedserial raw androidid hashedandroidid 20reversehashedhardware id leak raw hw.id leak hashedimei raw imei hashedimsi raw imsi hashedmac address raw mac address hashedserial raw serial leak themajoritydidsofortheimei 20apps whilefewerapps didsofor the imsi mac address andserial respectively.
toconclude thelongitudinalanalysisrevealsanoverallmove awayfromusage leaksofhardwareids towardresettableids and to smallerextent amove towardhashedhardware ids.
related work manystaticflowanalyzersforandroidhavebeendeveloped including amandroid dialdroid didfail droidsafe flowdroid and iccta .
a prior study found that a typicalanalyzertakesonaverage6minutesperapp onparwith ourapproach.mostofthesetoolsusethepredefinedsourcesand sinkslistfromsusi withthebinarygoalofdecidingwhether a source flows to a sink this renders the results quite imprecise limitingtools usability.
otherstaticflowanalyzersforandroid whosegoalisstilldeciding whether a source flows to a sink improve precision over the aforementioned analyzers at the expense of running time.
for example p taint is a datalog based static information flow analyzer.
their evaluation like ours include popular android apps such as facebook messenger or google chrome .
thanks to additional features such as taint transfer and sanitization p taint achieves higher precision andrecall.
horndroid focusedonimprovingtheprecisionofexisting staticanalysesbydeterminingwhetherasinkwillbereachedby taintedflows andrefiningbranchconditionstoavoidfalsepositives.
however horndroiddoesnotallownamingsources aswedowith thesevenids sotheirapproachisnotdirectlycomparabletoours.
droidinfer usesacontext sensitiveinformationflowtype systemtoimprovestaticanalysisprecisionandscalability andsupports analysis oflibraries their focus is on sensitive data leaks tonetworkor logs .
evaluationontopgoogleplayapps shows highprecision fp .droidinfer sgoalisintuitivesource sink trackingratherthanalgebraic signatures andid ab usestudies.
myersandliskov slabelmodel jif dlm describes unions of labels set union i.e.
and in our model.
our xors not supported in jif would be set disjoint union.
while we do not support labelpolymorphismasjifdoes polymorphismwouldonlyhelpif therewascrossfirst partytothird partyflowwhichwedidnotfind section4.
.
stefanetal.
s disjunctioncategorylabels are defined as conjunctions and disjunctions on principals can flow as logical implication governs safe information flow.
they implement dclabel static a prototype information flow control in haskell but no evaluation is provided.
montagu et al.
introduced label algebras asetoflabelsthatformapre lattice i.e.
withapre order the term algebraic in our work from algebraic data types refers to the product and sum operations on types .
the focus of these approacheswastheformalism flow model.incontrast forus the algebraic taint representation is a conduit to implementing a static analysis forandroidand conductingsixstudies on 000top apps.
maps distinguishes between first party and third party id leaks by the call site of sensitive api methods but does not performtainttrackingorstaticanalysis understandableforthescale apps .
this is prone to false positives e.g.
id retrieving calls indeadcode orids whichare read but not used leaked.
thetaintdroid dynamictainttrackerhasexposedthatlocationandphoneinformationareroutinelyleakedtoadvertising and content servers.
taintdroid s focus is on efficiently tracking taintwithinanappandtheandroidos whereasweperformstatic tracking and within the confines of theapp only.
taintdroid does not distinguishbetween raw andhashedleaks.
dynamic taint analysis has different goals compared to us reduce false positives or track which servers packets go to which is impossible with our approach .
our static approach aims to reduce false negatives and allows analysis at scale.
dynamic analysis in general needs to overcome two issues low coverage and signing insuccessfully thisisproblematic in cases such as the western union banking app which requires awestern union customer account as do otherapps intable .
conclusions we introduce an algebraic taint representation that solves a key problemwithexistingtaint analyses distinguishingbetweenprograms that leak data in ways that are similar on the surface but verydifferentunderneath.weimplementedalgebraictainttracking asastaticanalysisforandroid anddemonstrateitseffectiveness throughsixstudiesonidentifier ab useintopandroidappsand libraries.
we found that being able to capture subtle yet critical differencesiskeyforunderstandingappbehaviorw.r.t.userprivacyor abidingbydeveloperguidelines.ourlongitudinalstudyshowsthat over the pasttwoyears apps have become more privacy friendly.