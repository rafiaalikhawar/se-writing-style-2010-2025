synthesizing object state transformers for dynamic software updates zelin zhao yanyan jiang chang xu tianxiao guy xiaoxing ma state key laboratory for novel software technology and department of computer science and technology nanjing university china yalibaba group sunnyvale ca usa abstract there is an increasing demand for evolving software systems to deliver continuous services of no restart.
dynamic software update dsu aims to achieve this goal by patching the system state on the fly but is currently hindered from practice due to non trivial cross version object state transformations.
this paper revisits this problem through an in depth empirical study of over class changes from tomcat .
the study produced an important finding that most non trivial object state transformers can be constructed by reassembling existing old new version code snippets.
this paper presents a domain specific language and an efficient algorithm for synthesizing non trivial object transformers over code reuse.
we experimentally evaluated our tool implementation pasta with real world software systems reporting pasta s effectiveness in succeeding in .
non trivial object transformation tasks compared with the best existing dsu techniques.
index terms software maintenance and evolution dynamic software update object transformation program synthesis.
i. i ntroduction dynamic software update dsu updating software at runtime without restarting is a trending feature in modern software systems.
dsu keeps systems up to date with security patches bug fixes and feature upgrades without hurting the systems availability.
dsu has become increasingly practical and compelling linux kernel and microsoft windows are already dynamically updatable to some extent java virtual machine jvm has been modified to partially support application updates live upgradable components are also emerging in databases servers and even mission critical systems .
despite that code can be hot upgraded in emerging systems automatically updating runtime states for seamless system evolution remains a major research challenge .
software updates may include a field of a class being added removed or semantically changed in a new version.
in dsu such field values if not removed should be re computed to match the new version code s semantics.
this is known as the object transformation problem whose solution typically relies on a key mini program a.k.a.
atransformer for computing these field values at update time.
to understand the challenges in object transformation this paper empirically studied uniform randomly sampled commits consisting of class changes from apache tomcat one of the most popular web backend systems.
our major findings include almost all or .
class changes can be updated dynamically indicating that dsu is broadly applicable.
even for a few cases or .
that dsu is impossible over existing programs proper refactoring could still make them updatable .
most or .
updates involve trivial object transformations over simple predefined rules.
existing dsu systems are already capable of automatically updating these changes without developers intervention.
the rest not many but a non negligible portion of class changes or .
require non trivial object transformations.
software developers without a dsu background would have substantial difficulties in specifying them as the required transformers have to carefully manipulate two versions of program states simultaneously.
the empirical study results suggest that the key obstacle that hinders the continuous and automatic deployment of dsu in practice is probably how to obtain non trivial object transformers.
unfortunately this circumstance has not been seriously recognized by existing research.
in fact our later experiments show that state of the art techniques like tos andaotes could only succeed in and out of nontrivial object transformation tasks.
their apparent high success rates in past experiments might be due to mixing non trivial transformers with many trivial ones.
in this paper we leverage another key empirical finding that object transformers can be constructed by reassembling existing old new version code to establish an algorithm for synthesizing object transformers in the dsu of java applications.
the algorithm exhaustively and heuristically enumerates all possible combinations of extracted code snippets producing both testpassing and developer readable object transformers.
a key advantage over existing techniques is that an application developer can easily verify synthesized transformers correctness because application code is their major constructs.
we implemented our algorithm as the pasta pa tch sta tes tool for dsu of java programs.
the evaluation results over a set of non trivial class changes including those in the empirical study and more were encouraging pasta synthesized .
correct non trivial object transformers .
compared to the best existing techniques tos andaotes .
and .
respectively .
in summary this paper s major contributions are recognizing the non trivial object transformer synthesis as a critical problem ieee acm 43rd international conference on software engineering icse .
ieee in dsu and providing it with an effective approach.
the rest of the paper is organized as follows.
section iigives the necessary background knowledge of dsu with a motivating example.
section iiipresents a comprehensive study on dsu of class changes in tomcat .
our dsl and synthesis algorithm are elaborated on in sections ivand v respectively.
the evaluation of pasta against real world updates is described in section vi followed by threats to validity discussions in section vii related work in section viii and conclusion in section ix.
ii.
b ackground and motivation a. dsu systems and object transformation this paper focuses on the dsu of java programs1 which consists of the following four steps pause the program under update at a safe point e.g.
when all updated code is popped off the stack .
upgrade the changed code via dynamic linking live patching or hotswap .
transform stale old version objects in the heap to their new state .
resume the updated program s execution.
the new version is now ready to serve.
object transformation the third step is this paper s primary focus.
when a program is paused at an update safe point with code being upgraded the heap may contain stale objects whose values are inconsistent with the new version code.
a dsu system must for each such object invoke its transformer to migrate to its corresponding new version.
b. motivating example figure 1lists a class change to socketprocessor which requires a non trivial transformation.
this class change replaces thesocket field by kawith a type change from niochannel tokeyattachment lines .
we correspondingly provide an object transformer dsuhelper.transform lines .
the status field undergoes a default ortrivial transformation it inherits its value from the old version line .
a default transformation copies the old version value for a type unchanged field or assigns a default value e.g.
for int andnull for