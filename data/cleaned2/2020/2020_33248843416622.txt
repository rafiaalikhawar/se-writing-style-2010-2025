deeptc enhancer improving the readability of automatically generated tests devjeet roy devjeet.roy wsu.edu washington state universityziyi zhang ziyi.zhang2 wsu.edu washington state universitymaggie ma yuzhanm amazon.com infra supply chain automation amazonvenera arnaoudova venera.arnaoudova wsu.edu washington state university annibale panichella a.panichella tudelft.nl delft university of technologysebastiano panichella panc zhaw.ch zurich university of applied sciencedanielle gonzalez dng2551 rit.edu rochester institute of technologymehdi mirakhorli mehdi se.rit.edu rochester institute of technology abstract automatedtestcasegenerationtoolshavebeensuccessfullyproposed to reduce the amount of human and infrastructure resources requiredtowriteandruntestcases.however recentstudiesdemonstratethatthereadabilityofgeneratedtestsisverylimiteddueto i uninformativeidentifiers and ii lack of properdocumentation.
prior studies proposed techniques to improve test readability by eithergeneratingnaturallanguagesummariesormeaningfulmethods names.
while these approaches are shown to improve test readability they are also affected by two limitations generated summariesareoftenperceivedastooverboseandredundantbydevelopers and readable tests require both proper method names but also meaningful identifiers within method readability .
in this work we combine template based methods and deep learning dl approachestoautomaticallygeneratetestcasescenarios elicited from natural language patterns of test case statements aswellastotraindlmodelsonpath basedrepresentations of source code to generate meaningful identifier names.
our approach called deeptc enhancer recommendsdocumentationand identifier names with the ultimate goal of enhancing readability of automatically generated test cases.
anempiricalevaluationwith36externalandinternaldevelopers shows that deeptc enhancer outperforms significantly the baseline approach for generating summaries and performs equally with the baseline approach for test case renaming the transformation proposed by deeptc enhancer results in a significant increaseinreadabilityofautomaticallygeneratedtestcases and there is a significant difference in the feature preferences between external and internal developers.
acm reference format devjeetroy ziyizhang maggiema veneraarnaoudova annibalepanichella sebastiano panichella danielle gonzalez and mehdi mirakhorli.
.
deeptc enhancer improving the readability of automatically generated tests.
in35th ieee acm international conference on automated software ase september virtual event australia copyright held by the owner author s .
acm isbn .
ase september virtual event australia.
acm new york ny usa pages.
introduction softwaretestingisacrucialpartofthesoftwaredevelopmentlife cyclethatensuressoftwaresystemqualityandreliabilityproperties .
however writing tests is a resource intensive endeavor developers often spend of their development time on software testing .tohelpreducethecostoftesting softwareengineering researchers have developed several approaches to generate testsautomatically.
a significant amount of progress has been made primarilyinthecaseofunittests.today thereexistseveraltools such as evosuite and randoop that can automatically generate an entire test suite given a project s source code or bytecode .
the maturity of the field also resulted in surveys and several editions of tool competitions .
furthermore empiricalstudiesshowedthatthetestssynthesizedbythesetools areeffective atdetectingfaults andaresubstantiallycheaper to produce .
despitetheseadvances generatedunittestsposeasignificant maintenanceburdenwhenincludingtheminaproject .this is because developers have to manually validate the generate assertions oracleproblem andanalyzethethrownexceptions potential crashes .
these automatically written tests have poor readabilitycomparedtotheirhuman writtencounterpartsdueto thelackofdocumentationandtheuseofobfuscatedvariablenames.
consider for example the test case in figure which is automaticallygeneratedusingevosuite fortheclass keycloakuribuilder fromthekeycloakopen sourceproject.whilethetestmethodis concise itspurposeisnotimmediatelyobvious.thevariablenames have no clear purpose and just tell us the types of the instantiated objects and primitive types and their counts.
besides the name of thetestinitselfisgeneric andtherearenocommentstoprovide any hints about the scenario under test.
inrecentyears researchershaveproposedvariousapproaches topartiallymitigatetheseissues.therelatedworkcanbeclassified into two main categories generating natural language summaries to support comprehension and improving the test code for better readability.
panichella et al.
proposed a templatebased summary generator for automatically generated tests.
their empiricalstudyshowedthattestsummarieshelpdevelopersduring debugging i.e.
finding more bugs and in less time.
daka et al.
35th ieee acm international conference on automated software engineering ase this work is licensed under a creative commons attribution international .
license.
figure a unit test generated by evosuite.
proposed a technique to generate descriptive test names based on code coverage heuristics.
their empirical study showed that humansperceivethesynthesizednamesasdescriptiveasmanuallywrittentestnames .whilethesetwoapproachesaddressthe testreadabilityproblemindifferentandcomplementaryways theybothhavesignificantlimitations.first developersoftenperceivethe generatedsummariesastoodetailed statement levelcomments and redundant they also do not solve the nondescript naming convention developers feedbackreportedin .furthermore the approach from daka et al.
considers only test method names while the actual content of the test methods remains unchanged.inotherwords thereadabilityofthegeneratedtestsisstillaffectedbymeaninglessidentifiernames e.g.
string0 infigure1 .
to address these open challenges we propose a two stage approach called deeptc enhancer thatcomprehensivelyimproves the readability of automatically generated unit tests.
first deeptcenhancer automaticallygenerates testcasescenarios usingatemplatebasedapproach.thesescenariosaremethod levelsummaries i.e.
leading comments that aim to summarize the steps i.e.
the scenariobeingsetupandtestedbyagiventestcase.ourtestscenariosdifferfromthosegeneratedbyexistingapproaches in the level of abstraction they are more high level method levelas opposed to statement level and therefore more concise.
therationale is that higher level summaries will quickly provide developers with enough information to decide whether the given test case needs to be further investigated for the task at hand.
second deeptc enhancer reliesonextremecodesummarizationtechniques based on deep learning to rename all identifiers in the test casewithmeaningfulnames.wehypothesizethatsuchrenaming can significantly increase the readability of these test cases and ease program comprehension and test maintenance activities.
specifically our contributions can be summarized as follows a novel approach for generating natural language scenarios ofjunittestcases.
deeptc enhancer generatestestmethodlevel summaries that describe the test case scenarios.
anoveladaptationofanexistingidentifierrenamingtechniqueappliedinthecontextofunittestsinjavaandadapted to remove its reliance on existing identifier names.
an empirical evaluation of deeptc enhancer using internal and external developers including a comparison to existing approaches .
figure overview of deeptc enhancer.
areplicationpackage1thatincludes aprototypeimplementationoftheproposedapproach internalandexternal developer surveys and the data used for the evaluation.
paper structure.
section details of the implementation of deeptc enhancer .
section provides an overview of the study designandresearchquestions.section4discussestheresults while threats to its validity are discussed in section .
section provides an overview of the related work and contrasts the work proposed heretothestate of the artapproaches.finally section7concludes the paper and outlines directions for the future work.
the deeptc enhancer approach figure2depictstheproposed deeptc enhancer whichisdesigned toautomaticallygeneratemethod levelsummariesandautomatically rename identifiers contained within leveraging i existing approaches on code summarization and ii deep learning techniques.
inthissection weelaboratethesesteps detailing deeptc enhancer s approach whichconsistsoftwomainphases testcasescenariobased summaries and test case identifier renaming.
.
test case scenario based summaries at a high level the summary generation phase starts by analyzing each line of code to filter out redundant information.
then the remainingstatementsareaggregatedtoallowtheactualgeneration of the method level summary.
following is an in depth description of each step in the summary generation phase.
.
.
statement analysis.
we analyze all statements in the generated test case looking for opportunities to reduce redundancy.for this we employ intra and inter statement heuristics.
intrastatement heuristics determine whether details can be removed from within a single statement.
for example if a statement containsamethod callwithmorethanoneargument weremovethe details about the parameters of the method call.
inter statement heuristics determine which statements should be summarized.
for example if a temporary variable is created in a test case as a placeholder then its creation does not need to be summarized as shown 288infigure3wherethevariableinline21isnotpartofthesummary.
anotherexample alsoshowninfigure3 iswhenmultiplevariable declarations l. can be summarised in one sentence l. .
the rationale here is that providing detailed information about every statement brings the summary too close to the actual source code.instead wehypothesisethatifdevelopersneedmoreinformation theywillrefertothesourcecodetoprocureit.thus the summaries that deeptc enhancer generates are intended to guide developersinidentifyingrelevanttestsfortheirmaintenanceactivity rather than to convey detailed information about the tests.
figure3 exampleoftestcasescenario basedsummarygenerated by deeptc enhancer.
.
.
statement aggregation.
once redundancy has been reduced deeptc enhancer aggregatestheremainingstatementsintoafinal summary.
to this end deeptc enhancer takes a template based approach as templates have been shown to be successful for the generation of summaries .deeptc enhancer uses a set ofheuristicsthatwecraftedbymanuallyinvestigating293junit testsfilesfromover31open sourceprojects.duringthismanual investigation process we identified several common sequences of statements that appear in unit tests and that can be summarized by a single statement.
for example a common pattern is the use of severalassertionsverifyingdifferentpropertiesofatargetobjectasshown in figure .
in this example the last two assertions l. can be aggregated into a single phrase checks if port is and host is not null .
another common pattern is a method invocation and an assert statement on the same object as shown in figure l. and which are summarized as one step step in the test case scenario.
the comment in figure represents the summary generated by deeptc enhancer.
theaggregationisperformediteratively resultinginaggregated statementsthemselvesbeingcombinedwithotherswhenapplicable.
weuseasimpleabstractiontoenablethisbehavior eachindividual or aggregated statement is assigned an objectand anaction.
when testcasestatementsdonotfallundertheseaggregationpatterns we simply provide the statement level scenarios.
our templatescover of the statements in the automatically generated tests from the projects described in section .
.
.
.
.
identifier renaming for the identifier renaming phase of the proposed approach we leverage and adapt existing deep learning approaches for extreme source code summarizations .
the identifier renaming process consistsof twoseparate prediction tasks test caserenaming and variable renaming.
there exist several techniques that haveachievedsubstantialsuccessinbothofthesetasks .
recently deeplearningtechniqueshaveachievedstate of the art performance forpredicting the methodname from the body of amethod.
conversely structured prediction has been successfully appliedtothetaskofclarifyingvariablenamesfromtheobfuscatedcode .motivatedbythesuccessofmachinelearningmodelsfor thesewellknowntasks wedividetheidentifierrenamingaspect of our approach into two learning tasks test case name prediction and variablename prediction.wetrain themodel onopen source projects asdetailed insection .
.
and then useit topredict test case and variable names for automatically written tests.
the ra tionale is that if the model can learn to predict identifier names usedinhumanwrittentestcases itwouldbeabletopredictsimilar names for automatically written tests.
one key difference between this and prior works for these tasks isthatourmodeldoesnotrelyonvariablenamesalreadypresented in the source code.
this is important as our approach is being applied to automatically generated test cases that lack meaningful variablenames.forboththevariableandthetestcaseprediction tasks thisisdonebymaskingallvariablenamesduringthetraining of the model we mask the variable that needs to be renamed with a special token.
.
.
source code representation.
one of the most important considerationswhendesigningamachinelearningsystemforsoftware systems is source code representation.
in practice this can varyfrom simplistic representations of source code as a stream of tokens to more structured graph based representations .
our rationale for the selection process is two fold cost the cost of generating the representation should be minimal in order to incorporate this tool as an ide plugin.
dependencies the source code representation must be generated solely from the raw text of the given test case.
we imposethisconstrainttominimizetheconfigurationburden on the developer end.
basedonthesecriteria weuseapath basedrepresentationwhich alonetal.proposed andappliedforvarioussourcecodesummarization tasks .
in this approach a section of source code is represented as an unordered set of abstract syntax tree ast paths.
each path represents a walk between two leaves in the ast of aprogram.
we direct readers to for detailed treatments and formalized definitions.
at the time it was proposed this path based representation producedstate of the artperformanceforseveralsummarizationtasks.
2detailsregardingtheaggregationsandtheirassociatedtemplatescanbefoundinthe replication package 289since then other approaches have been proposed that utilize alternativeabstractsyntaxtreerepresentations oruseahybrid approach that combines an ast representation with a textual representation with varying levels of performance.
we chose the path based representation because it is very cheap to compute and offersalevelofgeneralizationthatenablesittobeappliedunmodified to our two learning tasks variable name prediction and test case name prediction.
.
.
machine learning model.
many of the advances made in codesummarizationoverthepast5yearsframetheproblemasa translationproblem i.e.
translatingsourcecodetonaturallanguage.
this formulation allows for the use of a vast variety of approaches dealing with sequence transduction developed for neural machine translation nmt systems.forbothofourlearningtasks weadapt the model proposed by alon et al.
.
this model follows the standard encoder decoder architecture that until recently has been primarilyutilizedinnmtsystems.themaindifferencebetween themodelproposedbyalonetal.andthestandardencoder decoder architecture is that it is designed to use the path based representationdiscussedintheprevioussection.themodelusesaspecialized encoder to create a distributed representation of each ast path which is then merged with token embeddings for the two terminal nodes of the path.
this is then used by the decoder to sequentially generate the target prediction.
.
.
token representation.
originally code2seq utilized subtoken embeddings to represent source code tokens.
in this approach tokensinthesourcecodearesplitintosubtokens.recently karampatsis et al.
show that the use of subword embeddings such as byte pair encoding bpe can significantly decrease the size of the vocabularyandimp rovethep erformanceofmachinelearningmodels inthe contextof sourcecode tasks .
hence for thiswork weutilizesentencepiecebpe basedvocabulary.forthelabel methodorvariablenames subtokens welimitthevocabularysize to16 andfortheterminalnodesubtokens anyidentifierthatis not a variable or method name we limit the vocabulary to .
.
.
dataset.
deep learning approaches are typically data inefficient requiringalotoftrainingdata.however wemustensurethat our predicted identifier names would be of high quality.
manual validation of the dataset is not feasible due to the scale of data we neededto collect.toensureonly engineered softwareprojectsare consideredforthiswork weusedthedatasetmunaiahetal.generated using reaper .
this dataset includes quality metrics for eachproject.weusedthistofilterdatasetforprojectswithatest tosourcecoderatiogreaterthan0.
.weselectedthisthresholdusing descriptivestatisticstofindacompromisebetweenthequalityof theunittestsandthesizeoftheresultingdataset.afterfiltering weextractedalljavafilesthatstartorendwith test whichisa common naming convention for unit test files.
the final dataset consists of engineered projects containing unit test files for a total of unit test cases.
we divided the dataset into training validation and test set for our model.
.
.
examples of suggested names.
fortheautomaticallygenerated test shown in figure deeptc enhancer suggests testuri as test name and primarykeyuri uribuilder and hostfor variables uri0 l. keycloakuribuilder0 l. and string0 l. respectively.
figure test case from figure enhanced usingdeeptc enhancer.
for the example shown in figure deeptc enhancer suggests thetesttoberenamedto testgetgroup andvariables loggergroups0 l. hashmap0 l. linkedlist0 l. and loggergroup0 l. to be renamed to logger expected string and result respectively.
figure4andfigure5showthetestcasesfromfigure1andfigure3 with suggested method name and variable names generated by deeptc enhancer.
figure test case from figure enhanced usingdeeptc enhancer.
study definition and design .
research questions thegoalofthisstudyistoevaluatetheabilityof deeptc enhancer to improve the readability of automatically generated test cases using test case scenarios and identifier renaming.
the quality focus is the evaluationoftool sperformancefromtheperspectiveofdevelopers.
theperspective of the study is developers who are interested in using automatically generated test cases but struggle with their readability.hence thestudyisdesignedtoanswerthefollowing research questions rqs rq1 howdoes deeptc enhancer performcomparedtoexisting techniques?
severalotherapproachesaimtoimprovethereadability ofautomaticallygeneratedtests bycreatingtestcasesummaries or byprovidingmoremeaningfultestnames.as deeptc enhancer enhancesboththedocumentation byaddingmethod levelsummaries 290and code by renaming identifiers of generated tests we compare itsperformanceagainsttheexistingapproachesforthatgenerate both.forthisrq weusethedatasetsusedintheoriginalevaluations of existing approaches to survey external developers.
rq2 towhatextentdoes deeptc enhancer increasethereadabilityofthegeneratedtests?
automatictestcasegenerationrequires fewerresourcesthanthestandardmanualefforts.however they incur a higher maintenance effort due to their poor readability.
for this rq in addition to external developers we also perform an evaluation with internaldevelopers to gain insighton how useful developers might find deeptc enhancer in their day to day work.
for this rq we use a dataset that we collected consisting of top starred java projects on github.
rq3 what aspects of deeptc enhancer do developers find most useful?we aim to assess whether developers perceive some enhancements applied by our approach more useful than others.
for this rq we use the same developer pool and dataset as in rq .
.
baselines to the best of our knowledge deeptc enhancer is the first approachtoapply bothautomateddocumentationandtestcodeenhancement viaidentifierrenaming towardsimprovingthereadabilityofautomaticallygeneratedtestcases.however thereareapproachesthatimprovedindividuallyoneortheotheraspects.hence wecomparethetestscenariosgeneratedby deeptc enhancer with thetestcasesummariesgeneratedby testdescriber pr oposedby panichella et al.
.testdescriber automatically generates test case summaries of the portion of code exercised by each test to provideadynamicviewoftheclassundertest.thegeneratedsummarieshavebeenshowntohelpdeveloperstobetterunderstand the code under test and improve their bug fixing performance .
wecomparethetestcasenamesgeneratedby deeptc enhancer with the names generated by daka et al.
s approach .
the later synthesizesdescriptivenamesforautomaticallygeneratedunittests in terms of their observable behavior at a test code level.
this technique has been implemented as an extension to evosuite.
.
experiment design toanswerourresearchquestions weconducttwoonlineempirical studies involving internal and external developers.
section .
.
provides detailed information about the participants and their programming experience.
we recruited participants via e mail and socialmedia.foreachinternaldeveloper wecreateaspecificversionofthesurveyfortheopen sourceprojectforwhichtheyare listed as a contributor.
the use of an online questionnaire was preferredoverin personinterviews asitismoreconvenientforthe participants.eachsurveystartsbygatheringdemographicinforma tion.thenparticipantsareaskedtorespondtoaseriesofquestionsregardingthegeneratedsummaries methodrenaming andvariable renaming.thesurveyalsocontainedopen endedfeedbackforms aftereachquestionto allowthedeveloperstoprovideadditional insight into their responses.
.
.
objects.
weusethreedifferentdatasetstoevaluatedifferent aspects of deeptc enhancer testsummaries weusedthedatasetusedbypanichellaetal.
tocomparethetestcasesummariesgeneratedby deeptc enhancertable experience of participants.
external internal experience years years years years total and testdescriber in the survey with external developers.
the datasetconsistsoftwojavaclassesextractedfromtwoopen source projects.
we use this dataset to answer rq r q2 and rq .
methodrenaming dakaetal.
followedasystematicprotocol toselectobjectsfromthesf110corpus3ofopen sourcejava projects.theyselectedtentargetmethodsfromdifferentclasses.
we use data from this dataset to answer rq r q2 and rq .
variable renaming and evaluation of the overall approach we use the most starred open source java projects from github.
we use the same dataset to recruit internal developers for our evaluation.
this dataset was used to evaluate the quality of the suggestedvariablenamesandtheoverallapproachthatincludes the generated summaries method names and variable names.
it is used to answer rq 2and rq .
.
.
participants.
werecruitedbothexternaldevelopers i.e.
peoplethathavenotdevelopedthecodeunderinvestigation andinter naldevelopers i.e.
contributorsoftheprojectsweareanalyzing.weinvitedexternaldevelopersfromindustry students andresearchers from the authors institutions as well as from other institutions by e mail and social media.
for our study with internal developers we invited top contributors from the most starred open source javaprojectsfromgithub.attheend 30externaland6internal developers responded to our surveys.
table details the participants programming experience.
all participants have a computer science background.
they were all volunteers and did not receiveany reward for participation in the study.
.
.
surveys.
we performedtwo differentsurveys onewith externalandonewithinternaldevelopers.herewebrieflydescribe the surveys more details can be found in our replication package.
external developers survey the purpose of this survey is to evaluate several research tools developed to enhance the readability of generated tests.
we create two versions of the survey to contain differentcodesnippetswhicharerandomlyselectedfromthecorresponding datasets.
participants are randomly assigned to a survey and asked to evaluate the enhancements using different criteria.
thesurveyconsistsof17questionsdividedintofoursections there is also optional feedback forms intended to allow participants to elaborateontheiranswers.insection1 participantsareaskedto evaluate the quality of the test case summary generated by ourapproach and the baseline testdescriber .
in section they evaluate the quality of the test names suggested by our tool and bytheworkofdakaetal.
.sections3containsanevaluation of the variable renaming in isolation and section contains an evaluationoftheoverallapproach.tominimizeorderandsequence 291effectsaswellasotherbias forsections1and2 theidentityofthe tools is not revealed and the order in which the summaries and method names are presented is randomized.
internal developerssurvey thegoal ofthis surveyisto evaluate the usefulness of deeptc enhancer for software developers.
for alldevelopersthatindicateaninterestinparticipating wecreate a unique survey even if there is more than one developer for a particularproject.thesurveyconsistsof16questionsandoptional feedbackformsdividedintofoursections.threeofthesesections evaluate the test case scenario method renaming and variable renaming inisolation while the last section containsan evaluation for the complete approach.
the same automatically generated test case is used for each of these sections.
.
evaluation metrics similartorelatedwork thequalityofgeneratedsummaries is evaluated according to three dimensions conciseness content andreadability.
concisesummariesdonotincludeextraneous or irrelevant information.
contentmeasures whether the summary correctly reflects the content of the test case.
readability measures to what extent a test case including the generated enhancements is perceived as readable and understandable by the participants.inaddition participantsevaluatehowthe intentofthe test case are captured by the suggested test case name and variable names.
participantsalso ratethe naturalness of thesuggested test casenamewhichindicateshoweasyitistoreadandtounderstand it.finally participantsareaskedtoratethe improvementinreadabilityof the code snippet enhanced using deeptc enhancer over the original automatically generated test and their likelihood toutilize deeptc enhancer if they were to use automatically written tests.
depending on the question participants express their opinions using a or point likert scale.
.
analysis method we used statistical tests to assess the significance of the difference betweenthescoresachievedbydifferenttools.weusethewilcoxon ranksumtestwithasignificancelevelof .
.weoptedfor non parametrictestsbecausetheshapiro wilktestrevealedthat our data scores does not follow a normal distribution p value .
.
besides we use cliff s deffect size to measure the magnitudeofthedifference whichcanbeinterprettedasfollows smallford .
mediumfor .
d .
andlargefor d .
.
results .
rq1 how does deeptc enhancerperform compared to existing techniques?
.
.
test case summaries.
for the reader to get a sense of the summaries generated by different tools we present examples of summariesgeneratedby deeptc enhancer andtestdescriberin figure and figure respectively for the same unit test.
figure showstheresultsoftheevaluationoftheproposedtestcasescenar ioswhencomparedwithtestdescriber .intermsof conciseness respondents rated test case scenarios as containing no unnecessaryinformation whileontheotherhand rated figure results from the comparison ofdeeptc enhancer and testdescriber for method summaries on a point likert scale higher numbers are better .
figure example summary generated by testdescriber.
figure example summary generated by deeptc enhancer.
testdescriber s summaries as having no unnecessary information.
foreitherapproach 9respondentsfoundthatthesummariescontain some unnecessary information.
only respondents found test case scenarios to contain mostly unnecessary information as comparedto3 respondentsfortestdescribersummaries.interms ofcontent adequacy test case scenarios scored better overall with respondentsreportingthemtocontainallimportantinformation while and respondents reported them to be missingsomeimportantinformationandmissingsomeveryimportant information respectively.
on the other hand testdescriber s 292summaries werereported tocontain allimportant information by respondents missingsomeimportantinformationby11 and missing some very important information by respondents.lastly onthecriteriaof readability mostrespondents found testcase scenarios to be eithereasy or somewhat easy to read while only one respondent rated it as being difficult to read.
testdescriber s summaries were reported by to be easy to read somewhat easy to read by and difficult to read by .
overall respondents preferred test case scenarios to testdescriber s summaries while preferred neither.
from a statistical point of view the results of the wilcoxon test revealedthatthetestscenariosgeneratedby deeptc enhancer are perceivedbyparticipantsassignificantlymoreconcise p value .
andmorereadable p value .
comparedtothesummariesby testdescriber.theeffectsizeis mediuminbothcases being0.
and0.
respectively.instead thereisnosignificantdifferencein terms of quality of the content p value .
.
discussion acrossallthreecriteriaevaluatedinthesurveyon external developers test case scenarios performed better than testdescriber s summaries.
based on our qualitative analysis of the respondents weattributethesehigherratingstotestcasescenarios being shorter and less detailed than the summaries provided by testdescriber.while deeptc enhancer provideshigh levelsummaroesoftestcasesatthemethod level thelatterinsteadprovides detailed line by line summaries.
some respondents indicated that detailed comments is redundant as reading the source code that follows each statement summary would provide them with the sameinformation.thissentimentwasechoedbyanotherparticipantstatedthatthetestcasescenariowas concise easytoread whereasthefortestdescribersummarytheycould tellfromthe code what it does .
however while overall deeptc enhancer is receivedbetterthantestdescriber tworespondentsdidnotseethe value in the summaries.
figure results from the comparison ofdeeptc enhancer and daka et al.
s approach for test case names on a and points likert scales for intentand naturalness respectively higher numbers are better .
figure example test case that needs renaming.
.
.
test case names.
resultsforthecomparisonofdakaetal.
s method naming approach to deeptc enhancer s method renaming are shown in figure .
more survey respondents found the method names provided by daka et al.
s approach to fully capture the intent of the test case as compared to those suggestedby deeptc enhancer .
respondentsreported that the names suggested by deeptc enhancer either mostly capturetheintentofthetestcaseascomparedto5 fordakaet al.
sapproach.ontheotherendofthespectrum respondents reported the name generated by deeptc enhancer as not capturing the intent of the test case while reported the sameforthebaselineapproach.asimilarnumberofrespondents versus reported that the test case names proposed by either approach were misleading in conveying the intent ofthe test case.
with regard to readability the names suggested by deeptc enhancer wereperceivedasslightlymorereadablethan thosesuggestedbythebaseline.
and6 respondentsreportedtheproposedapproachasbeingeasy somewhateasy and difficult to read respectively while and reported the same for data et al.
s approach.
lastly respondentseachindicatedapreferenceforeithertool while indicated they preferred neither.
however the wilcoxon test revealed that there is not significant difference in quality between the test names generated by deeptc enhancer and the approach by daka et al.
.
more precisely there is no significant difference in terms of intent pvalue .
nor in terms of readability p value .
.
discussion overall daka et al.
s approach performs slightly better in terms of capturing the intent of the test case and slightly worseintermsofreadability albeitthedifferencesarenotstatistically significant.
despite that participants were equally likelytoprefernamesgeneratedbyeitherapproach.wepositthatthis preferencearoseoutoftheconcisenessof deeptc enhancer ssuggested names and conversely the excessive verbosity of daka et al.
sapproach.indeed severalrespondentsindicated thatthey pre ferconcisenessoververbosityfortestcasenames unlessincreased verbosity is required to address naming conflicts.
for example for the test case in figure daka et al.
s approach suggeststest name testvisitannotation withnonemptystringandfalse and deeptc enhancer suggests testvisitannotation .
we also observe from the responses that names suggested by deeptc enhancer might be perceived as too general.
one respondent stated thatthis can be a problem when multiple test cases are similar toone another.
lastly our results reveal that a significant portion i.e.
of the respondents did not prefer the method names fromeithertool.thisindicatesthatthemethodnamesgeneratedby both deeptc enhancer anddakaetal.havequitesomeroomfor 293improvements.
we surmise that respondents would prefer method names that combine some aspects of the verbosityof dakaet al.
s names whilealsoretainingsomeoftheconcisenessofthenames suggested by deeptc enhancer.
rq1externaldevelopersfindtheproposedtestcasescenarios generated by deeptc enhancer to be more concise content adequate and readable than the summaries generated by the baseline.
the difference is statistically significant for conciseness and readability with a medium effect size.
they also found the method names suggested by deeptc enhancer to be more concisethanthoseofthebaseline.intermsofreadabilityandintent the method names by deeptc enhancer and the baseline are statistically equivalent.
.
rq to what extent does deeptc enhancerincrease the readability of the generated tests?
.
.
overall approach.
we observe that respondents provided favorableratingsoftheproposedapproach simpactonthereadability ofautomaticallygeneratedunittests.13respondents reported thattheenhancementappliedby deeptc enhancer resultedina significant improvement in the readability of the generated test cases while11 reportedthat theincreaseinreadabilitywas minor.threerespondents indicatedthattherewasnochange inreadabilitywhile2 reportedthattherewasaminordecrease in readability.
no participant indicated there to be a significantdecrease in readability as a result of the enhancements providedby the proposed approach.
as to the likelihood of respondents using deeptc enhancer toenhanceautomaticallygeneratedtest cases wefoundthat6participants reportedthattheywere extremelylikelytouseit while16 indicatedthattheywere somewhatlikelytouseit.onerespondentindicatedthattheywere somewhat unlikely to use the proposed approach while two in dicated that they were highly unlikely to use deeptc enhancer .
lastly mostparticipants indicatedthatthe existenceof the proposed tool would make them more likely to utilize auto matedtestgenerationtools intheirprojects.7participants indicatedthattheexistenceofthetoolwouldhavenoeffectontheir choiceofusingautomatictestgenerationtools tworespondents indicated that deeptc enhancer was unlikely to have an effect on their choice to use these tools.
internal developers much like external developers positively ratedtheimpactof deeptc enhancer onreadability 6indicatea significantincreaseand2 6indicateaminorincrease.however they werenotaslikelyasexternaldeveloperstoutilize deeptc enhancer should theyuse automatictest generation with3 indicating they were highly or somewhat likely to use it neutral and either highly or somewhat unlikely.
lastly all participants indicated thatthepresenceof deeptc enhancer wouldnotmakethemmore likely to use automatic test case generation.
this is mostly because the generated tests do not match the code styles of their organizations.
.
.
test case scenarios.
we report the results of the evaluationoftheproposedtestcasescenariosbyinternaldevelopersin table .
respondents rated the test case scenarios generated bytable2 internaldevelopers feedbackontestcasescenarios generated by deeptc enhancer.
criteria rating resp.
conciseness no unnecessary information mostly unnecessary information content not missing important information missing some very important information readability easy to read understand somewhat easy to read understand table external and internal developer feedback on variable names suggested by deeptc enhancer.
ratingexternal internal fullyconveys intent somewhat conveys intent 18does not convey intent misleading with regard to intent deeptc enhancer favorablyintermsof readability andcontentadequacy butnotintermsof conciseness.thisissomewhatconsistent with the external developer responses reported in section .
.
.
however internaldevelopersratedtheconcisenessofthescenarios much lower than the external counterparts.
their concerns mirroredthoseofexternaldevelopers 1participantindicatedthatthey preferredreadingtheactualsourcecodeinsteadofthesummary commenttofigureoutwhatthetestcaseexactlydoes.theyalso were more specific about code quality standards for unit tests one developer indicated that a good test case should make it evident whatisbeingtested theywouldrathertheintentofthetestcase becontainedinthecodethanthecomments.ingeneral internal developerswerenotinfavorofhavecommentsthatdescribethe functionality of the test cases.
part of the reasons for that might be due to the fact that for the evaluation respondents were shown single test cases as opposed to the entire test suite generated byevosuite.
we hypothesize that developers will see more value inthe test case scenarios in the context of test case navigation.
we plan to perform such evaluation as part of future work.
.
.
test case names.
overall internal developers found the methodnamessuggestedby deeptc enhancer donotsuccessfully capturetheintentofthetestcasespresentedtothem.fourdevelopersindicatedthatthesuggestednameeitherdidn tcaptureintent orwasmisleading .however theyratedthesuggestednames favorably in terms of readability with indicating that it was easy to read or somewhat easy to read with the remaining developer indicating the name to be not easy to read.
this is once again similartotheresultsoftheexternaldevelopersurveyreportedin section .
.
.
.
.
variable names.
thesurveyresultswithexternaldevelopers for the variable names suggested by deeptc enhancer are shown intable3.overall participantsreportedthatthenamescapturetheintentofthevariableusagetosomeextent83 ofthetimes withthe remaining reporting that the variable renaming either did not 294table4 externalandinternaldeveloperfeedbackforusefulness of features internal external usefulnot useful useful not useful summary variable method capturetheintentorwasmisleading.
ofthetimes respondentsindicatedthatthesuggestedvariablenamefullycapturedtheintent of its usage.
table also shows the internal developer evaluation of the variablenameson18differentinstances.overall theyratedthevariable names ability to convey the intent of their usage fairly positively seven variablenamesbeingratedas fullycapturingtheintent oftheir usage and eight being rated as somewhat capturing the intent of the usage.
two variable names were rated as not capturing theintentoftheirusagewhileonewasratedisbeingmisleading withregardtointent.ingeneral developerswereveryenthusiastic about the variable renaming feature.
one developer indicated that theimpactoftherenamingofthevariableswouldbemuchmore apparent in larger test cases.
rq2overall externalandinternaldevelopersreportthatthe transformations of deeptc enhancer result in a significant increaseinreadabilityofautomatictestcases.internaldevelop ers are particularly enthusiastic about the variable renaming.
moreover internal developers also find test case scenarios to be readable and content adequate but lacking conciseness.
.
rq3 what aspects of deeptc enhancerdo developers find most useful?
table shows the results from the evaluation with external developers.
respondents were asked to place the three features of deeptc enhancer scenarios testcasenames andvariablenames in two buckets useful and not useful.
respondents placed test case scenarios in the useful bucket while nine placed them in the not useful bucket.
variable renaming were considered useful by respondents and not useful by .
lastly respondents found the test case renaming to be useful while found it to not useful.
in terms of the relative importance of these three aspects of the proposed approach the largest number of participants reported test case scenarios to be the most important feature with participantsratingitasthemostimportant whereas6 and participants ranked variable and method renaming respectively as the most important feature.
test case scenarios were also the most frequently top ranked feature rated by respondents as not being useful.
theresultsforinternaldevelopersareincontrastwiththeresults fromexternaldevelopers.
6developersrankvariablerenaming as the feature they found the most useful while another rankedit second.
method name renaming is ranked as the second most useful feature by developers.
lastly internal developers did notfindtestcasescenariostobeasusefulastheexternaldevelopers in fact rated summaries as not being useful at all.
the results of the wilcoxon test revealed that the test scenarios are significantly ranked higher than the other features in our tool in terms of usefulness as indicated in participants answers pvalue .
.
the effect size is medium .
compared to variables names and small .
compared to method names.
instead there is no statistical difference between the other two features i.e.
the usefulness ranks of methods and variables names.
discussion weobservethatforexternaldevelopers testcasescenariosarethemostusefulenhancementofferedby deeptc enhancer .
thisiscontrarytoourfindingsforinternaldevelopers.fromaqualitativeanalysisofthecommentsleftbyrespondents wegatherthatinternaldevelopersoftenpreferself documentingcodeoverexplicit documentation.
while this is true even for external developers the section of respondents that expressed this preference was in the minority as evidenced by the results.
in addition internal developers tended to perceive the test scenarios from the perspective ofthe project being evaluated one of them indicated that both the coding style and thetest scenarios of the automatically generated test presented to them did not fit their current coding quality standards.wealsopositthatthedifferenceintheperceptionoftestcase scenarios for internal and external developers could be at the very least attributed to the familiarity the developers had with these projects.somesnippetsusedforinternaldeveloperswerealsoused for the external evaluation and given the external developers lack of familiarity with the code they found test case scenarios to be more helpful.
rq3external developers consider the automatically generated test case scenarios as the most useful aspect of deeptc enhancer whereas internal developers prefer the variable renaming feature.
we attribute the main reasons for the different opinions to the familiarity or lack of it with the code and the coding standards followed by different projects and developers.
threats to validity in this section we outline possible threats to the validity of our study and show how we mitigated them.
threats to construct validity concern the way in which we set up our study.
due to the fact that our study was performed in aremotesettinginwhichparticipantscouldworkonthetasksattheirowndiscretion wecouldnotoverseetheirbehaviours.tominimize potentialbiasintheparticipants behaviours wehavesharedthe experimental data with the participants using an online survey platform which supportthe participants toperformtasks and facilitate the filling of the questionnaires.
in additional to limit this threat we also involved both external and internal developers so that the final reported results are more reliable.
threats to internal validity concern factors that might affect the casual relationship.
to reduce biasing developers to thebaselines evaluated the name of the tools used to generate the summariesandidentifiersnameswerenotrevealedinthesurvey.
to avoid bias in the task assignment we randomly assigned the tasks to the participants in order to have a balanced number of datapointsforalltreatments.specifically forexternaldeveloper 295surveys participants were randomly assigned to one off the two surveys.
for internal developers surveys we created a unique survey even if there was more than one developer for a particular project we then randomly selected both test method and test class from the automatically generated test suite.
another factor that can influence our results is the order of assignments.
however our results suggest similar results among participants thus presenting no interaction between the treatments and the final outcome.
threats to external validity concern the generalizability of ourfindings andinparticularontheevaluationof deeptc enhancer .
to limit this threat we considered different dataset to evaluate our approach.
to evaluate the quality of generated test summaries and suggested method names we considered the original datasets used inthestudiesinvolvingtwobaselines .wealsouseanew dataset containing top starred projects on github to evaluate deeptc enhancer .weplantoevaluate deeptc enhancer witha larger dataset with more complex test cases.
we will also work on improving the suggestions for test case names.
future work will also focus on investigating how the approach helps developers fix potential bugs which deserve future investigations.
finally evenifourpopulationincludedasubstantialpartofprofessionalinternal and external developers we plan to replicate this study with more participants in the future in order to increase the confidence in the generalizability of our results.
threats to conclusion validity concern the degree to which ourconclusions about deeptc enhancer arereasonable basedon thedata.
deeptc enhancer generatestestsummariesandsuggests identifier names for automatically generated test cases by evosuite.usingdifferentautomatictestgenerationtoolssuchasrandoop mightleadtodifferentresults.however weobservethatthetest cases generated by evosuite are not significantly different from thosegeneratedbyotherexistingtoolsintermsofsize structure and coverage.
we support our findings by using appropriate statistical tests i.e.
the non parametric wilcoxon test.
we also used the wilk shapiro normality test to verify whether the non parametric testcouldbeappliedtoourdata.finally weusedthevarghaand delaney 12statistical test to measure the magnitude of the differences between different approaches.
related work sourcecodesummarization .researchershaveproposedseveral approaches that generate summarization of software artifacts atdifferent levelsof granularityto reduceprogram comprehension effortduringsoftwaredevelopmentandmaintenance.atstatement level gonzalezet al.
develop anautomated technique to convert junit assertion statements into natural language sentences .
at method level sridhara et al.
propose an approach that automatically generates natural language summary comments for java methods.atclasslevel morenoetal.
presentanapproachto generate human readable summaries for java classes so that developers can understand the main goal and structure of a class easily.
mcburney and mcmillan propose an approach to generate automatic source codesummaries with contextual meaning inthem by analyzing how those methods are invoked to show why the method exists or what role it plays in the software.
to locate crosscutting concern code rastkar et al.
introduce an automatedapproach that produces a natural language summary describing bothwhattheconcernisandhowtheconcernisimplementedso thatdeveloperscanperformchangetasksmoreefficiently.allthese approaches focus on generating summaries for source code we targetautomaticallygeneratedtestcasesandgeneratetestscenario rather than statement level descriptions as in .
method and variable renaming .
allamanis et al.
introduce a neural probabilistic language model for source code thatcan suggest method names.
in addition yonai et al.
propose anapproach mercemtorecommendmethodnamesinsourcecode by applying graph embedding techniques to the call graph.
both approaches target methods whereas deeptc enhancer focuses on suggesting names for automatically generated test cases.
raychev build an engine called jsniceto predict variable names and type annotations of javascript programs.
in addition vasilescuetal.
presentedanapproach jsnaughty torecoverthe original names from minified javascript variable names.
however both jsniceand jsnaughty are provided for javascript software system but not automatically generated java test cases.
to the best ofourknowledge nootherworkfocusonenhancingthereadability of variable names in automatically generated test cases in java.
improving the readability of test cases .
kamimura and murphy propose generating human oriented summaries of testcasesbasedonstaticsourcecodeanalysis.lietal.
present an approach unittestscribe that combines static analysis natural language processing backward slicing and code summarizationtechniques to generate descriptions documenting the purpose ofmethods within unit tests.
unittestscribe works for c project.
panichellaetal.
introducean approach testdescriber toautomatically generates test case summaries of the portion of code exercisedbyeachindividualtesttoimprove.wecompareourapproach with the work of panichella et al.
togeneratedescriptivemethodnamesforjavaunittestcases zhangetal.
presentanapproach nameassist thatcombines natural language program analysis and text generation which can createtestmethodnamesthatsummarizethetest sscenarioand the expected outcome.
we considered nameassist as a candidate baseline but neither the dataset nor the tool is publicly available henceweexcludeitfromthiscomparison.dakaetal.
introduce an approach for automatically generated tests that can generatedescriptive names by summarizing api level coverage goals.
we use the approach by daka et al.
as a baseline for our comparison.
afshanetal.
usedalinguisticmodeltogenerate english like inputstrings whicharemoreunderstandablethatrandomlygener atedones.ourworkcomplementsthislineofresearchasweaimat improvingreadabilityindifferentdimensions i.e.
documentation and method variable names.
our paper shows that these factorsare perceived as very important by developers.
daka et al.
proposed a domain specific model to measure and improve the readability of generated units test and based on human judgments.
evosuitealreadyincorporatesheuristicstoreducethesizeofthe generatedtestsandthenumberofassertions .onecouldargue that atthesamelevelofcoverage shortertestsareeasiertovalidateandinspectmanually reducingtheoraclecost .however these studiesfocusonthestructure size andcomplexityofthegenerated tests.
instead we focus on natural language documentation not 296included in the model by daka et al.
and the quality of the identifiers that remain obfuscated .
as indicated by lin et al.
the poor quality of the identifiers in test code is widespread and it is more severe in generated tests compared to the manually written counterpart.
our tool applies multiple strategies to address among others this open issue.
conclusions and future work we propose deeptc enhancer a hybrid deep learning and templatebasedapproachtoimprovethereadabilityofautomatically generatedtestcases.
deeptc enhancer isthefirstapproachthatenhancesboththedocumentationandcodeaspectsofthetests.tothis end deeptc enhancer generatesleading testscase summariesin theformoftestcasescenarioswhichoutlinetheactionsperformed inthetest.toenhancetheautomaticallygeneratedidentifiersof tests deeptc enhancer adaptsadeeplearningbasedextremecode summarizationapproachtogeneratetestcasenamesandvariable names.
with two empirical evaluations involving external and six internal developers we evaluate all aspects of the transformations proposed by deeptc enhancer and compare it to existing baselines.results showthat summariesgenerated usingtheproposed approachsignificantlyoutperformthebaseline andthetestcase renaming performs similar to the baseline.
the variable renaming feature in the context of automatic tests is first of its kind and thus isnotcomparedtoabaseline.thisisthefeaturethatwaspreferred byinternaldevelopers whileexternaldevelopersrankedthetest casescenariosasamoreimportantfeature.overall bothinternal and external developers report a significant improvement in the readability of generated tests after the enhancement applied by deeptc enhancer .lastly themajorityofparticipantsindicatethat theexistenceof deeptc enhancer increasesthelikelihoodofusing tools for automatic test case generation in their projects.
in the future we plan to evaluate deeptc enhancer in the contextofdifferentmaintenancetasksthatinvolvetestcasenavigation.
moreover fromtheevaluationwithdevelopers weseethatthere is a need to improve the suggestions for test case names.