2022 IEEE/ACM 44th International Conference onSoftware Engineering (ICSE)
VuICNN: AnImage-inspired Scalable Vulnerability Detection
System
Yuerning wu*t
Huazhong University ofScience and
Technology, China
wuyueming@hust.edu.cn
Wei Yang
University ofTexas atDallas, United
States
wei.yang@utdallas.eduDeqing Zou*H
Huazhong University ofScience and
Technology, China
deqingzou@hust.edu.cn
Duo Xu*
Huazhong University ofScience and
Technology, China
u201714569@hust.edu.cnShihan Dou
Fudan University, China
shihandou@foxmaiLcom
HaiJint§
Huazhong University ofScience and
Technology, China
hjin@hust.edu.cn
ABSTRACT
Since deep learning (DL) can automatically learn features from
source code, ithasbeen widely used todetect source code vulnera-
bility. Toachieve scalable vulnerability scanning, some prior stud-
iesintend toprocess thesource code directly bytreating them as
text. Toachieve accurate vulnerability detection, other approaches
consider distilling theprogram semantics into graph representa-
tions andusing them todetect vulnerability. Inpractice, text-based
techniques arescalable butnotaccurate duetothelack ofprogram
semantics. Graph-based methods areaccurate butnotscalable since
graph analysis istypically time-consuming.
Inthispaper, weaimtoachieve both scalability andaccuracy on
scanning large-scale source code vulnerabilities. Inspired byexist-
ingDL-based image classification which hastheability toanalyze
millions ofimages accurately, weprefer tousethese techniques
toaccomplish ourpurpose. Specifically, wepropose anovel idea
that canefficiently convert thesource code ofafunction into an
image while preserving theprogram details. Weimplement Vul-
CNN andevaluate itonadataset of13,687 vulnerable functions and
26,970 non-vulnerable functions. Experimental results report that
VulCNN canachieve better accuracy than eight state-of-the-art vul-
nerability detectors (i.e., Checkmarx, FlawFinder, RATS, TokenCNN,
VulDeePecker, SySeVR, VulDeeLocator, andDevign). Asforscalability,
VulCNN isabout four times faster than VulDeePecker and SySeVR,
about 15times faster than VulDeeLocator, andabout sixtimes faster
than Devign. Furthermore, weconduct acase study onmore than
*Hubei Engineering Research Center onBigData Security, School ofCyber Science
and Engineering, HUST, Wuhan, 430074, China
tNational Engineering Research Center forBigData Technology andSystem, Services
Computing Technology and System Lab, HUST, Wuhan, 430074, China
:t:Corresponding author
§Cluster andGrid Computing Lab, School ofComputer Science andTechnology, HUST,
Wuhan, 430074, China
Permission tomake digital orhard copies ofallorpart ofthis work forpersonal or
classroom useisgranted without feeprovided that copies arenotmade ordistributed
forprofit orcommercial advantage andthat copies bear this notice andthefullcitation
onthefirst page. Copyrights forcomponents ofthiswork owned byothers than ACM
must behonored. Abstracting with credit ispermitted. Tocopy otherwise, orrepublish,
topost onservers ortoredistribute tolists, requires prior specific permission and/or a
fee.Request permissions from permissions@acm.org.
leSE '22.May 21-29.2022, Pittsburgh. PA,USA
©2022 Association forComputing Machinery.
ACM ISBN 978-1-4503-9221-1/22/05 ...$15.00
https://doi.org/10.1145/3510003.3510229
236525million lines ofcode andtheresult indicates that VulCNN can
detect large-scale vulnerability. Through thescanning reports, we
finally discover 73vulnerabilities that arenotreported inNVD.
CCS Concepts
•Security and privacy ---7Vulnerability scanners.
Keywords
Vulnerability Detection, CNN, Large Scale, Image
ACM Reference Format:
Yueming Wu, Deqing Zou, Shihan Dou, Wei Yang, Duo Xu,and HaiJin.
2022. VuICNN: AnImage-inspired Scalable Vulnerability Detection System.
In44th International Conference onSoftware Engineering (ICSE '22), May
21-29,2022, Pittsburgh, PA,USA. ACM, New York, NY,USA, 12pages. https:
//doi.org/10.1145/3510003.3510229
1INTRODUCTION
Recently, various cyberspace security incidents [2,3]such as
hacker extortion, botnet attacks, and user information leakage
have occurred frequently. Asanimportant part ofcyberspace,
vulnerabilities insoftware systems have brought serious security
threats tocyberspace. In2020, Synopsys Open Source Security and
Risk Analysis (OSSRA) examined audit data from 1,250+ commercial
code bases and revealed that 70% ofthecode inthese codebases
were open-source. Moreover, 75%ofthese open-source codebases
contained open source security vulnerabilities, and nearly half
contained high-risk vulnerabilities [1].Therefore, itisurgent
tocarry outlarge-scale and intelligent software vulnerabilities
detection methods tobetter protect software security.
Ingeneral, source code vulnerability detection methods canbe
divided into twomain categories, that is,thecode-similarity-based
methods [27,32,37,39,46] andthepattern-based methods [5,6,12,
24,41,43,47,56,57]. Vulnerability detection methods based oncode
similarity aremainly used todetect vulnerabilities caused bycode
cloning. When used todetect vulnerabilities notcaused bycode
cloning, itwill lead toahigh false negative rate [41]. Traditional
pattern-based vulnerability detection methods [5,6,12]rely on
experts tomanually define vulnerability rules orcharacteristics to
describe vulnerabilities. These approaches arenotonly subjective
butalso difficult toachieve alowfalse positive rate andalowfalse
negative rate atthesame time [40,41].
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. ICSE '22,May 21-29, 2022, Pittsburgh, PA,USA
lnrecent years, due totheautomatic feature extraction of
deep learning (DL), ithasbeen widely used todetect source code
vulnerability. These DL-based techniques [24,40,41,43,47,56,57]
belong tothe second category ofmethods (i.e., pattern-based
methods). They donotrequire experts tomanually define features
andcanautomatically generate vulnerability patterns. Forexample,
some prior studies [41,47] treat theprogram source code astext
andapply techniques inthefield ofnatural language processing to
detect vulnerability. The detection performance ofthese text-based
methods isnotideal since they ignore theprogram semantics of
source code. Toaddress theissue, researchers conduct program
analysis todistill theprogram semantics ofsource code into a
graph representation andperform graph analysis (e.g., graph neural
network) todetect vulnerability. These graph-based techniques [24,
56]can achieve higher effectiveness ondetecting vulnerability,
however, their scalability ismuch worse than text-based methods. In
addition, almost allthese methods only focus onlabeling afunction
aseither vulnerable ornot,andcannot pinpoint which lines ofcode
may bemore likely tobevulnerable.
lnthis paper, weaim toachieve accuracy and scalability
simultaneously ondetecting vulnerabilities from large-scale source
code. Our keyidea isderived from DL-based image classification,
which can process millions ofimages while maintaining high
accuracy, and theclassification results can beinterpreted by
visualization techniques. Specifically, wemainly address onemajor
challenge inourpaper.
•How toefficiently convert thesource code ofafunction into an
image while preserving theprogram details?
Totackle thechallenge, wefirst conduct program analysis
todistill theprogram semantics ofafunction into aprogram
dependency graph (PDG) which contains both control-flow anddata-
flow details ofsource code. After obtaining thePDG ofafunction,
wetreat itasasocial network and apply centrality analysis on
thenetwork toattach thegraph structural information toeach
lineofcode. Insocial network analysis, centrality analysis [25,31]
hasbeen proposed tomeasure theimportance ofanode within
thenetwork. Specifically, weleverage three different centralities
(i.e., degree centrality [25], katz centrality [31], and closeness
centrality [25]) tocommence ourimage transformation. There
aretwo main reasons forusing three centralities. First, different
centralities canmaintain thegraph properties from different aspects
[52]. Second, animage generally hasthree channels (i.e., red,green,
and blue) and they work together toproduce acomplete image.
The output ofcentrality analysis isanimage while preserving the
graph details from three aspects. Given generated images, wethen
train aConvolutional Neural Network (CNN) [34,36]model and
useittodetect vulnerability. Topinpoint thevulnerable lines of
code inafunction, weuseadeep visualization technique (i.e., Class
Activation Map [20]) onourimages toobtain thecorresponding
heatmaps, these heatrnaps canhelp security analysts understand
why thefunction islabeled asavulnerability.
Weimplement VulCNN and evaluate itonadataset of40,657
functions which consists of13,687 vulnerable functions and26,970
non-vulnerable functions. Evaluation results show that VulCNN can
achieve better effectiveness than eight comparative vulnerability
detectors (i.e., Checkmarx [5],FlawFinder [6],RATS [12], TokenCNNYueming wu, Deqing zou, Shihan Dou, Wei Yang, Duo Xu,and HaiJin
[47], VulDeePecker [41], SySeVR [40], VulDeeLocator [38], and
Devign [56]). Furthermore, VulCNN ismore than sixtimes faster
than another state-of-the-art graph-based vulnerability detection
tool (i.e., Devign). Tovalidate theability ofVulCNN onlarge-scale
vulnerability scanning, weconduct acase study onmore than 25
million lines ofcode. Through thescarming reports, wefinally
discover 73vulnerabilities that arenotreported inNVD. Among
them, 17have been "silently" patched byvendors inthelatest
version ofcorresponding products, four vulnerabilities have been
deleted, andtheother 52stillexist intheproducts. Wehave reported
these vulnerabilities totheir vendors andhope that they canbe
patched assoon aspossible.
Insummary, thispaper makes thefollowing contributions:
•Wepropose anovel idea that can efficiently convert the
source code ofafunction into animage while preserving the
program details.
•Wedesign andimplement aprototype system, VuICNN1,a
scalable graph-based vulnerability detection system.
•Weconduct evaluations onadataset of13,687 vulnerable
functions and26,970 non-vulnerable functions. Experimental
results report that VulCNN issuperior toeight state-of-
the-art vulnerability detectors (i.e., Checkmarx, FlawFinder,
RATS, TokenCNN, VulDeePecker, SySeVR, VulDeeLocator, and
Devign).
•Weconduct acase study onmore than 25million lines
ofcode tovalidate theability ofVulCNN onlarge-scale
vulnerability scanning. Through thescanning results, we
discover 73vulnerabilities that arenotreported inNVD.
Paper organization. The remainder ofthepaper isorganized as
follows. Section 2presents themotivation ofourpaper. Section 3
introduces oursystem. Section 4reports theexperimental results.
Section 5discusses thefuture work. Section 6describes therelated
work. Section 7concludes thepresent paper.
2MOTIVATION
Weallknow that afunction consists ofmultiple lines ofcode, which
together implement theprogram semantics (i.e., functionality) of
thefunction. However, thesemantic contribution ofdifferent lines
ofcode isdifferent. Forexample, some code isjustasimple variable
definition, while some code implements thecore algorithm of
thefunction. Obviously, thelatter contributes more semantics.
Therefore, weraise aquestion: "How tofind outthecontribution of
different lines ofcode inthefunction totheprogram semantics?"
Toanswer it,weselect abuffer overflow vulnerability function
asourexample. Tomaintain theprogram semantics, weconsider
extracting both control-flow and data -flow details bystatic anal-
ysis. Specifically, weleverage Joern [53] toobtain theprogram
dependency graph (PDG) ofthevulnerability inFigure 1.Each
node inthePDG corresponds toalineofcode inthevulnerability.
Red lines and blue lines show thedata flows and control flows
between different lines ofcode inthefunction, respectively. To
simply display thePDG ofthevulnerability, wereplace each line
ofcode with anumbered circular node. Eight lines ofcode inthe
function correspond toeight circular nodes asshown inFigure 1.
Ingraph theory, anadjacency matrix isasquare matrix used to
Ihttps:llgithub.com/CGCL-codeslVulCNN
2366
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. VuICNN:An Image-inspired Scalable Vulnerability Detection System leSE '22,May 21-29, 2022, Pittsburgh, PA,USA
Figure 1:The program dependency graph (PDG) and corre-
sponding adjacency matrix ofavulnerability
represent afinite graph [4].Therefore, torepresent thePDG ofthe
vulnerability, wecompute thecorresponding adjacency matrix and
describe itinFigure 1.Theelements ofthematrix indicate whether
pairs ofnodes areadjacent ornotinthegraph. Since ourPDG isa
directed graph, anelement represents thenumber ofdirected edges
between two different nodes. Forexample, node 3hastwo edges
pointing tonode 4,while node 4hasnoedges pointing tonode 3.
Therefore, thecorresponding values between node 3andnode 4in
thematrix aretwo andzero, respectively.
After obtaining theadjacency matrix ofthePDG, wefind that
when wesum arow inthematrix, thevalue obtained corresponds
totheout-degree ofthenode. Moreover, when wesum acolumn,
thevalue obtained isthein-degree ofthenode. Forexample, the
sum oftherow ofnode 4isthree (i.e., 1+1+1=3), which indicates
thattheout-degree ofnode 4isthree. Tobetter illustrate ourinsight,
wepresent thein-degrees, out-degrees, anddegrees ofalllines of
code ofthevulnerability inFigure 2.Through theresults inFigure
2,wefind that thedegrees ofdifferent lines ofcode arebasically
different. Itisreasonable because there aredifferent relationshipsDegreeOut
DIIn
IDi{egreeegree
bar*lat 0
I 1 2 3
2 2 4
.=
~,to
estr: 1-'\0' I
I
}I:void badO
Inthis section, weintroduce VuICNN, anovel andefficient source
code vulnerability detection system.
3.1 Overview
Asshown inFigure 3,VulCNN consists offour main phases:
Graph Extraction, Sentence Embedding, Image Generation, and
Classification.
•Graph Extraction: Given thesource code ofafunction,
wefirst normalize them andthen perform static analysis to
extract theprogram dependency graph ofthefunction.
•Sentence Embedding: Each node intheprogram depen-
dency graph corresponds toaline ofcode inthefunction.
Weregard alineofcode asasentence andembed them into
avector.
•Image Generation: After sentence embedding, weapply
centrality analysis toobtain theimportance ofalllines of3SYSTEMFigure 2:The in-degrees, out-degrees, and degrees ofalllines
ofcode inFigure 1
(i.e., control-flows anddata-flows) between different lines ofcode,
andthevulnerability istriggered based onthese relationships. Ifwe
directly process these codes bytreating them astext, thedegrees
ofalllines ofcode areone, which may decrease thevulnerability
detection accuracy.
Inoneword, agraph canberepresented byitsadjacency matrix,
thematrix can bedescribed bydegrees ofallnodes. Therefore,
computing thedegrees ofcode inafunction may beagreat
candidate toretain thegraph details. Inpractice, thedegree of
anode inagraph isoriginally used toquantify itsimportance. It
hasbeen widely used insocial network analysis [25]. Thehigher the
degree, themore important theperson. Meanwhile, different lines of
code have different degrees. Ifwetreat each lineofcode asaperson,
thecontrol-flow anddata-flow relationships asthecommunications
between persons, then thecorresponding PDG canberegarded as
asocial network. The higher thedegree ofaperson, themore other
persons communicated with him, andthegreater hisimportance
within thePDG social network. Therefore, wecanleverage the
importance ofalineofcode asaform ofthecontribution ofprogram
semantics. Inother words, themore important alineofcode is,the
more itmay contribute toimplementing theprogram semantics
(i.e., functionality) ofthefunction. Based ontheobservation, we
design VulCNN byanalyzing theimportance ofalllines ofcode.800000(2)0Out
Degree
8
0
00
3
03
0
(2)
0
In3
Adjacency MatrixSource Code
char*data;
char dataBuffer[IOO];
data ~dataBuffer;
data ~badSource( data);
{
char dest[50] ~"";
stmcat( dest, data,
strlen(data»;
dest[50-1] ~'\0';
printLine( data);void badO
{
2367
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. leSE '22,May 21-29, 2022, Pittsburgh, PA,USA Yueming Wu, Deqing Zou, Shihan Dou, Wei Yang, Duo Xu,and HaiJin
Figure 3:System overview ofVulCNN
Figure 4:Steps ofsource code normalization inVulCNNcode and multiply them bythevectors one byone. The
output ofthisphase isanimage.
•Classification: Our final phase focuses onclassification.
Given generated images, wefirst train aCNN model and
then useittodetect vulnerability.
(2)(1)
Xi=a~AijXj +f3
jdeg(i)x·----z-N-l
Note that deg(i) isthedegree ofnode i.
•Katz centrality [31] computes thecentrality foranode
based onthecentrality ofitsneighbors. The Katz centrality
fornode iisFigure 4shows thedetailed transformations ofafunction at
varying normalization levels.
•Stepl: Remove thecomments inthesource code because
they have nothing todowith program semantics.
•Step2: Map user-defined variables tosymbolic names ina
one-to-one manner (e.g., ,VARl).
•Step3: Map user-defined functions tosymbolic names ina
one-to-one manner (e.g., ,FUNl).
After abstracting thesource code, wethen leverage anopen-
source code analysis platform forC/C++, Joern [11,53],toextract
theprogram dependency graph (PDG) ofthefunction. PDG isa
graph representation that contains both data-flow andcontrol-flow
details ofthesource code. Each node inaPDG corresponds toa
line ofcode inthefunction. Wetreat aline ofcode asasentence
andapply sentence embedding totransform itinto afixed-length
vector. Specifically, wemake useofawidely used method (i.e.,
sent2vec [45]) tocomplete oursentence embedding. Itadopts a
simple butefficient unsupervised objective totrain distributed
representations ofsentences. Using thesent2vec [45] model, wecan
transform alineofcode into itscorresponding vector representation
whose dimension is128inourpaper.
Tobetter illustrate thedetailed steps involved inourproposed
method, weprovide anexample inFigure 5.Redlines andblue lines
inFigure 5represent data flows andcontrol flows between different
lines ofcode inafunction, respectively.
3.3 Image Generation
After graph extraction and sentence embedding, wecanobtain a
new PDG where each node isavector representation. Inthisphase,
weaim toefficiently convert thenew PDG into animage while
considering thecontributions ofdifferent lines ofcode toprogram
semantics. Tocomplete ourpurpose, weregard thenew PDG as
asocial network and apply social network centrality analysis to
obtain theimportance ofalllines ofcode. Centrality concepts were
first developed insocial network analysis whose original purpose
istomeasure theimportance ofanode inthenetwork. Centrality
analysis has been used inmany different areas (e.g., biological
network [28] and transportation network [26]), these successful
applications have validated theeffectiveness ofnetwork analysis.
Infact, there have been proposed many different types ofcentrality
toquantify theimportance ofanode inanetwork from different
aspects, forexample:
•Degree centrality [25]ofanode isthefraction ofnodes it
isconnected to.The degree centrality values arenormalized
bydividing bythemaximum possible degree inagraph N-l
where Nisthenumber ofnodes inthegraph.Stepl: Remove commentsImage GenerationSentence
EmbeddingGraph
Extraction
Input: Source Code ofaFllllction
void badO
{void badOchar*data;{char dataBuffer[lOO];char :I<data;data =dataBuffer;char dataBuffer[lOO];data =badSource( data);data =dataBuffer;{data =badSource(data);char dest[50] ~"";f-----{1*POTENTIAL FLAW: Possible
buffer overflow ifdata islarger thanchar dest[50] ~"";
stmcat(dest, data, strlen(data»;sizeof( dest)-strlen( dest)* Idest[50-1] ~'10';stmcat(dest, data, strlen(data»;
dest[50-1] ~'10';printLine(data);
printLine(data);}
}}
}
Step2: Map user-defined variables Step3: Map user-defined functions
void badO void FUNIO
{ {
char*VARl; char*VARl;
char VAR2[ 100]; char VAR2[100];
VARl~VAR2; VAR1~VAR2;
VARI ~badSource(V ARl); VARI ~FUN2(V ARl);-{--{
char VAR3[50] ~""; char VAR3[50] ~"";
stmcat(VAR3, VARl, stmcat(V AR3, VARl,
strlen(V ARl»; strlen(VAR1»;
VAR3[50-1] ~'10'; VAR3[50-1] ~'10';
printLine(V ARl); FUN3(VAR1);
} }
} }3.2 Graph Extraction and Sentence Embedding
VulCNN aims toachieve accuracy and scalability simultaneously
ondetecting vulnerabilities, therefore, wefirst apply static analysis
todistill theprogram semantics ofsource code into agraph repre-
sentation. Due tothecoarse granularity offile-level vulnerability
detection, wefocus ondetecting vulnerability atamore fine-grained
level (i.e., function-level) since afunction canalso implement aspe-
cific task. Before extracting thegraph representation ofafunction,
wefirst abstract and normalize thesource code. Particularly, we
usethree levels ofnormalization which make VulCNN resilient to
common code modifications while preserving program semantics.
2368
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. VuICNN: AnImage-inspired Scalable Vulnerability Detection System leSE '22,May 21-29, 2022, Pittsburgh, PA,USA
Input: Nonnalized Source Code
1------------------- --I
, ,
, ,
, ,
, ,
1void FUNIO 1
{ ;
char*VARl; ~
charVAR2[lOO]; :
VARI =VAR2; :
VARI ~FUN2(VARI); ,{ l-
charVAR3[50] ~""; :
strncat(VAR3, VARl, :
strlen(VARI»; :
VAR3[50-1] ~'\0'; :
FUN3(VARI); :
} :
} i
,,,
------------------- --
Source CodeGraph Extraction
Original Program Dependency GraphSentence Embedding
New Program Dependency GraphImage Generation------degree---
degree centrali
vectorj: 1 117=0.14
vector2: 3 317=0.43
vector]: 4 417=0.57
vector4: 5 517=0.71
vector5: 4 417=0.57
vector6: 4 417=0.57
vector7: 3 317=0.43
~ vectors: 2 217=0.29
katz centrality
closeness centrality
=r.,Output: AnImage
Image
Figure 5:Anexample toillustrate how toconvert thesource code ofafunction into animage
Note that Aistheadjacency matrix ofthegraph Gwith
eigenvalues A.Theparameter f3controls theinitial centrality
and
1a<-- (3)
Am-ax
Katz centrality computes therelative influence ofanode
within agraph bymeasuring thenumber oftheimmediate
neighbors (first-degree nodes) andalsoallother nodes inthe
graph that connect tothenode under consideration through
these immediate neighbors.
•Closeness centrality [25] indicates how close anode isto
allother nodes inthenetwork. Itiscalculated astheaverage
oftheshortest path length from thenode toevery other
node inthegraph. The smaller theaverage shortest distance
ofanode, thegreater thecloseness centrality ofthenode.
N-1x- (4)
1-L,iij d(i,j)
Note that d(i,j)isthedistance between nodes iand j,and
Nisthenumber ofnodes inthegraph.
Because animage generally hasthree channels (i.e., red, green,
andblue) andthey work together toproduce acomplete image. We
select three different centralities (i.e., degree centrality [25], katz
centrality [31], and closeness centrality [25]) tocorrespond tothe
three channels. These three centralities cancompute theimportance
ofalllines ofcode inafunction from three different aspects. Bythis,
wecanachieve complete consideration ofdifferent lines ofcode's
contribution toafunction's program semantics. Algorithm 1shows
theentire process ofVulCNN ofhow toconvert afunction into
animage. Asshown inFigure 5andAlgorithm 1,wefirst perform
degree centrality analysis onallnodes inthenew PDG tocollect
thedegree centralities ofallnodes (i.e., vectors). Allvectors are
then arranged onebyoneaccording tothenumber oflines ofcode
after multiplying bythecorresponding degree centrality. Wecall
these arranged new vectors the"degree charmel". Similarly, after
applying katz centrality and closeness centrality analysis onthe
new PDG, wecanobtain theother two "channels" which are"katz
channel" and"closeness channel". Finally, these three channels are
used toproduce animage.
2369Algorithm 1Converting thesource code ofafunction into an
image
Input: F;Source code ofafunction;
Output: I;Animage.
I:nFf-CodeNormalization(F)
2:PDG f-GraphExtraction(nF)
3:Vf-ObtainNodes(PDG)
4:foreach vEVdo
5: vector f-SentenceEmbedding(v)
6: degreeCentrality f-DegreeCentralityAnalysis(vector, PDG)
7: degreeChannel.add( degreeCentrality *vector)
8: katzCentrality f-KatzCentralityAnalysis(vector, PDG)
9: katzChannel.add(katzCentrality *vector)
10: closenessCentrality f-ClosenessCentralityAnalysis(vector,
PDG)
11: closenessChannel.add(closenessCentrality *vector)
12:endfor
13:If- ImageGeneration(degreeChannel, katzChannel, closeness-
Channel)
14:return I
Inbrief, theinput ofimage generation phase isanew PDG, where
each node isanembedded vector, andtheoutput isanimage with
theimportances ofalllines ofcode.
3.4 Classification
Deep learning [35]isacomplex machine learning algorithm thathas
achieved results inmany areas (e.g., speech andimage recognition)
farbeyond previous related technologies. The advantage ofdeep
learning istouseunsupervised orsemi-supervised feature learning
andefficient hierarchical feature extraction algorithms toreplace
manual feature acquisition. Inthe field ofimage processing,
Convolutional Neural Network (CNN) [34,36]hasbeen thefocus
since itnotonly does notrequire manual image preprocessing but
also canuseitsunique fine-grained feature extraction toreach a
level close tohumans.
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. leSE '22,May 21-29, 2022, Pittsburgh, PA,USA Yueming Wu, Deqing Zou, Shihan Dou, Wei Yang, Duo Xu,and HaiJin
/
---.('"1,0
0,9
0,80,7
0,6
U-S0,5
0,4
0,3
0,2
0,1
0,0o 50 100 150 200 250 300 350 400 450 500
Thetotal number oflines ofcode ofafunctionanimage: 3"'128*10010region sizes: 1-10
32mers foreach
region size
totally 10'32 mers:vulnerable
,arnot
fUlly
max pool: 10*32 connected
layer: 320
Figure 6:The Cumulative Distribution Function (CDF) ofthe
total number oflines ofcode inafunction
After image generation phase, thesource code ofafunction
isconverted into animage. Given animage, weintend totrain
aCNN model first and then useittodetect vulnerability. Since
CNN takes equal-size images asinput while thenumber oflines
ofcode indifferent functions isdifferent, weneed tomake an
adjustment. Tofind amore suitable threshold toproduce fixed-size
images, weselect ourexperimental dataset inSection 4(i.e., 40,657
functions) asthetestobject andrecord thenumber oflines ofcode
ofallthese functions. Figure 6shows theCumulative Distribution
Function (CDF) ofthenumber oflines ofcode inthese functions.
From theresults inFigure 6,itcan beobserved that more than
99%ofthefunctions have lessthan 200lines ofcode. Inreality, we
have experimented with different thresholds (i.e., 50-200 lines of
code) ondetecting vulnerability. Considering thedetection accuracy
andcorresponding runtime overhead2,wefinally choose 100lines
ofcode asthethreshold togenerate ourinput images. When the
number oflines ofcode inafunction islessthan 100, wepadzeros
totheend ofthevectors. When afunction has more than 100
lines ofcode, wedelete theending part ofvectors. The sizeofthe
image weinputis 3*100*128, where 3corresponds tothree channels
(i.e., "degree channel", "katz channel", and"closeness channel"), 100
corresponds tothethreshold ofcode lines, and 128represents the
dimension ofasentence vector.Figure 7:CNN classification ofVulCNN
After generating fixed-size images, wethen train aCNN model
using these images. Asshown inFigure 7,weuse different
convolution filters with ashape ofm*128, sothat each filter can
span theentire space ofthesentence embedding. The filter size m
determines thenumber ofsequential sentences considered together.
InVuICNN, weselect 10filter sizes (i.e., 1to10),andeach sizehas32
feature maps toextract thefeatures ofdifferent parts oftheimage.
After max pooling, thelength ofourfully counected layer is320.
The descriptions ofparameters used inVulCNN areillustrated in
Table 1.The whole model uses rectified linear units (i.e., ReLU [23])
asthenon-linear activation function. Moreover, theloss function
used inourCNN topenalize theincorrect classification iscross-
entropy loss. Wetrain theCNN using Adam [33] with alearning
rate of0.001. After obtaining atrained CNN model, wethen useit
toflagnew functions aseither vulnerable ornot.
Tointerpret thedetection results, weleverage Gradient-weighted
Class Activation Mapping++ (Grad-CAM++) [20, 49]asour vi-
sualization technique topinpoint thevulnerable lines ofcode.
Grad-CAM++ isaclass-discriminative localization technique that
generates visual explanations foranyCNN-based network without
changing thearchitecture orretraining. According totheintensity
ofthecolor intheheatmap, wecanknow which lines ofcode may
bemore likely tobevulnerable.
4EXPERIMENTS
Table 1:Parameter settings inVulCNN
parameters
loss function
activation function
optimizer
batch size
learning rate
epochnum
2More details areinSection 4.2.settings
Cross Entropy Loss
ReLU
Adam
32
0.001
100Inthissection, weaimtoanswer thefollowing research questions:
•RQl: What isthedetection performance ofVulCNN when
detecting source code vulnerability?
•RQ2: What istheruntime overhead ofVulCNN when detecting
source code vulnerability?
•RQ3: Can VulCNN achieve large-scale vulnerability scanning?
4.1 Experiment Settings
Wefirst collect adataset from Software Assurance Reference Dataset
(SARD) [14] which isaproject maintained byNational Institute
ofStandards and Technology (NIST) [9].SARD contains alarge
number ofproduction, synthetic, and academic security flaws or
2370
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. VuICNN: AnImage-inspired Scalable Vulnerability Detection System leSE '22, May 21-29, 2022, Pittsburgh, PA,USA
Accuracy TNR:I~-o
,~.~ ---
"~
TPR90
40
30,t:100 .-------r--~----,--~--r-----"D~-;:;ch:::-ec:;::km=a=rx---,
~ FlawFinder
---------------------------------------------- D RATS
DTokenCNNc:J VulDeePecker
_SySeVR
GZJ VulDeeLocator
_~Devign
IIIIVulCNN
-.VuICNN-wcQl
~80
IIIE.g70
~
§60
0-e
Ql50
~weseethat thethreshold ispositively correlated with detection
accuracy, thelarger thethreshold, thehigher theaccuracy. However,
when thethreshold reaches 100 lines, thegrowth ofaccuracy
becomes small. Ontheonehand, since thedetection accuracy of
VulCNN with 100lines ofcode isalmost thehighest. Ontheother
hand, thegreater thethreshold, thelarger theimage, andthemore
thememory required. Therefore, weselect 100lines ofcode asour
final threshold togenerate theinput images.
Wethen compare VulCNN with several vulnerability detection
tools, including onecommercial static vulnerability detection tool
(i.e., Checkmarx [5]), two open-source static analysis tools (i.e.,
FlawFinder [6]andRATS [12]), andfivedeep learning-based vulner-
ability detection approaches (i.e., TokenCNN3[47], VulDeePecker
[41], SySeVR [40], VulDeeLocator [38], andDevign [56]).vulnerabilities (i.e., badfunctions) andmany good functions. Inour
paper, wefocus ondetecting vulnerability inC/C++, therefore, we
only select functions written inC/C++ inSARD. Data obtained
from SARD consists of12,303 vulnerable functions and 21,057
non-vulnerable functions. Moreover, since thesynthetic programs
inSARD may not berealistic, wecollect another dataset from
real-world software. Forreal-world vulnerabilities, weconsider
National Vulnerability Database (NVD) [10] asour collection
source. Wefinally obtain 1,384 vulnerable functions that belong to
different open-source software written inC/C++. Forreal-world
non-vulnerable functions, werandomly select apart ofthedataset
in[42]which contains non-vulnerable functions from several open-
source projects. Our final dataset consists of13,687 vulnerable
functions and26,970 non-vulnerable functions.
Four phases (i.e., graph extraction, sentence embedding, image
generation, and classification) inVulCNN areimplemented by
using Joern [53], sent2vec [45], networkx [15], andpytorch [16],
respectively, Werunallexperiments onaserver with 16cores of
CPU andaGTX 1080Ti GPU. Fordataset, wefirst randomly divide
itinto tensubsets, then theseven subsets areused totrain aCNN
model, theother two subsets areused tovalidate, and thefinal
subset isused totest. The metrics used tomeasure theeffectiveness
ofVulCNN arethesame asothers [39,41, 56].Forexample, true
positive (TP) reports thenumber offunctions that arecorrectly
classified asvulnerable and true negative (TN) shows thenumber
offunctions that arecorrectly detected asnon-vulnerable.
4.2 Detection Performance
Figure 8:The detection performance ofVulCNN with
different thresholds toconstruct animage
Wefirst present thedetection performance ofVulCNN under
different thresholds (i.e., thenumber oflines ofcode toproduce our
images). Because more than 99%ofthefunctions inFigure 6have
lessthan 200lines ofcode, wefocus onthethresholds below 200
lines. Specifically, weselect atotal of10thresholds (i.e., 50,60,70,80,
90,100,120, 150,170, 200lines) tocommence ourevaluations. The
experimental results arepresented inFigure 8,through theresults,The number oflines ofcode togenerate animageFigure 9:True Positive Rate (TPR), True Negative Rate (TNR),
and Accuracy ofCheckmarx, FlawFinder, RATS, TokenCNN,
VulDeePecker, SySeVR, VulDeeLocator, Devign, and VulCNN
ondetecting vulnerability
3Por more convenient discussion, wecallthemethod TokenCNN since ittakes tokens
asinput and detects vulnerability bytraining aCNN model.Asforthecommercial tool (i.e., Checkmarx) and two open-
source static analysis tools (i.e., FlawFinder andRATS), thedetection
performance inFigure 9shows that their True Positive Rates (TPRs)
and True Negative Rates (TNRs) arenotideal. Forexample, theTPR
ofCheckmarx isonly 31.9%, which means that Checkmarx canonly
detect 31.9%ofvulnerabilities inourlabeled dataset. Such results
arereasonable because these tools depend onrules orpatterns
defined byhuman experts. Inpractice, there aredifferent types
ofvulnerabilities, and thepatterns ofeach type aredifferent. In
other words, experts cannotdefine allpatterns ofallvulnerabilities,
resulting inpoor detection performance.
AsforTokenCNN, itfirst conducts lexical analysis totransform
thesource code into atoken sequence and then embeds them
into fixed-length vector representations. Finally, these vectors are
fedinto aConvolutional Neural Network (CNN) model totrain
avulnerability detector. Since itdoes notconsider any program
semantics, itperforms worse than VuICNN. AsforVulDeePecker and
SySeVR, they both collect code gadgets byslicing programs andthen
transform them into corresponding vector representations. Finally,
these vectors areused totrain aBidirectional Recurrent Neural100 120 140160 180 200 80 60I
/
/
!/
I
J
788384
7982
2371
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. leSE '22, May 21-29, 2022, Pittsburgh, PA,USA Yueming wu, Deqing zou, Shihan Dou, Wei Yang, Duo Xu,and HaiJin
Figure 10:The visualization ofadetected buffer overflow
vulnerability
Furthermore, since VulCNN isanimage-based vulnerability
detection system, wecaninterpret thedetection results byusing
CNN visualization techniques. lnthis paper, wetake Gradient-
weighted Class Activation Mapping++ (Grad-CAM++) [20] asan
example tovisualize ourdetection results. Figure 10shows theNetwork (BRNN) model todetect vulnerability. The difference
between these two systems isthat VulDeePecker only conducts
data flow analysis toslice programs while SySeVR considers both
control flow anddata flow toobtain theprogram slices. Obviously,
SySeVR performs better than VulDeePecker because itcontains more
program semantics. However, they donotconsider thedifferent
contributions ofdifferent lines ofcode totheprogram semantics,
buttreat alllines ofcode inaslice astext and directly apply
BRNN totrain avulnerability detector. This isthereason why
they detect lessvulnerability than VuICNN. AsforVulDeeLocator,
itfirst compiles aprogram toaLLVM bitcode fileand then
extracts Intermediate Representation (IR)slices toretain theprogram
semantics. Finally, these IRslices areused todetect vulnerability
bytraining aBRNN modeL Since IRcontains more program
details than source code, VulDeeLocator can distinguish more
vulnerability than VulDeePecker and SySeVR. However, similar to
VulDeePecker andSySeVR, VulDeeLocator also treat theslices astext,
resulting lower performance than VuICNN. AsforDevign, itfirst
applies complex program analysis toextract agraph representation
that contains comprehensive program semantics and then uses a
general graph neural network todetect vulnerability. The detection
performance ofDevign isalmost the same asthat ofVuICNN.
However, duetothecomplexity ofthegenerated graph, itcannot
beextended tolarge-scale vulnerability scarming. But VulCNN
can, because ituses centrality analysis toconvert time-consuming
graphic analysis into efficient image scanning.
Tocheck whether theuseofcentrality analysis contributes
toVulCNN ondetecting vulnerability ornot, weconstruct an-
other experiment. More specifically, after sentence embedding, we
directly feed thesentence vectors into aCNN model totrain a
classifier without multiplying bythecentrality. Wecallthemethod
asVuICNN-wc (i.e., VulCNN without centrality) and show the
experiment result inFigure 9.Through thefigure, wecan see
that VulCNN issuperior toVuICNN-wc, which indicates that the
consideration ofcentrality ofdifferent lines ofcode inafunction
canimprove thedetection accuracy onvulnerability detection.4.3.7 Graph Extraction. Given thesource code ofafunction, the
first step ofVulCNN istoextract thePDG ofit.Figure 11presents
theruntime overheads ofgraph extraction onourdataset, inwhich
more than 95% functions can beobtained thegraphs inthree
seconds. Onaverage, ittakes 1.71 seconds toconstruct aPDG ofa
function.
4.3.2 Sentence Embedding. The second stepofVulCNN istoembed
alllines ofcode into corresponding fixed-length vectors. Asshown
inFigure 11,thisphase isvery fast, itonly requires about 0.000489
seconds tocomplete thesentence embedding ofaPDG.
4.3.4 Classification. The final step ofVulCNN istodetect vulnera-
bility using atrained CNN modeL CNN classification isthefastest
ofallphases inVuICNN, itonly consumes about 41microseconds
tocomplete theclassification ofanimage.
Inaddition, wealsocompare thescalability ofVulCNN with other
comparative systems. Weexclude thecomparison ofCheckmarx,
FlawFinder, and RATS since they arenot deep-learning-based
methods and perform worse than theother five deep-Iearning-
based approaches. Figure 12shows theaverage runtime overheads
ofTokenCNN, VulDeePecker, SySeVR, VulDeeLocator, Devign, and
VuICNN. AsforTokenCNN, because itonly applies simple lexical
analysis toobtain thesource code tokens and uses aCNN model
todetect vulnerability, itisthefastest. Onaverage, itonly takes
0.25 seconds tofinish theanalysis ofafunction inourdataset. As
forVulDeePecker and SySeVR, their slice generation phase needs
toextract thecontrol flow graph (CFG), program dependency graph
(PDG), andfunction callgraph (FCG), resulting inlower scalability
than VuICNN. AsforVulDeeLocator, asitisaLLVM-IR-based
vulnerability detection system, thesource code needs tobecompiled
first. The compilation phase consumes lots oftime, making it
difficult todetect vulnerability onalarge scale. AsforDevign, it4.3 Runtime Overhead
Inthissection, weperform acomprehensive evaluation onruntime
overhead ofVulCNN byusing our40,657 functions (i.e., 13,687
vulnerable functions and 26,970 non-vulnerable functions). Given
anew function, VulCNN consists offour main steps tocomplete
theclassification: Graph Extraction, Sentence Embedding, Image
Generation, and Classification.
4.3.3 Image Generation. After embedding alllines ofcode into
vector representations, the third step ofVulCNN istoapply
centrality analysis totransform thenew PDG into animage. Figure
11presents theruntime overheads ofVulCNN inthis step. More
than 98%PDGs areable tobeconverted into images inonesecond,
and theaverage runtime overhead ofthis phase is0.26 seconds.
Such result indicates that VulCNN canefficiently transform aPDG
into animage.visualization ofadetected buffer overflow vulnerability. This
vulnerability canbetriggered when 'data' islarger than 'sizeof(dest)
-strlen(dest)'. Inthiscase, theterminal null will bewritten outside
the buffer. Through Figure 10,weseethat thecolor ofcode
'strncat(dest, data, strlen(data));' isthereddest, which means that
thislineofcode ismore likely tobevulnerable code. This result is
inlinewith expectations.
generated heatmap source code
2372
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. VuICNN: AnImage-inspired Scalable Vulnerability Detection System leSE '22, May 21-29, 2022, Pittsburgh, PA,USA
0.7 --_! ~!---! ~!
0.3--! ~!---! ~! 0.3-1--/+'---.,----1
0.2 /
0.1V
O.O*'---+-----i-------.j
0.000000.000020.00004 0.00006
Overhead ofCNN Classification (s)1.0 __:
O.g1-+':--+-,-+-+-+----i---1,M$N ~0.2~ sei;ond~
0.8
0.7I-+_! -.!-+-
u.0.6---t-----+- -t-~-~; -!--~­
80.5
~::1-+1 1-1I-j=
0.2 i_ii_ii-H-
0.1-i---i-i-' --+--+--0-:----1
0.0+---+--+--+--.-+--+--+--.--\----1
0.00.51.01.52.02.53.03.54.0
O""rhead ofImsge Generation (s)~!~!--~!~!
-!~!---!~!
-!~!---:~!
0.0+-_+---+_-+-_+--..-----I
0.00 0.01 0.020.030.04 0.05
Overhead of5en/enoe Embedding (s)0.2 --i------+----i----i------.j
: : : :
0.1--t----------------t--------------1.0-,---r-...----,--...,....-.,------,
O.g i~i '~i
MEAN ='4.89E-ll4 sec»nds
0.8 -'~'--' '
0.6
80.5
0.4
:::::
0.2{---+-+-+----+-t- --i~-+----
~::ji-++
o12345678g 10
Overhead ofGraph Extraction (s)0.7 -j-~-I-i-:--+--+-- _
u.0.61- '~!-c--+-i-,---W-
80.51_ ~'~'_~i ~'~-"~' ~'-
0.41- ~-!-0-~--~~-!­
0.31---!-!-0~--~-! -!-
Figure 11:The Cumulative Distribution Function (CDF) ofruntime overheads ofVulCNN ondifferent phases (seconds)
30 ~ __ Table 2:Summary ofourtested open-source software
'iii'"0c:25
~:;20
III..c:
~15o ,ll&
~-----;:.g:---
~o 0.25 I I
Figure 12:Comparative runtime overheads ofTokenCNN,
VulDeePecker, SySeVR, VulDeeLocator, Devign, and VulCNN
combines different code representations (i.e., abstract syntactic tree
(AST), control flow graph (CFG), data flow graph (DFG), and natural
code sequence (NSC» toachieve accurate vulnerability analysis.
Due totheheavy-weight extraction ofthese code representations,
Devign consumes more runtime than VulCNN
Insummary, although VulCNN isnotasscalable asTokenCNN,
itisabout four times faster than VulDeePecker and SySeVR, about
15times faster than VulDeeLocator, andabout sixtimes faster than
Devign.
4.4 Case Study
The original goal ofourpaper istoachieve accuracy andscalability
simultaneously ondetecting vulnerabilities from large-scale source
code. Therefore, inthis subsection, weconduct acase study to
examine theability ofVulCNN onreal-world large-scale vulnera-
bility detection. Weselect three widely used open-source products
asourtest objects: Libav [8],Xen [17], and Seamonkey [13]. The
versions ofthese products include both several oldversions andthe
latest version. Bythis, wecanreport whether vulnerabilities inold
versions have been "silently" patched inthelatest version ornot.OpenSource Software #Files #Functions #Lines ofCode
Libav-0.8.21 996 8,198 437,857
Libav-9.21 1,135 8,917 471,691
Libav-11.12 1,343 9,807 552,768
Libav-12.3 1,509 10,760 625,034
Xen-4.12.0 4,225 61,693 2,464,062
Xen-4.13.0 4,988 68,400 2,783,561
Xen-4.14.0 5,151 71,230 2,872,957
Seamonkey-2.32 11,600 153,122 6,495,189
Seamonkey-2.53.4 15,369 208,106 8,798,738
Total 46,316 600,233 25,501,857
Table 2presents thesummary ofourcollected products, thetotal
number offunctions that canbesuccessfully analyzed byJoern [53]
inthese products is600,233. Inother words, VulCNN analyzes a
total of600,233 functions, with atotal ofmore than 25million lines
ofcode.
Due toalarge amount ofthese codes, weadopt parallel
processing toanalyze them. Specifically, weprocess tenfunctions
atatime. The total processing runtime overheads arepresented in
Figure 13,itcanbeobserved that themost time-consuming phase is
toextract thePDG offunctions, thisphase occupies more than 87%
ofthetotal processing runtime. After generating thePDGs ofthese
600thousand functions, wecantransform them into corresponding
images inabout 253minutes. Such high efficiency indicates that
VulCNN hastheability toscan large-scale source code todiscover
new vulnerabilities.
lnpractice, our scanning results arealso encouraging since
wediscover 73vulnerabilities. Specifically, wefirst train aCNN
model using ourcollected labeled 40,657 functions including 13,687
vulnerable functions and26,970 non-vulnerable functions. Then the
generated 600,233 images from more than 25million lines ofcode
inTable 2arefedinto thetrained CNN modeL After collecting all
warnings reported byVuICNN, wethen conduct manual analysis
tocompare them with our collected real vulnerabilities one by
one.Ifthetwo arefound tobelong tothesame pattern, itwill be
judged tobeareal vulnerability. The analysis result shows that
73warnings correspond topatterns ofknown vulnerabilities in
2373
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. ICSE '22,May 21-29, 2022, Pittsburgh, PA,USA Yueming Wu, Deqing Zou, Shihan Dou, Wei Yang, Duo Xu,and HaiJin
Table 3:26Vulnerabilities discovered byVulCNN from thelatest versions ofour selected products
Target product CVEID Vulnerable product reported Vulnerability release date Vulnerable fileinthetarget product
CVE-2011-3893 FFmpeg 11/11/2011 libavcodec!vorbis.c
CVE-2013-0845 FFmpeg 12/07/2013 libavcodec! alsdec.c
CVE-2013-0856 FFmpeg 12/07/2013 libavcodec! alac.c
CVE-20 15-6820 FFmpeg 09/05/2015 libavcodec! aacsbr.c
Libav 12.3 CVE-2015-6822 FFmpeg 09/05/2015 libavcodec! sanm.c
CVE-2015-8662 FFmpeg 12/23/2015 libavcodec/jpeg2000dwt.c
CVE-2018-1999010 FFmpeg 07/23/2018 libavformaUmms.c
CVE-2018-1999011 FFmpeg 07/23/2018 libavformaU asfdec.c
CVE-2007-5947 Firefox 11/13/2007 .../base/nsDocShell.cpp
CVE-2008-2805 Firefox, SeaMonkey 07107/2008 .../generic!HyperTextAccessib le.cpp
CVE-2008-2805 Firefox, SeaMonkey 07107/2008 .../generic! Accessible.cpp
CVE-2009-2663 Firefox 08/04/2009 .../lib/vorbis_analysis.c
CVE-2009-3071 Firefox 09/10/2009 ...!cxxlTestCrashCleanup.cpp
CVE-2009-3071 Firefox 09/10/2009 .../c.xx/TestInterruptErrorCleanup.cpp
CVE-2010-0174 Firefox, Thunderbird, SeaMonkey 04/05/2010 .../pingsender/pingsender_ win.cpp
CVE-2014-9672 FreeType 02/08/2015 ...lmac!ftmac.c
SeaMonkey 2.53.4 CVE-2014-9675 FreeType 02/08/2015 ...llzw/ftlzw.c
CVE-2014-9675 FreeType 02/08/2015 ...lbzip2/ftbzip2.c
CVE-2016-3189 Bzip2 06/30/2016 ...lsrc!decompress.c
CVE-2016-3189 Bzip2 06/30/2016 ...lbzip2-1.0.6Jbzip2recover.c
CVE-2016-3189 Bzip2 06/30/2016 ...lbzip2-1.0.6/decompress.c
CVE-2018-5097 Firefox, Thunderbird 06/11/2018 ...lxsltitxMozillaTextOutput.cpp
CVE-2018-5181 Firefox 06/11/2018 ...lwidgeUnsDragServiceProxy.cpp
CVE-2011-3346 QEMU 04/01/2014 ...1scsi! scsi-disk.c
Xen 4.14.0CVE-2013-4532 QEMU 01/02/2020 ...lhw/stellaris_enet.c
CVE-2016-2841 QEMU 06/16/2016 ...lhw/ne2000.c
2200
2054.89
2000
'gj'18001801
~1600
~140087.64% 0.12%
~1200
"12.21%1j1000
68000.02%"E600:e:>4000:: 251
200
2.41 0.48
Graph Sentence Image CNN Total
Extraction Embedding Generation Classification
Figure 13:The total runtime overheads ofVulCNN on
processing more than 25million lines ofcode
NVD. Among these detected vulnerabilities, 17ofthem have been
"silently" patched byvendors inthelatest version ofcorresponding
products, codes offour vulnerabilities have been deleted, andthe
other 52ofthem stillexist intheproducts. Wehave reported these
vulnerabilities totheir vendors andhope that they canrelease a
patched version assoon aspossible.Due tothelimited page, weshow thedetection results onold
versions ofproducts inourwebsite4and only present theresults
(i.e.,Table 3)onthree newest versions inthissubsection. Thedetails
ofourdiscovered vulnerabilities include thecorresponding eVE
IDinNVD, vulnerable products reported inNVD, therelease data
inNVD, and thevulnerable fileinthetarget product. From six
oldversions ofourselected products, wedetect 47vulnerabilities.
From three latest versions ofthese products, VulCNN discovers 26
vulnerabilities.
5DISCUSSION
5.1 Threats toValidity
Labeled functions inSARD arefrom synthetic programs. These syn-
thetic functions may notberepresentative oftheentire programs.
Tomitigate thethreat, weaddsome real-world vulnerabilities from
NVD and non-vulnerable functions from open-source products
into ourdataset. The selection ofthemaximum number oflines
ofafunction toproduce anequal-size image may cause some
inaccuracies. Wemitigate thethreat byresearching thenumber
oflines ofcode formore than 40,000 functions tofind abetter
4https:11github.com/CGCL-codeslVulCNN
2374
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. VuICNN: AnImage-inspired Scalable Vulnerability Detection System
threshold. Also, inaccuracies indetecting vulnerabilities onopen-
source products (i.e., Libav, Xen, and Seamonkey) areinevitable
since VulCNN may cause some false positives. The threat ismiti-
gated bydeeply comparing thepattern ofdetected vulnerabilities
with thepattern ofreal-world vulnerabilities inNVD.
5.2 Discussion
5.2.1 Theselection ofcomparative tools. Wefirst select candidates
based onwhether thetool isopen source, andthen filter based on
thetype oftechnique used bythetooL Finally, weselect onetoken-
based tool (i.e., TokenCNN), oneslice-based tool (i.e., VulDeePecker) ,
onebitcode-based tool (i.e., VulDeeLocator), andonegraph-based
tool (i.e., Devign). Note that since SySeVR istheimproved version of
VulDeePecker, weselect itasoneofthecomparative tools aswelL
Moreover, toachieve amore comprehensive comparison, wealso
select three traditional rule-based tools (i.e., Checkmarx, FlawFinder,
and RATS).
5.2.2 Therelationship between centrality measures and thecolors of
image channels. Thepurpose ofconstructing animage istofacilitate
theuseofimage-based model (i.e., CNN) forvulnerability detection
while preserving theprogram details. Thus, ourfunction image has
three layers (the same format asregular images), butthere isno
rigid correspondence between three colors inregular images and
three centrality measures infunction images.
5.2.3 Future work. From theresults inFigure 13,weseethat the
most time-consuming phase ofVulCNN istoextract thePDG of
functions, thisphase occupies more than 87%ofthetotal processing
runtime. Inour future work, weplan todesign anew static
analysis toolortryother static analysis tools (e.g., Frama-C [7])to
achieve more efficient PDG generation. InVuICNN, weselect degree
centrality, katz centrality, and closeness centrality tocommence
ourimage transformation. Inpractice, other different centralities
canalso beadopted toretain thegraph details. Weplan touse
different combinations ofdifferent centralities tofind asuitable
combination toachieve more effective image transformation in
VuICNN. Moreover, since most vulnerability detection systems
areclosed source, weonly compare VulCNN with eight tools (i.e.,
Checkmarx, FlawFinder, RATS, TokenCNN, VulDeePecker, SySeVR,
VulDeeLocator, and Devign). Wewill conduct detailed comparative
analysis onmore systems inourfuture work. Although VulCNN
canmaintain better effectiveness than comparative tools, itsTNR
isnotideal. Inother words, some ofourdetected vulnerabilities
may befalse positives. Inourfuture work, weplan toleverage
directed fuzzing [19,21] onourdetected vulnerabilities tomitigate
thesituation.
6RELATED WORK
There have been proposed many different vulnerability detection
methods, which canbeclassified into twomain categories: code-
similarity-based andpattern-based.
Asforsimilarity-based methods, thesimilarity canbemeasured
from different aspects, such asstring-based [27,32],tree-based [29,
46], token-based [30, 48], graph-based [37], and their hybrid-
based [39]. However, they canonly detect cloned vulnerabilitiesleSE '22, May 21-29, 2022, Pittsburgh, PA,USA
andcannotdetect new vulnerabilities [41]. Totackle thechallenge,
pattern-based techniques have been designed.
According tothedegree ofautomation, pattern-based work can
bedivided into three subcategories. 1)Manual methods: Human
experts manually generate thevulnerability patterns and use
them todetect new vulnerabilities. Inpractice, thedetection
effectiveness ofthese tools (e.g., Checkmarx [5],FlawFinder [6],
and RATS [12]) ispoor since experts cannotgenerate allpatterns
ofdifferent vulnerabilities. Results inFigure 9also demonstrate
thesituation. 2)Semi-automatic methods [18,50,51, 55]:Human
experts first extractcertain features (e.g., subtrees and API sym-
bols [54], imports andfunction calls [44]) andthen feed them to
traditional machine learning models (e.g., support vector machine
andk-nearest neighbor) todetect vulnerability. 3)More automatic
methods (i.e., deep-Iearning-based methods): Since deep learning
canautomatically extract features from source code, ithasbeen
used todetect source code vulnerability [22,24,40,41,43,47, 56,57].
Forexample, VulDeePecker [41]first collects code gadgets byslicing
programs and then transform them into corresponding vector
representations. Finally, ituses these vectors totrain aBidirectional
Long Short Term Memory (BLSTM) model todetect vulnerability.
muVulDeePecker [57] uses theprogram processing method in
VulDeePecker [41] andadds acode attention todetect multi-class
vulnerability. Devign [56] applies ageneral graph neural network
todetect vulnerability. Itcontains anovel convolutional module
that caneffectively extract useful features from thelearned rich
node representation forgraph-level classification. DeepWukong
[22] distills theprogram semantics into aprogram dependency
graph andsplits itinto several subgraphs according totheprogram
points ofinterest. Then these subgraphs arefedinto agraph neural
network totrain avulnerability detector.
7CONCLUSION
Inthispaper, wepropose anovel idea thatcanefficiently transform
thesource code ofafunction into animage while preserving
theprogram semantics. Bythis, wedesign ascalable graph-
based vulnerability detection system (i.e., VuICNN). The evaluation
results onadataset of13,687 vulnerable functions and26,970 non-
vulnerable functions report that VulCNN issuperior toeight state-
of-the-art vulnerability detectors (i.e., Checkmarx [5],FlawFinder
[6],RATS [12], TokenCNN [47], VulDeePecker [41], SySeVR [40],
VulDeeLocator [38], and Devign [56]). Tovalidate theability of
VulCNN onlarge-scale vulnerability scanning, weconduct acase
studyon more than 25million lines ofcode. Through thescanning
results, wediscover 73vulnerabilities that arenotreported inNVD.
Wehave reported them totheir vendors andhope that they canbe
patched assoon aspossible.
ACKNOWLEDGEMENTS
Wewould thank theanonymous reviewers fortheir insightful
comments toimprove thequality ofthepaper. This work is
supported bytheKey Program ofNational Science Foundation
ofChina under Grant No.U1936211 and partially supported by
NSF grant CCF-2146443. Wealso acknowledge support forresearch
from Siemens andAlipay.
2375
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. ICSE '22,May 21-29, 2022, Pittsburgh, PA,USA
REFERENCES
[I]2020. 5keytakeaways from the2020 Open Source Security and Risk Analysis
report https:llsecurityboulevard.coml2020/05/5-key-takeaways-from- the- 2020-
open- source- security~ and- risk-anaiysis- report.
[2]2020. The Exactis Breach: 5Things You eedtoKnow. https:/lblog.infoarmor.c
om/individuals- and- families/the- exactis- breach- 5-things- you- need- to-know.
[3]2020. WarmaCry ransomware attack. bttps:!/en.wikipedia.org/wikilWarmaCry
ransomware attack.
[4]2021. Adjace';-cy Matrix. https:/Ien.wikipedia.org/wikiiAdjacency_matrix!.
[5]2021. Checkmarx. https:!/www.checkmarx.com/.
[6]2021. FlawFinder. http://www.dwheeler.comlflawfinde/r.
[7]2021. Frama-C. http://frama-c.coml.
[8]2021. Libav. https:!/libav.org/.
[9]2021. National Institute ofStandards andTechnology. https:/Iwww.nist.gov/.
[10] 2021. National Vulnerability Database. https:/Invd.nist.gov.
[II] 2021. Open-source code analysis platform forCIC++ based oncode property
graphs. https:l/joern.io/.
[12] 2021. Rough Audit Tool forSecurity. https://code.google.com/archive/p/rough-
auditing- tool- £or-security/.
[13] 2021. Seamonkey. https://www.seamonkey-project.org/.
[14] 2021. Software Assurance Reference Dataset. https:/isamate.nist.gov/SRD/index.
php.
[15] 2021. Software forcomplex networks (Networkx) http://networkxglthub 10
[16] 2021. Tensors and Dynarruc neural networks IIIPython With strong GPU
acceleration (PyTorch). https://pytorch.org.
[17] 2021. Xen. https:!/xenproject.org/xen-project-archives/.
[18] Michael Backes, Boris Kopf, andAndrey Rybalchenko. 2009. Automatic discovery
andquantification ofinformati OIlleaks. InProceedings ofthe20091£££ Symposium
onSecurity andPrivacy (S&P'09). 141-153.
[19] Marcel Bohme, Van-Thuan Pham, Manh- Dung Nguyen, and Abhik Roychoudhury.
2017. Directed greybox fuzzing.ln Proceedings ofthe2017 ACM SIGSAC Conference
onComputer and Communications Security (CCS'I7). 2329-2344.
[20] Aditya Chattopadhay, Anirban Sarkar, Prantik Howlader, and Vineeth N.
Balasubrarnanian. 2018. Grad-cam++: Generalized gradient-based visual
explanations fordeep convolutional networks. InProceedings ofthe2018 IEEE
Winter Conference onApplil:ations ofComputer Vision (WACV'I8). 839-847.
[21] Hongxu Chen, Yinxing Xue, Yuekang Li,Bihuan Chen, Xiaofei Xie, Xiuheng Wu,
and Yang Liu. 2018. Hawkeye: Towards adesired directed grey-box fuzzer. In
Proceedings ofthe2018ACM SIGSAC Conference onComputer andCommunications
Security (CCS'I8). 2095-2108.
[22] Xiao Cheng, Haoyu Wang,Jiayi Hua, Guoai Xu,andYuleiSui. 2021. DeepWukong:
Statically detecting software vulnerabilities using deep graph neural network.
ACM Transactions onSoftware Engineering and Methodology 30,3(2021), 1-33.
[23] George E.Dahl, Tara N.Sainath, and Geoffrey E.Hinton. 2013. Improving deep
neural networks forLVCSR using rectified linear units anddropout. InProceedings
ofthe20131£££ International Conference onAcoustics, Speech and Signal Processing
(ICASSP'13).8609-8613.
[24] XuDuan,Jingzheng Wu, ShoulingJi, Zhiqing Rui, Tianyue Luo, Mutian Yang,
and Yanjun Wu. 2019. VulSniper: Focus your attention toshoot fine-grained
vulnerabilities. InProceedings ofthe2019 International Joint Conference 011
Artificial Intelligence (ryCAI'I9). 4665-4671.
[25] Linton C.Freeman. 1978. Centrality insocial networks conceptual clarification.
Social Networks I,3(1978), 215-239.
[26] Roger Guimera, Stefano Mossa, Adrian Turtschi, andLuisA.Nunes Amaral. 2005.
The worldwide airtransportation network: Anomalous centrality, community
structure, andcities' global roles. Proceedings oftheNational Academy ofSciences
102,22 (2005), 7794-7799.
[27] Jiyong Jang, Abeer Agrawal, and David Brumley. 2012. ReDeBug: Finding
unpatched code clones inentire asdistributions. InProceedings ofthe2012
fEEE Symposium onSeClirity and Privacy (S&P'12). 48-62.
[28] HawoongJeong, Sean P.Mason, Albert L.BarabiIsi, and Zoltan N.Oltvai. 2001.
Lethality and centrality inprotein networks. Nature 411, 6833 (2001), 41-42.
[29] Lingxiao Jiang, Ghassan Misherghi, Zhendong Su,andStephane Glondu. 2007.
Deckard: Scalable andaccurate tree-based detection ofcode clones. InProceedings
ofthe29th International Conference onSoftware Engineering (ICSE'07). 96-105.
[30] Toshihiro Kamiya, Shinji Kusumoto, and Katsuro Inoue. 2002. CCFinder: A
multilinguistic token-based code clone detection system forlarge scale source
code. IEEE Transactions onSoftware Engineering 28,7(2002), 654-670.
[31] Leo Katz. 1953. Anew status index derived from sociometric analysis.
Psychometrika 18,I(1953),39-43.
[32) Seulbae Kim, Seunghoon Woo, Heejo Lee, and Hakjoo Oh. 2017. VUDDY: A
scalable approach forvulnerable code clone discovery. InProceedings ofthe2017
fEEE Symposium onSecurity and Privacy (S&P'I7). 595-614.
[33] Diederik P.Kingma and Jimmy Ba.2014. Adam: Amethod forstochastic
optimization. arXiv preprint arXiv:I412.6980 (2014).
[34] Alex Krizhevsl"", llya Sutskever, and Geoffrey E.Hinton. 2012. lmagenet
classification with deep convolutional neural networks. InProceedings oftheYueming Wu, Deqing Zou, Shihan Dou, Wei Yang, Duo Xu,and HaiJin
2012 Advances inNeural biformatio'l Processing Systems (NIPS'I2). 1097-1105.
[35] Yann loCun, Yoshua Bengio, and Geoffrey Hinton. 2015. Deep learning. Nature
521,7553 (2015),436-444.
[36] Yann LeCun, Leon Battou, Yoshua Bengio, and Patrick Haffner. 1998. Gradient-
based learning applied todocument recognition. IEEE 86,II(1998),2278-2324.
[37] Jingyue Liand Michael D.Ernst. 2012. CBCD: Cloned buggy code detector. In
Proceedings ofthe34th International Conference onSoftware Engineering (ICSE'I2).
310-320.
[38] Zhen Li,Deqing Zou, Shouhuai Xu,Zhaoxuan Chen, Yawei Zhu, and HaiJin.
2021. Vuldeelocator: adeep learning-based fine-grained vulnerability detector.
IEEE Transactions onDependable and Secure Computing (2021), 1-17.
[39] Zhen Li,Deqing Zou, Shouhuai Xu, Hai Jin, Hanchao Qi,and JieHu. 2016.
VulPecker: Anautomated vulnerability detection system based oncode similarity
analysis. InProceedings ofthe32nd Annual Conference onComputer Security
Applications (ACSAC'16). 201-213.
[40] Zhen Li,Deqing Zou,Shouhuai Xu,HaiJin, Yawei Zhu,and Zhaoxuan Chen. 2021.
SySeVR: Aframework forusing deep learning todetect software vulnerabilities.
IEEE Transactions onDependable and Secure Computing (2021),1-15.
[41] Zhen Li,Deqing Zou, Shouhuai Xu, Xinyu Ou, and Yuyi Zhong. 2018.
VulDeePecker: Adeep learning-based system forvulnerability detection. In
Proceedings ofthe2018 Network and Distributed System Security Symposium
(NDSS'I8).1-15.
[42] Guanjun Lin, Wei Xiao, Jun Zhang, and Yang Xiang. 2019. Deep learning-
based vulnerable function detection: Abenchmark. InProceedings afthe 2019
International Conference onInformation and Communications Security (ICICS'19).
219-232.
[43] Guanjun Lin,Jun Zhang, Wei Luo, LeiPan, and Yang Xiang. 2017. POSTER:
Vulnerability discovery with function representation learning from unlabeled
projects. InProceedings ofthe2017 ACM SlGSAC Conference onComputer and
Communications Security (CCS'17). 2539-2541.
[44] Stephan Neuhaus, Thomas Zimmermann, Christian Holler, and Andreas Zeller.
2007. Predicting vulnerable software components. InProceedings ofthe14th ACM
Conference onComputer and Comnumications Security (CCS'07). 529-540.
[45] Matteo Pagliardini, PrakharGupta, andMartinJaggi. 2017. Unsupervised learning
ofsentence embeddings using compositional n-gram features. arXiv preprint
arXiv.I 703.02507 (2017).
[46] amH.Pham, Tung Thanh guyen, Hoan Anh guyen, andTien guyen.
2010. Detection ofrecurring software vulnerabilities. InProceedings afthe 2010
International Conference onAutomated Software Engineering (ASE'lO). 447-456.
[47] Rebecca Russell, Louis Kim, LeiHamilton, Torno Lazovich,]acob Harer, Onur
Ozdemir, Paul Ellingwood, and Marc McConley. 2018. Automated vulnerability
detection insource code using deep representation learning. InProceedings of
the2018 IEEE International Conference onMachine Learning and Applications
(ICMLA'I8).757-762.
[48] Hitesh Sajnani, Vaibhav Saini, Jeffrey Svajlenko, Chanchal KRoy, andCristina V.
Lopes. 2016. SourcererCC: Scaling code clone detection tobig-code. InProceedings
ofthe38th International Confer~nce onSoftware Engineering (ICSE'16). 1157-1168.
[49] Ramprasaath R.Selvaraju, Michael Cogswell, Abhishek Das, Ramakrishna
Vedantam, Devi Parikh, and Dhruv Batra. 2017. Grad-cam: Visual explanations
from deep networks viagradient-based localization. InProceedings ofthe2017
IEEE lnternational Conference 011Computer Vision (ICCV'I7). 618-626.
[50] Umesh Shankar, Kunal Talwar, Jeffrey S.Foster, and David A.Wagner. 2001.
Detecting format string vulnerabilities with type qualifiers. InProceedings ofthe
2001 USENIX Security Symposium (USENlX Security'OI). 201-220.
[51] Lwin Khin Shar, Lionel C.Briand, andHee Beng Kuan Tan. 2014. Web application
vulnerability prediction using hybrid program analysis and machine learning.
IEEE Transactions onDependable and Secure Computing 12,6 (2014), 688-707.
[52] Yueming Wu, Xiaodi Li,Deqing Zou, Wei Yang, Xin Zhang, and HaiJin. 2019.
MalScan: Fast market-wide mobile malware scanning bysocial-network centrality
analysis. InProceedings ofthe34th International Conference onAutomated Software
Engineering (ASE'I9). 139-150.
[53] Fabian Yamaguchi, Nico Golde, Daniel Arp, and Konrad Rieck. 2014. Modeling
and discovering vulnerabilities with code property graphs. InProceddings ofthe
20I4fEEE Symposium onSecurity alld Privacy (S&P'I4). 590-604.
[54] Fabian Yamaguchi, Markus Lottmann, and Konrad Rieck. 2012. Generalized
vulnerability extrapolation using abstract syntax trees. InProceedings ofthe28th
Annual Computer Security Applications COllference (ACSAC'I2). 359-368.
[55] Fabian Yamaguchi, Alwin Maier, Hugo Gascon, and Konrad Rieck. 2015.
Automatic inference ofsearch patterns for taint-style vulnerabilities. In
Proceedings ofthe2015 IEEE Symposium onSecurity andPrivacy (S&P'I5). 797-812.
[56] Yaqin Zhou, Shangqing Liu, Jingkai Siow, Xiaoning Du, and Yang Liu. 2019.
Devign: Effective vulnerability identification bylearning comprehensive program
semantics viagraph neural networks. InProceedings ofthe2019 Advances inNeural
Information Processing Systems (NlPS'I9). 10197-10207.
[57] Deqing Zou, Sujuan Wang, Shouhuai Xu, Zhen Li,and Hai Jin. 2019.
flVuIDeePecker: Adeep learning-based system formulticlass vulnerability
detection. IEEE Transactions onDependable and Secure Computing 18,5(2019),
1-13.
2376
Authorized licensed use limited to: LAHORE UNIV OF MANAGEMENT SCIENCES. Downloaded on August 07,2025 at 09:00:32 UTC from IEEE Xplore.  Restrictions apply. 