Repairing Brain-Computer Interfaces
with Fault-Based Data Acquisition
Cailin Winston
University of Washington
Seattle, Washington, USA
cailinw@cs.washington.eduCaleb Winston
University of Washington
Seattle, Washington, USA
calebwin@cs.washington.eduChloe N Winston
University of Washington
Seattle, Washington, USA
chloewin@cs.washington.eduClaris Winston
University of Washington
Seattle, Washington, USA
clarisw@cs.washington.edu
Cleah Winston
University of Washington
Seattle, Washington, USA
cleahwin@gmail.comRajeshPNR a o
University of Washington
Seattle, Washington, USA
rao@cs.washington.eduRené Just
University of Washington
Seattle, Washington, USA
rjust@cs.washington.edu
Initial
Calibration
SessionInitial
Calibratio n
Sess ion
Regular BCI
Usage DataGenerated
Test CasesFault-Based
Task
Distribution
Repaired
Neural
Decoding
ModelRecalibration
SessionRecalibration
SessionRepaired
Neural
Decoding
ModelInitial
Calibration
Session
Regular BCI
Usage DataPartial
Oracles
Corrective
HeuristicsGenerated
Test CasesFault-Based
Task
DistributionFault-Based
TaskTT
Distribution
Repaired
Neural
Decodin g
ModelRecalibrati
Sessio nRecalibration
Sessio nRepaired
Neural
Decodin g
ModelExample Neural Decoding Model in a BCIModelNeural Signal
Recorded with
EEGPredicted
Hand Gesture
Example Output SlicePredicted
Hand GestureClosed Hand
Example Input SliceInput Neural
SignalArtifact from
Eye Blinking
Example Partial OracleModel
ExecutionFault Occurrence: Sudden
Transition from Open to Closed
Example Corrective HeuristicsSudden
Transition
from Open to
ClosedCompleted Test Case: Add
Missing Intermediate StateClinician Brain-Computer Interface (BCI) User Domain Expert (Clinician or BCI Developer)
Repaired
Neural
Decoding
ModelSlice
FunctionsRecalibration
SessionBaseline
Neural
Decoding
ModelRegular BCI
Usage DataCharacteristic of BCI Usage Task Performed by BCI User
Corrective
HeuristicsGenerate d
Test CasesTTBaseline
Neural
Decoding
ModelPartial
OraclesSlice
Functions
Figure 1: Proposed end-to-end methodology for repairing BCIs (left) and a concrete example for a motor decoding BCI (right).
ABSTRACT
Brain-computerinterfaces(BCIs)decoderecordedneuralsignals
from the brain and/or stimulate the brain with encoded neural sig-
nals.BCIsspanbothhardwareandsoftwareandhaveawiderange
ofapplicationsinrestorativemedicine,fromrestoringmovement
through prostheses and robotic limbs to restoring sensation and
communication through spellers. BCIs also have applications in di-
agnostic medicine, e.g., providing clinicians with data for detecting
seizures, sleep patterns, or emotions.
Despite their promise, BCIs have not yet been adopted for long-
term,day-to-dayusebecauseofchallengesrelatedtoreliabilityand
robustness, which are needed for safe operation in all scenarios.
Ensuringsafeoperationcurrentlyrequireshoursofmanualdata
collection and recalibration, involving both patients and clinicians.
However, data collection is not targeted at eliminating specificfaultsinaBCI.Thispaperpresentsanewmethodologyforchar-acterizing,detecting,andlocalizingfaultsinBCIs.Specifically,it
Permission to make digital or hard copies of all or part of this work for personal or
classroom use is granted without fee provided that copies are not made or distributed
forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation
on the first page. Copyrights for components of this work owned by others than ACMmustbehonored.Abstractingwithcreditispermitted.Tocopyotherwise,orrepublish,topostonserversortoredistributetolists,requirespriorspecificpermissionand/ora
fee. Request permissions from permissions@acm.org.
ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA
© 2022 Association for Computing Machinery.
ACM ISBN 978-1-4503-9221-1/22/05...$15.00
https://doi.org/10.1145/3510003.3512764proposespartialtestoraclesasamethodfordetectingfaultsand
slice functions as a method for localizing faults to characteristic
patterns in theinput data or relevanttasks performed bythe user.
Through targeted data acquisition and retraining, the proposed
methodologyimprovesthecorrectnessofBCIs.Weevaluatedthe
proposed methodology on five BCI applications. The results show
that the proposed methodology (1) precisely localizes faults and (2)
can significantly reduce the frequency of faults through retraining
basedontargeted,fault-baseddataacquisition.Theseresultssug-
gest that the proposed methodology is a promising step towards
repairing faulty BCIs.
CCS CONCEPTS
•Softwareanditsengineering →Correctness ;Softwarever-
ification; Software safety.
KEYWORDS
Brain-computerinterface,neuraldecoding,partialtestoracles,fault
localization
ACM Reference Format:
CailinWinston,CalebWinston,ChloeNWinston,ClarisWinston,Cleah
Winston,RajeshPNRao,andRenéJust.2022.RepairingBrain-ComputerIn-
terfaces with Fault-Based Data Acquisition. In 44th International Conference
on Software Engineering (ICSE ’22), May 21–29, 2022, Pittsburgh, PA, USA.
ACM,NewYork,NY,USA,12pages.https://doi.org/10.1145/3510003.3512764
18692022 IEEE/ACM 44th International Conference on Software Engineering (ICSE)ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA Winston et al.
1 INTRODUCTION
Brain-computerinterfaces(BCIs)aresystemsthatenablecommuni-
cationbetweenthebrainandhardware[ 1,27],byrecordingneural
signalsfromthebrainand/orstimulatingthebrain.Bydecoding
recordedneuralsignals(neuraldecoding)orencodingneuralsig-
nalsforstimulation(neuralencoding),BCIscanrestorelostfunc-tionorevenenhancenormalfunction.Forexample,BCIssuchas
neuroprosthetic limbs have restored motor function in individuals
with muscle impairments or spinal cord injury. Through neural
decoding, BCIscanalso serveimportant diagnosticpurposes such
as detecting seizures, sleep stages, and emotion.
BecauseofthecloseinteractionbetweenBCIsandthebrain,itis
critical to ensure their safety and correctness. Unfortunately, BCIs
can exhibit faulty behavior with decoded intentions (subsequently
referred to as tasks) that can be (a) impossible for a prosthetic to
execute, (b) undesirable for the user (e.g., wavering movements),
or(c)unsafe(e.g.,rapidmotionoftheprostheticthatcouldharm
theuserorabystander).Thesearereferredtoas faults.Typically,
BCIs arefine-tuned during acalibration sessionwith the prospec-
tive user, ideally to eliminate such faults. However, data shifts can
occur during use thereafter due to the non-stationarity of brain
signalsanddifferingenvironmentalconditionsnotaccountedfor
during the controlled calibration sessions. As a result, faults which
were eliminated during initial calibration may reoccur. To subse-
quentlyeliminatethesefaults,furtherrecalibrationofthemodelor
improved data pre-processing is required, which may involve con-
ductingadditionalexperimentstocollectneuraldatawhileusers
performtasks.IdentificationoftasksaBCIperformspoorlyonis
solely based on user reports, which may not be comprehensive.
Tothebestofourknowledge,nomethodologyexistsforcontinu-
ously testing BCIs based on a partial specification of correctness
and subsequently localizing and repairing discovered faults.
We propose a methodology for testing and repairing BCIs based
onexpert-definedpartialtestoracles(partialspecificationofcor-
rectness),correctiveheuristics(datatransformationfunctions),and
slice functions for fault localization (Figure 1). For a given class of
BCIs, a domain expert such as a clinician or BCI developer defines:
•Partial test oracles : detect faults during BCI usage.
•Correctiveheuristics :transformfaultymodeloutputsbymap-
ping implausible output values to plausible ones.
•Slice functions : slice and classify BCI inputs and outputs.
Together, these enable repairing faulty BCIs through targeted data
acquisition informed by fault localization. Specifically, detectedfaults are localized to co-occurring input or output slices. Inputslices correspond to characteristics of BCI usage, such as the in-
dividual usingthe BCI,environmental settings, andthe qualityof
the pre-processed data that the underlying neural decoding model
ingests. Output slices correspond to tasks which are the various
actionsthatausercanperformwiththeBCI.Clinicianscanthen
acquire data by targeting tasks co-occurring with faults. To repair
theBCI,theunderlyingneuraldecodingmodelisretrainedusing
theacquireddata.Localizingfaultstoinputslicesmayalsobeused,e.g.,toimprovethepre-pr ocessingoftheneuralsignaltoeliminate
faultsstemmingfromartifactsinthatsignal.Notethatcorrective
heuristicstransformfaultymodeloutputs toaidlocalizingfaultstotasks.ThisisdistinctfromrepairingaBCI,whichinvolvestargeteddata acquisition, based on a task distribution, and model retraining
in an attempt to reduce the likelihood of faults occurring.
As an example, consider a BCI that predicts hand gestures from
neuralsignals.Adomainexpertmaydefineapartialtestoraclethat
identifies sudden transitions between hand positions as faults, a
corrective heuristic function that corrects a sudden-transition fault
by smoothly interpolating between the hand positions, and slicefunctions that classify the various hand gestures. If instances of
suchsudden-transitionfaultsoccurmorefrequentlyforslicesoftheheuristicallytransformedoutputthatcorrespondtoaclosedgesture
(i.e., the fault is localized to the closed gesture task), clinicians and
users would be recommended to collect additional data for this
task.Furthercalibrationofthegesturepredictionmodelcanreduce
the number of sudden-transition faults. The domain expert may
alsodefineaslicefunctionthatclassifiesinputslicesthatcontain
artifacts from eye blinking (a characteristic interference in EEGdata). If faults are localized to these input slices, BCI developers
couldbeaskedtoimprovepre-processingtoeliminatesuchartifacts.
WeevaluatedtheproposedmethodologyonfiveBCIapplications.
The results show that (1) partial test oracles can detect faults in
BCIs,(2)faultlocalizationcanidentifyinputandoutputslicesco-
occurring with faults, and (3) targeted, fault-based data acquisition
can significantly reduce the frequency of faults in BCIs.
The keycontribution of thispaper is anend-to-end, human-in-
the-loop methodology for repairing deployed BCIs. Specific contri-
butions include:
•A classification of BCI applications and faults (Section 3).
•A novel application of partial test oracles and fault localiza-
tiontoBCIs,enablingtargetedfault-baseddataacquisition
to repair faulty BCIs (Section 4).
•A validation of the proposed methodology using five BCI
applications, demonstrating that faulty BCIs can be success-
fully repaired post-deployment (Sections 5 and 6).
2 BACKGROUND
2.1 Brain-Computer Interfaces
ManyBCIsinvolvetranslatingneuralsignals,whicharerecorded
from the brain and reflect a person’s intended action (task), into
control signals (e.g., for a prosthetic limb in a paralyzed person,for an avatar in an augmented or virtual reality environment for
rehabilitationtherapy,orfornon-medicalapplicationssuchasbrain-
controlledgaming.)ABCIhascomponentsforsignalacquisition,
signalprocessingandfeatureextraction,andtranslationofthese
signals into a meaningful output through neural decoding. Neural
signaling in the brain utilizes electrical impulses communicated
between neurons. This electrical activity can be measured through
avarietyoftechniques,rangingfromhighlyinvasiveprocedures
involvingbrainimplantstononinvasivemethodssuchaselectroen-
cephalography (EEG). The signal is often recorded as a 2D array,capturing time and input channels—streams of input from elec-
trodesplacedonspecificplacesonthescalp(e.g.,EEG)orwithinthebrain(e.g.,intracorticalrecordings).Therecordedbrainactivitycan
beaffectedbyartifacts,suchaslinenoisefromexternalelectrical
impulses and movement-related artifacts. The brain signal can alsobeweakandmixedduetosignalpropagationthroughbiologicaltis-
suebeforemeasurement.Signalprocessingandfeatureextraction
aretypicallyusedtoreducenoiseandextracttask-relevantfeatures
1870Repairing Brain-Computer Interfaces with Fault-Based Data Acquisition ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA
Brain-Computer
Interfaces
Input Modality Intended Use Control Mechanism Prediction Scope
Electroencephalography
(EEG) 
noninvasive method of
collecting time-series, multi-
channel electrical data from
surface of the brainMagnetoencephalography 
noninvasive but bulky
method of collecting time-
series magnetic data from
surface of the brain
Electrocorticography 
invasive method of
collecting time-series, multi-
channel electrical data from
surface of the brain more
precisely than EEGIntracortical Neural
Recording 
invasive method of
collecting high resolution
time-series data from small
neuronal populationsRestorative Diagnostic/Treatment
Movement Restoration 
restore user's ability to
control movement of limb
Communication  
decode intended speech
Sensory Restoration 
stimulate brain to evoke
sensations expected based
on external sensorsDeep Brain Stimulation  
treatment option for
Parkinson's Disease that
involves stimulation of deep
brain structures
Epilepsy Prediction  
predicts seizures based on
neural activity and alerts
user upon predictionActive
decode neural patterns
evoked by user (e.g., by
imagining a movement)
Reactive 
decode neural reaction to
stimulus (e.g., by selectively
focusing on a particular
character)Passive 
detects unintentional
changes in neural activity
(e.g., during distraction)Continuous Outputs  
real-valued states such as
position or velocityDiscrete Outputs 
discrete states such as
stage of sleep
Figure 2: Classification of Brain-Computer Interfaces
fromthedata.Evenwithsuchprocessing,noiseoftenpersistsin
the signal and can result in faults.
Theprocessedneuraldataisthentranslatedintoadesiredoutput
using a neural decoder. While some neural decoders are hand-
craftedmodelswithhighlyinterpretableparameters,otherdecoders
utilizeclassicalmachinelearningmethodsand,morerecently,deep
neural networks that can model complex patterns in data with less
manualparametertuning.Thetypeofdecoderisdeterminedbased
on the application and the complexity of the neural data.
Neural decoders are often trained from hand-labeled datasets
collectedfromstudieswithsev eralparticipants.However, before
deployingsuchmodelstoadevice,suchasaprosthetic,acalibration
sessionisrequiredwiththeindividualuser,duetothevariability
ofneuralsignalsacrossindividuals[ 21].Inthissession,neuraldata
is collectedwhilethe individualperforms orimagines performing
certaintasks.Forexample,forahandprosthetic,anindividualmay
be asked to move their hand in specified directions and grasp anitem. The model is calibrated on the neural data that is collected
whiletheuserperformsthesetasks,sothatitcanaccuratelydecode
the neural data and predict the true intention of the individual.
2.2 Challenges in Deploying BCIs
There are multiple challengesassociated with deploying accurate
BCIs.Onechallengeistheneedforextensivedatacollectionandtrainingoftheneuraldecoder.Inthesuccessfuloperationofany
BCI, two systems are at play—the neural decoder and the user’sbrain. While the neural decoder learns neural patterns that cor-respond to specific user states, the user’s brain adapts to controlthe BCI. Consider a motor BCI whose goal is to perform move-ments desired by the user. First, the neural decoder is calibrated[
22]. Neural activity is recorded while the user imagines various
movements(imaginationisrequiredwhentheindividualispara-
lyzedorotherwiseunabletophysicallyperformthedesiredtask)
[22].Thisrequireshoursofexperimentsintheclinic,withtheuser
performing many tasks that the BCI would be expected to perform.
The data must also be manually labeled and annotated in some
applications,andthismaybeerror-prone.Aneuraldecoderisfit
to this data. Next, the user begins using the BCI and learning how
to control it. If faults persist, further calibration may be required.
AnotherchallengeisthatincurrentBCIapplications,itishardto
monitorandcharacterizefaultsafterdeployment.IfaBCIperforms
poorly,a usermayreportfailurescenarios, whichaclinicianmay
use to prescribe additional data collection sessions. Faults that arenotreported arenot necessarilyaccountedfor,and thusitis hard
to assess the performance and safety of the device.
2.3 Software Testing and Debugging
Recognizing theneed fora methodologyfor identifyingand repair-
ing faults in BCIs post deployment, we explore the applicabilityof existing software testing constructs to this emerging domain.
Partial test oracles, which encodea partial specification of correct
behavior, have been extensively used to automate software testing
for complex systems (e.g., [ 3,16,30,34]. While some partial test
oraclesspecifywhichpropertiesofasystem’soutputmustholdfor
any input, others specify such properties with respect to a giveninput or set of inputs. In our use case, partial test oracles test a
property of neural decoding model executions.
Softwaredebuggingfortraditionalsoftwaresystems(asopposed
tolearnedMLmodels)involveslocalizingafaulttoitsrootcause
in the program’s source code as well as repairing that fault. The
software engineering research community has developed a variety
of approaches to aid and automate software debugging. For exam-
ple, statistical fault localization approaches aim to rank program
elementsbytheirsuspiciousness[ 25,35].Similarly,programslic-
ingapproaches [ 33]aim toidentifyslicesof aprogramof interest,
based on slicing criteria (e.g., derived from data- or control-flow
properties.)Informationaboutafault’srootcausecanthenbeusedtorepairthefaultysystem.Thekeydifferencebetweenourapplica-tionofsuchdebuggingtechniquesandtheapplicationtotraditional
software systems is the focus on data as opposed to programs.
3 CLASSIFICATION OF BCI APPLICATIONS
AND FAULTS
Prior work has classified BCIs based on system characteristics and
target usersand tasks (e.g., [ 20,31]). Sincedifferences inBCIs have
implications on the ability to define partial test oracles, correctiveheuristics, and slice functions, we expand upon existing classifica-
tions of BCI applications and additionally classify BCI faults.
3.1 Classification of BCI Applications
Our classification focuseson four key dimensionsalong which BCI
applications can be classified (Figure 2).
Prediction Scope BCIs varyin their prediction scope. BCIs may
predict continuous outputs (e.g., position and velocity for motor
decoding BCIs) or discrete outputs (e.g., stages of sleep).
1871ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA Winston et al.
Table 1: Classification of BCI Faults.
Category Fault Description Implication BCI Application(s)*
InputValidation Artifact (A) Signal noise from irrelevant motor or
eye movementInterference with neural signal
input to decoder—
Temporal Validation Temporal Inconsistency (TI) Flickering in decoder predictions Undesirable behavior MD, OE, CC, FN, SS
Illegal Transition (IT) Impossible/improbable transition be-
tween predicted statesImpossible/undesirablebehavior MD, SS
Rapid Motion (RM) Improbably large change in prediction Undesirable/unsafe behavior CC, FD
Consistency Multimodal Inconsistency (MM) Disagreement between predictions by
decoder and by auxiliary modelPotentially incorrect prediction SS
DomainKnowledge Out of Bounds (OB) Impossible prediction Impossible behavior CC
*Evaluate d BCI Applications (Table 2). MD: Motor Decoding, OE: Observe-or-Execute Classification, SS: Sleep Stage Classification, CC: Cursor Control, FN: Field Navigation.
InputModalities BCIsusevarioustypesofinputmodalities(i.e.,
types of neural data analyzed). These range from noninvasive tech-
niques such as magnetoencephalography and electroencephalogra-
phy(EEG)toinvasivebutmoreprecisetechniquessuchasintracorti-
cal neural recordings and electrocorticography. Despite differences
in techniques, most modalities yield time-series data that are occa-
sionally multi-channel. Specific features, such as frequency compo-
nentsofsignalsoraveragefiringrates,maybecomputedfromraw
data and used to predict states such as intended movement.
ControlMechanism BCIsvaryintheircontrolmechanisms(i.e.,
how a user interacts with the BCI.) Some motor BCIs require users
to actively control their neural patterns through imagination to
signaltheirintendedmovement.OtherBCIsdetectspecifictypes
of neural activity that are evoked upon sensory stimulation. In this
way,suchBCIsmaybeabletodetectwhethertheuserisselectively
focusing on an object, such as a character in a speech-decoding
BCI. Still other BCIs may detect changes in the neural activity that
are not intentionally modulated by the user.
IntendedUse BCIsvaryintheirintendeduse.Somearerestorative,
aimingtoprovidesensoryormotorfunction.Othersarediagnos-
ticor treatment-centered.Examples ofthe lattercategoryinclude
deep brain stimulation, which stimulates deep regions of the brain
andhasbeenfoundtomitigatesymptomsofParkinson’sDisease
and epilepsy, and epilepsy predictors that may alert the user upon
prediction of a seizure [8].
3.2 Classification of BCI Faults
We classify BCI faults into four non-disjoint categories, summa-
rized in Table 1: input validation, temporal validation, consistency
across modalities and models, and domain knowledge violation.
Categorizing faults in such a way motivates our methodology in
which faults are detected through partial test oracles (Section 4).
Inputvalidation Neuraldata canbenoisy duetomuscle move-
mentandelectricalinterference.Carefulpre-processingandfeature
extraction to remove the resulting artifacts in the input data is crit-
ical. Since the inputs that a model sees during training likely have
few artifacts due to controlled experimental conditions, artifacts
remaining in the input data due to faulty pre-processing are a par-
ticular concern for regular usage of the BCI after deployment.
Temporal validation Model output may be temporally incorrect.
In some applications, for example, the output class should notchange toorapidly betweencertain statesor within asmall range
of the output space. Indeed, one of the challenges in developing
prostheticsisproducingsmoothlimbmovementwhenoperating
in free space or when precisely grasping small objects [ 24]. Fur-
thermore,certainstatetransitionsareinvalidorimprobable,due
to physiological constraints. Thus, even though the neural decoder
itselfmaybetime-independentandmayhavenoconstraintsonthe
validity between disjoint predictions of the model, temporal faults
can occur, since the model is utilized in a time-dependent context.
Consistency Ifpresent,auxiliarydatasuchasrespiration,heart
rate, or movement may be utilized to enforce consistency between
theauxiliaryinformationandtheneuraldecoder’spredictions.Fur-
thermore, some BCIs utilize multiple models or data from different
modalities of recording neural signal to make predictions. For suchBCIs,theoutputsacrossthesemodelsormodalitiesmustbeconsis-
tent. For example, the presence of an artifact in the pre-processed
data must be consistent across different recording modalities.
Domainknowledge Domainknowledgeabouttheexpectedbehav-
ior of a system can aid testing. For example, there may be physical
constraints on limb positions, such as invalid finger positions for a
handgraspingBCI,andtherecouldbepatternsinmodeloutputthat
areknowntobeimprobablebasedondomainknowledge.Knowl-
edgeofanindividualuser’shealthconditionsanddailyactivities
may also be applied to enforce constraints.
4 REPAIRING BCIS WITH FAULT-BASED
DATA ACQUISITION
ThissectiondetailstheproposedmethodologydepictedinFigure1.
Sections4.1–4.3describepartialtestoracles,correctiveheuristics,
andslicefunctions,andsection4.4detailshowthesecomponents
are used for targeted, fault-based data acquisition and repair.
4.1 Detecting Faults with Partial Test Oracles
OurmethodologyusespartialtestoraclesasameanstotestBCIs
and detect faulty outputs of the underlying neural decoding model.
The behavior and expected output of a neural decoder usually
cannotbepreciselyspecified,whichmakespartialoraclesespecially
suitable for testing. These oracles capture domain knowledge of a
partialspecificationofaBCI—specifically,whatpropertiesofthe
neural decoder output violate necessary conditions.
1872Repairing Brain-Computer Interfaces with Fault-Based Data Acquisition ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA
PartialTestOraclesforInputValidation Softwareandhardware
systemsusuallyhavedefinedpreconditionsthatmustbemetfor
validexecution.Insoftwaresystemsforexample,theseprecondi-
tionscanbeexpressedthroughassertions.InthecontextofBCIs,
inputvalidationissimilartosuchpreconditions:ifpre-processed
neuraldataisdissimilartothetypeofdataadecoderwastrained
on, the decoder cannot be expected to produce valid output. Ar-
tifacts that occur in neural data due to unrelated movement and
interferencewiththeneuraldatacollectionareoftenremovedbysignalprocessingbeforethedataispassedthroughtheneuralde-
coder. Partial test oracles can be defined to capture cases in which
these artifacts do not get removed from the data input to the de-coder. These cases can then be later analyzed and used to either
improvethesignalprocessingstepsorimprovethegeneralizability
and robustness of the decoder.
Partial Test Oracles for Temporal Validation Partial test oracles
canalsocaptureneuraldecoderfaultsthataretemporal.Oraclesfor
temporal faults utilize ideas from metamorphic testing in that pre-
viousmodeloutputisconsideredwhentestingsubsequentmodel
output.Metamorphicrelationsareuseful,forexample,fordetecting
illegal transitions in model output.
Partial Test Oracles for Consistency Partial test oracles can detect
inconsistencies between different models or across different modal-
ities ofneural recording.For example, asimpler,precise auxiliary
modelthatacceptsthesameinputasaneuraldecoder,orrelated
data, can be used to identify faults in the neural decoder’s output.
PartialTestOraclesforDomainKnowledge Test oracles canalso
capture faults based on domain knowledge of the likelihood of
various events. For example, clinicians may have noticed in exper-
iments that a certain state transition in the model output space
isextremelyunlikelyinnaturalexecutionorthataparticularpo-
sition is physically impossible or unsafe. Such experience-based
constraints can be defined in form of a partial test oracle.
4.2 Transforming Implausible to Plausible
Model Outputs with Corrective Heuristics
While partial test oracles can detect faulty predictions, correct-
ingthesepredictionsischallengingbecausethecorrectoutputis
unknown—as is the user’s activity during regular usage of the BCI
that resulted in the fault occurring.
Ourmethodologyusescorrectiveheuristicsthattransformfaulty
predictionsbymappingimplausibleoutputvaluestoplausibleones.
A different corrective heuristic is defined for each type of fault. For
example, a corrective heuristic may transform an illegal transition
by changing the faulty prediction to the previously predicted state
ortoastatethatisreachablefromthepreviousstate.Similarly,a
corrective heuristic may transform an out-of-bounds coordinate to
thenearest in-boundcoordinate.While thereisno guaranteethatthe resulting value is itself correct, it is at least plausible.
Corrective heuristics may utilize auxiliary information, such
asastatetransitionprobabilitymatrixlearnedonagroundtruth
dataset,whileothersmaygeneratecorrectionsbasedontheneu-
ral decoder’s predictions on surrounding data points. Corrective
heuristicsforneuraldecodersarespecifictoafaultinaspecificBCI
application, but they do share some common characteristics. First,
unlikelabelingfunctionsusedforweaksupervision[ 28],correctiveheuristicsonlyapplytofaultypredictions.Second,sinceBCIsop-
erate on time-series data (i.e., neural signals over time), corrective
heuristicsrelyonpreviouspredictions.Forexample,acorrective
heuristic for illegal state transitions may assume that the previous
decoder predictions were correct and may select the most common
recently predicted state as the plausible output.
While corrective heuristicscan transform individual faulty pre-
dictions, they do not truly repair the neural decoding model itself,
and hence cannot be expected to generalize to long-term BCI us-
age.Consequently,ourmethodology usescorrectiveheuristicsto
improvefaultlocalizationbutnotasastandalonesolutiontorepair.
4.3 Localizing Faults with Slice Functions
Ourmethodologyusesslicefunctionstolocalizeadetectedfault
toco-occurringinputslicesandoutputslices.Guidedbydomain
knowledge,theseslicefunctionscapturecharacteristicsoftheinput
and map outputs to tasks, given a stream of neural decoder model
executions.Forapplicationswithdiscreteoutput,outputclassescan
be directly mapped to tasks; for applications with continuous out-
put, the output is discretized into bins, which correspond to tasks.
While output slices are directly related to tasks that the user
might perform during daily usage of the BCI, input slices are re-
latedtosubtlercharacteristicssuchasdataartifacts,environment
settings, or characteristics of the user. Localizing faults to input
slices enablespossible refinement oftasks (e.g., performinga task
in a particular environment setting) and improvement of BCI com-
ponents such as pre-processing (e.g., artifact removal).
Thispaperstudiestheeffectivenessoflocalizingfaultstobothin-
putandoutputslicesbutonlyusestheoutputslices(tasks)toguide
targeted data acquisition by generating a fault-based task distribu-
tion. We conjecture that faults localized to input slices can informBCI developers aboutnecessary improvements of data-processing
components. We leave a deeper exploration as future work.
4.4Retraining with Fault-Based Data Acquisition
Our methodology uses fault-based data acquisition that is focused
oneliminatingspecificfaults.Simplyretraininganeuraldecoder
on heuristically corrected data or randomly sampling data is insuf-
ficient. First, heuristically corrected data, when directly used for
retraining,wouldbeinherentlynoisy.Second,non-targeteddataac-
quisition is inefficient because faults are not uniformly distributed
across tasks. Targeted, fault-based data acquisition, by contrast,
yields a more focused training dataset.
Dataacquisitionisthestandardmethodfortrainingandrecali-
brating BCIs for users’ needs. However, the traditional approach to
data acquisition is not targeted at eliminating particular faults. For
example,auser’sreportthattheBCIsometimesrapidlyswitchesbe-tweenacquiringandreleasingmorethanonceforasinglegrasping
task has an unknown root cause and cannot be easily addressed.
Using partial test oracles, corrective heuristics, and slice func-
tions,ourmethodologycomputesacoincidencedistributionoftasks
based on fault occurrences from past BCI usage. This computed
distributionoftasksmayindicatethataparticulartask(e.g.,astage
ofacquiringorgrasping) tendstocoincidewithfaultsmoreoften
and thus requires more training data to inform the model’s predic-
tionsforthatfaultytask.Whiletheexampleofsimplegraspcontrol
1873ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA Winston et al.
Table 2: Summary of BCI Applications Used for Evaluation.
BCI
ApplicationInputModalityOutputPredictionControlMechanismIntendedUseDecoderModel*PerformanceMetric
MotorDecoding (MD) EEG One of 3 hand postures Active Restorative LSTM Classification Accuracy
Observe-or-Execute Classification (OE) EEG Observation or execution Active Restorative SVM Classification AccuracySleep Stage Classification (SS) EEG One of four sleep stages Passive Diagnostic RF Classification AccuracyCursor Control (CC) SNR 2D cursor position Active Restorative WCD Mean Squared Error
Field Navigation (FN) SNR 2D position in field Active Diagnostic Neural Net Mean Squared Error
*SNR:Single neuron recordings; SVM: Support vector machine; RF: Random forest classifier; WCD: Weiner Cascade Decoder.
has a small set of tasks, BCIs that control a wider range of handgestures perform a larger set of tasks. The more tasks a BCI per-
forms, the more important itis to acquire training data according
to a task distribution to effectively target and eliminate faults.
The output slice functions are applied to the heuristically cor-
rectedmodeloutputstodetermineamoreaccuratetaskdistribution
(e.g., an illegal state or out-of-bounds prediction cannot be directly
mapped to a task). The task distribution is then used to retrain the
underlying model.
5 EVALUATION APPROACH
Section 4 proposes a methodology for detecting and repairing BCI
faults.Toevaluatetheefficacyoftheindividualcomponentsofthis
methodology, we studied the following three research questions:
•RQ1: Can partial test oracles precisely detect BCI faults?
•RQ2:Cancorrectiveheuristicsaccuratelytransformfaulty
model outputs?
•RQ3: Can BCI faults be localized to input and output slices?
To evaluate the efficacy of BCI repair via targeted, fault-based data
acquisition, we answer the following two research questions:
•RQ4: Can fault-based data acquisition and model retraining
repair BCI faults?
•RQ5: Are corrective heuristics or fault localization sufficient
on their own?
To answer our research questions, we selected 5 different neural
decodingBCIapplications(summarizedinTable2).Eachdecoder
uses neural data (EEG or single neuron recordings) in some model
species (human, monkey, or rat) to decode an aspect of behavior
(motionorsleep).Weusedpubliclyavailablelabeleddatasetsand
existing implementations of neural decoding models.
We split each ground truth labeled dataset into a training set for
initial training and calibration, an observation set to simulate regu-
larusage,anacquisitionsetthatcanbesampledfromtosimulate
clinical data acquisition, and a testing set for evaluating perfor-mance. We generally split each dataset based on a 6:2:1:1 ratio.For the Field Navigation application, we observed during initialexploration that 20% of the data had substantially lower qualitythan the rest; we discarded the data. The baseline model of the
CursorControlapplicationhadafaultfrequencyveryclosetozero,
whichwouldhaverendereditasnotsuitableforourevaluation.We
discarded 20% of the training data, still leaving the Cursor Control
applicationwithasubstantiallylowerfaultfrequencythanallother
applications (Table 4).
Wefirsttrainedeachneuraldecoderonthetrainingsettoachieve
a baseline model. We then made predictions on the observation setusingthe baselineneuraldecoder,simulatingregular usageofthe
BCIandcapturingfaultoccurrences.Weusedthecollectedfaultstoperformsomemethodofrepairandre-assesstheperformance.The
modelperformancewasalwayscomputedonthetestingset.Fortheresultsonperformanceandfaultfrequency,werantentrials
using different splits of the dataset and averaged the results.
5.1 Selected BCI Applications
We selectedfive neural decoderapplications (Table 2),aiming at a
representativeselectionbasedontheclassificationinSection3.1.
Specifically,weselectedbothdiscrete-outputandcontinuous-output
decoding BCI applications, those that use either EEG or single-
neuron recording (SNR) as the input modality, both active and pas-
sive BCIs, and both restorative and diagnostic BCIs. Selecting BCIs
that vary along the four dimensions enables us to more compre-
hensivelyevaluateourproposed methodology.For example,BCIs
with discrete output classes allow for testing output validity based
onstatetransitionviolation,whilethosewithcontinuousoutput
spacerequireassertionsonthemagnitudeandrateofchangeofthe
output and also make defining accurate corrective heuristics more
challenging. Furthermore, classical ML models usually operate on
manuallyengineeredfeatures,whiledeepneuralnetworksdonot
requiresuchfeatureengineering,andthismayhaveimplications
on the ability to repair faults.
5.1.1 EEG Motor Decoding (MD). WeusedtheEEGMotorMove-
ment/Imagery Dataset from Physionet to train an LSTM-based
neural decoder [ 12,29,37] to classify three fist positions. EEG data
was recorded from 64 electrodes placed in precise locations on the
scalp while participants closed their left fist, rightfist, or neitherbased on the location of a cursor on a screen. This decoder has
immediateapplicationsinahandprostheticthatmustdecodethe
user’s intention to open or close a particular fist to grasp an object.
5.1.2 Observation-or-Execution Classification (OE). In this applica-
tion,asupportvectormachine(SVM)modelwasusedtoclassify
betweenactionobservationandmotorexecutionofthesittostandaction[
5,6].EEGandelectromyography(EMG)datawerecollected
while participants were shown a video stimulus of someone per-
formingthesittingtostandingtask(actionobservation),givena
rest period, and then asked to execute that task (motor execution).
The data collected while executing the action was processed to
extract movement related cortical potentials before being classi-fied. This decoder has applications in motor prosthesis, because
distinguishingtheintentofausertoperformanactionvs.apassive
thought or observation of an action is critical for correctness.
1874Repairing Brain-Computer Interfaces with Fault-Based Data Acquisition ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA
Table 3: Corrective Heuristics for BCI Faults.
Fault BCI Application(s)* Description of Corrective Heuristic
Temporal Inconsistency OE, SS Select the most common state predicted by the decoder on surrounding data points
CC, FN Compute the average of decoder predictions on surrounding data points
Illegal Transition MD Sample from state transition probabilities learned on training dataset
SS Select a state predicted by decoder on previous data point
Rapid Motion FN Compute the mean of the most recent outputs or closest possible output
Multimodal Inconsistency SS Compute the most common state predicted by the decoder on previous data points
Out of Bounds FN Compute the mean of the most recent outputs or the closest in-bounds value
*MD: Motor Decoding, OE: Observe-or-Execute Classification, SS: Sleep Stage Classification, CC: Cursor Control, FN: Field Navigation.
5.1.3 Sleep Stage Classification (SS). For application diversity, we
selected a passive (diagnostic) BCI which classifies sleep/wake
stages into five possible outcomes. We used the Sleep-EDF dataset
containingwhole-nightPolySomnoGraphicEEGrecordingsanda
Random Forest Classifier to classify between stages [ 7,13]. Such a
BCI can help monitor and detect abnormalities in individuals sleep
patterns that could signify underlying medical conditions.
5.1.4 Cursor Control (CC). In this continuous decoding applica-
tion,aWienerCascadedecoderpredictsthex-andy-coordinatesof
acursorona2Dscreencontrolledbyamonkeyphysicallymanipu-latingamanipulandum.Weusedadatasetthatcontainedsingle-cellrecordingsfrom52neuronsinthebrainandwasacquiredfromthe
Kording Lab [ 11]. The ability to control a digital cursor with one’s
mind has significant implications for individuals with impaired
mobility and communication skills.
5.1.5 Field Navigation (FN). Thefinalapplicationinvolvedusing
a deep neural network to predict the x- and y-coordinates of arat navigating towards rewards on a platform [
11]. We utilized
anotherdatasetfromtheKordingLab,whichcontainssingle-cell
recordingsfromtherat’shippocampus,apartofthebraininvolved
inmemory.Suchmotormovement-relatedBCIapplicationshave
practical applications for developing prostheses.
5.2 Partial Test Oracles
We defined partial test oracles for each of the five BCI applications.
Most of these oracles are stateful (i.e., state is maintained across
multiple executions of the decoder model) and are similar to meta-
morphic relations [ 30]. Given each new model execution, a partial
testoraclespecifieswhatexecutionsamongthecurrentandpast
consecutive model executions are faulty, if any.
5.2.1 EEG Motor Decoding (MD). Inthisapplication,weidentified
illegal state transition andtemporal inconsistency faults, both of
whichfallunderthecategoryoftemporalvalidation.First,based
ontheexperimental setupforthisapplication, itisimpossiblefor
the participant to directly switch between having their left fistclosed and right fist closed, and thus transitions between these
states can be considered “illegal.” Furthermore, due to the presence
of noise in the input EEG signals and limitations of the baseline
decoder, the model’s prediction may flicker rapidly between statesover a period of time instead of consistently remaining in a certain
state for a reasonable amount of time (temporal inconsistency ).
5.2.2 Observation-or-Execution Classification (OE). Fortheobserve-
or-execute classification application, we focused on a temporal
inconsistencyfault:anindividualcannotrapidlyswitchbetween
action observation and motor execution since they remain in each
state for a non-trivial period of time, and thus the output of the
decoder should not flicker between those states.
5.2.3 Sleep Stage Classification (SS). For the sleep stage classifica-
tionapplication,wecoverthreefaults,ofwhichtwofallintothe
category of temporal validation. We identified an illegal transition
faultasitisphysiologicallyimpossibletotransitionbetweencertain
stages of sleep, anda temporal inconsistency fault because individ-
uals remain in one stage of sleep for an extended period of time.
The third partial test oracle (for the multimodal inconsistency fault)
identified inconsistencies between the neural decoder’s output and
theoutputofabinaryclassifierthatclassifieswhethertheBCIuser
is awake or sleeping based on auxiliary data, including respiration,
body temperature, and EMG data.
5.2.4 Cursor Control (CC). For the cursor control application, we
identifiedtwodifferenttemporalfaults,temporalinconsistencyand
rapidmotion.First,theBCIcanmakemultiplefaultypredictions
of position values that change significantly in a short period oftime (temporal inconsistency ) when the cursor movement should
be smooth. Second, the BCI can consecutively predict two position
values whose distance exceeds a given threshold (rapid motion ),
when the cursor should move at a slower pace.
5.2.5 Field Navigation (FN). For the field navigation application,
wedefinedthreefaults.First,theBCIcanmakean outofbounds pre-
diction,incorrectlypredictingapositioncoordinatethatliesoutside
the field. This is an example of a violation of domain knowledge.
Second,wedetected temporalinconsistency faultsinthisapplication:
the position in the field cannot change too rapidly due to physical
limitations to rat movement. Third, we defined the rapid motion
fault as predictions with unreasonable sudden jumps.
5.3 Corrective Heuristics and Slice Functions
WedefinedcorrectiveheuristicsforeachofthefiveBCIapplications.
Table 3 summarizes these heuristics and the faults they apply to.
1875ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA Winston et al.
Table 4: Frequency of BCI Faults Detected by Partial Test Oracles. Precision is the percentage of correctly detected faulty outputs,
givengroundtruth.∗Forcontinuous-outputapplicationstheprecisionisgenerallyunknowablewithoutdefininganepsilonuptowhich
model outputs are considered equal; for some faults such as out of bounds (OB), however, precision is guaranteed to be 100%.
BCI Application Fault Precision Frequency
Motor Decoding (MD) Temporal Inconsistency (TI) 76% 12.7%
Illegal Transition (IT) 91% 3.13%
Observe-or-Execute Classification (OE) Temporal Inconsistency (TI) 62% 37.63%
Sleep Stage Classification (SS) Temporal Inconsistency (TI) 59% 26.6%
Illegal Transition (IT) 72% 7.66%
Multimodal Inconsistency (MM) 94% 7.35%
Cursor Control (CC) Temporal Inconsistency (TI) —∗0.69%
Rapid Motion (RM) —∗0.26%
Field Navigation (FN) Temporal Inconsistency (TI) —∗7.89%
Rapid Motion (RM) —∗7.89%
Out of Bounds (OB) 100%∗1.28%
For each of the five BCI applications, we defined slice functions
for capturing discrete input and output slices, given a stream of
neuraldecodermodelexecutions.Forthethreeapplicationswith
discrete output (motor decoding, observe-or-execute classification,
and sleep stage classification), we defined output slice functions
that map output classes to tasks. For both the Cursor Control and
the Field Navigation application, we defined output slice functions
toclassifythedirectionofmovementofthecursorortherat,respec-
tively. For the Cursor Control application, we additionally defined
output slice functions to classify the position (mapping each coor-
dinate to a quadrant subspace of the screen) of the cursor.
Both the Cursor Control application and the Field Navigation
application additionally utilized functions that capture input slices.
Wedefinedtwoslicesbasedonpropertiesofthefiringactivityof
single neurons. The hypoactivity andhyperactivity slice functions
detectwhentheneuralsignaloveranentiretimebinisbelowor
above certain thresholds, respectively.
5.4 Retraining and Evaluating Repair
WhiletheMotorDecodingandFieldNavigationneuraldecoders
usedneuralnetworksandcouldbeefficientlyretrainedbyincremen-
tallytrainingonnewdata,theotherthreedecodersusedtraditional
ML models and required retraining with a concatenation of the
initial and new training data. To acquire the new training data, we
sampled 500 data points from the acquisition dataset.
To assess the effectiveness of our methodology for repairing
BCIs, we compared both fault frequency and overall prediction
performance of a repaired model to the baseline model. We specif-
ically assess whether different data acquisition strategies lead to
significant differences.
6 EVALUATION RESULTS
6.1 RQ1: Can partial test oracles precisely
detect BCI faults?
Since faults are detected through partial test oracles, we computed
precisionasthepercentageofcorrectlydetectedfaults,basedon
ground truth, out of all faults detected by an oracle.PrecisionofBCIFaultDetectionviaPartialTestOracles According
to Table 4, the oracle capturing inconsistency with the auxiliary
model(MultimodalInconsistency)hasthegreatestprecision,fol-
lowedbytheoraclescapturingillegaltransitions,astheyidentify
statesofthedecoderthatarecertainlyincorrect.Whiletheother
oracles have lower precision, they can be fine-tuned to improve
precision. A test oracle that detects temporal inconsistency, for
example,canbehardtodefine,asonemustfine-tunethewindow
sizeofmodelexecutionstoconsideratatimetodetermineinconsis-
tency.However,weobserveinSection6.5thatoracleswithlower
precision are still valuable in improving decoder performance.
PrevalenceofBCIFaults AccordingtoTable4,themostprevalent
faults detected by partial test oracles across all the applications are
illegaltransitionandtemporalinconsistency.Thisisnotsurprising
because neural decoders process temporal data that varies in very
specific ways across time. Furthermore, the prevalence of all faults
indicatesthatthere ispotentialforimprovingthe performanceof
neural decoders by eliminating faults.
6.2 RQ2: Can corrective heuristics accurately
transform faulty model outputs?
We evaluated the efficacy of each corrective heuristics, based on
ground truth labels. Specifically, we compared model accuracy
beforeandafterapplyingthecorrectiveheuristicstothebaseline
neuraldecoderpredictions.Notethattheperformanceforthecursor
controlandfieldnavigationapplicationsismeasuredusingmean
squarederror,forwhichlowerisbetter.Thebaselineisthefaulty
neural decoding model that was initially trained for regular BCIusage. Figure 3 gives the results and shows that 4 out of 5 BCI
applicationsdemonstratedasignificantimprovementinaccuracy
after applying the corrective heuristics. The accuracy of the motor
decoding model decreased, but the difference was not significant.
6.3 RQ3: Can BCI faults be localized to input
and output slices?
In order to test whether faults can be localized to input and output
slices, we compared the distributions of input and output slices,
1876Repairing Brain-Computer Interfaces with Fault-Based Data Acquisition ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA
TI IT
Motor
Decoding00.20.40.60.811.2Baseline Corrected
*
TI
Obs/Exec
Classif.00.20.40.60.811.2
**
TI IT MM
Sleep Stage
Classif.00.20.40.60.811.2
*
*
TI RM
Cursor
Control05101520
**
TI RMOB
Field
Navigation00.511.52
Figure 3: Efficacy of Corrective Heuristics. An asterisk (*)
indicates a significant difference (paired two-sample t-test, p-
value<0.05). Note that for mean squared error, lower is better.
TI IT N
Motor Decoding00.20.40.60.811.21.41.6Left fist
Rest
Right fist
TI N
Obs/Exec Classif.00.20.40.60.811.21.41.6Action obs.
Motor exec.
TI IT MM N
Sleep Stage Classif.00.20.40.60.811.21.41.6Stage 1
Stage 2
Stage 3/4
REM
Wake
TI RM N
Cursor Control00.20.40.60.811.21.41.6Downward
Leftward
Rightward
Upward
Quadrant 1
Quadrant 2
Quadrant 3
Quadrant 4
TI OB RM N
Field Navigation00.20.40.60.811.21.41.6Downward
Leftward
Rightward
Upward
(a) Output Slices.
TI RM N
Cursor Control00.20.40.60.811.21.41.6Hyperactivity
Hypoactivity
TI RM OB N
Field Navigation00.20.40.60.811.21.41.6Hyperactivity
Hypoactivity
(b) Input Slices.
Figure 4: Localizing faults to specific output slices (top) and
input slices (bottom). Different faults (on the x-axis, with N re-
ferringtonofault)exhibitdifferentdistributionsofco-occurring
slices.Alldistributionsarenormalizedto1,butslicesmayco-occur.
conditionedonwhetheraparticulartypeoffaultoccurred.Weused
a Chi-squared test of independence on the relationship between
thepresenceofagiventypeoffaultandthedistributionofinput
and output slices, respectively.
Figure 4showsthat mosttypesof faultsexhibit distinctdistri-
butions of input and/or output slices for—both compared to the
distributions of other faults and no fault in a given application. For
example, temporalinconsistency faultsin the motordecoding ap-
plicationcoincidewithinstancesoftherestingtask,whereasillegal
transition faults almost never occur during resting (Chi-squared
testofindependence,p<0.05).Inthiscase,theillegaltransitionfaultcanbelocalizedtoataskdistributionprimarilycomprisedofthe
non-resting tasks.The sameobservation holdsfor theobserve-or-
execute classification, with only one type of fault. The distribution
oftasksbeingsimultaneouslyperformedduringfaultoccurrenceis
significantlydifferentthantheno-faultdistribution(Chi-squared
test of independence, p<0.05): when temporal inconsistency faults
occur,aBCIuserismorelikelytobeobservinganaction.Inthis
case,temporalinconsistencyfaultscanbelocalizedtoadistribution
skewed towards the observation task.
Overall, our results show that for most types of faults in the
five BCI applications, there is a statistically significant association
between fault occurrence and slice distribution.
6.4 RQ4: Can fault-based data acquisition and
model retraining repair BCI faults?
To evaluate our proposed methodology for fault-based data acqui-
sitionandrepair,wetrainedtheunderlyingneuraldecoderondata
acquired based on the computed fault-based task distributions, for
all five BCI applications. We measured repair success for each type
offaultinisolationaswellasforalltypesoffaultscombined.Specif-
ically, we computed the change in the number of fault occurrences
after training. Although individual types of faults can co-occur,
eachfaultrepresentsauniqueissue.Therefore,whenmeasuringrepair success for all types of faults combined, we sum the fault
occurrencesofeachindividualtypeoffault(asopposedtocounting
unique faulty model outputs).
Table 5 gives the overall results and shows that retraining the
underlyingneuraldecodingmodelafterfault-baseddataacquisition
canreducethenumberoffaults.Forexample,fortheobserve-or-
executeclassificationapplication,trainingondataacquiredthrough
a task distribution yields a statistically significant improvement
overthebaselineandovertrainingondataacquiredthroughthe
natural task distribution.
For other applications, we did not observe such a statistical
significant reduction, and we conjecture three reasons. First, the
acquisitiondatasetislimited,beingonlyone-tenthoftheoriginal
dataset. Since we acquired data by selecting a fixed number of
datapointsfromthisalreadylimitedacquisitiondataset,thereislessroomforthetaskdistributiontoshowasignificanteffect,comparedtothenaturaldistribution.Second,sinceweusepreviouslycollecteddatasets,wecannotacquirenewdatabasedonthetaskdistribution,
butinsteadsimulatedataacquisitionbysamplingfromaportion
oftheexistingdatasetthatthemodelhasneverseen.Fault-based
data acquisition in a real calibration session may be more targeted.
Third, thecorrective heuristicsthat wedefined forthis evaluation
may not be accurate enough to produce accurate task distributions.
We wishto explorethese further infuture work, andcarrying out
a user study may provide additional insights.
Fault-based data acquisition can achieve a reduction in faults.
However,asecondaryconcernisthatretrainingmustsimultane-
ouslyensurethataccuracy(orrelatedmeasureofperformancesuchasmean-squarederror)doesnotsignificantlydegrade.Weevaluatethisbycomputingthechangeinaccuracyafterretrainingondataac-quiredthroughfaultlocalization.Wefoundthattherewasasignifi-cantincreaseinaccuracyforthemotordecodingapplication,andno
significant change for the other applications, suggesting that fault-
baseddata acquisition can repair BCIs without degrading accuracy.
1877ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA Winston et al.
Table5:RepairingBCIswithFault-BasedDataAcquisition. Foreachapplication,weseektoeliminateeitherasinglefaultorallfaults
combined. We compare the number of faults (averaged over 10 trials) before retraining (Baseline), after retraining with data acquired based
onthenaturaldistributionoftasks(AfterBernoulli),andafterretrainingwithdataacquiredbasedonafault-baseddistributionoftasks
(After Fault Localization w/ Corrections). We also compare to simply applying corrective heuristics (After Corrections) and fault-based
data acquisition without applying corrective heuristics first (After Fault Localization w/o Corrections). Comparison to baseline:***𝑝<0.01,
**𝑝<0.05,*𝑝<0.1. Comparison to Bernoulli-sampled task distribution:+++𝑝<0.01,++𝑝<0.05,+𝑝<0.1
BCI Application Fault BaselineAfter
BernoulliAfter FaultLocalizationw/ CorrectionsAfterCorrectionsAfter FaultLocalizationw/o Corrections
EEG Motor Decoding Temporal Inconsistency 230.75 241.96 244.79∗∗- 240.17∗∗
Illegal Transition 78.29 76.38 73.96 - 207.79∗∗∗+++
All faults combined 309.04 318.33 308.13 266.25∗∗∗+++305.88
Observation-or-Execution Temporal Inconsistency 62.56 61.44 46.22∗∗∗++- 53.78
Classification All faults combined 62.56 61.44 46.22∗∗∗++71.67∗53.78
Sleep StageClassificationTemporal Inconsistency 153.00 147.04 151.67
+++- 153.83+
Illegal Transition 31.92 27.50 44.50∗∗∗+++- 24.38∗∗++
Multimodal Inconsistency 23.79 19.79 25.83++- 51.75∗∗∗+++
All faults combined 208.71 194.33 199.88∗221.17∗∗+++199.25∗∗
BCI Cursor Control Temporal Inconsistency 100.00 63.00 62.00∗- 62.00
Rapid Motion 349.83 296.50 292.50 - 293.17
All faults combined 449.83 359.50 355.67∗525.50+++358.50∗
Field Navigation Temporal Inconsistency 1220.20 1200.40 1178.40∗∗- 1161.40∗∗++
Rapid Motion 2002.00 2048.20 2040.60 - 2001.40
Out of Bounds 93.60 77.40 69.80 - 84.80+
All faults combined 3315.80 3326.00 3274.60 3305.20 3282.60
6.5 RQ5: Are corrective heuristics or fault
localization sufficient on their own?
Section6.2established theeffectivenessoffault localizationbased
onheuristicallycorrectedmodeloutputs,usedtocomputeatask
distributionfordataacquisitionandmodelretraining.Thismethod
requires both (1) corrective heuristics to correct faulty predictions
and (2) fault localization to inform data acquisition. Here, we ex-
plore whether either of these components suffices. In other words,
wetestwhethereithertrainingonheuristicallycorrectedpredic-
tions without a fault-based distribution or localizing faults to tasks
without correcting faulty predictions would confer performance
improvements. The two right-most columns in Table 5 show the
results for these two alternative approaches.
First, we discuss the results of directly retraining the neural
decoder on heuristically corrected faults, without assuming a fault-
based task distribution. As shown in Table 5, we observe that train-ing on heuristically corrected faults decreased the number of faults
forthemotordecodingapplication.However,wealsoobserveda
significantincreaseinthenumberoffaultsfor3outof5applica-
tions.Weattributethistotworeasons.First,theamountofthedata
the decoder model is trained on is dependent on the number of
detectedfaults.Intheapplicationsthatwetested,faultfrequency
is overall low, and training on this small number of specific data
points likely causes the model to overfit. Second, since corrections
are based on heuristics, training on them could bias the model,especially if there are few corrected datapoints to retrain on. We
concludethatwhilecorrectiveheuristicsareausefultoolforcor-
rectingindividualpredictions,trainingonthecorrecteddatapoints
is insufficient for repairing the underlying decoder.Next,wediscusstheeffectivenessoffault-baseddataacquisition
withouttheuseofcorrectiveheuristics.InSection6.4,corrective
heuristicswereusedasameansforweaklycorrectingmodelpre-
dictions in order to accurately determine the task being performed.
However,correctingmodelpredictionswithimpreciseheuristics
maynotresultinamoreaccuratetaskdistribution.Totestwhether
effective fault-localization could be achieved without corrective
heuristics,wecomputedthenumberoffaultswhenretrainingon
fault-basedacquireddatabutwithoutapplyingcorrectiveheuris-
tics to model predictions first. We found that removing corrective
heuristics significantly decreased the number of faults only for
illegal-transition faults in the sleep stage classification application.
For all other faults and applications, the results of this approach
arecomparabletoorsignificantlyworsethantheresultsoffault-
baseddataacquisitionwithcorrectiveheuristicsapplied.Wecon-
clude that corrective heuristics are an important component in the
methodology to compute an accurate fault-based task distribution.
7 THREATS TO VALIDITY
ExternalValidity WeselectedfiveBCIapplicationsforevaluating
theapplicabilityofourproposedmethodologyforrepairingBCIs
post-deployment.Thecomprehensivenessandrepresentativeness
ofthisselectionaffectsexternalvalidity,butweaimedforadiverse
set of applications by considering the different dimensions for clas-
sifying BCIs (Section 3). Additionally, our methodology assumesthat neural decoder model predictions can be mapped to a suffi-
cientlylargenumberoftasksforfine-grainedfaultlocalization.We
argue that this assumption is satisfied in practice: BCIs such asneuroprostheses indeed perform a variety of tasks. For example,
handposturecanbeclassifiedintomorethan40types,andsince
1878Repairing Brain-Computer Interfaces with Fault-Based Data Acquisition ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA
BCIs are an emerging technology, advances will likely results in an
even greater number of supported postures.
Construct Validity Our evaluation used existing, labeled datasets
to simulate real-world BCI usage. These datasets were collected
in a rigid and non-naturalistic experiment settings. For example,in the EEG motor decoding application, participants opened and
closed their fists on cue, but during real-world usage these actions
wouldbenaturalistic.Asaresult,ourefficacymeasuresofpartial
oracles,correctiveheuristics,andslicefunctionscouldbespecific
tothenon-naturalisticsetting.Arelatedconcernisthatourmea-
sures for fault occurrence and frequency may be specific to the
experimental setting and are not accurate measures for faults that
will occur during real-world usage. Likewise, faults that doappear
in an experimental setting may not occur during real-world usage.
However,manyofthesefaultssuchastemporalinconsistencydo
occurinotherML-basedcontrolsystems[ 17].Thus,whilemostBCI
researchhasreportedonoverallmodelperformance(asopposed
to reporting on fault occurrences), it is reasonable to expect that
these faults do occur in BCIs as well.
InternalValidity Athreattointernalvalidityismodeloverfitting,
which could prevent our evaluation from properly isolating the ef-
fectofretrainingbasedonagiventaskdistribution.Recallthatour
evaluationusedexistingdatasetsandretrainedmodelsonsmall,
fixedsetsofnewlyacquireddata.Thereisariskofoverfittingtotheinitialtrainingdataand/ortothenewlyacquireddata,whichcould
worsen model performance. This, however, would likely underesti-
matetheefficacyoffault-baseddataacquisitionbecausereal-world
data acquisition would not be subject to the same restrictions.
8 RELATED WORK
There are three avenues of closely related work: (1) methods for
improving the performance of BCIs, (2) applications of software
testingresearchtomachinelearningsystems,and(3)miscellaneous
work combining BCIs and software engineering.
OptimizingBCIPerformance Priorworkhassoughttoimprove
thedatacollectionmethodologyforBCIsthroughemergingtech-
nologies or novel sampling techniques. For example, virtual reality
has been applied to more realistically simulate the surroundingenvironment of a BCI user [
4]. Active class selection (ACS) has
also been previously explored as a means for more efficient dataacquisition for BCIs. A combination of entropy and the inverse
ofclassaccuracyhasbeen appliedtomotorimageryforchoosing
classes that are informative and in need of improved accuracy [ 14].
Data acquisition through ACS has been combined with transfer
learning in an application to a BCI [ 36]. By contrast, instead of the
general goal of increasing accuracy of neural decoding predictions,
ourstatedgoalistorepairspecificfaultsasreportedbyusers.Addi-tionallyinsteadofapplyingasophisticatedsamplingalgorithm,we
optforamoresoftware-testing-orientedandhuman-in-the-loop
approach with partial test oracles defined by domain experts.
Software Testing and ML Systems The problems encountered
whentestingBCIsaresimilartothoseencounteredwhentesting
other data-driven ML systems. For example, prior work has shown
that neural network accuracy can be improved through fault local-ization by localizing errors to specific neurons in the network [
10]
andthatfairnessandaccuracycanbeimprovedbylocalizingerrorstoinfluentialdatapoints[ 18,32].Machinelearninghasalsobeen
appliedtoimprovedebuggingtechniquesfortraditionalsoftware
systems (e.g., [2, 19, 23]).
Software Engineering and BCIs Other work has sought to ap-
ply software engineering to BCIs. Application areas have included
writing,comprehension,anddebuggingofcode[ 4,9,26].Theappli-
cation of software engineering research to BCIs has been proposed
with a particular emphasis on self-adaptive systems reacting to
inputs where those inputs are now neural signals [15].
9 CONCLUSION
This paper explores the application of software testing and debug-
ging methods to the emerging field of brain-computer interfaces
(BCIs). Specifically, it proposes a human-in-the-loop methodology
for testing and repairing BCIs post-deployment. The evaluationbased on five BCI applications shows that (1) partial test oracles
can indeed detect faultsin BCIs, (2) corrective heuristics and slice
functions can localize faults to specific data slices in both the input
andoutputspaces,and(3)fault-baseddataacquisitioncanreduce
the fault frequency while maintaining model accuracy. Overall, the
results suggest that the proposed methodology is a promising step
towards more accurate and safer BCIs.
REFERENCES
[1]Brendan Z Allison, Elizabeth Winter Wolpaw, and Jonathan R Wolpaw. 2007.
Brain–computer interface systems: progress and prospects. Expert review of
medical devices 4, 4 (2007), 463–474.
[2]LucianoCAscari,LuciliaYAraki,AuroraRTPozo,andSilviaRVergilio.2009.
Exploring machine learning techniques for fault localization. In 2009 10th Latin
American Test Workshop. IEEE, 1–6.
[3]EarlT.Barr,MarkHarman,PhilMcMinn,MuzammilShahbaz,andShinYoo.2015.
The oracle problem in software testing: A survey. IEEE Transactions on Software
Engineering 41, 5 (2015), 507–525. https://doi.org/10.1109/tse.2014.2372785
[4]Tarik Boukhalfi, Christian Joyal, Stéphane Bouchard, Sarah Michelle Neveu, and
Patrice Renaud. 2015. Tools and techniques for real-time data acquisition andanalysis in brain computer interface studies using qEEG and eye tracking in
virtual reality environment. IFAC-PapersOnLine 48, 3 (2015), 46–51.
[5]R. Chaisaen, P. Autthasan, N. Mingchinda, P. Leelaarporn, N. Kunaseth, S. Tam-
majarung,P.Manoonpong,S.C.Mukhopadhyay,andT.Wilaiprasitporn.2020.
Decoding EEG Rhythms During Action Observation, Motor Imagery, and Execu-
tion for Standing and Sitting. IEEE Sensors Journal 20, 22 (2020), 13776–13786.
https://doi.org/10.1109/JSEN.2020.3005968
[6]Rattanaphon Chaisaen, Phairot Autthasan, Nopparada Mingchinda, Pitshaporn
Leelaarporn, Narin Kunaseth, Suppakorn Tammajarung, Poramate Manoon-pong, Subhas Chandra Mukhopadhyay, and Theerawit Wilaiprasitporn. 2020.Decoding eeg rhythms during action observation, motor imagery, and execu-tion for standing and sitting. IEEE Sensors Journal 20, 22 (2020), 13776–13786.
https://doi.org/10.1109/jsen.2020.3005968
[7]Stanislas Chambon, Mathieu N. Galtier, Pierrick J. Arnal, Gilles Wainrib, and
Alexandre Gramfort. 2018. A Deep Learning Architecture for Temporal Sleep
Stage Classification Using Multivariate and Multimodal Time Series. IEEE Trans-
actionsonNeuralSystemsandRehabilitationEngineering 26,4(2018),758–769.
https://doi.org/10.1109/TNSRE.2018.2813138
[8]Inchul Choi, Ilsun Rhiu, Yushin Lee, Myung Hwan Yun, and Chang S. Nam.
2017. A systematic reviewof hybrid brain-computer interfaces:Taxonomy and
usabilityperspectives. PLOSONE 12,4(2017). https://doi.org/10.1371/journal.
pone.0176674
[9]JoãoDuraes,HenriqueMadeira,JoãoCastelhano,CatarinaDuarte,andMCasteloBranco.2016. WAP:understandingthebrainatsoftwaredebugging.In 2016IEEE
27thInternationalSymposiumonSoftwareReliabilityEngineering(ISSRE).IEEE,
87–92.
[10]Hasan Ferit Eniser, Simos Gerasimou, and Alper Sen. 2019. Deepfault: Fault
localization for deep neural networks. arXiv preprint arXiv:1902.05974 (2019).
[11]Joshua I Glaser, Ari S Benjamin, Raeed H Chowdhury, Matthew G Perich, Lee E
Miller,andKonradPKording.2020.Machinelearningforneuraldecoding. Eneuro
7, 4 (2020).
[12]Ary L. Goldberger, Luis A. Amaral, Leon Glass, Jeffrey M. Hausdorff, Plamen Ch.
Ivanov,RogerG.Mark,JosephE.Mietus,GeorgeB.Moody,Chung-KangPeng,
1879ICSE 2022, May 21–29, 2022, Pittsburgh, PA, USA Winston et al.
H.EugeneStanley,andetal.2000.PhysioBank,PHYSIOTOOLKIT,andPhysioNet.
Circulation 101, 23 (2000). https://doi.org/10.1161/01.cir.101.23.e215
[13]Alexandre Gramfort, Martin Luessi, Eric Larson, Denis A. Engemann, Daniel
Strohmeier, Christian Brodbeck, Roman Goj, Mainak Jas, Teon Brooks, Lauri
Parkkonen,andMattiS.Hämäläinen.2013. MEGandEEGDataAnalysiswith
MNE-Python. Frontiers in Neuroscience 7, 267 (2013), 1–13. https://doi.org/10.
3389/fnins.2013.00267
[14]IbrahimHossain,AbbasKhosravi,andSaeidNahavandi.2017. Weightedinfor-
mativeinverseactiveclassselectionformotorimagerybraincomputerinterface.
In2017IEEE30thCanadianConferenceonElectricalandComputerEngineering
(CCECE). IEEE, 1–5.
[15]ShihongHuangandEmmanuelleTognoli.2014. Brainware:Synergizingsoftware
systems and neural inputs. In Companion Proceedings of the 36th International
Conference on Software Engineering. 444–447.
[16]René Just and Franz Schweiggert. 2011. Automating unit and integration testing
with partial oracles. Software Quality Journal 19, 4 (2011), 753–769.
[17]Daniel Kang, Deepti Raghavan, Peter Bailis, and Matei Zaharia. 2018. Model
assertions for debugging machine learning. In NeurIPS MLSys Workshop.
[18]PangWeiKohandPercyLiang.2017. Understandingblack-boxpredictionsvia
influence functions. In International Conference on Machine Learning (ICML).
1885–1894.
[19]Xia Li, Wei Li, Yuqun Zhang, and Lingming Zhang. 2019. Deepfl: Integrating
multiple fault diagnosis dimensions for deep fault localization. In Proceedings of
the28thACMSIGSOFTInternationalSymposiumonSoftwareTestingandAnalysis .
169–180.
[20]S.G. Mason and G.E. Birch. 2003. A general framework for brain-computer inter-
face design. IEEE Transactions on Neural Systems and Rehabilitation Engineering
11, 1, 70–85. https://doi.org/10.1109/TNSRE.2003.810426
[21]Felip Miralles,Eloisa Vargiu, StefanDauwalder, Marc Solà,Gernot Müller-Putz,
Selina C Wriessnegger, Andreas Pinegger, Andrea Kübler, Sebastian Halder, Ivo
Käthner,etal .2015. Braincomputerinterfaceontracktohome. TheScientific
World Journal 2015 (2015).
[22]JelenaMladenovic,JérémieMattout,andFabienLotte.2017. Agenericframework
for adaptive EEG-based BCI training and operation. CoRRabs/1707.07935 (2017).
arXiv:1707.07935 http://arxiv.org/abs/1707.07935
[23]AniruddhNathandPedroDomingos.2016. Learningtractableprobabilisticmod-
els for fault localization. In Thirtieth AAAI Conference on Artificial Intelligence.
[24]Patrick Ofner and Gernot R. Müller-Putz. 2012. Decoding of velocities and
positionsof3DarmmovementfromEEG.In 2012AnnualInternationalConferenceof theIEEE Engineeringin Medicineand BiologySociety. 6406–6409. https://doi.
org/10.1109/EMBC.2012.6347460
[25]Spencer Pearson, José Campos, René Just, Gordon Fraser, Rui Abreu, Michael D
Ernst, Deric Pang, and Benjamin Keller. 2017. Evaluating and improving fault
localization.In InternationalConferenceonSoftwareEngineering(ICSE).609–620.
[26]Norman Peitek, Janet Siegmund, Sven Apel, Christian Kästner, Chris Parnin,
AnjaBethmann,ThomasLeich,GunterSaake,andAndréBrechmann.2018. A
lookintoprogrammers’heads. IEEETransactionsonSoftwareEngineering 46,4
(2018), 442–462.
[27]RajeshP.N.Rao.2013. Brain-computerinterfacing:Anintroduction. Cambridge
University Press, New York.
[28]Alexander Ratner, Stephen H Bach, Henry Ehrenberg, Jason Fries, Sen Wu, and
ChristopherRé.2020.Snorkel:Rapidtrainingdatacreationwithweaksupervision.
The VLDB Journal 29, 2 (2020), 709–730.
[29]G. Schalk, D.J. McFarland, T. Hinterberger, N. Birbaumer, and J.R. Wolpaw. 2004.
Bci2000: A general-purpose brain-computer interface (bci) system. IEEE Transac-
tions on Biomedical Engineering 51, 6 (2004), 1034–1043. https://doi.org/10.1109/
tbme.2004.827072
[30]Sergio Segura, Gordon Fraser, Ana B Sanchez, and Antonio Ruiz-Cortés. 2016. A
survey onmetamorphic testing. IEEE Transactionson softwareengineering 42, 9
(2016), 805–824.
[31]Steffen Steinert, Christoph Bublitz, Ralf Jox, and Orsolya Friedrich. 2019. Do-ingthingswiththoughts:Brain-computerinterfacesanddisembodiedagency.
Philosophy & Technology 32, 3 (2019), 457–482.
[32]SahilVerma,MichaelErnst,andReneJust.2021. Removingbiased datatoimprove
fairness and accuracy. arXiv preprint arXiv:2102.03054 (2021).
[33]Mark Weiser. 1984. Program slicing. IEEE Transactions on software engineering 4
(1984), 352–357.
[34]ElaineJWeyuker.1982. Ontestingnon-testableprograms. Comput.J. 25,4(1982),
465–470.
[35]W Eric Wong, Ruizhi Gao, Yihao Li, Rui Abreu, and Franz Wotawa. 2016. A
survey on software fault localization. IEEE Transactions on Software Engineering
42, 8 (2016), 707–740.
[36]Dongrui Wu, Brent J Lance, and Thomas D Parsons. 2013. Collaborative filtering
for brain-computer interaction using transfer learning and active class selection.
PloS one8, 2 (2013), e56624.
[37]XiangZhang,LinaYao,XianzhiWang,JessicaJMMonaghan,DavidMcalpine,
andYuZhang.2020. Asurveyondeeplearning-basednon-invasivebrainsignals:
recent advances and new frontiers. Journal of Neural Engineering (2020).
1880