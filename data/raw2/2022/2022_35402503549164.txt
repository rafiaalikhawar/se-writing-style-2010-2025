RoboFuzz : Fuzzing Robotic SystemsoverRobotOperating
System (ROS) for Finding Correctness Bugs
SeulbaeKim
Georgia InstituteofTechnology
Atlanta,Georgia, USA
seulbae@gatech.eduTaesooKim
Georgia InstituteofTechnology
Atlanta, Georgia, USA
taesoo@gatech.edu
ABSTRACT
Robotic systems are becoming an integral part of human lives.
Responding to the increased demands for robot productions, Ro-
bot Operating System (ROS), an open-sourcemiddleware suite for
roboticdevelopment,isgainingtractionbyprovidingpracticaltools
and libraries for quickly developing robots. In this paper, we are
concerned with a relatively less-tested class of bugs in ROS and
ROS-basedroboticsystems,calledsemanticcorrectnessbugs,in-
cluding the violation of specification, violation of physical laws,
and cyber-physical discrepancy. These bugs often stem from the
cyber-physical nature of robotic systems, in which noisy hardware
components are intertwined withsoftware components, and thus
cannotbedetectedbyexistingfuzzingapproachesthatmostlyfocus
on findingmemory-safetybugs.
We propose RoboFuzz , a feedback-driven fuzzing framework
that integrates with ROS and enables testing of the correctness
bugs.RoboFuzz features (1) data type-aware mutation for effec-
tively stressingdata-driven ROSsystems, (2)hybrid execution for
acquiring robotic states from both real-world and a simulator, cap-
turingunforeseencyber-physical discrepancies, (3)anoraclehan-
dler that identifies correctness bugs by checking the execution
states against predefined correctness oracles, and (4) a semantic
feedbackengineforprovidingaugmentedguidancetotheinputmu-
tator, complementing classic code coverage-based feedback, which
is less effective for distributed, data-driven robots. By encoding
thecorrectnessinvariantsofROSandfourROS-compatiblerobotic
systems into specialized oracles, RoboFuzz detected 30 previously
unknownbugs,ofwhich25areacknowledgedandsixhavebeen
fixed.
CCSCONCEPTS
â€¢Computersystemsorganization â†’Robotics ;â€¢Softwareand
its engineeringâ†’Software testing anddebugging .
KEYWORDS
Robot Operating System 2 (ROS 2); Correctness bugs; Semantic
feedback-driven fuzzing
ESEC/FSE â€™22, November 14Å›18,2022, Singapore, Singapore
Â©2022 Copyright heldby theowner/author(s).
ACM ISBN 978-1-4503-9413-0/22/11.
https://doi.org/10.1145/3540250.3549164ACM Reference Format:
Seulbae Kim and Taesoo Kim. 2022. RoboFuzz : Fuzzing Robotic Systems
overRobotOperatingSystem(ROS)forFindingCorrectnessBugs.In Pro-
ceedingsofthe30thACMJointEuropeanSoftwareEngineeringConference
andSymposiumontheFoundationsofSoftwareEngineering(ESEC/FSEâ€™22),
November 14Å›18, 2022, Singapore, Singapore. ACM, New York, NY, USA,
12pages.https://doi.org/10.1145/3540250.3549164
1 INTRODUCTION
Humanlivesandrobotsareinextricablylinked.Traditionally,robots
havebeenusedextensivelyinagricultureandmanufacturingfor
taskautomation.Recentdevelopmentshavebroughtrobotseven
closerto everyoneâ€™sdailylives.For example,Amazon andGoogle
are deploying humanless delivery systems using unmanned aerial
vehicles[ 5,17],themarketsizeofrobotvacuumcleanershasgrown
23% annually [ 18],and the use of robots in surgical procedures in-
creased from 2% in 2012 to 15% in 2018 [ 48], showing how rapidly
therobotindustryisgrowingtoaccommodatehumanneeds.Simul-
taneously,modernrobots,suchasautonomousdrivingvehicles,are
becomingmoresophisticated,demandinganintegrationofcomplex
subsystems, e.g.,sensing,perception,planning, andactuation.
Responding to such higher demands for developing intricate
robotic systems, Robot Operating System (ROS) [ 27,33] is gaining
popularity.ROSisanopen-sourcemiddlewaresuiteforrobotde-
velopment that featuresa message-passing scheme for distributed
robotprocesses,hardwareabstraction,abroadcollectionofdevelop-
menttools( e.g.,simulator),androboticlibraries( e.g.,pathplanning
algorithm).UsingROS,developerscanexpeditethedevelopment
processwithouthavingtore-inventthewheel,andinsteadfocus
on the core functionality of their robots. With its philosophy of
multi-language and multi-platform support, ROS is proliferating
as a de facto standard in robotics programming; it has been widely
adopted in industry [ 15,40], the military [ 35,41], research organi-
zations, and by individuals and is estimated to power 55% of the
totalcommercialrobots shippedin 2024 [ 7].
Althoughhavingsuchauniversalmiddlewareisgenerallyad-
vantageous, a downside exists; a flaw in ROS itself or in the way
developers commonly use ROS in their applications can affect a
widerangeofroboticsystemsthatdependonROSandwreakhavoc
on the safety and security of many users. For example, ROS ver-
sion 1 had no notion of authentication, allowing any entity on the
networktofullyaccessanyroboticsystem,eavesdroponinternal
messages, and even hijack the execution if the IP address and port
are known. Indeed, over 100 ROS systems deployed in 28 countries
were discoveredbyscanning thedefaultROSporton theinternet
fortwomonths[ 12],beingcompletelyvulnerabletosuchattacks.
ThelatestversionofROS( i.e.,ROS2)isdesignedandimplemented
in consideration of such problems and has invited greater public
Thiswork islicensedunderaCreativeCommonsAttribution4.0Interna-
tional License.
447
ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore Seulbae Kim andTaesoo Kim
scrutiny of security. Unfortunately, existing work and solutions
focus either on the network security aspects regarding authenti-
cationandauthorizationmethods[ 9,14,28,42],oronregression
testing [43], leaving the ROS communitydeficient in a systematic
testingmethodforfindingunknownbugsthataffecttherobustness
andcorrectness ofrobotic systems.
Giventhissituation,fuzzingmayseemtobeaviablesolution,
as it is well known for its capability of discovering unknown er-
rors in a variety of systems [ 1,2,8,10,45,51]. However, robotic
systems are cyber-physical.Theyhave both physical components
(hardware) interacting with the real world, and cyber components
(software) conducting computations and making decisions. This
unique context introduces a new class of bugs closely related to
semantic correctness ( ÄŸ2.3), namely, violation of physical laws, vio-
lationofspecifications,andcyber-physicaldiscrepancy,whichdo
not exist in traditional software and thus cannot be detected by
existing fuzzingapproaches.
As a remedy, we propose RoboFuzz , the first feedback-driven
fuzzingframeworkforsystematicallytestingalllayersofROS,in-
cluding the internal layers comprising the ROS core, as well as the
roboticapplicationsbuiltusingROSAPIs.Unlikeclassicfuzzingap-
proaches [ 1,51], which target software binaries looking primarily
formemory-safetyerrors,testingROSrequiresanunderstandingof
its distributed architecture, underlying components, inter-process
communicationscheme,androboticproperties.Basedontheknowl-
edgeweaccumlatedbystudyingROSandROS-poweredsystems,
we design a flexible fuzzing framework for ROS that features a
customizableinputmutator,hybridexecutor,oraclehandler,and
feedbackengine. Accordingtothetarget layerinROStotest,one
can select a suitable test strategy by customizing the mutation
mode, statesto watch,properties to check,and semanticfeedback
to utilize. Given this strategy, RoboFuzz effectively explores the
state space of the system under test (SUT) by mutating and pub-
lishing messages to two copiesof SUT, one operating in the cyber
world(i.e.,asimulator)andtheotherrunningphysicallyinthereal
world. States of the SUTs from both worlds are then collected to
finderrorsandgeneratesemanticfeedbacktoassistfurtherinput
generation.
Todemonstratetheeffectivenessof RoboFuzz ,wetestedtheROS
core,aswellasfourROS-basedroboticapplications,namely,PX4
quadcopter, TurtleBot3, Move It 2, and Turtlesim, by applying cus-
tomizedcorrectnessoracles. Byfuzzingthesesystems, RoboFuzz
revealed30bugs,ofwhich25areacknowledgedandsixarefixed.
Among the bugs, 13 bugs are high-impact bugs that exist in the
internal layers of ROS, i.e., the type system and the client API
implementation,affecting anumber ofROS-basedsystems.
In summary,this paper makesthe following contributions:
â€¢Weintroduceandstudythreetypesofsemanticcorrectnessbugs
that are specific to cyber-physical systems.
â€¢Weproposeandimplement RoboFuzz ,afuzzingframeworkthat
seamlesslysupportstestingroboticsystems overROStodetect
correctnessbugs.Theprototypeof RoboFuzz isopen-sourcedat
https://github.com/sslab-gatech/robofuzz .
â€¢By designing robot-specific correctness oracles and semantic
feedback metrics, we test the latest ROS distribution and four
robotic systems,anddetect30 newcorrectness bugs.2 BACKGROUND
2.1 Challenges ofTestingaRoboticSystem
A typical robotic system can be characterized by the physical
(hardware) component, e.g., a GPS sensor or a motor, the cyber
(software) component, e.g., an implementation of a control algo-
rithm,andthe environment ,e.g.,aterrain,thatarobotinteracts
with.Thisuniqueconfigurationposesthreechallengesintesting
robotic systems.
Challenge 1: Heterogeneity. The diversity of robotic systems is
enormous;surgicalrobotsrequireextraprecision,factoryrobots
are built to last, and aerial robots fly. Moreover, robots sharing
the same software may behave differently if they have different
hardware( e.g.,sensorsfromdifferentmanufacturers),andthesame
robots maybehave differently underdifferentenvironments. Such
heterogeneitymakestestingroboticsystemschallengingbecause
one testing methodology may not work directly with other robots.
As a workaround, we focus on an integral property of a robot that
it essentially is a group of distributed processes that exchange data
for operation. In other words, a robotic behavior can be represented
bythedata flow (whetheritisanalog ordigital) betweenthenodes.
Considering this property, we design our framework to be capable
ofcapturingandcontrolling the data flowfor testing.
Challenge2:HugeStateSpace. Roboticsystemsoperateinmany
different environments and conditions, with countless variables
that exist in the real world. As a result, the state space tends to be
bigger than that of traditional software programs. To effectively
test such a profound system, we adopt feedback-driven fuzzing,
which is proven to be effective in exploring large state spaces,
leading to the successful detection of software bugs [ 1,2,8,23,51].
Particularly, we propose the use of semantic feedback , which is
unique to robotic systems, to further accelerate the state space
explorationbycomplementing the coverage-basedfeedback.
Challenge 3: Noisy Hardware. Unlike conventional software
that has neatly defined interfaces to exchange accurate data, the
hardwarecomponents( e.g.,sensorsandactuators)ofarobotare
inherently noisy, as they interact with the real world. For example,
theGPSsensorconstantlyreportsslightlychanginglatitudeand
longitude valueseven when a robot is not moving at all.Similarly,
itisalmostimpossibletomovearobottotheexactsamelocation
withaprecision ofmillimeters, as the actuators are noisy.
Toincorporatesuchnoiseintotesting,wedesignahybridexecu-
tor,whichrunstestssimultaneouslyinasimulatorand inthereal
world,sothatthestatescapturedfrombothworlds,( e.g.,thedis-
crepancy between the values reported by the noisy physical sensor
andnoiseless simulatedsensor) can be utilizedto assist testing.
2.2 Robot OperatingSystem(ROS)
Robot Operating System (ROS1) [33] is an open-source framework
designedtohelpdevelopersbuildmodular,distributedroboticappli-
cations. With convenient all-in-one tools and libraries that support
multipleoperatingsystemsandprogramminglanguages,combined
with a vibrant user community,ROS established a solidecosystem
and attracted many users worldwide [ 3,4] to become a de facto
standardinrobotics.
1Unlessotherwisenoted,Å‚ROSÅ¾refersto ROS2 herein, whichis the latestversion.
448RoboFuzz : Fuzzing RoboticSystems overRobot Operating System (ROS)forFinding Correctness Bugs ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore
Figure 1:Systemarchitecture ofROS 2.
uint32 height # image height
uint32 width # image width
string encoding # encoding of pixels
uint8[] data # actual matrix data of pixels
Figure 2:Anexample messagedefinition forimagedata.
Asshownin Figure1,ROSseparatestheapplicationlayer( 1)
from the internal layers ( 2-6), so users can focus solely on de-
signing the logical composition of the robotic application, while
the internal ROSlayers manage the data distribution.Specifically,
ROS-powered applications are mainly built around three logical
concepts: node,topic,andmessage.
â€¢Node:Anodeisaminimalself-containedprocesswithadesig-
nated function, such as performing computations. Nodes are the
foundationsofmodularroboticsystemsthatassistfaultisolation
andhigh reusability.
â€¢Topic:Atopicisamessagebusconnectingpublishers(datawriter
nodes)tosubscribers(datareadernodes).Eachtopicmayhave
multiplepublishersandmultiplesubscribers, enabling multiple
nodes to concurrently exchange data anonymously.
â€¢Message: A message is a typed key-value data structure that
serves as a unit of data transportation. ROS defines 15 built-in
types:bool,byte,char,float{32,64},int{8,16,32,64},uint{8,16,32,64},
string and wstring, and array types of the above-mentioned
built-in types. As shown in Figure 2, a message may contain
multiple fields of different types. ROS topics are strictly typed,
meaningthatatopiconlyacceptsmessagesofonetypethatis
pre-registeredwhen initializingthe topic.
Application Layer ( 1).ROS allows developers to build a ROS-
based application by utilizing ROS Client Library APIs ( 2) to com-
pose a logical network of nodes connected by topics in desired
programminglanguages(officially,C++andPython).Anillustra-
tiveexampleofaROSapplicationisshownin Figure3.Oncethe
developerspecifiesnodesandconnectsthembybindingpublishers
and subscribers to topics, ROS orchestrates the data distribution
through the publish-subscribe pattern, so that if one node pub-
lishes a message to a topic, the topic broadcasts the message to
allthe nodes subscribing tothat topic. Meanwhile,the underlying
implementation backing the application by handling the process
managementanddatadistributioniscompletelyabstractedaway
from the user-space,as shownin Figure 1.
Figure 3: An example use of the publish-subscribe pattern in
a ROS application. Nodes (gray rounded rectangles) publish
datatoothernodesthroughtopics(whiterectangles).Anode
may subscribe to multiple topics ( e.g.,obj_detector gets data
fromfront_image andlaser_dist ), and multiple nodes can
subscribetoatopic( e.g.,bothpath_planner andhazard_logger
receive data published to objects).
ROS ClientLibrary APIImplementation ( 2).RCLAPIimple-
mentations are the only user-facing APIs that expose ROS func-
tionality to users in specific languages ( e.g.,rclcppandrclpy).
Developers can be agnostic of theinner workings of ROS and sim-
plyutilizetheRCLAPIstocomposeaROSnetworkconsistingof
nodes andtopics, whichessentiallyisamodularrobotic system.
ROSClientLibrary(RCL)( 3).RCLisacommonunifiedlayer
thatbridgestheuser-spaceAPIsimplementedinmultiplelanguages
(2) with lower-level functionalities. Core concepts of ROS ( e.g.,
node, topic) are implemented in this layer so that the behaviors of
the language-specific APIs can remainconstant.
ROS Middleware Interface (RMW) ( 4).RMW is an abstraction
layer built to support diverse standalone DDS implementations. It
wraps the APIs of individual DDS implementations in a uniform
interface,simplifying the interaction withthe RCLlayer.
DataDistributionService(DDS)( 5).ADDS[31]isanetwork
middleware that implements the publish-subscribe pattern com-
munication for real-time systems. Although DDS is not specific to
ROS, it became an essential part of ROS since it includes a num-
berofusefulfunctionalitiesfordeliveringarbitrarydata,suchas
marshalling and de-marshalling, Quality of Service (QoS) policy
implementation,dynamicnodediscovery,andmessagedeliveryon
the transport layer.
Type System Based on Interface Definition Language
(ROSIDL)( 6).ThetypesystemofROSutilizesanInterfaceDefini-
tion Language (IDL) to define messages ( e.g.,Figure 2), to automat-
ically generate corresponding code for the built-in ROS types in
each RCL API language ( i.e., C++ and Python), and to enforce type
checkingatthetimeof valueassignmentanddelivery.Italsomaps
ROS types to the type system used by DDS, making ROS types
universally applicable to allROS layers.
2.3 CorrectnessBugs in RoboticSystems
Havingthecharacteristicsofcyber-physicalsystemsdiscussedin
ÄŸ2.1, robotic systems can suffer from not only traditional software-
orientedbugs( e.g.,memorysafetyerrors),butalsoanewclassof
bugs related to the correctness in the operation. Unlike traditional
bugsthatleadtosoftwarecrashes,correctnessbugsoftendonot
have immediate manifestations but have devastating impacts, such
asquicklywearingthehardwareofthealreadydeployedrobotic
system by pushing the robot beyond its physical capability. In
particular, we focus on three types of correctness bugs that can
criticallyaffectthe safetyandrobustnessof robotic systems.
449ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore Seulbae Kim andTaesoo Kim
ViolationofPhysicalLaws. Roboticsystemshavephysicalparts
operating in the real world and are thereby bound by various laws
of physics and their derivatives that should always hold. For ex-
ample, as defined by kinematic equations, if there is a change of
displacement, the robot must have a non-zero velocity, and if there
is a change of velocity, the acceleration must be non-zero. If the
robotic states (either externally observed or broadcasted by the
robot itself) violate any of the known physical laws, it implies
componentfailure orlogical errorinthe software.
ViolationofSpecification. Specificationsordatasheetsofarobot
contain essentialinformationabout theroboticsystem,including
the physical capabilities of the components ( e.g., sensor fidelity or
jointlimits),aswellasvariousassumptionsaboutroboticbehaviors.
Not complying with the specifications, the robot can be physically
damaged, and othercomponents that rely on the specification can
also be broken, critically affecting the robustness of the system.
Regardlessofwhetherthespecificationisincorrect,ortheimple-
mentationofthespecificationiserroneous,thosecasesshouldbe
detectedandhandled.
Cyber-physical Discrepancy. Simulations are often preferred
overreal-worldenvironmentswhendevelopingandtestingrobotic
systems because of the cost and safety benefits. Here, the practical
meritsofutilizing simulatedrobots arevalid onlyif thesimulated
robotsarecloselymodeledtotheirphysicalcounterparts.Inthis
regard, if the behaviors of two identical robots in the real world
andthesimulationaresufficientlydifferent,weregarditasacyber-
physical discrepancy bug.
2.4 MotivationandScopeofWork
ROS is undergoing constant development; every year, a stable ver-
sion with new features, upgrades, and bug fixesis released. At the
sametime,anincreasingnumberofroboticsystemsarebeingbuilt
ontopofROSdistributions.ROScomesinacomplicatedpackage
thatincludesmultipleabstractionlayersinteractingwitheachother
andvariousDDSimplementationsfromdifferentvendors,which
makes eliminating bugs and ensuring correctness challenging. Un-
fortunately, ROS currently relies on minimal testing approaches
(e.g.,unittesting[ 43]),whicharenotversatileenoughtodetecta
widerangeofunknownissues.Thus,inthispaper,weareprimarily
concernedwithquicklydetectingunknownbugsandcorrectness
issuesfromsuchanevolvingcodebasebybuildingagenericfuzzing
framework targeting the internal abstraction layers of ROS ( 2-6),
as well as the robotic applicationspoweredbyROS ( 1).
3ROBOFUZZ :A GENERICFRAMEWORK
3.1 Overview
RoboFuzz is a customizable feedback-driven fuzzing framework
tailoredforRobotOperatingSysteminternalsandapplications.The
keyintuitionbehindthedesignof RoboFuzz isthataroboticsys-
tem (ROS-basedsystems, in particular) is a stateful, nodedsystem
inwhichnodeschangetheirstatesbasedonthedata theyreceive.
Therefore, the behavior of robotic systems can be summarized as
thedata(message)flowamongthedistributednodes .RoboFuzz ap-
proaches testing from the data flow standpoint, injecting messages
to nodes composing the robotic systemundertest.
Figure4:Overviewof RoboFuzz â€™sarchitectureandworkflow.
Algorithm 1: Fuzzing algorithm of RoboFuzz
Input :ğ‘…ğ‘‚ğµğ‘‚ğ‘‡ - roboticsystem, ğ‘†ğ‘‡ğ‘…ğ´ğ‘‡={ğ‘†,ğ‘ ğ‘â„ğ‘’ğ‘‘,ğ‘‡,ğ‘Š,ğ‘‚}- teststrategy,
ğ‘†- set ofseed messages, ğ‘ ğ‘â„ğ‘’ğ‘‘- mutation schedule, ğ‘‡- set oftargetnodes,
ğ‘Š- set ofstates to watch, ğ‘‚- set ofcorrectnessoracles,
ğ‘ğ‘Ÿ- Maximum#roundsin acycle
Output:ğ‘ğ‘¢ğ‘”- a detailed bug report, ğ‘šğ‘ ğ‘”- messagethattriggered thebug
1procedure ğ‘Ÿğ‘œğ‘ğ‘œğ‘“ğ‘¢ğ‘§ğ‘§ _ğ‘šğ‘ğ‘–ğ‘›()
2ğ‘”ğ‘Ÿğ‘ğ‘â„â†ğ‘–ğ‘›ğ‘ ğ‘ğ‘’ğ‘ğ‘¡ğ‘œğ‘Ÿ.ğ‘–ğ‘›ğ‘ ğ‘ğ‘’ğ‘ğ‘¡ (ğ‘…ğ‘‚ğµğ‘‚ğ‘‡)//ÄŸ3.2
3foreachğ‘ ğ‘’ğ‘’ğ‘‘âˆˆğ‘†do
4 ğ‘“ğ‘¢ğ‘§ğ‘§_ğ‘œğ‘›ğ‘’(ğ‘ ğ‘’ğ‘’ğ‘‘,ğ‘”ğ‘Ÿğ‘ğ‘â„)
5procedure ğ‘“ğ‘¢ğ‘§ğ‘§_ğ‘œğ‘›ğ‘’(ğ‘ ğ‘’ğ‘’ğ‘‘,ğ‘”ğ‘Ÿğ‘ğ‘â„)
6ğ‘šğ‘ ğ‘”â€²â†ğ‘ ğ‘’ğ‘’ğ‘‘
7ğ‘™ğ‘ğ‘ ğ‘¡_ğ‘ ğ‘ğ‘œğ‘Ÿğ‘’â†âˆ…
8forğ‘Ÿğ‘œğ‘¢ğ‘›ğ‘‘ğ‘ â†1toğ‘ğ‘Ÿdo
9 ğ‘šğ‘ ğ‘”â€²â†ğ‘šğ‘¢ğ‘¡ğ‘ğ‘¡ğ‘œğ‘Ÿ.ğ‘šğ‘¢ğ‘¡ğ‘ğ‘¡ğ‘’(ğ‘šğ‘ ğ‘”â€²,ğ‘ ğ‘â„ğ‘’ğ‘‘,ğ‘”ğ‘Ÿğ‘ğ‘â„,ğ‘‡)//ÄŸ3.3
10 ğ‘ ğ‘¡ğ‘ğ‘¡ğ‘’ğ‘†â†ğ‘’ğ‘¥ğ‘’ğ‘ğ‘¢ğ‘¡ğ‘œğ‘Ÿ.ğ‘ ğ‘–ğ‘š _ğ‘’ğ‘¥ğ‘’ğ‘ğ‘¢ğ‘¡ğ‘’(ğ‘…ğ‘‚ğµğ‘‚ğ‘‡,ğ‘Š,ğ‘šğ‘ ğ‘”â€²)//ÄŸ3.4
11 ğ‘ ğ‘¡ğ‘ğ‘¡ğ‘’ğ‘…â†ğ‘’ğ‘¥ğ‘’ğ‘ğ‘¢ğ‘¡ğ‘œğ‘Ÿ.ğ‘â„ğ‘¦ _ğ‘’ğ‘¥ğ‘’ğ‘ğ‘¢ğ‘¡ğ‘’(ğ‘…ğ‘‚ğµğ‘‚ğ‘‡,ğ‘Š,ğ‘šğ‘ ğ‘”â€²)//ÄŸ3.4
12 ifğ‘œğ‘Ÿğ‘ğ‘ğ‘™ğ‘’_â„ğ‘ğ‘›ğ‘‘ğ‘™ğ‘’ğ‘Ÿ.ğ‘â„ğ‘’ğ‘ğ‘˜ _ğ‘ğ‘¢ğ‘”ğ‘ (ğ‘‚,ğ‘ ğ‘¡ğ‘ğ‘¡ğ‘’ ğ‘†,ğ‘ ğ‘¡ğ‘ğ‘¡ğ‘’ğ‘…)/*ÄŸ3.5*/==ğ‘‡ğ‘Ÿğ‘¢ğ‘’
then
13 ğ‘ ğ‘ğ‘£ğ‘’_ğ‘ğ‘¢ğ‘”_ğ‘Ÿğ‘’ğ‘ğ‘œğ‘Ÿğ‘¡(ğ‘šğ‘ ğ‘”â€²,ğ‘ ğ‘¡ğ‘ğ‘¡ğ‘’ğ‘†,ğ‘ ğ‘¡ğ‘ğ‘¡ğ‘’ğ‘…)
14 return
15 else
16 ğ‘ ğ‘ğ‘œğ‘Ÿğ‘’â†ğ‘“ğ‘’ğ‘’ğ‘‘ğ‘ğ‘ğ‘ğ‘˜.ğ‘ğ‘¢ğ‘ğ‘›ğ‘¡ğ‘–ğ‘“ğ‘¦ _ğ‘ ğ‘ğ‘œğ‘Ÿğ‘’(ğ‘ ğ‘¡ğ‘ğ‘¡ğ‘’ğ‘†,ğ‘ ğ‘¡ğ‘ğ‘¡ğ‘’ğ‘…)//ÄŸ3.6
17 ifğ‘ ğ‘ğ‘œğ‘Ÿğ‘’>ğ‘™ğ‘ğ‘ ğ‘¡_ğ‘ ğ‘ğ‘œğ‘Ÿğ‘’then
18 ğ‘™ğ‘ğ‘ ğ‘¡_ğ‘ ğ‘ğ‘œğ‘Ÿğ‘’â†ğ‘ ğ‘ğ‘œğ‘Ÿğ‘’
19 ğ‘†â†ğ‘†âˆªğ‘šğ‘ ğ‘”â€²
The architecture and workflow of RoboFuzz are illustrated in
Figure4,andAlgorithm1 presentstheformalalgorithm. RoboFuzz
takesatargetsystemandateststrategyasinputandoutputsthe
reportoffoundbugs.Thesysteminspector( ÄŸ3.2)analyzesthetarget
system and extracts the ROS graph.Based on the extracted graph,
themessagemutator( ÄŸ3.3)mutatesROSmessagesandpublishes
them to the target node(s) running in the hybrid executor ( ÄŸ3.4).
Statesarecollectedduringtheexecutionofthetargetundermutated
messagesandcheckedagainsttheprovidedoraclesbytheoracle
handler ( ÄŸ3.5). If the oracle detects any failure, a bug report is
generated,andthefuzzingloopterminates.Otherwise,thefeedback
engine (ÄŸ3.6) quantifies the interestingness of the targetâ€™s behavior
from the execution states, and provides feedback to the message
mutator,guiding subsequent mutations.
3.2 SystemInspector
Thefirst stepoftesting istoscan therobotic systemtoobtain the
ROS network graph, which is a topological view of the robotic
450RoboFuzz : Fuzzing RoboticSystems overRobot Operating System (ROS)forFinding Correctness Bugs ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore
systemconsistingofallnodes,topics,andassociatedmessagetypes.
The system inspector launches the robotic system and examines
theROSnetworkbyinvokinginternalnodediscoveryAPIsofROS.
Unlessthetargetnodeisspecifiedonthetestprofileprovidedby
the user,allnodes inthe identifiedROSnetwork that subscribeto
at leastone topic automaticallybecome the candidates oftesting.
3.3 Type-awareMessage Mutator
ROS-basedsystemsaredrivenbyROSmessagesdistributedalong
the nodes of the ROS network. Thus, a testing framework has to
be capable ofstressing thesystembygenerating andtransferring
proper messages to relevant nodes. The message mutator is de-
signedspecifically for this task.
Type-aware Mutation. It is important to note that all topics
in the ROS network are bound to strictly typed messages. Given
that the type checker of ROS IDL works correctly, any message
isrejectedtobepublishedifitdoesnotconformwiththetopicâ€™s
type that is determined when the topic is initialized ( i.e., when the
robotic system is launched). In light of this property, RoboFuzz
supportstype-awaremutationofmessages,associatingappropriate
mutationoperatorswitheachROSdatatypetoconstraintheresult
ofamutation within the right type.
Thisisachievedby(1)inheritingthegeneralmutationoperators
such as bit flip, byte flip, and arithmetic operators from American
Fuzzy Lop (AFL) [ 51], which are proven to be effective in mutating
arbitrary data blobs and then (2) associating each operator with
ROSdatatypesuchthatitisguaranteedfortheapplicationofan
operator to produce the values expressible by the type and also (3)
addingaugmentedoperatorsthatproducespecialvalues( e.g.,NaN
andINFoffloat)andboundaryvalues( e.g.,uint32_max for32-bit
unsigned integer) that are often mishandled by the robotic system.
In addition, RoboFuzz allows users to register custom mutation
operators ( e.g., generating float in a certain range) for extensibility.
Specifically,givenamessage,themutatorselectsoneofthefields,
retrievesthedatatypeassociatedwiththeselectedfieldfromthe
ROS network graph, and applies one of the mutation operators
definedfor that data type.
Message Scheduling. The mutator also manages the schedule
of when the mutated messages should be published, considering
thecontextandpropertiesofthetargetsystem.Forsystemsthat
performaseriesofactionsuponreceivingonemessage,publishing
a single message and watchingthe behavior would be appropriate
(e.g.,agoalcoordinatemessagetoatrajectoryfollowingrobot).Ifa
systemismorerealtime,requiringastreamofmessages,publishing
asequenceofmessageswouldbetterfitthepurposeoftherobot
(e.g., remote control messages to a drone). RoboFuzz systemati-
cally schedules testing campaigns by defining configurable factors
suchasthenumberofmessagesinasequence,frequencyofpub-
lication,andthetimetowatch,andlettingusersdecidetheright
configurationbasedontheirneeds.
3.4 HybridExecutor
Manydevelopersrelyheavilyonroboticsimulatorstobenefitfrom
reduced cost and time in developing and testing robotic systems.
Even though modern simulators have relatively realistic physics
engineswithmoderatelyaccuratedynamicsandkinematicsmodels,
(a)PX4drone intherealworld
 (b)PX4droneinGazebosimulator
Figure 5: Hybrid executorrunning PX4dronesimultaneously
in the real world and the simulator. The actual place is accu-
rately modeled (GPS coordinate, trees, and building) to mini-
mize unhandled discrepancy between twoenvironments.
a certain degree of discrepancy between the simulation and the
real-world execution is inevitable, either because of the lack of
accuracy in the modeling or simply because the state in concern
isnotavailableinthesimulator( e.g.,thetemperatureofa motor).
In severe cases, the in-simulator position of a robot differs from
thepositionofaphysicalrobotafterreceivingtheidenticalcontrol
commandsduetothediscrepancy.SuchissuemakesaSimulator-in-
the-Loop(SITL) testinginsufficientto test for allpotentialissues.
Tofillthegapbetweenthesimulatorswithinsufficientfidelity
andprofoundphysicalenvironments,weemployahybridexecution
model in RoboFuzz . As illustrated in Figure 5, the hybrid executor
runstherobotinasimulator,andsimultaneouslyintherealworld(if
thephysicalrobotisavailable).Itthenrelaysthemutatedmessages
to bothsystemssothat both robotscan takecorresponding actions
to the identical messages. In the meantime, the executor monitors
both worlds to capture the states and events. RoboFuzz benefits
fromthisdesignbecause(1)therearecomplementarystatesthat
areonlyavailableineitheroftheworldsand(2)thereareredundant
states that show divergence, especially if the relayed messages are
relatedto sensors oractuators, as discussedin ÄŸ2.1.
3.5 Oracle Handler
Everyroboticsystemhasadifferentdefinitionof correctstatesand,
based onthese,employsdifferentinvariantsduringtheexecution.
Thus, a practicaltesting frameworkmust allowdevelopers to con-
veniently declare and apply correctness oracles that are specific to
eachroboticsystem. RoboFuzz providesanoracletemplate,that
allows developers to define oracle stateswith respect to thestates
capturedbythehybridexecutor.Thebuilt-inoraclehandlerchecks
up on the robotic states with the provided oracles and generates
bugreportsifanyviolationisfound.In ÄŸ4,wedemonstratetheuse
ofrobot-specificdeveloper-definedoraclesthat we builttargeting
differentsystemsto reveal correctness bugs.
3.6 FeedbackEngine
In a fuzzing process, execution feedback plays an important role
in providing guidance to the mutation engine. Typically, the ef-
fectivenessofthemutatedinputintheexecutionisquantifiedto
determine whether the mutation engine should keep mutating the
input or move on to another input. With the intuition that more
bugs can be detected by exploring more code paths in the program,
moderngreyboxfuzzersuse codecoverageasfeedbackandtryto
generate inputs that increase the code coverage. Such a strategy
workswellforgeneralsoftwareprogramsthathavediversecode
paths along the execution and results in finding a number of bugs.
451ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore Seulbae Kim andTaesoo Kim
However, robotic systems, by nature, are distributed systems
whose behaviors are driven by state changes excited by data flow,
ratherthanbythecontrolflow andthustendtohavealimitednum-
berofcodepaths.Thispropertymakescoverage-basedfeedbackless
effective in summarizing the execution of robotic systems, as code
pathsareredundantevenwhentherobotexhibitsawidevarietyof
behaviors,andledustodesignanaugmentedfeedbackmechanism
tailoredforroboticsystems.Tocomplementthecoverage-guided
feedbackmechanismandenhancetheinputstateexplorationfor
robotic systems, we propose semanticfeedback ,which quantifies
the Å‚bugginessÅ¾ of the execution context by taking advantage of
the domainknowledge ofthe testedrobots, as detailedbelow.
Redundant Sensor Inconsistency Feedback. In robotics, multi-
pleredundantsensorsareutilizedtoimprovetheaccuracyofthe
acquireddataand toprovidefaulttoleranceinthefaceofsensor
failure [19]. The assumption behind utilizing redundant sensors is
thateventhougheachsensorprovidesitsownmeasurementofthe
state in varying precision, the results should align with each other
with high similarity because we simultaneously measure the same
property.Fromanalternativestandpoint,adiscrepancyinthestates
measured by redundant sensors indicates potential issues in the
system, such as instability. Therefore, RoboFuzz allows developers
to register multi-sensor inconsistency as feedback if redundant
sensors are present in the systemunder test. In the case when the
robotic SUT has no redundant sensor, one could take advantage of
themodulararchitectureofroboticsystemsandinstallaredundant
sensor to facilitate the testing.
Control Error-based Feedback. Closed-loop feedback con-
trol [25] is a crucial part of robotic controllers; taking a control
command input, a robotic system outputs the error between the
referencevalue( e.g.,currentposition)andthesetpoint( e.g.,desired
position),whichisfedbacktothecontrollersothatitcangenerate
the next control command that can defeat the error. If a controller
is erroneous or poorly calibrated, it could fail to reduce the control
error,makingtherobotuncontrollable.Thus,developerscanutilize
theknowledgeoftheinternallogicofthecontrollertoaugmentthe
testingbyfactoringthe controlerrorintothe executionfeedback.
State Distance-based Feedback. For any numeric state that is
bound by physical limits, the difference between the measured
value and the limit indicates the distanceto the erroneous state.
Thus,astrategyoffavoringtheinputmessagesthatminimizesuch
distance can potentially contribute to guiding RoboFuzz to trigger
errorsthat specification-basedoracles ( ÄŸ3.5) attemptto detect.
Cyber-physical Discrepancy Feedback. When the hybrid ex-
ecutor (ÄŸ3.4) runs the robotic SUT, it assures that the exact same
messagesfromthemessagemutatorarepublishedtoboththephys-
ical robot and the simulated clone, which run the same software
stack with an identical configuration. Accordingly, the resulting
states of both robots are expected to be identical. However, in
practice, there are unwanted factors, such as the sensor noise or
inaccurate modeling of the simulator, that affect the fidelity of the
execution and result in a discrepancy in the states, such as the
divergence in the trajectory over time. By providing tools for com-
putingdiscrepanciesandregistering them as feedback, RoboFuzz
assistsdeveloperstotakesuchfactorsintoaccountinthetesting
andexcite the unhandledaspectsofthe executionenvironment.4ROBOFUZZ INACTION: SPECIALIZATION
With the base framework introduced in ÄŸ3, one can readily
turn robot-specific knowledge and expectations into a specialized
fuzzingcampaign.Todemonstratehow RoboFuzz canbeapplied
toheterogeneoustargetsandeffectivelyfindbugs,weselectfour
robotic applications of distinctive properties, and study them to
generateappropriate oracles andsemantic feedbackmetrics:
(1)PX4quadcopter (PX4)[29]:anopen-sourceflightcontrolstack,
knownforitssupportforavarietyofquadcoptermodelsand
high configurability.
(2)TurtleBot3 (TB3) [6,36]: a differential wheeled mobile robot
equippedwithaLiDAR sensor.
(3)Move It 2 (MI2) [11,39]: a robotic manipulation library for ROS
thatimplementsfundamentalconceptsofroboticmanipulation,
such as kinematics, motion planning, andcontrol.
(4)Turtlesim (TSM) [30]: a lightweight velocity-controlled turtle
robot ina2D simulator,shippedwithROS for tutorials.
ForROSinternals,wetarget(5) RCLAPIs andthe(6) typesystem
(ROSIDL) toensurethebuildingblocksofROS-basedapplications
arecorrect.Inthissection,wediscussnotabletarget-specificfactors
leadingto differentmutation strategies, oracles, andfeedback.
4.1 Common Oracles
Beforeweintroducetarget-specificstrategies,therearecommon
oracles that can be universally applied to multiple robotic systems.
Unlessotherwisenoted,thesecommonoraclesareutilizedbyde-
fault, alongwiththe specializedoracles.
Physical Constraint Oracle. Robotic systems operate in the
realworldandaretherebyboundbycertainphysicalconstraints.
The oracle handler adopts a set of checks for physical sanity ,i.e.,
statesrelatedtotheexistenceoftherobotinthephysicalspacecan
neitherdisappearnorhaveinfeasiblevalues.Inparticular,anystate
indicatingthegeometryoftherobot, i.e.,(ğ‘¥,ğ‘¦,ğ‘§)fortheposition
and(ğ‘Ÿğ‘œğ‘™ğ‘™,ğ‘ğ‘–ğ‘¡ğ‘â„,ğ‘¦ğ‘ğ‘¤)for the orientation, should present a feasible
value if the robot is in the three-dimensional physical space. For
example,it is guaranteed by physics that the ğ‘§-position ofa robot
can never beNULL,NaN, orINF. Likewise, kinematics-related states,
such as velocity, should always present physically tractable values
belongingto the real number range.
SanitizerOracle. Althoughnottheprimaryconcernof RoboFuzz ,
theoraclehandleralsointegrateswithcompilersanitizerstosup-
port the checking of classic memory-safety issues and miscella-
neous software-oriented errors in the robotic SUT. If the target
node is compiled with sanitizer flags, the sanitizer oracle detects
theerrorsignalsemittedbyAddressSanitizer[ 46]orUndefindBe-
haviorSanitizer[ 26]when the systemterminates.
4.2 TestingPX4Quadcopter
MutationandScheduling. PX4isacomplicatedsystemthatac-
ceptsmultipleformsofinputs;onecan(1)send trajectorysetpoint
messages that consist of the target position (ğ‘¥,ğ‘¦,ğ‘§), orientation
(ğ‘¦ğ‘ğ‘¤), speed(ğ‘£ğ‘¥,ğ‘£ğ‘¦,ğ‘£ğ‘§,ğ‘¦ğ‘ğ‘¤ğ‘ ğ‘ğ‘’ğ‘’ğ‘‘), and acceleration (ğ‘ğ‘¥,ğ‘ğ‘¦,ğ‘ğ‘§)
tohavetheinternalmotionplannerworkoutmovementcontrol
plans to reach each setpoint; (2) directly send a stream of control
452RoboFuzz : Fuzzing RoboticSystems overRobot Operating System (ROS)forFinding Correctness Bugs ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore
commands thatconsistsof(ğ‘¡â„ğ‘Ÿğ‘œğ‘¡ğ‘¡ğ‘™ğ‘’,ğ‘¦ğ‘ğ‘¤,ğ‘ğ‘–ğ‘¡ğ‘â„,ğ‘Ÿğ‘œğ‘™ğ‘™ )valuescor-
responding to the position of the control sticks of a remote control
unittomicro-controlthedrone;or(3)switchthe parameter val-
ues as suggested by [ 20] to dynamically configure the drone in
runtime. RoboFuzz considers all three input spaces and mutates
and schedules messages accordingly; for (1), RoboFuzz mutates
one attribute ( e.g.,ğ‘£ğ‘¥) of one message in the sequence of trajec-
tory setpoint messages and publishes them at a given interval ( e.g.,
20ğ»ğ‘§); for (2), RoboFuzz mutates one of the stick values of one
ofthecontrolcommandmessagesinthesequenceandpublishes
theentiresequence;andfor(3), RoboFuzz mutatesthevalueofa
parameterandrequestsparameterchangethroughtheMAVLink
protocol.
Oracles. Three types oforacles are formulatedfor PX4:
â€¢Parameter specification-based oracle: The behavior of PX4-based
robots is configured by parameters , which are numeric values
used in the controller software to configure the robot ( e.g., max-
imum velocity along the z-axis). As the system makes various
assumptionsbasedon theparameters,violatingtheparameters
couldleadtosafety-criticalsituations,asdemonstratedin ÄŸ6.We
parsedthePX4documentationforparametervaluesandmapped
vehicular states with each parameter so that the oracle checks
whether the captured states satisfy the valid range set by the
corresponding parameterandreports the violations.
â€¢Safety oracle: A collision is considered one of the most unde-
sirable events during flights, and any collision needs to be in-
vestigatedregardlessofthecause.Thesafetyoraclechecksfor
collisionsusing the data read bycontact sensors.
â€¢Flightmode oracle: PX4supportsvarious flight modes, and each
modeutilizesdifferentcontrollerlogic,leadingtodifferentma-
neuvers. The documentation of PX4introduces each mode, spec-
ifyingtheexpectedbehaviorsofthemode.Foreachmode,the
oracle modelsthe control algorithm, checking whether the de-
scribedcontrolisbeingexecuted.Forexample,theÅ‚takeoffmodeÅ¾
brings a drone straight to the desired altitude and does not re-
quire any external controls. If a drone moves horizontally in this
mode,the incident isreportedbythe oracle as abug.
Feedback. TwoPX4-specific feedbackmetrics are applied:
â€¢Redundantsensorinconsistency:Pixhawk4(aflightcontroller
hardware designed to run PX4firmware) [ 32] has two Inertial
MeasurementUnit(IMU)sensorsofdifferentvendors:BMI-055of
BoschandICM-20689ofTDK.Bothsensorsutilizeanaccelerom-
eterandagyroscopetomeasurethechangeintheposition(lo-
cation) andorientation(rotation)of the drone.Even thoughthe
twosensorsvaryinfidelity,theyreportconsistentacceleration
and angular velocity measurements with negligible discrepancy.
However,weobservedthattheirresponsestoanomalousorex-
treme events, such as collisions or flips that bring about rapid
movements, are divergent, resulting in a considerable discrep-
ancy in the readings. Accordingly, we interpret the difference
between two IMU readings as an instability metric and use it as
an element of the execution feedback, such that inputs that lead
to larger discrepanciesare favored.
â€¢Positionestimationerror: PX4utilizestheExtendedKalmanFilter
(EKF) [34] to combine the measurements from the IMU, mag-
netometer, and GPS sensors into the estimation of the globalposition ( i.e., latitude and longitude). As the controller of PX4
computes the thrust amount to minimize the difference between
thesetpoint(desiredposition)andtheestimation(currentposi-
tion),theestimationerroriscriticalinthebehaviorofadrone.
One of the reasons jeopardizing the reliability of the EKF esti-
mation is known as excessive vibration of the drone body. In
lightofthis,wecomputethepositionestimationerror, i.e.,the
EuclideandistancebetweentherawGPSsensorpositionandthe
EKF-estimatedposition, andregisteritas feedback.
4.3 TestingTB3andTSM
TB3is a differential wheeled robot, whose movement relies on two
individuallyactuatedwheelsonacommonaxis.Ithasa360-degree
laserdistancesensor(LDS-01)onthetopthatenablessimultaneous
localization and mapping (SLAM) [ 49] and autonomous driving.
TSMisessentiallya2Dversionof TB3,whichisvelocitycontrolled.
MutationandScheduling. TB3runsadesignatednodethatre-
ceivestwistmessages, which consist of target translational speed
(ğ‘š/ğ‘ ) and rotational speed ( ğ‘Ÿğ‘ğ‘‘/ğ‘ ), and runs a differential drive
algorithmtocontrolthetorquegeneratedbytwomotors.Accord-
ingly,RoboFuzz mutatesthetargetspeed,publishesthemessage
tothenode,andthenmonitorsthedynamicstatesof TB3,including
its position, velocities, andlaser scan data.
Oracles. Alongwiththecommonoracles,wedesignedtwo TB3-
specific oracles.
â€¢Specification-based oracle: Similar to the PX4oracles, physical
invariantsoftherobot,such as themaximum translationaland
rotational velocities, are collected from the specification docu-
ment ofTB3.In addition, from the datasheet andthe code of the
laserdistancesensordriver,therange ofvalidscandistancedata
isobtained,whichisalsocheckedbythe TB3 oracle.
â€¢Goal-based control oracle: Unless the commanded linear and
rotationalspeedsdonotexceedthespecifiedlimits, TB3isbound
toachievethetargetspeed.Thisfundamentalpropertyischecked
throughthe goal-basedcontroloracle.
Feedback. Odometry is a process of measuring the change in
position over time. To a robot that does not have a global position
sensor(e.g.,GPS),accurateodometryisthekeytoestimatingthe
globalposition andguaranteeing correctnavigation.
â€¢Odometric inconsistency: TB3runs odometry to calculate the
change in its position and orientation upon the actuation of
controlcommands.Here,theodometryinvolves tworedundant
methodsto calculate the change of yaw angle, one using the
measurement of the IMU sensor and the other using the amount
of rotation of the wheels. Under normal execution conditions,
bothmethodsyieldanalogousyawangles.However,whenthe
instabilityincreases( e.g.,iftherobotswaysandthewheelsdo
notstickontheground),thewheel-basedmeasurementbecomes
imprecise,aswheelmovementdoesnotalwaysleadtothechange
inposition andresults inincreasedodometricinconsistency.
4.4 TestingMI2with PANDAManipulator
PANDA manipulator by Franka Emika is a popular robot arm
equipped with seven revolute joints and torque sensors. Its control
interfaceofficially supports ROS and MI2,enabling the testing.
453ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore Seulbae Kim andTaesoo Kim
autonode=std::make_shared<rclcpp::Node>("rclcpp_node");
(a)rclcppAPIto create a node.
node=rclpy.create_node('rclpy_node')
(b)rclpyAPIto create a node.
(c)CallchainofRCLfunctionsthatareinternallyinvokedwhen
rclcpporrclpyAPIsarecalledto create a node.
Figure 6:APIconsistency on theROS Client Library (RCL).
MutationandScheduling. MI2â€™strajectoryplanneracceptsthe
goal position, which specifies where the hand of the robot arm
should be placed, and determines the position and motion of the
joints (i.e., angles of revolute joints over time) to realize the goal
position throughinversekinematics.
Oracles. Approaching from the control algorithmâ€™s angle, we
designedthree following oracles:
â€¢Inversekinematicsoracle:Dependingonthegoalpositionand
constraints,theinversekinematicssolutionmayormaynotexist.
This oracle emulates the inverse kinematics using an external
module and checks whether MI2fails to find an existing solution.
â€¢Specification-based oracle: The motion of the robot is physically
constrainedbyvariousjointconstraints,( e.g.,minimumandmax-
imumangleajointcanachieve).Similartootherroboticsystems,
we parse the datasheet of PANDA robot to extract the joint con-
straints andturnthemintoan oracle checking for violations.
â€¢Physicalcorrectnessoracle:Thecontrollerperiodicallypublishes
jointstates,whichconsistofpositionandvelocitysetpointscom-
puted by the trajectory planner, the actual position and joint
velocities, anderrors betweenthese vectors.Here,the positions
andvelocitiesshouldbevalidnumericvalues,andthejointveloc-
ities should be non-zero when the manipulator is being actuated.
Feedback. Asmentionedin ÄŸ3.6,thejointcontrollerofPANDA
manipulatoralsoperformsclosed-loopfeedbackcontrol,utilizing
the errorbetween the setpointsandactual position.
â€¢Joint-level controller error: The control error measured for each
jointindicateshowpreciselythetorquecontrollerisachieving
theplannedtrajectory.Errorsexceedingthecapacityoftherobot
cannotbecorrectedandleadtocontrolfailure.Thus,byfavoring
mutated messagesthatresultinincreased joint-levelcontroller
errors,we can excite the failure andreveal bugs.
4.5 TestingROS- RCLAPI Consistency
Asdescribed in ÄŸ2.2, RCLAPIimplementationsarethin wrappers
written in specific languages around the core functionalities of the
RCLlayer.RegardlessoftheAPIlanguage,itisexpectedthatthe
codepathstakeninRCLareidentical,suchthatthesameRCLfunc-
tions are invoked and return the same result ( e.g., return values).
Figure6showsanexampleofRCLAPIconsistency.ROSapplica-
tionswritteninC++cancreateanodeusing the rclcppshownin
Figure 6(a) . Likewise, therclpyAPI ofFigure 6(b) can be used ifTable 1:Codesize ofthe components of RoboFuzz .
Component LoC Language
Systeminspector 161
PythonMessage mutator and Scheduler 2,948
Hybrid executor and Harnesses 1,415
Oraclesand Feedback engine 1,000
the ROS system is built in Python. In both cases, each RCL API
invocation ends up invokingthe same RCL functionslisted in Fig-
ure6(c),ensuringthataROSnodeiscreatedandinitializedinaway
that is uniform and thereby correct. The API consistency oracle
isdesignedtocheckwhethertwo(ormore)APIimplementations
emit consistent behaviors with respect to the RCL code path by
dynamicallytracingtheRCLfunctioninvocationsandthereturn
valuesduringthe execution.
4.6 TestingROS- ROSIDL-basedTypeSystem
ROS IDL is the centerpiece of ROS type system, which not only
generates language-specific code ( e.g., C struct) for user-defined
message interfaces consisting of ROS native types, but also dynam-
ically checks the types of messages coming into and out of ROS
topics. Built upon the assumption that ROS IDL works correctly,
ROSnodesoftenomitredundanttypechecksofthedataithandles,
andeven boundary (minimumandmaximum)checks.
Our IDL correctness oracle is designed to test such foundational
assumptions. Given amessagecontainingfields ğ‘“1of built-indata
typeğ‘¡1andğ‘“2offixedarrayoftype ğ‘¡2,theIDLcorrectnessoracle
checks for the following five invariants regarding the type system:
(1) assigning avalueoftype ğ‘¡â€²toğ‘“1,whereğ‘¡â‰ ğ‘¡â€²should fail,
(2) assigning avaluebigger thanthe ğ‘šğ‘ğ‘¥ofğ‘¡1toğ‘“1should fail,
(3) assigning avaluesmallerthanthe ğ‘šğ‘–ğ‘›ofğ‘¡1toğ‘“1should fail,
(4)assigning a value of type ğ‘¡â€²to one of the elements of ğ‘“2, where
ğ‘¡2â‰ ğ‘¡â€²should fail,
(5) the valueassignment succeedsotherwise.
5 EVALUATION
Inthissection,weevaluatetheoveralleffectivenessof RoboFuzz
in finding correctness bugs in heterogeneous robotic systems by
answeringthree questions:
Q1. Howeffective is RoboFuzz infindingrobotic bugs?( ÄŸ5.1)
Q2. Howeffective isthe semantic feedbackmechanism?( ÄŸ5.2)
Q3.How does RoboFuzz compare to a state-of-the-art robotic
fuzzer?(ÄŸ5.3)
Implementation. Weprototypedthe RoboFuzz frameworkand
the specialized oracles in 5.5k lines of Python3 code [ 21], as shown
inTable1.TheframeworkisbuiltbasedonROS2 foxy,whichis
the latest LTSdistributionof ROS 2.
CostofOracleCreation. Twoweeksonaveragewererequired
forapersonwithacollege-levelknowledgeofroboticstostudyone
system,review its specificationsand code,and implementoracles.
Fortherobotdeveloperswhobetterunderstandtheirownsystems,
less creation costisanticipated.
ExperimentalSetup. Weperformedtheevaluationonalaptop
machinerunningUbuntu20.04,withInteli7-8850H 2.6Ghz,16GB
RAM, andQuadroP2000 mobileGPU.
We targeted four robotic systems, PX4,TB3,MI2, andTSM, as well
asROS2internals( ROSIDLandrclpy/rclcpp ).ForPX4andTB3,we
454RoboFuzz : Fuzzing RoboticSystems overRobot Operating System (ROS)forFinding Correctness Bugs ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore
utilized the actual robots along with their simulated clones; PX4
using Holybro X500 frame with Pixhawk4 flight controller, which
runsPX4v1.12, andTB3Å‚BurgerÅ¾ build, which runs foxy-devel
firmware.AllsimulationswereruninaGazebo11simulator[ 24,38],
exceptforTSM,whichoperatesinitsown2Dsimulator.Forinternal
layer testing,we builtROS 2 foxyfrom the source.
Foreachofthesixtargets,wecreatedseparatefuzzinginstances
perinputtype thetargetaccepts, e.g.,threeforPX4(ÄŸ4.2)andone
for eachof therest.Eachinstancewasrun for12 hourswithonly
target-specificoraclesactivatedtopreventbugsinotherlayers( e.g.,
underlying bugsinROS)from overshadowing the target bugs.
HybridExecution. RoboFuzzfullyautomatesthehybridexecu-
tionatthesoftwarelevel,butphysicalexecutioninvolvesinevitable
manual actions, e.g.,rebootinga robot through a power switchand
puttingitbackattheinitialposition.Inaddition,duetobatterylife,
safety, and the need to visit the test site, we intermittently utilized
the hybrid executor for physical robots; we tested each robot for
approximately 30 minutes each time, for a total of 12 hours, in
additionto otherfuzzinginstances.
5.1 Effectiveness of RoboFuzz
Newcorrectnessbugs RoboFuzz detectedfromthetargetrobotic
systems are listed in Table 2. Utilizing the in-house developed bug
oracles,RoboFuzz found 30 previously unknown bugs2. We re-
ported all the findings to the developers, and as a result, 25 bugs
have been acknowledged and six bugs have been fixed so far. It
should be noted that among the bugs RoboFuzz found, 13 bugs
(43%) reside in the internal ROS layers, potentially affecting any
robotic systemthat isbuiltontop ofROS.
Wevalidatedeachbugbyreplayingtherecordedinputmessages
against the robotic system under test and observing the conse-
quences,i.e., checking if the oracle handler reports the same errors.
Since we dynamically tested systems using concrete input mes-
sagesanddefinitiveoracles( e.g.,specificationviolation),noneof
the detectedbugswere identifiedas afalse positive.
5.2 Effectiveness ofSemantic Feedback
To showtheefficacy ofutilizingthesemanticfeedbackasfuzzing
guidance,we(1)comparethenumberofbugsfoundovertimewith
andwithoutthefeedbackwhilefuzzing PX4,whichisthelargestin
codesizeandstatespaceamongthetargets,(2)analyzethefeedback
score,demonstratingthe correlation betweenthe metricsproposed
inÄŸ4.2withthecorrectnessbug,and(3)showhowtraditionalcode
coveragefeedbackperforms inthe meantime.
FuzzingwithandwithoutFeedback. Figure7showsthenumber
of bugsRoboFuzz discovered while fuzzing PX4for 12 hours, with
andwithoutthesemanticfeedback.Withtheguidanceoftheredun-
dantsensorinconsistencyandpositionestimationerrorfeedback
(ÄŸ4.2),RoboFuzz found nine instances of bug #06 in the position
mode.Incontrast,whenwedisabledthesemanticfeedbackguid-
ance,RoboFuzz reliedsolelyonthe randommutation andfound
only twocasesofthe same violation in12 hours.
2Eachbugwastriggeredmultipletimesbydifferentinputs,butcountedonceperits
root cause identified by manual analysis.0246810
0 1 2 3 4 5 6 7 8 9 10 11 1201
0246810
0 1 2 3 4 5 6 7 8 9 10 11 1201# Bugs
Quantified
feedback
Fuzzing time (hr)feedback score
(normalized)# Bugs
Quantified
feedback
Fuzzing time (hr)# with feedback
# w/o feedback
Figure7:Numberofcorrectnessbugstriggeredwhilefuzzing
PX4for 12 hours with and without semantic feedback. Green
boxesindicatethequantifiedsemanticfeedbackgenerated
duringtherun with feedback, normalized to range [0:1].
0510152025
0 2 4 6 8 10 0 3 6 9 12Branch coverage(%)
Fuzzing time (first10mins) Fuzzing time (total, hr)
Figure8:Codecoveragemeasuredduringthe12-hourfuzzing
campaign presented in Figure 7 . The first 10 minutes are
magnified (left), and theentire result isshown on the right.
Breakdown of the Semantic Feedback Score. Inputs that in-
creasethefeedbackscoreareputintheinputqueue,astheydeserve
further mutations. In the case of PX4, if the IMU sensor inconsis-
tency or EKF-estimation error increases, the input is marked as
interesting. The contribution of feedback scores in finding bugs is
illustrated in green boxes in Figure 7. After detecting a bug, the
feedbackscoreisreset,asanewfuzzingcycleisinitiated.During
mostcycles,wecanobservethatthefeedbackscorehasatendency
togrowovertime,and RoboFuzz ultimatelyreachesthebugsby
focusing onmutatingthe inputsthat generatestronger feedback.
Impact of Traditional Code Coverage Feedback. As discussed
inÄŸ3.6,roboticsystemstendtohavelimiteddiversityinthecode
pathsbecause oftheirdistributedand data-heavy nature.We ob-
served this by instrumenting PX4and measuring the branch cov-
erage using Gcov [ 16] during fuzzing, as shown in Figure 8. The
code coverage quickly saturated at 21% in the first 10 minutes and
thenhardlygrewduringtheremaining12hourseventhoughthe
drone exhibited a variety of different behaviors, including nine
specificationviolations.Thisshowstheimportanceofincorporat-
ing supplementary feedback guidance in the robotic context to
complementtraditional code coveragefeedback.
5.3 Comparisonwith PGFuzz
PGFuzz[20]isastate-of-the-artfuzzerthataimstofindpolicyvio-
lationsinpopulardronecontrolsoftware,including PX4.Itidentifies
policies from the documentation; maps each policy to the input
spaceconsistingofconfigurationparameters,environmentalfac-
tors, and user commands through static profiling; and mutates the
inputspacetryingtominimizethedistancetopolicyviolations.By
extendingthe RoboFuzz oraclesbyimplementing21 PX4policies
PGFuzzidentified(includingtheoverlappingpolicieswealready
considered), we successfully detected 26 out of 36 policy violations
PGFuzzreported.The remaining10 violations require intentional
faultinjection( e.g.,shuttingGPSoffvia PX4shellcommand),which
isnot the inputspaceconsideredby RoboFuzz .
455ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore Seulbae Kim andTaesoo Kim
Table 2:List ofnew correctness bugsfoundandreported by RoboFuzz .ğ‘…ğ‘ : simulated robot, ğ‘…ğ‘: physical robot.
Layer # Target Bugdescription Type Ack? Fix?
ROS 2Applications01PX4(Offboard mode)Horizontal acceleration setpoints are not constrained by MPC_ACC_HOR_MAX parameter S âœ“
02PX4(Offboard mode)Controller implementation offeed-forward setpoint differs fromdocumentation S âœ“ âœ“
03PX4(Offboard mode)Mismatchin trajectory setpoint messagedefinition S âœ“
04PX4(Offboard mode)Incorrect definition ofapplicableparameters oftheflight mode S âœ“
05PX4(Positionmode)Definition of MPC_POS_MODE does not matchtheimplementation,andinconsistent withinthedocumentation S âœ“ âœ“
06PX4(Positionmode)Incorrect usageof MPC_ACC_HOR andMPC_ACC_HOR_MAX definition S âœ“
07PX4(Positionmode)Incorrect description of MPC_ACC_UP_MAX andMPC_ACC_DOWN_MAX parameters S âœ“
08PX4(Takeoffmode)Switching fromManual/Altitude/Position/Acromode,drone filestowards anarbitrary setpoint S âœ“
09TB3Motor driver implementation of ğ‘…ğ‘does not follow theactualmotorspecification,resulting in a smaller maximumvelocity S âœ“
10TB3Constraining logic on ğ‘…ğ‘firmware fails to correctly clamp velocity to thevalidrange S âœ“
11TB3Maximumtorque achievable by ğ‘…ğ‘ is not constrained by theactualmaximumtorque ofthemotorspecification S,D
12TB3Maximumvelocity by thedifferential drive controller of ğ‘…ğ‘ does not matchthatof ğ‘…ğ‘ D
13TB3Mismatchbetween LiDAR scan data- software sidedataexceeds thehardware sensorâ€™sspecified maximumrange D âœ“
14MI2Jointlimitsare incorrectly defined in the ğ‘…ğ‘ model, exceedingphysicallimitsandallowinginvalid postures S,D âœ“ âœ“
15MI2Jointvelocitiesare broadcasted aszerowhen themanipulator is moving P âœ“
16TSMType confusion while normalizing orientationangles resultsin physicallyinvalid positionvalues( NaN) P âœ“ âœ“
17TSMMissingvalidationsof NaN/INFvaluesonthecontroller inputsleadsto physicallyinvalid states P âœ“ROS 2Internals18ROSIDL Codegeneratorfor rclpydoes not check32/64bit float boundaries, treatingall floatvaluesasdouble Râœ“ âœ“
19ROSIDL Runtimemessagesetterdoes not handle bytetypes correctly - bytevaluesare internallytreated asstringliterals R
20ROSIDL Missingdatarangechecksfor theelementsof intarrays-e.g., 65535can be assigned to int8array R âœ“
21ROSIDL Missingdatarangechecksfor theelementsof floatarrays- double-sized valuecan be assigned to floatarray R âœ“
22ROSIDL Implicit type casting ofarrayelementsaltersdatawithoutnotifying - e.g., assigning -32to uint8array,thevaluebecomes224 R âœ“
23ROSIDL Missingtype checksfor boolarrayelements, allowingdataofany type to be stored - e.g., string, list, dictionary,...can becomeanelement R âœ“
24ROSIDL Missingtype checksfor bytearrayelements, allowingdataofany type to be stored - e.g., string, list, dictionary,...can becomeanelement R âœ“
25ROSIDL Missingtype checksfor stringarrayelements, allowingdataofany type to be stored - e.g., list, dictionary,byte,bool, ...can becomeanelement R âœ“
26 rclpy_on_parameter_event alwaysreturns True,regardlessoftheresult R âœ“ âœ“
27 rclpy Missing NULLcheckofrmw_handle inrclpy_create_publisher leading to nullpointer dereference S âœ“
28 rclcpprclcppinternallythrows an exceptionwhile validating incorrect topic/service names,which cannot be caughtby requester R âœ“
29 rclcpp Nodeobject reliesonsubscriptioninterfaceto catch parameter events,violating design principleofparameter callbacks S
30 rclcpp Unreachableerror checking codefor parameter event type R
P:Physicalincorrectness/ S:Specification violation/ D:Cyber-physical Discrepancy / R:Miscellaneous software error in ROS
On the contrary, PGFuzzmissed all the new bugs detected by
RoboFuzz forthefollowingthreereasons.First,thepolicies PGFuzz
manually identified from the documentation do not include all
specifications that RoboFuzz oracle checked. Second, some bugs
are only triggered by a stream of real-time inputs ( e.g., remote
control signals) with accurate timing. PGFuzzcannot generate
such complicated inputs with its coarse timing model, which only
specifiesthehappens-beforerelationshipbetweeninputs.Finally,
due to the lack of soundness of the static profiling engine, PGFuzz
missedonepolicyviolation RoboFuzz detected(bug#08in Table2)
eventhoughthebugviolatestwoofthe21policiesittargeted.Since
the static profiler maps inputs to target parameters by tracking
dependency,thestatetransitionsthatrelyonimplicitdependencies,
such as the caseofbug#08,are removedfrom the inputspace.
6 CASE STUDY
Correctness bugs in robotic systems are subtle and complicated
to reason about, as both hardware and software components are
involved. In this section, we introduce and analyze interesting
correctness bugs RoboFuzz discovered.
PX4 - Drone Loses Control with Unconstrained Acceleration
Setpoint. Offboard mode is one of the autonomous modes that
realizes trajectory setpointsreceived from a companioncomputer.
Bugs#01-02 in Table2arerelatedtothecombinationofspecifica-
tion violation and missing input sanitation, as detailed below. First,
even though the documentation of PX4definesMPC_ACC_HOR_MAX
asÅ‚maximum horizontalaccelerationfor automodeandfor man-
ual modeÅ¾ and assigns a default value of 5ğ‘š/ğ‘ 2, this constraint
isnotappliedtotheaccelerationsetpoints,allowinganyvalueto
be forwarded to the controller. Consequently, an abnormally largehorizontal acceleration setpoint, e.g.,ğ‘ğ‘¦=3000ğ‘š/ğ‘ 2, immediately
contaminates the internal controller states, which results in gen-
eratinghugehorizontalthrust.Thecontrollerkeepspushingthe
drone at the maximum velocity as it tries to realize the setpoint
acceleration ( 3000ğ‘š/ğ‘ 2), while the actual acceleration saturates
atthehardwarelimit.Unfortunately,oncetheinternalstatesare
contaminatedandthedronegearsupfortheanomaloussetpoint,it
cannotberecoveredtoastablestateevenbyupdatingtheaccelera-
tion setpoint, e.g.,ğ‘ğ‘¦=0ğ‘š/ğ‘ 2, and safety is no longer guaranteed
at this point.
TB3 - Legitimate Linear Velocity Command Being Silently
Ignored (Bugs #09-10). Thedocumented maximum linearveloc-
ity ofTB3is0.22ğ‘š/ğ‘ . When we publish a linear velocity control
command ( ğ‘£ğ‘’ğ‘™ğ‘‘ğ‘’ğ‘ ğ‘–ğ‘Ÿğ‘’ğ‘‘ğ‘¥=0.22), the ROS node reads the command
and writes it to the control table of the firmware. On the firmware
side,thisvalueisconstrainedbytheinternallogicthatcomputes
the maximum linear velocity with respect to the motor power as:
ğ‘£ğ‘’ğ‘™ğ‘šğ‘ğ‘¥
ğ‘¥=ğ‘¤â„ğ‘’ğ‘’ğ‘™_ğ‘Ÿğ‘ğ‘‘ğ‘–ğ‘¢ğ‘ âˆ—2ğœ‹âˆ—ğ‘šğ‘œğ‘¡ğ‘œğ‘Ÿ_ğ‘Ÿğ‘ğ‘š/60
=0.033âˆ—2ğœ‹âˆ—61/60=0.2108(1)
Then, the motor driver translates the constrained linear velocity to
the wheel velocity and commands the motor if the velocity does
not exceed the hardcoded limit, 337. The translation is done by the
following equation:
ğ‘£ğ‘’ğ‘™ğ‘”ğ‘œğ‘ğ‘™
ğ‘¥=ğ‘¤â„ğ‘’ğ‘’ğ‘™_ğ‘Ÿğ‘ğ‘‘ğ‘–ğ‘¢ğ‘ âˆ—ğ‘…ğ‘ƒğ‘€âˆ—ğ‘¤â„ğ‘’ğ‘’ğ‘™_ğ‘£ğ‘’ğ‘™ğ‘”ğ‘œğ‘ğ‘™âˆ—0.10472
=0.033âˆ—0.229âˆ—ğ‘¤â„ğ‘’ğ‘’ğ‘™_ğ‘£ğ‘’ğ‘™ğ‘”ğ‘œğ‘ğ‘™âˆ—0.10472(2)
Pluggingthe goalvelocityin, we getthe desiredwheel velocity:
ğ‘¤â„ğ‘’ğ‘’ğ‘™_ğ‘£ğ‘’ğ‘™ğ‘”ğ‘œğ‘ğ‘™=ğ‘£ğ‘’ğ‘™ğ‘”ğ‘œğ‘ğ‘™
ğ‘¥âˆ—1263.6329
=0.2108âˆ—1263.6329=266.37(3)
456RoboFuzz : Fuzzing RoboticSystems overRobot Operating System (ROS)forFinding Correctness Bugs ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore
As the final wheel velocity, 266.37, does not exceed the limit ( 337),
thiscommandisacceptedandsenttotheactualmotor.However,
the documented velocity limit of the motor is 265[37], and the
motor silently fails to execute the commanded velocity. As a result,
users end up sending a legitimate command that is accepted by the
firmware,but cannotmake the robot move.
Turtlesim-TypeConfusioninnormalizeAngleFunction(Bug
#16).Turtlesimâ€™s controller receives desired angular and linear
velocities as commands and simulates the motion and position of a
turtleevery ğ‘‘ğ‘¡=16ğ‘šğ‘ .The orientationangle ğœƒisupdatedby:
ğœƒğ‘›ğ‘’ğ‘¤=ğ‘›ğ‘œğ‘Ÿğ‘šğ‘ğ‘™ğ‘–ğ‘§ğ‘’ğ´ğ‘›ğ‘”ğ‘™ğ‘’(ğœƒğ‘ğ‘¢ğ‘Ÿğ‘Ÿğ‘’ğ‘›ğ‘¡+ğ‘ğ‘›ğ‘”_ğ‘£ğ‘’ğ‘™âˆ—ğ‘‘ğ‘¡)(4)
Here,normalizeAnglenormalizestheorientationangleto [âˆ’ğœ‹:ğœ‹],
so that the posture can be visualized in the simulation. Unfortu-
nately,thereturntypeismistakenlyassignedas float,whichmakes
theorientationNaNifthecommandedangularvelocityissufficiently
large.Asaresult,theturtleâ€™spositionbecomesphysicallyinfeasible.
rclpy - Concurrency Issue Due to Missing NULL Check (Bug
#27).When writing a user-space API for creating a publisher, it
is recommended by the RCLdocumentation to Å‚get the rmw han-
dle from the publisher using rcl_publisher_get_rmw_handle each
time it is neededÅ¾ to avoid potential concurrency issues with the
functionsthatcanchangethermwhandlepointer. rclcppdoesthis
at the end of its create_publisher function. However, the same
checkismissingin rclpy_create_publisher ofrclpyimplementa-
tion, resulting in a NULL-pointer dereference error when the rmw
handle pointer isconcurrently invalidatedbyotherfunctions.
7 DISCUSSION AND FUTUREWORK
AddressingPhysical-simulationDiscrepancy. Anumberofun-
certainfactorsinthephysicalenvironmentcouldhinder RoboFuzz
fromreliablyobtaining consistentexecutiondata.Tothisend,we
made the following design decisions to minimize the disruption by
physical-simulation discrepancies. First, we designed simulation
mapsasidenticalaspossibletotheactualtestsites.Forexample,
inFigure 5, the dimensions and locations of the static objects were
reflectedinthesimulationmapasaccuratelyaspossible.Second,
we designed state discrepancy oracles to check for reasonably obvi-
ousdeviations, e.g., the difference of the final velocities rather than
their trends, so that trivial noises can be filtered. Last but not least,
we ran tests only on clear, windless days to minimize the influence
ofweather onthe robot.
Limitation. WithRoboFuzz , we attempt to excite the faults in
robotic systems by injecting valid ( i.e., correctly formatted) mes-
sages on the ROS level. Such positive testing is useful for revealing
variousissuesthat can occurduringnormal operations, including
thecorrectness bugswe addressedinthis paper.However,froma
holistic point of view, the security and robustness of robotic sys-
temscanstillbethreatenedfromdifferentvectors.Forexample,the
underlyingcommunicationprotocol( e.g.,DDS)mightbeflawed,al-
lowing malformed messages to be transmitted and crash the entire
system or breaking the integrity of messages, causing unexpected,
hard-to-debug errors. Furthermore, various physical attacks can be
launched directly to robots. In our future work, we plan to develop
testingmethodologiesforthelayerssurroundingROStocoversuch
attackvectors andrendersafer ecosystem for robotic systems.8 RELATED WORK
Testing ROS. Most existing work on ROS focuses on securing the
ROSnetwork.Dieber etal.[14]andtheSROSproject[ 50]analyzed
potentialnetwork-basedattackvectorsandproposeda TLS-based
securechannelforinter-nodecommunications.ROSPenTo[ 13]isa
penetrationtestingsuitetoanalyzeROSnetworks,andMcClean
et al. [28] demonstrated a honeypot. RoboFuzz instead takes an
orthogonalapproachandfocusesontheinternalfailuresthatbreak
theassumptionsandthreatentherobustnessofROS-basedsystems.
Fuzzing for Cyber-physical Systems. RVFuzzer [22] and
PGFuzz[20]targetparametererrorsandpolicyviolationsinspe-
cificdronecontrollers. RoboFuzz complementstheseapproachesby
serving as (1) a generic framework that seamlessly integrates with
any ROS-based robotic system and (2) a highly extensible frame-
workwithwhichvariousdeveloperassumptionsandspecifications
canbe modeled and tested through feedback-guided mutation. As
aresult,RoboFuzz detectsnotonlythe PX4bugsfoundby PGFuzz,
but alsomore bugsfrom PX4andotherrobotic systems.
CPFuzz [47] demonstrates the applicability of AFL-based
coverage-guided greybox fuzzing to the controller programs of
cyber-physicalsystems( e.g.,aheatersystem)toidentifysafetyvio-
lations.Testingvarioussmall(<100LoC)benchmarkcontrollers,
theapproachsuccessfullydetectsspecificationviolations.However,
as shown in ÄŸ5.2, the effectiveness of code-coverage guidance is
dampenedinlargercodebases. RoboFuzz countersthisproblemby
accommodating semantics-based feedback and successfully identi-
fiescorrectness bugsfrom large robotic systems.
Feedback-driven Fuzz Testing. A number of feedback-driven
fuzzing approaches are proven to be effective in finding bugs in
user-spaceapplications[ 1,51],andkernels[ 2,44].Unfortunately,
existing fuzzing approaches primarily focus on finding memory-
safetyissues,andthuscannotbeappliedtofindingcorrectnessbugs
inroboticsystems. RoboFuzz bringstheconceptoffeedback-driven
fuzzingintothe robotics domain,enabling effective testing.
9 CONCLUSION
Thispaperpresents RoboFuzz ,asemanticfeedback-drivenfuzzer
tailored for finding correctness bugs prevalent in ROS and ROS-
basedroboticsystems.Byinjectingmutatedmessagestotherobots
runninginboththerealworldandasimulatorandcheckingthe
capturedroboticstatesagainstcarefullydesignedrobot-specificcor-
rectnessoracles, RoboFuzz goesbeyondmemory-safetybugsand
detects subtle correctness bugs, including the violation of physical
laws, violation of specifications, and cyber-physical discrepancies.
Thisprocessisfurtherexpeditedbyincorporatingsemanticfeed-
backasguidance,whichquantifiesthebugginessfromtheexecution
context. As a result, RoboFuzz has detected 30 new correctness
bugsinROS andROS-basedapplications.
ACKNOWLEDGMENT
Wethanktheanonymousreviewersfortheirinsightfulfeedback.
This research is funded by the Secure Systems Research Center
(SSRC)attheTechnologyInnovationInstitute(TII),UAE.Weare
gratefultoDr.Shreekant(Ticky)Thakkarandhisteammembers
at the SSRCfor theirvaluable comments andsupport.
457ESEC/FSE â€™22, November14Å›18, 2022,Singapore, Singapore Seulbae Kim andTaesoo Kim
REFERENCES
[1]2017. LibFuzzer Å› a library for coverage-guided fuzz testing. https://llvm.org/
docs/LibFuzzer.html .
[2] 2018. syzkaller- kernelfuzzer. https://github.com/google/syzkaller .
[3]2020. ROS Community Metrics Report. http://download.ros.org/downloads/
metrics/metrics-report-2020-07.pdf .
[4] 2022. ROSRobots. https://robots.ros.org/ .
[5] Amazon.2022. PrimeAir. https://www.amazon.com/primeair .
[6]Robin Amsters and Peter Slaets. 2019. Turtlebot 3 as a Robotics Education
Platform. In International Conference on Robotics in Education (RiE) . Springer,
170Å›181.
[7]Bloomberg. 2022. The Rise of ROS: Nearly 55% of total commercial robots
shipped in 2024 Will Have at Least One Robot Operating System package.
https://www.bloomberg.com/press-releases/2019-05-16/the-rise-of-ros-
nearly-55-of-total-commercial-robots-shipped-in-2024-will-have-at-least-
one-robot-operating-system-package .
[8]MarcelBÃ¶hme,Van-ThuanPham,Manh-DungNguyen,andAbhikRoychoud-
hury. 2017. Directed greybox fuzzing. In Proceedings of the 2017 ACM SIGSAC
Conference onComputer and Communications Security . 2329Å›2344.
[9]Breiling, Benjamin and Dieber, Bernhard and Schartner, Peter. 2017. Secure com-
municationfortheRobotOperatingSystem.In 2017annualIEEEinternational
systemsconference (SysCon) . IEEE,1Å›6.
[10]Peng Chenand HaoChen.2018. Angora: Efficientfuzzing byprincipledsearch.
In2018IEEE SymposiumonSecurityand Privacy (SP) . IEEE,711Å›725.
[11] SachinChitta.2016. MoveIt!:anintroduction. In RobotOperatingSystem(ROS) .
Springer, 3Å›27.
[12]DeMarinis,NicholasandTellex,StefanieandKemerlis,VasileiosPandKonidaris,
George and Fonseca, Rodrigo. 2019. Scanning the internet for ros: A view of
security in robotics research. In 2019 International Conference on Robotics and
Automation(ICRA) . IEEE,8514Å›8521.
[13]BernhardDieber,RuffinWhite,SebastianTaurer,BenjaminBreiling,Gianluca
Caiazza, Henrik Christensen, and Agostino Cortesi. 2020. Penetration testing
ROS. InRobotoperatingsystem(ROS) . Springer, 183Å›225.
[14]Dieber,BernhardandBreiling,BenjaminandTaurer,SebastianandKacianka,Sev-
erinandRass,StefanandSchartner,Peter.2017. SecurityfortheRobotOperating
System.Robotics and AutonomousSystems 98(2017), 192Å›203.
[15]Edwards, Shaun and Lewis, Chris. 2012. ROS-Industrial: Applying the Robot
Operating System (ROS) to Industrial Applications. In IEEE Int. Conference on
Robotics and Automation,ECHORDWorkshop .
[16]GNU.2022. gcovÃaTestCoverageProgram. https://gcc.gnu.org/onlinedocs/
gcc/Gcov.html .
[17] Google. 2022. Wing. https://wing.com/ .
[18]iRobot. 2021. Investor Presentation August 2021. https://investor.irobot.com/
static-files/a6147f70-f50a-43d3-9161-9af57981ea0f .
[19]MehdiJafari.2015. Optimalredundantsensorconfigurationforaccuracyincreas-
ing in space inertial navigation system. Aerospace Science and Technology 47
(2015), 467Å›472.
[20]HyungsubKim,MuslumOzgurOzmen,AntonioBianchi,ZBerkayCelik,and
Dongyan Xu. 2021. PGFUZZ: Policy-Guided Fuzzing for Robotic Vehicles. In
Network and DistributedSystemSecuritySymposium .
[21]SeulbaeKimandTaesooKim.2022. RoboFuzzArtifact(Version1). Zenodo(2022).
https://doi.org/10.5281/zenodo.7036047
[22]Taegyu Kim, Chung Hwan Kim, Junghwan Rhee, Fan Fei, Zhan Tu, Gregory
Walkup, Xiangyu Zhang, Xinyan Deng, and Dongyan Xu. 2019. RVFuzzer: Find-
ingInputValidationBugsinRoboticVehiclesthroughControl-GuidedTesting.
In28thUSENIXSecuritySymposium(USENIXSecurity19) . 425Å›442.
[23]GeorgeKlees,AndrewRuef,BenjiCooper,ShiyiWei,andMichaelHicks.2018.
EvaluatingFuzzTesting.In Proceedingsofthe2018ACMSIGSACConferenceon
Computer and Communications Security(CCS2018) .
[24]NathanKoenigandAndrewHoward.2004. Designanduseparadigmsforgazebo,
an open-source multi-robot simulator. In 2004 IEEE/RSJ International Conference
onIntelligentRobotsandSystems(IROS)(IEEECat.No.04CH37566) ,Vol.3.IEEE,
2149Å›2154.[25]Jean-Paul Laumond et al .1998.Robot motion planning and control . Vol. 229.
Springer.
[26]LLVM. 2021. Clang 13 Documentation - UndefinedBehaviorSanitizer. https:
//clang.llvm.org/docs/UndefinedBehaviorSanitizer.html .
[27]Steven Macenski, Tully Foote, Brian Gerkey, Chris Lalancette, and William
Woodall. 2022. Robot Operating System 2: Design, architecture,and uses in the
wild.Science Robotics 7, 66 (2022), eabm6074. https://doi.org/10.1126/scirobotics.
abm6074
[28]McClean,JarrodandStull,ChristopherandFarrar,CharlesandMascarenas,David.
2013. APreliminaryCyber-PhysicalSecurityAssessmentoftheRobotOperating
System (ROS). In Unmanned Systems Technology XV , Vol. 8741. International
Societyfor Opticsand Photonics,874110.
[29]Lorenz Meier, Dominik Honegger, and Marc Pollefeys. 2015. PX4: A Node-Based
Multithreaded Open Source Robotics Framework For Deeply Embedded Plat-
forms.In 2015IEEEinternationalconferenceonroboticsandautomation(ICRA) .
IEEE,6235Å›6240.
[30] JasonM Oâ€™Kane. 2014. Agentleintroduction to ROS. (2014).
[31]Gerardo Pardo-Castellote.2003. OMG Data-Distribution Service: Architectural
Overview. In 23rd International Conference on Distributed Computing Systems
Workshops,2003. Proceedings. IEEE,200Å›206.
[32]PX4. 2022. Pixhawk 4. https://docs.px4.io/master/en/flight_controller/pixhawk4.
html.
[33]Quigley, Morganand Conley,Kenand Gerkey, Brian and Faust,Josh and Foote,
Tully and Leibs, Jeremy and Wheeler, Rob and Ng, Andrew Y. 2009. ROS: an
open-source Robot Operating System. In ICRA workshop on open source software ,
Vol. 3.Kobe, Japan,5.
[34]MariaIsabelRibeiro.2004. KalmanandExtendedKalmanFilters:Concept,Deriva-
tionand Properties. Institutefor Systemsand Robotics 43(2004), 46.
[35]Robotics And Automation News. 2021. US DoD selects Stratom to migrate
robotic systems from ROS-1 to ROS-2. https://roboticsandautomationnews.com/
2021/08/23/us-selects-stratom-to-migrate-robotic-systems-from-ros-1-to-ros-
2/45763/.
[36] Robotis.2017. TurtleBot3. https://www.robotis.us/turtlebot-3/ .
[37]Robotis.2022. XL430-W250motorspecification. https://emanual.robotis.com/
docs/en/dxl/x/xl430-w250 .
[38] ROS. 2022. Gazebo. https://gazebosim.org/ .
[39] ROS. 2022. MoveItMotion Planning Framework. https://moveit.ros.org/ .
[40] ROS. 2022. ROS-Industrial. https://rosindustrial.org/ .
[41] ROS. 2022. ROS-M. https://rosmilitary.org/ .
[42]ROS Discourse. 2016. Announcing SROS! Security enhancements for ROS. https:
//discourse.ros.org/t/announcing-sros-security-enhancements-for-ros/536 .
[43]ROS.org. 2016. Automatic Testing with ROS. http://wiki.ros.org/Quality/
Tutorials/UnitTesting .
[44]Sergej Schumilo, Cornelius Aschermann, Robert Gawlik, Sebastian Schinzel, and
ThorstenHolz.2017. kAFL:Hardware-AssistedFeedbackFuzzingforOSKernels.
In26thUSENIXSecuritySymposium(USENIXSecurity17) . 167Å›182.
[45]KostyaSerebryany.2017. OSS-Fuzz-Googleâ€™scontinuousfuzzingserviceforopen
source software. (2017).
[46]Konstantin Serebryany, Derek Bruening, Alexander Potapenko, and Dmitriy
Vyukov. 2012. AddressSanitizer: A Fast Address Sanity Checker. In 2012 USENIX
Annual TechnicalConference (USENIXATC 12) . 309Å›318.
[47]FuteShang,BuhongWang,TengyaoLi,JiweiTian,andKunruiCao.2020. CPFuzz:
Combining fuzzing and falsification of cyber-physical systems. IEEE Access 8
(2020), 166951Å›166962.
[48]Sheetz, Kyle H and Claflin, Jake and Dimick, Justin B. 2020. Trends in the Adop-
tion of Robotic Surgery for Common Surgical Procedures. JAMA network open 3,
1 (2020), e1918911Å›e1918911.
[49]SumeghPramodThale,MihirMangeshPrabhu,PranjaliVinodThakur,andPratik
Kadam. 2020. ROS based SLAM implementation for Autonomous navigation
using Turtlebot.In ITM Web ofConferences , Vol. 32.EDP Sciences,01011.
[50]Ruffin White, Dr Christensen, I Henrik, Dr Quigley, et al .2016. SROS: Secur-
ing ROS over the wire, in the graph, and through the kernel. arXiv preprint
arXiv:1611.07060 (2016).
[51] Zalewski,Michal. 2014. American FuzzyLop. http://lcamtuf.coredump.cx/afl .
458