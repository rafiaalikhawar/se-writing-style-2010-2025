EtherDiﬀer:DiﬀerentialTesting onRPCServicesof
Ethereum Nodes
Shinhae Kim
The AﬃliatedInstitute of ETRI
Daejeon,SouthKorea
shinhae1106@nsr.re.krSungjae Hwang∗
SungkyunkwanUniversity
Suwon,SouthKorea
sungjaeh@skku.edu
ABSTRACT
Blockchain is a distributed ledger that records transactions among
usersontopofapeer-to-peernetwork.Amongall,Ethereumisthe
most popular general-purpose platform and its support of smart
contracts led to a new form of applications called decentralized
applications (DApps). A typical DApp has an oﬀ-chain frontend
andon-chainbackendarchitecture,andthefrontendoftenneeds
interactionswiththebackendnetwork,e.g.,toacquirechaindata
ormaketransactions.Therefore,Ethereumnodesimplementthe
oﬃcialRPCspeci/f_icationandexposeauniformsetofRPCmethods
to the frontend.However, the speci/f_ication is not suﬃcient in two
points:(1)lackofclari/f_icationfornon-deterministiceventhandling,
and (2) lack of speci/f_ication for invalid arguments. To eﬀectively
discloseanydeviationscausedbytheinsuﬃciency,thispaperin-
troduces EtherDiffer that automatically performs diﬀerential
testing on four major node implementations in terms of their RPC
services. EtherDiffer /f_irst generates a non-deterministic chain
bymulti-concurrenttransactionsandpropagationdelay.Then,it
appliesourkeytechniquescalledproperty-basedgenerationand
type-preserving mutation to generate both semantically-valid and
semantically-invalid-yet-executable test cases. EtherDiffer exe-
cutesthetestcasesontargetnodesandreportsanydeviationsin
errorhandlingorreturnvalues.Theevaluationshowedtheeﬀec-
tiveness of our test case generation techniques with the success
ratiosof98.8%and95.4%,respectively.Also, EtherDiffer detected
48 diﬀerent classes of deviations including 11 implementation bugs
such as crash and denial-of-service bugs. We reported 44 of the de-
tectedclassestothespeci/f_icationandnodedevelopersandreceived
acknowledgementsaswellasbugpatches.Lastly,itsigni/f_icantly
outperformedtheoﬃcialnodetestingtoolineverytechnicalaspect.
We believethatourresearch/f_indingscan contributeto more stable
DApp ecosystem byreducing the inconsistenciesamong nodes.
CCS CONCEPTS
•Software and its engineering →Software testing and de-
bugging;•Theoryofcomputation →Programanalysis ;•Se-
curityandprivacy →Distributed systems security .
∗Sungjae Hwang is the corresponding author.
Permissionto make digitalor hard copies of allorpart ofthis work for personalor
classroom use is granted without fee provided that copies are not made or distributed
forpro/f_itorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation
onthe/f_irstpage.Copyrights forcomponentsofthisworkownedbyothersthanthe
author(s)mustbehonored.Abstractingwithcreditispermitted.Tocopyotherwise,or
republish,topostonserversortoredistributetolists,requirespriorspeci/f_icpermission
and/or a fee. Request permissions from permissions@acm.org.
ESEC/FSE ’23, December 3–9, 2023, San Francisco, CA,USA
©2023 Copyright heldby the owner/author(s). Publicationrightslicensed to ACM.
ACM ISBN 979-8-4007-0327-0/23/12...$15.00
https://doi.org/10.1145/3611643.3616251KEYWORDS
blockchain,ethereumnodes, rpc services, diﬀerential testing
ACMReference Format:
ShinhaeKimandSungjaeHwang.2023.EtherDiﬀer:DiﬀerentialTestingon
RPCServicesofEthereumNodes.In Proceedingsofthe31stACMJointEuro-
pean Software Engineering Conference and Symposium on the Foundations of
Software Engineering (ESEC/FSE ’23), December 3–9, 2023, San Francisco, CA,
USA.ACM,NewYork,NY,USA, 12pages.https://doi.org/10.1145/3611643.
3616251
1 INTRODUCTION
Ablockchainisadistributedledgerontopofapeer-to-peernetwork
andrecordstransactionsamongusers.Itistechnicallyagrowinglist
ofdatastructurescalledblocks,andeachpeersharesthesamecopy
of the list to prevent any arbitrary modi/f_ications. A block contains
various transactionaland network state data suchas transactions,
eventlogs, andaccount states. When a usersubmits a transaction,
one of the peers forms a block with the transaction and broadcasts
ittothenetwork.Oncereceived,eachpeerindividuallyvalidates
the incoming block and appends it at the end of its chain. Since in-
troducedbySatoshiNakamotoin2009[ 36],blockchaintechnology
has mademuchprogressandbecame atop future trend [ 33].
Out of all, Ethereum is the most popular general-purpose block-
chain platform with 199 billion dollars of market capitalization [ 7].
ItconsistsofEthereumpeersreferredtoas“nodes”andsupports
general-purposesmartcontracts.Thecontractsareprogramsthat
are implemented in high-level programming languages like So-
lidity [44] and deployed on the network. Users can execute their
functions bysubmittingtransactionswith contractaddressesand
arguments speci/f_ied. As smart contracts enable the automation of
service logic, there has been a popularity increase in decentralized
applications(DApps).Accordingtostatistics[ 6],thereexist2,855
EthereumDAppsspanningovervariousserviceslikepaymentsand
auctions,and31,590 usersmade atotalof79,550 transactionsina
single day. Also,the top 10 DApps have the transactionvolume of
approximately6.88billiondollars intotal [ 8].
A decentralized application consists of an oﬀ-chain frontend
and an on-chain backend. The frontend is what users interact with,
and thebackend isa number ofsmartcontracts to handle core ap-
plication logic. However, the oﬀ-chain component needs frequent
interactions with its backend network for e.g., acquiring chain
states ormakingnewtransactions. Therefore,Ethereumnodes of-
fer remote procedure call (RPC) services [ 15] and expose a set of
RPCmethodsthatthefrontendcanrelyon.Meanwhile,thereare
anumberofdiﬀerentimplementationsofEthereumnodesindif-
ferent programming languages. According to the oﬃcial Ethereum
page [16]:
1333
ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA ShinhaeKim andSungjae Hwang
“This makes the network stronger and more diverse.
Theidealgoalistoachievediversitywithoutanyclient
dominatingto reduce any singlepointsoffailure.”
To enable uniform RPC services among nodes, the Ethereum
Foundation de/f_ines an oﬃcial speci/f_ication [ 12] that their RPC
method implementations should comply to. The speci/f_ication has a
briefdescriptionofeachmethodandde/f_inesregularexpressions
for valid arguments and return values. However, the speci/f_ication is
not suﬃcient in two points. First, it has no clari/f_ication on expected
behaviorsincaseofnon-deterministicchainevents.Forexample,
whilethere wasaquestioninEthereumMagiciansforum[ 38]:
“What’stheexpectedbehaviorof eth_getLogs iftheblock-
Hashdoesnot correspondtoanyblock?This isnotjust
atheoreticalconsideration,sincechainreorganizations
mightcause ablockHash to nolonger be valid.”,
thequestionercon/f_irmedthatsomeimplementationsreturn -32000
error code with an “unknown block” message, while others sim-
ply return an empty array. Second, the speci/f_ication does not state
anything on return values in case of invalid arguments such as
values out of the allowed ranges. While there was an attempt to
standardize error codes among nodes [ 2], the proposal has been
stagnant formore thanthree years.It canbe problematicif nodes
behavediﬀerentlyasatleast63%ofDAppsrelyonthird-partynode
providers[ 40]thatmaintainapoolofvarioustypesofnodesand
seamlesslyservewithadiﬀerentonebasedonblack-boxloadbal-
ancers[27].Forexample,abugreportinInfura,themostdominant
node provider, showcases that a user unconsciously experienced
inconsistent results when they queried the latest block number [ 5].
ToeﬀectivelyinvestigateanydeviationsintermsofRPCservices,
thispaperpresents the/f_irstsyntax-andsemantics-aware diﬀerential
testing approach. Also, we implemented EtherDiffer that applies
our approach to four diﬀerent node implementations that together
takeupapproximately99.7%ofthemainEthereumnetwork[ 19].
Tofacilitatebetterunderstanding,wede/f_ineafewtermsasfollows:
De/f_inition1 (Non-deterministicChain ).Ifagenerationmechanism
producesadiﬀerent chaineverytime,thestateofwhichisunpre-
dictable,the resultingchain iscallednon-deterministic.
De/f_inition 2 (Semantically-Validness ).Atest caseis semantically-
valid if allmethodcallarguments matchthe expectedsemantics.
De/f_inition3 (Semantically-Invalidness ).Atestcaseissemantically-
invalidif any argument disconformsto the expectedsemantics.
Particularly, this research overcomes three technical challenges:
1) the generation of semantically-valid test cases, 2) the genera-
tion of semantically-invalid-yet-executable test cases, and 3) the
enforcementofchainstateconsistencyamongnodespriortotest
case executions. EtherDiffer /f_irst constructs a local network that
consists of four nodes, each from a diﬀerent implementation, as
well as auxiliary nodes for chain evolution. Then, it generates a
non-deterministic chain by making multiple-and-concurrent trans-
actionsthatactivelyproduceeventlogsandstatechanges.Also,we
made minimum instrumentation on the nodes to mimic real-world
propagationdelay andtrigger non-deterministic chain events.
Ontopofthegeneratedchain, EtherDiffer overcomesthe/f_irst
twochallengesbyourkeytechniques:property-basedgenerationandtype-preservingmutation.We/f_irstde/f_inedadomain-speci/f_ic
language(DSL)thatcapturesthetypeandsemanticrequirement,
whichwecall“property,”foreachmethodargument.Then,wecon-
vertedthespeci/f_icationofRPC-triggeringmethodsintoourDSL,
which we denote as specDSL. Based on specDSL,EtherDiffer gener-
atessemantically-validtemplatecodewhereallargumentssatisfy
their properties. The template code is yet another valid test case
but not boundto a speci/f_ic RPC-servingnode.Also, EtherDiffer
stochasticallymutatesoneoftheargumentstoturnthetemplate
codesemantically-invalid,whilepreservingtheexecutability.Then,
itproducesasetoffourtestcasesbybindingthetemplatecodewith
eachtarget node andcross-checkstheir executionreturn values.
Thelastchallengeistoenforcethechainstateconsistencyamong
nodeswhenexecutingtestcasesasitsinconsistencycanleadtofalse
alarms.EtherDiffer implements a two-phase architecture: gener-
ation and testing phase. During the generation phase, the auxiliary
nodes operate to evolve the chain. Then, once the chain reaches
thecon/f_iguredheight, theiroperationsstopand EtherDiffer be-
gins its testing phase after all target nodes are synced. Also, we
implemented a save-and-restore strategy asa transaction-sending
testcasechangestheoriginalchainstate.Theevaluationshowed
that our techniques generated both semantically-valid and invalid-
yet-executabletestcaseswiththesuccessratiosof98.8%and95.4%,
respectively.Also, EtherDiffer detected48deviationclassesin-
cluding11implementationbugssuchascrashanddenial-of-service
bugs. We reported 44 of the detected classes and received acknowl-
edgements for our research /f_indings as well as bug patches. Lastly,
EtherDiffer signi/f_icantly outperformed the oﬃcial testing tool
for Ethereumnodes inevery technical aspect.
In short, the contributionsof this paper are the followings:
•We present an approach that generates semantically-
valid test cases based on a speci/f_ication. Also, we pre-
sent a mutation strategy to produce invalid test cases
while preservingthe executability. Ourapproachescan
be appliedinotherdomainsas well if speci/f_ications exist.
•Wepresent EtherDiffer thatautomaticallyreportsde-
viationsamongfourEthereumnodeimplementations
that take up 99.7% of the mainnet. EtherDiffer found
48 classes of deviations, which include 11 implementation
bugs.WebelieveitcancontributetothestabilityofDApp
ecosystem andpubliclyopenedthe toolimplementation.1
2 BACKGROUND
In this section, we explore the concepts highly related to our re-
search.We /f_irst explain thetwofactors thatmake blockchain non-
deterministic. Then, we present the architecture of typical DApps
aswellasthenecessityofusingJavaScriptlibrariesindevelopment.
2.1 Blockchain Non-determinism
Blockchain is technically a growing list of blocks, and speci/f_ically-
con/f_igurednodescalledminerscreatethem.However,asblockchain
operatesonalargeuserbase,multipletransactionsconcurrently
resideonthenetwork,anditisupontheminer’sdecisionwhich
andhowmanytransactionstoincludeinablock.Therefore,itis
1[Linkfor EtherDiffer ] https://github.com/JosephK95/EtherDiﬀer-public
1334EtherDiﬀer: DiﬀerentialTestingonRPCServicesof Ethereum Nodes ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA
Figure 1:OverallArchitecture of EtherDiffer
Figure 2:Architecture ofERC20 Decentralized Application
completely non-deterministic which transactions a new block will
consistof.Also,theinclusionofdiﬀerenttransactionsleadstodiﬀer-
ent elements in other block /f_ields as well. For example, blocks con-
tain event logs emitted from smart contract executions. Therefore,
onlythelogsfromchosencontracttransactionsbecomepartofthe
blocks.Anotherkeyfactorthatmakesblockchainnon-deterministic
is propagation delay. Ethereum has become a signi/f_icantly large
network with 5,649 nodes [ 19]. While each node propagates the
new block to its peers once received, a time diﬀerence in block
reception is inevitable. Therefore, the chain can have two blocks
with the same parent when a diﬀerent miner created another block
beforeperceivingtheexistenceofanewblock.Sucheventiscalled
“temporalfork,”andthechainevolveswitheitheroneoftheblocks,leading to “chain reorganization.” The left-over blocks drop oﬀ the
canonical chain and become orphaned. However, their headers can
be still part of the canonical chain as “uncles” if subsequent miners
include themintheirblocksundercreation.
TheMerge. Sincetheinitiallaunchin2015,Ethereumhasadopted
proof-of-work (PoW) consensus mechanism [ 18] where miners for-
mulateblocksbysolvingcryptographicpuzzles.Recently,Ethereum
switched to proof-of-stake (PoS) consensus mechanism [ 17] where
block proposers and validators participate in block formulation
by staking their Ether balances. However, the non-deterministic
factors remain exactly the same except that uncles no longer exist.
2.2 Ethereum DAppsandJavaScriptLibraries
Adecentralizedapplicationconsistsofanuser-interfacingfrontend
andbackendsmartcontracts.About75%ofDAppshaveweb-based
frontendsimplementedin JavaScript[ 40],andthe frontendsneed
frequent interactions with the backend network. However, as they
are oﬀ-chain, Ethereum nodes serve as a bridge to the network
by exposing a set of RPC methods. For example, the user inter-
face of a crowdfunding DApp can display the pledge history by
making an eth_getLogs method call. Also, the frontend can update
thechainstatebycalling eth_sendTransaction methoduponanew
user pledge. However, interacting directly with nodes is not practi-
calfortworeasons.First,itiscumbersometomakesyntactically-
validmethodcallsasalotofmethodshaveerror-proneparameters
such as 20 bytes-encoding hexadecimal addresses or an array of
32 bytes-encoding hexadecimal strings. Also, more importantly,
nodes have no support of event noti/f_ications. As blockchain has
non-deterministiccharacteristics,itisunpredictablewhenanew
transactionwillbeminedandcon/f_irmed.Userswouldhavetomake
numerous repetitions of method calls to track their transactions.
Therefore,DAppsleverageEthereumJavaScriptlibrariesthatare
simplewrappersofRPCmethodsbutsupportinputformattersto
/f_ilteroutmiss-typedargumentsandcallback-basedeventnoti/f_ica-
tions. Figure 2shows an example ERC20 decentralized application.
1335ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA ShinhaeKim andSungjae Hwang
Thefrontend/f_irstacquirestwotypesofinformationby getAccounts
andgetTransactionCount librarymethodsatline5and6:anaddress
which it has ownership of and the number of transactions made by
theaddresscallednonce.Then,itsendsamintingtransactiontoits
backendERC20smartcontractby sendmethod,whichresolveswith
the transactionreceipt oncemined successfully. The nonce should
be incremented by one after each transaction, and invalid nonce
values can leadto variousunexpectedresults includingtransaction
rejection orlong-term pending[ 20].However,asmentionedear-
lier,userscanunconsciouslyexperienceRPCservicefromdiﬀerent
nodes.Therefore,itcan becrucialifany nodereturnsa deviated
noncevaluefor the getTransactionCount methodcall.
3 METHODOLOGY
To eﬀectively investigate the deviations of RPC service, we im-
plemented EtherDiffer thatautomaticallyperformsdiﬀerential
testingonfourEthereumnodeimplementations.Inthissection,we
/f_irst explain the overall architecture of EtherDiffer and how it
generates non-deterministic chains. Then,we present our domain-
speci/f_ic language as well as two key techniques to generate test
casesbasedonthe speci/f_ication convertedintoour DSL.
3.1 Overview
EtherDiffer /f_irst constructs a local network that consists of four
nodes, each from a diﬀerent implementation, as well as mining
nodes for chain evolution. The network is con/f_igured to activate
allmainnet features except theonlydiﬀerencethat it adoptsPoW
mechanismforblockcreation.However,thediﬀerencehasnoim-
pact on outcomes as the testing proceeds only after a consensus is
reached. Figure 1shows the overall architecture upon the network
construction. EtherDiffer begins the generation phase where the
network generates a non-deterministic chain (sec. 3.2). Once the
chainreachesthecon/f_iguredheight, EtherDiffer switchesover
to the testing phase where it generates test cases and cross-checks
their execution results. For the test case generation, EtherDiffer
leverages web3.js, the oﬃcial Ethereum JavaScript library [ 3]. Par-
ticularly,wede/f_inedadomain-speci/f_iclanguagethatcapturesthe
syntactic and semantic requirements for method arguments (sec.
3.3) and converted the library speci/f_ication into our DSL, which
we denote as specDSL.EtherDiffer /f_irst selects a method from
specDSL,andGenerator producessemantically-validtemplatecode
where all arguments satisfy their requirements (sec. 3.4). In ad-
dition,Mutatorstochastically changes one of the arguments to a
semantically-invalidvaluewhilepreservingitstype(sec. 3.5).Lastly,
Test Case Converter instantiates a set of four test cases by binding
thetemplatecode witheachtargetnode.Oncethe executionsare
completed, Error Checker reports if only a subset of nodes throw
errorswhiletheothersreturnvalues,and ValueChecker reportsif
theirreturnvaluesarenotconsistenttooneanother.Thetestcases
are wrapped with try-catchstatements to property identify errors
whilepreservingthe executionsof EtherDiffer .
3.2 Non-deterministicChain Generation
Asexplainedinsection 2.1,thetwofactorsthatmakeblockchain
non-deterministic are multiple-and-concurrent transactions and/u1D460:=typedef /u1D461/u1D461<:/u1D461propdef /u1D45D/u1D451
/u1D461:=/u1D461/u1D45D| {[opt]?/u1D458:/u1D461} |t_Array(/u1D461) |/u1D461∪/u1D461
/u1D45D:=/u1D45D/u1D460|/u1D45D/u1D451| {[opt]?/u1D458:/u1D45D} |p_Array(/u1D45D) |/u1D45D∪/u1D45D
/u1D451:=/u1D461 /u1D440([opt]?/u1D461/parallelshort/u1D45D[∨/u1D461/parallelshort/u1D45D]?) |/u1D461 /u1D450./u1D440(/u1D461/parallelshort/u1D45D)
/u1D450:=/u1D436./u1D439</u1D463s,/u1D463v>(/u1D463/u1D44E)
Figure 3:Syntax ofour Domain-Speci/f_icLanguage
propagation delay. Likewise, EtherDiffer applies the factors to
its local network andgeneratesanon-deterministic chain.
Multiple-and-Concurrent Transactions. EtherDiffer deploys ap-
plications, each of which consists of one or two smart contracts
thattogetherprovideaservice.Weleveragedtheapplicationsfrom
SoliditybyExample[ 10],awell-knowndatabasethatcoversawide
range of real-world applications. We /f_iltered those out that only
containsimplelogicsuchasproxiesandleveragedtheremaining
12 applications. Upon their deployments, EtherDiffer operates
auxiliary nodesthat repeatedly and concurrentlysend transactions
to the contracts. Particularly, each node is dedicated to a single
applicationtomaximizethenumberofavailabletransactionsata
time.Also,wede/f_inedtransactionsequencesforeachapplication
that guarantee the execution completion while actively triggering
logemissionsandstatechanges.Intotal, EtherDiffer generatesa
chain basedon33 sequencesconsistedof 109valid transactions.
Propagation Delay. To further induce non-determinism in our
chain, e.g.,presenceoftemporalforks,there shouldbetimedelay
in block propagations among nodes. In other words, mining nodes
should create another block before perceiving the existence of a
new block. To trigger such occasions, we instrumented the mining
nodestodelaytheirblockpropagationswithintheperiodofablock
creation time multiplied by six. This re/f_lects the policy that mining
nodescanincludeuncleheadersthatareuptosix-generationsapart
from theirblocksundercreation.
3.3 Domain-Speci/f_ic Language
For test case generation, EtherDiffer leverages the oﬃcial Ether-
eum JavaScript library, web3.js. To automate the processing of the
libraryspeci/f_ication,wede/f_inedadomain-speci/f_iclanguagethat
captures the types and semantic requirements for method argu-
ments.Figure 3showsthesyntaxofourDSL.Thespeci/f_ication /u1D460
consists of type de/f_initions, subtype relations, property de/f_initions,
andmethoddeclarations.Atype /u1D461canbeoneoftheprimitivetypes
/u1D461/u1D45D, an object type{[opt]?/u1D458:/u1D461}, an array type, or a union of two
types.The primitivetypes notonlyincludebasicJavaScripttypes
liket_Number andt_String, but also more constrained types like
t_Address andt_Hex32.Anobjecttype{[opt]?/u1D458:/u1D461}isacollection
of key-type pairs, some of which can be optional. Also, the DSL
capturessubtyperelationsbetweentypes( /u1D461<:/u1D461).Aproperty /u1D45Disa
semantic requirement that an argument should satisfy. A primitive
propertyiseithera“static”property /u1D45D/u1D460ora“dynamic”property /u1D45D/u1D451,
depending on whether its value generation relies on other method
calls. For example, the properties p_Gasandp_Valueare static as
1336EtherDiﬀer: DiﬀerentialTestingonRPCServicesof Ethereum Nodes ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA
Figure 4:Example CodeGenerationBased on Speci/f_ication inDSL
userscandesignatevaluesastheywantwhensendingtransactions.
On the other hand, a dynamic property p_Nonce@(p_EOA) needs the
returnvalueof getTransactionCount methodcallwithitsassociated
addressas/f_irstargument.Anobjectproperty {[opt]?/u1D458:/u1D45D}de/f_ines
the requirement for an object type argument, where each key /u1D458
shouldsatisfytheproperty /u1D45Difexists.Tosystematicallyderiveprop-
erty de/f_initions, we /f_irst extracted all existing parameters and clus-
teredthosethat accept the same type of argumentsbased ontheir
descriptions. Also, in case of any ambiguity, we referred to the oﬃ-
cial Ethereumpage for further clari/f_ication. A method declaration
/u1D451either declares a standard method ( /u1D461 /u1D440([opt]?/u1D461/parallelshort/u1D45D[∨/u1D461/parallelshort/u1D45D]?))
oracontract-interactionmethod( /u1D461 /u1D450./u1D440(/u1D461/parallelshort/u1D45D)).Astandardmethod
isasimplewrapperofanode-exposingRPCmethodwithone-to-
one correspondence. A contract-interaction method is yet another
wrapperbutfacilitatesRPCmethodcallstointeractwithsmartcon-
tracts. A declaration speci/f_ies the type and property ( /u1D461/parallelshort/u1D45D) of each
parameteraswellasitsreturntype.Particularly,standardmethods
havezeroormoreparameters,eachofwhichcanbeoptional,while
contract-interaction methods have a single parameter. Also, the
parametersinstandard methodscan be disjunctive to allow diﬀer-
ent types of arguments. Figure 4-(a) shows the declarations of two
methods,whichwewillrefertothroughoutthissection.Theup-
per method hastwo parameters of a block and a transaction index
and returns the corresponding transaction in the block. The lower
method retrieves a history of transaction fees in the maximum
1024blocksbackwardsfromthesecondparameter block.Forevery
block, it sorts the fee values in ascending order and returns the
percentiles speci/f_ied by the third parameter. A contract transaction
/u1D450isapre/f_ixforcontract-interactionmethodsandcorrespondsto
calling the member function /u1D439in contract /u1D436with arguments /u1D463/u1D44E.
The subscriptedvalues /u1D463/u1D460and/u1D463/u1D463represent transaction-level argu-
ments,msg.sender andmsg.value , respectively. In total, we de/f_ined
32 types, 6 subtype relations, 31 properties, and 31 method declara-
tions.Also,asthetestingproceedsinthesamelocalnetwork,we
leveragedthe 109transactionsfrom the generationphaseas well.
3.4 Property-BasedTemplateCodeGeneration
EtherDiffer selectsatargetmethodfrom specDSL,andGenerator
generates semantically-valid template code based on the GenTC
functioninAlgorithm 1.ThetemplatecodeisvalidJavaScriptcode
but not bound to any RPC-serving node yet. For each property
of the selected method (Line 3), Generator /f_irst “instantiates” theAlgorithm1: TemplateCode Generation
Input : Selected method in DSL( /u1D451)
Output : Generated template code( stmts)
1function GenTC(/u1D451)
2stmts←[], args←[]
3for/u1D45Din/u1D451.props() do
4 /u1D45D←InstProp( /u1D45D)
5 stmts,arg←GenArg(stmts,/u1D45D)
6 args.push(arg)
7stmts←GenCall( stmts,/u1D451,args)
8returnstmts
Algorithm2: Type-PreservingMutation
Input : Templatecode( stmts)
Output : Mutated template code( stmts′)
1function MutateTC( stmts)
2call←stmts.pop()
3arg←SelectArg( call)
4/u1D45D←PropLookUp( arg)
5stmts,arg′←GenArg(stmts,/u1D45D)
6stmts′←AppendNewCall( stmts,call,arg,arg′)
7returnstmts′
property if necessary (Line 4). Then, it generates a valid argument
by applying diﬀerent approaches depending on property types
(Line 5). Lastly, Generator produces a target method call with the
generatedarguments (Line 7).
PropertyInstantiation. Thereexistseveralpropertiesthatshould
beassociatedwithspeci/f_icaccountsandothers.Forexample,when
sending transactions, nonce parameter should receive the transac-
tion count of the sender account. Therefore, once a sender address
is generated, Generator instantiates the nonce property with the
address. Another example is the transaction index parameter of
getTransactionFromBlock in Figure 4-(a). As it is associated with
the /f_irst parameter block, Generator instantiates the index property
uponthe generationofablockargument.
Static Property. A primitive property, which captures the seman-
tics of a primitive type parameter, is “static” if its value genera-
tion is possible without method calls. Static properties in most
1337ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA ShinhaeKim andSungjae Hwang
Table 1:Success Ratios ofValid andInvalidTest Case Executions
Test
CasesGeneratedPropertiesTotalTest
CasesMutatedTypesTotalStatic Dynamic Object Array Union Primitive Object Array Union
2,9651,431 1,275 965 279 150 4,110
 2,863 1,435 819 - 609 2,863
(98.8%)(98.8%) (98.8 %) (97.6 %) (99.6%) (99.3%) (98.6%) (95.4 %)(99.4%) (86.8 %) (0%) (99.3 %) (95.4%)
3517 15 24 1 1 58
 137 8 125 - 4 137
(1.2%)(1.2%) (1.2 %) (2.4 %) (0.4%) (0.7%) (1.4%) (4.6 %)(0.6%) (13.2 %) (0%) (0.7%) (4.6%)
3,0001,448 1,290 989 280 151 4,168 3,000 1,443 944 - 613 3,000
(a) ValidTest Cases (Error ?No:
 ,Yes:
) (b) Invalid Test Cases (Lib.Error ?No:
 ,Yes:
)
casescapturetheuser-assigningtransactionparametersbutalso
otherparameterswhosevaluescanbestaticallygeneratedbased
on their descriptions, e.g., a random integer in the speci/f_ied range
forp_Range(1,1024) .Wede/f_ineda Property-Generator foreachstatic
property, which Generator leverages in case of a static property
parameter. For non-trivialcases like user-assigning values, we de-
signedthe Property-Generator toreturnoneofthevaluesusedinthe
speci/f_icationcodesnippetsasarbitraryvaluegenerationcanleadto
executionfailureslikeout-of-gaserrors.Figure 4-(b)showsanexam-
pleofsemantically-validtemplatecodeinasimpli/f_iedformat. Gener-
atorproduced “latest” for the /f_irst parameter as Property-Generator
ofp_BlockNumber can return one ofthe pre-de/f_inedstrings.
Dynamic Property. A primitive property is “dynamic” if its value
generation relies on method calls. Dynamic properties capture the
parametersthatreceivechain-storedvaluessuchastransactionand
block hashes. Therefore, it is necessary to make method calls at
runtimetoacquireavalidpropertyvalue.Also,itisoftenthatmeth-
ods should be called with certain arguments and/or postprocess
their return values. Therefore, we made a Mapping Table for each
dynamicpropertywhereeachentrycontainsamethodname,/f_ixed
arguments ifnecessary,and post/f_ixesthatreturna validproperty
valuewhenappendedtothereturnvalue. Generator selectsoneof
the entries and chains with the method call result to generate a
dynamic property argument. In Figure 4-(b), the index property
was/f_irstinstantiatedto p_TxIdx@“latest” uponthegenerationof
aa0.Then,Generator lookedupthe MappingTable inFigure 4-(c)and
made agetBlock method call with the associated “latest” value
(denoted as @_) andfalseto acquire the block without transaction
details.Lastly,it accessedthetransactionattributeandreturned a
valid index byapplyingthe helper indexmethod.
Compound Property. Aside from primitive properties, there exist
a number of object properties that capture object type parameters
such as transactions and log /f_ilters. Generator recursively generates
a value for each object /f_ield following the above approaches and
merges into an object. An array property captures an array type
parameter, and Generator recursively generates values based on its
base propertyand formsthem into anarray. For aunionproperty,
itrandomly selectsone ofthe propertiesandgeneratesits value.
3.5 Type-PreservingMutation
To investigate any deviations against semantically-invalid argu-
ments as well, Mutatorstochastically turns the generated templatecodeintosemantically-invalidcode.While EtherDiffer enables
userstocon/f_igurethemutationprobability,itissetto50%bydefault.
The mutation is based on the MutateTC function in Algorithm 2
and satis/f_ies two characteristics: single-argument mutation and
typepreservation.Toeﬀectivelyexamineonepropertyatatime,
Mutatorrandomlyselectsasingleargumentinthetargetmethod
call (Line 3). In case of compound type arguments, it selects one of
the object /f_ields or arrayelements. Also, it is essential to preserve
the argument type as the library /f_ilters out miss-typed arguments
and does not make RPC method calls in such cases. Therefore, Mu-
tatorlooksupa propertyfrom specDSLthathasthesametypewith
but not equivalent to the original argument property (Line 4). It
also takes subtype relations into account during property selec-
tion. Then, Mutatorgenerates a valid argument for the selected
property(Line5)andappendsthenewmethodcall,argumentof
which is replaced with the generated value (Line 6). This approach
ensuresbothsemantically-invalidnessandexecutabilityasitmakes
use of an unintended property with a compatible type. Figure 4-
(d) presents the mutated code from the template code. Mutator
selected p_Range(1,1024) and replaced the original index with a
semantically-invalid integer value while preserving t_Number. Fi-
nally,Test Case Converter instantiates a set of four test cases from
possibly-mutatedtemplatecode,and ErrorChecker andValueChecker
report incaseofrespective deviations.
4 EVALUATION
EtherDiffer examinesthedeviationsamongfourmajorEthereum
nodesthattakeup99.7%ofthemainnetwork.Particularly,wechose
theirmostrecentstableversionsbythetimeofevaluationasour
targets: Geth v1.10.21-stable, Erigon 2022.07.04-alpha, Nethermind
v1.13.6,andHyperledgerBesuv22.4.4.Toevaluatetheeﬀectiveness
ofourtechniquesanddiscloseanydeviations,wesetupthefollow-
ingresearchquestions.Also,wecompare EtherDiffer withthe
oﬃcial node testingtoolmaintainedbythe EthereumFoundation.
•RQ1(EﬀectivenessofTestCaseGeneration): Howmuch
do the semantically-valid test cases complete their execu-
tionswithouterrors?Also,howmuchdosemantically-invalid
testcasespreservetheirexecutabilitywithoutlibraryerrors?
•RQ2 (Deviation and Bug Detection Capability): How
manydeviationsandbugshas EtherDiffer detected?
•RQ3(ComparisonwiththeOﬃcialTool): Howeﬀective
isEtherDiffer comparedtotheoﬃcialtestingtoolfornode
implementations?
1338EtherDiﬀer: DiﬀerentialTestingonRPCServicesof Ethereum Nodes ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA
Table 2:Overview ofAll DeviationClassesFoundby EtherDiffer
Category DeviationClass Report RCCategory DeviationClass Report RC
Invalid
Argument
Handling
(sec.4.2.1)(IAH-1)Numberof TransactionsinInvalidBlock ✓S∗‡
Uncle
Access
(sec.4.2.3)(UA-1)Block Structure that MatchesUncleHash ✓S∗†‡
(IAH-2)PastEvent Logs inInvalidBlock ✓S∗‡ (UA-2)UncleatCertainIndex inUncleBlock ✓S∗†‡
(IAH-3)TransactionatCertainIndex inInvalidBlock ✓S∗‡ (UA-3)TransactionatCertainIndex inUncleBlock ✓S∗†‡
(IAH-4)Numberof UnclesinInvalidBlock ✓S∗‡ (UA-4)Numberof UnclesinUncleBlock ✓S∗†‡
(IAH-5)UncleatCertainIndex inInvalidBlock ✓S∗†‡ (UA-5)Numberof TransactionsinUncleBlock ✓S∗†‡
(IAH-6)Codeof Speci/f_ic Contract inInvalidBlock ✓S∗‡
Method
Support
(sec.4.2.4)(MS-1)No Method forPendingTransactionList ✓[E∗,B]‡
(IAH-7)Balance of Speci/f_ic Address inInvalidBlock ✓S∗‡ (MS-2)No Method forAccount StateStructures ✓E∗
(IAH-8)Nonce of Speci/f_ic Account inInvalidBlock ✓S∗‡ (MS-3)No Method forListof Account Addresses ✓E‡
(IAH-9)Storage of Speci/f_ic Contract inInvalidBlock ✓S∗‡ (MS-4)No Method forCurrent Protocol Version ✓G‡
(IAH-10) Account StateStructure of Unknown Account ✓S∗‡
Fields
and
Formats
(sec.4.2.5)(FF-1)Field Diﬀerence inUncleBlock Structures ✓[G,E∗]†‡
(IAH-11) PastEvent Logs inWrongBlock Range ✓S∗‡ (FF-2)Field Diﬀerence inEvent LogStructures (AD)†‡
(IAH-12) TransactionFee HistoryinWrongBlock Range ✓S∗‡ (FF-3)Field Diﬀerence inCanonicalBlock Structures (AD)‡
(IAH-13) TransactioninBlock atInvalidIndex ✓S∗‡ (FF-4)Field Diﬀerence inReceipt Structures (AD)
(IAH-14) UncleinBlock atInvalidIndex ✓S∗‡ (FF-5)Field Diﬀerence inTransactionStructures ✓B∗‡
Gas
Estimation
and
Local
Execution
(sec.4.2.2)(GL-1)ImproperMax Fee ParameterforGasEstimation ✓S∗‡ (FF-6)Format Inconsistency inContract Storage Keys ✓B∗‡
(GL-2)Low GasLimitParameterforGasEstimation ✓S‡ (FF-7)Format Inconsistency inStorage Slot Values (AD)‡
(GL-3)HighGasLimitParameterforGasEstimation ✓S∗‡
Imple-
mentation
Bugs
(sec.4.2.6)(IB-1)InvalidTotal DiﬃcultyinUncleHeaders ✓[G,N∗,B]†‡
(GL-4)InvalidTransactionType forGasEstimation ✓S∗‡ (IB-2)WrongValues inAccount StateStructures ✓N∗‡
(GL-5)InvalidAccount Nonce forGasEstimation ✓S∗‡ (IB-3)WrongLogIndex inEvent LogStructures ✓B∗†‡
(GL-6)InsuﬃcientFunds inAccount forGasEstimation ✓S∗‡ (IB-4)WrongLogIdenti/f_ier inEvent LogStructures ✓B∗†‡
(GL-7)ImproperMax Fee ParameterforLocalExecution ✓S∗‡ (IB-5)WrongTransactionFee HistoryinBlock Range ✓B∗‡
(GL-8)Low GasLimitParameterforLocalExecution ✓S∗‡ (IB-6)WrongGasEstimationforContract Executions ✓[N∗,B∗]
(GL-9)InvalidTransactionType forLocalExecution ✓S∗‡ (IB-7)Crash Bug whileRetrieving PastEvent Logs ✓E∗†‡
(GL-10)InvalidAccount Nonce forLocalExecution ✓S∗‡ (IB-8)DoSwhileRetrieving PastEvent Logs ✓B∗†‡
✓S:Speci/f_ication✓G:Geth✓E:Erigon✓N:Nethermind✓B:Besu
✓[..]:MultipleNodes (AD):AcceptableDeviation ∗:Con/f_irmed or Patched†:DetectionFailure of rpc-compat Due to Chain Generation(sec. 4.3.1)
‡:DetectionFailure of rpc-compat Due to Test CaseGeneration(sec. 4.3.2)
Table 3:Overview ofErrorHandlingandUncle Access DeviationsofNodeImplementations
IAH-1 IAH-2 IAH-3 IAH-4 IAH-5 IAH-6 IAH-7 IAH-8 IAH-9 IAH-10 IAH-11 IAH-12 IAH-13 IAH-14
•Geth null [] null null null Error Error Error Error Val acc [] Valfee null null
•Erig. null [] null null null Valcode*Error Error Error -** Error Val fee null null
•Neth. Error Error Error Error Error Error Error Error Error Val accError Error Error Error
•Besu null [] null null null Error*null 0null Error [] Error null null
GL-1 GL-2 GL-3 GL-4 GL-5 GL-6 GL-7 GL-8 GL-9 GL-10 UA-1 UA-2 UA-3 UA-4 UA-5
Error Val gasValgasValgasValgasValgasError Error Val callValcallValblockValblock null ValnumValnum
Error Val gasError Val gasValgasError Error Val callValcallValcallError null Error null null
ValgasError Val gasError Error Val gasValcallValcallError Error null Error Error Error Error
ValgasValgasValgasValgasValgasValgasError Error Val callValcallValblockValblock ValtxValnumValnum
*: ErigonandBesucanreturn Errorandnullrespectively, depending on the argument. **:Erigondoesnotsupport the method. (see MS-2)
4.1 Eﬀectiveness ofTestCaseGeneration
4.1.1 Semantically-ValidTestCases. EtherDiffer leveragesour
property-based technique to generate semantically-valid test cases.
To evaluate its eﬀectiveness, we generated 3,000 valid test cases
and checked whether they successfully completed executions with-
out any errors. Table 1-(a) shows the result as well as the num-
bers of generated properties in corresponding test cases. The re-
sultcon/f_irmstheeﬀectivenessofourtechniqueas2,965validtest
cases completed their executions and 4,110 out of the total 4,168
properties belonged to the execution-completed ones. This ensures
thatourtechniquegeneratesasemantically-validargumentwith
98.6%con/f_idenceorevenhigherassomeoftheargumentsinthe
execution-failedtestcasescanbestillvalid.Wemanuallyinvesti-
gatedthe35failedtestcasesandcon/f_irmedthateachargumentwasyetsemantically-validbutresultedinerrorswhencombinedinmost
cases.Forexample, getPastLogs methodreceivestwoblocknumber
arguments that together specify a block range to retrieve event
logs from. While EtherDiffer succeeded at generating a valid
argumentforeachblocknumber,therewereoccasionswhenthe
startingnumberwasgreaterthantheendingnumber,producinger-
rors.Webelievethatourfutureworktoaddsemanticrequirements
inargument combinations can eliminatethe errors.
4.1.2 Semantically-Invalid Test Cases. EtherDiffer applies our
type-preserving mutation strategy to convert semantically-valid
test cases into invalid ones. To evaluate its eﬀectiveness, we per-
formed mutations on 3,000 valid test cases and checked whether
the invalid test cases did not trigger library errors and returned
1339ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA ShinhaeKim andSungjae Hwang
resultsincludingnode-producederrors.Table 1-(b)showstheresult
aswellasthemutatedtypesincorrespondingtestcases.Theresult
con/f_irms that our mutation technique eﬀectively preserves the exe-
cutabilitywith95.4%con/f_idenceas2,863invalidtestcasesproduced
nolibraryerrors.Onethingtonoteisthattherewerenomutations
for arrays as each array type consists of a single property and thus
hasnomutationcandidate.Wemanuallyinvestigatedthe137failed
test cases and con/f_irmed that while each mutation successfully
preserved the type, they mostly failed as the library performs addi-
tionalchecksontransactionobjectargumentstoreducetransaction
failures.Forexample,themajorityofcasesoccurredasthemutated
gas value was smaller than the minimum required gas. We believe
that a more sophisticated mutation approach based on intersecting
withthe originalproperty can further improve the eﬀectiveness.
4.2 Deviation andBug DetectionCapability
TodetectanydeviationsamongEthereumnodeimplementations,
weconducted10iterationsof EtherDiffer .Particularly,wecon-
/f_iguredeachiterationtogeneratea300-heightnon-deterministic
chainand600testcasesetswiththedefaultmutationprobability.
In total, our diﬀerential testing was based on 6,000 test case sets
consisting of 24,000 test cases, and EtherDiffer detected error
deviations and value deviations in 1,536 and 1,693 test case sets,
respectively. We randomly selected 300 error-deviating and 300
value-deviatingsetsformanualinvestigationandcon/f_irmedthat
only11deviatingsetswerefalsepositives,accountingfor1.8%of
thetotal.Thefalsepositiveswerederivedfromthedeviationsas
well, as the node implementations returned diﬀerent values during
theprocessofdynamicpropertygeneration.Fortheremainingtrue
positives,weclusteredthemintosixmajorcategoriesand48diﬀer-
entclassesasshowninTable 2.Weanalyzedeachclassfurtherand
reported44deviationclassestoeitherRPCspeci/f_icationdevelopers
ornode developers basedonthe following criteria:
•(ReporttoSpeci/f_ication:29DeviationClasses)Thedeviation
class was caused by the lack of clear speci/f_ication such as
errorhandling anduncle access.
•(Report to Node Developers: 15 Deviation Classes) The devi-
ation class was caused by node implementations that either
disconformto the speci/f_ication orhave bugs.
Wedidnotmakereportsfortheremainingfourclassesasthey
correspondtosimplyde/f_iningadditional/f_ieldsindatastructures.
For the rest of this section, we brie/f_ly explain each of the deviation
categoriesfoundby EtherDiffer .
4.2.1 Invalid Argument Handling. EtherDiffer detected 14 devia-
tion classes in terms of handling invalid arguments of RPC method
calls. The classes can be grouped into four sub-categories based
ontheargumenttypes:(1)invalidblocks,(2)unknownaccounts,
(3) wrong block ranges, and (4) invalidindices. While there exist
manyRPCmethodswithablockparameter, EtherDiffer found
that node implementations handle nine of the methods in diﬀerent
wayswhenagivenblockargumentisinvalid.Table 3showsthere-
turnvaluesfromeachimplementation.AsthecolumnsfromIAH-1
toIAH-9show,thereturnvaluesvaryintherangeofthefollowing:
null,[],anerror,orevenanormalvalue.Another/f_indingisthat
evenasingleimplementationhandlesthemethodsinconsistently.
For example, while Geth returns nullor[]for /f_ive of the methods,it just throws an error for the rest. Additionally, node implementa-
tions have divergent handling logic on /f_ive methods that receive
an account, a block range, or an index as an argument. When an
invalid argument is given, the range of possible return values is
the same as that of the invalid block case. Particularly, some imple-
mentations just return a normal account or transaction fee history
even if they do not actually exist. Although all the /f_ields are set
with zero, this can still leadto misconception ofDApp developers.
Finding1 :Ethereumnode implementations have divergent
handling logic oninvalid arguments.
Finding2 :Even a singlenode implementationhandleseach
methodin an inconsistent way.
4.2.2 Gas Estimation and Local Execution. The core component of
a decentralized application is its backend smart contracts which
implement the service logic. And as actual interactions with smart
contracts require transaction fees, the RPC interface oﬀers two
waysofinteractionswithoutfeesandenablesuserstovalidatetheir
transactionsinadvance:gasestimationandlocalcontractexecution.
However,whiletheinteractionrequiresanobjectargumentwith
various /f_ields designated, EtherDiffer found that each implemen-
tation performs validation on a very diﬀerent set of /f_ields. In other
words,whilesomeimplementationsreturnanerrorincaseofan
invalid/f_ield,theothersjustreturnanormalresult:anestimatedgas
value or a contract return value. The columns from GL-1 to GL-10
inTable3summarizethereturnvalueswheninvalid/f_ieldvalues
are given. As the results show, none of the implementations share
thesamesetof/f_ieldstovalidate.Forexample,whileGeththrowsan
erroragainstimproperfeeingasestimation,Nethermindthrowsan
error against low gas limit and invalid transaction type and nonce.
Also,asininvalidargumenthandling,evenasingleimplementa-
tiondoesnot validate/f_ields consistently.For example,whileGeth
has no validation on gas limit in gas estimation, it throws an error
against low gas limit in local execution. These deviations can be
problematic as DApp developers usually rely on the results and
make actual transactionswiththe same /f_ield values.
Finding3 :Ethereum nodeimplementationsvalidate diﬀerent
parameters in gasestimationandlocal execution.
4.2.3 UncleAccess. Asexplainedearlier,theRPCspeci/f_icationhas
no clari/f_ication with regard to non-deterministic event handling.
Whileuncleblocksareindicatorsofsuchoccurrences, EtherDiffer
found/f_ivedeviationclassesintermsofhandlingthem.Particularly,
node implementations returned deviated results when an uncle
hashispassedto/f_ivemethodsthatexpectablockhashargument.
The argument is still semantically-valid as an uncle hash is yet
anotherblockhash.However,asacanonicalchainonlyincludes
the headers of once-valid uncle blocks, the return values from
accessing their body elements are up to the node implementations.
The columns from UA-1 to UA-5 in Table 3show the return values
for each method, and the results show that the implementations
havediﬀerentlevelsofsupportfororiginaluncleblockdata:partial,
full, or none. While Geth supports most of the methods, it does
not provide access to the transactions existed in uncle blocks. Besu
fully supports uncle block access, and the other two nodes provide
nosupport byreturningeitheran erroror null.
1340EtherDiﬀer: DiﬀerentialTestingonRPCServicesof Ethereum Nodes ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA
Figure 5:Test Cases forCrash andDenial-of-Service Bugs
Finding 4 :Ethereum node implementationsprovidediﬀerent
levels ofsupport for originaluncleblockdata.
4.2.4 Method Support. The RPC speci/f_ication de/f_ines a uniform
setofmethodsthatEthereumnodesshouldimplement.However,
EtherDiffer found that the nodes have not implemented some
ofthemethods.Particularly,GethandBesuhavenosupportfora
singlemethod,andErigonlacksimplementationsforthreemethods
thatreturnapendingtransactionlistoraccountdata.Wecon/f_irmed
that thenodes have not clearly noted thenon-implementations in
theirdocumentationsexceptforonecase.Evenmore,wefounda
casewherethedocumentationspeci/f_iedalltherequiredinformation
to make a valid method call including example code snippets. This
can give false intuitions to DApp developers that their application
code isoperating inthe expectedmanner.
Finding5 :Ethereum nodeimplementationsdo not provide
consistent sets of RPC methods to users.
4.2.5 FieldsandFormats. EtherDiffer foundtwokindsofsyn-
tactic deviations:structure /f_ieldsandreturn valueformats. While
the implementations de/f_ine the core blockchain data structures
in their own programming languages, the structures consist of
slightly diﬀerent sets of /f_ields. Particularly, we found deviations in
/f_ivestructurede/f_initions:eventlogs,uncleblocks,canonicalblocks,
transactions, and receipts. For example, while Geth and Erigon do
notde/f_inetransactions/f_ieldforuncleblocks,NethermindandBesu
have the /f_ield with an empty array value. Also, only Besu does not
include type /f_ield for transactions. We analyzed the results and
reported those that disconform to the speci/f_ication. In addition,
while the RPC interface oﬀers two methods to access contract stor-
age,nodeimplementationsreturnitskeysandvaluesindiﬀerent
formatssuch as the length ofhexadecimal storagevalues.Finding6 :The de/f_initions of core data structures are slightly
diﬀerent in nodeimplementations.
Finding7 :Ethereumnodeimplementations return storage
keys andvaluesin inconsistent formats.
4.2.6 Implementation Bugs. The last category consists of eight
classesofimplementationbugs.Thetotaldiﬃculty/f_ieldinblock
headersstoresthevalueofaccumulatedminingworkuntiltheblock.
However,wefoundabugineachofthreenodeimplementations
that theyeitherproduced undefined or 0incaseofanuncleblock
header. Also, there was a bug in Nethermind that returned zero for
non-zerostoragevaluesandproofs.Besuhadthreeimplementation
bugs with regard to the handling of event logs and transaction fee
history. Particularly, Besu returned wrong values for log indices
and identi/f_iers at all times. Also, it returned arbitrary fee values
additionallywhenthenumberofrequestedblocksexceededthatof
available blocks. There existed two more bugs inNethermind and
Besu that they produced wrongly estimated gas values for contract
executions.Lastly,wefoundtwocriticalbugsinErigonandBesu
thateithercrashedthenodeorblockeditfromservingusers.When
a signi/f_icantly large value was used as the ending block number
foreventlog retrievals,a crashoccurredin the handlermethodof
Erigon, and Besu did not serve any subsequent RPC requests until
resolved with a timeout. Figure 5shows two example test cases
to trigger the bugs. The erigonfunction tries to acquire all event
logs originated from aa3. However, the block range is wrong as
theaa5variableholdsaninvalidblockvalue,andErigoncrashed
witha“methodhandlercrashed”messagewhenexecuted.Erigon
incorrectly assumed that toBlockis always less than the maximum
32-bit unsigned integer. After we reported this bug, it took less
thanadayuntilthepatch,whichdemonstratesthehighseverity
of the bug. Similarly, the besufunction tries to retrieve all event
logsoriginatedfrom aa2.However,the aa4variableholdsaninvalid
block value, and Besu falls into denial-of-service for a speci/f_ic time
periodwitha“Thread blocked” message.
Finding8 :Ethereum nodes havevarious implementation bugs,
whichincludecrash and DoS bugs.
4.2.7 Discussion: Real-World Impacts. After we reported 29 devia-
tionclasses,our/f_indingsreceivedanacknowledgementfromthe
speci/f_ication developers. Moreover, the developers even approved
to contributeour test casesto their oﬃcial repository [ 26]:
“thankyou for thesereports, this isvery helpful”,
“wouldbeveryhappytohaveyoucontributeyourtests”
Similarly, we reported 15 deviation classes to node developers and
receivedan acknowledgementof our implementation[ 25]:
“super interestedinthis project ···like to read more”
Thedevelopershaveeitherpatchedorcon/f_irmed13ofthereported
classes,whiletheyhadtheirownrationalefortherest.Onething
tonote is that someuncle-related deviationclassesmay losetheir
value in the main network due to the merge. However, they still
havepracticalimpactsasthereexistEthereum-basedPoWnetworks
with3.63 billiondollarsofmarketcapitalizations [ 34].Also,while
EtherDiffer can fail at detecting PoS-speci/f_ic deviations such as
handling ofblock/f_inality,we leave itas future work.
1341ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA ShinhaeKim andSungjae Hwang
Table 4:Comparisonof rpc-compat andEtherDiffer
(a) ChainGeneration (b)Test Case Generation
299 Transactions 4,762 71.4% Coverage 100%
0 EventLogs 2,737 5.5% Unique TCs 81.8%
0 Chain Events 1,001 0% ErrorTCs 28.9%
rpc-compat (left),EtherDiffer (right)
4.3 Comparisonwith theOﬃcial Tool
As Ethereum nodes are the entry points for end users and thus
signi/f_icant,theEthereumFoundationhasdevelopeditsowntesting
platformcalledHive[ 13]andactivelyvalidatesthenodeimplemen-
tationswithvarioustoolsontopofit.Particularly,itoﬀersatesting
toolcalled rpc-compat [14],whichgeneratesachainandvalidates
the consistency of the implementations witha set of test cases. As
rpc-compat isdesignedforconformancetests,wecloselycompare
thetoolwith EtherDiffer intermsoftwotechnicalaspectsinthis
section: chain generation and test case generation. For fairness, we
con/f_igured rpc-compat togeneratea300-heightchainand600test
casesandcomparedwithasingleiteration of EtherDiffer .
4.3.1 Chain Generation. We /f_irst compared the non-determinism
intheirgeneratedchainsasitisthekeycharacteristicofblockchain
andsigni/f_icantfordeviationdetection.Particularly,theprevious
section2.1explained that blockchain is non-deterministic in terms
of block elements and chain events. Therefore, we extracted and
analyzed the transactions and event logs in each of their chains as
they are the main block elements. Also, we counted the number of
chaineventoccurrencesbasedontheexistenceofuncleheaders.
AsTable4-(a)shows, EtherDiffer signi/f_icantlyoutperformed rpc-
compatin all three aspects of chain generation. More surprisingly,
our investigation con/f_irmed that rpc-compat generates a chain
inacompletelydeterministicmannerthateveryblockexceptthe
pre-de/f_inedgenesiscontainsasingle,exactly-equivalenttransac-
tion with no event log. Also, it does not produce non-deterministic
chain events such as temporal forks at all. This leads to a signif-
icant degradation in its eﬀectiveness and failures of detecting at
least 13 deviation classes shown in Table 2. On the other hand,
EtherDiffer applies multi-concurrent transactions and generates
anon-deterministicchainwhereeachblockcontainsunpredictable
numbersoftransactionsandeventlogs.Also,theblockelements
arediverseastheyarebasedon109diﬀerenttransactions.Lastly,
the propagation delay in our network successfully triggered a sub-
stantial number ofnon-deterministic chain events.
4.3.2 TestCaseGeneration. Wethencomparedthetestcasegen-
erationofeachtool.Whilebothtoolssuccessfullygenerated600
test cases, we evaluated them in the following three aspects: (1)
thecoverageofRPCmethodsinthespeci/f_ication,(2)theratioof
unique test cases, and (3) the ratio of test cases that triggerednode-
produced errors. The /f_irst aspect is to ensure that the test cases
coverthecompletelistof RPCmethodsexceptthemining-related
and Geth-speci/f_ic ones, while the latter two are to evaluate the
testcasediversityforeachmethod.Table 4-(b)showstheoverall
results, and the coverage con/f_irms that rpc-compat validates only
a subset of RPC methods. This is due to its design shortcomings
such as the lack of certain block elements and non-deterministicchainevents. Furthermore, rpc-compat hassigni/f_icantly lowtest
case diversity as it generates only one or two “static” test cases for
eachmethod.Ourevaluationcon/f_irmedthat94.5%ofthegenerated
test cases were duplicates with no support for error-triggering test
cases. These partial support for RPC methods and low test case
diversitysigni/f_icantlydegradeitseﬀectivenessandresultinfailures
ofdetecting atleast45deviationclasses showninTable 2.Onthe
other hand, EtherDiffer validates the complete list of RPC meth-
ods.Also,itdynamicallygeneratestestcases,andourevaluation
con/f_irmed that 81.8% were unique. Lastly, 28.9% of the unique test
cases triggered node-produced errors, which demonstrates that
EtherDiffer suﬃciently examines errorhandlings as well.
4.4 Threatsto Validity
The evaluation results showed that EtherDiffer eﬀectively gener-
atedtestcasesanddetectedavarietyofdeviationclasses.Also,it
signi/f_icantly outperformed the oﬃcial node testing tool in terms of
non-deterministic chain and test case generation. However, while
ourtestcasegenerationreliesonthemanually-convertedspeci/f_ica-
tion,therecouldbehumanerrorsduringtheprocessofconversion.
Also, asEtherDiffer does not cover all possible arguments for
RPCmethodcalls,someotherdeviationscanpossiblyremainundis-
covered. We believe that our conversion was correct as the speci/f_i-
cationiswell-structuredwithspeci/f_icpatternsandthedescriptions
provide suﬃcient details to extract and cluster properties. Also,
the success ratios of test case generation con/f_irmed the validity of
ourconversion.Besides,webelievethatour/f_indingsofdeviation
classeshavealreadyproducedhighimpactstothecommunityas
acknowledgedbyboth speci/f_ication andnode developers.
5 RELATED WORK
Analysis of Smart Contracts and DApps. As on-chain smart
contractsplayavitalroleinthecorelogicofDApps,ensuringtheir
correctnessandsecurityiscrucialforthedevelopmentofreliable
DApps.Priorresearcheﬀortshavedisclosedvariousvulnerabilities
in smart contracts [ 23,32,37] and have developed automated tools
for their detection [ 1,4,22,32,39,42,45]. Additionally, several
measurementstudies havebeenconductedto assessthestrengths
and weaknesses of these tools [ 30,35,46]. Moreover, with the
increasingpopularity ofDApps, researchers have extendedtheir
investigationbeyondsmartcontractstoencompasstheentireDApp
ecosystem.Forexample,Zhangetal.[ 47]identi/f_iedsynchronization
bugsarisingfrominconsistencies between on-chainand oﬀ-chain
states, and Li et al. [ 27] demonstrated a denial-of-service attack
onEthereumRPCservices.Also,Suetal.[ 31]exploredpastreal-
worldattacksonEthereumDApps.However,despitethesevaluable
contributions to the correctness and security of smart contracts
andDApps,noneofthemhasinvestigatedthedeviationsamong
diﬀerentnodeimplementationsintermsoftheirRPCservices.Also,
the previous work had impacts on speci/f_ic DApps only, whereas
EtherDiffer contributes to the ecosystem in general as all DApps
depend onthe RPC services of Ethereumnodes.
DiﬀerentialTesting. Diﬀerentialtestinghasproventobeanef-
fective method for identifying deviations in software and has been
successfullyappliedindiversedomains,suchasJVMs[ 43,50,51],
deeplearningsystems[ 24],andx86disassemblers[ 41].Recently,it
1342EtherDiﬀer: DiﬀerentialTestingonRPCServicesof Ethereum Nodes ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA
hasalsobeenadoptedintheblockchaindomain.Fuetal.[ 48]intro-
ducedEVMFuzzer,atoolthatmutatesreal-worldsmartcontractsus-
ing eight prede/f_ined mutators. By executing the mutated contracts,
EVMFuzzeridenti/f_iedinconsistenciesinopcodesequenceexecution
andgasusageacrossfourEVMimplementations.Anotherframe-
work, NeoDiﬀ [ 9], focuses on the virtual machine of Neo smart
contractsanddirectlygeneratestestbytecodesusingbytecode-level
mutators.Thisapproachproducesvalidopcodesequencesnotat-
tainable by high-level programming language compilers. Similarly,
EVMLab [ 11] deploys random test bytecodes and invokes them
withinasingletransactiontoevaluatediﬀerentEthereumclients.
Yangetal.[ 49]developedFluﬀy,atooldesignedtodetectconsensus
bugsinEthereumthatcanleadtoerrorneousstateswithintheblock-
chain.Notably,Fluﬀyappliesmultipletransactionsandenablesthe
detection of bugs that cannot be detected with a single transac-
tion. Ma et al. [ 21] introduced LOKI, which also detects consensus
bugs but uniquely employs a dynamic statemodel generated from
real-timeconsensusinformation.Thedynamicinformationenables
LOKItodetectcomplexconsensusbugsinfourdiﬀerentblockchain
platformsincludingEthereumthatwouldbebypassedwith/f_ixed
typesofinputs.Althoughtheframeworkshaveeﬀectivelydetected
deviationsamongnodes,noneofthemisdesignedtoinvestigate
the RPC services. The closest toolto EtherDiffer isrpc-compat
maintained by the Ethereum Foundation. However, our evaluation
showedthat rpc-compat hassigni/f_icantlyloweﬀectivenessinboth
technical aspects.
6 CONCLUSION
In this research, we aimed at /f_inding any deviations among four
major node implementations in terms of their RPC services. The
deviations can exist as the RPC speci/f_ication does not clarify the
expectedbehaviorsincaseofnon-deterministicchaineventsandin-
validarguments.Toeﬀectivelydetectsuchdeviations,weproposed
twotestcasegenerationtechniquesandimplemented EtherDiffer ,
an automatic diﬀerential testing tool. EtherDiffer /f_irst generates
a non-deterministic chain by multiple-and-concurrent transaction
injection and propagation delay. Then, it applies our techniques to
generate both semantically-valid and invalid-yet-executable test
cases.EtherDiffer executesthemoneachtargetnodeandreports
if any error deviations or value deviations are detected. Our evalu-
ationshowedthat EtherDiffer generatedbothvalidandinvalid
testcaseswiththesuccessratiosof98.8%and95.4%,respectively.
Also,itdetected48deviationclasses,which include11 implemen-
tationbugssuchascrashanddenial-of-servicebugs.Wereported
44 of the detected classes to the speci/f_ication and node develop-
ers and received acknowledgements as well as bug patches. Lastly,
EtherDiffer signi/f_icantlyoutperformedtheoﬃcialnodetesting
toolintermsofbothchainandtestcasegeneration.Webelievethat
ourresearch/f_indingscanstabilizetheecosystemofdecentralized
applicationsbyeliminating the inconsistenciesamong nodes.
7 DATA AVAILABILITY
To contribute to openness in science, we disclose the replication
package[ 28]andevaluationdatasets[ 29]tothepublic.Astheyare
archivedonapreserveddigitalrepository,anyonecandownload
the package anddatasets at any time from the links.ACKNOWLEDGMENTS
This work was supported by Institute of Information & Commu-
nicationsTechnologyPlanning&Evaluation(IITP)grantfunded
bythe Koreagovernment(MSIT)(No.2022-0-00688,AI Platformto
FullyAdaptandRe/f_lectPrivacy-PolicyChanges),(No.2022-0-01199;
Graduate School of Convergence Security, Sungkyunkwan Univer-
sity),andtheNationalResearchFoundationofKorea(NRF)grant
fundedbythe Korea government(MSIT)(No.2022R1F1A1074495)
REFERENCES
[1]AashishKolluri,IvicaNikolic,IlyaSergey,AquinasHoborandPrateekSaxena.
2019. Exploiting the Lawsof Order in Smart Contracts.In Proceedings of the28th
ACM SIGSOFT International Symposium on Software Testing and Analysis (ISSTA) .
363–373. https://doi.org/10.1145/3293882.3330560
[2]Paul Bouchon. 2022. Remote Procedure Call Speci/f_ication . Retrieved January
4, 2023from https://github.com/ethereum/EIPs/blob/master/EIPS/eip-1474.md#
error-codes
[3]ChainSafe.2016. Web3.js-EthereumJavaScriptAPI . RetrievedJanuary4,2023
fromhttps://github.com/ChainSafe/web3.js/tree/v1.7.4
[4]Chenguang Zhu, Ye Liu, Xiuheng Wu, and Yi Li. 2022. Identifying Solidity
Smart Contract API Documentation Errors. In Proceedings of the 37th IEEE/ACM
InternationalConferenceonAutomatedSoftwareEngineering(ASE) .1–13.https:
//doi.org/doi.org/10.1145/3551349.3556963
[5]Infura Community. 2019. How Does the Load Balancer Work? Retrieved January
4,2023from https://community.infura.io/t/how-does-the-load-balancer-work/
1090
[6]ConsenSys.2020. EthereumbytheNumbers-May2020 . RetrievedJanuary23,2023
fromhttps://consensys.net/blog/news/ethereum-by-the-numbers-may-2020/
[7]Cryptoslate. 2023. Coin Rankings . Retrieved January 23, 2023 from https:
//cryptoslate.com/coins/
[8]DappRadar.2023. TopEthereumDapps . RetrievedJanuary23,2023from https:
//dappradar.com/rankings/protocol/ethereum
[9]DominikMaier,FabianFäßlerandJean-PierreSeifert.2021. UncoveringSmart
ContractVMBugsviaDiﬀerentialFuzzing.In Proceedingsofthe5thReversing
andOﬀensive-orientedTrendsSymposium(ROOT) .11–22.https://doi.org/10.1145/
3503921.3503923
[10]SmartContractEngineer.2022. Solidityby Example . Retrieved January4,2023
fromhttps://solidity-by-example.org/
[11]Ethereum. 2019. EVMLab Utilities . RetrievedJuly 24, 2023 from https://github.
com/ethereum/evmlab
[12]Ethereum.2022. EthereumJSON-RPCSpeci/f_ication . RetrievedJanuary4,2023
fromhttps://ethereum.org/en/developers/docs/nodes-and-clients/
[13]Ethereum. 2023. Hive - EthereumEnd-to-EndTest Harness . RetrievedJanuary 4,
2023 from https://github.com/ethereum/hive
[14]Ethereum. 2023. Rpc-Compat Simulator . Retrieved January10, 2023from https:
//github.com/ethereum/hive/tree/master/simulators/ethereum/rpc-compat
[15]Ethereum.org. 2022. JSON-RPC API . Retrieved January 4, 2023 from https:
//ethereum.org/en/developers/docs/apis/json-rpc/
[16]Ethereum.org. 2022. Nodes and Clients . Retrieved January 4, 2023 from https:
//ethereum.org/en/developers/docs/nodes-and-clients/
[17]Ethereum.org. 2022. Proof-of-Stake . Retrieved January 11, 2023 from https:
//ethereum.org/en/developers/docs/consensus-mechanisms/pos/
[18]Ethereum.org. 2022. Proof-of-Work . Retrieved January 11, 2023 from https:
//ethereum.org/en/developers/docs/consensus-mechanisms/pow/
[19]Ethernodes. 2023. Ethereum Mainnet Statistics . Retrieved January 23, 2023 from
https://ethernodes.org
[20]Ethereum Stack Exchange. 2016. What Happens When a Transaction Nonce is
Too High? Retrieved January 4, 2023 from https://ethereum.stackexchange.com/
questions/2808/what-happens-when-a-transaction-nonce-is-too-high
[21]FuchenMa,YuanliangChen,MengRen,YuanhangZhou,YuJiang,TingChen,
Huizhong Li and Jiaguang Sun. 2023. LOKI: State-Aware Fuzzing Framework
for the Implementation of Blockchain Consensus Protocols. In Proceedings of
the 30th Annual Network and Distributed System Security Symposium (NDSS) .
https://doi.org/10.14722/ndss.2023.24078
[22]Haijun Wang, Yi Li, Shang-Wei Lin, Lei Ma, and Yang Liu. 2019. VULTRON:
Catching Vulnerable Smart Contracts Once and for All. In Proceedings of the 41st
InternationalConferenceonSoftwareEngineering:NewIdeasandEmergingResults
(ICSE-NIER) . 1–4.https://doi.org/doi.org/10.1109/ICSE-NIER.2019.00009
[23]Sungjae Hwang and Sukyoung Ryu. 2020. Gap between Theory and Practice:
An Empirical Study of Security Patches in Solidity. In Proceedings of the 42nd
ACM/IEEE International Conference on Software Engineering (ICSE) . 542–553.
https://doi.org/10.1145/3377811.3380424
[24]JianminGuo,YuJiang,YueZhao,QuanChen,andJiaguangSun.2018. Dlfuzz:
Diﬀerential FuzzingTesting of Deep LearningSystems. In Proceedings ofthe26th
1343ESEC/FSE ’23, December3–9, 2023,San Francisco, CA, USA ShinhaeKim andSungjae Hwang
ACM Joint Meeting on European Software Engineering Conference and Symposium
on the Foundations of Software Engineering (ESEC/FSE) . 739–743. https://doi.org/
10.1145/3236024.3264835
[25]JosephK95. 2022. Erigon RPC Service Consistency against Other Client Implemen-
tations #1 . Retrieved July 24, 2023 from https://github.com/ledgerwatch/erigon/
issues/4962
[26]JosephK95. 2022. Proposal: Error Handling Speci/f_ication #1 . Retrieved July 24,
2023 from https://github.com/ethereum/execution-apis/issues/286
[27]Kai Li, Jiaqi Chen, Xianghong Liu, Yuzhe Tang, XiaoFeng Wang, and Xiapu Luo.
2021. AsStrongAsItsWeakestLink:HowtoBreakBlockchainDAppsatRPC
Service.In Proceedingsofthe28thAnnualNetworkandDistributedSystemSecurity
Symposium(NDSS) . 616–633. https://doi.org/10.14722/ndss.2021.23108
[28]Shinhae Kim and Sungjae Hwang. 2023. EtherDiﬀer: Diﬀerential Testing on
RPCServicesofEthereumNodes(Code) . RetrievedAugust10, 2023from https:
//doi.org/10.6084/m9./f_igshare.23913096.v1
[29]Shinhae Kim and Sungjae Hwang. 2023. EtherDiﬀer: Diﬀerential Testing on
RPC Services of Ethereum Nodes (Data) . Retrieved August 9, 2023 from https:
//doi.org/10.6084/m9./f_igshare.21936555.v1
[30]Shinhae Kim and Sukyoung Ryu. 2020. Analysis of Blockchain Smart Contracts:
Techniques and Insights. In Proceedings of the 5th IEEE Secure Development Con-
ference (SecDev) . 65–73.https://doi.org/10.1109/SecDev45635.2020.00026
[31]LiyaSu,XinyueShen,XiangyuDu,XiaojingLiao,XiaoFengWang,LuyiXingand
BaoxuLiu. 2021. Evil Under the Sun: Understanding and Discovering Attackson
Ethereum Decentralized Applications. In Proceedings of the 30th USENIX Security
Symposium(USENIXSecurity) . 1307–1324.
[32]Loi Luu, Duc-Hiep Chu, Hrishi Olickel, Prateek Saxena and Aquinas Hobor.
2016. MakingSmart ContractsSmarter. In Proceedingsofthe23rd ACMSIGSAC
Conference on Computer and Communications Security (CCS) . 254–269. https:
//doi.org/10.1145/2976749.2978309
[33]Bernard Marr. 2022. The Top 10 Tech Trends In 2023 Everyone Must Be Ready
For. RetrievedJanuary11,2023from https://www.forbes.com/sites/bernardmarr/
2022/11/21/the-top-10-tech-trends-in-2023-everyone-must-be-ready-for
[34]MiningPoolStats. 2023. Mining Pool Stats . Retrieved January 23, 2023 from
https://miningpoolstats.stream/
[35]Monika Angelo and Gernot Salzer. 2019. A Survey of Tools for Analyzing
EthereumSmartContracts.In Proceedingsofthe1stIEEEInternationalConference
on Decentralized Applications and Infrastructures (DAPPCON) . 69–78. https:
//doi.org/10.1109/DAPPCON.2019.00018
[36]Satoshi Nakamoto. 2008. Bitcoin: A Peer-to-Peer Electronic Cash System. Decen-
tralizedBusinessReview (2008).
[37]Nicola Atzei, Massimo Bartoletti and Tiziana Cimoli. 2017. A Survey of Attacks
on Ethereum Smart Contracts. In Proceedings of the 6th International Conference
on PrinciplesofSecurityandTrust(POST) .164–186. https://doi.org/10.1007/978-
3-662-54455-6_8
[38]Fellowship of Ethereum Magicians. 2018. Remote Procedure Call Speci/f_ica-
tion. Retrieved January 4, 2023 from https://ethereum-magicians.org/t/remote-
procedure-call-speci/f_ication/1537
[39]Petar Tsankov, Andrei Dan, Dana Drachsler-Cohen, Arthur Gervais, Florian
Buenzli and Martin Vechev. 2018. Securify: Practical Security Analysis of Smart
Contracts.In Proceedingsofthe25th ACMSIGSACConferenceonComputerandCommunications Security (CCS) . 67–82.https://doi.org/10.1145/3243734.3243780
[40]Evgeny Ponomarev. 2019. DApp Survey Results 2019 . Retrieved January
4,2023from https://medium.com//f_luence-network/dapp-survey-results-2019-
a04373db6452
[41]RobertoPaleari,LorenzoMartignoni,GiampaoloFresiRoglia,andDaniloBruschi.
2010. N-version Disassembly: Diﬀerential Testing of x86 Disassemblers. In
Proceedings of the 19th International Symposium on Software Testing and Analysis
(ISSTA). 265–274. https://doi.org/10.1145/1831708.1831741
[42]Shuai Wang, Chengyu Zhang, and Zhendong Su. 2019. Detecting Nondetermin-
isticPaymentBugsinEthereumSmartContracts.In Proceedingsofthe34thACM
SIGPLANConferenceonObject-OrientedProgrammingSystems,Languages,and
Applications(OOPSLA) . 1–29.https://doi.org/10.1145/3360615
[43]Sungjae Hwang, Sungho Lee, Jihoon Kim and Sukyoung Ryu. 2021. JUSTGen:
Eﬀective Test Generation for Unspeci/f_ied JNI Behaviors on JVMs. In Proceedings
of the 43rd IEEE/ACM International Conference on Software Engineering (ICSE) .
1708–1718. https://doi.org/10.1109/ICSE-Companion52605.2021.00073
[44]SolidityTeam.2022. Solidity. RetrievedJanuary4,2023from https://soliditylang.
org/
[45]TengZhou,KuiLiu,LiLi,ZheLiu,JacquesKleinandTegawendéFBissyandé.2021.
SmartGift: Learning to Generate Practical Inputs for Testing Smart Contracts. In
Proceedings of the 37th IEEE International Conference on Software Maintenance
(ICSM). 23–34.https://doi.org/10.1109/ICSME52107.2021.00009
[46]ThomasDurieux,João F.Ferreira, RuiAbreu andPedroCruz. 2020. Empirical
ReviewofAutomatedAnalysisToolson47,587EthereumSmartContracts.In Pro-
ceedings ofthe 42nd ACM/IEEE InternationalConferenceonSoftwareEngineering
(ICSE). 530–541. https://doi.org/10.1145/3377811.3380364
[47]Wuqi Zhang, Lili Wei, Shuqing Li, Yepang Liu, and Shing-Chi Cheung. 2021.
ÐArcher: Detecting On-Chain-Oﬀ-Chain Synchronization Bugs in Decentralized
Applications. In Proceedings of the 29th ACM Joint Meeting on European Software
EngineeringConferenceandSymposiumontheFoundationsofSoftwareEngineering
(ESEC/FSE) . 553–565. https://doi.org/10.1145/3468264.3468546
[48]YingFu,MengRen,FuchenMa,HeyuanShi,XinYang,YuJiang,HuizhongLi,
andXiangShi.2019. EVMFuzzer:DetectEVMVulnerabilitiesviaFuzzTesting.
InProceedingsofthe27thACMJointMeetingonEuropeanSoftwareEngineering
ConferenceandSymposiumontheFoundationsofSoftwareEngineering(ESEC/FSE) .
1110–1114. https://doi.org/10.1145/3338906.3341175
[49]YoungseokYang,TaesooKimandByung-GonChun.2021. FindingConsensus
BugsinEthereumviaMulti-TransactionDiﬀerentialFuzzing.In Proceedingsof
the 15th USENIX Symposium on Operating Systems Design and Implementation
(OSDI). 349–365.
[50]Yuting Chen, Ting Su, and Zhendong Su. 2019. Deep Diﬀerential Testing of JVM
Implementations.In Proceedingsofthe41stIEEE/ACMInternationalConferenceon
Software Engineering (ICSE) . 1257–1268. https://doi.org/10.1109/ICSE.2019.00127
[51]Yuting Chen, Ting Su, Chengnian Sun, Zhendong Su, and Jianjun Zhao. 2016.
Coverage-directed Diﬀerential Testing of JVM Implementations. In Proceedings
of the 37th ACM SIGPLAN Conference on Programming Language Design and
Implementation(PLDI) . 85–99.https://doi.org/10.1145/2908080.2908095
Received 2023-02-02; accepted 2023-07-27
1344