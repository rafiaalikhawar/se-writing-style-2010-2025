AlloyMax:Bringing Maximum Satisfactionto
Relational
Specifications
Changjian Zhang
Carnegie MellonUniversity
Pittsburgh,USA
changjiz@andrew.cmu.eduRyan Wagner
Carnegie MellonUniversity
Pittsburgh,USA
rrwagner@cs.cmu.eduPedroOrvalho
INESC-ID/IST,UniversidadedeLisboa
Lisboa, Portugal
pedro.orvalho@tecnico.ulisboa.pt
DavidGarlan
Carnegie MellonUniversity
Pittsburgh,USA
garlan@cs.cmu.eduVascoManquinho
INESC-ID/IST,UniversidadedeLisboa
Lisboa, Portugal
vasco.manquinho@tecnico.ulisboa.ptRuben Martins
Carnegie MellonUniversity
Pittsburgh,USA
rubenm@andrew.cmu.edu
EunsukKang
Carnegie MellonUniversity
Pittsburgh,USA
eskang@cmu.edu
ABSTRACT
Alloyisadeclarativemodelinglanguagebasedonafirst-orderrela-
tional logic. Its constraint-based analysis has enabled a wide range
of applications in software engineering, including configuration
synthesis, bug finding,test-casegeneration,and securityanalysis.
Certain types of analysis tasks in these domains involve finding an
optimalsolution. For example, in a network configuration problem,
instead of finding any valid configuration, it may be desirable to
findonethatismost permissive (i.e.,itpermitsamaximumnumber
of packets). Due to its dependence on SAT, however, Alloy cannot
be usedto specifyandanalyze these types of problems.
We propose AlloyMax, an extension of Alloy with a capability
to expressandanalyzeproblemswith optimalsolutions. AlloyMax
introduces(1)asmalladditionoflanguageconstructsthatcanbe
used to specify a wide range of problems that involve optimality
and(2)anewanalysisenginethatleveragesa MaximumSatisfiabil-
ity(MaxSAT )solvertogenerateoptimalsolutions.Toenablethis
new type ofanalysis,we show how a specification ina first-order
relationallogiccanbetranslatedintoaninputformatofMaxSAT
solversÃnamely, a Boolean formula in weighted conjunctive normal
form(WCNF).Wedemonstratetheapplicabilityandscalabilityof
AlloyMaxonabenchmarkofproblems.Toourknowledge, AlloyMax
is the first approach to enable analysis with optimality in a rela-
tional modeling language, and we believe that AlloyMaxhas the
potential to bringawide range ofnewapplicationsto Alloy.
ESEC/FSE â€™21, August 23Å›28, 2021, Athens, Greece
Â© 2021 Copyright held by the owner/author(s).
ACM ISBN 978-1-4503-8562-6/21/08.
https://doi.org/10.1145/3468264.3468587CCS CONCEPTS
Â·Softwar
e and its engineering â†’Specification languages ;
Software system models; Formalmethods.
KEYWORDS
Alloy,SAT,MaxSAT,Relationalspecifications, Modelsynthesis
ACMReference Format:
Changjian Zhang, Ryan Wagner, Pedro Orvalho, David Garlan, Vasco Man-
quinho,RubenMartins,andEunsukKang.2021.AlloyMax:BringingMax-
imum Satisfaction to Relational Specifications. In Proceedings of the 29th
ACM Joint European Software Engineering Conference and Symposium on
theFoundations ofSoftwareEngineering(ESEC/FSEâ€™21), August 23Å›28,2021,
Athens,Greece. ACM,NewYork,NY,USA, 13pages.https://doi.org/10.1145/
3468264.3468587
1 INTRODUCTION
Alloy[16] is a declarative modeling language based on a first-order
relational logic with transitive closure. Thanks to its expressive
power, along with the analysis capability provided by its back-end
engine,theAlloyAnalyzer,ithasbeenappliedtoawiderangeof
problemsinsoftwareengineering,includingprotocolverification[ 4,
47],configurationanalysis[ 27,34],test-casegeneration[ 19],bug
finding [9, 17], andsecurity analysis[1, 18,43].
The types of analysis that can be performed with a high-level
modelinglanguagelikeAlloydependonthecapabilityofitsunder-
lying engine. The Alloy Analyzer is at its core a finite model finder :
Givenasetoffirst-orderlogic(FOL)constraintsthatcorrespondto
a system specification ğ‘€and user query ğ‘†(e.g.,ğ‘†â‰¡Å‚find a valid
network configurationÅ¾), the analyzer translates formula ğ‘€âˆ§ğ‘†to
anequisatisfiableBooleanformula ğ¹suchthatasatisfyinginstance
toğ¹is also a solution to ğ‘€âˆ§ğ‘†. This analysis is then performed
byanoff-the-shelfBooleanSatisfiability(SAT)solver.Ingeneral,
there may be multiple satisfying instances ğ¹; the Alloy Analyzer
also provides a way to enumerate these solutions by repeatedly
invokingthesolverwithadditionalconstraintsthatareintended
to blockthe previously seen instances.
155This work is licensed under a Creative Commons Attribution International 4.0 License.
ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece ChangjianZhang,Ryan Wagner, Pedro Orvalho, David Garlan,Vasco Manquinho, RubenMartins, andEunsuk Kang
The reliance on the SAT-based analysis means, however, that
the Alloy Analyzer cannot be used to automatically perform the
following types ofanalysis:
â€¢Generationofoptimalsolutions :Itissometimesdesirableto
findnotonlyanysolutionbutonethatis minimalormaximal,
dependingontheproblembeingmodeled.Forinstance,inthe
contextofsecurityexploitgeneration[ 43],itmaybedesirable
to synthesize the smallestpossible exploit that can demonstrate
a security violation. In a network firewall configuration prob-
lem[34],aconfigurationsettingthat maximizes thenumberof
allowed packets while satisfying a security policy is typically
considered more desirable than a less permissive solution. How-
ever,sincethe AlloyAnalyzer returnsinstances in anarbitrary
order, finding such an optimal solution can only be done by
enumerating the (typicallyvery large) spaceofallinstances.
â€¢Analysis with soft constraints : Certain problems are natu-
rallyexpressedusingacombinationofboth hardandsoftcon-
straints, where a desirable solution should satisfy as many of
the soft ones as possible. For example, a meeting scheduling
problemmayconsistofhardconstraints(e.g.,Å‚allparticipants
mustbe presentÅ¾)aswellassoftones(e.g.,Å‚participantsâ€™ time
preferencesÅ¾); if it is not possible to satisfy all of the latter, a
solutionthatfulfillsasmanyoftheseoptionalpreferencesisstill
more desirablethanothers. Since all of the constraintsin Alloy
aretreatedashardconstraintsthatmustalwaysbesatisfied,it
iscurrently not possible to analyze such types ofproblems.
â€¢Analysis with priorities : When a problem has multiple, in-
comparable optimal solutions, it may be helpful to rank these
solutionsusingsomenotionof priorityamongconstraints.For
instance,intheaforementionedschedulingproblem,apartici-
pantmayhaveahigherpreferencetowardsmeetingtimesinthe
morningrather than intheafternoon. Again, since Alloy treats
all of the constraints equally, it is not possible to solve problems
where such anotionofpriority plays an importantrole.
In this paper, we propose AlloyMax, an extension of Alloy that
overcomes these limitations by enabling an analysis of Alloy speci-
ficationswithoptimalsolutiongeneration.Inparticular,wepropose
both(1)a languageextension toallowthe usertospecifysoftcon-
straints and indicate parts of an Alloy specification that must be
optimized and (2) a new analysis back-end that leverages a max-
imum satisfiability (MaxSAT) solver to perform the analysis. To
enable this analysis, we also provide a new translation mechanism
from a high-level AlloyMaxspecification in FOL to an equivalent
MaxSATproblem.
The proposed extension significantly extends the range of anal-
yses that can be performed over Alloy specifications. It is also a
strict generalization of Alloy: It introduces no semantic changes
toexistingAlloyspecificationsandincludesonlyasmallnumber
of syntactic extensions, and thus should be easily adoptable by
existing Alloy users.
We demonstrate the added analysis capability of AlloyMaxon a
varietyofcasestudies,includingexploitgenerationonmicroproces-
sors[43](similartothewell-knownSpectre[ 20]andMeltdown[ 24]
attacks),gracefuldegradationinsecurity[ 13],aweddingseating
assignment[ 32],andataskschedulingproblem[ 22].Weshowthat
not onlycanour extensionbe used toperform analysesthatwereTable 1:The course timetable ofthe schedulingproblem.
MonTue WedThu Fri
AMCS101ML/Compiler CS101ML/Compiler
PMSEOS SEOS CS101
notpossibleinAlloybefore,buttheperformanceofouranalysis
engine iscompetitive to the existing Alloy Analyzer.
The contributionsofthis paper are as follows:
â€¢An extension to Alloy, called AlloyMax, and an accompanying
analysisenginethatcanbeusedtogenerateoptimalsolutions
and solve problems with soft, prioritized constraints (Section 2);
â€¢A translationmechanism from a first-orderrelational logicto a
weightedBoolean formula (Section 4);
â€¢Anoptimizationtechniquethatuseshigh-levelinformationin
an input Alloy specification to guide a MaxSAT solver more
efficiently towardsoptimal solutions (Section 5); and
â€¢Acollectionofcasestudiesdemonstratingthenewtypesofanal-
yses inAlloyMax, and a set of benchmark results demonstrating
its performance onproblems of varyingsizes (Section 6).
2 EXAMPLES
Asamotivatingexample,consideramodelofa coursescheduling
probleminAlloy(Figure 1).Auniversityoffersasetofcoursesthat
studentscanregisterforeachsemester;inthismodel,weassume
the school is offering five courses named CS101, Compiler, OS, ML,
andSE(lines6-10).Eachlecturecantakeplaceduringthemorning
(AM)orafternoon(PM)betweenMondaytoFriday(lines1-4).Aset
ofall availablelectureslots(lines 13-14)andtheirrelations tothe
dayandtimearedefinedonlines17-18,andthetimetableforthe
courses(Table 1)isdefinedonline20.Eachstudentisassociated
with a set of corecourses that are required for their major. For
simplicity,weconsidertheschedulingproblemforoneparticular
student,Alice,whoisassignedCS101as acore course.
Eachstudentâ€™sregistrationschedulemustsatisfythefollowing
requirements:
â€¢Eachstudentmusttake at leastthree courses (line35);
â€¢Each student must take all of the corecourses that they are
assigned,and(line36);
â€¢A student cannot take courses whose lecture times conflict with
eachother(line37).
Giventhismodel,wecanusea runcommand(line47)inAlloy
to generate a valid course schedule for Alice that satisfies all of
the requirements. Figure 2ashows the first generated instance,
indicating that Alice could take Compiler, CS101, OS, and SE to
satisfy the requirements.
2.1 Solving Optimization Problems
Suppose that we wish to extend this model to encode studentsâ€™
interests in subjects (i.e., every student is interested in a set of
courses).Thegoalistobeabletogenerateaschedulethat maximizes
thenumberofcoursesthatmatchastudentâ€™sinterest, inaddition to
satisfyingthethreebasicrequirements.Thefollowingcodesnippet
shows the new definition for Student and Alice, where Alice is
interestedinSE andML.
156AlloyMax: Bringing Maximum Satisfaction to Relational Specifications ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece
1abstract sig Day{}// The set of days for Mon to Fri.
2one sig Mon, Tue, Wed, Thu, Fri extends Day{}
3abstract sig Time{}// The set of times (AM and PM).
4one sig AM, PM extends Time{}
5
6abstract sig Course {// The set of courses.
7// Each course has several lectures in a week.
8lectures: setLecture
9}
10one sig CS101, Compiler, OS, ML, SE extends Course {}
11
12// In total, 5 (days) x 2 (AM/PM) lecture slots.
13abstract sig Lecture {day:oneDay, time: oneTime}
14one sig MonAM, MonPM, TueAM, ...extends Lecture {}
15fact{
16// The full day/time definition is omitted.
17day = MonAM -> Mon + MonPM -> Mon + ...
18time = MonAM -> AM + MonPM -> PM + ...
19// The full timetable definition is omitted.
20lectures = SE -> MonPM + SE -> WedPM + ...
21}
22
23abstract sig Student {// The set of students.
24// Each student is assigned a set of core courses.
25core:setCourse,
26// Each student may register for a set of courses.
27courses: setCourse
28}
29one sig Aliceextends Student {} {
30core = CS101 // Alice has to take CS101.
31}
32// The predicate for the three requirements.
33predvalidSchedule [courses: Student -> Course ] {
34allstu: Student {
35 #stu.courses > 2
36 stu.core instu.courses
37 all disj c1,c2:stu.courses |notconflict [c1, c2]
38}
39}
40predconflict [c1, c2: Course ] {
41somel1, l2: Lecture {
42 l1inc1.lectures andl2inc2.lectures
43 l1.day = l2.day andl1.time = l2.time
44}
45}
46// Generate a valid schedule.
47run{validSchedule [courses ] }
Figure 1:AnAlloy modelforthecourse schedulingsystem.
(a)
 (b)
(c)
 (d)
Figure 2:Instancesofthecourse schedulingproblem.1abstract sig Student {
2core:setCourse, courses: setCourse,
3// Courses that this student is interested in.
4interests: setCourse
5}
6one sig Aliceextends Student {} {
7core = CS101
8interests = ML + SE // Interested in ML and SE.
9}
Even though this maximization problem can be expressed in Alloy
as follows, it contains a higher-order quantification (line 3, over
possible relations from StudenttoCourse), which cannot be solved
bythe Alloy Analyzer1:
1run{
2validSchedule [courses ]
3nocourses': Student -> Course {
4 validSchedule [courses' ]
5 somestu:Student |#(stu.interests & stu.courses)
6 < #(stu.interests & stu.courses')
7}
8}
Thisoptimizationproblemcanbesolvedbyourextension, AlloyMax.
The following code snippet shows a run command that uses our
newmaxsome multiplicity construct:
1runMaxInterests1 {
2validSchedule [courses ]
3allstu:Student |maxsome stu.interests & stu.courses
4}
The meaning of the constraint on line 3 is that for any student,
there exist someelements in the intersection of set ğ‘ ğ‘¡ğ‘¢.ğ‘–ğ‘›ğ‘¡ğ‘’ğ‘Ÿğ‘’ğ‘ ğ‘¡ğ‘ 
and setğ‘ ğ‘¡ğ‘¢.ğ‘ğ‘œğ‘¢ğ‘Ÿğ‘ ğ‘’ğ‘  that should be maximized, i.e., find an instance
that maximizesthe number of elements inthis intersection.
An alternative way of specifying the optimization problem is by
using our new maxsome quantifier :
1runMaxInterests2 {
2validSchedule [courses ]
3allstu: Student |maxsome comm:setCourse |
4 comminstu.interests andcomminstu.courses
5}
Figure2bshowstheinstancegeneratedbyaMaxSATsolver,which
suggeststhatAlicecouldtakeCS101,ML,OS,andSE,whereML
andSE are the courses that Alice isinterestedin.
2.2 Solving Problemswith Soft Constraints
Wewishtoextendthemodelfurthertoallowstudentstoindicate
preferencesoverlecturetimesfortheircourses.Forexample,sup-
posethatAlicedoesnotwanttotakecoursesonThursdaymornings
and Friday afternoons. The following code snippet shows a run
commandwithaconstraintthatencodesAliceâ€™spreferences.When
thecommandisexecuted,theAlloyAnalyzerfailstofindanyvalid
schedule (i.e.,theresulting formulais unsatisfiable)becauseAlice
has to take CS101,whichhas lectures onFriday afternoons.
1runWithPrefer {
2validSchedule [courses ]
3allstu:Student |maxsome stu.interests & stu.courses
4// No lecture on Thu AM.
1Another extension of Alloy, called Alloyâˆ—[33], can be used to solve higher-order
quantification, but does not support other types of analysis shown in Sections 2.2and
2.3. Weprovideamoredetailed comparison of AlloyMaxand Alloyâˆ—in Section 7.
157ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece ChangjianZhang,Ryan Wagner, Pedro Orvalho, David Garlan,Vasco Manquinho, RubenMartins, andEunsuk Kang
5ThuAM ! inAlice.courses.lectures
6// No lecture on Fri PM.
7FriPM ! inAlice.courses.lectures
8}
One way to find a satisfying instance is to relax some of the
constraints; forinstance,Alice could beasked to giveuponsome
ofherpreferencestosatisfytherequirements.However,Alloydoes
notprovideawaytospecifysuchdesirablebut optionalconstraints.
InAlloyMax,weintroduceanotionof softconstraints ,i.e.,asetof
constraints that are not required but should be satisfied as much as
possible. The following code shows a new type of construct called
softfact,whichcontains alistofsoft constraints:
1soft fact {
2ThuAM ! inAlice.courses.lectures
3FriPM ! inAlice.courses.lectures
4}
5runWithSoftPrefer {
6validSchedule [courses ]
7allstu:Student |maxsome stu.interests & stu.courses
8}
Given the above run command, AlloyMaxwill attempt to find an
instance that maximizes the number of satisfied soft constraints, in
additiontotheotherhardconstraintsthatencodethethreebasic
requirements. Figure 2cshows an instance where Alice could take
CS101,OS,andSE,i.e.,AlicegivesupherFridayafternoonsinorder
to registerfor CS101,but herThursday mornings are freedup.
2.3 Solving with Priorities
However, Alice is not entirely satisfied with the above schedule.
Although her Thursdays are free, she has to give up the ML course,
which she is interested in. Given a choice between two conflict-
ing goalsÃkeeping Thursday mornings free and studying MLÃshe
wouldratherchoosethelatter;i.e.,MLhasahigher priorityforher.
Currently, in Alloy, there is no way to express and analyze with
such anotionof priorities among constraints.
InAlloyMax,priorities canbeexplicitlyassignedtomaximalor
softconstraints toindicate theuserâ€™spreferencesonwhichofthe
possibly conflicting constraints must be satisfied first. For example,
inthefollowingsnippet, maxsome[1] indicatesthatmaximizingthe
numberof interestedcourseshasahigherprioritythansatisfying
the time preferences (i.e. softfactisassigneddefaultpriority of0).
1soft fact {
2ThuAM ! inAlice.courses.lectures
3FriPM ! inAlice.courses.lectures
4}
5runWithSoftPreferAndPrior {
6validSchedule [courses ]
7allstu: Student |
8 maxsome [1]stu.interests & stu.courses
9}
Figure2dshows the instance generated by the solver; i.e., Alice
could take CS101, ML, OS, and SE, which maximizes her course
interestsover hertime preferences.
In summary,our extension expands the rangeof analysesavail-
ableinAlloy,including(1)generatinganinstancethatmaximizes
or minimizesa given relation,which can be used for optimization
problems (2) defining soft constraints and finding an instance thatsatisfiesasmanyoftheseoptionalbutdesiredconstraints,and(3)
specifying priorities among differentsoft ormaximal constraints.
3 BACKGROUNDON MAXSAT
Apropositionalformulain conjunctivenormalform (CNF)isdefined
asaconjunctionofclauses,whereeachclauseisadisjunctionof
literals such that a literal is either a propositional variable ğ‘£ğ‘–or
its negation Â¬ğ‘£ğ‘–. A clause is satisfied if at least one of its literals
issatisfied.Finally,aCNFformulaissatisfiedifallitsclausesare
satisfied.GivenaCNFformula ğœ™,theSatisfiability(SAT)problem
corresponds to deciding if there is an assignment such that ğœ™is
satisfiedorprovingthat nosuch assignment exists.
TheMaximumSatisfiability(MaxSAT)isanoptimizationversion
oftheSAT problem.Given aCNFformula ğœ™,thegoalisto findan
assignment that maximizes the number of satisfied clauses in ğœ™. In
partialMaxSAT,clausesin ğœ™aresplitinhard ğœ™â„andsoftğœ™ğ‘ .Givena
formulağœ™=(ğœ™â„,ğœ™ğ‘ ),thegoalistofindanassignmentthatsatisfies
all hard clauses in ğœ™â„while minimizing the number of unsatis-
fiedsoftclausesin ğœ™ğ‘ .Thisproblemcanbefurthergeneralizedto
weightedMaxSAT,whereeachsoftclausehasapositiveweight,and
thegoalbecomestominimizethesumoftheweightsofunsatisfied
soft clauses. MaxSAT algorithms have seen a remarkable improve-
ment in the last decade [ 3] and can be used to solve problems in
domains such as planning [ 48], data analysis [ 28], security [ 10],
andbioinformatics[ 11].Inthispaper,weleverageexistingMaxSAT
technology andextend Alloy to handle optimization problems.
4 SYNTAX AND SEMANTICS
Thissectiondescribesthesyntaxandsemanticsof AlloyMax.Italso
presentstheformaltranslationrulesfroman AlloyMaxspecification
to aMaxSAT problem.
4.1 AbstractSyntax
Figure3shows the abstract syntax of AlloyMax. AnAlloyMaxprob-
lemisatuple ğ‘ƒ=âŸ¨A,ğ·,ğ¹,ğ¹ğ‘†âŸ©whereAisthe setof atoms in the
universe,ğ·isasetofrelationdeclarations, ğ¹isanAlloyformula
that defines the hardconstraints that must be satisfied, ğ¹ğ‘†is asoft
Alloyformulathatdefinesthe softconstraintsthatmayormaynot
be satisfied. A ( hard) Alloy formula may contain keywords such as
maxsome for generatingoptimal solutions.
Optimization operators. AlloyMaxextends the existing somemul-
tiplicityoperatorwith maxsome andminsome formaximizationand
minimization,respectively.Informally, someğ‘Ÿistruewhenrelation
ğ‘Ÿisnotempty;butwith maxsome (minsome),thesolverreturnsa
modelwithanon-empty ğ‘Ÿthathasamaximal(minimal)number
oftuples.
AlloyMaxalsoextendsthe nomultiplicityoperatorwith softno.
Informally, noğ‘Ÿis true when ğ‘Ÿis empty. For softno, the solver tries
to find a model with an empty ğ‘Ÿ, but if no such satisfying instance
exists, the solver instead returns a model where ğ‘Ÿhas the minimal
number of tuples. The difference between minsome andsoftnois
thatminsome requires the relation ğ‘Ÿto have at leastone tuple.
In addition, the existential quantifier (i.e., some) is also extended
withmaxsome andminsome. In Alloy, someğ‘’:ğ‘Ÿ|ğ¹is true when
there exists a tuple in relation ğ‘Ÿthat makes formula ğ¹true. In
AlloyMax,whenmaxsome (minsome)isusedinplaceof some,the
158AlloyMax: Bringing Maximum Satisfaction to Relational Specifications ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece
problem :=univDecl relDecl* formula softFormula expr :=rel |var|unary |binary |comprehension
softFormula := softformula | soft[0..] formula |compositeSoft unary :=unopexpr
compositeSoft:=softFormula andsoftFormula unop:=~ |^
binary :=expr binopexpr
univDecl :={atom[,atom]*} binop:=+|&|- |.|->
relDecl :=rel : arity comprehension:={varDecl |formula}
varDecl :=var: expr
constant :={tuple*} formula :=elementary |composite |quantified
tuple :=âŸ¨atom[,atom]* âŸ© elementary :=expr inexpr |mult expr
mult :=some|maxsome |maxsome[0..] |minsome
|minsome[0..] |no|softno|softno[0..] |one
arity :=1|2|3|... composite := notformula |formula logopformula
atom:=identifier logop:=and|or
rel :=identifier quantified:=quantifiervarDecl |formula
var:=identifierquantifier:= all|some|maxsome |maxsome[0..]
|minsome |minsome[0..]
Figure 3:Abstract syntaxof AlloyMax.Bolded textare existing keywordsinAlloy;textinblue are new keywords in AlloyMax.
solverfindsamodelwhere ğ‘Ÿcontainsatleastonetupleandtriesto
maximize(minimize) the number oftuples in ğ‘Ÿthat makeğ¹true.
Soft constraints. AlloyMaxintroduces the softfact keyword to
specifyasoftconstraint,i.e., softfactğ¹whereğ¹isanAlloyformula
but becomes soft. When multiple soft factare present in a given
specification, the overall soft constraint ğ¹ğ‘†is the conjunction of
thosesoft Alloy formulas.
Priority.A priorityğ‘âˆˆN0may be specified along with every
oneofthenewoperatorsin AlloyMax.Whenitisleftunspecified,a
defaultlowestpriority0isassignedtotheassociatedAlloyformula.
4.2 Translation
Overview. Figure4formally defines the translation rules for
AlloyMaxas an extension to the existing translation process in
Alloy [15,42]. Due to limited space, we focus on the parts of the
translation processthat are mostrelevantfor AlloyMax.
A relation in Alloy is translated into a matrix of Boolean vari-
ables (each ofwhichis true if and onlyif the tuplerepresented by
thisparticularvariableisintherelation),andarelationalexpres-
sion(e.g.,dotjoin)isrepresentedbyoperationsoveroneormore
matrices. In Alloy,a FOLproblemwith bounds istranslated intoa
Booleanformula,whichiseventuallyconvertedintoconjunctive
normal form (CNF). In AlloyMax, the idea is to instead convert it
intoweighted conjunctive normal form (WCNF), where (1) hard
Boolean formulas are assigned the special weight of +âˆ, to ensure
that they are satisfied in every instance and (2) soft formulas are
assigned different weights (depending on the user-specified priori-
ties), to guide the solver towards an instance that maximizes the
totalsum ofweights.
TranslationSteps. First,anAlloyMaxproblemistranslatedinto
a Boolean formula with priorities, denoted by boolğ‘. A prioritized
Boolean formula ğ¹ğ‘˜is the Boolean formula ğ¹with an optional
priority,ğ‘˜, which is used in a later part of the translation to assign
weights to the corresponding WCNF clauses. When ğ‘˜is omitted, it
represents ahardformula that mustbe satisfied.In Figure 4, functionğ‘€ğ‘†is used to translate soft constraints, i.e.,
constraintsthataredefinedaspartof softfactinAlloyMax.Given
a soft constraint soft factğ¹with priority ğ‘˜,ifğ¹isa conjunction of
Alloy formulas, ğ‘€ğ‘†translates each conjuncts into a soft constraint
alsowithpriority ğ‘˜(line17);otherwise, ğ‘€ğ‘†translatesthecontained
Alloy formula ğ¹by callingğ‘€and assigns ğ‘˜as its priority (line 18).
Functionğ‘€is used to translate Alloy formulas. Keywords in
vanillaAlloyfollowtheexistingtranslationrules.Foreachofthe
new keywords in AlloyMax(e.g.,maxsome ,minsome), the trans-
lation rule is similar to the existing rule, except additional prior-
itized Boolean formulas are introduced to instruct the solver to
search for a maximal or minimal solution. For instance, on line 21,
ğ‘šğ‘ğ‘¥ğ‘ ğ‘œğ‘šğ‘’ [ğ‘˜]ğ‘istranslatedby(1)statingthat ğ‘mustnotbeempty,
as it is done for ğ‘ ğ‘œğ‘šğ‘’in vanilla Alloy (line 20), and (2) including
aprioritizedBooleanformulaforthepresenceofeachtuplein ğ‘;
given the corresponding WCNF, a MaxSAT solver attempts to find
asolution that maximizesthe number of tuples in ğ‘.
Each prioritized Boolean formula is transformed into a CNF
formulawithapriorityforeachclausebyusingtheTseitintrans-
formation[ 44].Finally,aCNFformulawithpriorityistranslated
into a WCNF formula, to be solved by a MaxSAT solver. To guaran-
tee that a soft clause with a higher priorityis always satisfied first
before the clauses with lower priorities, its weight is assigned to
begreaterthanthesumofweightsofalltheclauseswithsmaller
priorities.Formally,let ğ¶ğ‘–representalltheclauseswithpriority ğ‘–.
Then, theirweight ğ‘Šğ‘–isassignedas:
ğ‘Šğ‘–=1+ğ‘–âˆ’1/summationdisplay.1
ğ‘—=0ğ‘Šğ‘—âˆ— |ğ¶ğ‘—| (4.1)
where|ğ¶ğ‘—|is the number of clauses of ğ¶ğ‘—andğ‘Š0=1. This kind
ofoptimizationiscalled lexicographicoptimization andusingthis
weightdistributionisaknownwayofconvertingittoMaxSAT[ 29].
Example. We use an example to illustrate one of the translation
rules(inparticular,rulefor maxsome online21inFigure 4).Con-
sider two relations ğ‘:ğ´Ã—ğµandğ‘:ğµÃ—ğ¶, whereğ´={ğ´1,ğ´2},
ğµ={ğµ1},andğ¶={ğ¶1}.Supposethatwewishtofindamodelthat
159ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece ChangjianZhang,Ryan Wagner, Pedro Orvalho, David Garlan,Vasco Manquinho, RubenMartins, andEunsuk Kang
ğ‘ƒ: problem â†’boolğ‘(1)ğ‘€[ğ‘inğ‘]ğ‘’=/logicalandtext.1(Â¬ğ‘‹[ğ‘]ğ‘’âˆ¨ğ‘‹[ğ‘]ğ‘’) (19)
ğ‘…: relDeclâ†’univDecl â†’matrix (2) ğ‘€[someğ‘]ğ‘’=/logicalortext.1(ğ‘‹[ğ‘]ğ‘’) (20)
ğ‘€: formula â†’envâ†’boolğ‘(3)ğ‘€[maxsome[k] ğ‘]ğ‘’=ğ‘€[someğ‘]ğ‘’âˆ§/logicalandtext.1(ğ‘‹[ğ‘]ğ‘’)ğ‘˜(21)
ğ‘€ğ‘†: softFormula â†’envâ†’boolğ‘(4)ğ‘€[minsome[k] ğ‘]ğ‘’=ğ‘€[someğ‘]ğ‘’âˆ§/logicalandtext.1(Â¬ğ‘‹[ğ‘]ğ‘’)ğ‘˜(22)
ğ‘‹: exprâ†’envâ†’matrix (5) ğ‘€[oneğ‘]ğ‘’=ğ¸ğ‘¥ğ‘ğ‘ğ‘¡ğ‘™ğ‘¦ğ‘‚ğ‘›ğ‘’ (ğ‘‹[ğ‘]ğ‘’) (23)
env:(quantVar âˆªrelVar) â†’matrix (6) ğ‘€[noğ‘]ğ‘’=/logicalandtext.1(Â¬ğ‘‹[ğ‘]ğ‘’) (24)
ğ‘€[softno[k]ğ‘]ğ‘’=/logicalandtext.1(Â¬ğ‘‹[ğ‘]ğ‘’)ğ‘˜(25)
âˆ’ â†’ğ‘¥,âŸ¨ğ‘–1,...,ğ‘–ğ‘˜âŸ©: vectors (7) ğ‘€[notğ¹]ğ‘’=Â¬ğ‘€[ğ¹]ğ‘’ (26)
[ğ‘š]: matrixâ†’ {âŸ¨ğ‘–ğ‘›ğ‘¡âŸ©},setofindicesofmatrix ğ‘š (8)ğ‘€[ğ¹andğº]ğ‘’=ğ‘€[ğ¹]ğ‘’âˆ§ğ‘€[ğº]ğ‘’ (27)
|ğ‘š|: matrixâ†’dim,dimensionofmatrix ğ‘š (9)ğ‘€[ğ¹orğº]ğ‘’=ğ‘€[ğ¹]ğ‘’âˆ¨ğ‘€[ğº]ğ‘’ (28)
M: dimâ†’ (âŸ¨intâŸ© â†’boolğ‘) â†’matrix,constructor (10)ğ‘€[allğ‘£:ğ‘|ğ¹]ğ‘’=let(ğ‘š=ğ‘‹[ğ‘]ğ‘’)in/logicalandtext.1
âˆ’ â†’ğ‘¥âˆˆ[ğ‘š](Â¬ğ‘š[âˆ’ â†’ğ‘¥] âˆ¨ğ‘€[ğ¹](ğ‘’:ğ‘£â†¦â†’ M(|ğ‘š|,âˆ’ â†’ğ‘¥)))(29)
M(ğ‘ ğ‘‘,ğ‘“)={ğ‘š| |ğ‘š|=ğ‘ ğ‘‘âˆ§
âˆ€âˆ’ â†’ğ‘¥âˆˆ {0,...,ğ‘ âˆ’1}ğ‘‘,ğ‘š[âˆ’ â†’ğ‘¥]=ğ‘“(âˆ’ â†’ğ‘¥)}(11)ğ‘€[someğ‘£:ğ‘|ğ¹]ğ‘’=let(ğ‘š=ğ‘‹[ğ‘]ğ‘’)in/logicalortext.1
âˆ’ â†’ğ‘¥âˆˆ[ğ‘š](ğ‘š[âˆ’ â†’ğ‘¥] âˆ§ğ‘€[ğ¹](ğ‘’:ğ‘£â†¦â†’ M(|ğ‘š|,âˆ’ â†’ğ‘¥)))(30)
M: dimâ†’ âŸ¨intâŸ© â†’matrix,constructor (12) ğ‘€[maxsome[k] ğ‘£:ğ‘|ğ¹]ğ‘’=ğ‘€[someğ‘£:ğ‘|ğ¹]ğ‘’âˆ§/logicalandtext.1(ğ‘‹[ğ‘]ğ‘’)ğ‘˜(31)
M(ğ‘ ğ‘‘,âˆ’ â†’ğ‘¥)=M(ğ‘ ğ‘‘,ğœ†âˆ’ â†’ğ‘¦.ifâˆ’ â†’ğ‘¦=âˆ’ â†’ğ‘¥thenğ‘¡ğ‘Ÿğ‘¢ğ‘’elseğ‘“ğ‘ğ‘™ğ‘ ğ‘’)(13)ğ‘€[minsome[k] ğ‘£:ğ‘|ğ¹]ğ‘’=ğ‘€[someğ‘£:ğ‘|ğ¹]ğ‘’âˆ§/logicalandtext.1(Â¬ğ‘‹[ğ‘]ğ‘’)ğ‘˜(32)
ğ‘‹[ğ‘+ğ‘]ğ‘’=ğ‘‹[ğ‘]ğ‘’âˆ¨ğ‘‹[ğ‘]ğ‘’ (33)
ğ‘ƒ[Ağ‘‘1,...,ğ‘‘ğ‘›ğ¹ ğ¹ğ‘†]=letğ‘’=/uniontext.1ğ‘›
ğ‘–=1(ğ‘Ÿğ‘–â†¦â†’ğ‘…[ğ‘‘ğ‘–]A)in
ğ‘€[ğ¹]ğ‘’âˆ§ğ‘€ğ‘†[ğ¹ğ‘†]ğ‘’(14)ğ‘‹[ğ‘&ğ‘]ğ‘’=ğ‘‹[ğ‘]ğ‘’âˆ§ğ‘‹[ğ‘]ğ‘’ (34)
ğ‘…[ğ‘Ÿ:ğ‘˜]A=M(|A|ğ‘˜,ğœ†âˆ’ â†’ğ‘¥ .freshVar() ) (15)ğ‘‹[ğ‘âˆ’ğ‘]ğ‘’=ğ‘‹[ğ‘]ğ‘’âˆ§Â¬ğ‘‹[ğ‘]ğ‘’ (35)
ğ‘‹[ğ‘Â·ğ‘]ğ‘’=ğ‘‹[ğ‘]ğ‘’Â·ğ‘‹[ğ‘]ğ‘’ (36)
ğ‘€ğ‘†[ğ¹ğ‘†andğºğ‘†]ğ‘’=ğ‘€ğ‘†[ğ¹ğ‘†]ğ‘’âˆ§ğ‘€ğ‘†[ğºğ‘†]ğ‘’ (16)ğ‘‹[ğ‘->ğ‘]ğ‘’=ğ‘‹[ğ‘]ğ‘’Ã—ğ‘‹[ğ‘]ğ‘’ (37)
ğ‘€ğ‘†[soft[k]ğ¹andğº]ğ‘’=ğ‘€ğ‘†[soft[k]ğ¹]ğ‘’âˆ§ğ‘€ğ‘†[soft[k]ğº]ğ‘’(17)ğ‘‹[~ğ‘]ğ‘’=(ğ‘‹[ğ‘]ğ‘’)ğ‘‡(38)
ğ‘€ğ‘†[soft[k]ğ¹]ğ‘’=(ğ‘€[ğ¹]ğ‘’)ğ‘˜,whereğ¹isnot aconjunction (18) ğ‘‹[^ğ‘]ğ‘’=ğ¼ğ‘¡ğ‘’ğ‘Ÿğ‘ğ‘¡ğ‘–ğ‘£ğ‘’ğ‘†ğ‘ğ‘¢ğ‘ğ‘Ÿğ‘’ (ğ‘‹[ğ‘]ğ‘’) (39)
ğ‘‹[{ğ‘£:ğ‘|ğ¹}]ğ‘’=let(ğ‘š=ğ‘‹[ğ‘]ğ‘’)in
M(|ğ‘š|,ğœ†âˆ’ â†’ğ‘¥ .ğ‘š[ğ‘¥] âˆ§ğ‘€[ğ¹](ğ‘’:ğ‘£â†¦â†’ M(|ğ‘š|,âˆ’ â†’ğ‘¥)))(40)
Figure4:Translationrules.boolğ‘isaBooleanformulawithprioritywhere ğ‘âˆˆN0.Whenğ‘isomitted,theformularepresents
ahard formulathat mustbe satisfied.Inother words, ithasan infinite priority,i.e. ğ¹=ğ¹+âˆ.
satisfiesthe following formula:
ğ‘šğ‘ğ‘¥ğ‘ ğ‘œğ‘šğ‘’ğ‘.ğ‘
Relationğ‘is represented by a set of Boolean variables {ğ‘00,ğ‘10}
(where,forexample, ğ‘00istrueifandonlyif (ğ´1,ğµ1)isatupleinğ‘);
similarly,ğ‘is represented by {ğ‘00}. Then, the formula is translated
intoaprioritizedBoolean formula as follows:
((ğ‘00âˆ§ğ‘00) âˆ¨ (ğ‘10âˆ§ğ‘00)) âˆ§ (ğ‘00âˆ§ğ‘00)0âˆ§ (ğ‘10âˆ§ğ‘00)0
where the first top-level conjunct says that ğ‘.ğ‘must contain at
least one tuple (equivalent to ğ‘ ğ‘œğ‘šğ‘’ ğ‘.ğ‘); the next two conjuncts
areformulaswiththelowestpriorityof0statingthat ğ‘.ğ‘should
contain as manyofthe twopossible tuples as possible.
To translate the above formula into CNF, the Tseitin transforma-
tionintroduces freshvariables that represent sub-formulas:
ğ‘â†”ğ‘00âˆ§ğ‘00, ğ‘â†”ğ‘10âˆ§ğ‘00
where{ğ‘,ğ‘}can also be seen as the variables representing the
tuples in relation ğ‘.ğ‘. Then, after the transformation, the following
prioritizedCNFisproduced:
(ğ‘âˆ¨ğ‘) âˆ§ğ‘0âˆ§ğ‘0âˆ§
(Â¬ğ‘âˆ¨ğ‘00) âˆ§ (Â¬ğ‘âˆ¨ğ‘00) âˆ§ (ğ‘âˆ¨Â¬ğ‘00âˆ¨Â¬ğ‘00) âˆ§
(Â¬ğ‘âˆ¨ğ‘10) âˆ§ (Â¬ğ‘âˆ¨ğ‘00) âˆ§ (ğ‘âˆ¨Â¬ğ‘10âˆ¨Â¬ğ‘00)
Finally, we translate this formula into WCNF to be solved by a
MaxSATsolver.Specifically,prioritiesarereplacedwithweightsbyEquation 4.1.Sinceğ‘0andğ‘0havepriority0,thustheyareassigned
weight1inthe final WCNFformula.
4.3 CorrectnessofTranslation
Amodelor aninstanceof an Alloy formula is an assignment of
tuples torelationsthat makes the formulatrue.AnAlloyproblem
mayhavemultiplemodels.Wecallthesetofallmodelsthe solution
spaceof a problem. When two problems have the same solution
space,we say that they are semantically equivalent .
Theorem 4.1. AnAlloyMaxproblemğ‘ƒ=âŸ¨A,ğ·,ğ¹,ğ¹ğ‘†âŸ©is seman-
tically equivalent to the problem ğ‘ƒâ€²=âŸ¨A,ğ·,ğ¹â€²,ğ‘¡ğ‘Ÿğ‘¢ğ‘’âŸ©whereğ¹ğ‘†,
the soft constraints, is replaced by ğ‘¡ğ‘Ÿğ‘¢ğ‘’, andğ¹â€²is the formula that
results from replacing ğ‘šğ‘ğ‘¥ğ‘ ğ‘œğ‘šğ‘’ andğ‘šğ‘–ğ‘›ğ‘ ğ‘œğ‘šğ‘’ inğ¹byğ‘ ğ‘œğ‘šğ‘’, and
ğ‘ ğ‘œğ‘“ğ‘¡ğ‘›ğ‘œbyğ‘¡ğ‘Ÿğ‘¢ğ‘’.
Proof.Toprovethistheorem,wefirststatethefollowinglemma:
Lemma4.1. AprioritizedBooleanformula ğ¹ğ‘˜withapriorityofa
finiteinteger(i.e.,asoftformulathatcanbesatisfiedornot)isse-
mantically equivalent to ğ‘¡ğ‘Ÿğ‘¢ğ‘’in the corresponding non-prioritized
Boolean formula.
Accordingtothislemma,byreplacingthesoftformulasinthe
translation ruleswith ğ‘¡ğ‘Ÿğ‘¢ğ‘’,we have:
â€¢ğ‘ ğ‘œğ‘“ğ‘¡[ğ‘˜]ğ¹(Figure4,line18) issemantically equivalentto ğ‘¡ğ‘Ÿğ‘¢ğ‘’;
160AlloyMax: Bringing Maximum Satisfaction to Relational Specifications ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece
â€¢ğ‘šğ‘ğ‘¥ğ‘ ğ‘œğ‘šğ‘’ [ğ‘˜]ğ‘(line 21)and ğ‘šğ‘–ğ‘›ğ‘ ğ‘œğ‘šğ‘’[ğ‘˜]ğ‘(line 22)are semanti-
cally equivalentto ğ‘ ğ‘œğ‘šğ‘’ğ‘(line20);
â€¢ğ‘ ğ‘œğ‘“ğ‘¡ğ‘›ğ‘œ[ğ‘˜]ğ‘Ÿ(line25) issemantically equivalentto ğ‘¡ğ‘Ÿğ‘¢ğ‘’;
â€¢ğ‘šğ‘ğ‘¥ğ‘ ğ‘œğ‘šğ‘’ [ğ‘˜]ğ‘£:ğ‘|ğ¹(line31)and ğ‘šğ‘–ğ‘›ğ‘ ğ‘œğ‘šğ‘’[ğ‘˜]ğ‘£:ğ‘|ğ¹(line32)
are semantically equivalentto ğ‘ ğ‘œğ‘šğ‘’ğ‘£:ğ‘|ğ¹(line30).
Then, given an AlloyMaxproblemğ‘ƒ, letğ‘ƒâ€²be the problem that
results from replacing all the soft facts with ğ‘¡ğ‘Ÿğ‘¢ğ‘’,ğ‘šğ‘ğ‘¥ğ‘ ğ‘œğ‘šğ‘’ and
ğ‘šğ‘–ğ‘›ğ‘ ğ‘œğ‘šğ‘’ withğ‘ ğ‘œğ‘šğ‘’,andğ‘ ğ‘œğ‘“ğ‘¡ğ‘›ğ‘œformulaswith ğ‘¡ğ‘Ÿğ‘¢ğ‘’.Based onthe
above list of statements about semantic equivalence, it follows that
amodelisasolutionto ğ‘ƒifandonlyifitisalsoasolutionto ğ‘ƒâ€².â–¡
Theorem 4.2. Given a MaxSAT solver that maximizes the total
weight of agiven WCNF formula, AlloyMaxgenerates the optimal
solution to the corresponding FOL problem.
Proof.This theorem can be proved by showing the correct-
ness of each optimization operator. We show the correctness for
ğ‘šğ‘ğ‘¥ğ‘ ğ‘œğ‘šğ‘’ only; otheroperators can be provedsimilarly.
Givenğ‘šğ‘ğ‘¥ğ‘ ğ‘œğ‘šğ‘’ [ğ‘˜]ğ‘,whereğ‘isarelation,let {ğ‘0,ğ‘1,...,ğ‘ğ‘›}
be the Boolean literals that represent the presence of tuples in ğ‘.
Then, the formula willbe translatedinto:
(ğ‘0âˆ¨ğ‘1âˆ¨...âˆ¨ğ‘ğ‘›) âˆ§ (ğ‘0)ğ‘˜âˆ§ (ğ‘1)ğ‘˜âˆ§...âˆ§ (ğ‘ğ‘›)ğ‘˜
Bymaximizingthetotalweightsofthisformula,thenumberofsatis-
fiedclausesofform ğ‘ğ‘–(forğ‘–â‰¤ğ‘›)isalsomaximized.Thus, AlloyMax
returns amodelwhere the size ofthe relation ğ‘ismaximized.
â–¡
5 OPTIMIZATION
ByencodingproblemsinMaxSAT, AlloyMaxcanpotentiallytake
advantageofadvancesinMaxSATtechnologytomoreefficiently
solve the underlying optimization problem. However, when en-
coding theproblem toa low-levelWCNF, thehigh-level structure
of the problem may be lost and become unavailable for MaxSAT
algorithms to take advantage of. Prior approaches try to recover
thisinformationbyclusteringsoftclausesintopartitionsandus-
ing them during solving [ 30,37]. However, these approaches are
heuristic-based and sometimes fail to capture meaningful relation-
ships between soft clauses. In this paper, we propose to extract the
partitioninformationdirectlyfromthe AlloyMaxsyntaxandgive
this information to existing partition-basedMaxSAT algorithms.
5.1 Partition-BasedMaxSATSolving
Webrieflypresentanoverviewofunsatisfiability-basedMaxSATal-
gorithmsthatusepartitionstrategies[ 30,37].Unsatisfiability-based
algorithmsworkbyfindingasequenceofunsatisfiablesubformu-
las that correspond to increasing a lower bound on the number
of falsified soft clauses until the formula becomes satisfiable and
an optimal solution is found. These algorithms can be extended
with partition strategies by taking as input the MaxSAT formula ğœ™
andpartitioningthisformulaintoformulas ğœ™1,...,ğœ™ğ‘›withdisjoint
set of soft clauses. Different approaches have been proposed to
partition a MaxSAT formula, but they are mostly based on hav-
ing a graph representation of the formula and then using graph
partitioning algorithms to create the partitions[ 30,37].
The MaxSAT solver then takes as input these partitions and
startsbysolving ğœ™1.Iftheformulaisunsatisfiable,thenthelowerbound onthe number of falsifiedsoft clauses isincreased, and the
formula is refined to allow one additional soft clause to be falsified.
This loopisrepeated until the formulabecomessatisfiable. In this
case, the algorithm found a solution to the formula that may or
maynotbeoptimal.Ifnomorepartitionsareleft,thenthissolution
is guaranteed to be optimal. Otherwise, the next partition is added
to the solver and this process is repeateduntil an optimal solution
is found. Partitioning has the benefit of potentially finding smaller
unsatisfiable subformulas at each iteration of the algorithm, which
often leads to a sequence of unsatisfiable formulas that is easier
to solve than without partitions. For further details on MaxSAT
algorithms, we refer the interestedreader to the literature [ 3].
5.2 Extracting Partitions from AlloyMax
Ourapproach,whichwecall spec-basedpartitioning ,changesthis
existingprocessbyusingpartitionsthatcanbeextracteddirectly
fromAlloyMaxasthetranslationtoMaxSATisperformed,rather
than trying to guess Å‚goodÅ¾ partitions at the WCNF level. In partic-
ular,partitionscan be generatedas follows.
â€¢When adding a hard clause to the WCNF, it is assigned group 1.
Allthe hardclauses inthe WCNFbelong to the same group.
â€¢When translating an Alloy formula with optimization operators,
i.e.,maxsome,minsome,andsoftno,AlloyMaxcreatesanewgroup
ğ‘”. Then, all the soft clauses associated with this optimization
operator are assignedgroup ğ‘”.
â€¢When translating a soft constraint, i.e., soft factğ¹,AlloyMax
creates a new group ğ‘”â€²for it. Thus, each soft constraint is in its
owngroup.
A common pattern that we leverage for creating partitions in
AlloyMaxis to use the allkeyword. For example, consider set ğ‘ƒ
andğ‘„,andarelation ğ‘Ÿ:ğ‘ƒÃ—ğ‘„.Forformula allğ‘:ğ‘ƒ|maxsomeğ‘.ğ‘Ÿ,
theall(âˆ€) operator will be expanded to generate a maxsomeğ‘.ğ‘Ÿ
formulaforeach ğ‘âˆˆğ‘ƒ.Eachmaxsome formulawillbeinaseparate
group, and we can easily partition the soft clauses by the tuples in
setğ‘ƒ. For example, recall the course scheduling problem in Section
2.2.The soft fact formula
1soft fact {
2ThuAM ! inAlice.courses.lectures
3FriPM ! inAlice.courses.lectures
4}
is first translated into two soft facts (Figure 4, line 17), and a group
iscreatedfor eachofthesesoft facts. In addition,the formula
1allstu:Student |maxsome stu.interests & stu.courses
generatesagroupforeachstudent.Then,thesolverwillfirsttryto
optimize each group individually and merge the results to find the
globaloptimal solution.
InSection 6.3,wecomparethegraph-basedpartitioningstrategy
usedinMaxSATalgorithmswith AlloyMaxpartitioningandshow
the benefitofextracting partitionsfrom ahigh-level model.
6 EVALUATION
We evaluate AlloyMaxbasedonthe following research questions:
RQ1: How useful is AlloyMaxfor modeling different types of prob-
lems?For usefulness,we focuson applicability andscalability .
RQ2: Is spec-based partitioning more efficient than no-partitioning
and graph-based auto-partitioning?
161ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece ChangjianZhang,Ryan Wagner, Pedro Orvalho, David Garlan,Vasco Manquinho, RubenMartins, andEunsuk Kang
RQ3:IsAlloyMaxmoreefficientthan Alloy*forgeneratingoptimal
solutions? Alloy* [33] is an extension that enables an analysis with
higher-orderquantifiers, soitcould, inprinciple,be usedtosolve
problemsthatgenerateanoptimalsolutionastheoneinSection 2.1.
This question aims at comparing which approach is more efficient
inthis particulartype ofproblem.
Toanswertheseresearchquestions,weapply AlloyMaxtofive
case studies from different domains. Section 6.2gives brief intro-
ductions to eachcasestudy andpresents the optimization goals.
6.1 Implementation
We implemented AlloyMaxbased on Alloy 5.1.0, which, in turn, re-
lies on Kodkod, a general-purpose relational model finder [ 42]. We
extended Alloy to support the new syntax, and also modified Kod-
kodtosupportthenewtranslationprocess.WeuseOpen-WBO[ 31]
asourbackendMaxSATwiththesamealgorithmforbothpartition-
ingandnon-partitioning.Forspec-basedpartitioning,weextended
theWCNFformattoallowspecifyinggroupindexatthebeginning
ofeachclause.WemodifiedOpen-WBOtoreadthisnewfileformat
andchangedthepartitionstrategytousetheonespecifiedinthe
file. All the experiments were run on a Linux machine with a 4
core 3.6GHZ CPU and 20 GB memory. Every problem was run 5
times (each with a 30 minutes timeout), from which the average
was computed and reported in Table 2. The benchmark and tool
are available for reproduction2.
6.2 CaseStudies
6.2.1 CourseScheduling. Recallthecourseschedulingmodelde-
scribed in Section 2. In this benchmark, we randomly generate
problemswith ğ¶coursesand ğ‘†students;acourseshouldhaveei-
thertwoorthreelectures among a week; each student should take
at mostğ‘…core courses andisinterestedinat most ğ¼courses.
Theoptimizationgoalistomaximizethenumberofinterested
courses that a student is registered for. The problem names in
Table2follow the pattern ğ‘ğ‘œğ‘¢ğ‘Ÿğ‘ ğ‘’_{ğ¶}_{ğ‘†}_{ğ‘…}_{ğ¼}. The size of
the AlloyMaxspecifications ranges from 252to 552LOC.
6.2.2 CheckMate. CheckMate[ 43]isanautomated toolbasedon
Alloy for synthesizingproof-of-concept exploit code forhardware
securityattackssimilartoMeltdown[ 24]andSpectre[ 20].Itusesa
Å‚micro-architecturallyhappens-beforeÅ¾graph[ 25],denotedas ğœ‡hb,
to model and analyze the execution process of micro-operations.
In a CPU, an instruction goes through a sequence of stages to
be executed (e.g., Fetch, Exec., and Commit). Then, a ğœ‡hb graph
representstheexecutionprocessofaseriesofprograminstructions.
An attack pattern (e.g., Meltdown or Spectre) is represented as a
sub-graphpatternin ğœ‡hb.CheckMatemodelsthemicro-architecture
ofaCPU,theeventsofinstructions,andtheattackpatterninAlloy,
and uses the Alloy Analyzer to generate a ğœ‡hb graph that contains
theattackpattern. Moreover,CheckMateaimstosynthesize secu-
rity litmus tests, i.e., most compactprograms that can demonstrate
a security attack. However, since this optimization goal cannot be
solvedbyAlloy,theauthorsofCheckMatedevelopedanadditional
Pythonprogramtoenumerateallthepossibleinstancesandfind
the litmus tests.
2https://github.com/SteveZhangBit/alloy-maxsat-benchmarkWithAlloyMax,thisoptimizationtaskcanbeformulatedasmin-
imizing the relation that represents the ğœ‡hb graph. In particular,
thisgoalismodeledbyusing softno,allisusedforleveragingparti-
tioning(asshownbelow),andthereturnedinstancecontainsthe
smallestğœ‡hbgraph, whichrepresents asecurity litmus test.
1run{
2...// CheckMate constraints
3alln: Node |softno n.uhb
4}
The original CheckMate model is around 1,100 LOC in Alloy; to
specify the optimization goal, it only involved adding the above
softnoformula to the specification.
6.2.3 Graceful Degradation. In networksecurity, asimple way of
mitigating an on-going attack is to shut down the entire system.
Inpractice,however,thisisunacceptablebecausethesystemwill
loseallofitsfunctions. Gracefuldegradation [13,46]isanapproach
fordynamicallyre-configuringpartsofasystemunderanattack
to maximize the remaining uncompromised functions. Typically,
thisisachievedby(1)shuttingdownonlythosecomponentsthat
have been compromised, and (2) replacing these components with
backups(ifavailable)tomaintaintheaffectedfunctions.Thisrecon-
figuration process also involves removing network connections to
thecompromisedcomponentsandaddingnewonestothebackups.
Alloycanbeusedtomodelandanalyzetheproblemofgenerating
avalidnetworkreconfigurationthatmaintainsallsystemfunctions.
However,dependingontheextentofanattack,itmaybeimpossible
torestoresomeofthosefunctions.Todeterminewhichofthemcan
berestored,theAlloyusercouldmanuallycommentoutaselection
of constraints that correspond to the functions, but the process to
findanoptimalsolution(i.e.,onethatrestoresasmanyfunctions
as possible) wouldbe tedious.
WithAlloyMax, we usesoft factto model the functions as soft
constraints(line 4-6).Giventhese, thesolverwilltrytomaximize
the functions and give up on ones that are unsatisfiable. Moreover,
in practice, every change to the architecture could have a cost, and
the total cost (the number of architectural modifications) should
also be minimized. Thus, we use maxsome to maximize the over-
lapping connections between the degraded architecture and the
initial one (line 9), and use softnoto minimize the new connections
addedtothedegradedarchitecture (line 10).Furthermore,system
function is considered more important than cost. Thus, soft con-
straintsrepresentingthefunctionsareassignedahigherpriority.
The following snippetshowsour optimization goals.
1sigComponent {
2init:setComponent, degraded: setComponent
3}
4soft[1]fact{
5NonCriticalFunction andCriticalFunction
6}
7run{
8validArchitecture [degraded ]
9maxsome degraded & init
10softno degraded - init
11}
In our benchmark, each problem has ğ¶components including
backupones;theattackerâ€™scapability(intermsofthedegreethat
thesystemmightbecompromised)issetto ğ¾,and;eachproblemhas
ğ´initiallycompromisedcomponents.Theproblemnamesfollow
162AlloyMax: Bringing Maximum Satisfaction to Relational Specifications ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece
thepattern ğ‘‘ğ‘’ğ‘”ğ‘Ÿğ‘ğ‘‘ğ‘’_{ğ¶}_{ğ¾}_{ğ´}.Thesizeofthespecifications
ranges from 240to 326LOC.
6.2.4 Wedding Table Seating. Consider a wedding table seating
problem[ 32],where(1)eachtableseatsaminimumandamaximum
numberofguests;(2)eachpersonshouldbeassignedtoonlyone
table;(3)eachpersonisassociatedwithasetoftagsindicatingtheir
interests.Thehardconstraintistogenerateaseatingassignmentfor
each person, and the optimizationgoal is to minimize the number
ofdifferenttags between allpeople sitting at the same table.
Alloycanbeusedtomodelthisproblemandgenerateanarbi-
traryassignment.Thefollowingsnippetshowsrelevantconstraints.
1sigTag{}
2sigPerson {tags:setTag}
3sigTable{seat:setPerson } {
4#seat =< MAX_NUM_PERSON // Maximum number of guests.
5#seat >= MIN_NUM_PERSON // Minimum number of guests.
6}
7// One seat for one person.
8fact{allp: Person |oneseat.p }
9run{}
However,withthismodel,wecannotfindtheoptimalsolutionthat
minimizesthenumberofdifferenttagsatatable.With AlloyMax,
this optimization goal can be modeled by using softno. In partic-
ular, to take advantage of the partitioning optimization, the goal
isspecifiedas,foreachtable,itshouldhavenoorminimizedtags.
The following expresses this optimization goal.
1runTableBased {allt: Table |softno t.seat.tags }
For the benchmark, we randomly generated problems with ğº
tags,ğ‘‡tables, and ğ‘ƒpeople, where each table has minimum ğ¿
and maximum ğ»people, and each person has maximum ğ‘€tags.
The problem names follow the pattern ğ‘ ğ‘’ğ‘ğ‘¡_{ğº}_{ğ‘ƒ}_{ğ‘€}_{ğ‘‡}
_{ğ¿}_{ğ»}. The size of the specifications ranges from 50 to 55 LOC.
6.2.5 SingleMachineScheduling(SMS). Inmanyreal-timesystems,
it is often impossible to schedule tasks to make them meet all their
timerequirements.Inpractice,onemustschedulethetasksinsuch
a way to can maximize the number of on-time tasks [ 22]. Consider
a real-timesystem with a setof ğ‘›tasks{ğœ1,...,ğœğ‘›}to be executed
onauni-processormachine,i.e.,onlyonetaskcanbeexecutedata
time.Eachtaskisatriple âŸ¨ğ‘Ÿğ‘–,ğ‘ğ‘–,ğ‘‘ğ‘–âŸ©whereğ‘Ÿğ‘–isthereleasetime(i.e.,
the earliest start time), ğ‘ğ‘–the processingtime, and ğ‘‘ğ‘–the deadline.
Taskscanbesplitintofragmentssothatonetaskcanbeinter-
ruptedinordertoexecutefragmentsofothertasks.However,the
executionorderofthefragmentsofonetaskshouldnotbechanged.
Formally,atask ğœğ‘–hasğ‘˜ğ‘–fragmentsandeachfragment ğ‘“ğ‘—
ğ‘–where
ğ‘—âˆˆ {1,...,ğ‘˜ğ‘–}has process time ğ‘ğ‘—
ğ‘–, and we have/summationtext.1ğ‘˜ğ‘–
ğ‘—=1ğ‘ğ‘—
ğ‘–=ğ‘ğ‘–.
Finally,ataskmaydependonothertasks.Thus,ifatask ğœğ‘–depends
ontaskğœğ‘—,ğœğ‘–mustbe executedonly after ğœğ‘—has been completed.
Alloycanbeusedtomodelthisproblemandfindanarbitrary
subset of tasks that can complete within their deadlines. However,
themaximalityisnotguaranteed.With AlloyMax,weusemaxsome
tofindtheoptimalschedulewhichmaximizesthenumberofon-
time tasks.The following snippetshowsthe optimization goal.
1sigTask{}sigCompleted inTask{}
2run{
3CompleteOntime [Completed ]
4maxsome Completed }Inourbenchmark,werandomlygenerateproblemswith ğ‘tasks.
Thereleasetimeofeachtaskiswithinatimeframe ğ‘…;eachtaskhasa
maximumprocessingtime ğ‘ƒ,andamaximumnumberoffragments
ğ¹. A slack factor ğ‘†is used to compute the deadline for each task
whereğ‘‘ğ‘–=ğ‘Ÿğ‘–+ğ‘Ÿğ‘ğ‘›ğ‘‘ğ‘œğ‘š(1,ğ‘†) âˆ—ğ‘ğ‘–. Finally, a task depends on a
maximumnumberof ğ·tasks.Theproblemnamesfollowthepattern
ğ‘ ğ‘šğ‘ _{ğ‘}_{ğ‘…}_{ğ‘ƒ}_{ğ¹}_{ğ‘†}_{ğ·}. The size of the specifications
ranges from 192to 259LOC.
6.3 Results
6.3.1 RQ1:Howusefulis AlloyMaxformodelingdifferenttypesof
problems? We successfully modeled the aforementioned problems
withAlloyMax(or migrate from existing ones). It only requires
appendingtheoptimizationformulastotheoriginalruncommands
inplain Alloy withoutany reconstruction.
Table2,firstcolumnshowstheproblemsusedinourbenchmark.
Theproblemnamereflectsthescaleofeachproblem.Specifically,
the size of the AlloyMaxspecifications for these problems ranges
from 50 LOC to 1,109 LOC. The number of variables in the gen-
eratedWCNFrangesfrom2,236to24,583,678,andthenumberof
clauses ranges from 6,921 to 43,729,378. Although translating from
a high-level language like AlloyMaxmay not produce the most suc-
cinct MaxSAT formulas, it can solve all these problems within a 30
minutestimeout.
6.3.2 RQ2: Is spec-based partitioning more efficient than no- par-
titioning and graph-based auto-partitioning? The results in Table
2show that spec-based partitioning outperforms both no- and
auto-partitioning in Course, CheckMate, and Seating problems. On
SMS, spec-based partitioning shows little improvement over no-
partitioningbecausetheseproblemsdonothaveanatural,problem-
specific way of partitioning; as a result, the solver falls back to
no-partitioning.Ontheotherhand,spec-basedpartitioninghasa
negativeimpactonthefirstthreeDegradationproblems.Moreover,
we have the following observations andinsights:
â€¢When partitioning is applicable, spec-based partitioning outper-
formsauto-partitioning,because(1)theformerdoesnotsuffer
from the overhead introduced by the heuristic for guessing par-
titions, which can be significant for large problems, and the
heuristicmayfailandfallbacktono-partitioning(e.g.,inCheck-
MateandDegradation),and(2)auto-partitioningmightfailto
guess effective partitions (e.g., Seating problems where spec-
basedimproves the performance but autodoes not).
â€¢Whenpartitioningisnotapplicable(i.e.,onlyonepartitionex-
ists), spec-based partitioning falls back to no-partitioning. On
theotherhand,forcingauto-partitioninginthissituationmay
have negative impact onperformance (e.g.,SMS).
â€¢We hypothesize that partitioning works well if the optimal solu-
tion of a sub-problem (hard clauses plus some partitions) is part
oftheglobaloptimalsolution.TheCourseproblemshavethis
property, since there are no registration limits on the number of
students for each course, and the registration for each student is
completely independent of one another.
â€¢We observed in the Degradation problems that if a partition
addedtotheiterativeprocessdoesnothelprefinethesolution
towardstheoptimalone,theoverheadoftheiterationmayex-
ceed the time of solving the problem at once. In other words,
163ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece ChangjianZhang,Ryan Wagner, Pedro Orvalho, David Garlan,Vasco Manquinho, RubenMartins, andEunsuk Kang
Table 2: Results for comparing MaxSAT non-partitioning vs. MaxSAT partitioning vs. Alloy*. The numbers in the table are
the solving time of the MaxSAT solver or the solver for Alloy* (i.e., excluding the translation time). There is no significant
difference in translation time among these methods. * indicates auto-partition fails because the problem is too large and it
falls backto no-partition.** indicates onlyonepartition existsintheproblemanditfalls backto no-partition.
Problem No-Part. Solve (s) Auto-Part. Solve (s) Spec-Part.Solve (s) Alloy* Solve (s)
Coursecourse_30_40_3_6 0.93 0.19 0.17 112.08
course_40_50_3_6 3.90 0.42 0.31 437.72
course_50_60_3_6 11.84 0.78 0.62 860.49
course_60_70_3_6 31.38 1.14 0.90 1607.65
course_70_80_3_6 74.83 1.89 1.47 T/O
course_80_90_3_6 175.40 2.96 2.09 T/O
course_90_100_3_6 277.93 4.72 3.09 T/O
CheckMateFlush+Reload 123.01 133.60* 94.68 N/A
Meltdown 353.74 368.13* 272.35 N/A
Spectre 634.55 660.15* 520.91 N/A
Seatingseat_7_28_7_6_3_7 3.06 7.19 1.76 26.47
seat_7_30_7_6_3_7 0.70 1.23 0.65 52.27
seat_8_30_8_7_3_7 133.55 54.78 35.36 239.21
seat_8_32_8_7_3_7 513.73 619.33 349.20 T/O
SMSsms_34_20_6_3_3_2 20.06 31.00 20.05** 479.84
sms_38_20_6_3_3_2 19.13 35.12 19.47** 863.60
sms_42_20_6_3_3_2 21.71 52.12 20.63** 1464.60
sms_46_20_6_3_3_2 186.98 263.31 184.93** T/O
sms_50_20_6_3_3_2 179.86 173.91 186.74** T/O
sms_52_20_6_3_3_2 81.22 198.73 85.21** T/O
Degradationdegrade_10_2_1 0.26 0.77 0.28 N/A
degrade_26_2_1 25.55 43.08* 27.76 N/A
degrade_20_3_1 659.46 673.30* T/O N/A
degrade_26_2_2 1442.41 1453.32* 898.7 N/A
partitioning works well when every sub-problem contributes
towardsthe optimal solution.
6.3.3 RQ3: Is AlloyMaxmore efficient than Alloy*for generating
optimalsolutions? AsshowninTable 2,bothwithorwithoutpar-
titioning, AlloyMaxoutperformsAlloy* onoptimizationproblems
that can be specified using higher-order quantifiers. Alloy* is a
general-purposehigher-ordersolver(canbeusedtosolveproblems
thatAlloyMaxis not applicable to), and so its analysis methodÃ
basedoncounterexample-guidedinductivesynthesis(CEGIS)[ 40]Ã
isnotspecificallytargetedforsolvingoptimizationproblems.On
the other hand, since MaxSAT is designed for solving optimization,
it is expected that AlloyMaxoutperforms Alloy* on such problems.
We did not apply Alloy* to CheckMate because it would re-
quire significantly reconstructing the specification to express a
higher-orderformulathatquantifiesoverallrelevantrelationsto
be searched (e.g., relations representing various properties of an at-
tackgraphtobeminimized).Duetothecomplexityofthisproblem,
there are 40 such relations, and so this would result in a formula
withaquantifierdepthof40ÃnotanAlloyexpressionthatauser
can reasonably be expected to write. In contrast, AlloyMaxintro-
ducesonlyonelineofanoptimizationformulawithoutchangingtheexistingspecification;thisalsoshowsthebenefitofthebuilt-in
constructsinAlloyMaxfor specifying optimization tasks.
Alloy* is not applicable to degradation problems, which contain
soft constraintsthat cannotbe specifiedinorsolvedbyAlloy*.
6.3.4 Validation of Implementation. We manually checked the cor-
rectnessoftheresultsfrom AlloyMaxfortheproblemswherethe
optimalsolutionsareknown,includingCheckMate,gracefuldegra-
dation,andsomesubsetofthecoursescheduling,seating,andSMS
problems. Also, for those problems in Table 2that can be solved
byAlloyâˆ—, we checked that AlloyMaxandAlloyâˆ—produce the same
optimal solutions.
6.3.5 ThreatstoValidity. Ourselectedcasestudiesmightnotbe
representativeenoughtodemonstratetheapplicabilityof AlloyMax.
We believe that our benchmark contains a diverse set of exam-
ples from realistic domains (including exploit generation, network
reconfiguration, and task scheduling) and of varying sizes (from
relatively simple models like wedding seating to complex ones like
CheckMate).However,weplantocontinuallyexpandourbench-
marktoexploreotherpotentialapplicationsof AlloyMaxandfurther
refine ormodify the languageas neededfor newuse cases.
In addition, the size of the problems in our benchmark might
not be large enough to show how well AlloyMaxscales to other
164AlloyMax: Bringing Maximum Satisfaction to Relational Specifications ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece
Alloy problems in practice. Given that CheckMate is one of the
most complex Alloy specifications available (based on our past
experiencewithAlloy)andalsohasbeenusedtogeneratepracti-
calattacksonrealsystems[ 43],webelievethatourexperiments
show that AlloyMaxscales well to realistic problems. In addition,
since its scalability depends on the efficiency of the underlying
MaxSAT solver, AlloyMaxwill likely benefit from further advances
inMaxSATtechnology,whichisan active area ofresearch[ 2].
7 RELATED WORK
Extensions to Alloy. Alloyâˆ—[33] is an Alloy extension that en-
ables analysis of Alloy specifications with higher-order quantifiers.
Although Alloyâˆ—isdesignedforadifferentpurposethan AlloyMaxÃ
mainly,enablingsynthesisproblemsinAlloyÃitcouldbeusedto
encode certain types of optimization problems by using higher-
orderquantifiers,asshowninSection 2.1.However,asshownin
Section6.3,AlloyMaxoutperforms Alloyâˆ—on these problems, in
partbecausetheformerleveragesMaxSATsolvers,whicharede-
signedforfindingoptimalsolutions.Inaddition, AlloyMaxprovides
additionalanalysesinvolving soft constraintsandpriorities.
Aluminum [ 35] is an extension of Alloy that supports genera-
tion ofminimal instances . Aluminum and AlloyMaxare designed
for different purposes and differ on the notion of minimality. In
particular,theformerworksbyautomaticallyremovingasmany
tuplesaspossiblesuchthattheresultinginstanceremainsavalid
instance of the given Alloy specification, and allows the user to
influence theorder in which Alloygenerates its next instances by
augmentingthe currentinstancewithan additionaltuple.
Cunhaet.al[ 8]proposeanapproachcalled target-orientedmodel
finding,wherethegoalistoallowtheusertoprovideapartialspeci-
ficationofa targetinstance,anduseasolvertogenerateaninstance
thatisas closetothetargetaspossible.Theirworkalsoleverages
anextensionofKodkodwithaMaxSATsolverastheunderlying
engine,although its overallgoalisdifferentfrom AlloyMax.
Other types of solvers. There is a large body of work on con-
strained optimization problems (COPs)Ãa generalization of con-
straintsatisfactionproblems(CSPs)withanadditionalnotionofan
objective function to be optimized [ 38]. The state-of-the-art tools in
this domain (e.g., Gurobi [ 12], CPLEX [ 14]) employ solving tech-
niques that are different from MaxSAT, such as Branch and Cut
algorithms[ 38].SincetheAlloyAnalyzeralreadyreliesonSAT,we
found MaxSAT to be a natural choice for bringing optimization to
Alloy. Using a COP solver as an alternative backend to AlloyMax
is an interesting open problem, although it would involve a sig-
nificantly differenttranslation thantheSAT-basedoneinKodkod
(whichAlloyMaxbuilds on).
MiniZinc[ 36]isaconstraintmodelinglanguagethatiscapableof
solving various types of CSPs, including optimization. Built on top
ofsolverssuchGurobiorCPLEX,MiniZincisintendedtobeahigh-
levellanguageforspecifyingCSPsandprovidesconvenientbuilt-in
such as functions, data types, and global constraints. MiniZinc
providescertainfeatures(e.g.,floatingnumbers)thataremissing
fromAlloyMax, while the relational core of Alloy is better suited
for specifying complex structures that ariseinsoftware.
Answer set programming (ASP) [ 23] is a line of work on ex-
tending logic programming with capabilities for expressing andsolvingsearchproblems,includingthoseinvolvingoptimization[ 6].
Although both are declarative in nature, ASP and AlloyMaxsup-
port distinct styles of modeling: The logic programming paradigm
underlying ASP is typically used for data and knowledge represen-
tation[7],whileAlloywasdesignedformodelingsoftwaredesigns.
Therearerecentworksonextendingsatisfiabilitymodulothe-
ories (SMT) solvers with optimization capabilities, such as Opti-
MathSAT[ 39],Symba[ 21],andZ3[ 5].Thesesolverscouldserveas
analternativebackendfor AlloyMax.Onebenefit ofthisapproach
is that they operate over unbounded domains and for formulas
involving decidable theories (e.g., integers), can provide a stronger
analysisguaranteethanaSAT-basedbackend.Ontheotherhand,
dedicatedMaxSATalgorithmshaveshowntobemoreefficientthan
theSMT-basedmethods[ 26].Amoresystematicinvestigationof
thesealternative backends for AlloyMaxremainsfuture work.
8 CONCLUSION AND LIMITATIONS
Wehavepresented AlloyMax,anextensionoftheAlloymodeling
languagethatleveragesMaxSATtosolveoptimizationproblems.
Wehavedemonstratedthatdespiteintroducingonlyasmallnumber
ofnewlanguageconstructs, AlloyMaxcanbeusedtospecifyand
solveadiversesetofproblemsthatwerepreviouslynotpossible
in Alloy. By enabling these new types of analyses, we believe that
AlloyMaxhasthepotentialtobringawiderangeofnewapplications
to Alloy, and its analysis capability will continue to grow as it
benefitsfrom rapid progress inthe MaxSAT technology.
The translation rules shown in Section 4support a richer se-
manticsthanthecurrentsyntaxof AlloyMaxallows.Forexample,
the rules support defining softpredicates (e.g., softpred P[x: S])
and reusethem inother formulas.We planto explore thesericher
semantics throughfurther syntactic extensions (whilealso consid-
eringthe possiblerisk of complicating thesyntax) andinvestigate
additionalclassesofproblems that AlloyMaxcould be appliedto.
The current version of AlloyMaxsupports only priorities among
constraints.However,MaxSATsolversgenerallyuseweights,which
support more fine-grained optimizations. Adding weights to Alloy
requires more subtle investigation on its semantic impact, but it
could support a larger set of problems, such as modeling and maxi-
mizingutilityfunctions(e.g.,thoseusedinself-adaptivesystems
planners [ 41]andautomateddata mismatchrepair[ 45]).
ACKNOWLEDGMENTS
This work is supported in part by the National Science Foundation
Awards CCF-1918140, CNS-1801546, and CCF-1762363, the Fun-
daÃ§Ã£oparaaCiÃªnciaeTecnologiaAwardsPTDC/CCI-COM/31198/2-
017, UIDB/50021/2020, and SFRH/BD/07724/2020, and the Office of
Naval Research Award N00014172899. This material is based upon
worksupportedbytheNSAunderAwardNo.H9823018D0008.This
workisalsosupportedbytheCarnegieMellonCyLabSecurityand
Privacy Institute. Any views, opinions, findings and conclusions
or recommendations expressed in this material are those of the
author(s)anddonotnecessarilyreflecttheviewsofthesponsoring
agencies.
165ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece ChangjianZhang,Ryan Wagner, Pedro Orvalho, David Garlan,Vasco Manquinho, RubenMartins, andEunsuk Kang
REFERENCES
[1]Devdatta Akhawe, Adam Barth, Peifung E. Lam, John Mitchell, and Dawn Song.
2010. TowardsaFormalFoundationofWebSecurity.In 201023rdIEEEComputer
SecurityFoundationsSymposium . 290Å›304. https://doi.org/10.1109/CSF.2010.27
[2]FahiemBacchus,JeremiasBerg,MattiJÃ¤rvisalo,andRubenMartins.2020. MaxSAT
Evaluation2020:SolverandBenchmarkDescriptions . TechnicalReport.University
of Helsinki, Department of Computer Science.
[3]Fahiem Bacchus, Matti JÃ¤rvisalo, and Ruben Martins. 2021. Maximum Satis-
fiability. In Handbook of Satisfiability , Armin Biere, Marijn Heule, Hans van
Maaren, and Toby Walsh (Eds.). IOS Press, Chapter 24, 929 Å› 991. https:
//doi.org/10.3233/FAIA201008
[4]HamidBagheri,EunsukKang,SamMalek,andDanielJackson.2015. Detectionof
DesignFlawsintheAndroidPermissionProtocolThroughBoundedVerification.
InFM 2015: Formal Methods , NikolajBjÃ¹rner and Frank deBoer (Eds.).Springer
InternationalPublishing,Cham,73Å›89. https://doi.org/10.1007/978-3-319-19249-
9_6
[5]Nikolaj BjÃ¹rner, Anh-Dung Phan, and Lars Fleckenstein. 2015. ğœˆZ - An Opti-
mizing SMT Solver. In Tools and Algorithms for the Construction and Analysis
ofSystems ,ChristelBaierandCesareTinelli(Eds.).SpringerBerlinHeidelberg,
Berlin, Heidelberg, 194Å›199. https://doi.org/10.1007/978-3-662-46681-0_14
[6]GerhardBrewka,Ilkka NiemelÃ¤,and MiroslawTruszczynski.2003. AnswerSet
Optimization.In InternationalJointConferenceonArtificialIntelligence(IJCAI) ,
Georg Gottlob and Toby Walsh (Eds.).
[7]Stefano Ceri, Georg Gottlob, and Letizia Tanca. 1990. Logic Programming and
Databases . Springer. https://www.worldcat.org/oclc/20595273
[8]Alcino Cunha, Nuno Macedo, and Tiago GuimarÃ£es. 2014. Target Oriented
RelationalModelFinding.In FundamentalApproachestoSoftwareEngineering ,
Stefania Gnesi and Arend Rensink (Eds.). Springer Berlin Heidelberg, Berlin,
Heidelberg, 17Å›31. https://doi.org/10.1007/978-3-642-54804-8_2
[9]Greg Dennis, Felix Sheng-Ho Chang, and Daniel Jackson. 2006. Modular Ver-
ification of Code with SAT. In Proceedings of the 2006 International Sympo-
sium on Software Testing and Analysis (Portland, Maine, USA) (ISSTA â€™06) . As-
sociation for Computing Machinery, New York, NY, USA, 109Å›120. https:
//doi.org/10.1145/1146238.1146251
[10]Yu Feng, Osbert Bastani, Ruben Martins, Isil Dillig, and Saswat Anand. 2017. Au-
tomatedSynthesisofSemanticMalwareSignaturesusingMaximumSatisfiability.
InProceedings of the Annual Network and Distributed System Security Symposium .
The Internet Society. http://arxiv.org/abs/1608.06254
[11]Ana GraÃ§a, JoÃ£o Marques-Silva, and InÃªs Lynce. 2011. Haplotype Inference Using
PropositionalSatisfiability . SpringerNewYork,NewYork,NY,127Å›147. https:
//doi.org/10.1007/978-1-4419-6800-5_7
[12]GurobiOptimization.2021. GurobiOptimizerReferenceManual. http://www.
gurobi.com
[13]M P Herlihy and J M Wing. 1991. Specifying graceful degradation. IEEE
Transactions on Parallel and Distributed Systems 2, 1 (1991), 93Å›104. https:
//doi.org/10.1109/71.80192
[14]InternationalBusiness MachinesCorporation(IBM).2009. V12. 1:Userâ€™sManual
for CPLEX.
[15]Daniel Jackson. 2000. Automating First-Order Relational Logic. In Proceedings of
the 8th ACM SIGSOFT International Symposium on Foundations of Software Engi-
neering:Twenty-FirstCenturyApplications (SanDiego,California,USA) (SIGSOFT
â€™00/FSE-8) . Association for Computing Machinery, New York, NY, USA, 130Å›139.
https://doi.org/10.1145/355045.355063
[16]DanielJackson.2006. SoftwareAbstractions:Logic,language,andanalysis . MIT
Press.
[17]Daniel Jackson and Mandana Vaziri. 2000. Finding bugs with a constraint solver.
InInternational Symposium on Software Testing and Analysis (ISSTA) . 14Å›25.
https://doi.org/10.1145/347324.383378
[18]Eunsuk Kang, Aleksandar Milicevic, and Daniel Jackson. 2016. Multi-
RepresentationalSecurityAnalysis.In Proceedingsofthe201624thACMSIGSOFT
International Symposium on Foundations of Software Engineering (Seattle, WA,
USA)(FSE 2016) . Association for Computing Machinery, New York, NY, USA,
181Å›192. https://doi.org/10.1145/2950290.2950356
[19]Sarfraz Khurshid and Darko Marinov. 2004. TestEra: Specification-Based Testing
of Java Programs Using SAT. Autom. Softw. Eng. 11, 4 (2004), 403Å›434. https:
//doi.org/10.1023/B:AUSE.0000038938.10589.b9
[20]PaulKocher,JannHorn,AndersFogh,DanielGenkin,DanielGruss,WernerHaas,
MikeHamburg,MoritzLipp,StefanMangard,ThomasPrescher,MichaelSchwarz,
and Yuval Yarom. 2019. Spectre Attacks: Exploiting Speculative Execution. In
2019 IEEESymposiumonSecurity andPrivacy (SP) .1Å›19.https://doi.org/10.1109/
SP.2019.00002
[21]Yi Li, Aws Albarghouthi, Zachary Kincaid, Arie Gurfinkel, and Marsha Chechik.
2014. SymbolicOptimizationwithSMTSolvers.In Proceedingsofthe41stACM
SIGPLAN-SIGACTSymposiumonPrinciplesofProgrammingLanguages (SanDiego,
California,USA) (POPLâ€™14) .AssociationforComputingMachinery,NewYork,
NY, USA,607Å›618. https://doi.org/10.1145/2535838.2535857
[22]Xiaojuan Liao, Hui Zhang, Miyuki Koshimura, Rong Huang, and Wenxin Yu.
2019. MaximumSatisfiabilityFormulationforOptimalSchedulinginOverloadedReal-Time Systems. In PRICAI 2019: Trends in Artificial Intelligence , Abhaya C.
NayakandAlokSharma(Eds.).SpringerInternationalPublishing,Cham,618Å›631.
https://doi.org/10.1007/978-3-030-29908-8_49
[23]Vladimir Lifschitz. 2019. Answer Set Programming . Springer. https://doi.org/10.
1007/978-3-030-24658-7
[24]Moritz Lipp, Michael Schwarz, Daniel Gruss, Thomas Prescher, Werner Haas,
Stefan Mangard, Paul Kocher,Daniel Genkin, Yuval Yarom, and Mike Hamburg.
2018. Meltdown. arXiv: 1801.01207 [cs.CR]
[25]DanielLustig,MichaelPellauer,andMargaretMartonosi.2014. PipeCheck:Spec-
ifying and Verifying Microarchitectural Enforcement of Memory Consistency
Models.In 201447thAnnualIEEE/ACMInternationalSymposiumonMicroarchi-
tecture. 635Å›646. https://doi.org/10.1109/MICRO.2014.38
[26]InÃªsLynce,VascoM.Manquinho,andRubenMartins.2018. ParallelMaximum
Satisfiability. In Handbook of Parallel Constraint Reasoning , Youssef Hamadi and
LakhdarSais(Eds.).Springer,61Å›99. https://doi.org/10.1007/978-3-319-63516-
3_3
[27]FerneyA.Maldonado-Lopez,JaimeChavarriaga,andYezidDonoso.2014. Detect-
ingNetworkPolicyConflictsUsingAlloy.In AbstractStateMachines,Alloy,B,
TLA,VDM, andZ ,YamineAitAmeur andKlaus-DieterSchewe (Eds.).Springer
BerlinHeidelberg,Berlin,Heidelberg,314Å›317. https://doi.org/10.1007/978-3-
662-43652-3_31
[28]DmitryMalioutovandKuldeepS.Meel.2018. MLIC:AMaxSAT-BasedFrame-
work for Learning Interpretable Classification Rules. In Principles and Practice of
ConstraintProgramming ,JohnHooker(Ed.).SpringerInternationalPublishing,
Cham,312Å›327. https://doi.org/10.1007/978-3-319-98334-9_21
[29]JoaoMarques-Silva,JosepArgelich,AnaGraÃ§a,andInÃªsLynce.2011. Boolean
lexicographicoptimization:algorithms&applications. AnnalsofMathematics
and Artificial Intelligence 62, 3-4 (2011), 317Å›343. https://doi.org/10.1007/s10472-
011-9233-2
[30]Ruben Martins, Vasco Manquinho, and InÃªs Lynce. 2013. Community-Based
Partitioning for MaxSAT Solving. In Theory and Applications of Satisfiability
TestingÅ› SAT2013 ,Matti JÃ¤rvisalo andAllen Van Gelder(Eds.).SpringerBerlin
Heidelberg, Berlin, Heidelberg, 182Å›191. https://doi.org/10.1007/978-3-642-
39071-5_14
[31]RubenMartins,VascoManquinho,andInÃªsLynce.2014. Open-WBO:AModular
MaxSATSolver.In TheoryandApplicationsofSatisfiabilityTestingÅ›SAT2014 ,
Carsten Sinz and Uwe Egly (Eds.). Springer International Publishing, Cham,
438Å›445. https://doi.org/10.1007/978-3-319-09284-3_33
[32]Ruben Martins and Justine Sherry. 2017. Lisbon Wedding: Seating arrangements
using MaxSAT. MaxSAT Evaluation 2017 : Solver and Benchmark Descriptions
B-2017-2(2017), 25.
[33]Aleksandar Milicevic, Joseph P. Near, Eunsuk Kang, and Daniel Jackson. 2015.
Alloy*:AGeneral-PurposeHigher-OrderRelationalConstraintSolver.In 2015
IEEE/ACM 37th IEEE International Conference on Software Engineering , Vol. 1.
609Å›619. https://doi.org/10.1109/ICSE.2015.77
[34]Sanjai Narain. 2005. Network Configuration Management via Model Finding. In
USENIXConference onSystemsAdministration(LISA) . 155Å›168.
[35]TimNelson,SalmanSaghafi,DanielJ.Dougherty,KathiFisler,andShriramKrish-
namurthi. 2013. Aluminum: Principled scenario exploration through minimality.
In2013 35th International Conference on Software Engineering (ICSE) . 232Å›241.
https://doi.org/10.1109/ICSE.2013.6606569
[36]Nicholas Nethercote, Peter J. Stuckey, Ralph Becket, Sebastian Brand, Gregory J.
Duck, and Guido Tack. 2007. MiniZinc: Towards a Standard CP Modelling
Language. In Principles and Practice of Constraint Programming Å› CP 2007 , Chris-
tian BessiÃ¨re (Ed.). Springer Berlin Heidelberg, Berlin, Heidelberg, 529Å›543.
https://doi.org/10.1007/978-3-540-74970-7_38
[37]MiguelNeves,RubenMartins,MikolÃ¡Å¡Janota,InÃªsLynce,andVascoManquinho.
2015. Exploiting Resolution-Based Representations for MaxSAT Solving. In
Theory and Applications of Satisfiability Testing Å› SAT 2015 , Marijn Heule and
SeanWeaver(Eds.).SpringerInternationalPublishing,Cham,272Å›286. https:
//doi.org/10.1007/978-3-319-24318-4_20
[38]Francesca Rossi, Peter van Beek, and Toby Walsh (Eds.). 2006. Handbook of
ConstraintProgramming . Foundationsof Artificial Intelligence, Vol. 2. Elsevier.
[39]Roberto Sebastiani and Patrick Trentin. 2020. OptiMathSAT: A Tool for Op-
timization Modulo Theories. J. Autom. Reason. 64, 3 (2020), 423Å›460. https:
//doi.org/10.1007/s10817-018-09508-6
[40]Armando Solar-Lezama, LiviuTancau, RastislavBodik,SanjitSeshia,and Vijay
Saraswat.2006.CombinatorialSketchingforFinitePrograms.In Proceedingsofthe
12thInternationalConferenceonArchitecturalSupportforProgrammingLanguages
and Operating Systems (San Jose, California, USA) (ASPLOS XII) . Association for
ComputingMachinery,NewYork,NY,USA,404Å›415. https://doi.org/10.1145/
1168857.1168907
[41]ClayStevensandHamidBagheri.2020. ReducingRun-TimeAdaptationSpace
via Analysis of Possible Utility Bounds. In 2020 IEEE/ACM 42nd International
Conference onSoftwareEngineering (ICSE) . 1522Å›1534.
[42]EminaTorlakandDanielJackson.2007. Kodkod:ARelationalModelFinder.In
ToolsandAlgorithmsfortheConstructionandAnalysisofSystems ,OrnaGrumberg
andMichaelHuth(Eds.).SpringerBerlinHeidelberg,Berlin,Heidelberg,632Å›647.
166AlloyMax: Bringing Maximum Satisfaction to Relational Specifications ESEC/FSE â€™21, August 23â€“28, 2021,Athens,Greece
https://doi.org/10.1007/978-3-540-71209-1_49
[43]Caroline Trippel, Daniel Lustig, and Margaret Martonosi. 2018. CheckMate:
Automated synthesis of hardware exploits and security litmus tests. Proceedings
of the Annual International Symposium on Microarchitecture, MICRO 2018-Octob
(2018), 947Å›960. https://doi.org/10.1109/MICRO.2018.00081
[44]G. S. Tseitin. 1983. On the Complexity of Derivation in Propositional Calculus .
SpringerBerlinHeidelberg,Berlin,Heidelberg,466Å›483. https://doi.org/10.1007/
978-3-642-81955-1_28
[45]Perla Velasco-Elizondo, Vishal Dwivedi, David Garlan, Bradley Schmerl, and
JosÃ© Maria Fernandes. 2013. Resolving Data Mismatches in End-User Compo-
sitions. In End-User Development , Yvonne Dittrich, Margaret Burnett, Anders
MÃ¹rch,andDavidRedmiles(Eds.).SpringerBerlinHeidelberg,Berlin,Heidelberg,120Å›136. https://doi.org/10.1007/978-3-642-38706-7_10
[46]Lingyu Wang,Sushil Jajodia, Anoop Singhal, Pengsu Cheng, and StevenNoel.
2013. k-ZeroDaySafety: A Network Security Metric for Measuring the Risk of
UnknownVulnerabilities. IEEETransactionsonDependableandSecureComputing
11,1 (2013), 30Å›44. https://doi.org/10.1109/tdsc.2013.24
[47]Pamela Zave. 2017. Reasoning About Identifier Spaces: How to Make Chord
Correct. IEEE Transactions on Software Engineering 43, 12 (2017), 1144Å›1156.
https://doi.org/10.1109/TSE.2017.2655056
[48]Lei Zhang and Fahiem Bacchus. 2012. MAXSAT Heuristics for Cost Optimal
Planning. ProceedingsoftheAAAIConferenceonArtificialIntelligence 26,1(Jul.
2012).https://ojs.aaai.org/index.php/AAAI/article/view/8373
167