what makes my queries slow?
subgroup discovery for sql workload analysis youcef remil1 anes bendimerad2 romain mathonat2 philippe chaleat2 mehdi kaytoue1 1univ lyon insa lyon cnrs liris umr f lyon france 2infologic avenue de lyon bourg l es valence france 3yre infologic.fr abstract among daily tasks of database administrators dbas the analysis of query workloads to identify schema issues and improving performances is crucial.
although dbas can easily pinpoint queries repeatedly causing performance issues it remains challenging to automatically identify subsets of queries that share some properties only a pattern and simultaneously foster some target measures such as execution time.
patterns are defined on combinations of query clauses environment variables database alerts and metrics and help answer questions like what makes sql queries slow?
what makes i o communications high?
automatically discovering these patterns in a huge search space and providing them as hypotheses for helping to localize issues and root causes is important in the context of explainable ai.
to tackle it we introduce an original approach rooted on subgroup discovery.
we show how to instantiate and develop this generic data mining framework to identify potential causes of sql workloads issues.
we believe that such data mining technique is not trivial to apply for dbas.
as such we also provide a visualization tool for interactive knowledge discovery.
we analyse a one week workload from hundreds of databases from our company make both the dataset and source code available and experimentally show that insightful hypotheses can be discovered.
index terms database workload analysis data mining subgroup discovery explainable ai data visualisation i. i ntroduction it is indisputable that data has become a crucial part of software and it platforms.
this makes the database and its management system a critical component.
thus researchers and engineers have spent a significant effort to make the interaction with data as reliable and efficient as possible.
a data driven strategy based on query workload analysis has proven its efficiency to address a large variety of related problems.
these methods automatically analyze the set of logs and queries run on the database to perform tasks such as index recommendation query recommendation anti pattern detection modeling user and application behavior .
the usability of these data on such tasks strongly depends on their representation.
that is why several methods have been proposed to transform the data into simplified forms before performing the main task for example workload compression efficient parsing or embedding of sql queries.
then a myriad of machine learning methods have been evaluated on different workload analysis tasks.
for example clustering approaches have beenexploited to delineate hot spots of user interests to summarize workloads to identify insider threats .
nlp techniques have been used to embed sql queries in vector representations that are guided by the target application .
in a neural network approach is proposed to help endusers and administrators compose sql queries.
in this paper we address a novel workload analysis problem that can uncover many kinds of tasks.
we aim to design a method that efficiently brings answers to the generic question how to characterize sql queries that foster some properties of interest?
a concrete example of such question is what makes queries slow?
here the goal is to identify the characteristics and the context in which the execution time of queries is large.
an example of results for such question is table x where attribute y !
high execution time answering this question can be extremely useful for performance optimization problems.
similarly several other questions of this kind may occur how to characterize queries that over consume the i o communication?
in which context sql queries significantly increase concurrency issues?
etc.
to address this problem we propose a unified and powerful framework rooted in the subgroup discovery approach.
subgroup discovery is a data mining task that aims among many other possibilities to identify patterns describing parts in a dataset where the distribution of the target variable significantly deviates from the norm i.e.
from its distribution in the whole dataset.
typically the discovered subgroups are easily interpreted by the experts.
coming back to our previous example the discovered subgroup consists of all the queries that verify the constraint table x where attribute y .
this subgroup is interesting because its average execution time is significantly greater than expected.
subgroup discovery has proven its efficiency in different fields such as physics education and neuro science .
to the best of our knowledge our work is the first to exploit this approach to address a generic workload analysis problem.
the efficiency of such method is challenging as it strongly depends on several complex criteria the data needs to be introduced to the algorithm in the right format a relevant pattern language needs to be defined the language used to select subsets of queries we need to choose the 36th ieee acm international conference on automated software engineering ase 36th ieee acm international conference on automated software engineering ase .
ieee .
ase51524.
.
.
ieee figure overview of our subgroup discovery framework for sql workload analysis.
right function to measure the interestingness of a subgroup w.r.t.
the target problem resulting subgroups need to be interpretable and their interactive mining needs to be enabled.
contributions.
we introduce an efficient subgroup discovery framework that meets all the aforementioned criteria for workload analysis.
we first propose a data pre processing step to prepare the sql workload.
we parse queries to extract important attributes e.g.
tables fields operations .
we have extended the mozilla parser with new features to extract all the information we need from the queries e.g.
handling alias and nested queries .
moreover we augment queries with other relevant information execution time performance metrics of the dbms environment variables of the system and anomaly alerts guided by expert knowledge.
then we define a suitable pattern language and integrate a diverse set of interestingness measures whose choice can be directed by the target application.
we provide exact and heuristic algorithms to identify subgroups of interest.
furthermore we integrate a visual tool that enables the user to interact with the algorithm and iteratively learn from the provided results.
the whole process of the proposed approach is summarized in figure .
outline.
the remainder of the paper is organized as follows.
sec ii presents the raw data the pre processing strategy as well as an informal description of the studied problem.
sec iii formally defines the problem settings introduces the interestingness measures in sec iii b and algorithms in sec iii c and sec iii d. then sec iii e presents our interactive visual tool that enables the user to easily annotate data and design the target task.
a thorough empirical study is detailed in sec iv to quantitatively and qualitatively evaluate the proposed approach.
sec v presents related work before we conclude and present future directions.
ii.
m ethodology we conduct our analysis on a workload wof 150k unparametrized sql statements gathered from more than databases supervised in our company sharing almost code and datasets available on same database schema.
we efficiently parse queries to extract tables and attributes for each type of sql clause.
queries are then augmented with several database metrics and supervision alerts resulting in thousands of properties helping in contextualizing the subgroup discovery.
a. raw data sql queries.
we define the workload as a set w fq1 qngwhere each query q2wis aselect statement that contains the sql text qtext the query execution timeqtimeand the number of rows returned qnrows.
environment features.
each database is queried by an application an enterprise resource planning software erp that we develop in the company.
as such the application identifier servername and its major and minor versions are considered softwareversion codeversion .
the database properties are its vendor version dbversion its schema among 6main families declination the size of the database server memory dbmemory the maximum database memory usage sgamax the maximum number of processes dbprocesses the minimum and the maximum size of pool jdbcmin jdbcmax the limit on the number of cursors per database session dbcursormax .
active session history.
active session history ash was introduced in oracle 10g and then in other database systems such as postgresql .
an active session is a database session waiting for some resource such as cpu system i o or network.
ash provides the number of sessions waiting for each category of resource per interval of time.
it gives a temporal distribution that can be of high interest for diagnostics and tuning.
for example one may use this data to identify queries that unexpectedly over consume network as they generate many network waiting sessions.
alerts.
our monitoring system triggers rule based alerts when anomalies are observed on the database environment.
for this analysis we considered 4alerts when the number of active sessions is unusually large manyactivesessions when some sessions remain blocked during a significant time blockedsessions when the size of the pool is close to 643table i dataset features.
query properties environment variables alerts oracle ash query servername dbmemory manyactivesessions application concurrence day declination sgamax blockedsessions configuration network hour softwareversion dbprocesses poolalmostfull administrative cpu time codeversion jdbcmin anomalyash systemi o useri o nrows dbversion jdbcmax queuing scheduler dbcursorsmax commit its maximum limit poolalmostfull and when there is an anomaly in the distribution of ash anomalyash e.g.
an increase in the proportion of sessions waiting for network or systemi o. we have augmented the queries with the alerts that co occur with their execution.
each alert has four levels info alarm critical andblocking.
these features have been chosen with our dbas.
our methodology is totally flexible and any numerical and categorical property can be considered as well.
as related in section v it should be noticed that no prior work has invested such a combination of high dimensional features along with a very expressive representation of sql queries that we present now.
b. query transformation a common preprocessing is to decompose parse and tokenize sql queries qtextto form a numerical vector where dimensions count the usage of data tables and attributes .
we have used the readily available mozilla parser that provides an sql syntactic tree in xml that we then parse.
we normalize the case sensitivity and remove irrelevant terms such as constants and logical operators.
tokens are then associated with the clauses they belong to by adding to the token name a prefix that indicates the clause in which each token appears.
for instance in figure the table model appears in the from clause of the query so its token will befrom model.
for each token we provide the number of time it appears in each sql clause.
then we extended the mozilla parser in two ways.
firstly we needed to consider not only sql queries but also hibernate queries used in our erp as the orm layer we added the reserved keywords for hibernate queries such as join fetch in the original parser.
second and most importantly unlike several existing parsers our parser can handle nested queries while preserving all the structure of the query.
furthermore substitutes for temporary table names known as aliases are not removed as also done in many parsers .
aliases are rather used to figure out for example to which table belongs a column in a select clause or a predicate in where orgroup by clause.
the interest in keeping and using alias appears when the queries are nested or the query contains a join clause or involves several tables.
in this way as the example in figure shows if two columns of different tables have the same name they will be encoded differently unlike the approach proposed by .
inspired by the work of we also consider the function calls present in the sql statement as an independent clause.
the source code is available as mentionned in the introduction.raw sql query select m.ik from model asm join prod asp where m.ik p.ik and m.uex p1 and m.uex incollection0 orm.ik incollection1 and m.dossierinfo p3 group by m.ik having count distinct p.ik p2 and sum m.nbembal max p.nbembal our parsing result parsing result of select model.ik !
select ik !
from model !
from model !
join prod !
from prod !
where model.ik !
where ik !
where model.uex !
where uex !
where model.dossierinfo !
1where dossierinfo !
where prod.ik !
groupby model.ik !
groupby ik !
having prod.ik !
having ik !
having model.nbembal !
having nbembal !
having prod.nbembal !
count prod.ik !
sum model.nbembal !
max prod.nbembal !
figure example of parsing an sql query.
finally it is noteworthy that we do not group semantically equivalent queries under a canonical form as done in the way a query is written can impact its execution plan thus execution time.
c. data model we unify the different data sources into a dataset defined by a pair o a where o foig1 i n is a set of objects that refer to the queries and a aj j mis a vector of attributes.
each attribute a o !dom a is a function that maps queries to values in its domain dom a .
consequently a o denotes the value of the attribute afor the object o. dom a is given by rifaisnumerical by a finite set of categories ciifaisnominal categorical or by f0 1g ifaisboolean.
a nominal attributes with a total ordering of its values is called an ordinal nominal attribute.
these notations are illustrated in table ii with a dataset of objectso fo1 o 11greferring to queries described by attributes.
server name is nominal and has two possible values lyn andblv.
manyactivesessions referring to an alert is an 644ofrom where env features alerts ash qnrows qtime a1 verroua2 cumulofa3 verrou.ika4 verrou.datea5 cumulof.ika6 soft versiona7 server namea8 manyactivesessionsa9 concurrencya10 nrowsa11 timea12 slow o1 v2 lyn alarm .
o2 v1 blv critical .
o3 v1 blv critical .
o4 v2 lyn alarm .
o5 v3 lyn alarm .
o6 v3 lyn critical .
o7 v2 lyn info .
o8 v2 blv alarm .
o9 v3 blv critical .
o10 v2 blv alarm .
o11 v2 lyn info .
table ii toy example of a dataset o a .
ordinal attribute with levels finfo alarm criticalg.time is numerical and gives the execution time that a query takes.
slow is binary it equals 1when the query time exceeds seconds 0otherwise.
as mentioned in sec ii b when parsing a query we keep the count of each token associated with each clause thus each token is a numerical attribute aj2asuch that dom aj n r. for example verrou.data is numerical and represents the number of times this attribute appears in the where clause for each query e.g.
a4 o6 means that for the th query in the dataset the attribute verrou.date appears twice in the where clause.
d. characterizing discriminant queries the goal of subgroup discovery is to find subsets of objects that are statistically the most interesting with respect to a property of interest i.e.
the target.
for example we seek to characterize queries that have large execution times i.e.
slow queries.
thus the target concept can be the binary attribute slow and we will identify interpretable descriptions of subgroups that maximize the proportion of queries having slow .
in table ii a discriminant subgroup can be defined by queries that include the attribute where verrou.date.
indeed of these queries are slow while only of overall queries are slow.
we refer to this subgroup by its description where verrou.date .
another interesting example consists in queries that correspond to the following description where cumulof.ik soft.
version v2 with a proportion of of slow queries.
given a large number of attributes we end up with a very huge set of possible conjunctive combinations.
therefore it becomes challenging to identify those descriptions that are the most significantly discriminant.
this is where an automatic subgroup discovery approach can be extremely helpful.
such approach usually identifies interesting results by performing a deep search through the set of candidates hypotheses and scores each of them with a function that assesses their interestingness.
in addition to this purely automatic approach human expertise can be useful in guiding the search since subgroup discovery involves an iterative and interactive process.
the first subgroup where verrou.date can inform experts that an index is probably missing on the attribute verrou.date.
the previous examples use a binary attribute slow as the target concept but subgroup discovery canalso employ numerical targets or even complex models over multiple targets.
in the following consider that the target concept is the numerical attribute time.
the subgroup defined as from verrou manyactivesessions critical is statistically interesting because its average time of .22s is relatively large compared to the average over the whole dataset estimated by .12s.
the last example would not have been impressive if we opted for the binary target slow because this subgroup is characterized by 3queries one of which is barely less than 10s.
it is also noteworthy that the size of subgroups is often taken into account to assess their quality.
in fact we are generally interested by discriminant subgroups that cover a large number of queries as statistically more significant.
iii.
d iscriminant pattern discovery in workloads a. introduction to subgroup discovery descriptive attributes and target.
one needs to specify a target attribute t2athat is suitable for the target application.
for example if we want to characterize slow queries the target attribute twill be the execution time q time .
in this paper we consider both cases where tcan be boolean or numerical.
another important question is which attributes do we want to use to characterize interesting subgroups?
these are called descriptive attributes and denoted ad anftg andjadj md.
a pattern language dis then defined over descriptive attributes.
a pattern d2d is a constrained selector of subset of objects using their descriptive attribute valuesad.
more precisely the pattern language is defined as d md i 1diwherediis a selector defined over ai2ad and given by the set of all possible intervals in rifaiis numerical the setfci g ffcgjc2cigifaiis categorical orff0 1g f0g f1gg ifaiis boolean.
a pattern d2d is then given by a set of restrictions over each descriptive attribute i.e.
d di i m d .
linking patterns and objects.
a patternd di i m dis said to cover an objecto2oiff8ai2ad ai o 2di.
the set of all objects covered by a pattern dis called the extent ofdand denoted ext d fo2ojdcoversog.
in table ii consider the case where we have descriptive attributesad ffrom verrou from cumulof server nameg.
an example of pattern is d from verrou2n 645from cumulof server name lyn .
this pattern covers objects in which from cumulof appears at least once in the query and the server name is lyn.
these objects areext d fo4 o5 o7 o11g.
subgroup definition.
a subgroup is any subset of objects s othat can be selected using a pattern dover descriptive attributesad.
the set of all possible subgroups is denoted s ext d fext d jd2dg.
in other terms a subgroup is a set of objects that can be characterized with some restrictions of attributes turning it interpretable to the user.
subgroup interestingness.
a measure s!r s7!
s is a mapping that evaluates the quality of a subgroup sw.r.t.
the property of interest.
the greater is s the more interesting iss.
the choice of depends on the target application.
in sec iii b we define several relevant measures that we have exploited to analyze sql queries and we explain how to choose the right measure according to the end user goal.
problem statement.
given a user specified parameter k find the top k subgroups with the highest values of the interestingness measure .
formally find the subgroup set r fs2sjrank s kg whererank s gives the rank of sw.r.t.
its score that is rank s jfs02sj s0 s gj .
b. measuring subgroup interestingness we present measures that can be used as to assess the quality of subgroups.
it is generally agreed that interesting discriminant subgroups are those that maximize the deviation of the target attribute tand whose sizejsjis sufficiently large.
in fact one prefers discriminant subgroups that have large sizes as they are deemed more significant i.e.
there existence in the dataset is less probable to be due to chance.
many of existing measures belong to the popular family of kl osgen functions defined given the parameter a2 kl osgena s sup s a s o where the support sup s jsj jojmeasures the proportion of objects from othat belongs to s and the target mean s p o2st o jsjgives the average value of the target attributetins.
thus the higher is sup s the higher is kl osgena s .
but also kl osgena s is maximized when the deviation of s regarding its overall mean o is maximized.
the choice of aaffects the importance of sup s on the final value of interestingness and conducts to measures with different statistical interpretations.
these measures are presented in what follows.
average function u.also called unusualness it is the kl osgen function with a that is u s s o .
it can be used when we do not want to impact the score of subgroups by sup s .
when used this measure is generally combined with a threshold constraint on a minimum size of returned subgroups to avoid retrieving very small ones.
u s provides a subgroup ordering that is identical to another popular measure lift s s o .wracc measure .
it is one of the most popular measures in sd.
it corresponds to the kl osgen function with a wracc s sup s s o for the specific case when tis binary it can be written as wracc s pr o2s t o pr o2s pr t o where pris the probability of an event to happen.
theoretically the more sis statistically dependent of true target values t o the higher isjwracc s j. mean test.
a drawback of wracc is that in many tasks it over scores subgroups with large support despite their limited unusualness.
for this reason many methods have preferred to use the mean test which is the kl osgen function with a mean test s p sup s s o from a statistical point of view it was proven that this measure provides an equivalent ordering than the binomial test .
t score.
a limitation of kl osgen functions is that they do not optimize the dispersion of the target attribute in subgroups.
this could lead to inconsistent statements particularly when the dataset contains many outliers.
in fact s is sometimes not representative of target values in the subgroup s if it contains few outliers with extreme values of t. to address this issue one of the measures that incorporate the cohesion of the subgroup is the t score defined as t score s p sup s s s o where s is the standard deviation of target values tin the subgroups.
the smaller is s the more cohesive are values oftins and thus the higher is t score s .
this measure reflects the significance of the deviation of target values in a subgroup using a student s t test.
however one should avoid a direct statistical interpretation of the t score if the target attribute is not normally distributed and the subgroup size is small e.g.
jsj .
median based measures q med.
another way to reduce the impact of outliers on subgroup scores is to estimates values oftinsusing its median med s instead of its average s in the kl osgen function as the median estimator is more robust to noise q med s sup s a med s med o c. algorithms once the pattern language is defined and the subgroup interestingness is chosen it remains to explore the search space in order to identify the top k subgroups.
computational complexity of sd problem is known to be prohibitive due to the huge size of the search space jsjthat increases exponentially w.r.t.jadj.
many algorithms have been proposed to efficiently traverse the search space.
some of them provide exact results others are heuristic but scale better.
proposed a python 646implementation of the most popular sd algorithms.
since it does not support all the relevant measures for our case study we have extended this framework to incorporate the support thet score as well as median based measures q med.
we exploit two methods an exact algorithm based on a depthfirst search a heuristic algorithm that uses beam search.
depth first algorithm.
this approach exhaustively explores the search space sin a depth first manner.
after defining an order relation between patterns the search space forms a lattice structure with the empty pattern as a supremum and the pattern containing all the selectors as infimum.
then this lattice is explored in depth.
we start from the empty pattern d ai2dom ai jai2ad i.e.
no restriction for any attribute.
then a refinement operator is recursively applied on selectors of d continuously making it more restrictive.
refinements can be operated by adding a symbolic attribute value or adding a numerical attribute cut point.
as the search space can be extremely large a naive enumeration of subgroups fails.
for this reason the exact algorithm uses many techniques to optimize the exploration.
some anti monotonic constraints are generally used such as a minimum support i.e.
if a pattern covers less than objects then this pattern is not refined anymore as its refinement necessarily covers less than objects.
furthermore tight optimistic estimates toe are used.
these functions allow to efficiently upper bound all the subgroup interestingness values in a whole branch of the search space.
if the toe of a branch is lower than the score of the top k already found subgroup then the branch is pruned as it does not contain any subgroup with a score higher than the already found top k .
other optimization strategies are used as well.
to for further details.
beam search algorithm.
heuristic methods are deemed useful in many scenarios when the number of descriptive attributes is large and thus exact methods become slow or infeasible.
they try to find as good patterns as possible in a short time by evaluating only promising candidates.
the most popular heuristic approach is beam search .
this approach performs a heuristic level wise search over the pattern lattice.
it requires to specify the width parameter w2n which is the maximum number of patterns kept in each level of the lattice.
it starts from the empty pattern d ai2dom ai jai2ad .
then it recursively goes to the next level by refining patterns of the current level and selecting the top w refined patterns that maximize the interestingness.
these top w patterns are then refined again to continue to a deeper level.
at the end the algorithm selects the top k subgroups among all the top w ones selected from each level.
d. reducing information redundancy the process of selecting interesting subgroups considering only the discriminative measure may result in strongly overlapping subgroups that are distinct patterns covering almost the same objects.
for instance in table ii the two different patterns d1 from verrou and d2 where verrou.ik are highly correlated asthey cover more or less the same objects.
in order to provide interesting but diverse patterns and to reduce information redundancy in the subgroup set r we propose two different solutions based on the jaccard similarity .
this metric measures the similarity of two subgroups patterns as a fraction between the intersection and the union of their extents.
for the two example patterns d1andd2 sim d d2 j d1 d2 jext d ext d jjext d ext d j greedy selection.
the greedy approach constructs iteratively the non redundant subgroup set r0.
in each iteration the best subgroups?in the initial subgroup set ris identified and added tor0.
afterwards we remove from rall the subgroups whose similarity with s?exceeds a specified threshold.
this process is repeated until rbecomes empty.
however this technique requires the user to specify an appropriate threshold for the jaccard similarity.
for a large enough threshold one can still end up with overlapping subgroups.
on the other side a small threshold can lead to the suppression of interesting subgroups.
thus this method is sensitive to the threshold which must be chosen empirically.
hierarchical clustering.
to get a more complete and understandable overview of the resulting subgroups agglomerative hierarchical clustering is performed on the result set r. at the bottom of the hierarchy each subgroup forms a singleton cluster and pairs of clusters are then merged as one moves up the hierarchy.
this clustering is computed using the jaccard dissimilarity defined as jaccard similarity.
as a result the hierarchical clustering produces a binary clustering tree or a dendrogram.
it represents a hierarchy of partitions hence it is possible to choose one partition by truncating the tree at a given level.
unlike the greedy approach the user can specify how many non redundant subgroup patterns she wants without having to specify a dissimilarity threshold.
e. interactive sd for workload analysis in practice an effective sd approach needs to be iterative and interactive to make it possible to incorporate subjective criteria as well as human expertise.
indeed the interestingness of subgroups strongly depends on the end user preferences and her prior knowledge about the data.
this interactive process should efficiently allow the user to explore the region of her hypothesis space and possibly improve the quality of the extracted pattern.
in that process the user sets the parameters of the approach including the measure and the algorithm to get a visualisation of the retrieved patterns.
afterwards the user proceeds to the validation of these patterns and checks for the quality of the provided knowledge while guiding the post processing phase to refine relevant patterns.
several subgroup discovery algorithms have been embedded into software tools such as kepler subgroupminer and vikamine that provide a graphical interface allowing the user to choose viewing options and select appropriate parameters for her task.
different from those just mentioned the graphical tool we provide enables the user to use visual filters to 647select the subset of the data she wants to mine with sd and visually constitute a binary target concept that she aims to discriminate by flexibly selecting data inside widgets such as scatter plots.
moreover the tool allows for setting the desired parameters of the task and the visualization of the extracted patterns along with their associated statistics.
figure shows the main window of this tool which is described in sec iv c. iv.
e valuation we report the experimental study that we conducted to evaluate the efficiency of our subgroup discovery approach.
first we validate that the proposed framework is able to characterize discriminant subgroups that are statistically the most interesting w.r.t.
different target problems.
then we report through a quantitative analysis the execution time for each algorithm with different parameters including the number of patternskand rules depth.
finally we present the different features provided by our visualization tool.
further study of measures and post processing are differed in the supplementary materials due to lack of space.
experiments setup.
experiments are conducted on an sql workload that contains hibernate queries run on our production environment servers for a period of one week.
since the effective number of queries is extremely large our monitoring system records only those whose execution time exceeds 5seconds.
we augment these queries with other relevant information described in table i as explained in sec ii a. this dataset contains queries described by features.
table iii displays the characteristics of the overall dataset.
note that the dataset is extremely sparse with only .
of non zero values.
the proposed framework extended the library pysubgroup to support more relevant measures specifically for numerical targets e.g.
medianbased measure .
all the experiments presented were run on a single machine with intel r core tm i5 10210u cpu .60ghz .
ghz with 32gb ram .
a. qualitative analysis use cases.
to show the ability of the proposed framework to perform several tasks with different goals we use it to address the following diverse set of research questions rq1 what makes queries very slow?
rq2 in which context do queries present concurrency issues?
rq3 how to characterize queries that co occur the most with alerts of type blocked sessions.
methodology.
to properly conduct these experiments we assess each use case in a specific context according to the industrial needs that we are facing.
more precisely each use case is carried out on a subset of data as follows we evaluate rq1 ond1 queries that were executed on all sales servers with at least users.
note that the sales declination constitutes .
of the data.
d2 queries that invoke the mvtrealise table knowing that it is the mostcommonly queried table.
rq2 is evaluated particularly on d3 the software version v152 since it presents exclusively many concurrency issues compared to other different software versions.
for this purpose we consider a binary target which refers to a potential issue if there is at least an average of concurrent processes over a period of seconds during the execution of the query.
finally we evaluate rq3 ond4 a specific set of servers on which we observe an abnormal raising of blocked session alerts.
the characteristics of the sub datasets are provided in table iii.
for each of the studied scenarios we choose the top subgroups w.r.t.
to the most adequate interestingness measure for the problem.
the choice of the measure is made empirically by comparing the subgroups identified with each measure.
we take the one that provides relevant but also interpretable patterns by performing a statistical distribution analysis and referring to human expertise.
the resulting patterns are then processed to provide diverse and non redundant ones as described in sec iii d. results are given in table iv where for each subgroup pattern we show its support as well as its deviant quality compared to the dataset.
for binary target problems we compare the precision of each subgroup sgiven by prec s jo2sjt o 1jjsjwith the precision of the considered dataset.
results and analysis.
actionable and relevant subgroups have been identified in the different use cases.
in the dataset d1 we were interested in subgroups whose median execution time is significantly higher than the median of the dataset while taking into account the subgroup size.
we have chosen the measure q med instead of the mean test because we observed in particular for this example that the mean is more sensitive to outliers.
the subgroup s1 which covers all queries that involve the attribute auditinfo.etat in thewhere clause has a very large median compared to the dataset but only few objects.
in figure 3a we show that its density distribution is too divergent and does not follow the usual distribution of original data.
on the other hand while the subgroup s2 includes all the queries executed on the cumulmultiple table characterized by a large median the subgroups s3 and s4 are subsets of s2 as they cover only its queries having the attributes valzvclix andvalzvartx respectively in their where clause.
as shown in figure 3a the deviation of s3 and s4 from the overall distribution is stronger than the deviation of s2 since they do not cover some slow queries present in s2 .
to better understand this result we have examined thecumulmultiple table by highlighting the distributions of its attributes in figure 3b.
we then confirm that mostly the attributes valzvclix andvalzvartx cause thes2 to be identified.
in d2 we discretize the attribute time so that queries with an execution time higher than seconds are considered as slow queries.
for each measure we obtain interesting results that incorporate the extended features e.g.
alerts in s9 and environment variables in s7 .
for example we found that all the queries on the mvtrealise table that 648table iii datasets statistics.
dataset queries features from tables join tables projections where atts having atts groupby atts orderby atts sparsity all .
d1 .
d2 .
d3 .
d4 .
table iv subgroup discovery results.
id target measure subgroup patterns size quality d1time numerical median s1 where stocks.gestion.modele.lot.prod.ref.auditinfo.etat s2 from ventes.cumuls.modele.cumulmultiple s3 where ventes.cumuls.modele.cumulmultiple.valzvclix s4 where .ventes.cumuls.modele.cumulmultiple.valzvartx med dataset med dataset med dataset med dataset d2slow binary prec lift s5 groupby stocks.gestion.modele.mvtrealise.refexterne s6 servername serverx systemi o 38prec prec wracc s7 where stocks.gestion.modele.mvtrealise.etatsynchro jdbcmax s8 where stocks.gestion.modele.mvtrealise.auditinfo.datcre dbversion s9 manyactivesessions alarm20668 44prec prec prec d3concurrence binary prec lift s10 from .stocks.fichierbase.modele.produit administrative prec binomial s11 servername servery commit systemi o prec d4blockedsess binary prec lift s12 join .commandesfactures.modele.histcdeligliv.applibudrist s13 where ventes.commandesfactures.modele.cdeligliv.bonliv.datdepart 9prec prec binomial s14 anomalyash critical s15 poolalmostfull info151 124prec prec are executed on serverx when the systemi o is at least last more than seconds.
moreover each time the refexterne attribute is requested by the group by clause the query takes very long time to execute.
unlike the lift measure which relies only on the precision of the subgroup wracc takes the subgroup size into account.
the subgroups s7 and s8 are very exceptional because they cover more than of the queries while having an approximate precision of compared to an overall precision of i.e.
these subgroups contain more than of the slow queries.
in d3 we aim to figure out the context in which queries encounter concurrency problems.
the best results are achieved using the lift andbinomial measures.
although the precision on the considered dataset is estimated to be only we extracted subgroups with a precision that exceeds .
the subgroup s11 alone constitutes of objects that characterize a concurrency issue.
finally for d4 we want to extract relevant hypotheses that reveal the context in which the blocked sessions alert is raised with blocking or critical level.
this is generally due to the execution of a query which blocks a critical resource and puts new sessions on hold.
we found that every time the table applibudrist isjoined with another table the alert is triggered.
another possible reason may be a process that queries a table with missing indexes.
this is where the subgroup s13 allows quickly to check if this assumption is true on the datdepart attribute.
we also observed that the concerned alert is highly correlated to both the two alerts described by the subgroups s14 and s15 .
it is worth noting that the proposed sql parser has been effectively useful since it helped to contextualize interesting subgroups of queries.
server names have been anonymizedin fact we notice through the experiments that the extracted subgroup patterns include different sql clauses e.g.
where group by etc.
.
a subgroups distribution w.r.t time on d1 compared to overall data.
b distribution of attributes in the table cumulmultiple.
figure statistical distributions of subgroups found on d1.
649table v execution time in seconds of sd algorithms.
algo beam search heuristic depth first exhaustive patterns k depth d1 .
.
.
.
limit limit limit limit d2 .
.
.
.
.
limit .
limit d3 .
.
.
.
.
.
.
.
d4 .
.
.
.
limit limit limit limit b. quantitative analysis we study the time performance of both exhaustive and heuristic sd algorithms on the four datasets.
for each case we set different values for the number of returned subgroups k and the depth i.e the maximum number of selectors per pattern.
results are provided in table v. the limit value refers to an execution time that exceeds 000seconds.
beam search was able to finish in less than seconds for all configurations while depth first exceeded 000seconds in many cases.
exceptionally in d3 depth first took less time than beam search.
this may be due to the relatively small number of features compared to other datasets.
these results also show the impact of parameters i.e.
the number of returned patterns and the depth.
in fact the higher they are the longer is the execution time.
in our qualitative experiments we use beam search with a beam width of for d1 and d4 while we exploit results from depth first on d2 and d3.
c. interactive subgroup discovery figure illustrates our interactive visualisation it can manage different data types both for input features as well as the target including nominal and numerical attributes.
it also provides a range of interestingness measures and algorithms.
its main window consists of important panels the dataset properties the search strategy and the results.
dataset panel.
it allows the user to select a subset of data of interest thanks to data points selection where queries are plotted e.g.
w.r.t.
execution times and row counts but also filters on query properties.
the graph on the right simply rescale the selection made on the left graph.
search strategy panel.
this panel enables the configuration of the mining task.
first the user needs to define the target.
there are two possibilities choose a specific attribute as target or graphically create a binary target by associating its positive class to the data subset selected in the right graph and the remaining data of the left graph as negative class.
after that she can specify the interestingness as well as the mining algorithm.
finally it remains to set the desired number of returned subgroups and the maximum depth of pattern rules.
results.
once the mining task is executed this panel shows the identified subgroups.
for each it displays the corresponding pattern along with relevant statistics such as the subgroup size the median etc.
v. r elated work for decades extracting interesting patterns from query workloads has been of great importance in database research.a variety of related methods have been proposed to perform specific tasks on workloads.
the use case most closely related to our solution is performance analysis .
however most of these approaches used clustering based methods which are not practical to identify subsets of data that specifically discriminate a property of interest.
on the other hand several major commercial database systems have developed tools to automate this task such as query planner and optimizer microsoft sql server has included the index selection feature as part of its tuning advisor since sql server .
even if these tools are widely used by dbas they remain specific and non generic tools as they are limited to certain features.
indeed using query optimizer for example requires digging into individual cases to figure out the issue in each query separately while a subgroup discovery approach aims to identify issues for a subset of queries sharing some specific properties w.r.t any user defined target.
moreover it can be argued that subgroup discovery may be used to assist query planner with very specific cases i.e.
providing interesting cases to be investigated with query optimizer.
we are the first to address the challenging task of adapting subgroup discovery for a complex and generic workload analysis problem.
in what follows we describe in more details the different workload analysis tasks that have been studied in the literature.
performance optimization.
database system performance can be tuned by recommending the appropriate set of indexes to speed up query processing.
however the complexity of index selection grows quadratically with the workload size .
therefore several approaches tackle this challenge by finding a compressed workload that is highly representative i.e.
a smaller substitute workload that has similar performance characteristics as the original workload.
this compression problem is np hard .
thus existing approaches have used a variety of heuristic techniques ranging from random sampling and clustering to the use of sophisticated machine learning models .
for instance use a distance function that measures the difference between pairs of sql statements with respect to the workloaddriven task.
then they propose multiple summarization techniques including k me random sampling and all pairs greedy algorithm.
more recently propose query structure based clustering algorithms that rely only on the syntactic information of the query.
query2vec cluster queries based on representations computed using several nlp approaches.
insider threats identification.
propose a semi supervised approach to analyse database access patterns.
it starts by clustering sql queries using a similarity function that is defined over query structures.
some of these clusters are labeled by experts as potential security threats.
then these labels are used to generate patterns that enable the automatic classification of remaining clusters.
query recommendation.
this task aims to assist non expert users by providing them with personalized sql query recommendations that correspond to their information needs.
650figure main sections of the interactive sd tool dataset properties search strategy and results.
exploit a collaborative filtering paradigm where users with similar querying behavior are assumed to be interested in retrieving similar data.
introduce an order sensitive model to compare olap user sessions where the order of queries within a session influences the similarity of sessions.
explique uses clustering and decision trees to extend a given query by suggesting a set of possible selection predicates to add to the query that aim at dividing the initial answer set to identify interesting exploration zones.
finding user interest.
this problem aims to track the user s historical querying behavior to seek for her interest.
in the authors propose a query similarity metric based on the notion of the so called access area.
this area captures the part of the data space that the user is mostly interested in.
another related work compares queries based on returned results then cluster the data to help users locate interesting results.
antipatterns detection.
this problem consists in extracting patterns that generally lead to unnecessary sql statements which may have a negative effect on performance or introduce bias on any subsequent workload analysis .
in the proposed method analyzes metadata tables to detect design antipatterns that reflect errors in the database schema.
whereas are interested in antipatterns related to performance degradation.
use static code analysis and rule based approach while in the final goal behind cleaning query logs is to simplify the identification of interests of database users.
visual analysis.
makiyama et al.
use som self organizing map as a visualization tool due to its quantization and projection properties.
the provided visualization gives an idea of the overall shape of the data and helps to detect possible cluster structures in the sql workload.
queryscope aims to find better tuning opportunities by helping users identifyshared patterns between queries while providing a variety of viewing options so that a user can focus on query relevant aspects.
vi.
c onclusion and perspectives mining patterns in sql workloads helps dbas discovering subgroups of queries sharing some properties and strongly discriminating either a nominal target or a metrics property.
we developed a methodology based on subgroup discovery which can be tuned in terms of descriptive and target attributes mining algorithms and pattern quality measures.
we proposed a visualisation tool for helping practitioners to make subgroup discovery possible with an interactive platform.
we empirically showed how it can elicit hypotheses of interest from queries run on hundreds of databases.
we are currently working on integrating our approach in a large scale supervision framework for daily preventive maintenance for our dba team.
subgroup discovery can be extended in many ways to provide better results.
first we realized through experiments that we often need to consider multiple targets for example to identify patterns of queries which return few rows while having high running times.
second although we consider a rich pattern language in comparison to other approaches we can exploit the syntactic tree structure of the queries to mine tree patterns more expressive than conjunctions of sql clauses.
third an effort is needed to produce more qualitative subgroup sets with more diversity data cover and less redundancy and directly considering a quality measure on the subgroup set turning the top k mining problem intosubgroup set mining .
finally subjectivness and practitioner preferences should be considered by the mining algorithms through an interactive discovery process.
these are actually current challenges in the field of subgroup discovery.
651references s. chaudhuri v .
narasayya and p. ganesan primitives for workload summarization and implications for sql in proceedings vldb conference.
elsevier pp.
.
s. chaudhuri a. k. gupta and v .
narasayya compressing sql workloads in proceedings of the acm sigmod international conference on management of data pp.
.
j. akbarnejad g. chatzopoulou m. eirinaki s. koshy s. mittal d. on n. polyzotis and j. s. v .
varman sql querie recommendations proceedings of the vldb endowment vol.
no.
pp.
.
j. aligon m. golfarelli p. marcel s. rizzi and e. turricchia similarity measures for olap sessions knowledge and information systems vol.
no.
pp.
.
n. arzamasova m. sch aler and k. b ohm cleaning antipatterns in an sql query log ieee transactions on knowledge and data engineering vol.
no.
pp.
.
e. eessaar on query based search of possible design flaws of sql databases in innovations and advances in computing informatics systems sciences networking and engineering.
springer pp.
.
t. h. chen w. shang z. m. jiang a. e. hassan m. nasser and p. flora detecting performance anti patterns for applications developed using object relational mapping in proceedings of the 36th international conference on software engineering pp.
.
q. t. tran k. morfonios and n. polyzotis oracle workload intelligence in proceedings of the acm sigmod international conference on management of data.
acm pp.
.
p. s. yu m. chen h. heiss and s. lee on workload characterization of relational database environments ieee trans.
software eng.
vol.
no.
pp.
.
g. kul d. t. a. luong t. xie v .
chandola o. kennedy and s. upadhyaya similarity metrics for sql query clustering ieee transactions on knowledge and data engineering vol.
no.
pp.
.
s. jain b. howe j. yan and t. cruanes query2vec an evaluation of nlp techniques for generalized workload analytics arxiv preprint arxiv .
.
n. arzamasova k. b ohm b. goldman c. saaler and m. sch aler on the usefulness of sql query similarity measures to find user interests ieee transactions on knowledge and data engineering vol.
no.
pp.
.
x. yang c. m. procopiuc and d. srivastava summarizing relational databases proc.
vldb endow.
vol.
no.
pp.
.
g. kul d. luong t. xie p. coonan v .
chandola o. kennedy and s. upadhyaya ettu analyzing query intents in corporate databases inproceedings of the 25th international conference companion on world wide web pp.
.
z. zolaktaf m. milani and r. pottinger facilitating sql query composition and analysis in proceedings of the international conference on management of data sigmod .
acm pp.
.
w. kl osgen explora a multipattern and multistrategy discovery assistant in advances in knowledge discovery and data mining.
aaai mit press pp.
.
m. atzmueller subgroup discovery wiley interdiscip.
rev.
data min.
knowl.
discov.
vol.
no.
pp.
.
b. r. goldsmith m. boley j. vreeken m. scheffler and l. m. ghiringhelli uncovering structure property relationships of materials by subgroup discovery new journal of physics vol.
no.
p. .
s. helal j. li l. liu e. ebrahimie s. dawson and d. j. murray identifying key factors of student academic performance by subgroup discovery int.
j. data sci.
anal.
vol.
no.
pp.
.
c. c. licon g. bosc m. sabri m. mantel a. p. fournel c. bushdid j. golebiowski c. robardet m. plantevit m. kaytoue and m. bensafi chemical features mining provides new descriptive structure odor relationships plos comput.
biol.
vol.
no.
.
mozilla moz sql parser.
.
available mozilla moz sql parser oracle help center active session history.
.
available guid 69cea3a1 6c5e 43d6 982c f353cd4b984c.htm pgsentinel pgsentinel sampling active session history.
.
available k. aouiche p. e. jouve and j. darmont clustering based materialized view selection in data warehouses in east european conference on advances in databases and information systems.
springer pp.
.
v .
h. makiyama j. raddick and r. d. santos text mining applied to sql queries a case study for the sdss skyserver.
in simbig pp.
.
s. deep a. gruenheid p. koutris j. f. naughton and s. viglas comprehensive and efficient workload compression proc.
vldb endow.
vol.
no.
pp.
.
t. scheffer and s. wrobel finding the most interesting patterns in a database quickly by using sequential sampling j. mach.
learn.
res.
vol.
pp.
.
n. lavrac b. kavsek p. a. flach and l. todorovski subgroup discovery with cn2 sd j. mach.
learn.
res.
vol.
pp.
.
f. lemmerich novel techniques for efficient and effective subgroup discovery ph.d. dissertation julius maximilians university w urzburg germany .
b. f. pieters a. knobbe and s. dzeroski subgroup discovery in ranked data with an application to gene set enrichment in proceedings preference learning workshop pl at ecml pkdd vol.
pp.
.
f. lemmerich m. atzmueller and f. puppe fast exhaustive subgroup discovery with numerical target concepts data min.
knowl.
discov.
vol.
no.
pp.
.
f. lemmerich and m. becker pysubgroup easy to use subgroup discovery in python in european conference on machine learning and knowledge discovery in databases ecml pkdd vol.
.
springer pp.
.
p. clark and t. niblett the cn2 induction algorithm mach.
learn.
vol.
pp.
.
s. niwattanakul j. singthongchai e. naenudorn and s. wanapu using of jaccard coefficient for keywords similarity in proceedings of the international multiconference of engineers and computer scientists vol.
no.
pp.
.
m. atzm uller and f. puppe semi automatic refinement and assessment of subgroup patterns in proceedings of the 21st international florida artificial intelligence research society conference.
s. wrobel d. wettschereck e. sommer and w. emde extensibility in data mining systems in kdd.
aaai press pp.
.
w. kl osgen and m. may spatial subgroup mining integrated in an object relational spatial database in pkdd ser.
lncs vol.
.
springer pp.
.
m. atzmueller and f. lemmerich vikamine open source subgroup discovery pattern mining and analytics in ecml pkdd ser.
lncs vol.
.
springer pp.
.
s. agrawal s. chaudhuri l. koll ar a. p. marathe v .
r. narasayya and m. syamala database tuning advisor for microsoft sql server demo in sigmod conference.
acm pp.
.
t. xie o. kennedy and v .
chandola query log compression for workload analytics arxiv preprint arxiv .
.
m. l. guilly j. petit v .
scuturici and i. f. ilyas explique interactive databases exploration with sql in proceedings of the 28th acm international conference on information and knowledge management cikm .
acm pp.
.
z. chen and t. li addressing diverse user preferences in sqlquery result navigation in proceedings of the acm sigmod international conference on management of data pp.
.
l. hu k. a. ross y .
c. chang c. a. lang and d. zhang queryscope visualizing queries for repeatable database tuning proceedings of the vldb endowment vol.
no.
pp.
.
g. bosc j. boulicaut c. ra ssi and m. kaytoue anytime discovery of a diverse set of patterns with monte carlo tree search data min.
knowl.
discov.
vol.
no.
pp.
.
a. belfodil a. belfodil a. bendimerad p. lamarre c. robardet m. kaytoue and m. plantevit fssd a fast and efficient algorithm for subgroup set discovery in ieee international conference on data science and advanced analytics dsaa .
ieee pp.
.