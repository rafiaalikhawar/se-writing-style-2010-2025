fira fi ne grained gra ph based code change representation for automated commit message generation jinhao dong key laboratory of high confidence software technologies peking university moe school of computer science peking university beijing china dongjinhao stu.pku.edu.cnyiling lou department of computer science purdue university west lafayette in usa lou47 purdue.edu qihao zhu zeyu sun zhilin li key laboratory of high confidence software technologies peking university moe school of computer science peking university beijing china zhuqh szy pku.edu.cnwenjie zhang dan hao key laboratory of high confidence software technologies peking university moe school of computer science peking university beijing china zhang wen jie haodan pku.edu.cn abstract commit messages summarize code changes of each commit in natural language which help developers understand code changes withoutdiggingintodetailedimplementations andplayanessential role in comprehending software evolution.
to alleviate human effortsinwritingcommitmessages researchershaveproposedvariousautomatedtechniquestogeneratecommitmessages including template based information retrieval based and learning based techniques.
although promising previous techniques have limited effectivenessduetotheir coarse grainedcodechangerepresentations.
this work proposes a novel commit message generation technique fira whichfirstrepresentscodechangesviafine grained graphs and then learns to generate commit messages automatically.differentfromprevioustechniques firarepresentsthecode changes with fine grained graphs which explicitly describe thecode edit operations between the old version and the new version andcodetokensatdifferentgranularities i.e.
sub tokensand integral tokens .
based on the graph based representation fira generates commit messages by a generation model which includes a graph neural network based encoder and a transformer based decoder.
to make both sub tokens and integral tokens as available ingredients for commit message generation the decoder is further incorporatedwithanoveldualcopymechanism.wefurtherperform an extensive study to evaluate the effectiveness of fira.
our quantitative results show that fira outperforms state of the art corresponding authors permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
in terms of bleu rouge l and meteor and our ablationanalysisfurthershowsthatmajorcomponentsinourtechnique both positively contribute to the effectiveness of fira.
in addition wefurtherperformahumanstudytoevaluatethequality of generated commit messages from the perspective of developers and the results consistently show the effectiveness of fira over the compared techniques.
ccs concepts softwareanditsengineering softwaremaintenancetools .
keywords commitmessagegeneration graphneuralnetwork codechange representation acm reference format jinhaodong yilinglou qihaozhu zeyusun zhilinli andwenjiezhang dan hao.
.
fira fine grained g raph based code change representation for automated commit message generation.
in 44th international conferenceonsoftwareengineering icse may21 pittsburgh pa usa.acm newyork ny usa 12pages.
introduction whendeveloperscommitchangedcodetoaversioncontrolsystem eachcommitissupposedtobedocumentedwitha commitmessage.
commitmessagessummarizecodechangesinnaturallanguage and can help developers quickly understand the high level intention of code changes without digging into detailed implementations.
therefore commitmessagesareprevalentinsoftwaremaintenance andplayanessentialroleincomprehendingsoftwareevolution .
however manually writing commit messages can be very laborintensive.
high quality commit messages should precisely describe the rationales of changed code which often requires non trivial manualeffortsinpractice.inaddition modernsoftwarehasbeen evolving rapidly and frequent commit submissions put a heavy ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa jinhao dong yiling lou qihao zhu zeyu sun zhilin li and wenjie zhang dan hao burdenondevelopers.therefore althoughcommitmessagesare beneficial theyareoftenneglectedbydevelopersduetothetime costs.
as is reported almost commit messages in 23k java projects are empty .
to alleviate manual efforts in writing commit messages researchers have proposed various techniques to generate commit messages automatically.
given a code change these techniques first represent the old version and new version code with specific formats suchassequencesoftokensorpathsofabstractsyntaxtree ast andthengeneratecommitmessagesbasedontherepresentations via different strategies such as template based information retrieval based and learning based techniques.
although achieving promising performance the effectiveness of previoustechniqueshasbeenrestrictedbytheir coarse grainedcode change representations.
first existing commit message generation techniquesrepresentthecodechangesbysimplyputtingold version and new versioncode togetherwithout explicitlyhighlighting finegrained edit operations.
for example given an expression a modifiedinto b token basedrepresentations represent such code changes by concatenating both expressionsinto one flat sequence of tokens i.e.
a b where denotes the old new version code the ast based representations represent the code changes by concatenating old versionandnew versionastpathsintoonesequence i.e.
assignment.variable.a.operator.
.literal.
assignment.variable.b.operator.
.literal.
.
therefore existing learning basedmodelshavetocomparethecoderepresentationsofold and new versions so as to capture the subtle edit operation i.e.
thetoken a ischangedintoanewtoken b bythemselves which makes it more challenging to generate precise commit messages.
second existing code change representations mainly focus on coarsegrainedtokens i.e.
integraltokens inthecodewithoutexplicitlyand individuallydescribingfiner grainedtokens i.e.
sub tokensofinte graltokens .
infact itisprevalentthatthecommitmessages may containsub tokensoftheinputcodechanges.forexample fora codechangethatcontainsanintegraltoken setminimumsize its relevantcommitmessagecontainsthreetokens set minimum and size whichareexactlythesub tokensoftheintegraltoken setminimumsize .however mostprevioustechniques consideronlyintegraltokensandignoresub tokensintheircode changerepresentations whileafewtechniques represent allsub tokensinacompoundrepresentation e.g.
onesingleembedding vector without representing each sub token individually.
suchcompoundrepresentationsmakeitchallengingtoutilizeeach sub token as available ingredients for commit message generation.
therefore they exhibit a poor performance for the cases that commit messages contain sub tokens of the input code.
to address the limitations above in this work we propose a novel commit message generation technique fira which first representscodechangesvia fine grainedg raphsandthenlearns to generate commit messages automatically.
compared to previous codechange representations firamakes the firstattempt toex plicitly describe the edit operations between the old version and new version code along with tokens at different granularities i.e.
integraltokensandsub tokens .basedontheproposedgraph based representations fira then learns to generate commit messagesiterativelywithanencoder decodermodel.inparticular firaincorporatesthegraphneuralnetworkintheencodersoastodirectly encodethegraph structuredinputs andthedecoderincorporates the transformer and a novel dual copy mechanism which can notonlygeneratetokensfromthevocabularybutalsocopyboth integral tokens and sub tokens from the input.
we perform an extensive evaluation to compare fira with sixstate of the artcommitmessagetechniquesonawidely used benchmark .
the results show that fira outperformsallcomparedtechniquesintermsofbleu rouge l and meteor.
we further analyze the effectiveness of each component in fira by an ablation study and case analysis.
the results further confirm that major components i.e.
explicitly representing edit operationsandcopyingsub tokens bothpositivelycontributeto the effectiveness of fira and indeed help generate higher quality commitmessagesthanprevioustechniques.inaddition wefurtherperformahumanstudytoevaluatethequalityofgeneratedcommit messagesfromtheperspectiveofdevelopers whichconsistently shows the effectiveness of fira over compared techniques.
in summary this paper makes the following contributions a fine grained graph based code change representa tion for commit message generation which explicitly describescodeeditoperationsandtokensatdifferent granularities.
anovelencoder decodermodel forcommitmessagegeneration which leverages the graph neural network in theencoder to process the proposed graph based representation andleveragesthetransformerwithanoveldualcopy mechanisminthedecodertoutilizebothintegraltokensand sub tokens.
anextensiveexperiment evaluatingourapproachagainst six state of the art techniques on a widely used benchmark which suggests the effectiveness of our approach by the quantitative qualitative and ablation analysis.
a human study on the quality of generated commit messages whichfurthershowstheeffectivenessofourapproach from the perspective of developers.
areplicationpackage availableat fira icse.
motivation existing commit message generation techniques represent and utilize code changes in a coarse grained way.
first they simply put old versionandnew versioncodetogetherwithoutexplicitlydescribing fine grained edit operations second they only focus on coarse grainedtokens i.e.
integraltokens withoutrepresenting sub tokens individually.
in this section we further illustrate these limitations with several real world examples.
.
limitation edit operations as shown by the example in figure we can observe that edit operationsarehighlyrelevanttodeveloper writtencommitmessages.
the developer makes the edit operation i.e.
adding one token abstract and the corresponding commit message indicates his herintentionofmakingtheclassabstract.however existing techniquescannotalwaysnoticesucheditoperations sincetheir authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fira fine grained gra ph based code change representation for automated commit message generation icse may pittsburgh pa usa private class formauthclientbase extends simplehttpclient public class testformauthenticator extends tomcatbasetest private abstract class formauthclientbase extends simplehttpclient protected static final string login param tag action protected static final string login resource j security check figure motivating example edit operations a codisum b atom figure existing code change representations code change representations put old version and new version code together without explicitly highlighting the differences.
therefore theyhave tocompare old versionandnew version codeandthen infer theedit operations bythemselves.
for example asshown in figure2a codisum oneofthelearning basedapproaches represents the code change by concatenating the flat token sequences of old version and new version code into one sequence.
althougheachtokeninthesequenceisannotatedwitholdversion ornewversion codisumhastolearntoinferthespecificedit operation i.e.
one token abstract is added by itself.
similarly in figure2b anotherlearning basedtechniqueatom represents the code changes by concatenating old version and new version astpathstogether anditalsohastocomparetwopathsbyitselfso as to capture the edit operations at ast level.
such coarse grained codechangerepresentationsareactuallycumbersome especially when code changes involve very minor edit operations with the majorityoftokensunchanged e.g.
onlyonetokenischangedin the example .
learning based techniques cannot always guarantee to precisely capture such subtle edit operations which may fur ther result in imprecise commit message generation.
in fact our experimentalresultsalsoconfirmthatthesetechniquesallfailto generate precise commit messages for this example.
toaddressthislimitation weproposetoexplicitlyhighlightedit operationsinthecodechangerepresentation whichcaninclude more accurate information for commit message generation.getsupportactionbar .addtab newtab public class feature toggles extends sherlockactivity newtab.settext text!
newtab.settab listener feature toggles.this figure motivating example sub tokens .
limitation sub tokens as shown by the example in figure we can observe that subtokens in the input code can provide very helpful hints for commit message generation.
for example the developer written commit message addtablistenerforfeaturetoggles consistsofthesubtokens tab listener feature and toggles in the input code.
however existing techniques focus on integral tokens and seldom treatsub tokenasequallyimportantasintegraltoken.forexample most existing techniques ignore sub tokens in their code change representations while a few techniques describeallsub tokensinacompoundrepresentation e.g.
onesingle embedding vector without representing sub tokens explicitly and individually.suchcompoundrepresentationsrestricttheutilization of sub tokens.
for example with such representations existing techniquescanonlygeneratethefrequentsub tokensthatareincludedinthevocabulary butoftenfailtogeneratethoseinfrequent sub tokens that are excluded in the vocabulary or seldom occurin the training set.
actually for the generation tasks related toprogramcode suchinfrequentsub tokenscanbeveryprevalent since they are often project specific tokens e.g.
tab and toggles in the example .
therefore existing coarse grained code change representations make it challenging to generate commit messages containing such sub tokens.
therefore to fully utilize sub tokens in the code we propose totreatallintegraltokensandsub tokensequallyimportantand representsub tokensindividuallyinthecodechangerepresentation.
in addition to make both frequent and infrequent sub tokens asingredients of the commit message we further leverage a novel dualcopymechanismadditionallyforsub tokensinourmodelso that both integral tokens and sub tokens can be either copied or generated from the vocabulary.
code change representation this section presents our fine grained graph based code change representation whichexplicitlyincludeseditoperationsandsubtokens to enable more precise commit message generation.in particular thegraphconstructionconsistsoffoursteps including buildingchoppedabstractsyntaxtrees section .
addingsubtokens section .
annotatingeditoperations section .
and incorporatingadditionalsequentialinformation section .
.we then introduce each step in detail and use the motivating example in figure 1for illustration.
.
chopped abstract syntax trees a typical code change often includes the modified code and its surroundingcontext.forexample acodechangeingithub e.g.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa jinhao dong yiling lou qihao zhu zeyu sun zhilin li and wenjie zhang dan hao figure graph ast chopped ast figure1andfigure oftencontainsmultiplelinesofcodeandeach linestartswithitschangetype.morespecifically denotesthe deleted old version code denotes the added new version code and the empty character denotes the unchanged code both in oldandnewversion.acodechangemayinvolvesingleormultiple hunks.here a hunkreferstothecontinuouslineswiththesame changetype.amongcommitsingithub somemaymodifyonly one token in a hunk while some may modify hundreds of lines in multiplehunks.existinglearning basedtechniquesoftenrepresent all the changed code together e.g.
codisum concatenates all deleted addedhunksasonesequenceandatom constructs astoftheentirecodefileevenifthecodechangesoccurinonly severallinesinthefile.representingthecodechangeasawholecanobfuscatedetailsamonghunksandthusmakesitmorechallenging for the commit message generation model to summarize essential featuresfromsuchacoarse grainedrepresentation.therefore in fira we propose to construct ast at hunk level so that more detailedinformationcanbereservedwhenthecodechangeinvolves multiple hunks.
morespecifically givenacodechange wefirstseparateitinto several hunks according to their change types then for each hunk weparseittoconstructitsownabstractsyntaxtree i.e.
chopped ast.inthisway weobtainasetofchoppedastsforthegivencode change which are actually a set of graphs with basic semantic and syntactic informationof each hunk.
in particular forthe chopped ast of a deleted hunk i.e.
all its lines are deleted we denote it as astoldsince the relevant code only exists in the old version for the chopped ast of an added hunk i.e.
all its lines are added wedenoteitasast newsincetherelevantcodeonlyexistsinthe new version.
we denote the graph constructed in this phase as graphast.
figure4presents the graph astof changed lines in the illustration example where class dcl is the abbreviation of the ast node type class declaration and c is the placeholder of the class name formauthclientbase .
figure graph token graph astextended with sub tokens .
sub tokens asmentionedinsection commitmessagesoftencontaincoarse finegrained tokens i.e.
integral tokens and sub tokens in the inputcode.suchaphenomenonisprevalent sinceitisacommonpractice for developers to name a function or a class with phrases.
forexample givena methodnamed as deleteoldthreaddumps this integral token consists of four sub tokens delete old thread dumps which describe the functionality of the method and might beadoptedinthecommitmessagewhencodechangesarerelevant tothismethod.therefore inourrepresentation weconsidernot onlytheintegraltokensbutalsotheirsub tokens.morespecifically in eachgraph ast forthe node withan integraltoken we splitit into separated sub tokens according to the widely adopted naming convention i.e.
camel case and snake case represent these sub tokens as extra nodes in the graph and then connect them with theirbelongingintegraltokennodes.inthisway thechoppedast is extended with nodes and edges relevant to sub tokens where integraltokensandsub tokensareequally importantindividuals and both can be directly utilized in the subsequent commit message generation.
we denote the graph constructed in this phase as graphtoken.figure5presentsthegraph token whichextendsthe graphast i.e.
figure with sub token information.
figure graph edition graph tokenextended with edit nodes .
edit operations sofar allnodesinthegraphrepresentcodeelements whichare denoted as code nodes for distinction.
based on graph token w e further introduce edit nodes to explicitly represent fine grained edit operations between ast oldand ast new.
in particular we considerfiveeditnodes includingv add vdel vmove vupdate and vmatch.
vadd.ifthecodenode vexistsinast newbutnotinast old visnewly addedandshouldbeconnectedwithaneditnode vadd.
vdel.ifthecodenode vexistsinast oldbutnotinast new visdeletedandshouldbeconnectedwithaneditnodev del.
vmove.ifthecodenode vexistsinbothast oldandast new andthepositionsof vanditssub treearemoved thenode vin both ast oldand ast newshould be connected with an edit node v move.
vupdate.
if the code node vexists in both ast oldand astnewanditsvalueisupdated thenodes vinbothast old andast newshouldbeconnectedwithaneditnodev update.
vmatch.i fan od e vexists in both ast oldand ast newand itsvalueandpositionremainunchanged thenodes vinboth authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fira fine grained gra ph based code change representation for automated commit message generation icse may pittsburgh pa usa astoldand ast newshould be connected with an edit node vmatch.
according to the description above we further insert edit nodes tothegraph tokenbyconnectingthemwiththeoriginalcodenodes.
wedenotethegraphconstructedinthisphaseasgraph edition.figure6presentsthegraph edition whichfurtherextendsthegraph token i.e.
figure with edit nodes.
figure graph seq one line graph figure graph final fine grained representation for code changes .
additional sequential information so far the code change has mainly been represented based on the ast structure.
as suggested by previous work the sequential information i.e.
treating code as a flat token sequence can also be helpful for commit message generation since it can reservetheadjacentrelationshipandtheorderofthetokens.therefore we further extend graph editionwith additional sequential informationsoastoincludemorehelpfulinformation.inparticular we first build an extra one line graph denoted as graph seq b y regarding each token as a node and connecting every two adjacent nodes.
figure 7presents the graph seqof the code change hank.
then wemergegraph seqwiththegraph editionbyusingthenodes existing in both graphs as the anchor nodes.
more specifically for each node viin graph edition i fvimatches with the node vjin graphseq viis removed from graph editionand all its connected edges arere connected with vj.
inthis way wecombine the astbasedinformation i.e.
graph edition andsequentialinformation i.e.
graph seq intoonelargergraph i.e.
asgraph final.figure8 presents the graph finalfor the illustration example which further extends the graph edition i.e.
figure with additional sequential information.
model architecture figure9presents the overview of our model whose input is the final graph based code change representation and output is thegenerated commit message.
overall the model is in an encoderdecoder architecture.
in the encoder we adopt graph neural networks gnn due to its strong capability of processing graphstructureddata .inthedecoder weleverage thetransformerarchitecture whichisthestate of the artsequencetosequencemodelandiswidelyusedinvariousgeneration tasks to generate tokens in commit messages iteratively.
when generating the next token the decoder first performs selfattention between the current token and the previously generated tokens andthenperformscross attentionoverinputtokensembeddedbytheencoder.inaddition tofullyutilizetheintegraltokens and sub tokens in inputs the decoder further incorporates a novel dual copy mechanism which can copy both integral tokens and sub tokensfromtheinputs.inotherwords ineachiteration the model can choose an integral token or a sub token with highestprobability from the vocabulary or directly from the inputs.
we then describe each component in detail.
!
!
!
!
!
!
!
!
!
!
!
figure architecture of the proposed model .
encoder given the final graph based representation of code changes i.e.
graphfinal theencoderfirstembedsthenodeswithanembedding layer i.e.
in section .
.
then the graphs are represented by embedding vectors and an adjacency matrix which can be further fed to a graph neural network layer i.e.
in section .
.
the final output of the encoder is learned representation vectors for each node which can be further used by the decoder.
.
.
embedding layer.
formally the final graph based representation of code changes graph finalcan be defined as g v e wherevdenotes the nodes and edenotes the edges in the graph.
as mentioned above vcontains two types of nodes i.e.
code nodesandeditnodes.weestablishalookuptableforbothnodes andcovertthemtoembeddingvectorsbasedonthetable.inparticular the embedding vectors of code nodes can be denoted as and the embedding vectors of edit nodes can be denotedas wherencandnedenotethenumbersof code nodes and edit nodes respectively.
therefore the embedding vectorseforthegraphcanberepresentedby c1 c2 ... cnc e1 e2 ... authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa jinhao dong yiling lou qihao zhu zeyu sun zhilin li and wenjie zhang dan hao ene wheree rdx n n nc ne anddxdenotes the embedding size.
note that embedding vectors are learnable and are initialized randomly.
.
.
graph neural network.
theembedding vectorsare further fedintoagraphconvolutionnetwork gcn layer.gcn isa variantofthegraphneuralnetwork gnn anditleveragesthefirstorder approximation of chebyshev spectral cnn chebnet t o aggregate the feature information among all neighbor nodes .
hereweusean adjacencymatrix andthe embeddingvectors e toidenticallyrepresenttheinputgraph g sothatgcncandirectly processtheinput.foranadjacencymatrix aofg a n n ai jmeanswhetherthereexistsanedgebetweenthenode viand the node vjing.
in order to preserve the information of each node itself we further include self connections to each node in the graph and obtain an enhanced adjacency matrix tildewideawith selfconnections.
in addition to avoid gradient explosion caused by accumulated degrees we apply symmetric normalization to tildewideaand get the normalized adjacency matrix a as shown in equation .
tildewided denotesthedegreematrixof tildewidea whichcanbecomputedby tildewidedii summationtext.
j tildewideaij.
a tildewided tildewidea tildewided .
the output of gcn in the lth iteration can be computed as equation .wg rdx dxis the trainable parameters.
xl 1denotes theembeddingvectorsofthenodesinthelastiteration andinitially x0is the embedding vectors of all nodes i.e.
e .
in addition to boostthelearningprocess weemployresidualconnection and layernormalization similartothetransformerarchitecture .
xl wgxl 1 a afterliterations thefinalrepresentationofthenodescanbe denoted as xl i.e.
xl rdx n. .
decoder the decoder is built on top of a transformer architecture with a noveldualcopymechanismforbothintegraltokensandsub tokens.
.
.
transformer layer.
here we use the decoder part of transformer whichisstackedbymulti headself attention multiheadattentionovertheoutputoftheencoder andafully connected feed forward network.
forbetterillustration wedenotetheoutputoftheencoderas xe i.e.
xe xl.thedecoderdecideseachtokeninthecommitmessageiteratively whichisbasedonboththeoutputoftheencoder xeandthecurrentlygeneratedtokens.whengeneratingthe kth token in the commit message we denote the output of the decoder asxk d i.e.
xk d rdx whichcanbecomputedasequation .for better illustration we use xk dto represent the already generated output x1 d x2 d ... xk d of the decoder.
xk d transformer xe xk d next we introduce the detailed computation process of transformer.first transformercomputesmulti headself attention i.e.
ak d .ak distheconcatenationofmultiplesingleattention ak d i which istheweightedsumofthealreadygeneratedoutput xk d asshown in equation 4and equation .wq i rdx dx wk i rdx dx wv i rdx dx wo rdx hdxdenote the projection parameters andhis the number of heads.
ak d i wv i xk d softmax parenlefttpa parenleftexa parenleftexa parenleftbta parenleftbig xk d parenrightbigt wk i t wq i xk d dx parenrighttpa parenrightexa parenrightexa parenrightbta ak d wo ak d ak d ... ak d h second transformer computes multi head attention between ak d andtheoutputoftheencoder xe whichisdenotedas akeandshown in equation 6and equation .
ak e i wv i xe softmax parenleftbigg xetwk i t wq i ak d dx parenrightbigg ak e wo ak e ak e ... ak e h third akepasses a fully connected feed forward network to get theoutput xk d asshowninequation .w1 rdx dx w2 rdx dx b1 rdx b2 rdxare trainable parameters.
xk d w2 max w1ak e b1 b2 xk dis then fed to a linear layer and transformed into a v dimensionvector okvasshowninequation .
v denotesthesize of the vocabulary and wv r v dxis a trainable parameter.
ok v wvxk d at last for each token in the vocabulary the decoder calculates its probability of being selected as the next token by passing okv to asoftmaxlayer.
pkvdenotes the probability distribution across the vocabulary and pkv i denotes the probability of the ith token being selected which is computed as equation .
pk v i exp okv i summationtext.
v j 1exp okv j .
.
dual copy mechanism.
to fully utilize both integral tokens andsub tokensduringcommitmessagegeneration weproposeand includeanoveldualcopymechanisminthedecoder.inthisway when generating each token in the commit message the candidate tokens can be selected not only from the vocabulary but also from the integral tokens or sub tokens in the input.
more specifically in the kth iteration the probability of each input token being copied is computed according to the current output of the decoder i.e.
xk d .
in fira we consider the input token which is the most similar to xk dwith the highest probability of being copied.
given an input token i.e.
a code node vjing itssimilarityto xk dcanbecomputedbythesumofitsembedding vector xj eandtheoutputofthedecoder xk d asshowninequation .
w1 rdx dx w2 rdx dx v rdxare learnable parameters.
sk j vttanh w1xk d w2xj e authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fira fine grained gra ph based code change representation for automated commit message generation icse may pittsburgh pa usa thesimilarityof kthtoken skisfurtherfedtoa softmaxlayer which generates the probability of each input token being copied i.e.
pkc softmax sk .
at the end of the iteration we combine the probability distributionacrossthevocabularytokens i.e.
pkv andtheprobability distribution across input tokens i.e.
pkc as equation .gare learnedaccording totheoutput ofthedecoder asshownin equation12.w r1 dxisthelearnableparameter.inthisway the kth token to be selected in the commit message would be a token from the vocabulary or copied from inputs.
g exp wxk d pk g pk v g pk c experimental setup .
research question rq1 overalleffectiveness.
howdoesfiraperformcompared to the state of the art commit message generation techniques?
rq2 ablation analysis.
how does each component of fira contribute to the effectiveness?
rq3 human evaluation.
how does fira perform from the perspective of developers?
.
dataset ourexperimentsareevaluatedonthewell establishedbenchmark which has been widely used in previous commit message generationtechniques .thedatasetisbasedon the commits from top popular java projects in github excluding rollback merge commits and duplicated code changes.
for eachcommit itincludesthe firstsentenceof therelevantcommit message.
in total the dataset contains pairs of commits and the relevant commit messages.
following existing work we randomly select commits as the training set commits asthevalidationset andtheremaining7 661commitsasthetesting set.
.
compared techniques we compare fira with six state of the art commit message generation techniques as follows.
information retrieval based techniques leverage information retrieval ir to adopt existing commit messages from similar code changes.
we consider two representative ir based techniques nngen and loggen for comparison.
learning basedtechniques leverageneuralmachinetranslation nmt models to generate commit messages automatically.
we consider four state of the art learning based techniques i.e.
codisum atom coregen and corec for comparison.
.
implementation representations.
fira applies gumtree to map asts of oldversion and new version code and then to identify edit operations.gumtree is a representative ast mapping algorithm and has been widely adopted in various tasks .
model.intheencoder wesetthesizeoftheinputgraphs i.e.
the maximumnumberofnodes upto650 containingupto370code nodes and edit nodes which is more than the number of the graph nodes of each training data so that the largest graphs in the trainingsetcanbeincluded.inthedecoder wesetthemaximum length of each commit message as which is longer than the length of all commit messages in the training set.
for the hyper parameters we configure the six layer gnn with .
dropout rate andthesix layereight headtransformerwith0.10dropout rate and dimension hidden states.
in the training phase we adopt the cross entropy loss function and the adam optimizer with .
learning rate.
we tune these hyper parameters and select the best performing model in the validation set.
compared techniques.
wedirectly reusethe implementations of the compared techniques from their reproducible packages if their packages are available and executable otherwise we re implement the techniques strictly following the description in their papers.
environment.
the experiments are performed on a dell workstation with intel xeon cpu e5 v4 .40ghz running ubuntu .
.
lts.the models aretrained ontwo 24g gpusof geforce rtx and two 24g gpus of nvidia titan rtx.
.
evaluation metrics we use the commit messages i.e.
manually written by developers inthedatasetasthegroundtruth.inparticular givenacodechange we compare the similarity between the generated commit message withthegroundtruth.followingpreviousworkoncommitmessage generation weusethewidely usedmetrics bleu rouge l and meteor to measure the similarity.
their computation details are presented as follows.
bleumeasures the precision of generated sequences by calculating its average of the modified n gram precision i.e.
gram grams grams and grams forbleu .
the modifiedngramprecisionreferstotheratioofthenumberofmatchedn grams to the number of all the n grams in the generated sequence.
so far researchers have proposed several variants of bleu.
according to a recent human study the b norm bleu exhibits the most consistentlywithhumanjudgementsonthequalityofcommitmessages.
therefore in this paper we use b norm bleu as one of the metrics.
rouge l calculatesthef scoreofprecisionandrecallbasedon thelongestcommonsub sequences lcs betweenthegenerated sequence and the ground truth .
a longer lcs indicates the higher similarity between two sentences.
meteor calculates the harmonic mean of gram precision and gram recall of the generated sequence against the ground truth .
italso includesa penaltymechanism whenthe matched tokens are not adjacent.
results and analysis in this section we first present the overall results of fira rq1 in section6.
the results of the ablation study rq2 in section .
and human evaluation rq3 in section .
.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa jinhao dong yiling lou qihao zhu zeyu sun zhilin li and wenjie zhang dan hao table overall commit message generation results model bleu rouge l meteor loggen .
.
.
nngen .
.
.53coregen .
.
.90codisum .
.
.83atom .
.
.73corec .
.
.
fira .
.
.
.
rq1 overall effectiveness table1presentsaverageofbleu rouge landmeteoronall the commit messages generated by fira and compared techniques.figure10furthershowsthedistributionofrouge linaboxplot.
figure box plot of rouge l as shown by the table and the figure fira outperforms all the comparedtechniquesincludingthebestir basedtechniquenngen and the best learning based technique codisum on all metrics indicatingeffectivenessbothinprecision i.e.
bleu rouge landmeteor andrecall i.e.
rouge landmeteor .forexample theimprovementsachievedbyfirarangefrom7 to112 to112 and to in bleu rouge l and meteor respectively.
in addition it is notable that the ir based approaches loggen and nngenperformsignificantlyworse.apotentialreasonisthatthese techniquescanonlyretrieveexistingmessagesfromtheretrieved database instead of generating new commit messages.
in other words they are no longer effective once there exists no similar code change as the given code change.
table penalty bleu of all approaches model loggen nngen coregen codisum atom corec fira penalty bleu .
.
.
.
.
.
.
bleu may overrate the precision of the cases that the actual number of the matched n grams is small but the length of the commitmessageisevenshorter whichmayresultinbiasedaverageofallcommitmessages.therefore forthoseshortcommitmessages we introduce a penalty mechanism by multiplying their originalbleu with a penalty factor to reduce their impact on the final averagescore.thepenaltyfactor fiofthei thcommitmessagecan be computed as equation which is the ratio of the length of the i th ground truth commit message to the total length of all ground truth commit messages.
fi len msgi summationdisplay.
jlen msgj wedenotethebleuwithanenhancedpenaltyaspenalty bleu fordistinction.table 2presentsthepenalty bleuofallapproaches.
from the table we can find that our approach also outperforms other approaches in terms of the penalty bleu indicating fira is consistently effective on generating commit messaging of different lengths.
in summary our quantitative results show that fira outperformsallsixcomparedtechniquesintermsofallstudiedmetrics meanwhile fira is consistently effective on generating commit messages of different lengths.
.
rq2 ablation study inthissection wefurtherperformanablationstudytoinvestigate the effectiveness of each component in fira.
the major noveltyof fira is explicitly including and analyzing edit operations between old and new versions and copying sub tokens with a dual copy mechanism.
therefore to investigate their contribution we further build two variants of fira by removing the edit operationsfromthecodechangerepresentationgraph i.e.
denoted as fira edit and degrading the dual copy mechanism into single copy mechanism for integral tokens which cannot copysub tokens anymore i.e.
denoted as fira sub .
in addition we build a naive model by removing both components i.e.
denoted as fira both for comparison.
table 3presents the effectiveness of thedefaultfiraandvariants.inthefollowingsections wethenanalyze the contribution of each component quantitatively and qualitatively.
table results of the ablation study model bleu rouge l meteor firaedit .
.
.
firasub .
.
.
firaboth .
.
.
fira .
.
.
.
.
contribution of edit operations.
as shown in table the effectiveness of fira edit becomes worse in terms of all three metrics indicating that including edit operations is helpful for commit message generation.
we further look into some cases that fira edit exhibits less effective than the default fira in terms of these metrics.
figure presentssuchareal worldcase whichincludesthecodechanges the ground truth the commit messages generated by the defaultfira fira edit and other compared techniques including the bestir basedtechniquenngenandthebestlearning basedtechniquecodisum.inthisexample developersrenamethemethod from getinputeventlistener t o getinputeventhandler i n authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fira fine grained gra ph based code change representation for automated commit message generation icse may pittsburgh pa usa return minputeventhandler throw new illegalstateexception fragment inputeventlistener already present mfragment.setinputeventhandler minputeventhandler public class playbackoverlayfragment extends detailsfragment public abstract class playbackcontrolglue throw new illegalstateexception fragment onitemviewclickedlistener already present mfragment.setonitemviewclickedlistener monitemviewclickedlistener if mfragment.
getinputeventhandler !
null public final inputeventhandler getinputeventlistener public final inputeventhandler getinputeventhandler if mfragment.
getinputeventlistener !
null !
!
!
!
!
!
!
!
figure case analysis edit operations two involving files and the manual commit message exactly describes such edit operations.
as shown in the figure the default firacanpreciselygeneratetheexactlysamemessageasdevelopers whereasafterremovingexplicitrepresentationofeditoperations firaedit failstogeneratesuchcorrectmessage.inaddition we canobservethatothercomparedtechniquescannotgeneratethe precisecommitmessageneither sincenoneofthemrepresentsedit operationsexplicitly.suchobservationsfurtherconfirmourintuitionthatrepresentingeditoperationsexplicitlycanhelpthemodel to capture the fine grained code changes enabling more precise commitmessagegeneration.onthecontrary iftheold versionand new version code are represented in combination without high lighting their differences the model has to learn to capture such edit operations by itself which can be challenging especially when there are only a few tokens changed.
import java.awt.event.
import java.util.
public class transfercalldialog this.setokbuttontext guiactivator.getresources .geti18nstring service.gui.transfer this.setminimumsize new dimension addokbuttonlistener new actionlistener public void actionperformed actionevent e package net.java.sip.communicator.impl.gui.main.call import java.awt.
!
figure case analysis copying sub tokens .
.
contribution of copying sub tokens.
asshownintable the performanceoffira sub declines indicatingthedualcopymechanism for sub tokens indeed boosts commit message generation.
wefurtherlookintosomecasesthatfira sub exhibitslesseffectivethanthedefaultfiraintermsofthesemetrics.figure presentssuchareal worldcaseinourdataset includingthecode changes the ground truth the commit messages generated by the default fira fira sub and other compared techniques.
in the example the developer commit message contains several sub tokensinthenewly addedcode i.e.
setminimumsize andtheintegraltokeninitsbelongingclassname transfercalldialog .asshown in the figure the default fira can effectively utilize sub tokens in theinputcode whilethefira sub withoutthedualcopymechanismisincapableofcopyingtheinfrequentsub token i.e.
minimum tothecommitmessage.inaddition othercomparedtechniquesfail to generate precise commit messages neither.
for example nngen generates a completely irrelevant commit message.
for codisum it includes only two sub tokens in the generated commit message and generates the commit message with poor readability.
since codisum only leverages a single copy mechanism for integral token itcanonlygeneratethefrequentsub tokensfromthevocabulary e.g.
two successfully generated sub tokens setandsize butfailstogeneratetheinfrequentsub token e.g.
minimum that is excluded in the vocabulary or seldom occurs in the training set.
table results for copying sub tokens model copy ratio different sub tokens occurrence frequency nngen .
codisum .
firasub .
fira .
toconfirmtheexplanationabove wefurtherinvestigatewhether dual copy mechanism has correctly copied sub tokens into commit messages.inparticular wedenotethesub tokenappearsbothintheinputcodechangeandthecommitmessageasa copytoken.wethen compute the ratio of the number of correctly copied copy tokens tothenumberofall copytokens inourtestingset.ahigherratio indicatesthetechniqueismoreeffectiveincopyingsub tokens.we alsopresentthenumberofdifferentcorrectly copiedsub tokens.
in addition we further present the average number of times of the correctly copied sub tokens occurring in the training messages whichcanreflecttheoccurrencefrequencyofthesub tokens.table4presents the results.
based on the table we can notice that fira can correctly copy more sub tokens than other techniques andfiracancopymoreinfrequentsub tokens.furthermore we notice that only fira can copy the sub tokens never occurringin the training set.
without the dual copy mechanism the per formance of fira sub declines a lot.
we can notice that nngen performs well in terms of copying sub token because instead of generatingnewcommitmessages ir basedtechniquesselectexisting messages based on the similarity of the code changes and similarcodechangesmayhavecommonsub tokens.however note that the overall performance of ir based techniques i.e.
as shown intable1 ismuch worsethanfira i.e.
.
v.s17.67in bleu .
in summary the results further indicate fira can copy sub tokens effectively.
.
rq3 human evaluation tofurtherstudythequalityofgeneratedcommitmessagesfromthe perspectiveofdevelopers weperformahumanstudytoevaluate the commit messages generated by fira and compared techniques.
we compare fira with the best retrieval based technique nngen and the best learning based technique codisum.
we invite six authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa jinhao dong yiling lou qihao zhu zeyu sun zhilin li and wenjie zhang dan hao developers1toparticipateinthisstudy whohaveindustrialexperience in java programming language ranging from to years.
table scoring criterion scoredefinition 0neitherrelevant in semantic nor having shared tokens.
1irrelevant in semantic but with some shared tokens.
2partiallysimilar in semantic but each contains exclusive information.
3highlysimilar but not identical in semantic.
4identical in semantic.
.
.
study design.
following previous work we randomlyselect100commitsfromthetestingsetanddesignaquestionnaireformanualevaluation.foreachcommit thequestionnaire includesthecodechange thegroundtruthcommitmessage and thecommitmessagesgeneratedbyfiraaswellasthecompared techniques i.e.
thebestir basedtechniquenngenandthebest learning basedtechniquecodisum .eachinvitedparticipantis asked to score the commit messages generated by three techniques i.e.
fira codisum and nngen based on the code changes and thegroundtruthcommitmessage.thescorerangesfrom0to4 and a higher score indicates a higher similarity between the generated commitmessage and thegroundtruth.wefollowtheexistingscor ingcriterion anddetaileddefinitionisshownintable .t o avoidbias allthreetechniquesareanonymousinthequestionnaire and each participant fills in the questionnaire separately.
table results of the human evaluation model low medium high average score nngen .
.
.
.
codisum .
.
.
.
fira .
.
.
.
.
.
results.
for each technique we measure the quality of its generatedcommitmessagebasedontheaveragescoresofsixparticipants on that commit message.
in particular in line with previous work we regard the commit messages scored and as low quality scored as medium quality and scored and as high quality.
table 6presents the ratio of commit messages of differentquality.asshowninthetable alargeproportion i.e.
.
of commit messages generated by fira are considered as high quality by the participants.
in addition fira exhibits the largestratio of high quality commit messages while the lowest ratio of low quality commit messages.
the average score also indicates the out performance of fira over compared techniques.
to confirmour observations we further conducted a wilcoxon signed rank test between the scores of fira and the other techniques.
the results further confirm that difference between the scores of fira and nngen codisum is statistically significant at the confidence level of .
.
.
successful cases.
we further present two cases that fira achieveshigherscoresinfigure 13andfigure .eachfigureincludesthecodechange thegroundtruth andthecommitmessages 1none of them are co authors of this paper.
public class deeplearningautoencodertest extends testutil cleanup mymodel.delete frame.delete p.delete l2 frame.delete public class deeplearningautoencodertest extends testutil reconstructed.delete frame dkv.get key.make difference .get .delete diff.delete !
!
!
frame.add dummy resp resp.remove null figure example of fixing memory leak generatedbyfiraandthecomparedtechniques i.e.
nngenand codisum.
thefirstexampleinfigure 13showsthecodechangesforfixinga memory leakbug.inparticular theold versioncode resp.remove null fails to delete the object resp which results in a memory leak while the new version code puts resp as a member of frame which can successfully delete resp once frame i s deleted.asshowninthefigure firasuccessfullypredictstheintention of fixing memory leak and also the location of where memoryleakoccurs whichweconsiderasaprecisecommitmessage whereas other approaches fail to generate such commit messages.
locale locale metricsutils.getmetricsreporterlocale stormconf if locale !
null builder.formattedfor locale public class consolepreparablereporter implements preparablereporter consolerepo log.debug preparing... consolereporter.builder builder consolereporter.forregistry metricsregistry builder.outputto system.out printstream stream system.out if stream !
null builder.outputto stream !
!
!
figure example of removing unnecessary null check the second example in figure 14shows the code changes for removinganunnecessarynullcheck sincetheobject stream never becomes null.
as shown in the figure fira appears to capture the functionality ofchanged code i.e.
null check and thusgenerates similarmessagewiththegroundtruth.incontrast thecompared approaches fail to generate proper descriptions for the given code change nngen generates completely irrelevant message while codisum generates over general and uninformative message.
discussion .
threats to validity theinternalthreattovalidityliesintheimplementationofcompared techniques and our approach.
to reduce this threat we directly reuse the implementationof the compared techniques from theirreproduciblepackages iftheirpackagesareavailableandexecutable otherwise we re implement the techniques authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fira fine grained gra ph based code change representation for automated commit message generation icse may pittsburgh pa usa strictlyfollowingtheirpapers.wealsobuildourapproachbasedon existingmature tools libraries suchasgumtree .inaddition to code review we also sampled data items from our dataset andmanuallyensurethereisnoviolationcasewherecamelcase or snake case is not applicable.
the external threat to validity lies in the dataset used in the experiment.
tomitigate thisthreat weuse a well establisheddataset which has been constructed on popular java projects from github and well cleaned by previous work .
the construct threat lies in the metrics used in evaluation.
to reduce this threat we adopt several metrics that have been widely usedbypriorworkoncommitmessagegeneration .
in addition we further perform a human evaluation to evaluate the effectiveness from the perspective of developers.
we strictly follow the procedure of previous work and inviteexperienceddevelopers soastoreducethethreatsinhuman evaluation e.g.
the limited number of participants .
.
limitations thesectiondiscussesthelimitationsinfira.first ourapproach would be less effective when the code change cannot be parsed into valid ast.
in this case fira would utilize only sub token identifiers and sequential information during learning.
such cases areactuallynotobservedinourdatasetaccordingtoourmanual inspection which however are still p ossible in practice.
second when the training set contains highly similar code changes as the givenoneandthefrequencyofthesesimilardataitemsisquitelow e.g.
onlyonce firaislesseffectivethantheretrieval basedapproaches.
it isa common drawback forlearning based techniques since retrieval based approaches can inherently retrieve the correct commit message for the similar inputs from the training set.
third whenthecommitmessagecontainstokensabsentfromboth vocabulary and the input code change fira would fail to generate these tokens in the commit message.
related work theexistingworkoncommitmessagegenerationcanbecategorized as template based information retrieval based and learningbased techniques.
thetemplate basedtechniques analyzecodechanges andgeneratecommitmessageswithpre definedpatterns.forexample buse and weimer design pre defined templates based onpathpredicates whilecort s coyetal .
proposetemplates based on method stereotypes and commit stereotypes .
in general the template based techniques tend to describe what ischanged but has weak capability of capturing the rationales and purposesofcodechanges.inaddition theyareeffectiveonlywhen the cases perfectly fit with the pre defined rules but cannot be general due to the diversity of commit messages.
theinformationretrieval basedapproaches leverage irtechniquestoadoptexistingcommitmessagesfromsimilarcodechanges.forexample givenacodechangeasaquery liuetal .
leveragecosinesimilarityandbleutoselectamostsimilarcode changefromthetrainingset similarly huangetal .
useboth syntaxsimilarityandsemanticsimilarityasthesimilaritymetric.
however ir based techniques are no longer effective once there isno similar code change in the retrieved database and they can only output existing commit messages instead of generating new ones.
more recently researchers propose to leverage advanced learning techniques in commit message generation.
the learning based techniques regardcommitmessagegenerationasatranslationproblem andadoptneuralmachinetranslation nmt models to generate commit message for the given code change.existing learning basedtechniquesfirst representtheoldversion and new version code with specific formats respectively such as sequences of tokens or paths of abstract syntax tree ast concatenatebothrepresentations andgeneratecommit messagesviadifferentlearningmodels.thecoderepresentations in existing learning based techniques are coarse grained since they represent the code changes by simply putting old version and new version code together and thus edit operations have to be learned by models and they only focus on integral tokens withoutindividuallydescribingsub tokens andthuscommitmessage with infrequent sub tokens cannot be generated.
to address these limitations we propose a fine grained graph based representation for code changes to enable more powerful commit message generation.inadditiontothecodechangerepresentation weproposea novel model that is different from prevision work.
in particular we leverage a graph neural network in the encoder so as to directly encodethegraph structuredinputs andweequipthedecoderwith thetransformerandanoveldualcopymechanism whichcannot only generate tokens from the vocabulary but also directly copy both integral tokens and sub tokens from the input.
conclusion in this work we propose a novel commit message generation technique fira whichfirstrepresentscodechangesviafine grained graphsandthenlearnstogeneratecommitmessagesautomatically.comparedtopreviouscodechangerepresentations firaexplicitly describes the edit operations between the old version and newversion code along with tokens at different granularities.
based on the proposed graph based representations fira generates commit messages by a generation model.
fira incorporates the graph neuralnetworkintheencodersoastodirectlyencodethegraphstructured inputs and the decoder incorporates the transformerand a novel dual copy mechanism which can not only generatetokens from the vocabulary but also directly copy both integraltokens and sub tokens from the input.
we perform an extensive evaluationtocomparefirawithsixcommitmessagetechniquesonawidely usedbenchmark.theresultsshowthatfiraoutperformsallcomparedtechniquesintermsofbleu rouge l andmeteor.
wefurtheranalyzetheeffectivenessofeachcomponentinfiraby anablationstudyandcaseanalysis.theresultsfurtherconfirmthat majorcomponentsbothpositivelycontributetotheeffectiveness offira.inaddition wefurtherperformahumanstudytoevaluate the quality of generated commit messages from the perspective of developers which consistently shows the effectiveness of fira.