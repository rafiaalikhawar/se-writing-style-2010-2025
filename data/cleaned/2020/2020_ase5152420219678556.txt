characterizing and detecting configuration compatibility issues in android apps huaxun huang ming wen lili wei yepang liu shing chi cheung dept.
of computer science and engineering the hong kong university of science and technology hong kong china school of cyber science and engineering huazhong university of science and technology wuhan china dept.
of computer science and engineering southern university of science and technology shenzhen china emails hhuangas cse.ust.hk mwenaa hust.edu.cn liliwei cse.ust.hk liuyp1 sustech.edu.cn scc cse.ust.hk abstract xml configuration files are widely used in android to define an app s user interface and essential runtime information such as system permissions.
as android evolves it mightintroduce functional changes in the configuration environment thus causing compatibility issues that manifest as inconsistent appbehaviors at different api levels.
such issues can often inducesoftware crashes and inconsistent look and feel when running atspecific android versions.
existing works incur plenty of falsepositive and false negative issue detection rules by conductingtrivial data flow analysis while failing to model the xml treehierarchies of the android configuration files.
besides littleis known about how the changes in an android frameworkcan induce such compatibility issues.
to bridge such gaps we conducted a systematic study by analyzing real worldissues collected from popular apps.
we identified commonpatterns of android framework code changes that induce suchconfiguration compatibility issues.
based on the findings wepropose c onf droid that can automatically extract rules for detecting configuration compatibility issues.
the intuition is toperform symbolic execution based on a model learned from thecommon code change patterns.
experiment results show that c onf droid can successfully extract valid issue detection rules with a precision of .
.
among them extracted rulescan manifest issues that cannot be detected by the rules of state of the art baselines.
more importantly out of them have ledto the detection of reproducible configuration compatibilityissues that the baselines cannot detect in out of real worldandroid apps.
index t erms xml configuration android compatibility static analysis i. i ntroduction the android framework provides a flexible xml configuration environment which is widely used by developers to control android components behaviors or even the entire apps such as defining user interface ui structures of the apps layout and declaring the required system permissions and soon.
android continuously evolves to meet different market demands resulting in successive releases of thirty differentapi levels since its launch .
each api level introducesfunctional changes to the android configurations to cater forrevised requirements.
such functional changes can cause thesame configuration element in an android app to manifestinconsistent behaviors at different api levels.
we refer to such shing chi cheung is the corresponding author of this paper.project gecko dev stars .1k source code !
consequences app crashes at api level inconsistent look and feel at api level see figure c !
!
fig.
.
a real world example of configuration compatibility issues reported inbug of gecko dev.
inconsistencies as configuration compatibility issues which can lead to poor user experience.
figure 1shows a real world example of a configuration compatibility issue i.e.
bug reported by an open source android browser engine project called geckodev which has received .1k stars in github .
lines3 specify a selector configuration element to create a color state list object.
it has a child tag named item containing a set of attributes such as android color in line .
the configuration element triggers a compatibilityissue where the app normally works at an api level but throws arrayindexoutofboundsexception at api level and manifests inconsistent look and feel at apilevel .
the issue was caused by the different implementa tions among api levels and to process the attributevalue of android color from xml configuration files in the android framework see section ii b for more details .
in our empirical study we observe that among the real world configuration compatibility issues in popular androidapps .
of them can induce app crashes at certainapi levels while a further .
can induce inconsistentlook and feel across different api levels.
this indicates that inpractice configuration compatibility issues can induce severeproblems in android apps.
nevertheless uncovering configuration compatibility issues caused by such changes is non trivial.
specifically our investi gation of top ranked android apps found that each of them 36th ieee acm international conference on automated software engineering ase 36th ieee acm international conference on automated software engineering ase .
ieee .
ase51524.
.
.
ieee on average specifies .
configuration elements spreading across .
xml files.
typically android apps are designedto run on a range of api levels.
it is expensive to design teststo check whether all these configuration elements and theirattributes are handled as intended across these diverse apilevels.
as a result configuration compatibility issues can easilybe missed by app developers.
although the related officialandroid documentation such as android developers andandroid api differences reports records the informationof configuration changes that can result in compatibility issues such documentation can miss many configuration changes thatmanifest runtime inconsistencies.
even if the relevant changesare documented the documentation can be overlooked by de velopers.
thus an automatic tool to help detect configurationcompatibility issues is helpful.
existing techniques on detecting software misconfigurations and android incompatibilities arenot effective in identifying such configuration compatibilityissues and pinpointing the root cause.
for example the issuebetween api levels and in figure 1is triggered by using different api calls with different guarded conditions toload the value of android color in the xml tag item .
accurate identification of the root cause requires path sensitiveanalysis which can be expensive.
however if we considerthe existence of a compatibility issue whenever there areimplementation differences on how the android frameworkprocesses xml attributes many issues identified are spuriousas many code changes are irrelevant to compatibility issues.it is non trivial to analyze code changes that can triggerconfiguration compatibility issues in the android frameworkwith the large codebase i.e.
4m loc at api level and a huge number of code changes in history i.e.
250git development branches with changes from 566k commitsuntil april .
so far no prior works have studied thecommon patterns of code changes in the android frameworkthat induce configuration compatibility.
to fill such gaps weconducted an empirical study linking the root causes of realconfiguration compatibility issues in popular open sourceandroid apps to the code changes in the android frame work.
we found several common code change patterns thatcan induce configuration compatibility issues in the androidframework section iii .
based on the findings we further propose c onf droid which is a static analyzer encoding the common codechange patterns to automatically generate issue detection rules.specifically c onf droid performs an intra class level symbolic execution based on the insight that common configuration compatibility issues are induced by the code changes withina single class that can process xml attributes in the androidframework.
in this way we can greatly reduce the cost ofconducting path sensitive analysis while ensuring comparableaccuracy when identifying detection rules.
we implemented c onf droid based on soot and ran it on the android framework code among api levels toextract rules for detecting configuration compatibility issues.the experimental results show that c onf droid achieved .
!
!
!
!
!
!
.
!
!
!
.
!
.
!
.
.
!
!
!
!
!
!
!
!
!
!
!
24api level parse loading api level 31api level only api level onlyarrayoutofboundsexceptionusage called after fig.
.
code snippets adapted from colorstatelist in the android framework to process the attribute android color among api level and .
a precision of .
by successfully generating valid detection rules which can be reproducible when manifestingruntime inconsistencies in the android emulators.
besides c onf droid can generate validated rules that are missed by three state of the art baseline methods.
furthermore weevaluated the usefulness of c onf droid for issue detection in the real world android apps from f droid and app brain .
among valid rules that are uniquely returnedby c onf droid of them have been enabled to generate warnings that can be reproduced to manifest configurationcompatibility issues in apps.
so far warnings have beenconfirmed and warnings have been fixed by the developers.we released the empirical and experiment datasets as well asthe c onf droid artifact in our project website .
to summarize our work makes three major contributions.
an empirical research on open source apps to help un derstand the common root causes and patterns of config uration compatibility issues.
a technique named c onf droid that can generate rules to facilitate an automatic detection of configuration com patibility issues in android apps.
an empirical evaluation showing that c onf droid outperforms existing approaches on generating new de tection rules with high precision and rules extractedby c onf droid can be successfully applied for detecting previously unknown configuration compatibility issues.
ii.
b ackground m otiv a tion a. processing xml configuration files in android xml configuration files are an indispensable part of android projects.
in general there are two types of xml config uration files manifest files androidmanifest.xml that provide the essential runtime information for androidapps resource xml files located in the res folder that are commonly used to define an app s user interfaces .the android framework provides a flexible configuration 518api level api level b d a api level c fig.
.
reproduction steps for the issue as shown in figure .
environment that can accept substantially different attributes e.g.
different attributes at api level .
as the androidframework evolves compatibility issues arise from incon sistent handling of these attributes and their values amongdifferent api levels.
a popular android app typically consists of a few hundred xml configuration files.
each is processed as the followingsteps by the android framework.
parsing.
the android framework uses xmlpullparser to parse all the xml tags in configuration files and return anattributeset ortypedarray object for each xml tag.
in particular attributeset andtypedarray are two classes defined in the android framework to store each xmlattribute value as a key value pair.
the framework providesapis to trigger the parsing process and returns a newlycreated attributeset ortypedarray object such as getxml in line of figure .
loading.
attributeset andtypedarray define apis e.g.
attributeset getattributeintvalue and typedarray getboolean that take configuration at tributes as parameters and return the corresponding attributevalues in predefined formats.
we refer to these apis asconfiguration apis.
in the loading step the attribute valuesin the attributeset andtypedarray objects are loaded to some program variables using the configuration apis.
usage.
the variables are processed by the android framework to represent the app s runtime behavior.
configuration compatibility issues can occur when there are inconsistent implementations in the above steps among thedifferent android api levels.
b. motivating example it is generally difficult for developers to identify compatibility issues from many xml configuration files in their apps especially for those issues that can only be triggeredunder specific conditions.
figure 3shows a test case that can manifest the issue illustrated in figure .
to this end developers should first let the app load a website containinga time picker as figure a shows and then choose thecorresponding input field to open the problematic time pickeras listed in figure .
it took the developers one month to detect and fix the above issue.
the issue was causedby the inconsistent processing of android color in the android framework among api levels and .
thedifferent implementations of these api levels are shown infigure .
first at api levels and the configuration api attributeset getattributeintvalue in line is invoked to load android color whose value affects the array mspec in line .
however there is a defect in the android framework at api level .
it accesses an illegalindex of the array mspec in line causing the app to crash.
at api level we did not witness the crash asthe android framework has fixed the processing of android color as shown in line .
second the configura tion api attributeset getattributeintvalue fails to load the attribute values in the style format i.e.
line of figure .
as a result the style format attribute value ?android attr textcolorsecondary defined inandroid color line of figure is ignored causing the inconsistent look and feel as figures b and c show.
the above example shows how the code changes in the android framework induce configuration compatibility issues.however it is non trivial to automatically identify such codechanges.
for example at api level the statement of loadingtheandroid color attribute value line of figure i s guarded by a condition in line as shown in figure .a n accurate analysis of the loading behavior therefore requirespath sensitivity.
however since path sensitive analysis is ex pensive it cannot be scaled to the whole android frameworkthat contains a large amount of code i.e.
4m loc of apilevel with long term update history i.e.
566k commitchanges until april .
to provide insights for automat ically identifying such code changes and facilitating issuedetection we conducted an empirical study section iii o n real world issues to understand the common patterns of codechanges that can induce configuration compatibility issues.
iii.
e mpirical study to facilitate automated detection of configuration compatibility issues we conducted an empirical study on thecharacteristics and symptoms of such issues in real worldandroid apps.
the study aims at answering the following tworesearch questions rq1 issue types and root causes what are the common types and the corresponding root causes ofconfiguration compatibility issues?
rq2 issue symptoms what are the common symptoms of configuration compatibility issues?
a. dataset collection we collected bug related code revisions from wellmaintained open source android apps as the empirical dataset.to this end we searched for suitable subjects on f droid which is a famous repository containing high qualityopen source android apps.
specifically we selected subjects 519that meet the following criteria maintaining a public issue tracking system receiving more than stars ongithub popularity and pushing the latest git commitwithin the most recent three months well maintenance .
wechose these three criteria because the configuration compatibil ity issues located in these selected subjects are likely to affectmany users due to the popularity of the apps.
as a result 43apps were returned.
in order to locate the configuration compatibility issues affecting the selected apps we used the following two typesof keywords to search for related code revisions keywords related to android framework versions.
inpractice developers often indicate the specific versions ofthe android framework in which compatibility issues oc cur in the changelog.
specifically we used two keywords api api level for short and android where stands for an integer to search for android system versions in changelogs.
besides we also looked for coderevisions that contain version specific xml files whichare stored in the path that contains a version qualifierv where represents the minimum api level applicable to the files.
keywords related to xml configuration files in androidapps.
specifically we chose the following two keywords resource and androidmanifest so that they can effectively cover all types of xml configuration filessupported in the android framework.
in total unique code revisions were identified from the43 apps after removing duplicates from the searching results.
next we conducted manual analysis on the code revisions to refine configuration compatibility issues.
specifi cally we collected the code revisions in three steps.
first wescreened out the code revisions unrelated to valid configurationcompatibility issues because some irrelevant code revisions e.g.
introducing new app features can be accidentally re turned by our keyword based search.
second we collected theincompatibility inducing attributes and xml elements fromthe revision related commit logs bug reports or code diffs.
toanswer rq1 the code changes related to the incompatibility inducing attributes and xml elements should also be iden tified in the update history of the android framework toinvestigate how these changes can cause issues.
third toanswer rq2 we referred to the information of code revisionsand online discussions of similar issues for the consequenceswhen developers did not handle problematic xml elementsor attributes well.
eventually we collected configurationcompatibility issues from code revisions as the empiricaldataset.
b. rq1 issue root causes we elaborated on the six common types or causes identified from the configuration compatibility issues as shown in table i. unavailable configuration apis.
the android framework loads attribute values by calling configuration apis after pars ing the xml tags in configuration files to attributeset ortable i common root causes of configura tion compa tibility issues root causes issue type unavailable configuration apis .
type inconsistent configuration apis .
type inconsistent android internal xml configuration files19 .
type inconsistent attribute dependencies .
type inconsistent attribute usages .
type inconsistent attribute default values .
!
!
class layerdrawble added at api level fig.
.
the android framework code for loading the attribute value of android gravity in the class layerdrawable.
typedarray objects.
some statements invoking configuration apis are introduced or removed as the android framework evolves resulting in an inability to load the associated con figuration attribute values in a certain range of api levels.
inour empirical dataset we found .
issues that wereinduced by such a type of code changes.
for example theattribute value of android gravity in figure 4is loaded bylayerdrawable to adjust the gravity for layer alignment starting from api level .
a navigation app osmand filed an issue in commit 1bbf578 that the attribute value ofandroid gravity is not loaded when running at an api level below causing the incorrect display of graphic userinterfaces.
inconsistent configuration apis.
configuration apis in the android framework are designed to load attribute values inspecific data formats.
compatibility issues can happen whenthe configuration apis to load an attribute vary across apilevels.
the example in figure 1between api levels and falls into this types.
such an issue is caused by the style formatattribute value of android color not being loaded by the configuration api getattributeintvalue at api level .
the loading of android color in an unsupported format can result in app crashes at api level .
there are intotal .
issues of this type.
inconsistent android internal xml configuration files.
the android framework provides a set of internal xmlconfiguration files that can be referenced by the developersas a part of their apps.
compatibility issues can happen whenthere are changes in those internal xml configuration files asthe android framework evolves.
for example qksms commit 6b70a47 describes an issue caused by the internalxml configuration file ic menu added.xml which was introduced at api level .
there are .
issues fallinginto this issue type.
inconsistent attribute dependencies.
in the android framework there are dependencies across configuration at520 a class datepicker api level 21api level .
!
!
!
b .
!
!
!
.. .
!
!
!
fig.
.
code changes of loading android spinnersshown in the class datepicker.
tributes.
in other words the runtime behaviors of one attribute depend on the value of other attributes.
we found ninecompatibility issues that were induced by the inconsistentimplementations on attribute dependencies among api levels.for example open keychain reported an issue in commitbe06c4c.
as figure a shows developers have specified the value of android spinnersshown astrue to make the date picker widget be displayed in the spinner mode.
theattribute value cannot be loaded at api level withoutspecifying the value of android datepickermode as spinner causing the date picker to be displayed in thecalendar mode by default.
in this case the app crashedat api level due to a specific implementation of thedate picker in the calendar mode.
the code changes infigure b show that starting from api level the configuration api for android spinnersshown is guarded by the conditional statement that checks whether the value ofandroid datepickermode isspinner.
inconsistent attribute usages.
compatibility issues can happen when there are inconsistent implementations on howthe android framework uses the attribute values after beingloaded by configuration apis.
as figure 2shows there is a change in processing the value of android color in line and between api levels and .
the changeavoids the arrayindexoutofboundsexception when the android framework parses the xml element in figure at api level .
in total there are nine .
issues fallinginto this issue type.
inconsistent attribute default values.
there is one .
issue caused by inconsistent default values of the attributeandroid uselevel in the xml tag shape between api levels and as reported in the commit a221442 ofosmand .
c. rq2 issue symptoms we further analyzed the common issue symptoms as below.
specifically .
of the issues in our empirical dataset can cause the apps to crash when trigger ing incompatibility inducing xml configuration elements as shown by the motivating example in figure .
another issues .
can induce an inconsistent look and feelacross different api levels affecting the apps function alities.
for example the problem reported in the commita221442 of osmand can force the progress bar toalways show a full circle.
the remaining issues .
can cause inconsistent app behaviors beyond crashes andlook and feel.
for example the app slide specifiedandroid requestlegacyexternalstorage to make sure the app can still request for the external storage at an apilevel .
this shows that configuration compatibility issues can cause severe consequences to the app developers.
iv .
c onf droid approach in this section we illustrate c onf droid which extracts detection rules for configuration compatibility issues.
c onf droid is built based on a novel configuration constraint that models how the attribute values specified in the xmlconfiguration files can be processed by configuration apis inthe android framework.
to overcome the limitations of exist ing static based approaches see section ii b c onf droid performs symbolic execution which follows the control flowsthat can affect the invocations of configuration apis to extractconfiguration constraints more precisely.
detection rules canbe subsequently derived by comparing the differences ofextracted configuration constraints among api levels.
a. android configuration constraint model our empirical study found that the majority of issues were induced by the inconsistent handling of configuration apis type and type for a single attributeamong api levels.
the inconsistencies can lead to failures in loading attributes with specific data format under certainxml tags at some api levels.
motivated by these findings weformulate constraints that govern configuration apis calledandroid configuration constraints.
formally an androidconfiguration constraint is defined as a tuple a x f .
specifically astands for the attribute to be loaded by the configuration api xis the xml tag where the attribute ais located and fstands for the data format that can be assigned toa.
an android configuration constraint is extracted when c onf droid finds a program path in the android framework that can invoke the configuration api to load the attribute a with data format funder the xml tag x. rules for issue detection can then be identified by comparing the differencesin android configuration constraints among api levels.
a constraint a x f for a configuration api is extracted as follows.
acan be inferred from the parameter identifying the attribute to be loaded in the configuration api call x can be inferred from the return values of the configurationapi call such as xmlpullparser getname in the program path e.g.
line of figure .fcan be inferred from the configuration api used to load asince each configuration api can only load attribute values in a specificgroup of data formats.
note that one configuration api cangenerate multiple constraints if it can support loading attributevalues in different data formats.
for example as the codesnippets in figure 2show by analyzing the program paths to the configuration apis getattributeintvalue andgetcolor we can obtain the following constraints 521between api levels and .
api level android color item int api level android color item int android color item styled int as the api descriptions in android developers shows comparing to getattributeintvalue the configuration api getcolor can load integer attribute values in the style format an additional android configuration constraint forandroid color equation is extracted at api level .
b.c onf droid overview we propose c onf droid to identify android configuration constraints which can be inferred from configuration apiinvocations in the android framework to model the commonissue patterns type and type .
the identified constraintscan be further refined into a set of compatibility detectionrules based on the differences among the identified constraintsacross different api levels.
to identify android configuration constraints we prefer using static analysis to dynamic analysis.
using dynamic analysisfor the purpose is expensive due to the large search space ofpossible test inputs.
for example a dynamic approach needs togenerate an xml file as given in figure 1to reach the configuration api in line of figure .
the file generation involves searching for the tree hierarchies of xml configurationelements e.g.
item is set as a child of selector the xml elements embedding the concerned attributes e.g.
android color should only be set in item and other necessary configuration settings to avoid crash whenparsing xml files e.g.
android state activated in line .
in contrast static analysis enables us to comparethe approximated behaviors of these apis without actuallygenerating valid test inputs.
however the existing techniques analyze configuration apis by conducting path insensitive analysis which can be somewhat inaccurate and miss incompatibleconfiguration apis without considering the if conditions e.g.
line in figure .
therefore a path sensitive analysis is necessary to obtain a x f by solving path constraints triggering configuration apis with the constraint solver.
sym bolic execution is a powerful path sensitive analysis technique.yet an exhaustive symbolic execution is expensive and cannotscale to the size of the android framework.
in addition the path constraints triggering the configuration apis canbe complex as the android framework codebase is mixedwith components compiled to native code.
to tackle theabove challenges c onf droid performs backward symbolic execution from the call site of configuration apis.
this isbased on a trimmed version of an inter procedural controlflow graph which is built by pruning the statements thatare not needed to infer the android configuration constraints section iv c .
the trimmed icfgs are designed to not only address the scalability by reducing the number of programpaths and complex conditions to be analyzed but also preservereasonable accuracy while conducting path sensitive analysis.we illustrate the details of backward symbolic execution andtrimmed icfgs in the following parts.
to summarize c onf droid works as follows.
conf droid builds a trimmed version of interprocedural control flow graphs trimmed icfgs for the android framework code.
we choose to build thetrimmed icfgs for scalability section iv c .
conf droid performs backward symbolic execution on the trimmed icfgs to extract android configurationconstraints section iv d .
conf droid generates detection rules by comparing the differences of android configuration constraintsamong different api levels section iv e .
c. building trimmed icfg c onf droid performs analysis over a trimmed version of an inter procedural control flow graph which is denoted asicfg t to ensure the scalability.
our idea to build such an icfgtis inspired by the observation that the code changes triggering compatibility issues in unavailable configuration apis and inconsistent configuration apis primarily reside in the class that invokes the configuration apis to load theincompatibility inducing attributes.
therefore c onf droid builds an icfgtfor each class that invokes configuration apis by combining the call graph and each method s controlflow graph within the class.
the strategy limits the extractionof android configuration constraints to intra class analysis.however such a strategy does not pose a significant impact onthe process of configuration constraint extraction and detectionrule generation section iv f .
d. extracting android configuration constraints taking the generated trimmed icfgs icfg tas inputs conf droid extracts android configuration constraints by analyzing program paths to the target statements that contain theinvocation of configuration apis algorithm .
specifically it takes the following two steps to extract android configurationconstraints.
first starting from each target statement tgtstmt c onf droid performs backward symbolic execution from the trimmed icfg icfgtgenerated in section iv c to extract the path constraint line .
such a path constraint is a first order logic formula that records the conditionsthat should be satisfied to invoke the target statement and the configuration api invocation in the target statement line3 .
unlike forward symbolic execution backward symbolicexecution saves on testing efforts by only exploring relevantprogram statements to reach the target statements.
then thepath constraints will be further refined as a set of androidconfiguration constraints with the help of smt solver z3 line .
extracting path constraints.
for each target statement tgtstmt with configuration api invocations c onf droid computes the path constraints by performing backward symbolic execution along icfgt.
specifically the analysis will 522algorithm extracting android configuration constraints input icfgt the trimmed icfg for the android framework output acc android configuration constraints 1acc 2foreachtgtstmt icfgtdo add tgtstmt true toworklist whileworklist is not empty do remove s prime post fromworklist foreachswith an edge s s prime inicfgtdo pre pre trans s post if pre negationslash false then add s pre intoworklist foreach oftgtstmt do acc refineacc addacc toacc 13return acc maintain the symbolic states pre s and post s representing the precondition and postcondition of sinicfgt.
the symbolic states are computed iteratively along icfgtwith the symbolic state transformer trans as defined in table ii from post s to pre s .
after computing trans s post for a statement sand post the algorithm merges the result with prethat is already presented before the statement s line .
in the presence of loops we analyze them twice to ensure that the algorithm terminates and traverses the back edge ofthe loop at least once.
the path constraint is obtained from pre of the statements sthat are the entry points of icfgt.
taking the first code snippet in figure 2as an example conf droid will analyze the target statement in line and compute its path constraint along the path as follows prein line tgtstmt attrs.getattributeintvalue i color prein line tgtstmt attrs.getattributeintvalue i color i r.attr.color pre in line entry point tgtstmt getxml .getattributeintvalue i color i r.attr.color getxml .getname .equals item refining android configuration constraints.
conf droid further refines the path constraints as android configuration constraints acc with the help of smt solver z3 line .
first c onf droid checks whether the target statements are reachable by the path constraints.
to achieve this conf droid substitutes api calls in the path constraints to symbolic variables according to the return types.
c onf droid will declare any variables whose data formats are not modeledin z3 as integer variables and replace constants e.g.
null in the path constraints as integers in queries of z3.
thetarget statement is reachable if its associated path constrainttable ii specifica tion of symbolic sta te transformer trans for java sta tements .
statement trans statement tgtstmt tgtstmt x opy x yopz x api y ... y n x.y z arr x ifc branch condition c the string apis modelled by z3 e.g.
string equals a r e considered as opinstead of api.
means replacing the symbolic variable bin the symbolic state bya.
is decided to be satisfiable by z3.
conf droid then calculates aandxfrom the path constraints .ais calculated from the parameter identifying the attribute to be loaded in the api call i.e.
iin line of figure .xis calculated as the return value of the api call xmlpullparser getname .
note that xwill be assigned as the class name where locates when the concrete value of xcannot be identified because the android framework allows app developers using the class names asxml tags.
c onf droid then leverages z3 to infer all the possible values of the above symbolic variables for aand x. we set the time budget as one minute to z3 for each symbolic variable.
c onf droid discards the cases when the value of symbolic variables for aorxare undecidable or c onf droid cannot obtain all possible values of symbolic variables for aorxwithin the time budget.
such a strategy does not pose significant problems to the accuracy of androidconfiguration constraint extraction.
since those discarded casesonly account for .
when applied to api level30 section iv f .
next to infer the value of f we manually built a map between each configuration api and its supported data formatbased on its api descriptions.
c onf droid further uses the map of configuration apis with their supported data formatsto analyze ffortgtstmt .
finally c onf droid extracts android configuration constraints acc with all the possible combinations of a xandf.
e. generating detection rules detection rules are further inferred by comparing the differences in android configuration constraints between the twoadjacent api levels l 1andl2 l1 l2 as follows.
conf droid reports a rule of attribute loading change if an attribute aof the xml tag xcan be loaded at the api level l1only but not l2 or atl2only but not l1 .
the rules falling into this type are induced by unavailableconfiguration apis type in section iii b .
conf droid reports a rule of data format change if there are inconsistencies in the supported data formats ffor an attribute aof the xml tag xbetweenl1andl2.
the 523rules falling into this type are induced by inconsistent configuration apis type in section iii b .
for example by comparing the differences of android configuration constraints as shown in section iv a c onf droid generates a rule of data format change as follows.
braceleftbigg attribute android color xml tag item data format styled int api level bracerightbigg .
the above rule indicates that assigning the attribute value in the styled integer format to android color under the xml tag item can trigger compatibility issues between api levels and .
f .
discussion the accuracy of detection rules extracted by c onf droid can be affected by the limitations of conducting backward symbolic execution to infer android configuration constraints.first c onf droid performs an intra class level backward symbolic execution which can cause aandxin android configuration constraints identified inaccurately.
second c onf droid discards cases where values of aandxcannot be inferred due to the inabilities of z3.
therefore false positiverules occur when an android configuration constraint cannotfind the equivalent one at other api levels due to the limita tions of our analysis.
plus false negative rules are incurredwhen c onf droid fails to generate android configuration constraints for the evolved attributes.
however c onf droid only discards .
of the configuration api callsites at api level indicating the insignificant impact onthe inference of android configuration constraints due to theintra class level symbolic execution and the inabilities of z3.although we cannot draw a whole picture of all the cases ofandroid configuration evolutions we find that c onf droid is only unable to generate android configuration constraints for21.
attributes at api level .
these constraintsare accountable for the false negatives in the warnings reportedby c onf droid section v a .
v. e v alua tion we implemented c onf droid based on soot .
in our evaluation we answer the following research questions rq3 effectiveness of detection rule extraction what is the effectiveness of c onf droid on extracting detection rules compared with baseline methods?
rq4 usefulness can rules that are uniquely extracted by c onf droid be useful for detecting issues in realworld android apps?
a. rq3 effectiveness of detection rule extraction to answer rq3 we ran c onf droid on the android framework code among api levels between and inclusive .we evaluated its accuracy in extracting the detection rules ofconfiguration compatibility issues.
we compared the resultswith the following baseline methods.
baseline i lint the popular static analyzer officially released by google.
by modeling the api levelstable iii execution time for rule extraction and valida tion rat e o f extracted rules .rules in lint are hardcoded .
method conf droid lint orpl oca tor c dep time 2h58m36s 2m26s 3m25s validation rate91.
.
.
.
when attributes were introduced l int can detect configuration compatibility issues caused by an unavailable attributeaat api level l. baseline ii orpl oca tor the state of the art technique for extracting attributes in a software system byconducting path insensitive analysis on its configurationapis.
we ran orpl oca tor at different api levels to extract detection rules for unavailable attribute aat api levell.
baseline iii cdep the state of the art software misconfiguration tool which focuses on analyzing at tribute dependencies in the software system.
we ran cdepamong api levels to generate detection rules for the unavailable dependencies between two attributes a1 anda2at api level l. note that we did not choose scic the state of the art tool for detecting misconfigurations caused by software evolu tion as the baseline since its artifact is not available.
besides orpl oca tor baseline ii and cdep baseline iii are more recently published techniques.
the original algorithmsof orpl oca tor and cdepcomprise inter class analyses.
however they cannot scale up to the android frameworkand fail to extract any rules.
as such we slightly adapted orpl oca tor and cdepto performing intra class analyses in the construction of the two baselines.
validating detection rules.
we considered an issuedetection rule ras valid if the xml configuration files that satisfy the triggering conditions specified by rcan induce configuration compatibility issues between two api levels.specifically for each issue detection rule rextracted by c onf droid and other baselines we used the attribute name the xml tag and the incompatibility inducing api levelsspecified in ras keywords to search for relevant discussions in stack overflow and github .
for those rules rwith no relevant discussions found we manually crafted an androidapp that includes xml configuration files satisfying the issue triggering condition in rto manifest inconsistent behaviors across api levels.
furthermore the manifested inconsistentbehaviors should disappear after removing the incompatibility inducing attribute from the concerned xml configurationfile.
a rule ris considered valid if we can find a relevant online discussion or successfully craft an app confirming theexistence of configuration compatibility issues.
table iiishows the execution time as well as the number of rules extracted by c onf droid and baseline methods.
the 524execution time of l int is inapplicable as the detection rule is hardcoded.
although the execution time of c onf droid is larger than path insensitive approaches orpl oca tor and cdep c onf droid can extract more valid detection rules and complete analyzing the android frameworks within three hours.
in total c onf droid successfully extracts valid detection rules achieving a precision of .
.
by performingbackward symbolic execution on the configuration apis in theandroid framework the unique valid detection rules 47unavailable configuration apis and inconsistent configura tion apis extracted by c onf droid are not found in any of the three baselines.
on the other hand the detection rules extracted by conf droid cannot be validated due to the following two reasons.
first the intra class level symbolic execution andthe inabilities of using z3 to process configuration apis cancause incomplete configuration constraint extraction.
second the android framework has proposed an internal workaroundat the stage of the android app compilations which is notanalyzed by c onf droid .
besides .
of the rules extracted by orpl oca tor are invalid due to the adaptation of intra class level analysis to ensure scalability and theinaccuracy of its path insensitive analysis on the androidframework.
while we have resolved the scalability issuesof the original version of cdep it achieves the lowest rule validation rate because of extracting incomplete attributedependencies by only performing intra class level data flowanalysis and identifying minor code changes that will notinduce compatibility issues.
still we found rules .
that are uniquely included in l int but not c onf droid .
the false negative rules of c onf droid concern the theme attributes e.g.
android attr textcolorsecondary in figure whose value can only be referenced by another attributes in xml.such theme attributes are not loaded using the android con figuration apis and hence are missed by c onf droid .w e have not witnessed any false negative rules in c onf droid that were extracted by orpl oca tor because the valid rules of c onf droid and orpl oca tor fall into the pattern of unavailable configuration apis.
we also did not witnessedany false negative rules that are extracted by cdep.
the cdeptool is designed based on the change pattern in attribute dependencies type in section iii b .
such a pattern is not modelled by c onf droid since it only accounts for .
of the issues in the empirical study dataset.
in fact the validationrules generated by cdepare all caused by the introduction and removal of attributes which are also dependent on otherattributes in the android framework.
moreover false negativescan also be induced by the inabilities of z3 in processingconfiguration apis.
although it is challenging to measurefalse negatives as we lack an authoritative ground truth weargue that the number of false negatives can be small since c onf droid can successfully process .
of configuration apis which cover .
of publicattributes at the api level .table iv number of w arnings detected using the rules extracted by conf droid and baselines conf droid lint orpl oca tor c dep d fv flib d fv flib d warnings generated by rules only.
fv false warnings identified by api level filter.
flib false warnings identified by support library filter.
d fv flib the final output after filtering false warnings by fvandflib b. rq4 usefulness to answer rq4 we checked whether the rules of c onf droid could be applied to detect real issues with the comparison of three baselines.
note that android has introducedvarious protection mechanisms documented in android de velopers to prevent configuration compatibility issues.
theprotection mechanisms include checking the api levelranges in which the xml configuration file can be used and using the android support library androidx to parsexml configuration files.
leveraging detection rules alonewithout considering any protection mechanisms can inducea large number of false warnings.
therefore we built twofalse warning filters f vandflibto investigate the impact of protection mechanisms on issue detection.
specifically fv checks whether the xml configuration file can be appliedto incompatibility inducing api levels.
app developers canprovide different copies of the xml configuration files fordifferent api levels with the identifier v e.g.
v24 in layout v24 a.xml .
for an issue reported by a rule r with problematic api levels l l2 fvconsiders the api level identifier with the parameter value of minsdkversion to check whether the xml file can be used at l1.fvalso checks whether there is another copy of the file for api level l2.
the reported issue is considered as invalid if the xml filecannot be used in both l 1andl2.flibchecks whether an xml configuration file can be parsed by the android support library androidx instead.
here we consider an xml configurationfile to be free of compatibility issues if it is only referencedby the apis or attributes defined in the library.
we then builtfour different variants of issue detectors with two filters f v andflibas table ivshows.
we applied the above variants to detect issues in real world android apps.
we crawled open source android apps inf droid with at least stars in github and thelast git commit made within the past six months.
we furthercollected closed source apps marked as top ranked inappbrain .
none of these apps overlaps with thoseused in our empirical study section iii to avoid the risk of overfitting.
table iv shows the number of warnings produced by each variant of issue detectors.
we can see that the numberof false warnings is significantly less when combining two 525false warning filters fvandflib showing that the above two mechanisms are often adopted to handle compatibility issues.
several frequently used attributes contribute to thenumber of warnings reported in table iv.
for example developers intensively use an incompatibility inducing attributeandroid strokecolor in their apps.
f vhelps reduce false warnings that developers have properly used suchan attribute with api level identifiers.
considering the output of d f v flib the rules of c onf droid generated issue warnings outperforming the other baseline methods.
note that the number of warnings can bevaried depending on the frequency of which incompatibility inducing attributes are used in apps.
as for the rulesthat were uniquely identified by c onf droid of them were activated to output warnings from apps amongwhich warnings were from open source apps while theremaining warnings were from closed source apps.the above results show that the rules uniquely generated by c onf droid can be leveraged to generate issue reports that are unknown to other baselines.
we then conducted manual reproduction trying to manifest inconsistent runtime behaviors on the warnings that areuniquely reported by rules in c onf droid .
specifically we first tried to build test cases to reach the activity using the xml element in the issue reports.
then we tried to man ifest the runtime behavior controlled by the incompatibility inducing attributes in the xml element by reading the codelogic of the activity.
since we have no access to the source code of the closed source apps we analyzed the apps code logic by reading the smali code decompressed fromtheir apk files.
an issue is considered reproducible if we canobserve inconsistent runtime behavior by building a test casebased on the above two steps.
we successfully reproduced107 warnings in apps warnings in open sourceapps and warnings in closed source apps .
we failedto reproduce the remaining warnings for the following threereasons.
first the xml elements where the incompatibility inducing attributes are located were not reachable becauseof special triggering conditions e.g.
paying for unlockinghidden functionalities .
second false warnings were generatedbecause it cannot recover the workaround of configurationcompatibility issues made by app developers.
third the appwas obfuscated so that it is difficult for us to understand theapp s runtime behavior through analyzing the smali code.
we further reported the reproducible warnings concerning open source apps to the original app developers.for each app we only sent one issue report containing allwarnings found in it.
table vshows the issue reports that have been sent to the developers.
the distribution of reportedissue warnings depends on the attribute usages in differentapps.
for example our issue detector reports warnings inthe evaluation subject andotp since it frequently uses theattribute android fillcolor to define the colors in the app icons.
the processing of android fillcolor in the android framework has been changed between api levels 23and causing an inconsistent look and feel on the app stable v issue reports app id warnings confirmed fixed andotp aria2app dash wallet document viewer fastscroll goodtime metro kontalk openworkout persiancalendar twire unipatcher total 1issues that have received replies from app developers.
icons.
so far warnings concerning five apps have beenconfirmed and warnings in four apps have been fixed bydevelopers.
we did not report issues for closed source apps asthey do not have a public issue tracker.
instead we releasedthe reproduction results of both open source and closed sourceapps on our project website .
the above confirmed orfixed warnings demonstrate the usefulness of rules extractedby c onf droid to facilitate configuration compatibility issue detection.
vi.
t hrea ts to validity keywords for dataset collection.
when collecting configuration compatibility issues we used two sets of keywordsrelated to api levels and xml files.
although differentapps may use different app specific terms to refer to thesame concepts such app specific terms are hard to collect.besides using app specific terms as keywords can returnmany irrelevant results.
therefore our dataset was collectedprimarily using the above two groups of general keywords which retrieves configuration compatibility issues.
generality of our empirical findings.
in this paper we studied the configuration compatibility issues in the androidapps and further proposed c onf droid to facilitate automatic issue detection.
our empirical findings may not be generalizedto other types of software systems.
we chose android as ourstudy platform because it is representative of a popular systemsupporting a high degree of configurability in thousands of at tributes.
the open source android framework code provides anice foundation for us to study the root causes of configurationcompatibility issues.
empirical subject selection.
the findings from the issues in the open source android app can be biased to the subjectsselected in our empirical study.
we mitigated the threat byselecting a significant number of issues and apps.
as a result the study was based on issues from open source appsthat are popular and well maintained.
evolving android framework versions.
the android api levels that we studied may become obsolete over time.
it is a 526threat common to most studies based on android.
to mitigate the threat we base our study on the latest api levels.
manual inspections and developers feedbacks.
we manually inspected our evaluation to validate issues detected by conf droid .
the manual process can be subject to errors.
we also submitted the validated ones to the original app developersfor their feedback.
however several issue reports are stillpending.
this is most likely because some developers tendto be less responsive to the issue reports in the issue tracker.to address the threat that our reported issues may not be realones our manual process involves validating detection rulesand issuing warnings through actual executions.
we also makeour validation steps and artifacts publicly available .
vii.
r ela ted work a. software misconfigurations there are plenty of works on detecting software misconfigurations.
for example behrang et al.
proposed scic to study the attributes that cannot take effects because of software evolution.
dong et al.
proposed orpl oca tor to detect inconsistencies between documentations and configuration attributes in system code.
recently chen etal.
proposed cdepto extract attribute dependencies from source code.
although these approaches can be adapted todetect compatibility issues across multiple system versions the proposed path insensitive analyses are ineffective for theandroid framework.
it is because the loading of configurationattributes in the android framework is commonly guarded byvariables defined in the same configuration class.
in contrast c onf droid conducts intra class level path sensitive analysis for more precise detection of compatibility issues.
there are works studying misconfigurations caused by system evolution .
for example zhang et al.
pro posed a technique for debugging software misconfigurationsinduced by software evolution.
however the technique re quires developers to provide test cases to manifest such issues limiting its applicability.
recently zhang et al.
conductedan empirical study to understand how the configuration designand implementation evolve in cloud systems.
the study doesnot provide a technique for issue detection.
c onf droid fills the gap by incorporating automated techniques to extract issue detection rules which can be readily deployed at l int for issue detection.
there are also a few related works on automated software misconfiguration diagnosis.
however their researchgoal is to help understand the root causes of known softwaremisconfigurations.
their application scenario differs from thatof c onf droid where the misconfigurations are unknown.
b. android compatibility issues a few studies have been conducted on android compatibility issues.
for example wei et al.
studiedthe root causes symptoms and fixing practices of androidcompatibility issues.
huang et al.
studied compatibilityissues in android callback apis.
hu et al.
found androidcompatibility issues in the webview component.
cai et al.
studied the compatibility issues occurring at installation timeand runtime.
xia et al.
studied the practice of app devel opers to handle android compatibility issues.
these studiesdo not cover the common root causes and patterns of androidconfiguration compatibility issues which are prevalent and cancause severe consequences in android apps.
researchers have proposed a set of tools to detect android compatibility issues.
first dynamic based approaches can generate tests to identify app gui inconsistenciesacross android devices.
these approaches adopt a randomtest generation strategy which is ineffective in triggeringthe inconsistencies within the huge search space of anapp s configuration attributes.
second existing static basedapproaches take a set of predefined patterns tofacilitate compatibility issue detection in android apps.
how ever their approaches can only be leveraged to detect issuescaused by problematic api invocations.
these approaches areinapplicable for the detection of configuration compatibilityissues in android apps.
besides l int a popuplar staticbased bug detection tool in the industry can only detectconfiguration compatibility issues due to the introduction ofnew attributes.
in comparison c onf droid encodes common issue patterns to extract detection rules from the androidframework.
the evaluation results show that such rules candetect issues that were previously unknown to app developers.
viii.
c onclusion f uture work to help app developers tackle configuration compatibility issues in this study we first collected configurationcompatibility issues to empirically understand the commonroot causes and patterns of such issues.
based on the findings we further proposed c onf droid which encodes common issue patterns to automatically extract detection rules forconfiguration compatibility issues.
the results show that therules extracted by c onf droid can facilitate detecting issues that were previously unknown to app developers.
in the future we plan to investigate automated repair techniques for config uration compatibility issues in android apps.
we also plan todesign a technique that can facilitate automated validation ofconfiguration compatibility issue to minimise manual efforts.
a cknowledgment we sincerely thank anonymous reviewers for their valuable comments.
this work was supported by the national natu ral science foundation of china grant no.
no.
and no.
hong kong rgc grf grantno.
hong kong rgc rif grant no.
r5034 and guangdong basic and applied basic research foundation grant no.
2021a1515011562 .
huaxun huang was supportedby the hong kong phd fellowship scheme.
lili wei wassupported by the hong kong rgc postdoctoral fellowshipscheme.
r eferences android developers .
bug crash in java.lang.nullpointerexception http s bugzilla.mozilla.org show bug.cgi?id .
gecko dev .
github .
difference reports between api and r.android.com guide topics manifest uses sdk element .
a. rabkin and r. katz static extraction of program configuration options in proceedings of the 33rd international conference on software engineering icse pp.
.
t. xu j. zhang p .
huang j. zheng t. sheng d. y uan y .
zhou and s. pasupathy do not blame users for misconfigurations in proceedings of the acm sigops 24th symposium on operating systemsprinciples sosp pp.
.
f. behrang m. b. cohen and a. orso users beware preference inconsistencies ahead in proceedings of the 10th joint meeting on f oundations of software engineering esec fse pp.
.
t. xu x. jin p .
huang y .
zhou s. lu l. jin and s. pasupathy early detection of configuration errors to reduce failure damage inproceedings of the 12th usenix symposium on operating systemsdesign and implementation osdi pp.
.
z. dong a. andrzejak d. lo and d. costa orplocator identifying read points of configuration options via static analysis in proceedings of the 27th international symposium on software reliability engineering issre pp.
.
q. chen t. wang o. legunsen s. li and t. xu understanding and discovering software configuration dependencies in cloud and datacentersystems in proceedings of the 28th acm joint meeting on european software engineering conference and symposium on the f oundationsof software engineering esec fse pp.
.
j. toman and d. grossman staccato a bug finder for dynamic configuration updates in proceedings of the 30th european conference on object oriented programming ecoop pp.
.
e. reisner c. song k. k. ma j. s. foster and a. porter using symbolic evaluation to understand behavior in configurable softwaresystems in proceedings of the 32nd international conference on software engineering icse pp.
.
m. fazzini and a. orso automated cross platform inconsistency detection for mobile apps in proceedings of the 32nd ieee acm international conference on automated software engineering ase pp.
.
t. ki c. m. park k. dantu s. y .
ko and l. ziarek mimic ui compatibility testing system for android apps in proceedings of the 41st international conference on software engineering icse pp.
.
l. wei y .
liu and s. c. cheung taming android fragmentation characterizing and detecting compatibility issues for android apps inproceedings of the 31st ieee acm international conference on automated software engineering ase pp.
.
l. wei y .
liu s. c. cheung h. huang x. lu and x. liu understanding and detecting fragmentation induced compatibility issuesfor android apps ieee transactions on software engineering tse vol.
no.
pp.
.
l. wei y .
liu and s. c. cheung pivot learning api device correlations to facilitate android compatibility issue detection in ieee acm 41st international conference on software engineering icse pp.
.
h. huang l. wei y .
liu and s. c. cheung understanding and detecting callback compatibility issues for android applications in proceedings of the 33rd acm ieee international conference on automatedsoftware engineering ase pp.
.
l. li t. f. bissyand e h. wang and j. klein cid automating the detection of api related compatibility issues in android apps inproceedings of the 27th acm sigsoft international symposium onsoftware testing and analysis issta pp.
.
d. he l. li l. wang h. zheng g. li and j. xue understanding and detecting evolution induced compatibility issues in android apps inproceedings of the 33rd acm ieee international conference on automated software engineering ase pp.
.
c. li c. xu l. wei j. wang j. ma and j. lu elegant towards effective location of fragmentation induced compatibility issues for android apps in proceedings of the 25th asia pacific software engineering conference apsec pp.
.
p .
lam e. bodden o. lhot ak and l. hendren the soot framework for java program analysis a retrospective in cetus users and compiler infastructure workshop cetus vol.
no.
.
f droid .
appbrain .
confdroid webpage d .
k. xu y .
li r. h. deng and k. chen deeprefiner multi layer android malware detection system applying deep neural networks inproceedings of ieee european symposium on security and privacy euros p pp.
.
osmand .
qksms .
open keychain chain .
slide .
z3 an efficient theorem prover api html .
improve your code with lint checks oid.com studio write lint .
stack overflow .
andotp .
aria2app .
dash wallet .
document viewer ument viewer .
unipatcher .
goodtime .
metro .
kontalk .
openworkout .
droidpersiancalendar droidpersiancalendar .
twire .
unipatcher .
s. zhang and m. d. ernst which configuration option should i change?
in proceedings of the 36th international conference on software engineering icse pp.
.
y .
zhang h. he o. legunsen s. li w. dong and t. xu an evolutionary study of configuration design and implementation in cloudsystems in proceedings of the 43rd international conference on software engineering icse pp.
.
m. attariyan m. chow and j. flinn x ray automating root cause diagnosis of performance anomalies in production software in proceedings of the 10th usenix conference on operating systems designand implementation osdi pp.
.
a. rabkin and r. katz precomputing possible configuration error diagnoses in proceedings of the 26th ieee acm international conference on automated software engineering ase pp.
.
s. zhang and m. d. ernst automated diagnosis of software configuration errors in proceedings of the 35th international conference on software engineering icse pp.
.
s. zhang and m. ernst proactive detection of inadequate diagnostic messages for software configuration errors in proceedings of the international symposium on software testing and analysis issta pp.
.
j. hu l. wei y .
liu s. c. cheung and h. huang a tale of two cities how webview induces bugs to android applications in proceedings of the 33rd acm ieee international conference on automated softwareengineering ase pp.
.
h. cai z. zhang l. li and x. fu a large scale study of application incompatibilities in android in proceedings of the 28th acm sigsoft international symposium on software testing and analysis issta pp.
.
h. xia y .
zhang y .
zhou x. chen y .
wang x. zhang s. cui g. hong x. zhang m. yang and z. yang how android developershandle evolution induced api compatibility issues a large scale study inproceedings of the 42nd international conference on software engineering icse pp.
.
l. wei y .
liu and s. c. cheung oasis prioritizing static analysis warnings for android apps based on app user reviews in proceedings of the 11th joint meeting on f oundations of software engineering fse pp.
.