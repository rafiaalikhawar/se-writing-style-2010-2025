demystifying the vulnerability propagation and its evolutionvia dependency trees in the npm ecosystemchengwei liu college of intelligence andcomputing tianjin universitytianjin chinachengwei001 e.ntu.edu.sgsen chen college of intelligence andcomputing tianjin universitytianjin chinasenchen tju.edu.cnlingling fancollege of cyber science nankaiuniversitytianjin chinalinglingfan nankai.edu.cnbihuan chenschool of computer science andshanghai key laboratory of datascience fudan universityshanghai chinayang liuschool of computer science andengineering nanyang technologicaluniversitysingapore singaporexin pengschool of computer science andshanghai key laboratory of datascience fudan universityshanghai chinaabstractthird party libraries with rich functionalities facilitate the fast de velopment of javascript software leading to the explosive growthof the npm ecosystem.
however it also brings new security threatsthat vulnerabilities could be introduced through dependencies fromthird party libraries.
in particular the threats could be excessivelyamplified by transitive dependencies.
existing research only con siders direct dependencies or reasoning transitive dependenciesbased on reachability analysis which neglects the npm specificdependency resolution rules as adapted during real installation resulting in wrongly resolved dependencies.
consequently furtherfine grained analysis such as precise vulnerability propagationand their evolution over time in dependencies cannot be carriedout precisely at a large scale as well as deriving ecosystem widesolutions for vulnerabilities in dependencies.tofill this gap we propose a knowledge graph based depen dency resolution which resolves the inner dependency relationsof dependencies as trees i.e.
dependency trees and investigatesthe security threats from vulnerabilities in dependency trees at alarge scale.
specifically wefirst construct a complete dependency vulnerability knowledge graph dvgraph that captures the wholenpm ecosystem over million library versions and millionwell resolved dependency relations .
based on it we propose anovel algorithm dtresolver to statically and precisely resolvedependency trees as well as transitive vulnerability propagationpaths for each package by taking the official dependency resolutionrules into account.
based on that we carry out an ecosystem wideempirical study on vulnerability propagation and its evolution in also with nanyang technological university.
sen chen is the corresponding author.permission to make digital or hard copies of all or part of this work for personal orclassroom use is granted without fee provided that copies are not made or distributedfor profit or commercial advantage and that copies bear this notice and the full citationon thefirst page.
copyrights for components of this work owned by others than acmmust be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or afee.
request permissions from permissions acm.org.icse may pittsburgh pa usa association for computing machinery.acm isbn .
.
.
.
trees.
our study unveils lots of usefulfindings andwe further discuss the lessons learned and solutions for differentstakeholders to mitigate the vulnerability impact in npm based onourfindings.
for example we implement a dependency tree basedvulnerability remediation method dtreme for npm packages and receive much better performance than the official tool npmaudit fix .acm reference format chengwei liu sen chen lingling fan bihuan chen yang liu and xin peng.
.
demystifying the vulnerability propagation and its evolution via de pendency trees in the npm ecosystem.
in44th international conference onsoftware engineering icse may pittsburgh pa usa.acm new york ny usa pages.
introductiondue to the rapid growth of functionality complexity in softwareapplications software componentization has become an irresistibletrend in software development leading to the boosting of third party libraries.
as investigated over .
million node.js librarieshave been published on npm a node package manager to facilitate software development.
as contrast security re vealed third party libraries appear in a majority of today ssoftware .
however every coin has two sides.
although usinglibraries reduces development cost and time these integrated li braries pose a new security threat to the software ecosystem inpractice that vulnerabilities in these libraries may expose softwarethat depend on them under security risks constantly .for example lodash a widely used javascript utility librarywith over million downloads as dependencies per month isidentified to have severe vulnerability of prototype pollution andexposes .
million projects on github to the potential risk ofbeing attacked .previous works have investigated vulnerability impact across thenpm ecosystem while their approaches either only statically con sider direct dependencies or excessively analyze dependenciesbased on static reachability reasoning which may introduceinaccurate transitive dependencies illustrated by the motivatingexample of figure b in section .
resulting in false positivevulnerability warnings.
none of the existing approaches provideprecise dependencies especially the inner complex relations among6722022 ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa chengwei liu sen chen lingling fan bihuan chen yang liu and xin pengdependencies of software at a large scale which makes the impactof their analysis weakened and limits further solutions i.e.
preciseremediation to be proposed.
although some existing sca tools e.g.
snyk and blackduck support npm dependency analysisfor user projects most of them retrieve dependency trees from realinstallation rather than static reasoning.
besides dependencies aswell as vulnerabilities in dependencies are actually under dynamicchange over time due to theflexibility of semantic versioning .therefore although existing work has also investigated the impactof vulnerabilities it is still challenging to analyze the evo lution of vulnerability propagation existing in dependencies at alarge scale without static and precise dependency resolution not tomention to derive practical solutions on preventing vulnerabilitiesfrom dynamically being introduced into dependencies.tofill these gaps we face the following challenges.
com pleteness.
npm ecosystem is the largest platform with over 1million published packages which are hard to be fully analyzed.some existing work only either analyzed with a limited numberof libraries or studied vulnerabilities in dependencytrees of limited projects .
besides npm allows variousways to reuse third party libraries as dependency constraints which are also hard to fully capture and resolve.
accuracy.
exist ing work only conduct dependency based analysisby identifying transitive dependencies via reachability reasoningwhile neglecting the npm specific dependency resolution rules which would lead to inaccurate results.
efficiency.
even thoughreal installation can precisely retrieve dependency trees installingnpm packages i.e.
npm install is known to always take min utes per run which is obviously not efficient enough to sup port large scale studies.
dynamic updates.
npm packages areknown to have the most dependencies.
any new release of librariesin dependency trees could lead to changes in installed dependen cies for installation afterwards as the example in figure whicheven complicates the management of dependencies as well as thevulnerability propagation in dependencies.
thus it is challengingto explore the vulnerability propagation evolution over time.in this paper to overcome these challenges we implementarobust dependency constraint parserto tackle the diversity of npmdependency constraints and based on it we construct a completedependency vulnerability knowledge graph dvgraph to capturethe dependency relations among all npm packages over .
mil lion libraries and .
million versions as well as over knowncves common vulnerabilities and exposures from nvd which further supports the thorough analysis of vulnerability prop agation.
we propose an accurate dvgraph based dependencyresolution algorithm dtresolver to calculate dependency trees1at any installation time.
it integrates the official dependency reso lution rules and dvgraph based reasoning to simulate the processof installation illustrated by the motivating example of figure c in section .
.
ourdtresolveris validated to have an accuracyof over of resolved dependency trees being exactly the samecomparing to real installation.
we further conduct an empiricalstudy on vulnerability propagation in dependency trees.
first weinvestigate the characteristics of dependency trees brought by npmdependency resolution details are available at our supplementary1the resolved dependency graph when a given root package is installed.material based on which we analyze the impact and features ofvulnerability propagation in dependency trees particularly the vul nerabilities from transitive dependencies.
besides we also extendour study to time dimension to investigate the evolution of vul nerability propagation in dependency trees over time to unveil thereasons of vulnerabilities being introduced in dependency trees aswell as possible solutions.through our empirical study we conclude somefindings asfollows.
for example we statistically prove that vulnerabilitieswidely exist in the dependencies of npm packages over one quarterof library versions from of libraries even in the latest versions of libraries .
besides vulnerabilities from direct dependenciesare widely neglected over affected library versions .
knownvulnerabilities are causing a larger impact over time with moreaffected packages and more vulnerabilities in dependency trees.most vulnerabilities are introduced into dependency treesbefore they are discovered and mostfixing versions of themare released before they get published.
based on these timely re leases most of the vulnerable dependencies can be removed along with time in average it takes a year but there are still of vulnerabilities unable to get thoroughly excluded.
consider able user projects contain unavoidable vulnerabilities even thoughwe have exhausted all possible dependency trees.
morefindingscan be found in section .
additionally since the severe situationof vulnerability propagation is complicated and requires effortsfrom different roles to mitigate we also conclude actionable solu tions from different stakeholders in the supply chain of third partylibraries based on ourfindings in section .in summary we make the main contributions as follows.
we design and construct a complete and precisedvgraphforthe whole npm ecosystem by leveraging a robust dependencyconstraint parser.
the construction and maintenance pipelinestake person months.
we propose a novel algorithm dtresolver based on dvgraphto statically and precisely resolve the dependency trees for anyinstallation time with high accuracy over which is validatedby around 100k representative packages.
we conduct thefirst large scale empirical study based on over50 million resolved dependency trees calculated on an coremachine for one month to peek into the vulnerability propaga tion and the evolution of vulnerability propagation over time andprovide usefulfindings.
we provide an in depth discussion including lessons learned andactionable solutions which provide useful insights to improve thesecurity of the whole npm ecosystem for different stakeholders such as the proposed remediation dtreme that excludes morevulnerabilities than the official toolnpm audit fix.
we have made the relevant analytic data publicly available2tofacilitate the relevant research on the npm ecosystem.figure demonstrates the overview of our work includingthe dependency vulnerability knowledge graph construction sec tion dependency tree resolution vulnerable path identification and their validations section a large scale empirical study sec tion and discussion on lessons learned and solutions as well aspossible research directions section .
licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
demystifying the vulnerability propagation and its evolution via dependency trees in the npm ecosystem icse may pittsburgh pa usa figure overview of our work acbddb .
.0d .
.0d .
.0c .
.
.
.
d .
.0ee .
.
.
.0d1.
.
acbddb .
.0d .
.0d .
.0c .
.
.
.
.
.
d has four versions .
.
.
.
.
.
.
.
according tonode semver .
.0represents .
.
and .
.
1.
.0represents .
.
and .
.
represents any version.figure an example of npm dependency resolution2 motivating example andbackground2.
motivating examplehere we present an example to illustrate why it is unreliable toconduct vulnerability propagation analysis via existing reachabil ity analysis.
figure presents an example where each package isrepresented in the format oflibrary version.
figure a presentsthe original dependency relations of packages in the format ofli brary constraint.
figure b and figure c present the resolveddependency of a .
.
via reachability reasoning i.e.
dependencyreach in and npm official rules respectively.
specifically whenresolving the dependency of c .
.
reachability analysis selectsd .
.
because .
.
is the highest satisfying version of depen dency constraint 1. .
from c .
.
to d and package e .
.
isalso selected.
however this may lead to inaccurate results.
npmfollows its own principle to resolve dependencies during installa tion .
for example npm takesreal installation contextintoaccount when resolvingdependency trees e.g.
allowing existingversions to be reused while resolving transitive dependency viareachability fails to involve such rules.
as presented in figure c since existing d .
.
satisfies 1. .
it will directly reuse d .
.0instead of resolving a new one.
thus d .
.
and e .
.
arewrongly resolved by reachability analysis in figure b .
.
backgroundwe briefly introduce several concepts related to dependency man agement and vulnerabilities in the npm ecosystem.npm package metadata.npm is the official package man ager for node.js and provides a public npm registry to maintain figure schema of npm dependency vulnerability graphinformation of all published libraries i.e.
npm package meta data .
such metadata describes all information of a given li brary and its released versions and the dependency relation ofeach version which is useful for indexing libraries and resolvingdependencies when installing a library.dependency constraints.dependencies of packagepare speci fied as a list of key value pairs in metadata wherekeyrepresents alibrarylibaandvaluerepresents the allowed version range i.e.
con straint thatpshould follow when selecting the version of librarylibaduring installation.
there are different types of constraints innpm such asversionandrange tag urls i.e.
git urls andremote links and local paths directory and file .semantic versioning.it has been proposed as a solution of ver sion control when maintaining package dependencies.
it definesversion numbers presented in the format ofmajor.minor.patch.when a new version is released majorincreases when incompati ble api changes have been taken out minorraises when function ality changes are still backward compatible andpatchgrows whenbackward compatible bugfixes have been made.vulnerabilities in npm packages.vulnerabilities in npm pack ages are included in the cve reports.
each cve is published with de tailed information about vulnerabilities and their