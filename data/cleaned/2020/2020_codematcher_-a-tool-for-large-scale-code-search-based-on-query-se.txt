singapor e management univ ersity singapor e management univ ersity institutional k nowledge at singapor e management univ ersity institutional k nowledge at singapor e management univ ersity resear ch collection school of computing and information systems school of computing and information systems codematcher a t ool for lar ge scale code sear ch based on quer y codematcher a t ool for lar ge scale code sear ch based on quer y semantics matching semantics matching chao liu chongqing univ ersity xuanlin ba o chongqing univ ersity xin xi a huawei meng y an chongqing univ ersity david l o singapor e management univ ersity davidlo smu.edu.sg see next page for additional authors follow this and additional works at https ink.libr ary.smu.edu.sg sis r esear ch part of the databases and information systems commons programming languages and compilers commons and the softwar e engineering commons citation citation liu chao ba o xuanlin xi a xin y an meng l o david and zh ang ting.
codematcher a t ool for lar gescale code sear ch based on quer y semantics matching.
.
esec fse pr oceedings of the 30th acm joint e uropean softwar e engineering conf erence and symposium on the f oundations of softwar e engineering singapor e singapor e no vember .
.
available at available at https ink.libr ary.smu.edu.sg sis r esear ch this conf erence pr oceeding ar ticle is br ought t o you for fr ee and open access b y the school of computing and information systems at institutional k nowledge at singapor e management univ ersity .
it has been accepted for inclusion in resear ch collection school of computing and information systems b y an authoriz ed administr ator of institutional k nowledge at singapor e management univ ersity .
for mor e information please email cher ylds smu.edu.sg .
author author chao liu x uanlin ba o xin xi a meng y an da vid l o and ting zh ang this conf erence pr oceeding ar ticle is a vailable at institutional k nowledge at singapor e management univ ersity https ink.libr ary.smu.edu.sg sis r esear ch codematcher a tool for large scale code search based on query semantics matching chao liu school of big data software engineering chongqing university chongqing china liu.chao cqu.edu.cnxuanlin bao school of big data software engineering chongqing university chongqing china baoxuanlin cqu.edu.cnxin xia software engineering application technology lab huawei hangzhou china xin.xia acm.org meng yan school of big data software engineering chongqing university chongqing china mengy cqu.edu.cndavid lo school of information systems singapore management university singapore davidlo smu.edu.sgting zhang school of information systems singapore management university singapore tingzhang.
phdcs.smu.edu.sg abstract due to the emergence of large scale codebases such as github and gitee searching and reusing existing code can help developers substantially improve software development productivity.
over the years many code search tools have been developed.
early tools leveraged the information retrieval ir technique to perform an efficient code search for a frequently changed large scale codebase.
however the search accuracy was low due to the semantic mismatch between query and code.
in the recent years many tools leveraged deep learning dl technique to address this issue.
but the dl based tools are slow and the search accuracy is unstable.
in this paper we presented an ir based tool codematcher which inherits the advantages of the dl based tool in query semantics matching.
generally codematcher builds indexing for a large scale codebase at first to accelerate the search response time.
for a given search query it addresses irrelevant and noisy words in the query then retrieves candidate code from the indexed codebase via iterative fuzzy search and finally reranks the candidates based on two designed measures of semantic matching between query and candidates.
we implemented codematcher as a search engine website.
to verify the effectiveness of our tool we evaluated codematcher on 41k open source java repositories.
experimental results showed that codematcher can achieve an industrial level response time .3s with a common server with an intel i7 cpu.
on the search accuracy codematcher significantly outperforms three state ofthe art tools deepcs unif and codehow and two online search engines github search and google search .
demo tool website demo video corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse november singapore singapore association for computing machinery.
acm isbn .
.
.
.
concepts software and its engineering software maintenance tools .
keywords code search information retrieval semantics matching acm reference format chao liu xuanlin bao xin xia meng yan david lo and ting zhang.
.
codematcher a tool for large scale code search based on query semantics matching.
in proceedings of the 30th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse november singapore singapore.
acm new york ny usa pages.
introduction when faced with programming problems developers favor learning from existing code and finding solutions through code search .
this is because code search can significantly improve their development efficiency.
during software development it was observed that more than of developers code search efforts are used to find code snippets thus this study focuses on searching code methods i.e.
the frequently searched reusable code snippets in java following previous studies .
moreover our study focuses on the query with natural language description.
the goal of our study is to directly find relevant code methods from a large scale codebase with the same semantics as the query .
early code search studies leveraged information retrieval ir techniques to measure the keywords matching degree between query and candidate code because they are fast .
however the search accuracy of ir based models is far from satisfactory due to two major issues semantic gap keywords cannot adequately represent high level intent implied in queries and the low level implementation details in code representation gap query and code are semantically related but they may be represented by different lexical tokens synonyms or language structures.
to address these issues researchers leveraged deep learning dl techniques to embed query and code into a shared high dimensional vector space.
therefore the code search can be performed by calculating the cosine similarity between code and query vectors.
two representative models are deepcs and unif .
their major esec fse november singapore singapore chao liu xuanlin bao xin xia meng yan david lo and ting zhang advantages are the capabilities of understanding irrelevant and noisy keywords capturing sequential relationships between words in query and code mapping query intent to the semantics of code methods by measuring their semantic similarity .
however the dl based models need time consuming training and their response time for code search is slow.
in our prior work to fuse the advantages of ir based and dl based models we proposed an ir based model codematcher that incorporated the above three features of dl based models.
generally codematcher leverages elasticsearch a lucene based text search engine to index codebase and perform fuzzy search with the identified important keywords from search queries.
to improve query understanding codematcher removes noisy keywords according to some collected metadata and replaces irrelevant keywords with synonyms selected from the codebase.
to optimize the ranking of code methods searched by elasticsearch we reranked the candidate code based on the sequential relationships between words in query and code.
in this paper we strengthen codematcher by implementing it as a publicly accessible code search engine website.
using codematcher developers can use natural language to describe a java programming task as a query.
for a query request codematcher outputs the top java code methods whose programming semantics highly related to the intent of query.
to help other researchers replicate and extend our work in the future we have publicly released the replication package of this tool demonstration.
to evaluate the performance of codematcher we compare it with three baseline models i.e.
deepcs codehow and unif on a large scale codebase with million java methods and real world queries.
experimental results showed that codematcher achieves an mrr of .
outperforming three baselines by at least .
.
in terms of query processing efficiency it only takes .3s for code search per query times faster than codehow while .2k times faster than deepcs and unif.
moreover further experiments showed that codematcher outperforms two online search engines i.e.
github and google search by .
in terms of mrr.
these above results demonstrated the effectiveness time efficiency and usefulness of our tool.
approach fig.
illustrates the overall framework of codematcher the first phase preprocesses a large scale codebase and builds indexing for it the second phase performs code search in three steps including query understanding iterative fuzzy search and reranking.
.
phase i codebase preprocessing and indexing to build codebase for code search the first phase extracts source code files from java repositories and parsed each file into an abstract syntax tree ast .
by traversing the ast we obtained name and body of each code method.
besides the method body is parsed as a sequence of fully qualified tokens e.g.
converting string to java.lang.string in method parameters method body and returned type.
after retrieving pieces of information i.e.
method name parsed method body and source code we input them into elasticsearch and index the codebase.table five word importance levels for programming based on the word property e.g.
verb or noun and whether the word is a class name in jdk.
level condition examples jdk noun inputstream and readline verb or non jdk noun convert and whitespace adjective or adverb numeric and decimal preposition or conjunction from and or other number and non english symbols .
phase ii code search in the second phase codematcher performs code search on the indexed codebase for a query in three steps.
the first step extracts some metadata to assist the query understanding and addresses noisy and irrelevant words in the query.
the second step quickly retrieves a set of code methods from codebase for the query based on the collected metadata.
the third step optimizes the ranking of the search methods in the previous step by measuring the matching degrees between the query and code methods.
.
.
step query understanding.
to better understand the core semantics of a query we address noisy words in the query at first.
specifically we leveraged the stanford parser to identify the parts of speech e.g.
verb or noun of query words which is called word property hereafter.
next we filtered out three types of noisy words in the query that are rarely used for coding according to the word property the question words with related auxiliary verbs e.g.
how do the verb object adpositional phrase on the programming language e.g.
in java the words that were not verbs nouns adjectives adverbs prepositions or conjunctions.
afterward we identified the irrelevant words in query by counting the frequency of each word that was occurred in the method name of codebase.
if the frequency is zero we replaced it by the synonyms generated by wordnet .
if multiple synonyms were produced we chose the one with the highest frequency in the codebase.
subsequently we stemmed the rest of query words to improve their generalizability for code search.
in addition to the words property and frequency we identified the third metadata named importance for query words before performing code search.
the word importance refers to how important a word used for programming.
the importance is categorized by five levels as shown in table jdk noun i.e.
the classes defined in jdk is the most important one level verbs and nouns are important level as they can represent most of semantics in code adjectives and adverbs are assigned with lower importance level as they cannot indicate precise meaning without corresponding noun or verb preposition and conjunction show less importance level the other often meaningless symbols are of the lowest importance level .
.
.
step iterative fuzzy search.
the second step takes the preprocessed query words with metadata from the step one as inputs.
it retrieves a set of code methods that highly related to the query for quickly narrowing down the search space.
we implemented this process as an iterative fuzzy search.
specifically it builds a regular string with all remaining query words in order as .
word .
.
wordn.
.
we performed code search on the 1643codematcher a tool for large scale code search based on query semantics matching esec fse november singapore singapore figure overall framework of codematcher method names indexed in the codebase.
if the total number of returned results is no more than ten we removed the least important word with lower frequency one at a time according to query metadata and performed the fuzzy search again until no query words left.
for each round of fuzzy search we filtered out the redundant results by comparing the md5 hash values of their source code.
.
.
step reranking.
the goal of third step is to rerank the candidate code methods returned from the step two.
to reach this goal we designed a metric sname to measure the matching degree between the semantics of query and method name as eq.
.
higher value indicates that a higher ranked method has more overlapped tokens between query and method name in order.
if two methods have the same value of sname we reranked them based on the matching degree sbody between the semantics of query and method body as eq.
.
different from sname we added the last term to represent the ratio of jdk apis in method body in terms of the fully qualified tokens.
finally we returned the top reranked results.
sname querywordsaskeywords querywords charactersinnameorderlymatchedkeywords charactersinname sbody api wordsmatchedquerywords querywords max querywords jdkapis apis tool implementation and usage we implemented codematcher as a web search engine.
the following subsections describe codematcher s codebase implementation and usage scenarios.data collection.
we chose github as our data source.
we searched candidate java repositories created from july to december with more than five stars by using the pygithub library.
this library provides interfaces to call the github apis .
we formed the search string with language java stars created .. .
as github only returns the top 1k searched results we split the time duration .. of repository creation into small periods.
afterward we performed the search in order and extracted the user name and repository name of each repository.
in total we included java repositories.
subsequently we downloaded their source code according to their user name and repository name.
data preprocessing.
to build a codebase for code search we extracted all the java source code i.e.
.java from our collected repositories.
for each source code file we parsed it into an abstract syntax tree ast and obtained method components i.e.
method name input output parameters and method body .
meanwhile we inferred the fully qualified name of each local variable or class within input output parameters and method body according to the code context e.g.
transforming string to java.io.string .
finally we obtained code methods with a total of lines of code.
we implemented the data preprocessing as a tool named janalyzer and shared it on github.
codebase indexing.
we leveraged the elasticsearch with version .
as our basic search engine for codebase.
we ran it as a back end service with command .
bin elasticsearch .
.
d .
we represented a code method a triple method name parsed method body source code of method where the parsed method body is the sequence of fully qualified names generated from input parameter method body and output parameter.
we created indexing in elasticsearch with the following settings mappings properties method type text parsed type text source type text .
and then we filled all these data into it.
1644esec fse november singapore singapore chao liu xuanlin bao xin xia meng yan david lo and ting zhang figure the homepage of codematcher code search website.
we implemented the search engine codematcher based on the flask web framework.
fig.
shows an example of the codematcher website.
specifically a developer needs to input a natural language query in the search textbox and click the search button.
after the server received the request with the search query it works as the code search process as described in section .
to retrieve a set of ranked candidate code methods from elasticsearch and finally returned the top related results to the front end interface.
soon after the website formatted each returned code with highlighted keywords to improve the readability of the code and showed the code list instantly.
note that fig.
only illustrated the top results due to the limited space where complete results can be found in our tool demonstration video.
usage scenarios.
this section presents several examples to illustrate how developers would interact with codematcher.
for queries like how to convert int to a string developers can quickly find the correct answer i.e.
the first method named convertinttostring when browsing the name and body of the top returned method code.
the other search results provided the four different ways to convert int to string .
as codematcher considered the sequential semantics of important query words it can distinguish the difference between two queries how to convert int to a string and converting string to int in java .
note that this tool demo only illustrates the top search results returned by codematcher because we assumed that developers would like to review a limited number of results following our prior work and related studies .
evaluation and user study effectiveness and time efficiency.
to evaluate the effectiveness of codematcher we obtained real world queries from fourrelated studies .
experimental results showed that codematcher achieved an mrr mean reciprocal rank of .
substantially outperforming one ir based model codehow by .
and two dl based models deepcs and unif by .
and .
.
in terms of the time efficiency codematcher only takes .3s to search code from a large scale codebase for a query on average .2k times faster than two dl based models and times faster than codehow.
also codematcher needs no time consuming model training as dl based models.
conciseness and completeness.
besides we investigated the conciseness and completeness of the searched code.
conciseness indicates the ratio of irrelevant lines to the total lines .
and the completeness means the number of addressed tasks divided by the total number of tasks where the task includes the intent of the search query and other missed statements .
experimental results showed that the average conciseness and completeness of codematcher are .
and .
significantly outperforming the best baseline by .
and .
respectively.
these results indicated that codematcher can return easier to read code and the code can better complete the intent of queries.
usefulness.
to further assess the usefulness of codematcher we compared codematcher with two existing online search engines including github and google search.
these two search engines performed code search from all java repositories in github with our collected real world queries.
experimental results showed that codematcher outperforms github and google search engines by .
and .
in terms of mrr respectively.
these results implied the usefulness of codematcher in practical usage.
conclusion and future work in this paper we present codematcher a tool implemented as a code search engine website that retrieves a set of code snippets from a large scale java codebase according to a query written in natural language.
generally codematcher leveraged ir techniques to implement the features of dl based models to fuse the advantages of ir and dl based models.
experimental results showed that codematcher can perform code search with industrial level response time while outperforming two state of the art dl based models in terms of search accuracy substantially.
in the near future we plan to extend codematcher to support more programming languages e.g.
python and provide more customizable search options.