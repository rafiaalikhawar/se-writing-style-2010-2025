coderecommendationforexceptionhandling tamnguyen auburnuniversity auburn alabama unitedstates tam auburn.eduphong vu auburnuniversity auburn alabama unitedstates lenniel auburn.edutungnguyen auburnuniversity auburn alabama unitedstates tung auburn.edu abstract exception handling is an effective mechanism to avoid unexpected runtime errors.
however novice programmers might fail to handle exceptions properly causing serious errors like system crashing or resource leaking.
in this paper we introduce fuzzycatch a code recommendationtoolforhandlingexceptions.basedonfuzzylogic fuzzycatch can predict if a runtime exception would occur in a givencodesnippet and recommend codeto handle thatexception.
fuzzycatch is implemented as a plugin for android studio.
the empiricalevaluationsuggeststhatfuzzycatchishighlyeffective.
for example it has top accuracy of on recommending what exceptiontocatchina trycatch blockandof70 onrecommending what method should be called when such an exception occurs.
fuzzycatch also achieves a high level of accuracy and outperforms baselines significantly on detecting and fixing real exception bugs.
ccs concepts softwareanditsengineering developmentframeworks andenvironments softwarelibrariesandrepositories software maintenance tools .
keywords exceptionhandling code recommendation bug fixing acmreference format tamnguyen phongvu andtungnguyen.
.coderecommendation for exception handling.
in proceedings of the 28th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse november 8 13 virtual event usa.
acm newyork ny usa 12pages.
introduction exceptions are unexpected errors occurring while a program is running.ifnothandledproperly exceptionscouldleadtoserious problems such as system crashes or resource leaks.
for example when a program tries to parse an integer from a string but the stringdoes not representavalid number a numberformatexceptionexception occurs.
if the program ignores that exception and continues to read it will crash.
thus effective exception handling isimportantinsoftwaredevelopment.apriorstudy reports permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
esec fse november 8 13 virtual event usa associationfor computing machinery.
acm isbn ... .
systems.
most modern programming languages provide built in support for exception handling.
for example in java we can wrap a try blockaroundacodefragmentwhereanexceptionmightoccurand addacatchblocktohandlethatexception.however programmers have to determine themselves what code fragment to protect with thetryblock whatexceptiontypetohandleinthe catchblock and what to react when such an exception occurs.
learning to handle exceptions properly is often challenging duetoseveralreasons.first modernsoftwaredevelopmentrelies stronglyonapilibraries.anapilibraryoftendefinesmanyspecific exception types and exception handling rules.
for example in java sdk class filenotfoundexception is defined for the file not found exception.
when such an exceptionhappens the software system could react by notifying users about the error and writing the relevantinformation timestamp filename caller etc.
to asystem logfor future debugging.
however amajorapilibraryoftenconsistsofalargenumber ofcomponents.forexample theandroidapplicationframework contains over classes methods and more than exceptiontypes .thus itisverydifficulttolearnandmemorize what methodcould causewhat exceptionandwhatto reactwhen aparticularexceptionoccurs.secondly popularapilibrariesare oftenupgradedquickly.forexample in10yearsfrom2008to2018 28majorversionsofandroidsdkhavebeenreleased.thelatest versionofjavasdkisjdk12isreleasedin3 .eachofthose major versions often includes very large changes which could introduce newexceptions andnewrulesfor exception handling.
most importantly the documentation for exception handling is generallyinsufficient.kechagia etal.
foundthat69 ofmethods in android sdk have undocumented exceptions and of the crashes could have been caused by insufficient documentation.
coelhoet al.
found that documentation for many explicitly thrown runtime exceptions or often called unchecked exceptions israrelyprovided.
moderncodeeditorscanenforcecatchingofcheckedexceptions.
forexample injava filenotfoundexception isacheckedexception.
thus when a new fileinputstream object is created to read from a file eclipse will ask the programmer to catch the filenotfoundexception orthrowit .
however such support is not available for runtime unchecked exceptions like illegalargumentexception .
in addition popular codeeditors cannot suggestthe reactionswhen a checkedoruncheckedexception happens.
in this paper we introduce fuzzycatch a code recommendation plugin for android studio with advanced support for exception handling.basedonfuzzylogicruleslearnedfromthousandsofhighquality programs publicly available in app stores fuzzycatch can predict if a runtime exception potentially occurs in a code snippet.
esec fse november8 13 virtualevent usa tam nguyen phongvu andtung nguyen then as the programmer requests it can generate the try catch statementwith catchblockcontainingcodetocatchthatexception andrecover from it.
the key idea of fuzzycatch is based on the observation that exception handling can be expressed by two general programming rules i if call method mthen catch an exception e and ii if an exception eoccursthenperformaction rtoreact.forexample ifyou call the method activity.unregisterreceiver then you have to catch anillegalargumentexception .
or if you call the integer.parseint thenyouhavetocatchan numberformatexception .and whenan sqlitedatabase occurs youcallmethod cursor.close asasimple reactionto close the resource.
fuzzycatch learns such rules from a large collection of highqualitycode.forexample assumethatnoavailabledocumentation specifiesthatifwecallmethod m weneedtocatchanexception of typee.
however we observe from thousands of high rated apps in google android appstore that whenever mis called of the times an exception of type eis also caught.
such a high level of co occurrence suggests a rule that if we call m we should catch e.however because those rulesare likely imperfect fuzzy logicis usedtorepresentandcombinethem.thedetailsofourapproach are presentedinsection .
wehaveconductedseveralexperimentstoevaluatetheusefulnessandeffectivenessofourtool.wecollectedadatasetcontaining over21 million methodsfromover13 000highlyratedmobileapps ingoogleandroidappstore.the10 foldcross validationoffuzzycatch on this dataset are promising.
fuzzycatch has the top accuracyof77 forrecommendingexceptiontypes.thatmeans in of the cases the first exception type that fuzzycatch recommends catching is the one used by app developers.
the top accuracyofrecommending reactioncode isof70 .
we collected a second dataset of real exception related bugs.
in its strictest mode fuzzycatch flags cases i.e.
suggestingtheyneedexceptionhandling.initsloosestmode fuzzycatchflags821cases .however theloosestmodewouldmake around35 unwantedwarningsoncodethatprogrammershave never added exception handling code.
the strictest mode would makeonly7 ofunwantedwarnings.onthetaskofrecommending handlingactions fuzzycatchprovidesmeaningfulrecommendationsinroughly65 ofthebugfixesandoutperformsthebaselines significantly.our evaluation are presentedinsection .
the key contributionsofour paper include anovelapproachbasedonfuzzylogicforexceptionhandling code recommendation a plugin for android studio implemented that approach for java andandroid mobileapp development an extensive evaluation ofour approach andour tool.
motivation examples although mostmodernprogramminglanguagesprovidebuilt in support for exception handling.
programmers still have to determine themselves what code fragment to protect with the tryblock whatexceptiontypetohandleinthe catchblock andwhattoreact whensuchanexceptionoccurs.thepreviousstudies shows thatprogrammersmighteasilyforgetto handleanexception that potentially occurs in a code snippet.
such mistakes could causeserious issues to the developing app i.e.
crashing.
for example figure9 section5 showsaseriousbugcausedbynotcatchinga runtimeexception .
furthermore thestudiesalsosuggestthatinpractice noviceand even experienced programmers might not always handle exceptionsproperly.forexample figure 1showsanexceptionrelated bugfixinthewordpressmobileapp.theprogrammercallsmethod activity.unregisterreceiver with variable mediaupdate passed as itsargument.atruntime thiscallcausesan illegalargumentexceptionandcrashesthemobileapp.thiserrorisfixedbya trycatch block that handles that exception.
however the catchblock has no code.althoughthisbugfixmakestheappnotcrashagain itisa badprogramming practiceto catch an exception anddo nothing.
unregisterreceiver mediaupdate try unregisterreceiver mediaupdate catch illegalargumentexception e figure anexample ofswallowing an exception figure2showsanotherexceptionrelatedbugfixof cursorobject.inthisexample anexceptionoccurswhenusing cursorobject.
to handle this bug the programmer added a try catch block to cover the code portion that uses the cursorobject and returned nullinthecatchblock.thisactionofhandlingmayleadtomemory leak bugs.
after exception occurs and the function returns thecursorobjectstilllivesandholdssystemresourcesuntilitis collected by the garbage collector.
this may prevent other parts of theprogramtoaccesstheresources.theproperwaytohandlethis exception is calling closemethod on the cursorobject before the returnstatement.the closemethodwillreleaseresourcesthathold bythe cursor objectbefore the function lost the reference to it.
.
.
.
try if cursor.getcount return null else cursor.movetofirst return new pair cursor.getlong cursor.getstring catch exception e return null commit message catch exception when reading message id from database .
figure anexceptionrelated bug fix theexamplesindicatethe needexceptionhandlingrecommendationtoolsforprogrammers.suchprogrammingtoolscouldwarn programmers about potential exceptions that might occur in the code andassist programmers to handle the exceptions correctly.
approach inthissection wediscussthekeytechniquesoffuzzycatch.we willstartbyintroducingxrank afuzzylogicsystemtorankand suggest exception types to catch given a piece of code.
then we describe xhand a fuzzy logic system for recommending repairing actions when aparticular exception occurs inthat pieceof code.
1028code recommendation forexceptionhandling esec fse november8 13 virtualevent usa .
recommending exception types we formulate the problem of recommending exception types as the following given a code snippet c determine of the runtime exception s ewith a highpossibility to occur when cis executed.
ourkeyideatosolvethisproblemistolearnfromtheexception handling code already written in high quality software systems.
we firstcollectalargecollectionofhigh quality code d. foreach methodmcalledinc welookatalleverycallof mind.ifthose callsoftenassociatewithcatchinganexception ethenitislikely that calling mcould cause e. since there might be several methods calledincandseveralexceptions associatingwiththemin d we needto combine andrank thoseexceptions.
this is an example from our experiment data.
as discussed in detail in section we collected roughly highly rated android mobileapps.
inthose apps we found38 calls tomethod integer.parseint .
among them calls .
appear in trycatchblocks catching numberformatexception .
and this is the exceptionmostco occurredwith integer.parseint .thus evenwithoutdocumentation wecaninferthat calling integer.parseint could causenumberformatexception .ofcourse javaapidocumentation comfirmsthat.
similarly we found that among method calls to cursor.movetofirst calls .
co occur with catching sqliteexception .
that means we could infer thatthemethodcall cursor.movetofirst might cause sqliteexception .
this is also confirmed by android api documentation.
of course calls to integer.parseint andcursor.movetofirst oftenalsoco occurwithcatchingexception andthrowable the mostgeneralexception injava.
now assumethataprogrammeriswritingacodesnippetcontainingacallto cursor.movetofirst toreaddatafromadatabase queryandacallto integer.parseint toparsesuchdata.theabove exception handling rules learned from high quality code suggest him hertocatch numberformatexception andsqliteexception or the more general ones exception andthrowable .
however those rules areimperfect e.g.
recommending to catch numberformatexceptionisapplicable for only .
ofcalls to integer.parseint .
inthispaper weaddressthatissueviafuzzylogic.wedeveloped xrank afuzzylogicsysteminfuzzycatchtorankandrecommend exception types.
basically xrank contains a collection of rules if callmthencatch e inwhich misanmethod e.g.
integer.parseint andeisanexceptiontype e.g.
numberformatexception .because thoserulesare imperfect eachrulehas aconfidence level m e .
xrank uses fuzzy sets to represent those rules.
for each method m xmisdefinedas thesetofexceptionstocatchwhencalling m .as afuzzyset xmhas amembership function m whichcalculates membership score m e for every available exception type e. in traditional fuzzy logic systems membership functions are defined by domain experts.
however in fuzzycatch we define membership functions empirically i.e.
the membership scores m e is estimated from the training data a repository of high quality code .
the key assumption is that the more mandeco occur in high qualitycode writtenbyprofessional programmers the more confidencethatifwecall m weshouldcatch e becauseprofessional programmersoftendothat .therefore m e iscalculatedbased on theco occurrenceof mandein thetrainingdata.assume that nmis the number of calls to mandnm eis is the number of calls totable membership scores integer.parseint nm nm e m e numberformatexception .
exception .
throwable .
illegalargumentexception .
jsonexception .
cursor.movetofirst nm nm e m e sqliteexception .
exception .
sqlexception .
throwable .
sqlitefullexception .
mediaplayer.getduration nm nm e m e illegalstateexception .
exception .
throwable .
illegalargumentexception .
securityexception .
byte.parsebyte nm nm e m e numberformatexception .
exception .
jsonexception .
throwable .
nosuchelementexception .
minalltry catch blockscatching e then m e nm e nm formula1impliesthat thevalueof m e is between .
table1lists the top five exception types to catch for several methods andtheirmembershipscoresestimatedfromourexperimentdata.
we could see that for integer.parseint numberformatexception isthe top 1exceptiontype co occurringwith .
of itsmethod calls.
the next one is the general exception type exception cooccurringwith14.
.theremainingexceptiontypeshavemuch lower scores.
xrank utilizes the fuzzy sets xmfor two tasks assessing if a givencodesnippet needs a try catch block and rankingexception types to catch in that block.
to do that for each method m it first calculates m theexception risk ofm which is the total possibility thatcalling mwouldcauseanexception.because xmisthefuzzy set representing the possibility that calling mwould cause each exception e the exception risk mis calculated as the total weight ofxm m xm summationdisplay.
e m e table2lists the exception risk of three methods in table .
we can seethatamongthethreeofthem cursor.movetofirst istheriskiest e.g.
nearly60 ofitscallsassociatedwithcatchinganexception.
in contrast just of calls to mediaplayer.getduration associate withcatchingan exception thus its exception riskismuchlower.
1029esec fse november8 13 virtualevent usa tam nguyen phongvu andtung nguyen table exceptionrisk scores method nm m cursor.movetofirst .
integer.parseint .
mediaplayer.getduration .
fuzzylogic systemsoftenuselinguistic conceptsandvariables to make them easier to use and understand for the domain experts and end users of those systems.
to make fuzzycatch easier to use forprogrammers weclassifythemethodsintodifferentriskclasses basedontheirexceptionriskscores.assumethat 1 2 and 3are respectivelythe20 and50 percentileofallexceptionrisk scores.then ifmethod mhas m 1 i.e.
misthetop among allmethods itisclassifiedas veryrisky .if 1 m 2 m is not in top but in top it is classified as risky .
and if if 2 m 3 mis not in top but in top it is classified as less risky .
the remaining methods are considered as not risky andignored.
in the ide android studio we color code method calls with their risk levels.
for example calls of very risky methods like cursor.movetofirst are colored red.
calls of risky methods likeinteger.parseint are colored orange.
calls of less risky methods like integermediaplayer.getduration arecoloredyellow.callsofothermethodsare unchanged.
we could see that for a single method call to m the exception risk m which iscorrespondinglycolor coded asvisual guidefor programmers and the membership scores in the fuzzy set xmare sufficient to suggest if a try catch block is needed and to recommend exceptions to catch in such a block.
for example a call to cursor.movetofirst shouldberecommendedwitha try catch block because it is classified as very risky to cause an exception .
then the topexception to catch when calling cursor.movetofirst should be sqliteexception .
however programmersoften do not write try catch block for each single call.
we are more likely to write a try catch block for a code snippet which might contain several method calls.
thus to combine exception handling rules of all those method calls xrank alsouses afuzzylogic approach.
let us discuss an example first.
assume that a code snippet c contains a call to cursor.movetofirst to read data from a database queryandacallto integer.parseint toparsesuchdata.then because both of them have high exception risk the code snippet also has high risk of causing exceptions.
two most potential exceptions are sqliteexception fromcalling cursor.movetofirst andnumberformatexception from calling integer.parseint .
thus a programmer might write a tryblock around the code snippet and two catch blocks for those two exceptions.
however he she might also write a simpler solution by using only a catchblock catching exception which generalizes both numberformatexception andsqliteexceptionandalsohashighmembershipscoresinthefuzzysetsof exceptions of both cursor.movetofirst integer.parseint .
in other words whentwomethods cursor.movetofirst andinteger.parseint are called together the potential exceptions are combined from those for each of that method.
in fuzzy logic this combination is a fuzzyunion.in general assumethat ccontainskmethod calls m1 m2... mk.
letxcbe the fuzzy set of exceptions should be caught for c then xcisthe union ofallfuzzysetsof exceptions for m1 m2... mk xc xm1 xm1 ... xmk becausexcis a fuzzy set it has a membership function c. the union operation in fuzzy logic is defined via calculating cfrom m1... mk.
there are several formula for fuzzy union we use the following one c e m1 e m2 e ... mk e similarly we also calculate the exception risk of the whole code snippetcas the following c m1 m2 ... mk forexample assumethat eisexception m1iscursor.movetofirst andm2isinteger.parseint .
from table m1 e .
m2 e .
.
thus c e .
.
.
.
this membership score is higher suggesting that exception is more likely tobe used in the catchblock when both methods are called.
similarly from table m1 .
m2 .
.
thus c .
.
.
.
this exception risk is higher suggesting that when both methods are called it is higher possible that an exception willoccur whichisintuitivelyplausible.
insummary xrankrecommendsforagivencodesnippet cas thefollowing.first itcalculatestheexceptionrisk c.if cexceeds the user preset risk level e.g.
very risky with c 1 then itcalculates c e foreveryavailableexceptiontype eandranks themdescendingly.fuzzycatch presents thetopexceptionsin the ranked list to the programmer.
when he she selects one exception fuzzycatch will generate a try catch block around code snippet c. .
.
improvements.
to improve the prediction accuracy we incorporate several programming language features to the xrank model.first weobservethatexceptionshavehierarchicalstructure.
for instance in java all exceptions anderrorsare sub classes of throwable allruntime exceptionsare sub classesof runtimeexception andruntimeexception isasub classof exception .with thehierarchicalstructure programmerscanuseasuper classexception in any catchblock of its sub class exception.
for example infigure theprogrammercoulduse exception inthecatchblock insteadofitssubclass runtimeexception .inxrank weincorporate this hierarchical property by modifying the value of nm ein the equation1.anytime mappearsina tryblockwhile eappearsinthe corresponding catchblock inadditiontoincreasethevalueof nm e by we also increase the value of nm e by a weighted value we if e is a super class of e.we could be calculated as the frequency of e inallcatchblocks we ne summationtext.1ne mostmodernobject orientedprogramminglanguagessupport polymorphism.overloadingmethodsisoneformofpolymorphism in which methods within a class can have the same name if they have different parameter lists.
for example the integerclass has two methods for parsing numbers that have the same name parseint strings andparseint strings intradix .thelatermethod has anadditional parameter for radix.these overloading methods oftenperformsimilartasks thus theyarelikelytothrowsimilar 1030code recommendation forexceptionhandling esec fse november8 13 virtualevent usa usage try httpconnection.openconnection httpconnection.setrequestproperty ... httpconnection.connect catch ioexception e in httpconnection.geterrorstream ... usage try httpconnection.getinputstream httpconnection.getheaderfield ... catch ioexception e int responsecode httpconnection.getresponsecode httpconnection.disconnect ... figure handlingexceptions forhttpurlconnection exceptions.
furthermore the later method in theexample appears much less than the method parseint string s .
thus learning rules forparseint string s int radix could be challenging due to lack of data.
we improve the prediction accuracy of xrank by grouping overloading methods together and consider each group as one methodwhen learningthe model.
finally table 1also shows the fuzzy set of the api method byte.parsebyte .
we can see that although parsebyte is similar toparseintandparselong the statistics of parsebyte are small becauseitappearsmuchlessthantheothermethods.thus learning rules for parsebyte could be challenging due to lack of data.
to solve this problem we group methods with the same aspect and learn the usage rules for the group.
in our implementation we manuallyidentify5groupsofsimilarapimethods numberparsing parseint parselong ... cursor reading getint getlong ... bitmap decoding decodebytearray decoderesource ... sqlitedatabase getversion getpath ... text formatting format formatnumber formatfilesize ... .
.
recommending exception reaction in addition to recommending what exception to catch fuzzycatch also recommends codeto react when such an exception occurs by writteninthe catchblock.figures 9and10illustratecodeexamples withdifferentwaystowritethecodetoreactwhenanexception occurs.infigure theprogrammeraddsthecodethatcreatesanew objectwithadifferentparameter.infigure theprogrammeradds the code to retrieve the error stream from the httpurlconnection whentheexceptionoccurs.weconsiderthenon reactioninfigure as abadpractice.
the reaction code written in the catchblock can be large and complicated.
however nguyen et al.
suggests that in most cases programmersoftencallonlyonemethodforeachobjectsuch asprintstacktrace for anexception object closefor ansqlitedatabase object or disconnect for anhttpurlconnection object.
weconsidercreatinganewobject suchas datenow newdate as calling aspecial method new.similarly assigning a valueto an object suchas in httpconnection.geterrorstream islikecalling aspecialmethod assign.
therefore fuzzycatchrecommendscodeinthe catchblockby consideringallobjectsappearinginthe tryblockandprovidinga ranked list of methods to call for that object.
xhand is the fuzzy logic systemresponsible to generatethat rankedlist.
oneobservationwhendevelopingxhandisthatthemethod rto call for reactiondepends on the method call and potentially cause the exception in the tryblock.
for example consider two usages of ahttpurlconnection in figure .
in the first usage the exception mayoccurwhileusingthe httpurlconnection forconnectingtoaserver via connectmethod.
in this situation we would want to get theerrorstreambycalling geterrorstream togetinformationabout the errorfor furtherprocessing.in thesecondusage theobjectis alreadyconnectedtotheserverbutthereadtimeoutexpirescausing an exception.
in this situation the exception handler we would want to getthe response code anddisconnectfrom the server.
thus the keyidea of xhand istolearn the fuzzy rule if callm in thetryblock then call rin thecatchblock to react or recover .
for example asinfigure3 sqlitedatabase.delete iscalledinthe try block thus sqlitedatabase.close is called in the catchblock to release resources.
thus similartoxrank wealsodefineinxhandforeachmethod mafuzzyset rmofmethodstocallforreactiontoexceptionpossibly causedbycalling m.itsmembership function misdefinedas m r nm r nm in thisformula nmis againthe numberof callsof mandnm r is the number of times mis called in a tryblock and ris called in the corresponding catchblock.
sometimesthemethodcallforreactiondependsontheoccurring exception.forexample iftheexceptionis exception thenprogrammers usually call its method printstacktrace orgetmessage .
in other words xhand also needs to learn the fuzzy rule if exception eoccursthencall rtoreactorrecover .thus foreachexception e we also define a fuzzy set reof methods to call for reaction if e occurs.itsmembership function eisdefinedas e r ne r ne inthisformula neisthenumberoftimes eappearsina catchblock mandne r isthe number of times riscalledinthat catchblock.
then similarto xrankwhenacodesnippet ccallskmethods m1 m2... mkand catches exception e. letrcbe the fuzzy set of methods should be called for reaction then rcis the union of all fuzzy sets rm1 rm2... rmkandre.
its membership function is definedas c r m1 r m2 r ... e r finally foreachobject oinc ifr rcisamethodcallablefor o e.g.
risamethodof o orrcanaccept oasanargument itwillbe added to a list.
the list is ranked descendingly by the membership scores andpresentedto the usersof fuzzycatch.
systemimplementation in this section we discuss the implementation and usage of fuzzycatch.
currently available at rebrand.ly exassist it is released as a pluginofintellijideaandandroidstudio twopopularidesfor java programs andandroid mobileapps.
.
design overview figure4shows the design overview of fuzzycatch.
it has a two modulestoextractapiusagemodelsfromsourcecodeandbytecode b onemoduletoextractexceptionhandlinginformationfrom those usage models c two modules to train xrank and xhand from those extracted data and d two modules using the trained fuzzylogicsystemsto recommendcodeforcatching andreacting to exceptions.
letusdescribe thosemodulesinmore detail.
1031esec fse november8 13 virtualevent usa tam nguyen phongvu andtung nguyen android bytecodecurrent editing code bytecode groum extractorsource code groum extractor api usage models api exception usage extractor api exception usagesapi usage extractor api usagesapi usage model xrank learner xhand learnerexception types recommender repairing actions recommenderxrank models xhand models figure designoverview offuzzycatch .
.
groum extractor.
fuzzycatch employs an extension of groum graph based object usage model presented in to representtherawapiusageswithexceptions.ithasamoduleto extractgroumsfromthebytecodeofandroidappsinthetrainingdataset.italsohasasimilarmoduletoextractgroumsfrom the code being written which are used for its two tasks of recommending exception types and repairing actions.
the extracting algorithms could be foundat .
.
.
apiexceptionusageextractor.
becausexrankandxhand aretrainedfromusagesofapiobjectsandmethodcallsinexception handling code fuzzycatch has a module named api exception usageextractor to extractfrom those usagesfrom groums.this moduletraverseseachsub graphofagroumrepresentinga trycatchblock and extracts all api method calls and the catching exception.thetemporalorderanddatadependencybetweenthose apimethodcallsarealsoextracted.themodulethenstoresthat information as an api exception usage.
.
.
xrank and xhand learners.
these modules are responsible for training xrank and xhand systems from the extracted apiexception usages.
they count therawoccurrences nm nm e nm r ... computemembershipscores m e m r ...andexception riskscores m. see section 3for details .
.
.
exception types recommender.
this module provides the recommendations on unchecked exception types for a selected code snippet c. it first extracts the set of api method calls that appeared in the under editing code.
then it utilizes xrank to computeexceptionriskscoresforeachcallandmakethemcolorcoded in the ide e.g.
red for very risky method calls .
the programmer can use the color code to select the code snippet of his herinterestforexceptionhandling.oncethecodeisselected xrank is used to calculate the membership scores of exceptions towardsmethodcallsappearingintheselectedcode.top ranked exceptions are addedto the recommendation list.
figure exceptionwarningsby fuzzycatch .
.
repairingactionsrecommender.
thismoduleprovidesthe recommendations for repairing actions in exception handling code.
it extracts the set of api method calls in the tryblock the catching exception e. it then groups api method calls by objects.
all api methodcallsinagroupofanobjecthavedatadependencywiththat object.itusesthexhandsystemtorecommendrepairingactions for each object given the api method calls in the tryblock.
finally itcombinesallthepredictrepairingactionstoproducethefinalrecommendation.
note that fuzzycatch convertsspecial operations on objects like null check assignments as pseudo method calls e.g.
cursor.check null string.assign zero .
when generating code cursor.check null isgeneratedas if cursor!
null .
.
usage in this section we presenthow touse fuzzycatchin practice.figure5showsacodeexample.assumeaprogrammeriswritingcode to open and get data from a database.
she first opens a sqlitedatabase andassignsittovariable sqlitedb.shethenrunssome sqlcommandstoupdatethedatabase.next shecreatesaquery that returns a cursorobject and uses that cursorobject to retrieve data to alistnamed booktitles .
whiletheprogrammer is writing thecode fuzzycatchutilizes xranktoaccesstheexceptionrisksandcolor codeitsmethodcalls.
forexample thecalls cursor.movetofirst andcursor.movetonext are red flagged booktitles.add is orange flagged.
that makesthe programmer aware that the code is dealing with database and callingcursor smethodsmightcause uncheckedexceptions runtime exceptions atruntime.
withoutfuzzycatch thebuilt inexception checkerinandroidstudioonlysupportsadding checkedexceptions thus does not helpherto make appropriate action inthis case .
now theprogrammerinvokesfuzzycatchbyselectingthecode snippet that she wants to check for exception then pressing ctrl alt r .
in figure fuzzycatch is invoked for a code snippet reading data from database with the cursorobject.
it suggests a ranked list of unchecked exceptions with sqliteexception at the top.
if the programmer chooses this exception fuzzycatch willwrapthecurrentlyselectedcodewitha try catch blockwith sqliteexception inthecatchexpression.
figure7demonstrates theusageoffuzzycatchinrecommendingexceptionrepairingactions.afteraddinga try catch blockwith sqliteexception forthecodeinthepreviousscenario theprogrammer wantsto performrecoveryactions.toinvoke fuzzycatch for this task she moves the cursor to the first line of the catchand pressesctrl alt h .
in the example fuzzycatch detects that 1032code recommendation forexceptionhandling esec fse november8 13 virtualevent usa figure recommendingexceptiontypes figure recommendingrepairingactions thecursorobject should be closed to release all of its resources and making it invalid for further usages.
it also suggests to set booktitles equalsnullto indicate the error while collecting data fromcursor.
if the programmer chooses the recommended actions fuzzycatchwillgeneratethecodeinthe catchblockasinthefigure.
tosavespace weshowboththerecommendationandgenerated code inasame window.
empiricalevaluation we conductedseveral experiments to evaluate the effectiveness of fuzzycatchonrecommendingexceptionhandlingcodeforandroid andjavaapis.allexperimentsareexecutedonacomputerrunning windows with intel core i7 .6ghz cpu 8gb ram and 1tb hddstorage.
.
data collection the source code of most android apps is not publicly available.
with few apps with source code available training fuzzycatch from existing mobile app projects would be difficult and insufficient.thus wedecidedtotrainourmodelswithandroidbytecode.
table3summaries our dataset for training the models.
in total we downloaded and analyzed top free apps from the google playstore.wefetchedalistoftopfreeappsfromallthecategories oftheappstore.then weonlydownloadedappswithanoverall rating of at least out of based on the assumption that the high rating apps would have high code quality and thus would have better exception handling code.
since android mobile apps are distributed as .apkfiles our crawler unpacked each .apkfile and keptonly its .dexfile whichcontains thebytecode ofthe app.
thetotalstoragespaceforthe .dexfilesofthedownloadedappsare around165gb.afterparsingthose .dexfiles weobtainedabout21 million classes.
next wedevelopedabytecodeanalyzerthatanalyzedeachclass and looked for all methods in the class to build groum models.table data collection numberofapps numberofclasses numberofmethods numberofbytecodeinstructions spacefor storing .dex files .
gb numberofexceptiontypes numberofapimethods 685accuracy top k1 xrank baseline accuracy top k1 xhank baseline figure recommendation accuracy since an android mobile app is self contained its .dexfiles containthebytecodeofallexternallibrariesituses.thatleadstothe duplication of the bytecode of shared libraries.
to remove that duplication our bytecode analyzer maintains a dictionary of the analyzedmethodsandanalyzedeachofthemonlyonce.intheend weanalyzedover26million uniquemethodswhichhaveintotal nearly million bytecode instructions.
they are used to train xrankandxhand producingfuzzylogicrulesfor261exception types and64 685methodsinjava andandroid apis.
.
experiments on android bytecode weconsiderthebytecodeofthedownloadedappsastheevaluation dataset and use fold cross validation to evaluate the accuracy of fuzzycatchonthem.
wedividetheminto10folds eachcontains roughly1400apps.ateachiteration wechooseafoldfortesting and the remaining for training.
the final results are averaged from iterations.
for each try catch block in the code of the testing apps we evaluatedif fuzzycatchcan recommendthe actualexception and reaction method calls in the catchblock given the method calls in thetryblock.
for example if the code actually catches eand eis also in the top klist recommended by fuzzycatch then it is anaccurate recommendation for catching exceptions.
similarly if foranobject o thecodecallsmethod rforrecovery and risalso in the top krecommended by fuzzycatch then it is an accurate recommendation for reactionto exceptions.
to measure the effectiveness of fuzzycatch we compared it with a simple baseline.
because no other approaches have been proposedforthisrecommendationproblem wedesignthebaseline as a simple approach based on the frequency of catching exception types and reaction calls.
that is we count the number of times an exception or a repair call appear in all try catch blocks in 1033esec fse november8 13 virtualevent usa tam nguyen phongvu andtung nguyen thetrainingdata.
then theexceptions orrepair calls are ranked descendinglybytheirfrequenciesandrecommendedassuch.for example exception is the top exception recommended by this approach.and closeisthetop 1methodrecommendedtocallfor repairing orrecover a cursorobject.
figure8shows theexperimentresults the leftchart for xrank and the right chart for xhand .
from the figure we can see that bothxrankandxhandhaveconsistentlyhighlevelsofaccuracy.
for example xrank has top accuracy of and top accuracyof92 .forxhand theyare69 and87 .also bothmodels significantly outperform the baselines.
.
experiments on real exception bugs weconductedtwomoreexperimentstoevaluateontheeffectivenessoffuzzycatch ondetecting andfixing real exception bugs.
.
.
datacollection.
inthissection wedescribebrieflyourdataset of exception handling bugs and fixes.
we focus on bugs that are caused by not catching exceptions in the code.
for convenience wedefinedthosebugsas exceptionbugs .the fixfor thosetypes of bugs iscalled exceptionbugfixes .
we first collecteda dataset consists of several large open source android projects.
for each project wecheckedoutitssourcecoderepositorytoretrieveallthe code and commits.
we developed an extraction tool to identify the bugfixesfromthecommitsandissuesofthoseprojects.next we manually inspected all the bug fixes to identify exceptionbug fixes.
finally wewereabletocollectadatasetof1 000exceptionbugfixes.
thestepstoidentifytheexceptionbugfixesandcollectthedataset are described in detail in .
figure9shows an exception bug fix inour dataset.the dataset isavailable at rebrand.ly exdataset.
postcontent new spannablestringbuilder meditorfragment.getspannedcontent try postcontent new spannablestringbuilder meditorfragment.getspannedcontent catch runtimeexception e a core android bug might cause an out of bounds exception if so we ll just use the current editable see postcontent new spannablestringbuilder stringutils.notnullstr string meditorfragment.getcontent commit message fix re introduce a workaround we were using in previous versions figure anexceptionbug fix .
.
detectingexceptionbugs.
bycalculatingexceptionriskscores ofmethodcallsandcodesnippets fuzzycatchcouldwarnprogrammers of missing exception handling code i.e.
it could detect exception related bugs.
for example if a method call having a very risky exception risk score is not covered by a try catch block fuzzycatchcanwarntheprogrammerofapotentialexceptionbug andrecommendsan exception to catch.
to evaluate fuzzycatch on such warnings we manually applied fuzzycatch for the exception bugs that we collected.
we run fuzzycatch on the buggy code version and check if fuzzycatch produceswarnings.then wecomparetheexceptionrecommended byfuzzycatchandtheactualexceptioncaughtinthefixedversion.
the three risklevels are definedthe same as insection .
.table recommendation results for1 exceptionbugs risk level veryrisky risky lessrisky correctwarning top accuracy top accuracy table4liststheresults.ifwesetfuzzycatchtothestrictestmode i.e.
onlywarningonmethodcallswith veryrisky exceptionrisk levelthenitproducedwarningsfor734outof1 000bugs .
.
in the loosest mode i.e.
warning on all method calls with less risky exception risk level and higher then it produced warnings for 821outof1 bugs .
.
the prior experiment on android bytecode shows that fuzzycatch does not always recommend the exception actual used by the programmers.
forexample the top recommendation for integer.parseint isnumberformatexception .
however inmany cases the programmers actuallyusethe more general exception .thus it is similarly in this experiment.
in cases that fuzzycatch warns of potential exception bugs in its strictest mode the top recommendedexception isactually usedin547cases .
.
when using fuzzycatch there could be a case in which the tool flagsawarningonamethodthattheprogrammerdoesnotwant to addtry catch block or catch an exception.
we defined those cases as unwanted warnings .
to evaluate if fuzzycatch produces unwanted warnings we selected codesnippets from the latest versionofoursubjectsystems.weonlyselectedcodesnippetsofat least lines of code and having no try catch block added through thewholeprojecthistory.weassumedthatsuchcodesnippetswill not need exception handling code.
thus if fuzzycatch produces a warning of missing exception handling for such a code snippet it willbeanunwantedwarning.inareal world large scalesystem itisnearlyimpossibletoproveorverifythatapieceofcode cis free of bugs.
so we did not have a reliable method to determine ifcdoesnotneeda try catch statement.weinsteadlookedatits revisionhistory.becausethesubjectsystemshavealonghistory somehaveupto28 000revisions ifapieceofcodehasnotbeen enclosed by a try catch statement throughout such long history then we could reasonablyassumethat itdoes not need.
inthestrictestmode fuzzycatchproduced8unwantedwarnings out of code snippets .
in the loosest mode fuzzycatch produced unwanted warnings.
thus this is a balanced trade off.
iftheprogrammerwantstohighercodequality i.e.
fewerexceptionbugs heneedstospendmoretimeonfuzzycatchwarnings to determineif its warnings andrecommendations are necessary.
inaddition addingatry catchstatementmakesthecodesafer.
the expected loss for an unwanted warning is much smaller than a bug caused by a missing try catch statement.
thus we conservatively call recommendations of fuzzycatch unwanted warnings because programmers have not yet wanted to use them ratherthan falsepositives meaningthoserecommendationsare strictlywrong.
.
.
repairingexceptionbugs.
inthisexperiment weevaluate theeffectivenessoffuzzycatchinrecommendingrepairingactions for real exception bug fixes.
not all of the exception bug fixes 1034code recommendation forexceptionhandling esec fse november8 13 virtualevent usa table results inrecommendingrepairingactions fuzzycatch barbosa et al.carminer offixes ofmatches contains handling actions for example the fixer could add code to swallow exceptions add loggingmessages or re throw another exception.weselectasubsetofthe1 000exceptionbugfixeswhich includesalltheexceptionbugfixesthatcontainhandlingactions byprogrammersinthe catchblock.ineachbugfixofthesubset developersperformedatleastonerepairingaction i.e.amethod call an assignment etc.
in the exception handling code.
figure shows an example of a bug fix in the subset.
in the bug fix the developer performed three method calls and one assignment to set valuefor postcontent .intotal thereare437outof1 000exception bugfixeshavehandlingactions thus weevaluatefuzzycatchon this subset.
foreachbugfixinthedataset weinvokedfuzzycatchtorecommendrepairingactionsandcomparetherecommendationresult withthecorrespondingfix.iftherecoveryactionsrecommended by fuzzycatch exactly match with the fix we count as a match.
otherwise we considerthe caseas amiss.
tofurtherevaluatetheeffectivenessoffuzzycatch inthis task we compare our tool with two existing approaches presented in .
barbosa et al.
proposed a technique that uses exception types method calls and object types as heuristic strategies to identify and recommend relevant code examples with current handling codeunderediting.althoughtheapproachdoesnotprovideactual recommendations the examples that it suggests could be used as a guide for programmers to fix an exception bug.
thus we evaluate the baseline as follows if at least one of the top relevant code examplesrecommendedbythebaselinematcheswiththefix we count as a match otherwise we consider the case as a miss.
we re implementedthe techniqueusing the sameconfigurationspresented in the work.
as the approach requires a corpus of real code examples not bytecode we implemented it with a dataset contains the source code of android projects listed on the fdroid app repository1.thelistofalltheprojectsinthedatasetcouldbefound atrebrand.ly exdataset.rahman etal.
proposedanotherapproachthatrecommends exceptionhandlingcodeexamplesfroma numberofgithubprojects.themethodisdifficulttoimplement as it requires to collect complex code features from each code exampleandtoestimate12weightingparametersusingmachine learning.wecontactedtheauthorbutwecouldnotcompiletheir code or collect their training and experiment data.
thus we did not compare the result withtheirwork.
wealsocompareourmethodwithcar miner anapproach thatusesassociationminingtechniquestomineassociationrules betweenmethodcallsof tryandcatchblocksinexceptionhandling code.
the model was used to detect bugs related to exceptions.
the mined rules have a form sn se in which snis the set of all methods in a tryblock while seis the set of repairing methods in a catchblock.secould be used as the recommendation on handling were used in the original paper on the same android bytecode dataset as fuzzycatch.
table5shows the evaluation result of fuzzycatch and the baseline for the task.
in a total of exception bug fixes the recommendations of fuzzycatch match the fixes of developers in cases.overall fuzzycatchcouldprovidemeaningfulrecommendations in roughly of the bug fixes.
the first baseline only matches the fixes of developers in cases.
the association miningtechniquecar minerperformsbetterwith196cases .
overall theresultoffuzzycatchoutperformsthebaselinemethods substantially.
inputstream in new bufferedinputstream httpurlconnection.getinputstream inputstream in null try in new bufferedinputstream httpurlconnection.getinputstream catch exception ex in httpurlconnection.geterrorstream commit message merge pull request from garvankeeley bugnetwork figure anexample ofhandlingan exception for demonstration figure 10shows an exception bug fix in which the three techniques have different recommendation results.
inthisexample fuzzycatchrecommendscalling geterrorstream on httpurlconnection object and an assignment for the inputstream object.
the result exactly matches the code of the programmer as shown in the figure.
car miner mined getinputstream disconnect as a association rule thus it suggests calling the method disconnect instead of geterrorstream which is incorrect.
while the code examples provided by the first baseline did not provide any meaningfulrecommendations.
discussions inthissection wediscussseveralaspectsoffuzzycatchinmore detail.
from machine learning perspective fuzzycatch is a simple ensemble approach to three classification problems given code snippet c predict if it needs an enclosing try catch which is a binary classification problem predict what exception to catch which is a multi class prediction problem with classes are all exception types predict what method to call in the catch block which is a multi class predict problem with classes are all apimethods.fuzzycatchlearnsandpredictslikenaivebayes but more flexibly.
because fuzzy membership functions are not probability distribution functions fuzzycatch does not need to assume the independence of predictors or normalize summationtext.
e c e .
wecouldconsiderfuzzycatchisabigcodepoweredfuzzylogic systemspecially designed for thesoftware engineering domain.
it represents exception handling knowledge as fuzzy logic rules.
it usesfuzzysettheorytomodelandapplythoserules andusesfuzzy unionoperationstocombinethoserules.inthetraditionalfuzzy logicsystem variablesareoftencontinuoussuchas temperature densityorlinguisticlike low verylow .themembershipfunctions are often manually defined by domain experts with functions 1035esec fse november8 13 virtualevent usa tam nguyen phongvu andtung nguyen such as triangular ortrapezoidal.
in fuzzycatch variables are discrete i.e.methods exceptions andthemembershipfunctionsare estimatedautomaticallyfrom millions ofcode examples.
fuzzycatchistrainedfromadatasetcontainsover13 000highly rated android apps.
we assume that fuzzycatch can learn common statisticallysignificantprogrammingpatternsfromitshuge collection of code.
also it isreasonable tobelieve that the dataset containshigh qualitycode thus betterexceptionhandlingcode becauseitcontainsappsthataredevelopedandfrequentlyupdated by top software companies e.g.
google facebook which employs the best software engineers in the world.
they are used daily by millionstobillionsofusersworldwide anyerrorsarelikelydiscoveredand reportedquickly.ourempiricalevaluationalsoconfirms that fuzzycatchcan be used effectively to detect and fix exceptionhandling bugs.
threats to validity thethreattointernalvalidityincludeserrorswhenweidentified and evaluated exception bug fixes.
firstly we might incorrectly identify bugfixes.
to reduce this threat we could apply more patterns e.g.
adding more filter keywords when identifying bug fixes fromcommits.secondly wemightincorrectlyidentifyexception bug fixes from the bug fixes.
as the evaluation process is manually carried out by three researchers there are might be errors when reporting results due to human errors.
the threat could be reduced byaddingmore people to our labellingandevaluation process.
the threat of external validity includes our selected projects for labeling exception bugsand fixes.
although we analyzed medium tolargeandroidprojects thenumberofexceptionbugsandfixes fromtheselectedprojectsmaystillbelimited.toreducethisthreat more exceptions bugs and fixes shall be collected to increase the reliability of our results.
in our evaluation other measures such as precisionandrecallshouldbeintroduced.wecouldnotcompute such measures due to the fact that we do not have negative examples in the test set i.e.
the code examples that are not needed to catchexceptions.givenapieceofcode itisimpossibletodetermine thatthecodewillneverthrowsanexception.thus wecouldnot collection these negative examples.
related work exceptionhandlingrecommendationhasbeenstudiedinseveral researches .barbosa etal.
proposedaset ofthreeheuristicstrategiesusedtorecommendexceptionhandling code.rahman etal.
proposedacontext awareapproachthat recommendsexceptionhandling codeexamples fromanumber of githubprojects.filho etal.
proposedarcatch anarchitectural conformancecheckingsolutiontodealwiththeexceptionhandling designerosion.lieetal.
proposedanapproach namedexpsol which recommends online threads as solutions for a newly reportedexception relatedbug.kistneretal.
builtatoolthat reveals possible sources of exceptions in the code.
this tool also provides project specific recommendations and detects common bad exception handling practices.
montenegro et al.
proposed an exceptionpolicyexpert toolwhichalertsdevelopersaboutpolicy violations and can suggest possible handlers for the exceptions.li et al.
devised a methodthat automatically recommends exception handling strategies based on program context.
to the best of our knowledge fuzzycatch is the first code recommendation toolavailablethatactuallyrecommendsandgeneratesexception catchingandhandling code as aplugin of ides.
thereexistseveralmethodsforminingexception handlingrules.
wn miner andcar miner areapproachesthatuseassociationminingtechniquestomineassociationrulesbetweenmethod callsoftryandcatchblocksinexceptionhandlingcode.bothmodelsareusedtodetectbugsrelatedtoexceptions.zhong etal.
proposed an approach named mimo that mines repair models for exception related bugs.
approaches based on association rule mining mines only most frequent rules i.e.
rules that satisfy certain supportandconfidence.thus rulesinvolvingrareexceptionsor methods with lower support and confidence are undiscoverable.
fuzzycatch also aims to mine programming patterns for exception handling.
however fuzzycatch represents those patterns using fuzzysetsandcombinesthemusingfuzzylogic makingithighly robust and scalable.
for example fuzzycatch can learn fuzzy logic rulesforraremethods showninsection3.
andmineaverylarge code repository for patterns.
exception handling has been studied extensively in software engineeringresearch .wemention hereseveralnotablestudies.sena etal.
presentsanempirical studytoinvestigatetheexceptionhandlingstrategiesadoptedby javalibraries.ebert etal.
presentedanexploratorystudyon exception handling bugs by surveying of developers and an analysisof220exceptionhandlingbugsfromtwojavaprograms eclipse and tomcat.
similarly nguyen et al.
performed an empiricalstudyonnearly300exception relatedbugsandfixesfrom10 mobile apps.
coelho et al.
performed a detailed empirical study onexception relatedissuesofover6 000javaexceptionstacktraces extracted from over open source android projects.
padua et al.
studiedexceptionhandlingpracticeswithexceptionflow analysis.kechagia etal.
investigatedtheexceptionhandling mechanismsofthe android apis.
there are several researches focus on the global impact of exceptions .robillard etal.
studiedthecurrentjava exception handling mechanism.
they argued that exceptions are a globaldesignproblem andexceptionssourcearedifficulttopredict in advance.
cacho et al.
presented an aspect oriented model for exception handling.
different from these approaches fuzzycatchfocusesonhandlingexceptions locally byrecommending programmers to add try catch blocksandhandling actions.
conclusions exceptionsareunexpectederrorsoccurringwhileanapplication isrunning.learningtohandleexceptionscorrectlyisoftenchallenging due to the fast changing nature of api libraries and frameworks andtheinsufficiencyofapidocumentation.weproposetwo techniques based on fuzzy logic for learning and recommending exception types and repairing actions for exception handling code.
based on the proposed techniques we have developed fuzzycatch acoderecommendationtoolforexceptionhandling.ourevaluation shows that fuzzycatch can effectively learn exception handling patterns andprovidehighly accuraterecommendations.
1036code recommendation forexceptionhandling esec fse november8 13 virtualevent usa