demystifying the composition and code reuse in solidity smart contracts kairansun nanyangtechnologicaluniversity singapore singapore sunk0013 e.ntu.edu.sgzhengzixu nanyangtechnologicaluniversity singapore singapore zhengzi.xu ntu.edu.sgchengweiliu nanyangtechnologicaluniversity singapore singapore chengwei001 e.ntu.edu.sg kaixuanli eastchina normaluniversity shanghai china kaixuanli stu.ecnu.edu.cnyang liu nanyangtechnologicaluniversity singapore singapore yangliu ntu.edu.sg abstract as the development of solidity smart contracts has increased in popularity the reliance on external sources such as third party packages increases to reduce development costs.
however despite the use of external sources bringing f lexibility and efficiency to the development they could also complicate the process of assuring the security of downstream applications due to the lack of package managers for standardized ways and sources.
while previous studies have only focused on code clones without considering how the externalcomponentsareintroduced thecompositionsofasmart contract andtheircharacteristics stillremain puzzling.
to f ill these gaps we conducted an empirical study with over 000soliditysmartcontractstouncovertheircompositions conductcode reuseanalysis and identifyprevalentdevelopment patterns.
our f indings indicate thata typicalsmartcontractcomprises approximately subcontracts with over of these originating fromexternalsources re f lectingthesigni f icantrelianceonthirdparty packages.
for self developedsubcontracts around50 ofthe subcontracts have less than unique functions suggesting that code reuse at the level of functions is also common.
for external subcontracts though around35 of the subcontracts are interfaces toprovidetemplatesforstandardsorprotocols aninconsistencyin theuseofsubcontracttypesisalsoidenti f ied.lastly weextracted61 frequently reused development patterns offering valuable insights forsecure andefficient smart contract development.
ccsconcepts general and reference empirical studies software and its engineering software libraries and repositories .
keywords smart contract composition code reuse development pattern zhengzixuis thecorresponding author esec fse december sanfrancisco ca usa copyright held bytheowner author s .
acm isbn979 .
referenceformat kairan sun zhengzi xu chengwei liu kaixuan li and yang liu.
.
demystifying the composition and code reuse in solidity smart contracts .inproceedingsofthe31stacmjointeuropeansoftwareengineeringconference and symposium on the foundations of software engineering esec fse december san francisco ca usa.
acm new york ny usa 12pages.
introduction smart contracts are a special type of program built on top of blockchain technology to automate verify and enforce the negotiationofagreementsbetweenparties.thedevelopmentofsmart contractshasgainedsigni f icanttractioninrecentyearsasithasthe potential to revolutionize a wide range of industries such as f inancialservices supplychainmanagement andtheinternetofthings iot .
to lighten the development of smart contracts solidity hasbeenproposedandwidelyusedastheprimarylanguage inmainstreamblockchainplatforms.forinstance ethereum as oneofthemostpopularopen sourceblockchainplatforms hasembracedthediverseecosystemofdecentralizedapplications dapps by usingsolidity smart contracts.
however asthecomplexityofdappsgrows thedevelopmentof smartcontracts i.e.
smart contractsinthispaperhere andbelow refer to solidity smart contracts is increasingly relying on wellestablished subcontracts i.e.
contract level code blocks as detailed insection from thirdpartiestoavoidre inventingwheelsand reduce development efforts.
while the reuse of third party subcontracts also poses a new threat that like supply chain attacks in traditionalweb2ecosystems vulnerabilitiesand f lawsfromthirdparty contracts could further collapse downstream applications especially in the context of early staged smart contract development that lacks mature dependency management solutions.
as reportedinfeb twocriticalvulnerabilitiesin the subcontracts provided by multichain affected user addresses and a total of over million dollars were exploited.
in this case disclosing the potential security risks hidden in reused third party subcontracts in time is vitaltothe assurance ofweb3security.
nevertheless the diverse and f lexible third party subcontract reuse makes it non trivial to precisely manage third party subcontracts introduced during smart contract development.
although mostcommonlyusedthird partysubcontractsarereleasedinthe format of npm packages and they can be introduced by npm this work is licensed under a creative commons attributionnoncommercial .
internationallicense.
esec fse december3 san francisco ca usa kairansun zhengzixu chengweiliu kaixuanli andyang liu dependencies therearestillvariouswaysandpracticestoreuseexisting third party subcontracts i.e.
simply declaring dependencies by urls from github repos ipfs gateways swarm gateway etc.
.despitetheconvenience suchdiversityand f lexibility also complicate the security assurance of downstream applications since the urls could be untrustworthy.
moreover though npm offersversionmanagementofdependencies itischallengingtotrace theversionsoftheimportedsubcontracts especiallyafteron chain.
thismakesitdifficulttoderivestandardizedsolutionstoidentify manage and remediate known vulnerabilities existing in dependencieslikewhatsoftwarecompositionanalysistools doto web2applications.inadditiontoexternalimports manydevelopersalsotendtodirectlyclonetheexistingsubcontractsintotheir contractsforconvenience.asrevealedbypierroetal .
of smart contracts contain duplicated code.
such code clones further challenge the managementofreusedthird partysubcontracts.
tounveilthemysteriesinthedevelopmentofsmartcontracts variousexploratorystudieshavebeenconducted.someresearchers investigated the characteristics of existing smart contracts such as thedesignpatterns andsourcecodecomplexity ofdifferent kindsofsmartcontracts whilesomeresearchers studied the code reuse of smart contracts at different granularity including contracts subcontracts and functions.
however most existing works only focused on a single granularity of smart contracts such as subcontracts or functions neglecting how these elements are introduced during development.
this may limit the understanding ofsmartcontractsandleadtoincompleteorinaccurateconclusions aboutsmartcontracts.thelackofexplorationinsuchcompositions alsocompromisesthederivedguidanceonfurthermanagementand governanceofthereuseofsmartcontractsacrosstheecosystem.
to f illthesegaps weconductedanempiricalstudytoinvestigate thereuseofthesubcontractsfromtheperspectiveofcontractdecomposition onthe ethereumblockchains.
theoverallframeworkofthisstudyisillustratedinfigure .we f irst collected over smart contracts deployed between january2021andjanuary2023frometherscan aleadingblockchain explorerandanalyticplatformforethereum.additionally toenhanceourunderstandingoftheexistingthird partypackagesfor smart contract development and expand our dataset further for subsequentcodereuseanalysis alistof353third partypackages fromnpm andgithub reposwascompiledfromtheimport statementsofthecollectedcontracts.toensuretherobustnessof oursubsequentcodereuseanalysis we f irstvalidatedthecontracts and parsed them into json f iles with antlr .
we then examined and f iltered out contracts with no or slight modi f ication by conducting a contract level code clone detection.
after this process distinct contracts are sorted out for further studies.
our empirical study offers a comprehensive view of contract composition and code reuse practices considering the regulations to introduce external components.
speci f ically we f irst decompose contracts into various subcontracts based on their origins and how they were introduced into the contracts.
this allows us to separate self developedandexternalsubcontractsforin depthcodereuse analysis.
for self developed subcontracts we examine functionlevel code reuse summarizing the commonly reused functions and functions required to be self de f ined.
for external subcontracts westudytheusageoffrequentlyreusedsubcontractsandclones source code data sources data preparation imports githubnpm identify similar contracts extract patterns rq4 development patternsdetect code clones reuse analysisrq2 analysis of self developed subcontracts rq3 analysis of external subcontracts decompose contracts identify sourcerq1 contract decomposition code processing figure frameworkofthe study acrossthird partypackages.lastly basedonthiscomprehension weextractandanalyzethefrequentlyreuseddevelopmentpatterns.
throughout the empirical study we concluded some f indings asfollows.
forexample 1more than80 of thesubcontractsare from external sources.
the largest identi f ied external source is npm accountingforover72 ofthetotalexternalsubcontracts.
despite the fact that solidity allows to include npm dependencies byspecifyingtherequiredsubcontractwiththepackagenamein importstatements over56 oftheclonedsubcontractsaresourced fromnpmpackages indicatingamessindependencymanagement.
3the code reuse of functions is common since around of selfdevelopedsubcontractshavelessthan10 uniquefunctions.asthe number of functions increases in a self developed subcontract the percentageofuniquefunctionstendstodecrease.thishighlights thetendencyofdeveloperstorelyonpre existingcodeblockswhen developing smart contracts.
4though around of the external subcontracts are interfaces commonly usedas protocol templates weidenti f iedaninconsistencyintheuseofsubcontracttypeswhich presents challenges in contract management.
5we identi f ied prevalent development patterns .
of which are for token creations.whilethesepatternscouldgreatly reducedevelopment costs it would be risky if a vulnerability or security exploit was found in the patterns.
hence management in such patterns to continuously monitor andassesstheir security isimportant.
inconclusion themaincontributionsofthisstudyareasfollows.
we provide a thorough analysis of common approaches to introducing subcontracts in smart contracts with a further code reuse analysis to identify the most frequently reused code blocksandtheir purpose.
we conduct a comprehensive study of identi f ied thirdparty packages for smart contract development analyzing theirusage frequency andfunctional properties.
we summarize and assess frequently used development patterns for smart contracts which could be potentially used inlow code development.
based on our results and f indings we provide an in depth discussion regarding the challenges in managing external componentsanddevelopmentpatterns for smart contracts.
background in this section we provide explanations and de f initions of terminologiesthat have been usedinthis study.
797demystifyingthe compositionandcode reuse in soliditysmartcontracts esec fse december3 san francisco ca usa smartcontractandsubcontract.
inthisstudy asmartcontract refers to code blocks sharing the same address while a subcontract refers to a contract level code block.
according to solidity documentation four typesof subcontracts have been de f ined basedonthe waythey are used interface subcontracts to de f ine a standard or protocol withoutmethodsimplementations.
abstract subcontracts tode f ine abasic structurewith some methodsimplementations.
contract complete andexecutablesubcontracts.
library subcontracts to provide reusable code blocks for common operations withoutstorage.
toclarifythisfurther inourstudy subcontractreferstointerfaces abstract contracts contracts and libraries as detailed above.
thisservestodistinguishbetweenmodularizedcontract levelcode blocks subcontracts and the composite code eventually deployed on the blockchain contract .
essentially these subcontracts can be combinedto form acomplete contract ready for deployment.
ethereum andetherscan .ethereumisanopen source blockchainplatformsupportingdecentralizedapplicationsthrough smart contracts.
for our study we selectedtwonetworks ethereummainnet themainblockchainnetworkforethereum blockchaininvolving real transactions.
goerlitestnet atestingnetworkforethereumblockchain to be usedfor smart contract testinganddeveloping.
etherscan is a blockchain explorer for the ethereum blockchain toprovidedetailedinformationonblocksincludingtransactions addresses andthe sourcecode ofsmart contracts if available.
eips.eips ethereum improvement proposals are formal proposals for the ethereum network that help to document the standardized protocols with possible implementations in a wellorganized format.
as eips are audited and expected to be safe to reuse weincludedeipsasabasicapproachtoevaluatingthesafety ofsmartcontracts third partypackages anddevelopmentpatterns.
clonetypes.
fourclonetypescategorizecodeclonesinsoftware systems .in our study we focus on type clones which are syntactically identical codes with different identi f iers or literals and use type clones exact code copies differing only in whitespace or comments for validation.
we exclude type and type whichconcentrateonmajorchangesandsemanticparallels.whilesmartcontractsarerelativelysimpleandstandardized type and type clones may introduce a signi f icant amount of false similarities affecting the overallaccuracyofthe result.
empiricalstudy .
research questions the structure of our research questions is presented in figure .
to explore contract compositions and common development practices with considerations of dependency introduction we f irst decomposecontractsintosubcontracts identifyingtheiroriginsandintroductionmethods.wethenconductin depthcodereuseanalyseson subcontractsfromvarioussourcesseparately i.e.
self developed or external providing insights into their individual characteristics.
lastly withabetterunderstandingofthecompositionsofcontracts andcodereuse weextractedfrequentlyuseddevelopmentpatterns.
......solidity smart contracts external sourcesselfdeveloped subcontracts code reuse analysis development patterns rq4 rq3 rq2decomposition rq1 figure relation between research questions .
.
contractclonedecomposition rq1 whatarethecommon approachestointroducingsubcontractsintosmartcontractsandtheir sources?identifying contract compositions and quantifying the use of various approaches to introducing subcontracts.
the results obtained from the exploration serve as the fundamental for the subsequent analysis.
.
.
analysis of self developed subcontracts rq2 what are the characteristics of self developed subcontracts?
understanding the characteristicsandextentofcodereuseinself developedsubcontracts can highlight common areas of customization thereby informingtailoreddevelopmentpractices andtooling.
.
.
analysisofexternalsubcontracts rq3 whatarethecharacteristicsofexternalsubcontracts?
analyzingthecharacteristics andcommonapplicationsoftopreusedexternalsubcontractsand third partypackagestoaidinbettercontractdevelopmentguidance andthird partypackage management.
.
.
development pa t terns rq4 what are the commonly used developmentpa t ternsinsmartcontractdevelopment?
extractingand analyzingfrequentlyreuseddevelopmentpatternsinsmartcontract development which re f lects common usage and safety practices thusinformingbestpracticesandpotentiallyin f luencingthedesign ofsafer smart contract developmentframeworks.
.
datasetpreparation anoverviewofourdatapreparationprocessispresentedinfigure .
wecollectsmartcontractsourcecodefrometherscan npm andgithubrepos .tonormalizeandtransferthecollectedcode into a suitable format for the subsequent analysis we also conduct aseries ofdata preprocessing before our analysis.
.
.
contract collection.
for our empirical study we f irst collectedthesourcecodeof221 309deployedsmartcontractsonthe ethereummainnetand131 207contractsonthegoerlitestnet from etherscan .
to extend our dataset and better trace subcontractorigins wethencollectedthesourcecodeofthird party packages for smart contract development the list of which was compiled by performing a syntax based extraction to the import statements from the primary dataset.
in the end we managed to identifytheuseof337npmpackagesand33githubrepositories that are usedinsmart contract development.
.
.
contractpreprocessing.
aftercollectingthesourcecodeof smart contracts the following three steps are taken in sequence to processthe contracts for the subsequent experiments.
798esec fse december3 san francisco ca usa kairansun zhengzixu chengweiliu kaixuanli andyang liu source code validation imports contract collection contract data extractionduplicated data removal contract preprocessing tokenize normalize md5 hash figure overview ofdata preparation source code validation.
as our primary contract collection is frometherscan anopenplatformwhereuserscanuploadsource code weconducted atwo stagevalidationtoensure theintegrity andcompletenessofthedataset.first wecon f irmthecontractsare stored in a single f ile with all required meta details i.e.
address contactname andcreationdate .second weverifyeachcontract is non empty by inspecting the content within the outermost curly bracketsofeachsubcontract.afterthevalidation approximately ofthecontractsare f ilteredout comprisingaround6 241onthe ethereummainnetand2 onthe goerlitestnet.
contractdataextraction.
toensureanaccessiblerepresentation of contract data for further analysis we developed a parser for solidity smart contracts using antlr4 .
theparser f irst converts smartcontractsintotokenstreams extractingtwotypesofinformation for each token its original text and its token type identi f ier.
we then extract code blocks such as subcontracts and functions from thecontract andcomputethe md5hashfor eachblockafter type 2normalization i.e.
removewhitespacesandcomments and renamevariables tofacilitatefurtheranalysis.afterthis eachcontractwillbesavedasajson f ilecontainingalltheextractedand computedinformationasdepictedinfigure .anexampleofthe complete output f ile can be foundonour website .
duplicated contract removal.
the aim of this study is to determinethe commonpracticesinsmartcontractdevelopment.however having multiplecopiesoftheduplicatedcontractswithonly minorchangesornochangesmayskewtheresults.toaddressthis we grouped contracts based on their contract level md5 hashes aftertype 2normalization.this ensures that contracts withinthe samegroupcanonlyhaveminordifferencessuchasvariablenames.
as a result groups were identi f ied to have more than one contract.
we then conducted a manual inspection for the groups andcon f irmedthat90.
arecreatedbythesameteamsasdetailed in section .
.
hence to avoid the overrepresentation of similar contracts and enhance the diversity of our datasets we decided to retain only the earliestversionofeachcontract group.
intheend wekept189 229distinctcontractentriesforethereum mainnet and entries for goerli testnet.
the processed data were savedto adatabasefor use inlatercode reuse analysis.
.
contract clonedecomposition rq1 .
.
experimentssetup.
togaininsightsintothecompositionsof contractsandcommonpracticesindevelopment wecommenced our study by assessing contract level code clones and quantifying the various approachesto introducing subcontractsinto contracts.
this lays the foundationfor the subsequent analysis.initially for the contract level clone analysis we examined the duplicated contract groups identi f ied during data preprocessing as detailed insection .
.
.
ateam of three smart contract auditors conducted a manual inspection on a randomly selected sample with groups.
the sample size was determined by cochran s equation togetherwithapopulationcorrection .during the inspection each auditor independently evaluated the reason behindduplication.collective discussions were thenheld untilan agreement wasreachedincaseswhere initialopinionsvaried.
upon obtaining a comprehensive understanding of contract clones we directed our focus toward compositions of contracts.
recognizingthatetherscan includesexternallyimportedsubcontractsin thepublishedcontractsource code weintegratedthe approaches to introducingexternal subcontractsinto our analysis.
upon identifying subcontract clones based on the pre computed md5hashes wecategorizedthembytheirintroductionapproaches quanti f ied the prevalences of these approaches and traced the originsofexternally introducedsubcontracts.
.
.
results and discussion.
our f indings for contract and subcontractclonesaredetailedseparatelyinthefollowingsubsections.
analysisofcontractclones.
thecontractcloneratioinethereum mainnet and goerli testnet accounts for .
and .
respectively.
out of these a total of contract groups in ethereum mainnetwereidenti f iedasduplicatesduringthedatapreprocessing stage i.e.
contractswithineachgrouphavethesamemd5hash .
upon conducting a manual inspection of the sample groups we discovered that about .
of these groups are caused by version iterations while .
are linked to the use of generators.
the rest groupsalsoseemtofollowprede f inedtemplates however theexact reasonbehindthisstillremainsunclearduetothelackofexplicit statementsoravailableonlinedocumentation.ontheotherhand .
of the groups consist of contracts deployed by the same teamorindividuals.thiswasveri f iedbyinvestigatingtherecord of the author in the source code and the details of the contract creatoronetherscan .asaresultoftheinspections wecould con f irmthattheidenti f iedgroupsdonotcontributetothediversity ofcontractdevelopment hence itisacceptabletobeexcludedfrom our analysisto avoid an overrepresentation of similar contracts.
to gain more insights into the patterns and characteristics of contract cloning we analyzed the distribution of group size.
despitethehighvolumeofidenti f iedgroups only2groupscontain over contracts with mere groups exceeding contracts.
this indicates that high volume duplications are uncommon in the dataset.
in fact such extensive duplications are mostly linked to theuseoftokengenerators.forinstance the2groupswithmore than1 000contractsareboththeproductsoftokengenerators.the largestgroupwithasizeof2 849isgeneratedbytheerc1155tokencreatorpublishedbymanifoldxyz whilethesecondlargest group with a size of is due to the use of the erc20 token generatorpublishedby .apartfromthat wenoticedtheexistence of a type of contract that is created and executed on demand with only minor changes.
an example of this contract type is locketherpay which is a token lock thatonly changes the address of the bene f iciary per deployment which is discussed by kondo et al.
.ontheotherendofthespectrum weobservedthatgroups dueto versioniterations usually have fewer than5contracts.
799demystifyingthe compositionandcode reuse in soliditysmartcontracts esec fse december3 san francisco ca usa table average percentage of subcontracts that in introduced usingvarious approaches self developed imported cloned ethereummainnet .
.
.
goerli testnet .
.
.
moreover wealsoquanti f iedthepurposeofthegroupsofcontracts during the inspection.
over of the groups are for tokens withvariousfunctionalities.speci f ically .
ofthegroupsare for erc20 tokens and .
of the groups are for erc721 tokens.
finding1 among the7 617groups ofduplicated contracts over of the groups are related to tokens with erc20 tokens making up .
of the groups.
large scale contract duplicationsusuallycomefromusinggenerators.additionally .
consist ofcontracts createdbythe same team.
analysisofsubcontractclones.
asmartcontractincludesaround subcontracts on average.
these subcontracts can be classi f ied into three categories based on how they are introduced to a contract 1imported subcontract.
a subcontract that is introduced byanimportstatementreferringtoanexternalsourcesuchasan npm package or a url.
2cloned subcontract.
a subcontract that is copied from another external source including earlier deployedsmartcontractsandthird partypackageswithoutanimport statement referring to the source.
3self developed subcontract.
a subcontract that is neither imported nor cloned from external sources including earlier deployed smart contracts and third party packages.
among the three categories 1and2are considered externalsubcontracts.inourcase we f irstcon f irmedimportedsubcontracts in each contract by checking its import statements.
next weconductedasubcontract levelcodeclonedetectiontoidentify clonedsubcontracts.intheend weclassi f iedthosenotimported orclonedas self developedsubcontracts.
to better understand the compositions of contracts we then determinedtheaveragedistributionoftheaforementionedthreetypes of subcontracts within smart contracts for both ethereum mainnet andgoerlitestnet asshownintable .theresultindicatesthat cloningisthemostprevalentapproachtointroducesubcontractsin smart contract development especially for contracts on ethereum mainnet where60.
ofthesubcontractsarecloned.additionally fewer than of the subcontracts are classi f ied as self developed which suggests that the current development of smart contracts heavily relies on external solutions.
though the use of external solutionshelpstoreducedevelopmentcostsandimprovecodequality it may also introduce potential security risks and make it harder to maintain the code inthe longrun.
furthermore we managed to tracethe origins of some external subcontracts introduced via different approaches.
for imported subcontracts we focused on the two types of import statements to introducesubcontractsfromexternalsourcesasdocumentedin 1import from npm packages using import statement followed by thenameofthenpmpackage 2importfromurlsusingimport statement followed by a url such as github ipfs gateway and swarm gateway .
in our dataset we only discovered the useofurlsreferringtogithubreposwhichaccountsfor0.
imported subcontracts .
deployed smart contractscloned subcontracts .
self developed subcontracts .
from unknown sources third party packagesnpm github...based on how introducedidentified from on chain contracts third party subcontracts figure decomposition ofdeployed smart contracts of imported subcontracts indicating an imbalance in the use of the two types of import statements in smart contract development.
infact about51 oftheidenti f iedgithubreposhavepublished npmpackages.thissuggeststhatnpmactsasthepackagemanager for most third party packages in smart contract development.
however npm isnot optimizedfor managingsoliditylibrariesor dependencies.for example 1lackofversioninganddeployment management.
npm does not help with the versioning of subcontracts and deployment of smart contracts in various environments.
importantinformationsuchastheversionofimportedsubcontracts may be lost after the contract is published online as the log f ile generatedbynpmtorecordsuchinformationwillnotbepublished together.
2lackofsecurity.npmdoesnotprovidenecessarysecurity measures for managing solidity libraries which is crucial for smart contracts to ensure the reliability of on chain informationsuchasthe integrityof dappsand the protectionof valuable assets.
3lackofcompatibility.npmwasoriginallydesignedfor managing libraries andas a result it does not directly compatible withethereum.tousenpmpackagesinsoliditysmartcontracts extra steps are needed such as specifying the path of the imported subcontract within the npm package inthe import statement.
whileforclonedsubcontracts wediscoveredthatover56 of theclonedsubcontractsaresourcedfromthird partypackagesin bothethereummainnetandgoerlitestnet.thisindicatesacommon practice of reusing subcontracts from third party packages by cloning instead of using import statements.
in the view of developers somepossiblereasonsforthiscouldbe 1lackofawareness.
developers may lack awareness or familiarity withavailable package management tools.
2lack of trust.
developers may lack trust in existing package management tools for smart contract development hence prefer to copy and paste directly from their reliable sources.
2user unfriendly.developersmay f inditdifficulttoidentifythepathofasubcontractwithinathird partypackagewhich is needed by the import statements in solidity.
3need for customization.
developers may want to make modi f ications to the subcontract whichisnot allowedbyusing import statements.
finding we summarized the composition of smart contracts in figure .
smart contracts often consist of three types of subcontracts cloned .
imported .
and selfdeveloped .
.
however over of the cloned subcontractscanbeimportedfromthird partypackages.additionally we found that npm contains most third party packages for smart contract development though its use isnot optimized.
800esec fse december3 san francisco ca usa kairansun zhengzixu chengweiliu kaixuanli andyang liu table topreused externalsubcontracts known source unknown source ethereummainnet goerli testnet ethereummainnet goerli testnet rank name kind name kind name kind name kind ierc20 interface .
context abstract .
iuniswapv2factory interface .
erc721creator contract .
context abstract .
ierc165 interface .
safemath library .
vrfcoordinatorv2interface interface .
ierc165 interface .
ierc721receiver interface .
context abstract .
erc721creator contract .
4ierc721receiver interface .
erc165 abstract .
iuniswapv2router02 interface .
ifactory interface .
erc165 abstract .
address library .
ownable contract .
safemath library .
6ierc721metadata interface .
ierc721metadata interface .
erc721creator contract .
context abstract .
strings library .
ownable abstract .
iuniswapv2router02 interface .
erc1155creator contract .
ierc721 interface .
ierc20 interface .
ownable contract .
ierc20 interface .
address library .
ierc721 interface .
safemathuint library .
contextmixin abstract .
ownable abstract .
strings library .
safemathint library .
priceconverter library .
the in the tablerepresentsthe proportionofuse ofthe subcontract out oftotalcontracts.
.
analysis ofself developed subcontracts rq2 .
.
experiments setup.
to assess code reuse in self developed subcontracts weimplementedatwo stepanalysis.first weconductedafunction levelclonedetectionwithinthesubcontractto determinetheextentofcodereuseincontractdevelopment.second wequanti f iedthepercentageofuniquefunctionsineachsubcontract providinginsightstounderstanddevelopers behaviorofcode reuse inrelation to the complexityofthe contract.
additionally to comprehend the common usage of the reused functions we quanti f ied these functions based on their functionality by identifying keywords in function names e.g.
mint and transfer the origins of functions if identi f iable and function types i.e.
function modi f ier event andconstructor .wealsoconducted casestudiesfor the mostfrequentlyreusedfunctionsto betterunderstand the trends offunction level code reuse.
.
.
results and discussion.
the result for function reuses in self developedsubcontracts ispresentedin figure 5andfigure .
analysis of function clones.
the result reveals consistent functionreusepatternsforself developedsubcontractsacrossethereum mainnetandgoerlitestnetassuggestedinfigure .approximately of the identi f ied self developed subcontracts contain less than uniquefunctions denotingthatthereuseofcodeatthelevelof functionsisalsoacommonpracticeinsmartcontractdevelopment.
despitethis whilecatalogingfunctionusagefrequencywithinselfdevelopedsubcontracts wefoundthatonly27.
and28.
of functions were reused for ethereum mainnet and goerli testnet respectively.
this indicates that the commonly reused functions tendto be concentratedonasmall setoffunctions.
furthermore inexploringthecorrelationbetweenthenumber ofuniquefunctions and thetotalfunctioncount inself developed subcontracts we found self developed subcontracts with fewer functionshaveahigherratioofuniquefunctions asdepictedinfigure6.
particularly self developed subcontracts with less than functions showed the highest unique function ratio .
.
self developed subcontracts are identi f ied to have unique functions .
of which only have one function.
however as more functions are required in self developed subcontracts the percentage of unique functions drops.
this indicates that developers tend to reuse more code blocks from external sources during development rather than writing everything from scratch when therequired functionality becomes more complicated.while such figure unique functions in self developed subcontracts forbothethereum mainnetand goerli testnet figure average percentage of unique functions with respect to the total functions in self developed subcontracts in smart contracts codereuseisusuallytomitigatepotentialvulnerabilities thesafety of external functions may not be guaranteed since only around are from well established packages.
additionally integrating these functionswithinthesubcontractcouldbechallenging especially when interactionsbetween functionsneedto be considered.
finding code reuse is a common practice at the function level especially when the required functionality is complicated.
additionally we noticed consistent reuse of a small set of functions across subcontracts re f lecting common functionalrequirements duringdevelopment.
analysisoffunctionusage.
themajorityofuniquefunctions and reused functions are standard functions.
a substantial portionofuniquefunctionsisconstructors takingaround21.
in ethereummainnetand13.
ingoerlitestnet.constructorsare a special type of function that is called during contract creation to initialize the contract and set the initial state.
this implies that the 801demystifyingthe compositionandcode reuse in soliditysmartcontracts esec fse december3 san francisco ca usa contractinitializationprocessoftenrequiredspeci f iccustomization to cater to the particularneedsofindividualsmart contracts.
on the other hand reused functions often represent commonly needed functionalities.we foundthat over of these functions aregettersandsetters whicharewidelyusedtoaccessandmodify the currentstate ofthe contract.functions relatedto mintingand transferringalso makeupa signi f icantportion ofbothreused and unique functions accounting for more than10 intotal.
in fact the balance between unique and reused functions in smart contracts appears to be a blend of custom tailored operationsandwidelyusedstandardfunctionalities.assmartcontract development continues to evolve understanding the interplay and appropriateapplicationoftheseuniqueandreusedfunctionswill be crucial inoptimizing contract efficiency andeffectiveness.
finding4 bothuniqueandreusedfunctionsareprimarily standardfunctions withconstructorsconstitutinganotable portionofuniquefunctions indicatingfrequentcustomization requirements duringcontract initialization.
.
analysis ofexternal subcontracts rq3 .
.
experiments setup.
to comprehend the signi f icance and implicationsofexternalsubcontracts whichaccountfor80 ofthe total weconductedexperimentsfromthreeaspects.
1analysis ofsubcontracttype.
tounderstandcommonusagesofexternal subcontracts wequanti f iedtheuseofthefourtypesofsubcontract thatarede f inedforvarioususage i.e.
contract abstract interface andlibrary .furthermore weexaminedtheinconsistencyinthe useofsubcontracttypes.
2analysisofsubcontractusagefrequency.
to gain insights into the trends of external subcontract utilization we ranked the subcontracts based on their frequency across ourdataset and thenconductedcasestudieswith themost reusedcontractexamples.
3overviewofthird partypackage.
to comprehend the usage of existing third party packages we analyzedpackageusagefrequencyanduncoveredpotentialcodeclones across packages by conducting a subcontract level clone detection onallrecognizedthird partypackages.
.
.
resultsanddiscussion.
wepresentour f indingsforthethree stagesinthe three subsections belowseparately.
analysisofsubcontracttype.
theusagefrequencyofthesefour typesofsubcontractsisdetailedintable .amongthefourtypesof subcontracts interfacetakesthemostpercentageinbothethereum mainnet .
and goerli testnet .
.
this is reasonable sinceinterfaceisusuallyusedasthetemplateofwell established standards e.g.
eips and protocols e.g.
uniswap .
hence the useofinterfaceoftenindicatesreusingestablishedstandardsand protocols to reduce development costs while ensuring consistency andinteroperability between contracts.
whileexaminingexternalsubcontractswiththetypeof contract whichaccountforover30 ofthetotalsubcontractsinbothnetworks we observed an inconsistent use of subcontract types.
one case study we provide in this paper is regarding safemath a utility libraryforcommonsafemathoperations.inthecontextofsmart contract development libraryrefers to a reusable code block for multiplecontractstoperformcommontaskswithoutstoragewhile contractisaself containedunitoflogictoexecuteitsownfunctionstable3 percentageofexternalsubcontractsforvarioustypes interface contract abstract library ethereummainnet .
.
.
.
goerli testnet .
.
.
.
withstorage.hence safemathisexpectedtobe de f inedas library here.
however it was incorrectly de f ined as contractin of the over de f initions.
we manually checked the subcontracts de f ined ascontractand noticed the declarations that safemmath is a library in code comments.
similarly ierc20 is meant to be an interfaceto provide the de f inition of eip20 but was de f ined as contractwithoutfunctionimplementationsinsomecontracts.in fact over ofthe identi f iedcasesinvolve the type of contract.
theseinconsistenciescouldstemfromdeveloperconfusionregarding the usage of subcontract types potentially leading to compatibility issues difficulties in maintenance and increased vulnerabilityrisks.the f lexibleusageof contracttypemaycontributeto this confusion since it can mimic the functionalities of interface abstract andlibrary.infact over93 oftheidenti f iedcasesinvolve thetypeof contract.thoughvarioustypesofsubcontractsareexpectedtohelpdeveloperstoorganizecodemoreefficientlywhile improvingthemaintainabilityandreadabilityofcodeblocks theinconsistency in the use of subcontract types brings more challenges to smart contract management.
finding5 whilethe35 ofexternalsubcontractstobe interfaceindicates a good practice to follow well established standardsandprotocols theusageofsubcontractswiththe typeofcontract accountingforanother35 ofthetotalsubcontracts reveals the inconsistency in the use of subcontract types whichbringschallengestosmartcontractmanagement.
analysis of subcontract usage frequency.
the result of topreused external subcontracts is presented in table .
here by subcontractswithknownsources werefertoimportedsubcontracts and cloned subcontracts sourced from our collected third party packages.
while subcontracts with unknown sources are cloned subcontracts with their origins not con f irmed yet.
due to the page limit we only provide the top reused subcontracts in this paper whilethe restwillbe available onour website .
the result suggests that third party subcontracts are used more frequentlycomparedto those from unknown sources particularly in goerli testnet where the most frequently reused subcontract from unknown sources only appears in .
contracts which is lowerthanthe10thmostfrequentlyreusedthird partysubcontract.
moreover thefrequentuseofierc20andierc721inthird party subcontractshighlightsthatoneofthemostpopularapplications in smart contractdevelopment is thecreation of tokens including both fungible erc20 andnon fungible erc721 tokens.
inaddition thoughsubcontractswiththetypeof contracttake around in external subcontracts as shown in table most of them are not frequently reused subcontracts.
in the top reused external subcontracts subcontracts with the types of abstractandlibrarymake up of the total while interface takes another .
this suggests a good practice in smart contract development since subcontracts with the types of interface library 802esec fse december3 san francisco ca usa kairansun zhengzixu chengweiliu kaixuanli andyang liu table topreused third partypackages import clone total ethereummainnet openzeppelin contracts .
openzeppelin contracts .
openzeppelin contracts .
openzeppelin contracts upgradeable .
aragon apps vault .
openzeppelin contracts upgradeable .
erc721a .
pancakeswap pancake swap lib .
erc721a .
hardhat .
pooltogether pooltogether contracts .
aragon apps vault .
uniswap v2 periphery .
erc721a .
pancakeswap pancake swap lib .
goerli testnet openzeppelin contracts .
openzeppelin contracts .
openzeppelin contracts .
openzeppelin contracts upgradeable .
f lair sdk contracts .
openzeppelin contracts upgradeable .
hardhat .
synthetix .
hardhat .
erc721a .
thirdweb dev contracts .
erc721a .
uniswap v3 core .
connext nxtp contracts .
uniswap v3 core .
andabstractare expected to be reused code blocks.
it is hoped that more such reusablecode blocks can be extractedor created in the futureforsafesmartcontractdevelopment.furthermore itisobserved that some subcontracts often appear together.
for instance wenoticedthatierc721andierc165alwayscomeinpairs.this is because ierc721 is an interfacefor standard non fungible token development which inherits from ierc165 to make sure compatibility between interfaces.
this suggests the potential to discover developmentpatterns for smart contracts.
finding6 subcontractsfromwell establishedthirdparties are usedmore frequentlythanthosefrom unknownsources.
the most frequently reused subcontracts are well de f ined reusable subcontracts with types of interface library andabstract makingup82 inthe top reusedsubcontracts.
overview of third party packages.
the usage frequency of the third party packages is summarized in table .
the result highlights the wide use of openzeppelin the packages for secure smart contract development.
on ethereum mainnet over of contractsintroducedsubcontractsfromopenzeppelinpackages.in fact the top reused third party subcontracts in table 2for both networks are all from openzeppelin packages.
apart from that weidenti f iedthefrequentuseoferc721a apackagethatexplores gas optimization in batch minting nfts for erc721 tokens.
the rest of the frequently reused third party packages are either for testing i.e.
hardhat ortoken exchange i.e.
uniswap .
additionally sinceathird partysubcontractcanbeeitherimported orclonedtoasmartcontract wealsoquanti f iedtheuseofthirdparty packages introduced via different approaches from where wenoticed thatcontractsinethereummainnet tendtoclonesubcontracts from openzeppelin packages instead of using import statements.apartfromthat theuseofsomeotherpackageswas highlighted.
aragon apps vault and thirdweb dev contracts are forwebapplicationswhile pancakeswap pancake swap lib isan extensionofuniswapfocusing onsafetyandgas efficiency.
during the examination of third party packages the following three types of packages were summarized 1packages followingeipsfor safesmart contractdevelopment e.g.openzeppelin 2packages to de f ine or to be used under speci f ic protocols e.g.
uniswap 3packages for utility and testing e.g.
hardhat .
in our identi f ied third party packages of packages follow eip the standards suggesting potential new features or processes for ethereum .
the rest packages are either used under speci f ic protocols .
orfor testingandutility .
.moreover to have a better idea regarding the extent of clones in third party packages we also performed a subcontract level clone detection for all identi f ied third party subcontracts through which we found subcontracts that appear in more than libraries .
of which are interface.
apart from that about of the reusedsubcontractsaresourcedfromopenzeppelin.infact around ofourcollectedpackagesareextensionsofopenzeppelin.this alsosuggeststhegreatin f luenceofopenzeppelininsmartcontract development.
while examining the rest reused subcontracts notrelatedtoopenzeppelin wediscoveredanothergroupofthirdparty packages that focus on the decentralized cryptocurrency exchange whichisnot coveredbyopenzeppelin.
as smart contract development heavily relies on openzeppelin packages itincreasestheriskofasinglepointoffailureifopenzeppelin scodeorsystemswerecompromised.infact weidenti f ied an existing dependency management problem regarding openzeppelin.
while examining openzeppelin packages we noticed an iteration in the name of the packages from openzeppelin solidity to openzeppelin contracts .bothpackagenamesarestillinuseincurrentdevelopment thoughtheylinktothesamepackage.moreover while openzeppelin contracts is the current official name and has been widely used the name appearing in the package lock.json f ile generated bynpm is still openzeppelin solidity .
this may result in amissinvulnerabilitydetectionsifthevulnerabilitydetectionis conducted based on the package lock.json f ile.
apart from that the prevalenceofopenzeppelinindicatestheneedforwell established subcontracts to buildsecure andreliable smart contracts.
finding7 openzeppelin hasa greatin f luence onthirdparty subcontracts in smart contract development.
around oftheimportedthird partysubcontractsaresourcedfrom openzeppelin andaround36 ofouridenti f iedthird party packagesareextensionsofopenzeppelin.thiscouldberisky if an openzeppelin relatedvulnerabilityisreported.
.
developmentpatterns rq4 .
.
experimentssetup.
inspiredbythe f indingsofcommonpractices in smart contract development we further examined the existenceofdevelopmentpatternsinourdatasetwithfrequentitemset fp mining awell establishedtechniqueindatamining.
speci f ically eachcontractisrepresentedbythepre computedmd5 hashesofitssubcontracts servingasfpmininginputtoidentify subcontract setsthat frequently appear together.
tovalidatetheobtainedsubcontractsets amanualinspection is conducted with three smart contract auditors.
each auditor f irst 803demystifyingthe compositionandcode reuse in soliditysmartcontracts esec fse december3 san francisco ca usa table extracted development patterns rank patterndetails protocols context problem solution frequencyday range 1ierc721metadata erc165 ierc721receiver ierc721 strings address contexteip721 eip165token creationstandard token tobeowned and tradedusethe erc721standard with the metadataand receiver interfacesforrich metadataand secure receivingfunctionality63 .
days 2iuniswapv2router02 iuniswapv2factory ierc20 context ownableeip20 uniswaptoken swap need tocontrolownershipsuseuniswap v2 sinterfaceswith the ownable contract forpermissions62 .
days 3ierc721enumerable ierc721metadata erc165 ierc721receiver ierc721 strings address contexteip721 eip165token creationneed toenumerateall owned tokensusethe erc721enumerable extension toallowfor token enumeration53 .
days 4iuniswapv2pair iuniswapv2router02 iuniswapv2factory ierc20 context ownableeip20 uniswaptoken swapneedtointeractwithaspeci f icpair of tokenswithownershipcontrolsuse uniswap v2 s pair and factory interfaces with the ownable contract forpermissions14 .
days 5address safemath ierc20 context ownable eip20 token creationneed forsafemath operationsand ownershipcontrolsuse the safemath library for safe arithmetic operations and the ownable contract forpermissions14 .
days 6storageslot proxy address eip1967 proxycontractneed toupgrade contracts with storingthe currentstateusethe proxypatternalongwith storageslot for preservingthe contract s state during upgrades13 .
days 7erc721creator storageslot proxy address eip721 proxycontractneed toupgrade erc721token withstoringthe currentstateuseerc721creatorforcreating tokensand the proxy patternwithstorageslot forupgradability12 .
days 8reentrancyguard ierc721metadata erc165 ierc721receiver ierc721 strings address contexteip721 eip165token creation preventreentrancyattackusethe reentrancyguard contract toprevent reentrancyattack8 .
days 9merkleproof ierc721metadata erc165 ierc721receiver ierc721 address contexteip721 eip165token creation need tocreate and validateproofsusethe merkleproof contract tocreate and validate proofs4 .
days independentlyevaluatesifthesesubcontractsetscanbeconsidered as patterns.
disagreements are revisited via group discussion and auditors can alter their decision once post discussion.
we then collate the results identifying development patterns following the rulethatthemajoritywins.wefurthervalidatethepatternswith frequencyanddaterange.frequencyquanti f ies theappearanceof apatternwhiledaterangerepresentsthetimespanfromthe f irst to the last appearance of a pattern.
these provide insights into the prevalence andlongevity ofpatterns incontract development.
.
.
resultsanddiscussion.
we f inallyidenti f ied61development patterns 6ofwhichappeared over10 timesand anadditional appeared more than times in our dataset.
the top development patterns are presented in table 5while the full list of identi f iedpatterns isavailable onour website .
among the identi f ied patterns over are related to standard tokencreation speci f ically involvingerc721 tokens.for example the 3rd pattern is to create enumerable tokens the 8th is to preventreentrancyattacks oneofthemostcommonattacksfor smart contracts and the 9th is to create and validate proofs.
other patternsarerelatedtoproxycontractsandtokenswaps accounting for20.
and10.
respectively.theappearanceofpatternssuggests that the creation of tokens token swaps and proxy contracts havebeenhighlystandardized re f lectingthecommonfunctional requirements andarchitectural paradigmindevelopment.
examples of contract addresses for each pattern can be found on our website to help understand the application of patterns inreal worlddevelopment.forexample thesecondpatternisto facilitate theerc20 token swap via theuniswap v2 protocol .
toutilizethispattern anadditionalcustomizedsubcontractisoften requiredtode f inetokendetails.anexampleisshowninlisting in which the token name symbol and other relevant information are de f ined.infact thiscanbehandledbylow codedevelopmenteasily.
sincethiscustomizedsubcontractusuallyfollowsasimilarpattern user extractedinformationcanbeintegratedintoatemplateand mergedtogetherwiththe pre de f inedpattern.
additionally we also conducted the same analysis in smart contracts from goerli testnet.
apart from the already identi f ied developmentpatternsinethereummainnet goerlitestnetcontains developmentpatternssourcedfromonlinetutorials.forexample is a template for simple storage provided by an online course which appears over times in our dataset.
while using patterns can improve code quality andmitigate potential vulnerabilities it iscrucial to ensure the safetyof the patterns.
1pragma solidity .
.
2contract thepathless iscontext ierc20 ownable usingsafemath foruint256 string private constant name the pathless string private constant symbol pathless ...... constructor rowned rtotal iuniswapv2router02 uniswapv2router iuniswapv2router02 x7a250d5630b4cf539739df2c5dacb4c659f2488d uniswapv2router uniswapv2router uniswapv2pair iuniswapv2factory uniswapv2router.
factory .createpair address this uniswapv2router.weth isexcludedfromfee true isexcludedfromfee true isexcludedfromfee true isexcludedfromfee true emittransfer address msgsender ttotal main body listing an application example for rank pattern intable during our inspections the patterns we identi f ied are generallysecuredsincemostsubcontractsarefromauditedthird party packages such as openzeppelin and uniswap .
in addition most identi f ied patterns follow eips which helpsto enhance their security interoperability and compliance with community standards.
however the requirement of customization for many of the patterns could potentiallyintroduce risksif not properly handled.
finding we identi f ied development patterns.
speci f ically token creation proxy contracts and token swaps make up .
.
and .
of the identi f ied patterns signifyinghigh standardizationintheseareas.
implicationsand lessons .
result summary unlikeexistingworksignoringthecommonpracticesofreusingexternalsubcontracts inthisstudy weinvestigatecodereuseinsmart contracts with considerations of dependency management.
first 804esec fse december3 san francisco ca usa kairansun zhengzixu chengweiliu kaixuanli andyang liu we statistically con f irmed the high ratio of reusing external subcontracts .
aligningwithpreviousworks .however after investigating their introduction approaches we notice that .
ofsubcontracts were introducedby importsinstead ofsimple code clones.
next we divided subcontracts into self developed .
andexternalonesforfurthercodereuseanalysis.forinstance weobservetherelianceonfunctionreuseincreaseswhen thenumberoffunctionsinself developedsubcontractsgrows.in addition over35 oftheexternalsubcontractsare interface indicatingatrendtowardadheringtoestablishedstandardsandprotocols.
yet subcontracttypesaresometimesmisused posingchallengesin codemanagement.moreover openzeppelinin f luencesaround90 oftheimportedexternalsubcontracts highlightingitsprominent role in contract development.
lastly we identi f ied development patterns fortoken creation .
proxycontracts .
and token swaps .
re f lecting areas withhigh standardization.
.
lessonslearned inthissection wesummarizethediscoveredchallengesinsmart contract developmentandproposedpossible solutions.
forcontractdevelopers.
1thoughvariousapproachesareavailable to introduce external subcontracts as discussed in section .
we suggest avoiding usingurls to import externalsubcontracts unless the url has been thoroughly veri f ied and audited for security development.
this is to avoid introducing untrustworthy codeblocks intocontracts due to maliciousurls or compromised subcontracts.
2as discussed in section .
over subcontracts are introduced externally in smart contracts.
however the documentation of such usage often misses especially after on chains.
this brings challenges in the management of external subcontracts andmorecritically intheidenti f icationandmitigationofvulnerabilities in external subcontracts.
hence we would recommend includingbasicinformationabouteachsubcontractsuchastheir origins and versions if available in the published source code.
this practice would help with code maintenance and management of dependency downstream.
3the inconsistent use of subcontract types pointed out in section .5may further complicate code organization and management instead indicating a need for enhanced standardizationincontract development.
for third party auditors.
1considering the high code reuse ratio .
highlightedinsection .
itmayhelptoboostthe efficiencyofauditsbyestablishingastandardizedknowledge based vulnerabilitydatabase thatcan be accessed and contributed byevery auditor especially for frequently reused components.
once the database is established the relevant information for external componentscanbeidenti f iedbycodeclonedetection avoidingrepeated audits on the same components.
2given the heavy reliance on external subcontracts especially those from well established third partiesasmentionedinsection .
itisimportanttoregularlyaudit thepackagestoensuretheirsecurityandreliability.moreover thirdparty packages are not used as a whole in contract development instead developers only import required subcontracts.
hence it is important to link identi f ied vulnerabilities to speci f ic subcontracts or functions instead of packages.
3though there are auditions done with the published packages with speci f ic smart contract applications we do not see any auditions with the frequently useddevelopment patterns as identi f ied in section .
.
however it is importanttocontinuouslymonitorandmanagesuchpatternsto make sure safety maintainability andreliability.
forthecommunity.
whilemostthird partypackages aremanagedundernpmasdetailedinsection .
itwouldbegoodtohave aspecialized packagemanager forsmart contractdevelopment to bettermanage the dependenciesofsmartcontractsduring development and after deployment.
asa specialized package manager for soliditysmartcontracts itwouldbegoodtohave 1automated security analysis.
the package manager should continuously accessthesecurityanduseofthethird partypackages.
2package versioning.
the package manager should have a robust versioning system to keep track of the updates and changes in smart contract packages.
3easyintegration.thepackagemanagershouldbeeasy to integrate with popular development tools and environments to make smart contract development smoother.
4package deployment.thepackagemanagerisexpectedtocontinuouslymonitor andmanagetheusedthird partysubcontractsevenafterdeployment.additionally consideringthedominanceofopenzeppelin packages identi f ied in section .
it would be bene f icial to encourageandsupportthedevelopmentofalternativeandsecurepackages to providemore optionsfor smart contract developers.
.
futureresearch directions our f indings suggest several directions for future research.
first theprevalentcodereuseinsmartcontractsnecessitatesstudying vulnerabilityspreadacrosschainsandtheefficiencyofcountermeasures.
there is potential in developing detectors for clone based vulnerabilitiestoauto patchriskyandemployingbinarycodeclone detectiontoimprovevulnerabilityidenti f ication.second extending our analysis to include type clones could provide deeper insights intodiverseimplementationsofidenticalfunctionalities.theusage scenarios for various implementations could be further studied.
in addition our analysis can be extended by including multiple blockchain networks e.g.
bnb chain and polygon .
this will enhance our understanding of contract characteristics and cross chain interactions enriching our grasp on the broader smart contractecosystem.lastly withthedevelopmentpatternsprovided in section .
their effects on contract robustness and risks and theevolutionofthepatternscouldbefurtherinvestigated.moreover investigatingfunctional levelpatternscouldofferinsightsinto subcontract versionsandboost low code development f lexibility.
.
threatsto validity .
.
internal validity.
the choice of type clones may lead to falsesimilaritiesinclonedetection.inthisstudy wechosetofocus on type clones because they offer a balance between the rigor of detection andtherichness ofinsight.for example our duplicated contractanalysisinsection .3canbeeffectivelydonewithtype2 clones but unattainable with type clones.
however we also acknowledgetheriskofidentifyingfalsesimilaritieswithtype clones due to the renaming of variable names.
to mitigate this we have reconducted experiments with type clone detection as a baselineandthe result proves that our initial f indingsstillhold.
.
.
external validity.
a potential threat is related to the representativeness of the dataset.
collecting the source code of all 805demystifyingthe compositionandcode reuse in soliditysmartcontracts esec fse december3 san francisco ca usa deployedcontractsischallengingduetothefrequentlackofpublic releaseandthenumerousexistingblockchainnetworks.tomitigatethis weexpandourdatasetbycollectingcontractsfromtwo differentethereum networks i.e.
themainnet and goerli testnet andidenti f iedthird partypackages.
.
.
construct validity.
the identi f ied patterns in section .
might be in f luenced by our subjective interpretations.
we mitigate this with a rigorous inspection process involving three smart contract auditors andgroup discussionsfor cross veri f ication.
we then revalidate the results using frequency and date rangeto measuretheprevalenceandlongevityofidenti f iedpatterns.through these veri f ications we ensure that these development patterns are prevalent and can be applied in real world applications.
similar inspections are also conducted during duplicated contract analysis insection .
.
the result is further veri f iedwith the informationof creators from source code and etherscan .
the records for both manual inspections are available onour website .
related work empiricalstudiesonsmart contracts.
severalempiricalstudies on code reuse in smart contracts have been done in the past few years with focuses on the characteristics and impacts of clones.
kondo et al.
reported that .
of the subcontracts are type and type clones in ethereum with atree basedclonedetectorcalleddeckard .whilekhan further extended kondo s study to the granularity of functions and type clones.
their result indicated a .
overall clone ratio at the function level out of which about belong to type clones.
chenetal.
studiedtheimpactsofcodereuseinsmartcontracts andidenti f iedthecommonrevisionstoreuseexternalsubcontracts.
pierroetal.
classi f iedtheclonesinsmartcontractdevelopment and proposed some possible explanations for trends of clones in the view of smart contract developers.
while previous studies concludedahighcloneratioinsmartcontracts theyoverlookedthat many external subcontracts are directly imported but published together with the source code.
in contrast we take the introduction approaches into consideration during analysis.
this allows us to better comprehend the existing regulations to use external components and uncover that over of the clones are imported.
additionally thereareafewstudiesdiscussingthecurrentsmart contract development from various aspects.
zou et al.
summarizedthemajorchallengesfordevelopersinsmartcontractdevelopmentanddiscussedthepossibledirectionstoimprovethequality of current smart contract development.
chen et al.
studied the maintenance related concerns for deployed smart contracts and discussed how to maintain smart contract based projects from developers views.
several studies have been to discuss the concernsinsmartcontractdevelopmentsuchassecurity and maintenance .
however these studies only focused on a singlegranularity i.e.
eithersubcontractsorfunctions thereby leaving the composition of smart contracts under explored.
our study bridges this gap by providing a detailed understanding of smartcontractcompositionandconductingcodereuseformultiple granularities i.e.
contract subcontract and function .
for each levelofgranularity wemanagetodiscoversomecommonpractices incode reuse andfunctional requirements.developmentpatternsinsmartcontractdevelopment.
afew studiesrelatedtotheexistingdevelopmentpatternshavebeendone in recent years.
marino and juels proposed design patterns for alteringandun manuallycheckedthesourcecodeof811veri f iedsmartcontracts from etherescan through which they summarized the purposes ofsmartcontracts e.g.
f inancial wallet etc.
andexistingdesign patterns including token authorization andoracle.
similar design patternswerealsodiscussedinworley swork .olivaetal.
investigated the activity level of contracts and summarized the mainusageofsmartcontracts.wohreretal.
elaboratedseveral common security patternsand describedsolutions to typical attack scenarios.
zheng et al.
summarized the whole life cycle of smartcontractdevelopment includingcontractcreation deployment execution andcompletion.moreover theyalsodiscussedthe challenges in the current development cycle and the difference betweensmartcontractplatformsincludingethereum.anotherwork from zheng described the architecture of blockchain and consensus algorithms and introduced the development of applications based on blockchain.
mohanta et al.
summarized seven use cases for smart contracts including iot supply chain management and healthcare systems.
despite these contributions previous studies failed to provide concrete development patterns but focused on the general steps for various functional requirements.
in our study we extract development patterns as sets of subcontracts that could bepotentiallyusedforlow codedevelopments.thisalsore f lects the areas with high standardization in smart contract development.
conclusion this study discusses code reuse in solidity smart contracts from theviewofcontractdecompositiononethereumblockchains.to understand the compositions of contracts we f irst quanti f ied three common approaches to introduce subcontracts through which we alsocompiledalistofcommonlyusedthird partypackagesinsmart contract development.
we then conducted separate code reuse analysesforself developedandexternalsubcontractstodissectthe most frequently reused code blocks and their functional properties.
togaininsightsintocommonpracticesincontractdevelopment wealsoextracted61frequentlyreuseddevelopmentpatterns.lastly wediscussedthecurrentchallengesinmanagingsmartcontracts andproposedpossible solutions.
data availability the detailed analysis results that support the f indings of this study are available in .
acknowledgement this research is supported by the national research foundation singapore andthecybersecurityagencyunderitsnationalcybersecurityr dprogramme ncrp25 p04 taicen .anyopinions f indings andconclusions orrecommendationsexpressedinthis materialarethoseoftheauthor s anddonotre f lecttheviewsof thenationalresearchfoundation singaporeandcybersecurity agency ofsingapore.
806esec fse december3 san francisco ca usa kairansun zhengzixu chengweiliu kaixuanli andyang liu