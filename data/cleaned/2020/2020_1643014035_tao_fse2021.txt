demystifying bad error messages in data science libraries yida tao college of computer science and software engineering shenzhen university china yidatao szu.edu.cnzhihui chen college of computer science and software engineering shenzhen university china chenzhihui2019 email.szu.edu.cnyepang liu dept.
of computer science and engr.
southern university of sci.
and tech.
china liuyp1 sustech.edu.cn jifeng xuan school of computer science wuhan university china jxuan whu.edu.cnzhiwu xu college of computer science and software engineering shenzhen university china xuzhiwu szu.edu.cnshengchao qin college of computer sci.
software engr.
shenzhen university china school of computing engr.
digital tech.
teesside university uk shengchao.qin gmail.com abstract error messages are critical starting points for debugging.
unfortunately they seem to be notoriously cryptic confusing and uninformative.
yet it still remains a mystery why error messages receive such bad reputations especially given that they are merely very short pieces of natural language text.
in this paper we empirically demystify the causes and fixes of bad error messages by qualitatively studying stack overflow threads and github issues.
we specifically focus on error messages encountered in data science development which is an increasingly important but not well studied domain.
we found that the causes of bad error messages are far more complicated than poor phrasing or flawed articulation of error message content.
many error messages are inherently and inevitably misleading or uninformative since libraries do not know user intentions and cannot see external errors.
fixes to error messagerelated issues mostly involve source code changes while exclusive message content updates only take up a small portion.
in addition whether an error message is informative or helpful is not always clear cut even error messages that clearly pinpoint faults and resolutions can still cause confusion for certain users.
these findings thus call for a more in depth investigation on how error messages should be evaluated and improved in the future.
ccs concepts software and its engineering error handling and recovery.
yepang liu is also affiliated with the guangdong provincial key laboratory of braininspired intelligent computation.
zhiwu xu is the corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse august athens greece association for computing machinery.
acm isbn .
.
.
.
error message debugging aid data science empirical study acm reference format yida tao zhihui chen yepang liu jifeng xuan zhiwu xu and shengchao qin.
.
demystifying bad error messages in data science libraries.
in proceedings of the 29th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse august athens greece.
acm new york ny usa pages.
introduction when a program fails the error message is often the first debugging clue.
research has found that developers allocate a significant portion up to of debugging efforts on reading error messages which is equally demanding as reading source code .
unfortunately error messages seem to have a bad reputation as they are often perceived as cryptic unclear confusing uninformative misleading unhelpful poorly written and hard to digest .
being the typical diagnostic starting point poor error messages could substantially prohibit efficient and effective debugging .
while previous work mostly addressed the quality of error messages generated by compilers system software and static analysis tools limited knowledge is available about this issue in the domain of data science.
yet as data science is experiencing a phenomenal growth in recent years developing and debugging data science programs have become an indispensable part of modern software engineering .
furthermore while debugging is generally difficult debugging data science programs could be doubly challenging when complex data processing multistep pipelines and black box models are heavily involved .
in such circumstances poor error messages could only make things worse.
in this work we present the first empirical study on the quality of error messages encountered when debugging data science programs.
our subjects include six python libraries e.g.
numpy pandas and tensorflow that are widely used by data science practitioners.
we specifically focus on bad error messages since an in depth understanding of why such error messages are unfavorable and how they are fixed could directly guide the future design ofesec fse august athens greece yida tao zhihui chen yepang liu jifeng xuan zhiwu xu and shengchao qin better error messages.
accordingly we aim to address the following two research questions rq1 why do certain error messages fail to be helpful debugging aids?
rq2 how do developers fix bad error messages in practice?
for rq1 we analyzed stack overflow so for short threads that contain error messages of the subject libraries in the question descriptions.
intuitively posting a question on so is often driven by an unsuccessful debugging attempt.
hence the inclusion of an error message in the so question typically indicates that the error message is not helpful enough for debugging which is exactly the subject we aim to study in rq1.
by comparing these error messages with the actual fixes derived from the accepted so answers we characterized the error messages in terms of whether they pinpoint the faults and how they deliver the resolutions which essentially measure their capabilities of assisting the fault localization and repair tasks.
we then used this characterization to mechanically distinguish misleading uninformative and should be clear error messages and investigate the respective underlying causes to answer rq1.
for rq2 we analyzed github issues of the subject libraries that are related to error message quality.
by inspecting the thread discussions and associated commits if any we derived common strategies library developers adopt to handle such issues.
finally the findings of rq1 and rq2 are aligned to form a comprehensive taxonomy of the causes and fixes to bad error messages.
our study uncovered new knowledge about bad error messages in data science libraries including around error messages are misleading for providing resolutions different from the actual fixes .
error messages are uninformative for being cognitively distant from the actual fixes even though they indeed point to the right directions for debugging.
most misleading error messages are in fact logically justifiable from libraries point of view.
such misleadingness can be hard to resolve since libraries are inherently blind to user intentions and external errors.
most uninformative error messages explicitly describe requirements or violations which are however still cognitively distant from the fix implementations.
yet due to unclear user intentions or invisible external errors libraries may not always be able to offer verbatim resolutions in error messages.
most error message issues are eventually fixed by updating source code logics instead of by updating the phrasing of error messages.
the most common fixing strategy is fail fast which adds new checks earlier in the program to prevent late failures with obscure or low level error messages.
library developers and end users could have different interpretations of error messages.
an error message that clearly pinpoints the fault and resolution could still be considered as unhelpful by users especially those who are unfamiliar with the problem domain the api specification or the programming language.
extracting diagnostic information matching so threadserror messagefaulty element same?
deficient error messageresolution actual fault actual fixsame?no nofigure the workflow of identifying bad error messages.
in general bad error messages are not necessarily equivalent to bad phrasing or presentation of error messages.
our study revealed deeper causes to error message deficiency which is fundamentally attributed to how much information libraries can access and how responsible libraries should be in terms of being diagnostic and prescriptive .
we hope that our findings could raise awareness of these underlying reasons that lead to bad error messages and therefore motivate practitioners to design and consume error messages more effectively.
the code and data of this study are publicly available .
methodology in this section we introduce our methodology in detail.
.
data collection the subjects of this study include six popular libraries from the python ecosystem for data science.
specifically numpy and pandas provide flexible functionalities to manipulate structured data scipy and scikit learn feature various numerical routines and algorithms for statistics and machine learning tensorflow is a general purpose deep learning framework gensim is a library for unsupervised topic modeling and natural language processing .
together these libraries can be used to solve different types of important tasks in data science.
we first identified all the error messages that can be potentially generated by subject libraries.
to this purpose we recursively invoked python s dir function to explore all methods in the subject modules.
during the process we collected the api signatures of these methods e.g.
pandas.crosstab and the respective source code using python s introspection capability .
we then built abstract syntax trees from the source code and traversed the ast to collect all nodes with the type ast.raise which represents the statement where an error is explicitly raised thrown .
the corresponding error messages can in turn be retrieved from the raise nodes.
using this approach we identified error messages from the subject libraries as shown in table .demystifying bad error messages in data science libraries esec fse august athens greece table dataset statistics.
library version error error messages error messages error message issues messages appeared in so analyzed in so context with confirmed fixes numpy .
.
pandas .
.
scipy .
.
scikit learn .
.
tensorflow .
.
gensim .
.
total .
characterizing deficient error messages to address rq1 error messages should be evaluated in practical debugging contexts with known resolutions.
we used the so platform for this purpose.
as mentioned in section if a user posted an so question that is associated with an error message we might reasonably assume that s he is having difficulty in debugging even in the presence of the error message.
in other words the error message is potentially insufficient to aid debugging which is exactly the subject we aim to study.
in addition since so strongly advocates the reproducibility of the proposed problems and resolutions we could study target error messages in self contained reproducible and practical debugging contexts.
the reward system of so further allowed us to identify known resolutions from the accepted answers with sufficient confidence.
figure shows the workflow of this process.
basically two types of diagnostic information faulty element and resolution are extracted from error message content and cross checked against the actual fixes in accepted so answers.
error messages that do not pinpoint the same faulty elements or resolutions were considered as deficient and were manually analyzed to identify the underlying causes.
below we describe each step in detail.
.
.
matching so threads.
using the official stack exchange rest api we collected so threads tagged with the subject libraries.
we then searched for so questions that contain the extracted error messages and also have the respective library tags.
a notable step here is the preprocessing of string formatting which is often used in error messages to capture dynamic information e.g.
input values observed at runtime .
major approaches to python string formatting include the c style formatting e.g.
shape mismatch s var string.format e.g.
shape mismatch .format var and f strings e.g.
f shape mismatch var .
to construct proper search queries for formatted error messages we replaced the placeholders in these strings with wildcards so that the fixed part e.g.
shape mismatch will be matched while the variable part e.g.
var which may vary across different debugging contexts will be ignored.
using this approach we identified error messages that appeared in so questions which account for nearly one fifth of the total error messages extracted from the subject libraries .
we then retained error messages whose so questions have positive upvotes and accepted answers for further analysis.
note that if anerror message appeared in multiple eligible so questions we selected the question with more upvotes.
so threads were skipped if we had difficulty understanding the debugging contexts.
finally the so threads of distinct error messages were analyzed to address rq1.
.
.
evaluating error message content.
we evaluate the quality of the error messages from the following two aspects.
whether the error message pinpoints the exact faulty element we usefaulty elements to refer to code elements such as parameters variables types and operations that cause the error and should be fixed.
to assist the identification of such elements which are essentially names we used the stanford corenlp toolkit to extract words from error messages with the nn noun nnp proper noun and nns noun plural part of speech tags.
we then crosschecked the accepted so answer to determine whether the faulty elements identified from the error message were the same as those addressed in the actual fix which is essentially a binary labeling process.
consider the example in table .
since the fault ignore index addressed in the accepted fix also appears as a noun in the error message we assigned a positive label for this message for pinpointing the exact same faulty element.
on the other hand the error message in the example received a negative label for pinpointing a faulty element i.e.
the sep keyword that is different from the one being actually fixed i.e.
the dataframe df .
how the error message delivers the resolution we determined the resolution provided in an error message using the following heuristics.
first if the error message contains words such as must should need have to required and expected we consider the content entailed by these words as the suggested resolution e.g.
in table .
otherwise we looked for negative words such as unexpected cannot unable and invalid and used the opposite meaning of the content entailed by these words as the suggested resolution.
for example the error message index is not a valid datetimeindex or periodindex insinuates that index should be a valid datetimeindex orperiodindex in table .
we then labeled whether the resolution identified from the error message is the same as the one implemented in the actual fix.
in table and are positive examples of this task.
for those with negative labels however we observed a special group of error messages which are distant from the actual fix but still point to the right direction e.g.
and in table .
given that error messages are used as debugging aids the ones that point to theesec fse august athens greece yida tao zhihui chen yepang liu jifeng xuan zhiwu xu and shengchao qin table examples of error message characterization.
error message actual fix faulty delivered perception element resolution 1can only append a series if ignore index true or if the series has a name.add ignore index true when calling append .
so same same clear 2index is not a valid datetimeindex or periodindex.convert the index to the datetimeindex type.
so same same clear 3the score function should be a callable .
was passed.import chi2 right before assigning it to the score function to avoid accidental overwritting.
so same indirect uninformative 4failed to convert object of type class dict to tensor .
.
.
.
consider casting elements to a supported type.convert the ylabels to the pd.series type.
so different indirect uninformative 5did you mean to supply a sep keyword?use df .values instead of df .
so different different misleading 6table sqlite c tmp.db not found.pass an sqlalchemy engine object instead of a string to pd.read sql table .
so33083415 different different misleading right direction should be differentiated from the ones that point to the wrong direction e.g.
and in table .
for this concern we assigned a special label indirect to such error messages.
the manual labeling was performed by the first two authors independently.
the cohen s kappa for their labelings in the two tasks are .
and .
respectively indicating a substantial interrater agreement .
disagreements1were reconciled with the third author joining the discussions.
.
.
understanding deficiency causes.
with these labelings we were now able to concretize the badness of error messages.
first error messages that provide different resolutions could be perceived as misleading .
then error messages that provide indirect resolutions or pinpoint different faulty elements could be considered as uninformative .
finally error messages that describe both the same faulty elements and resolutions as the actual fixes should be considered as clear .
table shows examples of each category.
we then manually categorized the underlying causes to misleading and uninformative error messages.
as no prior knowledge is available for this type of categorization we adopt the inductive coding method in the process .
initially the first two authors independently inspected the so threads and related artifacts e.g.
source code documentation etc.
and created tentative codes that best summarize the deficiency causes.
then they got together to compare the independent codes merge similar concepts and reconcile disagreements.
this process continued until the categories of all deficiency causes were agreed by both annotators.
we report the findings in section .
.
characterizing error message fixes to address rq2 we studied subject libraries github issues to analyze developers strategies of handling error message issues.
specifically we searched for closed issues whose descriptions contain 1the number of disagreements for the two labeling tasks are and respectively.either the error message string or the text of the error messages studied in rq1.
intuitively the search criteria help to identify issues that address users complaints on error messages and we are likely to identify a definite answer from developers for an issue if it is already marked as closed .
using the official github rest api we collected github issues that satisfied the search criteria.
to make the inspections manually feasible and statistically meaningful we randomly sampled half of the issues.
during the process we discarded issues that do not really address error message quality e.g.
gensim gh2352 or address only trivial typos and spacing problems in error messages.
we also discarded issues whose duplicate or related issues have already been inspected.
finally issues were considered valid.
among which have associated commits that were merged to the main branch indicating that the issues were confirmed and fixed by developers.
for these issues we inspected both their thread discussions and merged commits to categorize library developers strategies of fixing deficient error messages.
we also studied the remaining valid issues to understand why they were closed without any change being made to the source code.
an inductive coding approach similar to the one described in section .
.
was also adopted in this process.
the findings are reported in section .
rq1 why do certain error messages fail to be helpful debugging aids?
based on the characterization described in section .
we identified .
misleading error messages and .
uninformative error messages in our dataset .
we also identified .
error messages that are supposedly clear but still being asked on so.
in this section we report the underlying causes to the deficiency of these error messages.
2throughout the paper we use so questionid to uniquely identify an so post and library gh issueid to uniquely identify a github issue bad error messages in data science libraries esec fse august athens greece table error message evaluation results.
faulty resolution element same indirect different total same .
different .
total .
.
.
.
misleading error messages as explained in section .
.
an error message is likely to be considered as misleading if it suggested a resolution that is different from the actual fix.
table shows that there are .
error messages of such kind.
surprisingly among these error messages we identified only one error message from scipy that is misleading indeed because it is poorly phrased.
we made a commit to rephrase this error message and submitted a corresponding pull request which was confirmed by scipy developers and merged to the library code.
nonetheless for the remaining error messages the underlying causes to their misleadingness are more sophisticated than how the messages themselves are phrased.
below we present our observations.
.
.
library is blind to user intentions or errors .
users can use a library in many different ways.
yet from the perspective of library developers how users intend to use the library is often ambiguous.
consequently libraries might produce error messages that are logically justifiable but still misleading to users.
consider numpy so which reports the error wrong number of columns at line when numpy.loadtxt is invoked to load a text.
this error occurred since the symbol in the first line of the input data is by default interpreted as a comment yet the user actually intended to use as a normal symbol in the word c figure .
therefore the accepted resolution is to pass comments none tonumpy.loadtxt to disable the default behavior instead of fixing the number of columns in the input text as suggested by the error message.
while the error message sounds misleading in this particular case it would also make perfect sense if users indeed intend to use as comments in the input.
from the perspective of library developers it would be difficult to distinguish between a deliberate and a careless api usage especially when the default behavior is explicitly described in the official documentation.4in fact this error message was discussed in numpy gh and numpy gh in which developers decided that for cases where an input line e.g.
line in the example has different columns than its previous line the error message will only spit out the current line number since it is not always clear where the problem is .
in addition to user intentions a library is also blind to external errors that are essentially inaccessible from within the library s namespace.
for such cases it would be impractical to expect the library to raise an error message that accurately describes the resolutions.
figure shows an example from pandas so .
here faulty code c .
d .
w .
input data .txtdata np.loadtxt data.txt delimiter t dtype str error message wrong number of columns at line .
resolution data np.loadtxt data.txt delimiter t dtype str comments none actual fixambiguous intentio nfigure example of ambiguous user intention.
.
df df.tz localize pytz.timezone us eastern .
df.tz convert pytz.timezone utc faulty code error message cannot convert tz naive timestamps use tz localize to localize.
resolution1.
df.tz localize pytz.timezone us eastern .
df.tz convert pytz.timezone utc actual fixsuggested fix figure example of external user errors.
tz convert failed at line and threw an error message that suggests use tz localize to localize which may sound confusing since the user already did so at line .
the real fault however was that the user did not assign the computation result at line back to df hence the tz localize operation did not really take effect at line .
yet the library could not possibly see this external error.
in this sense the error message was logically justifiable for explicitly demanding the missing tz localize operation.
in general half of the inspected misleading error messages seem to be logically reasonable from the library s perspective.
the primary reason for their misleadingness is that libraries are inherently unaware of user intentions or user errors which restrict their abilities of offering accurate resolutions in error messages.
.
.
library is buggy or outdated .
when errors were caused by library bugs or incompatibilities accepted resolutions were typically updating library versions or applying workarounds.
therefore error messages that did not suggest the same might be considered as misleading.
for example pandas so reports an error did you mean to supply a sep keyword?
.
as explained in the accepted answer the error was due to a bug in pandas .
.
which was fixed in .
.
.
users could either update the library version or apply a workaround to resolve the error in table instead of supplying a sep keyword as suggested by the error message.
take pandas so as another example.
an error table sqlite c tmp.db not found occurred because pandas .
was installed to invoke read sql table with a string url which was only supported since version .
.
the accepted resolution was either conforming the code to the .
specification in table or simply updating the library version which had nothing to do with the table existence insinuated by the error message.
.
.
open design issues .
finally we identified three cases where the error messages demand consistent input shapes whichesec fse august athens greece yida tao zhihui chen yepang liu jifeng xuan zhiwu xu and shengchao qin was different from the input sparsity issue tackled in the actual fixes.
for example numpy so reports an error all input arrays must have the same shape when invoking numpy.stack .
however what really caused this error was that a sparse matrix that was not recognized by the api was used as input.
in fact the shape of sparse matrices is a known and open issue in the python data science community.6even library developers themselves have described this issue as a general cause of confusion and an endless source of bugs and trying to treat np.matrix np.ndarray scipy.sparse or masked matrices through a common interface is a lost cause 7not to mention end users who may not even be familiar with all these concepts.
finding due to ambiguous user intentions external user errors and open design issues libraries can inevitably produce error messages that are misleading to users.
.
uninformative error messages in addition to misleading error messages error messages that do not pinpoint the same faulty elements or provide only indirect resolutions are also worth exploring as they might be considered as uninformative .
.
.
error messages do not pinpoint the same faulty elements.
as shown in table .
error messages do not pinpoint the same faulty elements.
among them also provide resolutions different from the actual fixes which were already discussed in section .
.
for the remaining error messages we identified two distinct deficiency patterns.
faulty element is too general .
in this type of error messages the faulty element being referred to is too general to be helpful.
for example pandas so reports the error message dataframe constructor not properly called .
the message was not wrong given that the first argument passed to the constructor indeed had an incorrect type.
however the constructor of pandas.dataframe has five parameters each has several valid options and together many combinations are possible.
in such cases knowing the error message is still insufficient for locating the specific fault.
we observed that two of these error messages have already been fixed by library developers later on and the fixes indeed changed error messages to be more specific on the faulty elements.8for the other two error messages e.g.
domain error in arguments we submitted corresponding issues addressing their uninformativeness which have been confirmed by library developers.
faulty element is too low level .
most of the error messages that do not pinpoint the same faulty elements in fact pinpoint the finalmanifestations of the fault.
for example tensorflow so discussed a case where the user forgot to set the label dimension parameter when invoking the dnnregressor api.
this caused the program to crash with an overwhelmingly long stack trace ended with the message shapes and are incompatible .
here the incompatible shape pinpointed by the error message was essentially the final manifestation of the missing parameter.
8the fixing commits are 3ec9d6 for numpy and 2dd80c for pandas.
9issues and for scipy.for end users this type of error messages might be considered as less straightforward since they pinpoint internal errorneous status resulted from the fault instead of the fault itself.
in this sense their uninformativeness is more of a byproduct of where the error is handled rather than how the error message itself is phrased.
in section .
.
we discuss how library developers handle such cases in practice.
finding the faulty elements pinpointed by error messages could be too low level internal or too high level general to be informative.
the former case is more commonly observed.
.
.
error messages provide indirect resolutions.
table shows that .
error messages suggest indirect resolutions.
among which were indirect also for pinpointing different faulty elements as discussed in section .
.
.
for the remaining error messages we observed the following two deficiency causes.
requirements are hardly derivable from the error messages .
this type of error messages tends to describe what is violated or not allowed.
however what is required is hardly derivable from the violations.
for example the error message not supported for type index pandas so states that index is not supported yet it is still unclear which types are supported.
for users who expect a direct answer such error messages might be regarded as uninformative.
to improve these error messages we identified their respective requirements from the official documentation and submitted four pull requests.
the one that fixes the error message in the prior example was already merged at this moment.10specifically our merged fix changed the message to this method is only implemented for datetimeindex periodindex and timedeltaindex got type index which became more actionable by stating explicit requirements.
requirements in error messages are explicit but still cognitively distant from the fix implementations .
even if error messages explicitly state the requirements there may still exist nontrivial cognitive gaps between understanding the requirements and implementing the final fixes.
for example in pandas so pandas.to numeric df raised the error arg must be a list tuple d array or series since dfwas of an unexpected type.
the accepted fix was to use to numeric as the lambda function when invoking another api pandas.apply i.e.
df.apply lambda x pd.to numeric x axis which indeed complied with the error message by passing a series argument to to numeric .
yet implementing this fix could still be cognitively demanding especially for users who were unfamiliar with the pandas.apply api or the lambda function.
cognitive gaps are sometimes also the inevitable consequences of unknown user intentions and errors which are practically invisible from the libraries.
for example the error message shown in table explicitly required the score function to be a callable .
however nontrivial debugging efforts were still needed for users to figure out why this requirement was violated which in this case was due to an accidental overwritting of score in the client code.
since this error was not even visible from the library s namespace the error message could only highlight the concept of mistake instead of offering direct resolutions.
bad error messages in data science libraries esec fse august athens greece finding for error messages that offer indirect resolutions explicit requirements are either missing or cognitively distant from the fix implementations.
however it is not always possible for error messages to provide verbatim resolutions also due to unknown user intentions and errors.
.
clear but still unhelpful error messages finally error messages that pinpoint the same faulty elements and resolutions as the actual fixes should be much clearer than the ones discussed above.
interestingly as shown in table such error messages were still observed in so threads .
meaning that users knowing the messages were still stuck in debugging regardless.
we identified the following reasons for this phenomenon.
.
.
insufficient domain specific knowledge.
first users with insufficient domain knowledge may have a hard time understanding error messages even when they are relatively clear.
for example in sklearn so a user used a test data of features on a machine learning model that was trained on data with two features resulting in the error number of features of the model must match the input.
model n features is and input n features is .
in this case the error message directly pinpoints the fault i.e.
the number of features and the resolution i.e.
the features must match .
however the user was still stuck possibly due to his her insufficient knowledge on the basic concepts in training and testing machine learning models.
.
.
unfamiliarity with api specification.
a clear error message may still be considered unhelpful if users were unfamiliar with the api specification in the first place.
for example in sklearn so54980098 a user received the error x is neither increasing nor decreasing when passing an array of labels to sklearn.metrics.auc whose official documentation explicitly states that the argument must be an x coordinate that is either monotonically increasing or decreasing.
in this case the error message should be clear in terms of both the faulty element and the resolution if users are familiar with the api specification.
.
.
unfamiliarity with the programming language.
finally users programming expertise could also affect their perceptions of error messages.
for example the scipy.optimize.check grad func grad x0 args kwargs api allows an arbitrary number of arguments indicated by args and kwargs .
in scipy so a user incorrectly used argas if it was a normal keyword argument and therefore received the error message unknown keyword arguments .
even after the user checked the documentation of this api s he was still convinced that args was a valid argumet and that the error should not occur the user asked noteworthy args is listed as an argumet in the help file.
shouldn t this work?
.
in this case if the user was familiar with python s syntax on this type of variadic arguments e.g.
args the error message itself should be self explanatory.
finding error messages that pinpoint the exact faulty elements and resolutions might still be considered as unhelpful especially when users are unfamiliar with the problem domain the api specification or the programming language.
fixing strategies deficiency causes library is blind to user intentions and errors library is buggy or outdated open design issues faulty element is too general faulty element is too lowlevel requirements are hardly derivable from violations requirements are cognitively distant from implementationslogic fixes and design changes dissecting overgeneralized errors fail early fail fast ask for forgiveness than permission add missing requirementswon t or can t fix misleading uninformativeadd actionable instructions won t or can t fix12.
.
.
.
.
.
.
.
.
.
.
.
.
figure deficiency causes and respective fixing strategies.
rq2 how do developers fix bad error messages?
in this section we report developers practice on handling deficient error messages.
figure shows an overview of the fixing strategies and their associations with the deficiency causes described in section .
.
fixing strategies to study fixing strategies we analyzed github issues that address error message quality and have confirmed fixes section .
.
table shows the types of artifacts changed in these fixes.
interestingly although error messages are being complained in these issues only .
fixes exclusively update the message content.
the majority of fixes however involve updates to the source code.
in particular .
fixes only update the source code without even changing the error message content.
below we discuss detailed fixing strategies with respect to source code changes and message content changes.
.
.
source code changes.
we identified four major strategies developers adopt when they change source code to handle deficient error messages.
fail early fail fast .
the majority of fixes adopt the fail fast principle which states that software should fail immediately andvisibly when a problem occurs .
fixes adopting this strategy typically add explicit checks earlier in the program without even modifying the error message content.
consider pandas gh in which the error cannot call bool on dataframe was raised on pandas.concat df1 df2 .
the user complained that the message was seriously cryptic given that 11the percentage of deficiency causes in figure is calculated by dividing the occurrence of each cause by which is the number of error messages that do not provide the same faulty elements and resolutions as the actual fixes .esec fse august athens greece yida tao zhihui chen yepang liu jifeng xuan zhiwu xu and shengchao qin table types of changes made to fix deficient error messages.
only .
fixes exclusively changed message content.
error message changed source code changed total .
.
.
def init self objs axis join outer join axes none keys none levels none names none ignore index false verify integrity false ifnotisinstance objs tuple list dict raiseassertionerror first argument must be a list of pandas objects you passed an object of type .
format type objs .
name figure example of the fail fast fixing strategy.
the actual fix should be pandas.concat .
library developers also confirmed this issue and commented should fail fast .
as shown in figure the fix to this issue was adding code to check whether the objects being concatenated are in a list as soon as they were passed to the api.
with this fix a more meaningful error message first argument must be a list of pandas objects you passed an object of type dataframe will be raised immediately for this type of api misuse.
recall the findings from section .
.
which state that error messages with low level details were commonly observed and potentially uninformative.
the fail fast strategy could effectively address this type of deficiency as it prevents a program from proceeding silently when an error occurs and crashing strangely later on with obscure internal errors.
in addition by adding error handling code earlier and closer to where the error occurs critical context information such as the faulty element becomes accessible from within the library s namespace and thus could be better embedded in the error messages.
ask for forgiveness than permission .
this strategy basically wraps an existing code with a tryblock and raises a more informative error message in the corresponding except block.
consider pandas gh in which the user complained that from coo gave a not so useful error message when given an input of noncoo matrix type.
as shown in figure the fix was to wrap the corresponding statement in a try.
.
.
except block with a more user friendly error message expected coo matrix.
got csr matrix instead .
in contrast to fail fast which is essentially a preventive strategy this second strategy adopts the principle of ask for forgiveness than permission .
to be more specific this strategy still let whatever internal errors to occur but then catch them at the code of interest with more context aware error messages that mask low level and obscure details.
dissecting overgeneralized errors .
while the previous two strategies avoid low level error messages this third strategy improves overgeneralized error messages by adding necessary helper code.
take sklearn gh as an example.
initially a general error s series a.data multiindex .from array a.row a.col try s series a.data multiindex .from arrays a.row a.col exceptattributeerror raisetypeerror expected coo matrix .
got instead.
.format type a .
name figure example of the ask for forgiveness strategy.
ifnotsolver type inself.
solver type dict ifself.penalty.
upper l1 andself.loss.
upper l1 error string the combination of penalty l1 and loss l1 is not supported.
elifself.penalty.
upper l2 andself.loss.
upper l1 error string loss l2 and penalty l1 is only supported when dual true .
else error string penalty l1 is only supported when dual false .
raisevalueerror not supported set of arguments solver type error string figure example of dissecting overgeneralized errors.
not supported set of arguments was raised which was considered by users as not clear at all .
figure shows the fix to this issue which added conditional checks to explore different errorneous combinations of parameters.
as a result the original overgeneralized error messages was now dissected to three different error messages with respect to three subconditions of errors e.g.
penalty l1 is only supported when dual false .
logic fixes and design changes .
while the aforementioned strategies focus on general error handling practice a nontrivial proportion of fixes also address project specific logic flaws or design issues.
for example an unhelpful error message data not found was complained in scipy gh .
the respective fix was to defer a dictionary initialization to after an input type check so that an existing error message save is not implemented for sparse matrix of format dok which is more helpful could be reached and thrown first.
as another example tensorflow gh discussed a very obscure error message no opkernel was registered to support op maxpoolwithargmax with these attrs.
registered devices when tf.nn.max pool with argmax was executed on cpu but only implemented for gpu.
to fix this issue developers made a major design change by adding a cpu support to the max pool with argmax op.
finding source code changes in error message related fixes typically implement more robust error handlings.
project specific logic fixes or design improvements could also prevent deficient error messages from being raised.
.
.
error message content changes.
we identified nine strategies developers adopt when they change error message content to address related complaints.
table describes these strategiesdemystifying bad error messages in data science libraries esec fse august athens greece table strategies for fixing error message content.
focus strategy example of error message changes added deleted completenessadd runtime contexts .
k d must be between and rank a d k n scipy ebb8b1 add actionable instructions .
x needs to contain only non negative integers.
please setcategories auto explicitlyto beable tousearbitrary integervaluesascategory identifiers.
sklearn 94c70f add missing requirements .
method must be either pearson spearman or kendall oracallable.
pandas 64f596 clearnessclarification .
min samples split must be atleast 2anintegergreater than orafloat in .
.
sklearn84cc67 rephrase .
ifthere is no initial state isprovided youmust give a dtype must be.
tensorflow 06be84 correctnessfix incorrect info .
the length of the input vector x must be atleast greater than padlen.
scipy be94e5 fix outdated info .
use with default session sess sess.as default or pass an explicit session to run session sess .
tensorflow 3e7aae succinctnessremove internal details .
aredtype not support edincython ops.
pandas 6b23fb8d reduce message length .
valid options are accuracy adjusted mutual info score .
.
.
a very long listisomitted usesorted sklearn.metrics.scorers.keys togetvalid options.
sklearn 825cf0 with examples.
in general these strategies focus on improving the following aspects of deficient error messages.
completeness .
the majority of error message content changes add new information to improve completeness.
as shown in table the most common type of information being added is the runtime context information.
specifically relevant variable values or computation results observed when an error occurs are often added to the corresponding error message so that users could better understand the errorneous program state and pivot debugging.
actionable instruction is another type of information that is often added to complete error messages.
such information might effectively reduce the cognitive workload for implementing fixes see section .
.
.
we also observed a few cases where crucial requirements that were previously missing were added to complete the error messages.
clearness .
error messages with complete information may still be considered deficient if the presentation is unclear.
developers fix such error messages by clarifying concepts or rephrasing sentences as shown in table .
correctness .
in addition developers update error message content to ensure that they are correct and up to date.
succinctness .
in a few cases developers remove unnecessary or verbose information from error messages to keep them concise and readable.
finding adding runtime context information is the most common strategy for improving error message content.
.
won t fix as described in section .
we identified error message related issues that were closed without any merged commits.
below we summarize salient reasons why library developers hesitate to confirm or address these issues.
conceptual mismatch among library developers and users since library developers and end users are not equally familiar withthe design or implementation of the library they might have different interpretations of the same error messages.
consider the error message unalignable boolean series key provided discussed in pandas gh .
a user considered this error message to be very confusing since the term alignable intuitively refers to matching lengths .
on the contrary a library developer considered this message to be rather clear since alignable naturally denotes the matching of both lengths andlabels in the pandas world .
numpy gh is another example in which a library developer considered the error message loop of ufunc does not support argument of type int which has no callable sqrt method to be reasonably clear for trying to explain what is going on .
however a user commented that the error message may be helpful for numpy developers but is still cryptic for numpy users who have no idea what ufunc is or which loop it s referring to.
issues are out of scope developers also turn down requests to fix error messages when problems are not really related to the libraries.
for example the error message merge takes at least arguments given was considered unhelpful in pandas gh .
yet library developers pointed out that this error was actually a de facto python compiler behavior for checking incorrect argument passing which occurred before pandas even sees the call .
in numpy gh a user proposed to improve a misleading error message by adding explanations on matrix sparsity.
however developers turned down this proposal since the concept of sparse matrix is only used in scipy and is not introduced in numpy.
user intentions are unknown while users may prefer prescriptive error messages that offer direct resolutions developers sometimes prefer descriptive error messages since libraries are blind to user intentions.
for example in pandas gh a user proposed to replace an error message keyerror .
with value was not found in index.
to match the closest value use the parameter method nearest .
a library developer commented that i m not really fond of being prescriptive with solution as pandas is blind to the user s intentions .
this observation is also consistent with ouresec fse august athens greece yida tao zhihui chen yepang liu jifeng xuan zhiwu xu and shengchao qin findings in section .
.
which point out that error messages sometimes can only describe the mistakes instead of providing verbatim resolutions due to unknown user intentions.
finding error messages that are considered deficient by end users might be perceived differently by library developers.
implications in this section we summarize the implications of our findings from the perspective of different stakeholders.
for library users their intended usages sometimes are inherently unknown to the libraries.
hence error messages generated by libraries cannot always offer direct explanations or resolutions as expected.
with this awareness library users should avoid overreliance on error messages in debugging.
instead they should be more attune to other reasoning processes such as exploring debugging contexts re examining problem definitions inspecting library documentation or even revisiting programming language specifications during debugging.
for library developers more robust error handlings should be practiced to prevent internal error messages from being raised and users from being overwhelmed.
when composing error messages developers should focus more on the message completeness especially on whether crucial runtime contexts are being included.
in addition instead of stating what is notallowed error messages should articulate what isallowed whenever possible.
furthermore error messages that are clear to developers might not be perceived the same way by end users.
developers should be more aware of this conceptual mismatch in order to design user friendly error messages.
for researchers our study brings a few new perspectives on error message quality and fixing strategies.
first we observed that for a great number of error messages their deficiency was inherently hard to resolve due to unknown user intentions or indiscretions.
this finding urges related research to differentiate bad error messages more carefully based on their specific deficiency causes.
second while most related research emphasized the problematic content of error messages section .
we observed that content improvements in fact account for only a small proportion of error message related fixes.
on the other hand most error message issues were fixed by employing better exception handlings.
however although exception handling has been actively studied very few work pointed out its impact on error message quality section .
.
our work identifies an important intersection of these two lines of work hence better motivates future research on related topics.
threats to validity our study analyzed a subset of error messages from six data science libraries.
the results may not generalize to error messages from other software or application domains.
we mitigate this threat by maximizing the representativeness of the subject libraries.
as described in section .
the subjects are widely used in various data science contexts.as our subjects are all python libraries certain observations might be specific to the inherent characteristics of dynamic programming languages e.g.
error messages related to type errors .
nevertheless most of our qualitative findings are language agnostic.
for example deficient error messages that are caused by ambiguous user intentions or cognitive gaps could also exist for statically typed languages.
we used stack overflow and github as the primary data sources which could have noises.
to mitigate this threat we used only trustworthy information such as the upvoted so questions accepted so answers and merged commits for the analyses.
we derived the deficiency causes and fixing strategies of error messages mainly from manual inspections which could be subjective.
to mitigate this threat we adopt the inductive coding process with multiple human annotators so that the qualitative results were derived iteratively and collaboratively section .
we also released the results so that researchers could help further reduce the threat.
we characterized error messages in terms of whether they pinpoint the fault i.e.
fault localization and how they deliver the resolutions i.e.
repairs .
admittedly there could be other ways to evaluate error message quality.
we chose these two metrics since fault localization and program repair are both important subtasks in debugging .
related work .
error message quality barik et al.
found through an eye tracking study that developers allocate substantial debugging efforts on understanding error messages which are equally challenging as understanding source code .
unfortunately deficient error messages have been observed in different programming and application domains.
for example zhang and ernst proposed a technique to detect inadequate diagnostic messages for software configuration errors .
xu et al.
identified the lack of feedback information in access denied log messsages which imposed unnecessary obstacles for system administrators .
marceau et al.
studied novices interactions with the error messages generated by an ide for the racket programming language .
barik et al.
applied toulmin s model of argument to study the design principles of java compiler error messages .
thiselton and treude proposed a tool that automatically queries stack overflow and summarizes answers to enhance python compiler error messages .
nonetheless few studies explicitly distinguished the types of deficient error messages and analyzed the underlying reasons.
to bridge this gap our work quantified the diagnostic informativeness of error messages in practical debugging context and found that error messages are often inevitably misleading or uninformative.
we also observed that the majority of error message related issues were fixed by updating source code logics which seems to be overlooked by prior research that focused exclusively on improving error message content.
finally our study complements the previous work by investigating the quality of error messages in the emerging domain of data science.demystifying bad error messages in data science libraries esec fse august athens greece .
exception handling exception handling have been actively studied by researchers.
for example sena et al.
empirically studied the exception flow and handler actions of java libraries to understand the exception handling strategies .
kechagia et al.
investigated the exception handling mechanisms of android apis .
other work focused on bugs related to exception handling.
for example ebert et al.
proposed a classification of exception handling bugs based on a survey and an analysis of java exception handling bugs .
coelho et al.
mined exception stack traces from android issues to investigate bug hazards related to exception handling code .
a few studies proposed techniques to automatically generate exception handling code.
a recent work from nguyen et al.
proposed to learn fuzzy logic rules from high quality programs to recommend exception handling code .
zhang et al.
proposed a neural approach that predicts the locations of try blocks and automatically completes catch blocks .
nonetheless most of these studies highlight program crashes or resource leakage as the consequences of error handling bugs.
our work pointed out that unthoughtful error handlings could also lead to confusing obscure and unhelpful error messages that seriously impede debugging.
.
debugging data science programs debugging data science programs has received much research attention in recent years.
zhang et al.
empirically studied the root causes symptoms and detection strategies of tensorflow program bugs .
islam et al.
investigated bug characteristics and fix patterns of popular deep learning libraries including caffe keras tensorflow theano and torch.
zhang et al.
analyzed real failures from a deep learning platform in microsoft and conducted developer interviews to understand debugging practice on deep learning jobs .
in addition to empirical studies researchers have also proposed techniques to automatically debug and test data science programs.
for example pham et al.
proposed cradle which detects bugs in deep learning libraries by leveraging crossimplementation inconsistency checking and anomaly propagation tracking .
zhang et al.
proposed a static analysis approach debar to detect numerical bugs in neural network architectures .
our study complements the previous work by examining the diagnostic capabilities of error messages in different debugging contexts of data science programs.
conclusion in this work we empirically demystified the causes and fixes of bad error messages in data science libraries.
we found that the misleadingness and uninformativeness of error messages are often inevitable and hard to fix since libraries are inherently unaware of user intentions and errors.
we also found that bad error messages are not equivalent to bad phrasing of message content given that source code and program logic changes are often required to fix error message related complaints.
we hope that these findings which significantly deepen the understanding of the origins perceptions and coping strategies of bad error messages could effectively steer future research in this field.