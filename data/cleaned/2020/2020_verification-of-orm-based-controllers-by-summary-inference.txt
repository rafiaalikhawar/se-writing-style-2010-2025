verification of orm based controllers by summary inference geetam chawla indian institute of science bangalore india geetam.chawla gmail.comnavneet aman indian institute of science bangalore india navneetankur gmail.comraghavan komondoor indian institute of science bangalore india raghavan iisc.ac.in ashish bokil indian institute of science bangalore india ashishsb iisc.ac.innilesh kharat indian institute of science bangalore india nileshramesh iisc.ac.in abstract inthisworkwedescribeanovelapproachformodeling analysis and verification of database accessing applications that use the orm object relationalmapping paradigm.
ratherthandirectly analyzeormcodetocheckspecificproperties ourapproachinfers ageneral purposerelationalalgebrasummaryofeachcontrollerintheapplication.thissummarycanthenbefedintoanyoff the shelf relationalalgebrasolvertocheckforpropertiesorspecifications given by a developer.
the summaries can also aid program understanding and may have other applications.
we have implemented ourapproachasaprototypetoolthatworksfor spring basedmvc applications.
a preliminary e valuation reveals that the approach is efficient andgives goodresults while checkinga setof properties given by human subjects.
ccs concepts software and its engineering software verification and validation softwarefunctionalproperties informationsystems web applications.
keywords program analysis database applications relational algebra acm reference format geetam chawla navneet aman raghavan komondoor ashish bokil andnileshkharat.
.verificationoform basedcontrollersbysummary inference.in 44thinternationalconferenceonsoftwareengineering icse may pittsburgh pa usa.
acm new york ny usa pages.
introduction mvc model view controller frameworks are regularly used to develop web applications and restfulservices .
an mvc application consists primarily of a set of controllers each of which receives requests directed to a specific url.
much of the core logic permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe firstpage.copyrights forcomponentsof thisworkowned byothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa copyright held by the owner author s .
publication rights licensed to acm.
acm isbn ... .
tdefaultpayment 2public string setdefaultpayment long defpayid model model principal pr incipal 3useruser userservice.f indbyusername principal .
getname 4userservice.setuserdefaultpayment defpayid user ... 8userservice public void setuserdefaultpayment long defpayid useruser 9list userpayment uplist uprepo.
findall 10for userpayment upiter uplist 11if upiter.getid defpayid upiter.setdefaultpayment true uprepo.save upiter else upiter.setdefaultpayment false uprepo.save upiter figure example controller in these controllers tends to be focused on fetching or updating data in databases.
therefore mvc frameworks commonly include orm objectrelationalmapping apis whichmakedatabaseaccess intuitive for programmers.
the orm idea is basically to let thedeveloperuseimperativeconstructssuchasloops andaccess or update a database table as if it were an in memory collection ofentities whereentitiesarein memoryobjectsrepresentingthe tuples in the database.
orm is frequently preferred by developers over embedded sql via odbc apis as it avoids impedance mismatchbetweensqlandimperativecodeaswellastype and schema related errors.
while the imperative flavor of orm code is intuitive to many developers mechanically checkingproperties ofimperativecodeismorechallengingthanmechanicallyreasoningaboutsql whichis declarative in nature.
we propose to bridge this gap by proposing inthispaperanovelapproachthatinfersadeclarativesummary inrelational algebra form of the database updates performed by a controller and of the model attributes that it may return.
ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa geetam chawla navneet aman raghavan komondoor ashish bokil and nilesh kharat .
motivating example figure depicts a controller1named setdefaultpayment from an open source book store application in spring.
the controller in turn calls the method setuserdefaultpayment .
this method first retrieves all user payment entities from a table named userpayment in line .
the repository variable uprepo corresponds to the table userpayment .
repository variables are spring sinterfacestodatabase tables eachrepositoryvariableimplicitlyprovidesmethodcallstoquerytheunderlyingtableusing the fields of the table and to save tuples into the underlying table.
in the example each userpayment entity represents a payment method e.g.
the information about a credit card .
each ofthese entities contains a field id which is the primary key aboolean field defaultpayment which encodes whether this paymentmethodisthe default paymentmethodornotforitsowninguser andafield type whichencodeswhetherthispaymentmethod is a credit card or a debit card etc.
in the loop in lines each userpayment entity s defaultpayment field is set to trueorfalsedepending on whether this entity s id fieldisequalornottothegivenargument defpayid .these updated entities are also saved back into the table userpayment.
a developer might want to check if the controller in figure satisfies certain properties.
consider the following example which we denote as property does the controller set to true resp.
false the defaultpayment field of a userpayment entity only if the entity s id field is equal resp.
not equal to the argument defpayid ?
this property is indeed satisfied by the code.
automatedcheckingofpropertiessuchastheonesabovewould enable the production of reliable software and this is the problem weaddressinthispaper.automatedpropertycheckingfororm controllersisachallengingproblem forafewdifferentreasons.thefirstisthatin memorycollectionsareusedtostorespecificsubsetsof database tables and these subsets typically need to be characterized with good precision by analysis techniques to find property violations.secondly ormcodefrequentlyusesimperativeloops to iterate over databases or collections.
generally loops are known to be challenging for automated property checking approaches.
.
our approach in this paper we propose a static analysis approach to infer sum maries in relational algebra form from orm controllers.
a summaryofacontrollermaps eachdatabasetablethatisupdatedina givencontrollerandeachreturnvaluefromthecontrollertoarelationalalgebraexpression.forthecontroller setdefaultpayment in figure in its inferred summary the expression for the table userpayment whichismappedtotherepositoryvariable uprepo would be as follows.
uprepo id true type id defpayid uprepo id false type id defpayid uprepo note theoccurrenceof uprepo withintherelationalalgebraexpression to the right of the refers to the incoming contents of the table userpayment when the controller is invoked while the 1the code shown is simplified in minor ways for ease of presentation.
also while we refer to each request handling method as a controller the general terminology is to refer to a class that may contain several request handling methods as a controller.for angbracketleftitr angbracketright angbracketleftcoll1 angbracketright if angbracketleftcond angbracketright angbracketleftcoll2 angbracketright.save angbracketlefttuple1 angbracketright else angbracketleftcoll2 angbracketright.save angbracketlefttuple2 angbracketright angbracketleftcoll2 angbracketright angbracketleftcoll2 angbracketright angbracketleftcoll1 angbracketright angbracketlefttuple1 angbracketright angbracketleftcond angbracketright angbracketleftcoll1 angbracketright angbracketlefttuple2 angbracketright angbracketleftcond angbracketright angbracketleftcoll1 angbracketright figure code pattern based rewrite rule occurrencetotheleftof denotestheupdatedcontentswhen thecontrollerfinishesexecution.also throughoutthispaperwe use a generalized form of the projection operator that allows anytupleofexpressionsinitssubscript andnotjustatupleoffield names.
saywewanttocheckproperty mentionedinsection1.
.the developer may specify this property as id defpayid defaultpayment false uprepo now anoff the shelfrelationalalgebrasolvercanbeusedtocheck that the inferred summary shown in equation logically implies thespecificationshownabove2 andhencedeclareproperty as holding.
summarizing loops such as the one in figure is similar to inferring loopinvariants.thisisknowntobeachallengingproblem in program analysis and would be especially so when loops iterateovercollections copyentitiesfromonecollectiontoanotherunder somecondition etc.tocircumventthisdifficulty weproposean efficientpattern basedrewritingtechniquetoinfersummariesof loops.
a pattern based rewrite rule that suffices for our example in figure1isdepictedinfigure2.thenameswithinanglebrackets aremeta variables whichmatchactualexpressionsinthecode.ifa rewrite rule s lhs left hand side matches a loop then intuitively thesummaryisobtainedbyinstantiatingtherhs righthandside pattern.
that is themeta variables in the rhs are replaced with their matching expressions as obtained from the lhs.
whenthelhsofthe patternshown infigure2ismatchedwith the loop in figure the meta variable angbracketleftitr angbracketrightmatches the iterator variable upiter angbracketleftcoll1 angbracketrightmatches the collection uplist and so on.
after uplist isdeterminedtobeequalto uprepo usingline9 inthecode theinstantiatedrhsbecomesequaltothesummary shown in equation .
notwithstanding the simplified intuition mentioned above the rewritingprocessisnotentirelysyntacticorstraightforward.for instance even though angbracketlefttuple1 angbracketrightsyntactically matches upiter in line of the code angbracketlefttuple1 angbracketrightis replaced in the inferred summary with id true type rather than with any