push button synthesis of watch companions for android apps cong li state key lab for novel software technology and department of computer science and technology nanjing university nanjing china congli smail.nju.edu.cnyanyan jiang state key lab for novel software technology and department of computer science and technology nanjing university nanjing china jyy nju.edu.cnchang xu state key lab for novel software technology and department of computer science and technology nanjing university nanjing china changxu nju.edu.cn abstract most android apps lack their counterparts on convenient smartwatch devices possibly due to non trivial engineering efforts requiredinthenewappdesignandcodedevelopment.inspiredby the observation that widgets on a smartphone can be mirrored to a smartwatch thispaperpresentsthejigsawframeworktogreatlyal leviatesuchengineeringefforts.particularly jigsawenablesapushbutton development of smartphone s companion watch apps by leveragingtheprogrammingbyexampleparadigm versionspace algebra and constraint solving.
our experiments on popular open source apps validated the effectiveness of our synthesis algorithm aswellastheirpracticalusefulnessinsynthesizingusable watch companions.
ccs concepts softwareanditsengineering softwaremaintenancetools application specific development environments .
keywords android apps wearos apps program synthesis acm reference format congli yanyanjiang andchangxu.
.push buttonsynthesisofwatch companionsforandroidapps.in 44thinternationalconferenceonsoftware engineering icse may pittsburgh pa usa.
acm new york ny usa 12pages.
introduction smartwatch is a fast growing market since apple watch s first release in .
it has been predicted that over million smartwatches will be shipped in and the market share of wearos an android variant designed for smartwatches will increaseby72.
in2022 .beinglightweightandconvenient smartwatches significantly reduce user s efforts for performing simple yet regular daily tasks e.g.
receiving notifications making aphonecall andaddingaquicknote .wearosalsoattracts developers attention every year google releases news and tutorialsonthedevelopmentofwearosappsonandroiddevsummit permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
and twitter spotify outlook and google family app all have official smartwatch counterparts on google play store.
however thereisaneasilyoverlookedgapbetweenthesmartphone developers and smartwatch hereafter watch apps making the prospect of watch apps left far behind the smartphone.
specifically watch apps speak a considerably different design language from smartphone apps due to limited screen space performance and battery life.
porting an app to the watch platformrequires non trivial engineering efforts including redesigning user experiences and adaptation to watch apis.
consequently thereareonly 000wearosappsingoogleplaystore while android apps are .
million.
for a majority of apps watch users cannot exploit the convenience that a watch brings.
as a first exploratory work to bridge the gap we observe that an android app s watch counterpart could be automatically syn thesized by mirroring smartphone widgets to a watch.
in other words a watch app can be effectively regarded as a smartphone app scompanion which acts as a remote agent when the on watch companion app is active it is always synchronized with its associated smartphone app running inbackground .thesynchronizationautomaticallymigrates a subset of widgets on the android app to the watch and renders them in a watch friendly gui layout.
watch users can interact with the migrated widgets.
all actions e.g.
clicks performedonthewatcharedelegated back to the background app on the smartphone whose gui changes are kept synchronized with the watch companion.
thisbridgingcansignificantlyreducetheengineeringeffortsrequiredfordevelopingwatchapps.forthisgoal thispaperpresents a framework called jigsaw for assisting developers in creating such smartphone companion apps as easily as push button.
jigsawleveragestheprogrammingbyexample paradigminwhich developers annotate positiveandnegativewidgetexamples widgetsshould notbemirrored overguilayoutdumps.then jigsaw automates all the rest by synthesizing a widget selector s a small piece of domainspecific language program more precisely a disjunction of xpathsformatchingpathsonanxmltree thatgeneralizes the developer sannotations.
stakes anygui layouttree as input and produces selects a subset of widgets that should be mirrored on the watch screen.
synthesizinganinstallablewatchcompanionapp byinstan tiatingatemplate forcommunicationswiththesmartphone and displaying mirrored widgets.
injectingabackgroundserverstubtothesmartphoneappfor monitoring gui changes applying the synthesized selector ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa cong li yanyan jiang and chang xu version space algebrapositive examplesnegative examples android app app gui model history calculation widget selector synthesis server stub applygrid synthesis recompose as grid displaydelegate eventandroid app companion client widget composition online widget selection offline programming by example ss w.r rw w. c cw r c figure1 jigsawoverview.withdeveloper annotatedexamplesontheguimodel jigsawforeachguimodelstatesynthesizes awidgetselector.whenthesmartphoneapp sguilayoutchangesatruntime itsassociatedwidgetselectorisactivatedtoselect widgetstomirror reorganizethemasagrid andsendthemtothewatchclientfordisplay.alluseractionsperformedonthewatch companion are delegated to the app.
s and solving a grid system for appropriately positioning selectedwidgetssuchthattherelativewidgetpositionson the smartphone can also be preserved on the watch.
weimplementedthejigsawsdk synthesizer appserverstub and watch client template for automating the development ofsmartwatch companion apps.
we evaluated jigsaw by creating watch companions for popular open source android apps all without a watch counterpart yet .
the results are encouraging that synthesizedwidgetselectorswellgeneralizeannotatedexamples withhighprecisionandrecall andselectedwidgetsareusefulin helping users complete real world user tasks.
insummary thispaper smajorcontributionisafirstexploratory report on the possibility of automating the process of synthesizing an android app s smartwatch companion.
we also open source our prototype tool and other supplementary materials to facilitate future research in this domain therestofthepaperisorganizedasfollows.wegiveanoverview of jigsawandexplainourmethodologyinsection .thejigsaw approach and implementation details of jigsaw sdk are presented in section .
we describe the evaluation in section 4and elaborate on related work in section .
this paper is concluded in section .
methodology the jigsaw workflow is shown in figure .
given annotated examples jigsaw produces aserver stub includingthe synthesized widget selector for the smartphone app and an installable wearos apk.
in this procedure we identified two key problems1 widgetselection howtodeterminewhichwidgetsshould be selected to mirror on the watch?
widgetcomposition howto re composeselectedwidgets to fit the watch screen?
the challenges and our methodology to mitigate them are explained below.
1other issues are mainly related to engineering.
.
widget selection programming by example modulo app states an android app may contain hundreds of guis and thousands of widgets but the developer may like to provide only a limited numberofannotatedexamples.itisthusnotpracticaltosynthesize a single widget selector that can generalize to all guis.
this brings our first challenge challenge .how to find a mechanism to effectively synthesize widget selectors from only a few examples?
the first step towards effective widget selector synthesis is to leverage the app s gui model to separately conduct program synthesis for each app state yielding smaller scale program synthe sisprobleminstances.specifically anapp sguimodelisafinite state machine in which homogeneous gui layouts share the same appstate2.itistherebynaturaltosynthesizeforeachappstatea separateselectorbecauseasingle concisewidgetselectorhardly generalizes well to drastically different gui layouts.
furthermore appstateswithoutexamplescanbeassignedwithatrivialwidget selectorthatselectsnowidget.suchabsenceofexamplesusually indicates that this app state may not have to be synchronized with the watch companion.
forexample adeveloper oradynamicanalysis may provide google calculator a gui model consisting oftwostates figure calculationandhistory.widgetselector synthesis is then conducted per state.
the simplified program synthesis sub problems make the powerful tool version space algebra a tractable choice for widget selector synthesis3.
particularly we designed an automaton based domain specific language dsl for describing a disjunction of xpaths denoted by directed graphs in which each edge is associated with a widget selection constraint.
applying the selector to any gui layout tree yields a set of selected widgets.
the synthesis procedure roughly works as follows.
for each positive example we construct its version space consisting of all possible selectors that arecompatible with thispositive example.
then weconduct 2suchmodelscanbedefinedbydevelopersorautomaticallyextractedbasedonthe activity s fragment s or execution traces .
3assumingthateachappstatecorrespondstoadifferentwidgetselector thesizeof version space intersections grows exponentially with the number of examples.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
push button synthesis of watch companions for android apps icse may pittsburgh pa usa !
!
!
!
figure gui layout for google calculator intersection generalization of version spaces until no further generalization can be performed.
disjunction of the xpaths in the remainder version spaces yields candidate widget selectors.
we filter out invalid selectors that select negative examples and rank the candidate for a balanced simplicity and generalizability.
forthemotivatingexampleofgooglecalculator infigure the synthesized selector for figure s calculation state is id main id display wherethefirstlineselectsthenumericandoperatorwidgetsand thesecond lineselectsthe formulaand calculationresultwidgets.
figure2displaystheguilayouttree.jigsawsynthesizestwoindependent xpaths because numeric and operator widgets sharethe maincontainer and the formula and calculation result share thedisplaycontainer.
we shall explain more about how a widget selector works and is synthesized later in section .
.
widgetcomposition solvingagridsystem the gui layout on the phone is synchronized with the watch by invokingthesynthesizedwidgetselectorwhenevertheapp sgui layoutchanges.then selectedwidgetsshouldbepositionedonthe watchinadeveloper friendlyway.thisyieldsoursecondchallenge challenge .howtoefficientlyassignboundboxesforon watch widgets to maximally preserve their relative positions at runtime?
our widget composition follows the grid system a classical and widely used paradigm in graphic and gui design .
specifically a grid system is an m nmatrix in which cells arecontainersofwidgets awidgetisallowedtooccupymultiple adjacent cells .
given n the number of columns by the developer jigsawsynthesizesaminimum m ngridsuchthatforanypairof selected phone widgets w1 w2 denotestherelativerelationof bound boxes i.e.
w1is to the left top of w2 w1 w2is preserved inthesynthesizedgrid.weintentionallymadealltheseconstraints linear such that constraint solving for practical guis can be done in milliseconds.
for the motivating example in figure jigsaw created constraints to enforce the formula widget to be placed above all other widgets yielding our synthesized layout.
push button synthesis of watch companions for android apps .
widget selection selector synthesis widgets and gui layout .
an android app s gui snapshot is a rooted tree figure in which nodes are widgetsand edges denote thedirectcontainingrelation.inaguilayouttree branchnodes are usually container widgets holding other widgets as children while leaf nodes display information and handle user events.
this paper defines a widget as a set of attribute value pairs where each pair denotes an attribute and its value.
widget selection by examples .
a widget is localized by its ancestors in the gui layout tree.
therefore this paper defines thewidget path for a widget was the widget list in the shortest path from the root container w1town win the gui layout tree wherewi 1is the direct parent of wifor all i n. jigsawtakesdeveloperorend userspecifiedpositiveandnegative example sets e ande elements of e ande are widget paths asinput4andsynthesizesa widgetselector apieceofdomainspecific language dsl program sthat accepts allexamples in e and rejects any example in e i.e.
e dblbracketlefts dblbracketright e dblbracketlefts dblbracketright in which dblbracketlefts dblbracketrightdenotes all widget paths scan accept.
widget selectors .
the syntax of widget selector sis defined as a disjunction of one or more xpaths x selector s x s x xpath x l x l level condition l condition attr op val attribute attr widget attribute e.g.
id operator op allowed operator e.g.
attribute value val attribute value the semantics of s dblbracketlefts dblbracketright all widget paths scan accept is defined by dblbracketlefts x dblbracketright dblbracketlefts dblbracketright dblbracketleftx dblbracketright where dblbracketleftx dblbracketrightdenotesallpossiblewidgetpaths xcanaccept.specifically givenawidgetpath anxpath xmatches dblbracketleftx dblbracketright if canbewrittenasaconcatenationof 1 2 msuchthatthe k thlevelcondition lkinx l1 l2 lmmatches kvia the following rules attr opval matchesexactlyonewidgetonlyifthewidget s attribute attrsatisfies the attr op val condition.
matchesexactly onewidget no matterits attributes.
can be regarded as an always true op.
matches zero or more widgets.
there is an additional requirement that xcannot end with .
for example x id formula textstartswith accepts all widget paths ifw2 sidisformulaandtext starts with .
another example is x for accepting all widget paths.
since our definition of xis a subset of the xpath standard we do not further formalize them.
4obtaining examples are easy even for an end user one can provide a gui tool for letting the users mark for the positive negative examples.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa cong li yanyan jiang and chang xu vs v2 v3 v4 vt figure graph representation of version space for widget path .r e d path derives xpath id pad numeric id digit 9. version spaces .
thesynthesisalgorithmis basedonthe version space algebra in which each positive example e is associated with its version space vs g v e a labeled directed graph with self loops and parallel edges for a conciserepresentation of all xpaths that can match .i ng v e each vertexvi v v1 ... vn corresponds to wi and e vi vj i j n vi vi i n vi vi l l lcond wi i n where lcond w isallpossiblelevelconditionsthatcanmatch w. specifically we found that the equality operator suffices for widget companion synthesis in practice5 i.e.
lcond w logicalandtext.
s s cond w cond w attr val attr val w .
given vs g v e there exists exactly one source vertex vs vwithout incoming edge not considering self loops and one sink vertex vt vof zero out degree.
each vs vtpath corresponds toan xpath bymapping each labelon the edge as a levelcondition l.furthermore gisacyclicifself loopsareremoved.
therefore wecandefine x g allxpathsderivedfrom g asthe xpathsforall vs vtpaths withoutconsecutive edges in g. figure3displaystheversionspaceofadigitwidget ingoogle calculator.
version spaces intersections .
intersecting two version spaces g v e andg prime v prime e prime yieldsthegraphrepresentationofxpaths thataresimultaneouslyacceptableto gandg prime.theintersection g intersectionsqg primeis also a graph g intersectionsq v intersectionsq e intersectionsq where v intersectionsq angbracketleftv v prime angbracketright v v v prime v prime e intersectionsq angbracketleftu u prime angbracketright angbracketleftv v prime angbracketright l intersectionsql prime u v l e u prime v prime l prime e prime intermsthat lmatchesv primeandl primematchesv theintersectionoflevel conditions l intersectionsql prime is defined by the conjunction of landl prime intersectionsq prime prime intersectionsq intersectionsq intersectionsq intersectionsq intersectionsq .
itiseasytoverifythatthereisexactlyonesourcevertexandone sink vertex in v intersectionsq and thus x g intersectionsq is well defined.
furthermore our intersection soundly captures the widgets paths acceptable to 5versionspacealgebrasupportsotheroperators e.g.
string startswith orcomparisons withconstants .however theseoperatorshaveonlylimitedmeritsinselecting widgets.algorithm widget selector synthesis 1function synthesizeselector e e vs e 3while g1 g2 .
trivial g1 intersectionsqg2 do g g argmax g1 g2 trivial g1 intersectionsqg2 barex barex braceleftbig g trivial g1 intersectionsqg2 intersectionsqg trivial g1 intersectionsqg trivial g2 intersectionsqg bracerightbig barex barex x g intersectionsqg2 max x g1 x g2 parenleftbig g g parenrightbig g intersectionsqg 6return s x1 x xi x gi gi e dblbracketlefts dblbracketright e dblbracketlefts dblbracketright xpathsinboth gandg prime i.e.
forall x x g andx prime x g prime that dblbracketleftx dblbracketright dblbracketleftx prime dblbracketright there exists x intersectionsq x g intersectionsqg prime such that dblbracketleftx dblbracketright dblbracketleftx prime dblbracketright dblbracketleftx intersectionsq dblbracketright.
readers may refer to supplementary material for a brief proof.
widgetselectorsynthesis .
synthesizing widget selectors is conceptually simple by intersecting all version spaces g v e intersectionsqdisplay.
e vs .
any xpath x x g that is consistent with positive negative examplesisafeasibleselector.however thesynthesisprocedure should be carefully handled in practice because the intersection of two graphs of o n vertices can have o n2 vertices.
this is an exponential growth with the number of examples.
intersecting version spaces may yield useless trivial gof whom all derived xpaths are equivalent to i.e.
trivial g latticetop x x g .
dblbracketleftx dblbracketright dblbracketleft dblbracketright.
thissuggeststhatwidgetsshouldbeseparatelyselectedwith disjunction .
therefore oursynthesisalgorithm algorithm heuristicallyintersects version spaces following existing literature .
specifically we maintain a pool of version spaces which initially contains each e s version space line .
in each iteration lines we greedily intersect two version spaces that potentially yield a minimal yet non trivial intersection line .
among non trivial intersections the preference score of g1 g2 is calculated by letting allg to vote line .
particularly gvotesfor g1 g2 if trivial g1 intersectionsqg2 intersectionsqg indicatingthat g1 intersectionsqg2makesitpossibletocontinueintersectingwith gin next iterations.
gvotes for g1 g2 iftrivial g1 intersectionsqg trivial g2 intersectionsqg indicatingthat g1 intersectionsqg2doesnotaffectafterwardintersections betweengand other version spaces.
ifmultiple gsharethesamenumberofvotes weadditionally considerthenumberofxpathsintheintersection thelast term which is always .
theintersectionisrepeateduntilallfurtherintersectionsaretrivial.
finally thesetofallwidgetselectorsthatcomplywiththeexamples line are returned as candidates.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
push button synthesis of watch companions for android apps icse may pittsburgh pa usa ranking candidate widget selectors .
all candidates s sare feasible selectors that are consistent with e ande .
among them we should choose a best selector that has the potential to generalizetounseenguilayouts.specifically let wbeallwidgetpaths in the example gui layout trees either positive or negative we prefer selectors that are structurally simple following the occam s razor while can simultaneously select as many widget paths intheexamplesaspossible i.e.
maximizing dblbracketlefts dblbracketright w forbetter generalizability.
therefore we choose the best candidate s argmin s s parenleftbigg complexity s maxs prime scomplexity s prime barex barex dblbracketlefts dblbracketright w barex barex maxs prime s barex barex dblbracketlefts prime dblbracketright w barex barex parenrightbigg as our synthesized widget selector in which the complexity s x1 x2 xn summationtext.
i ncomplexity xi and complexity x for xpath xis based on frequent patterns and anti patterns of level conditionsinxpaths.eachpatternisasinglelevelcondition e.g.
a consecutive level conditions e.g.
or a combination e.g.
associated with a positive negative score.
readers may refer to the supplementary material for all patterns.
.
widget composition grid synthesis assigning widget coordinates .
given a set of selected widgets w we assign each widget w wa cell position rw cw in the m ngrid where nisspecifiedbythedeveloperand misminimized by the constraint solver.
to preserve spatial locality we produce eachpairofwidgets w w prime walinearconstraint w w primethatifw is tothe top leftof w primeon thephone wshould bepositioned inan upper left cell of w primeon the watch.
specifically w w prime row w w prime col w w prime row w w prime r w rw prime m ifb w t w prime rw rw prime m ift w t w prime b w t w prime rw rw prime m ift w t w prime b w b w prime true otherwise col w w prime c w cw prime n ifr w l w prime cw cw prime n ifl w l w prime r w l w prime cw cw prime n ifl w l w prime r w r w prime true otherwise where functions t b l andrdenote the top bottom left and right bound boxesof awidget respectively.
forexample thefollowing constraints are produced for and digit 0 digit 9 true cdigit 0 cdigit 9 n digit 9 digit 0 rdigit 9 rdigit 0 m true.
we solve the conjunction of all above constraints w logicalanddisplay.
w w prime w w w prime to obtain each widget s grid position r c with a minimized m.i n the example rdigit 9 cdigit 9 rdigit 0 cdigit 0 .
reflowingwidgets .
sometimes constraintsolvingmayfailifthe specified grid is too narrow too small n .
for example selecting k widgets in a row requires n kto preserve their relative positions.
insuchacase wefindtheminimum n primetoyieldasatand reflowthem n primegrid toncolumns by wrapping the overflowed columns like the rendering of html divs .
furthermore a large widget may look better if it occupies multiplegridcellsonthewatch e.g.
the calculationresultinfigure .
consideringthatguicompositionisreal time insteadofadding further pressure to the constraint solver we allow developers to manually specify which widgets should span multiple columns.
suchwidgetsareusuallyamustintheselection andamissoften leads to a synthesis error.
.
prototype implementation we integrated the algorithms as jigsaw sdk consists of linesofpython 000linesofkotlin and 750linesoftypescript.
the sdk consists of three major components thesynthesizer jwsyn implementsthewidgetselectorsynthesisalgorithm section .
inwhichexamplesarerepresentedby annotateduiautomator dumps.observingthatalongchain ofnestedcontainerwidgetsslowsdownthesynthesisprocedure which is common in practical dumps jwsyn compresses the gui layout by removing container widgets with only one child.
considering that widget attributes except idcan only play a small role in selection generalization we implemented jwsyn as using the id attribute only by default.
however users can also configure jwsyn to open other attributes.
the server stub jwstub is a background service associated with the phone app.
jwstub privately maintains an internal activity stack for gui layout dumps.
delegated events are directly invoked through interfaces like activity dispatchtouchevent with inputmanager beingbypassed internallymaintainedguisare notsenttotherenderingpipeline .theservicemonitorsguilayout changes applies the synthesized widget selector and invokes an androidportofz3 tosolveconstraintstocomposetheselected widgets section .
.
finally jwstub is kept alive by starting itself in a detached thread to prevent being killed by the system s task manager.
the watch companion app template jwcli can be instantiated withdesignatedappid name andicontoyieldaninstallablewatch companion app apk .
jwcli contains code for communications withtheserverstub renderingcomposedwidgets6 andpushing on watchguievents e.g.
clicksandtextinputs backtotheserver stub.developersmayalsoaddnativescript cssstylestothe composed widgets in jwcli for pretty displaying of widgets.
evaluation this section presents the quantitative evaluation and results of the widgetselectionandcompositionprocess followedbyacasestudy of synthesized watch companions for practical usage scenarios.specifically we evaluate jigsaw around the following research questions rq1 widgetselection iswidgetselectioneffective wellgeneral izingdeveloperannotatedwidgets andefficient completing the synthesis within a reasonable amount of time ?
rq2 widgetcomposition doeswidgetcompositionappropriately place widgets on the watch screen of limited space?
6widgets with dynamic contents e.g.
webview cannot be efficiently ported to the resource limited watch and are rendered as imageview s in jwcli at present.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa cong li yanyan jiang and chang xu rq3 casestudy canthesynthesizedcompanionsupportsimple yetregularusertasksrelatedtotheapp scorefunctionalities?
.
experimental setup apps.
weevaluate jigsaw using16 real worldopen sourceapps whose userscan exploit a smartwatchto perform functionaltasks.
the first five apps googlecalculator gc k9mail k9 antennapod ap materialistic ma andaard2 aa arefrom frequentlyoccurringsubjectsintheevaluationofexistingandroidapp related research .
the other are randomly selectedpopularopen sourceappsfromthereading multimedia and internet categories of f droid fdroid fd newpipe np barinsta ba twidere tw slide sl redreader rr newsblur nb and trackercontrol tc nicefeed nf quickdic qd and radarweather rw .
we select these apps based on starsiftheyarehostedongithub gitlabor installsiftheyotherwise arereleasedongoogleplaystore.specifically 11selectedapps have at .2k stars and have 50k installs at the time of writing this paper.
we also included trackercontrol nicefeed and radarweatherbecausewebelievethatwatchcompanionswill be a great plus for them.
we evaluated the latest stable versions7of all subjects by the time this paper was written.
the supplementary materials contain further information.
ourexperimentsmainlyconcernwhetherjigsawcaneffectively automate thedevelopment of smartwatch companions.
wefound thatnoneoftheexperimentalsubjectshasawatchcounterpartyet meaningthegapbetweensmartphoneappdevelopersandwatch appsstillexists.wearguethatjigsawhasthepotentialtobridge this gap for its ease of use developing a watch companion only requires annotating a few gui layouts and injecting jwstub to the app with only two lines of code.
thus the rest of the evaluation focuses on effectiveness and efficiency studies.
rq1 widget selection .
widget selectors are synthesized on a per state basis.
we identified app states in which functionally criticalwidgetsexistandcouldbemirroredtothewatchaslisted in table1.
we specified a state by a set of state unique widgets denotedby itsuniqueid i.e.
weconsidertheapp atthisstateif all designated widgets are present.
this idea follows droidbot anddevelopersshouldhavenodifficultyinspecifyingstatesinthis way.
thenwedumpedoneguisnapshotforeachstateandcreatedthe guisnapshot scorrespondinghypotheticalwatchcompanion gui layoutonthewatch purelyonadeveloperbasis.weannotatedthe gui snapshot for positive negative widget examples to simulate adeveloper.weprovideda leastnumberofexamplesthatwefeel sufficient for generalization from a human perspective.
in total we provided155 .97perstateonaverage positive negativeexamples.
annotated gui layouts and the gui state information are the only inputs to jigsaw.
for a quantitative study of the effectiveness of our synthesis algorithm we further annotated each gui layout s ground truth widgets to or not to be mirrored on the watch by following the 7latest stable version denotes the developer s suggested version on f droid by the time of writing this paper.wearosdesignprinciples .weannotated505positivewidgets and negative widgets for the states ground truth widgets in total .
widgets selected by the synthesized widget selector will be checked against the ground truth for precision recall and f1 score.
our ground truths for the experiments examples hypothetical watchcompanions andannotatedwidgets areallsubjective and thestatistics e.g.
precision cannotdirectlyindicate theabsolute effectivenessof jigsaw.however wearguethatahighprecision strongly correlates to the high usefulness of jigsaw in practice.
this isbecause ahigh precisionindicates that jigsaw generalizes well from at least one developer s perspective.
rq2 widget composition .
gridsynthesisisevaluatedasaseparate problem.
specifically for each set of selected widgets inanswering rq1 we created its ground truth grid by manually positioningeachwidgetinabest lookingwaygiventheguilayout screenshot and the column number n. the similarity between a synthesized grid and the ground truth ismeasuredbythedistributionofdistancesbetweeneachwidget and its ground truth.
for a widget wbeing placed at rw cw by jigsaw and its ground truth r w c w we measure the euclidean distance w radicalbig cw c w rw r w and collect the mean and standard deviation parenleftbig mean w std2 w parenrightbig for evaluating the effectiveness of grid synthesis.
similartothestudyfor rq1 differentdevelopersmayprovide different ground truths.
however smaller mean and standard deviation docorrelate tobetter grids whichlook likethe best looking of widgets.
rq3 casestudy .
to study the real world applicability of synthesizedwatchcompanions wecreated57usertasks forthe16apps to simulate real world usages of a short piece of regular daily task onthewatchcompanion requiresafewguievents aslistedin table2.
the tasks are created by reading the app s descriptions on googleplaystoreandproposingthecorefunctionalitiesasifwe were the developers.
we simulate a user who interacts with the smartwatch companion synthesizedfromtheannotatedguistatesforanswering rq1 andrq2 for completing each task.
we use the following strict criteria for a task to be successfully performed the synthesized widget selector does not miss any functionally important widget the widgets are reasonably displayed on the watch the state transition of the companion is correct and the corresponding goal of the task is accomplished.
all tasks are created independently of the synthesis results.
succeedingcasesstronglyindicatethatthesynthesizedwatchcompan ionissuitableforsuchatask.evenfailedcases e.g.
theerroneously mirrored button in figure may still be useful to a watch user.
such cases may also be corrected by a developer with moderate effort.
8widget id based xpaths in our implementation is expected to generalize well to unseenguilayoutsofthesamestatebecause iddoesnotchangeoverindependent runs.
thus we did not further annotate gui layouts to reduce human labor.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
push button synthesis of watch companions for android apps icse may pittsburgh pa usa table effectiveness and efficiency of jigsaw.
ex is the number of examples.
v e xp are the vertex edge and xpath count in the synthesized widget selector.
exp all is the expected and all widget count of our ground truth.
t denotes time.
app state ex.selection offline composition online v e xp t m exp all prec rec f1t ms mean std2 1aard2 bookmarks .
.
.
.
.
.
.
2aard2 dictionaries .
.
.
.
.
.
.
3aard2 history .
.
.
.
.
.
.
4aard2 word .
.
.
.
.
.
.
5antennapod discover .
.
.
.
.
.
.
6antennapod episode .
.
.
.
.
.
.
7antennapod episodes .
.
.
.
.
.
.
8antennapod podcast .
.
.
.
.
.
.
9antennapod detail .
.
.
.
.
.
.
10barinsta feed .
.
.
.
.
.
.
11barinsta people .
.
.
.
.
.
.
12barinsta post .
.
.
.
.
.
.
13fdroid app detail .
.
.
.
.
.
.
14fdroid latest .
.
.
.
.
.
.
15googlecalculator calculator .
.
.
.
.
.
.
16k9mail eamil .
.
.
.
.
.
.
17k9mail inbox .
.
.
.
.
.
.
18materialistic main .
.
.
.
.
.
.
19materialistic story .
.
.
.
.
.
.
20newpipe trending .
.
.
.
.
.
.
21newsblur main .
.
.
.
.
.
.
22newsblur stories .
.
.
.
.
.
.
23newsblur story .
.
.
.
.
.
.
24nicefeed entry .
.
.
.
.
.
.
25nicefeed newentries .
.
.
.
.
.
.
26nicefeed starredentries .
.
.
.
.
.
.
27quickdic dictionary .
.
.
.
.
.
.
28quickdic manager .
.
.
.
.
.
.
29quickdic nav .
.
.
.
.
.
.
30quickdic word .
.
.
.
.
.
.
31radarweather weather .
.
.
.
.
.
.
32redreader r art .
.
.
.
.
.
.
33redreader r askreddit .
.
.
.
.
.
.
34redreader tags .
.
.
.
.
.
.
35slide all .
.
.
.
.
.
.
36slide reddit .
.
.
.
.
.
.
37trackercontrol main .
.
.
.
.
.
.
38twidere feed .
.
.
.
.
.
.
39twidere tweet .
.
.
.
.
.
.
summary .
.
.
.
.
.
.
.
.
.
summary .
overall theevaluationconsistsof39widgetselector synthesisproblemsand57real worldusertasksforthe16evaluated apps.fornon deterministicstatisticaldata e.g.
runningtime in rq1andrq2 wepresenttheaverageoverthreeruns.deterministic values e.g.
synthesis results are confirmed to be deterministic over all three runs.
all experiments were conducted on a oneplus 6t physical device and a wearos round chin watch emulator all default settings .
the host machine is a quad core intel i7 desktop with 32gib ram running ubuntu .
.
lts with an droid api .
detailed descriptions of the experimental subjects e.g.
annotatedwidgets groundtruth andsynthesizedselectors and results are included in the supplementary materials.
.
results for rq1 widget selection the selection block of table in blue displays the results of this experiment.
for each state jigsaw successfully returned anon trivial widget selector nonequivalent to within minutes the t column .
for most .
cases the syn thesis completed in a few seconds.
for nearly all .
cases thesynthesis completed withinone minute.
the mosttimeconsumingcase r art forredreader took18minutestosynthesizeaconsiderablycomplexselectorof35verticesand251edges.
the intersected version spaces g contain over 500k edges.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa cong li yanyan jiang and chang xu nevertheless westill considerararecaseof 18minutes asaffordable for developers because the synthesis is required only once for an app state.
applying the synthesized selectors to thegui layouts yielded 1739selectedwidgets where495 .
aretruepositivesthat are annotated in our ground truth.
for most .
gui layouts theselectedwidgetsarecompletelyconsistentwiththeground truth f1 score .
.
for nearly all .
gui layouts the selector produced mostly correct results with the ground truth with f1 score .
.
the precision exceeds for all cases except tweet of twidere and weather of radarweather .
for the tweet state jigsaw incorrectly selected invisible splitters among other sibling widgets that should instead be selected.
providing a negative example suffices for avoiding thisissue.
for the weather the app developer failed to add any id attribute to the example widget s container widgets9 and thus the synthesized overly generally selected redundant sibling widgets.
.
results for rq2 widget composition the composition blockoftable ingreen displaysourevaluation results for rq2.
grids are synthesized within a reasonable amountoftime.fornearlyall .
cases widgetcomposition is less than 100ms the t column and for half .
cases widgetcompositionisevenlessthan20ms.selectingmore widgetsonlargergridsgenerallyrequiresmoretime.alongcompositiontime 100ms happensonthe dictionary stateof quickdic 19widgets n the latest stateof fdroid 28widgets n and calculator state of googlecalc.
widgets n .
such issuescanbealleviatedbysofteningtheconstraints e.g.
bysolving the lp relaxation of the integer linear programming or providing the developer s hint on widget placements.
furthermore widget composition runs in background on the smartphone and will not block user interactions with the watch but will incur little latency on watch gui updates .
concerningtheconsistencywiththegroundtruth allselected widgets averagely shift .
column mean cells from the ground truthpositionwithavarianceof3.
columnstd2 .inotherwords widgetsaveragely1.41gridsawayfromtheir best looking positions butoccasionallypositionedinadrasticallydifferentway.for over half .
states the shift is zero i.e.
we synthesized exactly the best looking grid.
forthe worst looking gridsthathave 10averagecellshifts wefurtheranalyzedtheircauses.wefoundthatthe r askreddit .
and tags .
states of redreader were induced by uiautomatorwhichincorrectlysetthetopandbottomboundboxes of widgets falling on screen boundaries to be .
webelievethattheresultsinsections .2and4.3havedemonstratedtheeffectivenessandefficiencyof jigsawwidgetselector synthesis and widget composition.
figure 4displays a few succeeding and failed cases.
regular grids look good on a watch screen twidere fdroid .however sometimeswemayoverlygeneralize the selection to including unintended widgets twidere and materialistic .
we argue that developers can easily remove them.
9this should be an accessibility bug according to the android documentation .table2 practicalusefulnessofcompanions.
rq evisthe number of delegated all events.
delay displays the averagetimedelay ms fordelegatedevents.logandbwdenotethesize kb of generated logs and the bandwidth kb s whenconducting a task respectively.
app task succ rq ev delay log bw 1gc calc without del.
check14 .
.
.
2gc calc with del.
check15 .
.
.
3gc clear results check15 .
.
.
4fd explore apps check1 .
.
.
5fd check app info check6 .
.
.
6fd install app check4 .
.
.
7np browse trending list check1 .
.
.
8np open a trending video check2 .
.
.
9tc browse apps check1 .
.
.
10tc toggle block tracking check3 .
.
.
11ba browse all feeds check1 .
.
.
12ba open feed post check3 .
.
.
13ba check account info check4 .
.
.
14ba check account feed check4 .
.
.
15tw browse timeline check1 .
.
.
16tw open tweets .
.
.
17tw open retweets check4 .
.
.
18tw browse tweets comm.
check3 .
.
.
19k9 explore inbox check1 .
.
.
20k9 read email check3 .
.
.
21sl browse all reddits check1 .
.
.
22sl open reddit check3 .
.
.
23sl goto next prev reddit check5 .
.
.
24rr browse tags check1 .
.
.
25rr browse art reddits check3 .
.
.
26rr open reddit check3 .
.
.
27ma explore stories check1 .
.
.
28ma open stories .
.
.
29ma check comments .
.
.
30qd browse dictionaries .
.
.
31qd download dictionary check2 .
.
.
32qd open dictionary .
.
.
33qd open word check4 .
.
.
34qd return to manager check6 .
.
.
35aa see histories .
.
.
36aa see bookmarks check1 .
.
.
37aa browse dictionaries .
.
.
38aa disable dictionary check2 .
.
.
39aa open word check3 .
.
.
40aa goto next prev word check4 .
.
.
41nb browse all categories check1 .
.
.
42nb browse category check3 .
.
.
43nb go to next category check4 .
.
.
44nb open story .
.
.
45nf browse new entries check1 .
.
.
46nf goto starred entries 47nf browse starred entries check1 .
.
.
48nf open entry check3 .
.
.
49rw checkout weather check1 .
.
.
50rw swipe to next prev city 51ap navigate to discover 52ap browse episodes check1 .
.
.
53ap download episode check3 .
.
.
54ap explore discover check1 .
.
.
55ap open episode check3 .
.
.
56ap open podcast check2 .
.
.
57ap open podcast detail check1 .
.
.
summary .
.
.
.
.
.
results for rq3 case study table2presents the evaluation results.
we use the synthesized watch companion using gui states in table to complete the case study.
the experiment consists of real world user tasks witheachlastinglongfor4guieventsonaverage.amongthem authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
push button synthesis of watch companions for android apps icse may pittsburgh pa usa twidere fdroid googlecalc.
twidere materialistic success success successfailure incorrectly selected ... failure failed to load webview figure examples of synthesized watch companions jigsaw synthesized watch companions successfully accomplished most .
tasks.consideringthatthecriteriaofsuccess are strict all functionally important widgets are mirrored selected widgetsarewellplacedonthewatch andallstatetransitionsare correct the results are indeed promising.
since the synthesized watch companion is lightweight only forcommunication theaveragedelay theround triptimefrom pressing a widget on a watch until the gui is updated10 of nearly half .
tasksis 100msandthebandwidthofsome .
tasks are notably 10kb s. for cases of delay 200ms and bandwidth 50kb s wefoundthatthemainsourceisjigsawsdk s simpletreatmentfor imageview likewidgets.thistreatmentsimply dumpsthepixelsofsuchwidgets causingalargedatatransmission especially pixel dumps of webviews in communication but this can be alleviated by a more strict resolution adaptation.
we also summarize the failures cases as follows incorrectstaterepresentation .weerroneouslyidentified themulti tabguiinquickdicasthesamestateanddisplaysincorrectsetofwidgets.developersshouldhavenodifficulty in annotating correct gui states.
missed widgets .
our evaluation follows strict criteriathatwerecognizeataskasfailedifthewidgetselectormisses any functionally important widget.
a miss of such widgets indicates the synthesized companion losing some core functionalities of the app.
app accessibility bugs .
the app developers may not tag sufficient accessibility information on their apps.
for example thenavigationstateof materialisticcannotbe modeledbecausethe drawerwidgetmissesan idattribute.
as suggested by android s official documentation on accessibility these should be considered accessibility bugs.
implementationlimitations .finally jigsawhasitsown implementationlimitations.forexample thesimpletreat ment for webviewsometimes fails to capture the pixels especially when the content of webviewis not fully loaded figure4 .
in addition jigsaw s watch companion template currentlydoesnotsupporteventsotherthanclickandswipe.
10since the results of an event cannot be predicted jwstub directly returns once the guiis detectedtoupdate.
thissometimes causestheguis betweenthesmartphone andthesmartwatchtobeoutofsyncwhenthereareanimations.however thiscan be simply mitigated by a resync.
.
discussions usefulnessof jigsaw .
summarizingtheresultsintables 1and2 our experimental results are encouraging that the jigsaw s synthesizedwidgetselectorsandgridswellgeneralizeannotatedexamples with high precision and recall and the synthesized watch companion apps are useful in helping users complete real world user tasks.
theseresultsindicatethat automatingthecreationofsmartwatch companions for practical open source android apps can be possible.
jigsawmaybenefitthesmartwatchappdevelopmentcommunityinvariousways first jigsawenablesfastprototypingofwatchapps.proof of conceptwatchprototypescanbecreatedwithnearly trivial engineering efforts and the app users can immediately benefitfromtheconvenienceofasmartwatch.second theworkflow of jigsawmayalsoenableend userparticipatedcustomizationof watch companions.
different users may favor a different part of an app sfunctionalities.wecanletusersannotatewidgetsonthegui layoutdumps andjigsawwillproduceauser customizedwatch companion.finally wecallforfutureresearchonsmartwatchapps.
user customizableguiwidgetmirroringmayevenbeintegrated as a system wide service that continuously migrates anyapp s designated widgets to a smartwatch.
limitations .
first our implementation is specific to the constraintsonthe idattribute i.e.
assumingthatsiblingwidgetsshould eitherbeallselectedoronlyspecificonesareselected.therefore jigsawcannotgeneralizecomplexconstraintslikeawidget stext descriptionmatchingaregularexpression.versionspacealgebra cantheoretically handlesuchcases.
however thesynthesis could beslowandimpractical andthisiswhyweintentionallypreferred a simple algorithm .
this paper is mainly for demonstrating the possibility of automatic synthesis of watch companions and accelerating the synthesis can be orthogonal work.
second synthesizingstyles e.g.
spanabletexts fonts colors and borders isoutofthescopeofthispaper.thisisacommonpractice intheresearchcommunityofguilayoutgeneration because style synthesis is a considerably different problem that is more related to the field of computer human interaction.
jigsawisalsolimitedindisplayingdynamiccontents e.g.
videos andwebviews.
currently jwstub down samples the dynamic contents widget sscreenshotandrendersastaticimageonthewatch.
sometimes jwstub may fail when the dynamic content is not fully loaded e.g.
in table 2and materialistic in figure .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa cong li yanyan jiang and chang xu continuously tracking the changes of dynamic contents is consideredtooresource intensiveandimpractical.developersmayuse watch provided api e.g.
overlay to display such contents.
threatstovalidity .
anyhuman involvedstudycanincurthreats to validity.
the first threat to validity is that the evaluated tasks arecreatedbytheauthors whichmaybesubjecttobias.tobest alleviatethisthreat wetriedourbesttoreadeachapp sdescription on f droid and google play store if available intensively use theseapps andanalyzethecorefunctionalitiesasifwewerethe developers.
we also provide a detailed reproduction step of each task in our supplementary materials.
we believe that these efforts are sufficient for future research to replicate the case study and validate the case study results.
a similar threat also exists in the annotation creation of ground truths.forthem wemadeourbesteffortstoreadeachapp ssource code and documentation to best ensure that the annotated positive negative widgets correspond to the core functionalities of the app and the created grids follow the official wearos app principles .
furthermore we publicize our data selected examples and ground truths to facilitate future research.
considering that the currentprecisionresultsshowthatjigsawcanindeedproducewidgetsandlayoutscorrectlymatchingsomedevelopers expectations we believe that these results suggest the potential of our algorithm and the possibility of automating the creation of smartwatch companions acceptable and useful.
related work generating gui layout .
gui layout generation or synthesis which aims to automatically generate a gui layout is the most relevant domain to ours.
scrcpy isanopen sourcetoolthatgeneratesaguilayout by faithfully streaming an app s screen from a smartphone to a desktop.
since such streaming is conducted at a pixel level it does not support smaller screens for example smartwatch.
iuit has considered optimizing a web app s uis such that the uis can be automatically adapted to various screen sizes.
however iuit requires asufficientnumberofhigh qualitysmartwatchappsfortraining a statistical model.
this is not practical in the current app store.sui proposesaframeworktoadaptuisamongsmart phones tablets and tvs.
however sui requires to use the sui framework when the app is developed and does not support smartwatches.
jigsawcansynthesizewatchcompanionsforexistingappsthatare suitable to use in smartwatches.
theotherworkattempttogeneratethelayoutfromaguidesign.inferui andmockdowntakedeveloper providedgui designs on a single device as input and exploit programming by exampletosynthesizeacross device smartphone relationalgui layout e.g.
constraintlayout which loyallyrenders all widgets and preserves their relational positions on other devices.
never theless these approaches cannot scale to smartwatches as there lacks an available gui design.
similar work also considered generatingguilayouts e.g.
constraintlayout fromguidesignsusing deeplearning .comparedwithblack box approaches our approach synthesizes an interpretable program which the developer can read and modify.furthermore tothebestofourknowledge ourworkisthefirstto synthesizeawatchcompanionforanandroidappfullautomatically and require few examples.
programmingbyexample .
jigsawadoptsprogramsynthesisto synthesizeawidgetselector belongingtothefamilyofprogramming by examples .
our widget selector is inspired by regular expressions regex andregexsynthesis inwhichregexesaresynthesized by expanding the regex grammar.
different from such grammarand enumeration based approaches which may produce invalid regexes jigsaw avoids thisby designingand creatingthe version space of each example.
ontheotherhand thealgorithmof jigsawresemblesflashfill whichalsoexploitsagreedyversionspacealgebratosynthesize a regex like string program.
however the version space of our selector is considerably different from that of flashfill s and should be carefully designed and intersected.
other research on android apps .
different from ours much priorresearchonandroidconcernsthequalityofanapp.research like proposetogeneratetestscriptsthrough record and replay.
atm and craftdroid migrate existing tests to other similar apps fruiter evaluates their migrationresults.monkey andfollowers leverage test input generation to trigger more crashes.
there is alsoresearchconcentratingondetectingothernon functionalbugs for example network data loss and accessibility .
recently non crash bugs draw researcher s attention .
besidesquality thereisresearchfocusingonsecurity performance andresources .theyaregenerallyorthogonal to jigsaw and beyond the scope of this paper.
conclusion thispaperproposesthepush buttonsynthesisapproachtobridging the easily overlooked gap between android smartphone app developersandsmartwatches.ourjigsawframeworkalreadydemonstratedthepowerofautomaticallycreatingwatchcompanionsthat can help users accomplish real world tasks.
on the other hand as a first attempt in this research domain thispaperraisesmorequestionsthanitsolves.toenableapractical watch companion automation for everyone challenges include but arenotlimitedto automatingtheprocessofexampleannotation effectivesynthesisofcomplexselectors relaxingthegridconstraints synthesizingvisuallysatisfactorystylesheets andsynthesizingendusercustomizablewatchcompanions.thispapercallsforfuture research along this line.