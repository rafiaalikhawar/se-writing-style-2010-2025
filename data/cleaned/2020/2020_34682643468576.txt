lightweightand modularresource leak verification martin kellogg universityof washington seattle usa kelloggm cs.washington.edunarges shadab universityof california riverside usa nshad001 ucr.edumanusridharan universityof california riverside usa manu cs.ucr.edumichael d.ernst universityof washington seattle usa mernst cs.washington.edu abstract aresourceleakoccurswhenaprogramallocatesaresource suchas asocketorfilehandle butfailstodeallocateit.resourceleakscause resourcestarvation slowdowns andcrashes.previoustechniquesto prevent resource leaks are either unsound imprecise inapplicable to existing code slow oracombination ofthese.
static detection of resource leaks requires checking that deallocationmethodsarealwaysinvokedonrelevantobjectsbefore theybecomeunreachable.ourkeyinsightisthatleakdetectioncan bereducedtoanaccumulationproblem aclassoftypestateproblemsamenabletosoundandmodularcheckingwithouttheneed for a heavyweight whole program alias analysis.
the precision of anaccumulation analysis can be improved bycomputingtargeted aliasing information and we augmented our baseline checker with three such novel techniques a lightweight ownership transfer system aspecializedresourcealias analysis and asystemtocreate a freshobligation when anon final resourcefield is updated.
ourapproachoccupiesauniquesliceofthedesignspace itis soundandrunsrelativelyquickly takingminutesonprogramsthat astate of the artapproachtookhourstoanalyze .weimplemented our techniques for java in an open source tool called the resource leakchecker.theresourceleakcheckerrevealed49realresource leaks in widely deployed software.
it scales well has a manageable false positive rate comparable to the high confidence resource leak analysisbuilt into the eclipse ide and imposesonly a small annotation burden loc for developers.
ccs concepts software andits engineering software verification.
keywords pluggable type systems accumulation analysis static analysis typestate analysis resource leaks acm reference format martin kellogg narges shadab manu sridharan and michael d. ernst.
.
lightweight and modular resource leak verification.
in proceedings of the 29th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse august 23 28 athens greece.
acm new york ny usa pages.
.
.
both authors contributed equally to this research.
esec fse august 23 28 athens greece copyright held by the owner author s .
acm isbn .
introduction a resource leak occurs when some finite resource managed by the programmer is not explicitly disposed of.
in an unmanaged languagelikec thatexplicitresourcemightbememory inamanaged language like java it might be a file descriptor a socket or a databaseconnection.resourceleakscontinuetocauseseverefailures even in modern heavily used java applications .
this stateof the practice does not differ much from two decades ago .
microsoftengineersconsiderresourceleakstobeone ofthemost significant development challenges .
preventing resource leaks remainsan urgent difficult open problem.
ideally atoolfor preventing resourceleakswouldbe applicable to existing code withfew code changes sound sothatundetectedresourceleaksdonotslipintothe program precise so that developers are not bothered by excessive false positive warnings and fast sothatitscalestoreal worldprogramsanddevelopers can use itregularly.
extantapproachesfailatleastoneofthesecriteria.language based featuresmay not applyto alluses of resource variables java s trywith resourcesstatement forexample canonlycloseresource typesthatimplementthe java.lang.autocloseable interface and cannot handle common resource usage patterns that span multiple procedures.
heuristic bug finding tools for leaks such as those built into java ides including eclipse and intellij idea are fast and applicable to legacy code butthey are unsound.
interprocedural typestate or dataflow analyses achieve more precise results though they usually remain unsound but their whole program analysis can require hours to analyze a large scale java program.
finally ownership type systems as employed in languageslike rust can preventnearly all resourceleaks see section9.
but using them would require a significant rewrite for alegacycodebase asubstantial taskwhichis often infeasible.
the goal of aleak detector for ajava like language istoensure thatrequiredmethods suchas close arecalledonallrelevant objects we deem this a must call property.
verifying a must call property requires checking that required methods or must call obligations have been called at any point where an object may become unreachable.
a static verifier does this by computing an under approximationofinvokedmethods.ourkeyinsightisthat checkingofmust callpropertiesisan accumulationproblem and hence doesnot require heavyweightwhole program analysis.
our contributionisaresourceleakverifierthatleveragesthisinsightto satisfyallfourrequirements itisapplicable sound precise andfast.
anaccumulationanalysis isaspecial caseoftypestateanalysis .typestateanalysisattachesafinite statemachine fsm toeachprogramelementofagiventype andtransitionsthestateof 181this work is licensed under a creative commons attribution international .
license.
esec fse august athens greece martinkellogg nargesshadab manu sridharan andmichaeld.
ernst thefsmwheneverarelevantoperationisperformed.inanaccumulationanalysis theorderofoperationsperformedcannotchange what is subsequently permitted and executing more operations cannotaddadditionalrestrictions.unlikearbitrarytypestateanalyses accumulationanalysescanbebuildinasound modularfashion withoutanywhole programaliasanalysis improvingscalability andusability.
recent work presented an accumulation analysis for verifying that certain methods are invoked on each object before a specificcall e.g.
build .resourceleakcheckingissimilarinthat certain methods must be invoked on each object before it becomes unreachable.anobjectbecomesunreachablewhenitsreferences go out of scope or are overwritten.
by making an analogy between object unreachability points and method calls we show that resource leak checking is an accumulation problem and hence is amenableto sound modular andlightweightanalysis.
therearetwokeychallengesforthisleak checkingapproach.
first due to subtyping the declared type of a reference may not accurately represent its must call obligations we devised a simple typesystemtosoundlycapturetheseobligations.second theapproach is sound but highly imprecise more so than in previous work without targeted reasoning about aliasing.
the most importantpatterns to handle are copyingofresourcesviaparameters andreturns orstoringof resourcesinfinal fields the raiipattern wrappertypes whichsharetheirmust callobligationswith one oftheirfields and storing resources in non final fields which might be lazily initializedorwritten more thanonce.
toaddressthisneed weintroducedanintra proceduraldataflow analysisforaliastracking andextendeditwiththreesoundtechniques to improve precision alightweightownershiptransfersystem.thissystemindicates whichreferenceisresponsibleforresolvingamust callobligation.
unliketypicalownershiptype systems our approach does not impact the privilegesofnon owning