intention is all you need refining your code from your intention qi guo1 xiaofei xie2 shangqing liu3 ming hu2 xiaohong li1 and lei bu3 1tianjin university p.r.
china 2singapore management university singapore 3state key laboratory for novel software technology nanjing university p.r.
china bxguoqi tju.edu.cn xfxie smu.edu.sg shangqingliu nju.edu.cn ecnu hm .com xiaohongli tju.edu.cn bulei nju.edu.cn abstract code refinement aims to enhance existing code by addressing issues refactoring and optimizing to improve quality and meet specific requirements.
as software projects scale in size and complexity the traditional iterative exchange between reviewers and developers becomes increasingly burdensome.
while recent deep learning techniques have been explored to accelerate this process their performance remains limited primarily due to challenges in accurately understanding reviewers intents.
this paper proposes an intention based code refinement technique that enhances the conventional comment to code process by explicitly extracting reviewer intentions from the comments.
our approach consists of two key phases intention extraction and intention guided revision generation.
intention extraction categorizes comments using predefined templates while intention guided revision generation employs large language models llms to generate revised code based on these defined intentions.
three categories with eight subcategories are designed for comment transformation which is followed by a hybrid approach that combines rule based and llm based classifiers for accurate classification.
extensive experiments with five llms gpt4o gpt3.
deepseekv2 deepseek7b codeqwen7b under different prompting settings demonstrate that our approach achieves accuracy in intention extraction and up to in code refinement generation.
our results highlight the potential of our approach in enhancing data quality and improving the efficiency of code refinement.
index terms code refinement intention based generation large language model i. i ntroduction code refinement focuses on enhancing existing code by addressing potential issues refactoring and optimizing to improve quality and meet specific requirements .
it is particularly crucial in software development as projects grow larger and more complex .
according to an official report code review and refinement remain the most effective strategies for companies to improve code quality .
thus automated code refinement is crucial for software development .
traditionally the code refinement process involves two sequential phases .
initially code reviewers examine the code and provide feedback i.e.
review comments on any identified issues.
subsequently software developers modify the code based on these comments.
this process is this work was done during qi guo s visit to singapore management university.
shangqing liu and xiaohong li are corresponding authors.iterative with reviewers continuously identifying issues in subsequent refinements until the code is considered issue free.
reviewers and developers often rely on natural language for communication which can lead to a semantic gap that complicates their interactions making the process both cumbersome and time consuming .
a significant amount of work has been conducted to expedite this process.
despite these efforts the performance has remained limited.
for instance the stateof the art technique only has accuracy on the popular code refinement benchmark .
recent works have been exploring the feasibility of using large language models llms for code refinement.
however these techniques merely employ llms in a straightforward manner without designing effective solutions tailored to the specific characteristics of this task.
as a result they also fail to achieve satisfactory performance.
the primary issue with current research lies in the proposed techniques failing to accurately comprehend the reviewer s intent which is critical for code refinement.
the reasons can be primarily attributed to two aspects.
some reviewers write comments that are very vague and brief such as suggesting to delete a line of code without specifying the exact line number.
as a result models fail to learn the reviewer s precise intent.
guo et al.
further indicate that when the comments lack explicit location information or clear modification strategies even models like chatgpt underperform due to their inability to understand the intention.
on the other hand the models currently used in code refinement have limited learning capabilities and cannot handle complex scenarios effectively.
recent work shows that current code pretrained models such as t5cr and codereviewer are effective in automating basic code formatting improvements but struggle with more complex logical code modifications.
these models often overfit to simple refinements such as renaming a variable from atob while misinterpreting intricate tasks as trivial ones.
to address the aforementioned issues this paper proposes anintention based code refinement technique.
specifically we extract the intention from comments a structured and templated summary of the reviewer s modification intent.
a clearer extracted intention e.g.
an instruction to change atob leads to a more accurate code refinement.
unlikearxiv .08172v1 feb 2025conventional end to end code refinement which involves complex understanding challenges our approach decomposes the process into two sequential phases intention extraction and intention guided code modification generation.
in the first phase a predefined template is used to extract the intention from the reviewer s comments.
in the second phase large language models llms and rule based methods generate revised code based on the extracted intention rather than relying solely on potentially vague reviewer comments.
to define the intention templates for extracting intentions from comments we conducted a preliminary study on commits from github.
these commits were classified into three major categories based on their intentions explicit change suggestions reversion suggestions and other general suggestions.
while the first two categories convey clear intentions we further summarized six intention templates to capture the broader scope of general suggestions.
to accurately classify the comment category and extract the intention from a given review comment we propose a hybrid approach that combines rule based methods with llm based classifiers.
after the intentions are extracted we apply different prompting strategies including simple prompts retrieval augmented generation rag prompts and self generated prompts to explore the effect of various prompts for llms in the code refinement process.
to evaluate the effectiveness of our proposed approach we selected 5typical llms including gpt4o gpt3.
deepseekv2 deepseek7b and codeqwen7b for the experiments.
extensive experiments confirmed that our approach can achieve an accuracy of in intention extraction with a maximum accuracy of in generating revised code.
furthermore different prompt strategies exhibit varying performance across different models in code refinement.
in general the performance of rag prompts is stable.
lastly larger models with more excellent reasoning capabilities demonstrated more significant improvements with gpt4o and deepseekv2 showing accuracy enhancements of and percentage points respectively.
the main contributions of our paper are summarized as follows we reformulate the comment to code refinement process into two sequential steps comment to intent and intentto code generation.
this decomposition reduces task complexity and improves llms ability to understand reviewer intent.
we propose a hybrid approach incorporating rule based and llm based classifiers to extract the reviewer s intention accurately.
extensive experiments demonstrate the effectiveness of our approach achieving accuracy in intention extraction and up to accuracy in generating revised code.
ii.
b ackground and motivation a. code refinement in the code review process the developer first modifies the initial version of the code resulting in a second version.
themodifications made to the code are captured as the last code diff hunk denoted as lastcodediffhunk .
the reviewer then evaluates the last code diff hunk along with the second version of the code to provide review comments denoted asreviewcomment .
each review comment is linked to a specific line in the code denoted as reviewline .
subsequently the developer modifies the second version of the code based on the reviewer s comments generating the third version of the code that meets the reviewer s requirements.
this subsequent modification process is referred to as the code refinement task.
for clarity the second version is henceforth referred to as the originalcode and the third version as therevisedcode .
the traditional code refinement which we refer to as basic code refinement involves taking originalcode and reviewcomment as input and producing revisedcode as output.
however we found that in some tasks reviewline andlastcodediffhunk are needed to help understand thereviewcomment .
we define two new tasks to address these issues position aware code refinement which takes originalcode reviewline reviewcomment as input and comprehensive code refinement which takes originalcode reviewline reviewcomment and lastcodediffhunk as input.
b. motivation current approaches to code refinement are typically framed as end to end tasks where machine learning models are expected to generate revised code directly from input data.
this process often resembles a black box guesswork for the models lacking a complete reasoning process.
we draw inspiration from the approaches employed by human developers to tackle code refinement tasks enhancing the reasoning capabilities of large models by decomposing the complex task into subtasks intention understanding and code refinement guided by the extracted intention.
c. data collection currently there are two widely used datasets in the domain of code refinement the tufano dataset and the codereview dataset .
as previously discussed our research necessitates that the dataset provides the following five fields originalcode reviewline reviewcomment lastcodediffhunk andrevisedcode .
the tufano dataset lacks the lastcodediffhunk field and does not provide links to the original data.
although the codereview dataset lacks the reviewline andlastcodediffhunk fields it does provide links to the original data.
consequently we have chosen to use the codereview dataset and supplement the missing fields.
first we describe the method for obtaining the reviewline field.
we observed that by utilizing the github rest api to retrieve code review information it is possible to obtain a partial last code diff hunk referred to as the diff hunk field in the api s json response1 .
we term a partial last code diff hunk because it only provides the modification information preceding the review comment.
based on this pattern we can deduce that the review line corresponds to the last line of the partial last code diff hunk.
subsequently we need to design a method to obtain the complete lastcodediffhunk .
we observed that a single code review might encompass multiple commits reviewed by the reviewer.
if a given pull request comprises ncommits commit commit ... commit n the reviewer may choose to review all commits from commit mtocommit n where m n and then provide a review comment based on the accumulated file changes.
we sequentially traverse all preceding commits in reverse order and compare them with commit nto obtain the code diff hunk near the review line.
by comparing this with the partial last code diff we can identify the complete last code diff hunk that matches the partial last code diff hunk.
based on this method we can derive the lastcodediffhunk .
iii.
i ntention based framework a. understanding intention in code review when developers tackle code refinement tasks they begin by analyzing the reviewer s intention particularly code modification suggestions.
while the reviewcomment often provides these suggestions it may also contain unrelated information such as explanations of reasons polite expressions or even emojis.
additionally reviewcomment may include ambiguous