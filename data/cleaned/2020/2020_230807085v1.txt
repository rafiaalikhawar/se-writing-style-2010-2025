hue a user adaptive parser for hybrid logs junjielong xu siyuexi foxmail.com the chinese university of hong kong shenzhen chinaqiuai fu fuqiuai huawei.com huawei cloud computing technologies co. ltd. chinazhouruixing zhu zhuzhouruixing icloud.com the chinese university of hong kong shenzhen china yutong cheng link.cuhk.edu.cn the chinese university of hong kong shenzhen chinazhijing li zhijingbaby gmail.com the chinese university of hong kong shenzhen chinayuchi ma mayuchi1 huawei.com huawei cloud computing technologies co. ltd. china pinjia he hepinjia cuhk.edu.cn the chinese university of hong kong shenzhen china abstract log parsing which extracts log templates from semi structured logs and produces structured logs is the first and the most critical step in automated log analysis.
while existing log parsers have achieved decent results they suffer from two major limitations by design.
first they do not natively support hybrid logs that consist of both single line logs and multi line logs e.g.
java exception and hadoop counters .
second they fall short in integrating domain knowledge in parsing making it hard to identify ambiguous tokens in logs.
this paper defines a new research problem hybrid log parsing as a superset of traditional log parsing tasks and proposes hue the first attempt for hybrid log parsing via a user adaptive manner.
specifically hue converts each log message to a sequence of special wildcards using a key casting table and determines the log types via line aggregating and pattern extracting.
in addition hue can effectively utilize user feedback via a novel merge reject strategy making it possible to quickly adapt to complex and changing log templates.
we evaluated hue on three hybrid log datasets and sixteen widely used single line log datasets i.e.
loghub .
the results show that hue achieves an average grouping accuracy of .
on hybrid logs which largely outperforms the best results .
on average obtained by existing parsers.
hue also exhibits sota performance on single line log datasets.
furthermore hue has been successfully deployed in a real production environment for daily hybrid log parsing.
ccs concepts software and its engineering software creation and management .
keywords log analysis software reliabilityacm reference format junjielong xu qiuai fu zhouruixing zhu yutong cheng zhijing li yuchi ma and pinjia he .
.
hue a user adaptive parser for hybrid logs.
in proceedings of the 31st acm joint european software engineering conference and symposium on the foundations of software engineering esec fse .
acm new york ny usa pages.
introduction in recent years software systems such as online services e.g.
google search and bing search and system software e.g.
android and windows have become an integral part of our daily lives which generate extremely large amounts of software logs every day.
these logs can be used in various tasks e.g.
anomaly detection root cause analysis failure prediction log compression and user profile construction .
because of the rapid growth of the log volume it is difficult to identify valuable information from the massive log data manually.
to this end automatic log analysis has been widely studied in recent years.
the first step of automatic log analysis is log parsing which aims at extracting log templates and converting semi structured log messages into structured log messages for downstream tasks.
specifically the core task of log parsing is to distinguish between constants andvariables in log messages where constants are the tokens written by developers in the logging statements e.g.
a description of a software operation and variables are tokens that can change according to runtime environments e.g.
an ip address .
recent log parsers have achieved decent results on open source log datasets i.e.
loghub .
however they still suffer from two major limitations first existing parsers assume the incoming logs are single line and they try to extract the common pattern as templates line by line.
however in practice log messages could be multi line such as kpi tabular echos e.g.
cpu usage tracebacks e.g.
java exception and key value pairs e.g.
hadoop counters .
in addition due to the complexity of modern software and the centralized log collection corresponding authorarxiv .07085v1 aug 2023esec fse november san francisco usa xu et al.
no.
commitid label user va1 ne9112 va2 ne9112 bkp version info vmpu slot lpu slot authentication uid rhost .
.
.
user root header template parameters parsed logshybrid logs header template parameters header template parameters figure a simplified example of hybrid log parsing.
practice software logs could be hybrid where single line log messages mix with multi line log messages.
for example fig.
presents an example of hybrid log parsing that contains a single line log message and two multi line log messages.
in our opinion hybrid log parsing is a more general research problem that aims to parse either single line logs multi line logs or their mix while recent research mainly focuses on parsing single line logs.
second since the logging statements of these log messages are often inaccessible e.g.
written in third party libraries it is difficult to tell whether a token is a constant or a variable.
people could defines different templates for the same logs due to the disagreement on some ambiguous tokens.
for example recent research reports that the widely used parsing datasets loghub contains labeling errors which are typically caused by the difference in opinions.
in addition whether a log template is correct or not depends on the requirements of the downstream tasks.
for example in a real business scenario in huawei cloud the developer labeled log template for the console log display ipv6 is ipv6 in the root cause analysis task and display in the user profile construction task.
in practice many correct log templates can be summarized only with expert domain knowledge.
thus we argue that human feedback is the last mile in log parsing and a log parser that can effectively and efficiently integrate human feedback is highly in demand.
in this paper we introduce a new general and practical research problem hybrid log parsing which aims to parse single line logs multi line logs and their mix.
to this end we propose hue the first hybrid log parser that works in an online manner and efficiently adopts human feedback.
hue is simple yet effective.
hue adopts key casting line aggregating and pattern extracting to precisely parse complex hybrid logs.
we further design a novel mechanism that allows users to reject a template update on potentially ambiguous tokens.
we evaluate our approach on three hybrid log datasets collected from both open source software and huawei cloud s cloud services and sixteen widely used single line log datasets i.e.
loghub .
the results show that hue achieves an average grouping accuracy ga of .
which largely outperforms the best result obtained by existing parsers .
on average .
hue also exhibits sota accuracy on single line log parsing without leveraging the human feedback component achieving the highest ga on out of datasets which is the most among all compared mkdir cannot create directory home team7 results file exists mkdir cannot create directory home team7 results terasort file exists mkdir cannot create directory home team7 results bayes file exists mkdir cannot create directory home team7 results pagerank file exists traceback most recent call last file hibench3 bin functions load config.py line in module load config conf root workload configfile workload folder patching config file hibench3 bin functions load config.py line in load config generate optional value file hibench3 bin functions load config.py line in generate optional value probe masters slaves hostnames file hibench3 bin functions load config.py line in probe masters slaves hostnames probe masters slaves by yarn file hibench3 bin functions load config.py line in probe masters slaves by yarn assert get workers from yarn site.xml page failed.
assertionerror get workers from yarn site.xml page failed.
parsing conf home team7 hibench3 conf hadoop.conf parsing conf home team7 hibench3 conf hibench.conf parsing conf home team7 hibench3 conf spark.conf parsing conf home team7 hibench3 conf workloads micro terasort.conf display configuration commit list no.
commitid label user timestamp td begin backroll root root figure an example of hybrid logs collected from an industrial log management platform.
parsers.
hue has been successfully deployed in the cloud services in huawei cloud to parse daily hybrid logs.
this paper makes the following main contributions it introduces a new general and practical research problem hybrid log parsing which is a superset of the existing singleline log parsing problem.
it proposes hue the first log parser that natively supports hybrid log parsing and has a human feedback integration mechanism that largely reduces unnecessary queries.
it presents the evaluation of hue using three hybrid log datasets and sixteen single line log datasets demonstrating that hue achieves sota accuracy and efficiency on both hybrid and single line logs.
it releases two hybrid log datasets collected from open source software and cloud system for this research direction.
motivation this section intends to further explain the two major limitations of existing parsers that motivates our work.
the following is mainly inspired by and summarized from our collaboration experience with engineers in huawei cloud.
.
neglected hybrid logs hybrid logs are a common type of data in the software industry.
as shown in fig.
they are usually generated from cloud platforms and can contain a mixed combination of single line and multi line log messages.
the hybrid nature of the logs is often caused by permission restrictions between different service departments within an organization.
in particular it operators may not be able to access logs in all components directly and must instead use a log aggregation system to gather all the service outputs for centralized management.
this means that hybrid logs may contain a variety of log types including single line logs such as component event logs and multi line logs such as console echoes exception traceback and even tabular system key performance indicators kpis .
hybrid logs are not only found in closed source software but they are also commonly encountered in open source components such as hadoop spark and mysql.
this highlights the widespread availability of hybrid logs in both closed source and open source software.hue a user adaptive parser for hybrid logs esec fse november san francisco usa open through proxy proxy.amazon.com httpsopen through proxy socks.google.com socks5open through proxy open through proxy socks5 open through proxy httpsparsed template case merge parsed template case split situation parsing without source code reset clockreset ipv6 ipv6parsed template case root cause analysis situation parsing for different downstream tasks parsed template case user profile constructiondisplay clockdisplay ipv6 clock display reset figure two typical situations that difficult for the parser to determine the template automatically.
hybrid logs contain valuable information that can be utilized in many downstream tasks including it operators using the traceback for failure prediction and root cause analysis qa engineers selectively testing apis through kpi tables and commercialization departments constructing user profiles from console echoes to target potential user needs.
however the structural variability of hybrid logs presents a challenge for current log parsers leading to them ignoring these logs during training and deployment.
if single line parsers are used in pipelines they tend to split a multiline log message into multiple lines of text and regard each line as a separate single line log message leading to incorrect parsing results.
even if it operators try to use special regex to flatten hybrid logs tabular messages may still not be parsed correctly because of the uncertainty in the number of table rows.
to address these issues this paper proposes key casting sec.
.
and line aggregating techniques sec.
.
.
the limitations of existing work are further discussed in our experiments sec.
.
.
.
ambiguous template tokens recent research found that different people could generate different log templates because of ambiguous tokens .
in huawei cloud there are two typical situations that confuse parsers.
whether to merge two candidate templates by turning a constant into a variable.
for example in fig.
situation it is debatable whether the two logs belong to the same event and should be merged .
a log message could have multiple correct templates when it was used by different downstream tasks.
for example in fig.
situation for user profiling modeling the analyst cares about the instructions and actions the user performed whereas for root cause analysis the analyst cares about the object being manipulated.
the difference in their preferences leads to different correct log templates.
to improve the compatibility and generalizability of the log templates generated in log parsing we introduce an efficient manual feedback mechanism sec.
.
that works seamlessly within a parse tree and effectively improves parsing accuracy with little manual involvement.
the benefits of this mechanism are further explained in our experiments sec.
.
.
preliminary this section intends to introduce the main concepts in hybrid log parsing especially our definition and the characteristics of hybrid logand the input and output of hybrid log parsing .
.
hybrid logs hybrid logs could be single line logs multi line logs or their mix.
based on our experience with hybrid log analysis in huawei cloud in this paper we mainly consider three kinds of logs in hybrid logs event logs single line table logs multi line and text logs multi line .
for example in fig.
line and line are event logs line is a text log and line is a table log.
.
.
event log.
event logs are single line log messages.
an event log records an operation or status of a service or component and contains a log header and message content.
to align with the definition in existing single line log parsing research an event log s template consists of constants in the log message and wildcards that indicate variables.
.
.
table log.
table logs are multi line logs that contain a table header multiple lines of parameters and potentially table lines.
table logs with the same log template have the same number of table columns and the token data type in the same column is the same e.g.
the timestamps in the last column in the table log in fig.
might have different numbers of rows.
typical table logs contain various system metrics and these logs are often generated by the performance testing component in the cloud and the echoes from the user shell.
since the header of the table logs consists of the key information i.e.
column number and column types that distinguishes between different tables the template of a table log is the table header while the table content is regarded as parameters in the parsed log message as illustrated in fig.
.
therefore the goal of log parsing on table logs is to extract its table header and transform its table content into parameters.
.
.
text log.
text logs are multi line logs that do not fall into the table log category.
text logs record the detailed information in addition to the system event in plain text such as traceback call stack in a program or database content in the form of key value pairs.
text logs are widely available in many components such as hadoop spark and mysql.
however to the best of our knowledge only a little log analysis research utilized this kind of log and we think one of the main reasons is that existing log parsers cannot accurately parse text logs.
we define the template of a text log as tokens in several lines that remain constant such as the traceback error type or the keys in the message.
thus the goal of log parsing on text logs is to extract these lines from the message.
.
hybrid log parsing the goal of hybrid log parsing is to extract log templates from log messages and generated structured logs accordingly.
in our opinion hybrid log parsing which focuses on single line logs multi line logs and their mix is a superset of existing log parsing research that targets single line logs.
the output of this task includes a meta file that contains the template of each log message and itsesec fse november san francisco usa xu et al.
location in the original log file and files with structured variable lists e.g.
headers and parameters in each log type.
in this paper we view hybrid log parsing as a classification problem.
given a raw log message lconsisting of ntokens across l lines denoted as a hybrid log parser should predict the typetof log message l the log template group gt k gt gt gt ... gt n it belongs to among the total ntemplates in type t and whether a token tiis a constant yi or a variable yi .
finally the log parser must output its predictions in a structured format.
hybrid log parsing is challenging because it is non trivial to automatically distinguish between different types of logs when they are mixed and identify the constants and variables in them.
approach .
overview this section introduces hue an unsupervised online log parser that utilizes a heuristic parse tree and an efficient human feedback integration mechanism.
the overview of hue is presented in fig.
which contains four main components key casting line aggregating pattern extracting and online updating.
specifically hue streamly reads the log data line by line splits each line into tokens by spaces and sends the raw token sequence to main components for parsing first key casting transforms part of the tokens into keys i.e.
special wildcards indicating representative token data type.
for instance a raw token sequence with ntokens sraw can be casted to a new token sequence s where eachkrepresents a specific key.
when all lines in a log are fully casted line aggregating combines adjacent token sequences into blocks i.e.
lists of adjacent token sequence via heuristic rules.
for example a log with llinesl can be aggregated to l ... which contains kblocks.
then pattern extracting ultilizes aggregated blocks to obtain log tempates.
finally online parsing revises the current log template in an online manner with the guidance of an optional human feedback mechanism.
note that hybrid logs could be single line logs multi line logs or their mix thus hue which is the first hybrid log parser can be utilized to parse single line logs as existing parsers.
.
key casting preprocessing has been widely adopted by existing parsers.
a typical preprocessing process identifies common variables e.g.
ip address by regular expressions and then either remove the identified tokens or replaces them with the wildcard .
however these preprocessing strategies are not effective when dealing with hybrid logs.
which may contain table logs and text logs.
table logs have lines with only variables which would be all removed or transformed into the same wildcard by existing preprocessing strategies leading to significant inaccuracy.
in addition these strategies might exacerbate the difficulty of distinguishing text logs from table logs.
to address this problem it is possible to manually configure a list of delimiters for each system separately.
however this is impractical for hybrid logs because they are often collected from different system components or even different systems.
hue adopts a novel preprocessing strategy called key casting .
the main idea is to use different wildcards e.g.
int and ip to better encodes prior knowledge in preprocessing.
hue split a line by spaces and transforms tokens that have been commonly used as variables e.g.
ip addresses file paths boolean values into the corresponding wildcards called keys according to a general casting table.
for example in fig.
authentication uid rhost .
.
.
user root would be transformed into authentication uid int rhost ip user root .
key casting is simple yet effective for hybrid log parsing and we believe it could also benefit existing log parsing approaches as a general preprocessing strategy.
in our implementation we construct a general key casting table for all datasets which contains seven kinds of keys as illustrated in fig.
.
users can also easily customize their own key casting table by changing one line of code.
.
line aggregating to correctly parse hybrid logs identifying log type is critical.
intuitively using line numbers to identify event logs is relatively easy but distinguishing between table logs and text logs is challenging because both of them have a multi line structure.
to overcome this issue we propose line aggregating to differentiate between table logs and text logs.
specifically we observe that adjacent lines in table logs tend to exhibit higher similarity whereas in text logs although adjacent lines are less similar they often share the same indentation.
thus hue aggregates adjacent lines in multi line logs and identifies log types based on adjacent lines sequence similarity and indent number.
the workflow of line aggregating is shown in algo.
.
hue first determines whether the current log is an event log by checking if it only consists of single line line .
if the log has multiple lines hue sequentially aggregates adjacent lines into several blocks sec.
.
if sequence similarity exceeds the aggregating similarity threshold a i.e.
a hyperparameter determined before parsing or they have the same indentation line .
then hue utilizes atype counter cto keep track of the predominant reason in the aggregation process line if c sequence similarity is the primary reason for aggregating suggesting that the log should be a table log if c indentation number is the primary reason for aggregating suggesting that the log should be a text log.
finally hue utilizes the aggregated logs for subsequent pattern extraction.
to enhance understandability we also provide an example of line aggregating for text logs in fig.
.
specifically similarity sim s1 s2 represents the proportion of identical tokens at the same positions in two sequences eq.
where nis their average token length andequ t1 t2 measures the equality of two tokens eq.
.
sim s1 s2 n i 1equ s1 s2 n equ t1 t2 1ift1 t2 0ift1 t2 notably there are a few details in implementing line aggregating lines consisting of only delimiters or null characters should be skipped.
based on our observation in both open source and industrial software hybrid logs are often preceded by log headers which can serve as delimiters between logs.hue a user adaptive parser for hybrid logs esec fse november san francisco usa authentication uid rhost .
.
.
user root traceback most recent call last file bin functions demo.py line in module file bin functions demo.py line in demo file bin functions config.py line in parse file bin functions utils protobuf.py line in parse keyerror config worker.protobuf does not exist raw logs !
authentication uid int rhost ip user root !
traceback most recent call last file dir line int in module file dir line int in demo file dir line int in parse file dir line int in parse keyerror dir does not exist key casting headers !
file paths dir urls url ip addresses ip integers int booleans bool splitters ?
line aggregating event log text log table log pattern extracting n t n k parsed logs merge queries feedback auto updating guided updatinglog type event log log type event log tuple n t n k identifier authentication uid int rhost ip user root ground truth template log type text log file dir line int in module file dir line int in demo file dir line int in parse file dir line int in parse log type text log tuple n t n k identifier traceback most recent call last keyerror dir does not exist ground truth template root figure the overview of hue with two examples.
users can customize the key casting table and provide feedback to optimize hue for more complex data types and usage scenarios based on the target data characteristics and their own domain expertise.
file dir line int in module traceback most recent call last file dir line int in parsefile dir line int in demo file dir line int in parse keyerror dir does not exist in path file dir line int in module file dir line int in demo file dir line int in parse file dir line int in parse traceback most recent call last file dir line int in module file dir line int in demo file dir line int in parse file dir line int in parse keyerror dir does not exist in path sim a diff indents separate c sim a same indents aggregate c sim a same indents aggregate c sim a same indents aggregate c sim a diff indents separate c c text log casted log aggregated log log type text log line aggregating figure an example of line aggregating.
assume a .
algorithm line aggregation type determination input sequence queue of current message q s1 s2 .... sn aggregating similarity threshold a log typet event block queueqb last block blast s1 if q 1then type counterc forsi qdo sblast the common sequence of all s blast ifsim si sblast athen c c blast blast si else ifsiandsblasthave the same indents then c c blast blast si else qb qb blast blast si end if end for t table ifc else t text end if qb qb blast output qb t4.
pattern extracting to extract log templates log parsers often first group logs with the same template into the same group .
traditional log parsers often use complete log messages all tokens for clustering which is inefficient in hybrid log parsing shown in fig.
because a hybrid log message can be very long after flattened.
in addition the line number of multi line logs from the same template group can vary greatly leading to low accuracy in message level clustering.
to tackle these challenges hue proposed pattern extracting which utilizes the block queue qband log type tobtained from line aggregating to group logs with the same templates.
as shown in fig.
hue uses a special sequence of each log the log identifier sid which may contain a log template as defined in sec.
as a manual feature.
hue assumes that logs from the same template have similarsid and uses this information to group logs.
specifically sidis the entire sequence for an event log the concatenated common sequences from the first and last blocks for a text log and the sequence of the first block with a capacity of one before the first block with a capacity greater than one for a table log.
the choice of the identifier is based on an assumption that text logs often have template tokens at the beginning or end e.g.
error type and that table headers are typically distinct and should be aggregated with the table content.
as shown in fig.
.
.
.
coarse grained grouping.
to group logs hue counts the number of tokens and keys in each log s identifier sid creating a tuple nt nk .
the logs are then assigned to the group with the same tuple.
this process is based on two assumptions identifiers from the same template have the same token number identifiers from the same template have the same key number.
the first assumption is commonly used and has been verified in previous research where the identifiers of event logs are themselves.
.
.
fine grained grouping.
to further group the logs hue uses a multinomial search tree with a unique search rule for each tuple nt nk .
first the tree forks based on the keys in the nklayer and then forks based on non key prefix tokens in the next npesec fse november san francisco usa xu et al.
open through proxy proxy.google.com https open through proxy proxy.amazon.com https close from proxy proxy.google.com https connect to resourcemanager at .
.
.
connection closed by .
.
.
open through proxy socks.google.com socks5 key casting coarse grained grouping fine grained grouping root ip url close open connect old s t open through proxy url httpsnew s id open through proxy url socks5online parsing merge query new s t open through proxy url socks5 new s t open through proxy url httpscurrent line connectionroot ip new s t open through proxy url n t n k open through proxy url https n t n k open through proxy url https n t n k close through proxy url https n t n k connect to resourcemanager at ip n t n k connection closed by ip n t n k open through proxy url socks5 figure an example of pattern extracting and guided online parsing for event logs.
assume maximum tree depth is np nt nk layer.
the tree is initialized with only one root node.
hue creates a new node each time when a new identifier sidcomes and no corresponding node exists at the current layer.
this forking strategy is based on the assumption that template tokens are often at the beginning and variable tokens are often at the end of logs.
to further improve the accuracy of parsing hue allows setting limits on tree depth and identifier length.
this helps prevent too long or too short logs from affecting the parsing accuracy by creating incorrect parsing rules.
identifiers not meeting the length criteria will be assigned to a designated group for similarity matching rather than going through the tree.
.
online parsing upon asidreaching a leaf node hue performs online parsing which involves obtaining current log s template and updating the outdated template in each log group.
it assigns the current log to a specific log group obtains the group template st i.e.
the common sequence of logs sidin the group as the current log s template and dynamically updates stwith new incoming sid.
previous studies commonly employed automatic template updates and maintenance which may be ineffective for parsing logs with ambiguous tokens as discussed in sec.
.
.
therefore hue introduces a guided updating mechanism to enhance parsing performance for log files with ambiguous logs while retaining the classic auto updating mechanism for regular log files.
the following sections provide a detailed explanation of the two updating methods.
.
.
auto updating.
hue calculates the similarity eq.
between sidand all groups templates within current node.
if a template st has the highest similarity score that exceeds the merging similarity threshold m i.e.
a hyperparameter determined before parsing hue will update the template to be the common sequence of sid and the original template st i.e.
st sid st .
if no such templates exist hue creates a new template and initializes it as sid.
by continuously updating and outputting log templates based on the newly added sid hue achieves log parsing in an online manner.
.
.
guided updating.
hue still calculates the similarity eq.
betweensidand all templates in node.
however instead of solely relying on mto perform updating hue introduces a merge reject strategy that allows users to reject a template merge on a potentially ambiguous token in candidate templates.
specifically hue first conducts a check whether tokens requiring updating in stcontain non key tokens?
if yes it triggers a merge query i.e.
output current standsid and prompts the user to decide whether to reject the automatic merging and updating process.
if rejected hue creates a new group under the same leaf node initializing it with sidas the template.
otherwise the merging process continues and stis updated with the common sequence of tokens between standsid.
the two cases i.e.
trigger a merge query or not are illustrated with examples in fig.
.
the idea of developing a human feedback mechanism was inspired by a recent parser spine .
however hue provides a different and more efficient mechanism.
specifically hue largely reduces the frequency of triggered queries by skipping the updates of keys.
this is because the keys are casted parameter tokens in the preprocessing and the ambiguous tokens are non key tokens.
in addition hue does not involve numerical computation to determine whether a merging process should trigger a query in guided mode making it efficient in development scenarios.
experiments we conducted extensive experiments on public datasets and industrial datasets to answer the following research questions rq1 how accurate and efficient is hue on hybrid logs?
rq2 how accurate and efficient is hue on single line logs?
rq3 how effective is hue s human feedback integration mechanism?
.
experiment setup .
.
implementation.
all of the experiments were performed on a virtual machine with intel r xeon r platinum 8375c cpu .90ghz processors and 94gb ram on ubuntu .
.
lts.
we implemented hue in python .
.
with the same key casting table shown in fig.
.
additionally we implemented specific hyperparameter configuration files to manage all hue s hyperparameters for each log source.
specifically the hyperparameters include the maximum tree depth the maximum and minimum identifiers length the aggregating similarity threshold a and the merging similarity threshold m. similar to previous works hyperparameters are only related to the log file source and remain unchanged during the parsing process after being determined byhue a user adaptive parser for hybrid logs esec fse november san francisco usa s t error get worker int from ip faileds id error get worker int from dir failed case merge without query the tokens to be updated are all keys s t error get worker int from ip faileds id error get config int from dir failedcase merge with query the tokens to be updated contain non key tokens.
does not trigger merge query new s t error get int from failedmerge querynew s t error get worker int from failed sim .
m new s t error get config int from dir failed new s t error get worker int from ip failed sim .
m figure two cases of guided updating mode.
the updates of keys do not need human guidance since they are typically considered as non ambiguous tokens.
assume m .
grid search a common hyperparameter tuning method on smallscale homogeneous log data i.e.
random samples for each dataset .
notably in experiments we observed that setting the munder the guided updating mode denoted as mg to be approximately .
lower than munder the auto updating mode denoted as ma will result in better parsing performance for most log sources.
to avoid frequent editing of configuration files when switching updating modes we introduced an elastic variable e ma mgto optimize the performance in both modes.
specifically eis typically set to .2by default.
only in a small amount of log sources eneed to be changed to further enhance parsing performance.
.
.
datasets.
our experiments are conducted on log datasets including single line log datasets from logpai and hybrid log datasets collected by us.
the logpai datasets cover a variety of log types including os logs app logs and microserver logs with 2k messages each and to templates.
the hybrid datasets consist of runtime logs generated by a cloud system benchmark hibench multi source logs collected by a cloud testing system cts and multi terminal logs collected in paas product in huawei cloud paas .
we manually labeled all hybrid log datasets and released the first two datasets for replication.
table.
presents the statistics of these datasets.
all of these datasets include ground truth labels.
table dataset statistics of hybrid log datasets.
num.
event table text hibench cts paas message num.
template num.
.
.
metrics.
our evaluation uses two commonly used metrics grouping accuracy and template f1 score .
the former measures the proportion of correctly parsed log messages while the latter measures the f1 score of the generated templates from the parser.
we use these metrics to conduct fair comparisons at both the message and template levels.
additionally we compare the execution time of different parsers to evaluate their efficiency.
.
.
baselines.
we selected ael lenma spell iplom drain and spine the top performing unsupervisedtable grouping accuracy on hybrid log datasets.
metrics ael lenma spell iplom drain hue hibench .
.
.
.
.
.
cts .
.
.
.
.
.
paas .
.
.
.
.
.
average .
.
.
.
.
.
log parsers as our baselines for comparison.
since hue is the first attempt for parsing hybrid logs there is no other baseline for comparison on parsing multi line logs.
to demonstrate hue s effectiveness on hybrid logs we collect and flatten multiple lines into individual log entries with line delimiters n which is a typical solution for managing multi line logs in real development scenarios including in huawei cloud before inputting hybrid logs into existing parsers.
note that since spine is not open source we cannot reproduce their results.
to improve the scientific rigor of our research we compare hue with spine in part of our experiments by using results from its original paper under the same experimental settings i.e.
grouping accuracy on single line logs and feedback results on the linux dataset.
all baselines are implementations provided by logpai or their original repositories with all parameters set to their optimal configuration.
.
rq1 how accurate and efficient is hue on hybrid logs?
for rq1 we use grouping accuracy template f1 score and execution time as evaluation metrics.
we conducted experiments on hybrid log datasets.
note that the comparison is not apple to apple because as to our knowledge hue is the first parser attempting to parse hybrid logs including multi line logs .
therefore we cannot find other more suitable baselines for comparison.
our purpose is not to claim this is a weakness of existing single line parsers because they were not designed for hybrid log parsing but rather to highlight the importance of designing a new parser for parsing hybrid logs.
in addition the experiments intended to show that it is non trivial to adapt single line parsers to hybrid logs.
to be fair we use the same set of regexes for all parsers including hue.
.
.
accuracy.
the results are shown in table.
and table.
.
the best results in each dataset are marked with a star symbol and theesec fse november san francisco usa xu et al.
table template f1 score on hybrid log datasets.
metrics ael lenma spell iplom drain hue hibench .
.
.
.
.
.
cts .
.
.
.
.
.
paas .
.
.
.
.
.
average .
.
.
.
.
.
results with grouping accuracy greater than .
and f1 score greater than .
are emphasized in bold font.
hue demonstrates state ofthe art accuracy and f1 score on all three hybrid log datasets outperforming the best traditional parser drain.
in comparison drain achieves an average grouping accuracy of .
and an average f1 score of .
while hue achieves the highest average grouping accuracy of .
and the highest average f1 score of .
.
this superior performance can be attributed to the design of hue which is specifically built to handle the unique challenges posed by hybrid log parsing.
unlike traditional parsers hue is able to effectively parse logs that span multiple lines and retain the structure between lines whereas traditional parsers fall short because they were not designed to natively support multi line log parsing.
as mentioned in sec.
.
the structure between lines is lost after flattening logs across lines.
for example in table logs different instances of the same template may have different line numbers which can result in significant differences in the message lengths after flattening.
this in turn results in far more templates than ground truth making it difficult or even impossible for downstream tasks to use the logs for vectorized representation.
in particular we find that hue has a significant advantage in parsing event logs and table logs.
fig.
illustrates the comparative advantages i.e.
calculating the ratio of correctly parsed message number or template number dividing the total message number or template number on each log type when they are parameterized to maximize template f1 score.
for example on hibench hue demonstrates promising performance in parsing table logs while other log parsers struggle to parse table logs.
in addition on cts hue exhibits significant advantages in parsing event logs.
these results demonstrate the necessity of designing a parser specifically for hybrid logs and migrating existing parsers for hybrid log parsing is not trivial.
figure the ratio of correctly parsed message template numbers in each type.
the upper bound of each stacked bar is .
.
.
.
efficiency.
we specially collected a large quantity of log data on these three hybrid logs for efficiency evaluation.
specifically we compare average time consumption after running five times in a scaling up scenario.
the results of the experiments are displayed in figure execution time on hybrid logs.
table grouping accuracy on logpai s loghub datasets.
dataset ael lenma spell iplom drain spine hue hdfs .
.
.
.
.
spark .
.
.
.
.
.
.
bgl .
.
.
.
.
.
.
windows .
.
.
.
.
.
.
linux .
.
.
.
.
.
.
android .
.
.
.
.
.
.
mac .
.
.
.
.
.
.
hadoop .
.
.
.
.
.
.
healthapp .
.
.
.
.
.
.
openssh .
.
.
.
.
.
.
thunderb.
.
.
.
.
.
.
.
proxifier .
.
.
.
.
.
apache hpc .
.
.
.
.
.
.
zookeeper .
.
.
.
.
.
.
openstack .
.
.
.
.
.
.
average .
.
.
.
.
.
.
fig.
.
we observe that hue obtains sota results and its execution time increases linearly with the number of logs.
some multi line logs after being flattened can be very long and cause sequence clustering based parsers to fail.
although drain performs the best effectiveness among all baselines it still lacks of efficiency on hybrid logs.
specifically drain times out when the number of messages reached .
million.
the reason might be that drain relies on direct comparison to group extra long logs which is highly inefficient on flattened multi line logs.
.
rq2 how accurate and efficient is hue on single line logs?
for rq2 we use grouping accuracy template f1 score and execution time for evaluation.
we compared hue auto updating with sota log parsers on open source single line log datasets.
.
.
accuracy.
the results are presented in table and table .
hue achieves the sota results with the highest average values in both grouping accuracy and template f1 score.
spine is the best among existing parsers on single line logs.
compared with spine hue performs better than at the message level grouping accuracy on datasets and is comparable on datasets.
hue also achieves sota results at the template level for datasets.
to sum up hue achieves the highest average values of .
in grouping accuracy and .
in template f1 score surpassing the best traditional parser results of .
and .
respectively.hue a user adaptive parser for hybrid logs esec fse november san francisco usa table template f1 score on logpai s loghub datasets.
dataset ael lenma spell iplom drain hue hdfs .
.
.
.
spark .
.
.
.
.
.
bgl .
.
.
.
.
.
windows .
.
.
.
.
.
linux .
.
.
.
.
.
android .
.
.
.
.
.
mac .
.
.
.
.
.
hadoop .
.
.
.
.
.
healthapp .
.
.
.
.
.
openssh .
.
.
.
.
.
thunderb.
.
.
.
.
.
.
proxifier .
.
.
.
.
apache hpc .
.
.
.
.
.
zookeeper .
.
.
.
.
.
openstack .
.
.
.
.
.
average .
.
.
.
.
.
figure execution time on single line logs.
we also observe that hue s accuracy and f1 score are lower on certain datasets e.g.
linux .
we think this is caused by some ambiguous tokens in the logs.
for instance usbcore registered new driver usbfs and usbcore registered new driver hub result in lower accuracy on this dataset.
to address this issue hue provides the human feedback integration mechanism guided updating which will be discussed in the following section.
.
.
efficiency.
we assessed the efficiency the parsers on three major datasets i.e.
using hdfs spark and bgl for executing time comparisons .
we also compare average time consumption after running five times in a scaling up scenario.
the results are shown in fig.
.
the results indicate that hue is comparable with the best baseline in terms of processing speed for single line log data.
however hue is slightly slower than the fastst baseline in some cases which we argue is acceptable.
.
rq3 how effective is hue s human feedback integration mechanism?
for rq3 we conducted experiments on all three hybrid logs as well as the three single line logs that achieve relatively unsatisfactory grouping accuracy below .
and consist of a large number of log templates over templates in sec.
.
i.e.
linux android and bgl to highlight the improvement brought by hue s feedback mechanism.
specifically we set hue to guided updating mode and evaluate the improvement on various datasets by changing themaximum limit of triggered merge queries.
furthermore in the experiments we keep all feedback provided by the user correct to eliminate any potential perturbation caused by human factors.
the results are shown in fig.
and fig.
.
aside from cts hue s grouping accuracy was able to improve to over .
and template f1 score to over .
for all datasets with less than feedback queries.
the performance on cts might not be optimal which could be due to the relatively high number of templates and low amount of corresponding logs in the dataset.
for effectiveness comparison we selected spine feedback to demonstrate the superiority of hue s feedback integration mechanism.
we carried out experiments on linux where both hue and spine did not perform satisfactorily i.e.
with the lowest grouping accuracy of .
and .
among all single line datasets respectively.
to highlight the strength of hue s feedback mechanism we intentionally reduced hue s base grouping accuracy by tuning its parameters to be lower than spine s to highlight its feedback mechanism strength despite its initially higher accuracy than spine s in auto updating mode.
the results are shown in fig.
.
compared with spine hue is able to improve accuracy efficiently with fewer feedback queries significantly.
moreover it achieves a higher final grouping accuracy after tens of queries.
the efficient and effective feedback performance of hue may be attributed to two aspects hue pre filters a large number of unnecessary feedback queries by checking whether all tokens to be updated are keys.
as discussed in sec.
.
.
hue assumes that keys are potential parameter tokens or non ambiguous tokens.
therefore the template updates that are solely targeting keys are considered as correct updates and will not trigger feedback queries.
the feedback mechanism of hue resembles preventing erroneous template updates whereas the feedback mechanism of spine resembles correcting errors after they occur.
specifically spine iteratively partitions the already merged groups into new groups and triggers feedback queries each time.
however this may not be able to resolve the cases where logs belonging to the same template have already been clustered in the wrong groups where the partition feedback queries cannot help them correctly clustered together again.
in contrast hue raises feedback queries before merging logs into wrong groups which can effectively prevent incorrect grouping cases at the very beginning.
thus hue can effectively achieve higher final accuracy.
additionally we observe that hue s accuracy finally saturates as the number of merge queries increases in some experiments.
this is because the parsing errors could also come from other components of hue e.g.
from the heuristic parse tree in fine grouping .
industrial deployment we deployed hue in huawei cloud and it ran smoothly for two months from october to december .
during this period we annotated logs for each downstream task every week.
throughout the evaluation it operators did not have access to the source code of the log statements.
to assess the performance of hue we calculated the percentage of each type of log message over the two month period for root cause analysis tasks.
as shown in fig.
the blue part representsesec fse november san francisco usa xu et al.
number of merge queries0.
.
.
.
.
.
.96metrics ga f1 a hibench number of merge queries0.
.
.
.
.
.
.
.850metricsga f1 b cts number of merge queries0.
.
.
.
.
.
.
.90metricsga f1 c paas figure the increase of grouping accuracy and template f1 score on hybrid log datasets with feedback.
number of merge queries0.
.
.
.
.
.00metricsga f1 a linux number of merge queries0.
.
.
.
.
.
.
.
.94metricsga f1 b android number of merge queries0.
.
.
.
.
.
.
.
.95metricsga f1 c bgl figure the increase of grouping accuracy and template f1 score on three logpai datasets with feedback.
number of merge queries0.
.
.
.
.
.
.0grouping accuracyhue spine figure feedback mechanism comparison on linux.
correctly parsed templates while the orange part represents incorrectly parsed templates.
out of all parsed log templates .
were event logs .
were text logs and .
were table logs.
nearly of them were multi line making it challenging for traditional log parsers to provide accurate log templates for downstream tasks.
in our department in huawei cloud the logs are used for two downstream tasks root cause analysis and user profile construction.
since it operators cannot directly access the source code and extract templates from logging statements they are limited to manually defining log templates according to their requirements.
however as discussed in sec.
.
distinct downstream tasks may possess varying .
.
.
.
.
.
event log text log table log correctly parsed incorrectly parsed a composition.
.
.
.
.
.
.
.
.
.
auto updating root cause analysis guided updating root cause analysis auto updating user profile construction guided updating user profile construction b grouping accuracy.
figure results in huawei cloud.
interpretations of log templates.
for example event logs typically exhibit a verb object structure manifesting as performed an action on a specific object .
in the root cause analysis task engineers focus on the objects being operated so they partition templates based on objects.
in the user profile construction task engineers focus on the recorded action so they partition templates based on actions.
to achieve more accurate log parsing aligned with their downstream task requirements they utilized hue s guided updating mode to parse the collected log samples with different human feedback.
fig.
shows the results where the solid and dashed lines are for root cause analysis and user profile construction and blue andhue a user adaptive parser for hybrid logs esec fse november san francisco usa orange lines are for auto updating and guided updating modes respectively.
this performance has been deemed acceptable by the engineers responsible for their respective downstream tasks.
they have successfully integrated the parsed hybrid log data into their experimental models.
furthermore in our discussion with engineers we learned that hue did not trigger an excessive number of feedback queries during the actual parsing process thus avoiding user fatigue in providing feedback.
in fact the average number of feedback queries triggered in every logs was less than while the grouping accuracy remained acceptable i.e.
over .
.
this enabled them to try to incorporate hybrid logs as available data in their models for the first time.
we also found that hue s spacebased tokenization strategy discussed in sec.
.
has minimal impact on the downstream tasks in huawei cloud contrary to our previous belief that it could threaten the practicality of hue.
this is primarily due to the fact that huawei cloud s business solely uses vectorized logs for various tasks where the main requirement is accurate clustering of logs belonging to the same template rather than ensuring every token in the extracted templates represented as strings is correctly parsed.
therefore we believe that hue also demonstrates a certain level of practicality in industrial scenarios.
threats to validity in this work we identified the following major threats to validity.
data quality our evaluation uses multiple log datasets and we found that they contain labeling errors that can negatively impact parser performance.
also most parsers including hue assume that logs have a specific header.
hue segments logs based on headers.
for logs without headers hue s performance would be degraded.
thus we regard parsing hybrid logs without headers as future work.
key adaptability in sec.
.
we use the most common key setting for all experiments.
however some logs may not fit this setting which could affect the parsing result.
to mitigate this threat we allow users to customize their own key casting configurations.
query correctness in sec.
.
we assume that human feedback to the query is always correct.
however if the user provided incorrect feedback it might introduce new parsing errors.
to mitigate this impact we recommend that users discuss the query in detail if they are not sure about the correct template.
related works log parsing methods can be categorized into unsupervised and supervised methods according to the parsing algorithms.
unsupervised log parsers do not require labels on existing log data and thus they have been more widely explored.
there are three main categories of unsupervised log parsers frequent pattern mining based clustering based and heuristic based methods.
frequent pattern mining based methods regard the mined frequent patterns e.g.
n grams as log templates.
for example slct lfa logcluster and logram try to use different methods to extract frequent patterns in logs.
clusteringbased methods aim to group similar logs first assuming that logs in the same cluster share the same template and then extract thecommon tokens as the template in each cluster.
some clusteringbased methods can perform in an online manner because they adopt an online grouping strategy rather than clustering all the offline logs at once.
specifically lke logsig logmine are offline methods shiso and lenma are online methods.
heuristic based methods encode expert domain knowledge into general and effective heuristic rules.
for example ael iplom spell and drain utilize different heuristic rules to extract templates from logs.
in particular drain achieved sota in all open source traditional parsers with a parse tree structure to perform log parsing in an online manner.
pop improves drain and provides a parallel implementation on spark for distributed deployment.
spine improves drain and proposes a progressive clustering step for human feedback.
in particular spine introduced a manual correction paradigm to log parsing.
although spine also considers human feedback this paper proposed a new human feedback integration mechanism based on the merge reject strategy which largely improves efficiency and achieved higher accuracy.
supervised log parsers are less common because they rely on lots of precise ground truth labels manually constructed by it operators.
uniparser utilizes a contrast learning strategy to overcome the pattern difference in heterogeneous log sources and uses a bilstm model for token and context encoding.
semparser utilizes a special semantic miner for template extracting and uses a bilstm model for encoding.
different from these supervised approaches hue is an unsupervised log parser that does not rely on label log datasets.
different from these existing parsers hue is the first attempt to parse hybrid logs providing an approach to utilize neglected hybrid logs for various downstream tasks in log analysis.
moreover most existing parsers can only improve parsing performance through hyperparameter tuning while hue in addition to hyperparameter tuning further enhances parsing effectiveness through a feedback mechanism.
conclusion this paper introduces a new general and practical research problem hybrid log parsing which is the superset of the widely studied single line log parsing problem.
we also present hue the first attempt to tackle this problem.
hue leverages both patterns in the incoming log messages and expert domain knowledge to parse both hybrid and single line logs in an online manner.
the use of a key casting table and a merge reject strategy enables hue to effectively utilize user feedback making it possible to quickly adapt to complex and changing log templates.
the results of our evaluation on three hybrid log datasets and sixteen widely used single line log datasets demonstrate the superiority of hue in terms of accuracy and efficiency.
the successful deployment of hue in a real production environment further highlights its practical value.
we hope hue and its replication package can serve as the first step in hybrid log parsing and benefit a line of future research in this interesting and practice direction.
data availability we uploaded our repository at november san francisco usa xu et al.