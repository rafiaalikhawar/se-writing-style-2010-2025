morest model based restful api testing with execution feedback yi liu nanyang technological university singaporeyuekang li nanyang technological university singaporegelei deng nanyang technological university singapore yang liu nanyang technological university singaporeruiyuan wan huawei cloud computing technologies co. ltd chinarunchao wu huawei cloud computing technologies co. ltd china dandan ji huawei technologies co. ltd chinashiheng xu huawei cloud computing technologies co. ltd chinaminli bao huawei cloud computing technologies co. ltd china abstract restfulapisarearguablythemostpopularendpointsforaccessing webservices.blackboxtestingisoneoftheemergingtechniques forensuringthereliabilityofrestfulapis.themajorchallenge in testing restful apis is the need for correct sequences of api operation calls for in depth testing.
to build meaningful operation call sequences researchers have proposed techniques to learnand utilize the api dependencies based on openapi specifications.
however thesetechniqueseitherlacktheoverallawarenessofhow all the apis are connected or the flexibility of adaptively fixing the learned knowledge.
inthispaper weproposemorest amodel basedrestfulapi testingtechniquethatbuildsandmaintainsadynamicallyupdating restful service property graph rpg to model the behaviorsof restful services and guide the call sequence generation.
weempirically evaluated morest and the results demonstrate thatmorest can successfully request an average of .
.
moreapi operations cover26.
.
more linesof code and detect .
.
more bugs than state of the art techniques.
in total we applied morest to real world projects and found bugs of them cannot be detected by existing approaches .
specifically of the confirmed bugs are from bitbucket a famous code management service with more than million users.
keywords restful service model based testing corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
reference format yi liu yuekang li gelei deng yang liu ruiyuan wan runchao wu dandanji shihengxu andminlibao.
.morest model basedrestful apitestingwithexecutionfeedback.in 44thinternationalconferenceon software engineering icse may pittsburgh pa usa.
acm new york ny usa pages.
introduction representational state transfer rest has become a de facto standardforwebserviceinteractionssinceitwasintroducedin2000 .
web based apis which follow this standard are called restful apisandthewebservicesprovidingtherestfulapisarecalled restful services.
nowadays most web service providers such as google twitter andamazon exposerestfulapisto grant access to other applications or services.
as the restful apis gain popularity techniques for automatically testing them become important.
based on whether the knowledge of the program internalsisneededornot thesetestingtechniquescanbecategorizedas whiteboxandblackboxtechniques.whiteboxtechniquesarenormallymoreeffectivebutrequiresourcecode .onthecontrary blackboxtechniquesonlyrelyonawell definedinterfacetoconducttesting .incomparisontotheirwhiteboxcounterparts blackboxtechniquesenjoysuperiorapplicabilityconsideringthat a cloud service can be implemented with different programming languages andmay usethird party librarieswhose sourcecode is notavailable.inthispaper weconcentrateontheblackboxrestful api testing techniques.
oneofthemostchallengingproblemsintestingrestfulapis is how to infer the correct sequences of calling the api operations aka call sequences where each api operation can be one of the four basictypes create read update and delete crud .
this is becauserestful apisareoften organizedsparselyto encapsulate different micro services and fulfilling a single task can involve a chain of api calls.
take the petstore service as an example it is a restful service for selling and ordering pets.
in petstore before calling the api to order a pet apis for creating the pet and updating its status as available must be invoked.
skipping any of ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa yi liu yuekang li gelei deng yang liu ruiyuan wan runchao wu dandan ji shiheng xu and minli bao theprerequisite apiswillcause theorderingpet operationtofail preventing the coverage of deeper logic in the code.
to address the challengeofgeneratingproperapicallsequences researchershave proposedseveraltestingtechniques whichcaninferthe dependenciesbetweenrestfulapistoguidethetestgeneration.
for the purpose of api dependency inference these techniques leverage api specifications such as openapi raml and apiblueprint .amongtheseapispecifications openapi aka swagger is becoming increasingly popular and gets adopted by major it companies e.g.
google microsoft and ibm .
two most recent state of the artblackbox restful api testing techniques restler and resttestgen use the openapi specifications of the target restful services to facilitate their call sequence generation.
on the one hand both of them learn the producer consumer dependencies1between the apis to enforce the correct ordering of apis in the generated call sequences.
on the other hand the difference between restler and resttestgen lies in how they utilize the learnt dependencies for restler it usesabottom up approach whichstartswithtestingsingleapis andthenextendstheapicallsequencesbyheuristicallyappending api calls.
although restler can limit the search space with dynamicfeedbacks i.e.
ifcertaincombinationofapisfailstoexecute restler avoids this pattern in the future the search space forextending the test sequences is still very large due to the lack of overall awarenessof how theapis are connected.
to gainsuch awareness resttestgen proposes a top down approach to connecttheapisintoan operationdependencygraph odg where apis are nodes and their dependencies are edges.
with the odg built resttestgencanthentraverseitandaggregatethevisited apinodestogeneratecallsequences.inthissense resttestgen can generate valid call sequences mor e efficiently.
howev er the qualityofthetestsgeneratedbyresttestgenmightbehindered since it heavily depends on the odg which may not reflect the api behavior correctly due to some pitfalls e.g.
poorly written openapispecifications .inshort boththe bottom up andtop down approaches have strengths and weaknesses leaving the generation of proper api call sequences an under researched field.
in this paper we propose morest a blackbox restful api testing technique with a dynamically updating restful service property graph rpg .
the workflow of morest contains two major procedures building the rpg withthe openapi specifications of the target restful service and the model based testing with dynamic updates of the rpg.
the rpg is a novel representation of restful services proposed in this paper which encodes api andobject schema information in the form of a mixed edge labeled attributed multigraph.
comparedto odg rpgcan modelnotonly the producer consumer dependencies between apis with more details but also the property equivalence relations between schemas which allows rpg to both describe more behaviors of the restfulservicesandflexiblyupdateitselfwithexecutionfeedback.by traversingtherpg morestcanaggregatethevisitedapistobuild meaningful call sequences.
during the testing process morestconstantly collect the responses of the restful service and use thedynamicinformationtoupdatetherpgadaptively.withthe 1ifaresourceintheresponseofanapiaisusedasaninputargumentofanotherapi b then b depends on a.updatedrpg morestcanthengeneratetestsequenceswithbetterqualityforthenextiterationoftesting.inthissense morestenjoys the benefits of both the bottom up andtop down approaches while avoiding their drawbacks by having both the overall awareness of all apis and the flexibility of making changes.
weempiricallyevaluatedmorestonsixrestfulservicesrunninginlocalenvironment.inourexperiments morestoutperforms the state of the art blackbox restful api testing tools namelyrestler and resttestgen with superior average code coverage .
and .
respectively average successfully requested operations .
and .
respectively and average number of detected bugs .
and .
respectively .
in total weapplied morest to six real world projects and found bugs 13of them cannot be detected by existing approaches .
in specific of the confirmed bugs are from bitbucket a famous git code management service with more than six million users .
contribution.
we summarize our contributions as follows we proposeanovel modelcalledrestful service property graph rpg for describing web services and adopt it for restful api testing.
we develop a methodology for adaptively updating the rpg for enhanced performance.
weevaluatetheperformanceof morestanddemonstrate the superiority of morest comparing to the state of the art techniques with cpu hours.
to the best of ourknowledge this is the first work to empirically compare blackbox restful api testing techniques.
we detect bugs with morest in projects.
we responsiblydisclosethebugstothedevelopersand2ofthemare confirmed until the time of writing this paper.
wereleaseourdatasetsandimplementationof morestto facilitate future research.
currently we have released the raw experimental data the prototype of morest and the evaluated benchmarks on the com panion website of this paper.
the link to the website is https sites.google.com view restful morest home.
background running example .
background restfulapi.
therepresentationalstatetransfer rest architecture is is first proposed by roy fielding in .aw e b api using the rest architecture is called a restful api.
a web service providing restful apis is called a restful service.
one of the fundamental constraints of rest architectural style is uniform interface whichregulatesthecrudoperationsontheresources.
in modern web api design practice restful apis often use http protocol as the transportation layer.
therefore the crud operations of restful apis can be mapped to the http methods post get put and delete respectively.
openapi specification.
openapi previously known as swagger defines a standard for describing restful apis and an apidocumentfollowingthisstandardiscalledanopenapispecification.
openapi specifications contain the information of the objectschemasas well as the api endpoints including but not limited to the available crud operations input parameters as well as authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
morest model based restful api testing with execution feedback icse may pittsburgh pa usa swagger .
paths pet post operationid addpet parameters name body schema defs pet arrowhookleft pet findbystatus get operationid findpetsbystatus arrowhookleft parameters name status type string responses description success arrowhookleft schema defs pet arrowhookleft pet petid get operationid getpetbyid arrowhookleft parameters name petid type integer a responses schema defs pet arrowhookleft store order post operationid placeorder arrowhookleft parameters name body schema defs order arrowhookleft store order orderid get operationid getorderbyid arrowhookleft parameters name orderid type integer responses schema defs order arrowhookleft delete operationid deleteorder arrowhookleft parameters name orderid type integer b figure the openapi specification of petstore apis for clarity we omit some details in the yaml file.
order type object properties id type integer petid type integer status type string a pet type object properties id type integer name type string status type string b figure the openapi specification of petstore schemas for clarity we omit some details in the yaml file.
responses.
these specifications can be stored as either yaml or json files.
fig.1showsafragmentoftheopenapispecificationforapis in the petstore service .
in this example five api endpoints are specifiedandtheyaremarkedwithgreybackground.wecansee that each api endpoint supports one or more crud operations whicharespecifiedbythe operationid property.intotal sixoperationsaredescribedinfig.
showingtheirinputparametersand responses.foraninputparameter itcanbeinsidetherequestbody bodyofaddpet or in the url path2 petidofgetpetbyid .
for a response it contains the http status code as well as the content body.inaddition someoperationparametersandresponsesmay 2some get operations may involve the usage of query parameters and they are also considered as serialized in the url path.involve objects that are described by schemas.
for example the operationgetpetbyid returnsresponses withobjects underthe pet schema.
fig.
shows the openapi specifications of the schemas.
operation dependencygraph in resttestgen viglianisi et al.
propose to use operation dependency graph odg to model data dependencies among operations which can be inferred from the openapispecifications .thebenefitofusingodgisthataggregating operations by traversing the odg can generate meaningful call sequences.
the odg is a graph g v e wherevis a set of nodes and eis a set of directed edges.
for each node v v v corresponds to a unique operation in the openapi specification.
the graph is said to contain a directed edge ewheree v2 v1 forv1 v2 vandv1 v2 if and only if iff there exists a common fieldin the response of v1and in the request parameter of v2.t w o fields are commonwhen they have the same name if they are of atomic type e.g.
string or numeric or when they are related to the same schema if they are of a non atomic type.
thus following this definition v2 v1meansv2depends on v1.
.
running example here we introduce a running example extractedfrom the petstore service which can demonstrate the limitations of existing approaches and aid in the explanation of morest s strategies in section3.fig.1and2illustratetheopenapispecificationsofthe petstore service.
the question is given these specifications how to generate meaningful api call sequences.
for this purpose weneed to infer the dependencies among the apis.
intuitively the definition of api dependencies in odg .
can be applied here bothrestler andresttestgen followthisdefinition .
for the example in fig.
we can get the following dependencies findpetsbystatus getpetbyid findpetsbystatus getorderbyid addpet findpetsbystatus addpet getpetbyid getpetbyid getorderbyid placeorder getorderbyid note that some of the dependencies are infeasible one example isindependency2where findpetsbystatus shouldnotdependon thestatusoftheorderobjectreturnedby getorderbyid because the status of a pet and the status of an order are not the same.
anotherexampleisindependency4where addpetshouldnotdepend ongetpetbyid althoughbothofthemusethepetschema.while thereareinfeasibledependencies theycannotbesafelyfilteredout as yet because the current odg model lacks the ability to describe therelationbetweenanapiandaschemaindetailanddynamic execution feedbacks are needed to infer correct dependencies.
after the dependencies are acquired we can then use them to guide the call sequence generation.
to start with we can use a bottom up approachbytestingsingleapisfirstandthenextendthe test sequences by appending more apis one at a time.
for example we can start with a new sequence getorderbyid .
after a successfulcallof getorderbyid wecanfeedthe petidofthereturned orderobjectto getpetbyid accordingtodependency5.thenthe sequence becomes getorderbyid getpetbyid .
similarly we can append findpetsbystatus to the sequence according to dependency1andsoon.inthisprocess wecanidentifytheinfeasible dependencies and avoid using them in the future.
for instance we can tell dependency is faulty because if we try to append addpet to getorderbyid getpetbyid according to dependency the addpetoperationwill alwaysfailsincetheservicerefusestocreate authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa yi liu yuekang li gelei deng yang liu ruiyuan wan runchao wu dandan ji shiheng xu and minli bao dynamic rpg updating edge addition edge deletion test case generation call sequence generation operation parameter generationinitial rpg post create get readproperty typeobjecttest sequencesfailures test cases post get put del get post putresponses .
.
.
morestrefined rpg post create get readobject property typeinitial rpg building nodes extraction edge analysis figure the workflow of morest analready existingpet.thelimitation ofthe bottom up approach isthatitlackstheoverallawarenessofhowtheapisareconnected with each other.
for example it is hard to conduct depth firstsearch dfs when extending a sequence because the potential lengthofthesequenceisunknownandifitisverylong theriskof getting stuck in a local optimal is high.
alternatively we can use odg to facilitate the generation of callsequences whichisa top down approach.thecallsequences canbegeneratedbytraversingtheodgandchainingthevisited operations.
compared with the bottom up approach with odg we can quickly generate call sequences without trial and error.
however becausesomeextracteddependencies suchas2and4 might be infeasible the quality of the generated call sequences can be affected.
in other words the top down approach lacks the flexibility of dynamically fixing the call sequences.
in summary both the bottom up andtop down approach have theirownstrengthsandweaknessesandtheycancomplementeach other.
therefore a new model is needed to both provide high level guidance and perform self updates.
following this observation we propose morest which leverages restful service property graph rpg to adopt the advantages of both approaches while circumventing their disadvantages.
methodology fig.3showsthedetailedworkflowof morest.totestarestful service morestfirsttakesitsopenapispecificationsasinputto build the rpg a novel representation of the relations amongrestful apis and the schemas .
.
after building the initialrpg morest uses it to generate call sequences and replace the api calls in the call sequences with actual requests .
.
then thegeneratedtestcasesarefedtothetargetrestfulserviceand morest shall collect the responses.
by analyzing the collectedresponses morestreportsthedetectedfailuresforbuganalysis.moreover morest also uses the responses to refine the rpg byadding missing edges and removing infeasible edges .
.
the refined rpg is then used for generating more test sequences.
this marks the end of one iteration and morest will keep testing the target restful service and refining the rpg until the time budgetis reached.
.
initial rpg building inmorest weproposetheconceptofrpgtoencodethecrud relations of operations the relations of the schemas and the dataflowamongtheschemasandoperations.thedesignofrpgisbasedon the concept of property graph .
the definition of property graphis as follows definition1 propertygraph .
apropertygraphisadirected edge labeled attributed multigraph g v e wherevis a set of nodes or vertices eis a set of directed edges e is an edge labeling function assigning a label from the alphabet to each edge and v e k sis a function assigning key from k value from s pairs of properties to the edges and nodes.
giventhedefinitionof propertygraph rpgisdefinedasfollows definition restful service property graph .
a rpg is a mixed edge labeled attributed multigraph g v e with v vschema voperation e eos eso ess eoo so ss schema operation wherevschemaisasetofschemanodes voperation isasetofoperation nodes eosisasetofdirectededgespointingfromanodein voperation toanodein vschema esoisasetofdirectededgeseachofpointingfrom anodein vschematoanodein voperation essisasetofundirected edgesconnectingtwonodesin vschema eooisasetofundirectededges connecting two nodes in voperation sois a set of labeling functions tolabeledgesin eso ssisasetoflabelingfunctionstolabeledges iness schemais a set of functions to assign properties to nodes in vschema and operation is a set of functions to assign properties to nodes invoperation note that rpg is not exactly a property graph because it is a mixedgraphwhilethelatterisadirectedgraphandthisistheonly difference.
in the following of this paper for simplicity we use ox torepresentanelementof voperation sxtorepresentanelement ofvschema eosto represent an element of eosand so on.
design rationale.
here we explain the details and rationale for the design of rpg.
the usage of vschemaandvoperation arestraightforward weneedthemtorepresenttheschemasand operations.
asforedges theedgesin eosandesoaredirectedto represent whether an operation produces or consumes an object of aschema.forexample theedge eo1s1 o1 s1 meansoperation o1returns an object of schema s1as its response.
correspondingly theedgees1o1 s1 o1 meansoperation o1requiresanobjector at least one property of the object of schema s1in its parameter s .
theedgesin essrepresenttheequivalencerelationbetweentwo properties from two different schemas.
in the running example the property idin the pet schema is referring to the same thing authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
morest model based restful api testing with execution feedback icse may pittsburgh pa usa as the property petidin the order schema.
we denote the edge connecting these two schemas as espetsorder spet sorder .
the edgesineooareused toconnect twooperationsif theyare under the same api endpoint.
in the running example the operation getorderbyid and the operation deleteorder are connected by this type of edge.
only the edges in esoandessare labeled by functions in .
the labels for esoare vectors of property names showingwhichexactpropertiesofaschemaareusedasparameters for an operation.
note that the empty vectors are ignored in fig.
.
the labels for essare vectors of tuples where each tuple is pair of properties with equivalence relations from two different schemas.
the edges in eoorequires no labelling since they can only indicate two operations belong to the same api endpoint.
the labelling for eosis ignored for two reasons.
first labelling edges is an errorproneprocess especiallywhentheopenapispecificationispoorly written themoreedgeswelabel themoreerrorswemayintroduce.
second comparing with the edges in eso the edges in eosare less important for successfully requestingapi operations because the former ones directly affect the input parameters of the operations.
naturally the functions to assign properties to the nodes correspondtotheprocessofparsingtheopenapispecificationand extracting data from it.
withtheopenapispecifications morestcanbuildtheinitial rpgconsisting ofnodesandedges togetherwiththeirproperties orlabelsaccordingtodef.
.thisinitialrpg likeshowninfig.4a maycontainfalseedgesormisssomeedgesandmorestwillrefine it with dynamically collected feedback later on.
rpg vs odg.
here we compare the rpg model with the odg model.thefirstdifferenceisthatodghasonlytheoperationnodes and their producer consumer dependencies as edges while rpg hasmoretypesofnodesandedges.theseconddifferenceisthat rpg allows nodes and edges to have properties and labels.
both of the differences indicate that rpg can describe more details of therestfulservices.theadditionaldetailscapturedbyrpgcan help to generate longer call sequences and provide the informationneededfordynamicself updating.forexample fortherpgshown in fig.
4b the connection between the petandorderschemas indicates that order.petid refers to the same thing as pet.id.
withthisinformation wecaninferthatthe order.petid canbe usedtoquery getpetbyid andthereforegeneratethecallsequence placeorder getpetbyid findpetsbystatus whichcannotbe generated only with the dependencies between operations in an odg.
.
test case generation hereweintroducehowmorestusesrpgfortestcasegeneration.
in general this requires two steps first morest traverses the rpg andaggregatesvisitedoperationstoformcallsequences callsequence generation second morest generates concrete inputs for the apis in the sequences to build test cases operation parameter generation .
call sequence generation.
algo.
shows how morest generates call sequences where sis a set of call sequences and s o o1 ... on is a single call sequence made up of a vector of operations.thefunction call sequence generation isthestartofthe whole process.get getpetbyidpost addpet get findpetsbystatus get getorderbyidpost placeorder delete deleteorderpet id int name string status string order id int petid int status string status status petid a the initial rpg operation node schema node infeasible edge dynamically added edgelegendget getpetbyidpost addpet get findpetsbystatus get getorderbyidpost placeorder delete deleteorderpet id int name string status string order id int petid int status string status petid id order.petid pet.id b the refined rpg figure the restful service property graphs rpgs forthe petstore running example.
in general the idea of this algorithm is to visit every schema in therpgandcollecttheoperationsrelatedtotheschematobuildup callsequences.whileaccessingaschema wecanrecursivelytraverseotherschemaswhichareconnectedtothecurrentone collect the related operations to build new call sequences and concatenate the new call sequences and the existing call sequences to build longersequences.afterwehavegeneratedthecallsequences we further apply a crud filter to filter out the call sequences violating thecrudrules.acallsequenceissaidtoviolatethecrudrule ifitencountersanyofthetwosituations forthesameschema a deleteoperationappearsonthesequencebeforeanotheroperation for the same schema any of the read update or delete operation appears on the sequence before the first create operation.
in particular when we visit a schema s line we first need to identify two sets of operations the operations which produce schemasintheirresponses oout andtheoperationswhichconsume schema sor its properties as their input parameters oin .
withooutan set of call sequences snew with the length of two line .
then ifwealreadyhaveasetofcallsequences s wecantrytoconcatenate them and the new call sequences to build longer sequences line17 .twosequencescanbeconcatenatedifthelastoperation of one of them is the same as the first operation of the other one authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa yi liu yuekang li gelei deng yang liu ruiyuan wan runchao wu dandan ji shiheng xu and minli bao algorithm call sequence generation 1defcall sequence generation v e 2s 3fors vschemado s s visit s vschema 5s crud filter s 6returns 8defvisit s vvisited schema vschema s 9oout o voperation o s eos 10oin o voperation s o eso 11ifoin oout then returns 13if ess ess ess s s prime s prime s s prime vschema then returns 15vvisited schema vvisited schema s 16snew oout oin 17s concat s snew 18fors prime s prime vschema ess prime ess ess prime s s prime s s prime s prime vvisited schema do s s visit s prime vvisited schema vschema s 20returns defconcat s snew 23fors o1 ... o n sdo fors prime oout oin s newdo ifon ooutthen s s o1 ... o n oin ifoin o1then s s oout o1 ... o n 29returns defcrud filter s 32fors sdo if notcrud valid s then s s s 35returns line .
after that if the current schema node is connected to another schema node which has not been visited in the current iteration line we will visit that schema and repeat the same processuntilwerunoutofschemanodes.notethateachschema node is visited only once per iteration to avoid infinite loops.
in the running example with the rpg in fig.
4b assume we are nowvisitingthe petnodeandthe ordernodeisnotvisitedyet.for thepetnode itsooutis addpet getpetbyid findpetsbystatus and itsoinis getpetbyid findpetsbystatus .
the cartesian product of ooutan generate six new call sequences including getpetbyid findpetsbystatus etc.
line16 .sincewe donothaveanyexistingcallsequencessofar wedonotneedto performcallsequenceconcatenation line17 .then becausethe ordernodeisconnectedtothe petnodeandithasnotbeenvisited wewillvisititandgeneratenewcallsequencessimilarly line19 .
one of the newly generated call sequences for the ordernode is placeorder getpetbyid line .
now since we already have generated some sequences when we visit the petnode we can trytoconcatenatethemwiththenewlygeneratedcallsequences for theordernode line .
in this example we can generate the call sequence placeorder getpetbyid findpetsbystatus .
this demonstrates how morest generates call sequences.notethat insomecases therearestandaloneoperationsthatare not connected to any schemas.
for clarity we omit handling these cases in the algorithm.
but in our implementation the standaloneoperations are included as single element call sequences.
operationparametergeneration.
thegeneratedcallsequences cannot be used directly for testing since they are just sequences of operations without concrete parameter values.
for a given operation if its input parameters are notfrom the responses of other operations on the same test sequences they are decided as follows iftheoperationhasbeencalledcorrectlybefore morestassigns a high chance of using the parameters of the last successful run elseiftheopenapispecificationshavespecifiedthevalidrangesof valuesfortheoperation moresthasahighchanceofselectingvalues from the valid ranges otherwise morest will just use random values.
given an object schema morest recursively traverses the schema to generate values for the object attributes according to theirparametertypes.iftheparameterisofabasictype e.g.
string and int we will concretize the value accordingly.
if the parameter is an object or a list we will jump in and recursively deduce the basic parameter type.
an important detail worth discussing is that the parameters for asequenceofoperationsisnotgeneratedallatonce.instead theseparametersaregeneratedonthefly.becauseiftheinputparameter foranoperationisbasedontheresponseofapreviousoperation we will need to wait for the previous operation to finish execution to get the needed parameter values.
.
dynamic rpg updating theinitial rpggenerated withtheopenapi specifications may containerrors.forexample theredlinesinfig.4aareinfeasible edges and the dashed lines in fig.
4b are the missing edges for the initialrpg.thisisoftenduetoambiguitiesinthespecifications.for example althoughahumancanquicklyrecognizethatthe petid property of orderrefers to the same thing as the idproperty of pet itishardtouserulesandheuristicstoreconstructthisrelation.
toaddressthisproblem morestdynamicallyfixestherpgwith execution feedback.
edgeaddition inmorest newedgesareaddedtoarpginthree scenarios the most straightforward case is where the response value of an api aligns with a certain schema but it is not documented in the specification.
for example in fig.
the response of theaddpetoperation is not documented.
however after addpetis correctedduringthetesting itwillrespondwiththenewlycreated petobject.
morest will notice that the properties of the object returned by addpetmatches the properties in the petschema.
then morest can add the edge addpet pet intoeos.
the edges of essare added after the collection of execution feedback.
for two schema nodes s1ands2if both of them are related to an operation nodeo morest makes the assumption that s1ands2share at least onepropertyincommonbutmorestcannotdecidewhichproperty is shared in the rpg building stage.
during the execution of the test cases morest may encounter some sequences involving both the objects of s1and the objects of s2.
with the responses of these sequences morest can compare the concrete values of properties between the two types of objects.
as far as the value of a property fromanobjectof s1canmatchthevalueofmultiplepropertiesfrom authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
morest model based restful api testing with execution feedback icse may pittsburgh pa usa table open source restful services subjects loclanguageoperationendpoint source petstore 989java openapi spreecommerce ruby emb bitbucket java bitbucket languagetool java emb featureservice java emb magento php emb anobjectof s2 therelationbetween s1ands2remainsundecided.
until we find a property whose value only matches with one propertyfromtheothersetofobjects wecantellthatthesetwoschemas sharethiscommonproperty.forexample both orderandpetconnect with getpetbyid .
morest can generate multiple test cases with the sequence of getorderbyid getpetbyid .
suppose these test cases yield the following two pairs of orders and pets id petid status succ id name cat status sold and id petid status succ id name dog status sold .
after the generation of the first pair of order and pet morest cannot infer the relation since the idof the pet equals to both idandpetidof the order.
morest can only infer that pet.idis equal to either order.id ororder.petid .nevertheless afterthesecondpairisgenerated morest candraw theconclusion of pet.idequalsto order.petid.
thelastscenarioiswheretheedgesbelongingto esoandeosare addedbasedontheinferencesusedforbuilding ess.forexample aftermorestlearnsthefactthat pet.idequalstoorder.petid it propagatesthisinformationtoothernodes say getpetbyid .then morestcanlinkthe petidparameterneededby getpetbyid with theproperty pet.iddespitethattheyhavedifferentnames.asa result morestcanaddtheedge pet getpetbyid toesoasshown in fig.
4b.
edge deletion for an operation if its inputs are from other operations on the same call sequence i.e.
not generated randomly anditfailstoexecutecorrectlyafter tries thentheedgepointing from the respective schema to this operation is temporarily recognizedasinfeasible.empirically wefindthatincreasingthevalue of canhelpto reducethenumber offalselydeletededgesbutthe overall performance is not affected too much since we are wasting moretimeonthetrulyinfeasibleedgesandevenifabenignedge is deleted morest always has the chance of adding it back.
implementation evaluation wehaveimplementedmorestbasedonpython3.
.0with11 lines of code and conducted experiments to evaluate the performance of morest.
we aim to answer the following research questions with the evaluation rq1 coverage how is the code coverage and operation exploration capability of morest?rq2 bugdetection howisthebugdetectioncapabilityof morest?rq3 ablationstudy howdorpgguidanceanddynamicrpg updating affect the performance of morest separately?
.
experiment setup evaluation datasets.
we built the evaluation benchmark with sixopensourcerestfulservicesshownintable1.inthisbenchmark four services were selected from the evomaster benchmark emb .inaddition petstore theofficialdemoofopenapispecification andbitbucket apopularonlineversioncontrolsystem with complicated business scenarios were also included.
from table we can see that the target restful services are diverseinsizes featuresandareimplementedwithdifferentprogramming languages.
bitbucket is not strictly open source since it isacommercialproduct.however wehaveaccesstoitsreleased .jar file to collect line coverage and conduct detailed bug analysis.
evaluationbaselines.
weusethreestate of the artblackboxrestfulservicetestingtechniquesasbaselinestostudytheperformance of morest.
evomaster bb evomaster is a search based whitebox technique.
in our evaluation we disabled its code instrumentation onlyworksforjavaprograms anddatabasemonitoring modulestoturnitintoblackbox mode namedas evomasterbb .
it uses various heuristics to generate call sequences according to the openapi specifications.
thus evomaster bb represents the heuristic based approach.
resttestgen resttestgen is a blackbox technique whichgeneratesoperationdependencygraphs odgs from openapispecificationstoguidethecallsequencegeneration.
resttestgen represents the top down approach.
restler restler is a blackbox technique which build call sequences by appending new api operations according to execution feedback.
restler represents the bottom up approach.
evaluation criteria.
we use three criteria to evaluate morest and the baselines.
code coverage code coverage can reflect the exploration capability of the techniques.
in the experiments we use line coveragesinceitisthefinestgranularitywecangetwithour current tools phpcoverage for php coverband for ruby and jacoco for java .
successfully requested operations in http responses with status code 2xx are successful responses .
we use the number of successfully requested operations sros as a criterion because it can reflect whether a technique can gen erate valid requests to test deeper code logic of the restful serviceandvalidrequestsarepartiallytheresultsofcorrectcall sequences.
bugs thegoaloftestingistoexposebugs sothenumberof detectedbugsisanecessarycriterion.inthecontextofrestful service a failureis considered to happen when an operation returns5xxstatuscodeanda bugcanberelatedtomanyfailures.
we manually classified the failures into unique bugs in the experiments according to response bodies server logs etc.
evaluation settings.
for the open source restful services we hosted them on a local machine and ran each technique with three time budgets and hour s .
the purpose is to evaluate how the performance of these techniques change over time.
to the best 3we only use the open source services available in emb up to the time of writing this paper.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa yi liu yuekang li gelei deng yang liu ruiyuan wan runchao wu dandan ji shiheng xu and minli bao of our knowledge the time budget of hours is the longest time budget used in restful service testing research.
after each round we tear down and restore the environment e.g.
docker containers self hosted virtual machines to guarantee the consistence of all restful services.
in addition we repeated all experiments for 5times to mitigate randomness and applied mann whitney u test and a12 calculation for statistical tests.
thus we conducted a total number of i.e.
projects settings hour time budget for one round 5r e p etitions cpu hours of experiments.
.
coverage rq1 to comprehensively compare different approaches evomasterbb resttestgen and restler are directly adopted from the prior work .besides toavoidthesideeffectofserviceundertest we wrap six evaluation subjects into docker image and restore the corresponding image after each round.
table presents the statistical results of five runs.
as suggested by the prior work the mann whitney u test with the confidence threshold .
is adopted here.
overall we summarize our findings as follows.
fig.
and table depict that4morest achieves competitive performance regarding both code coverage and successfully requested operations significantly outperforming search based and model based approaches in restful services bold numbersin table .
fig.
6a demonstrates unique successfully requestedoperations by each tool.
we can figure out that morest covers themostoperationsbygeneratingvalidcallsequencesfollowing producer consumerdependencies.therefore existingexperimental result demonstrates the exploration effectiveness of morest regarding given coverage criteria code coverage increased by .
.
successfully requested operations improved by .
.
.
on the other hand it presents the robustness of morest gained by rpg guidance and rpg updating fashion experiment results are statistically significant .
further weconductanin depthanalysisofthegeneratedtestsequencesbyallapproachestofigureoutwhyallapproachesachieve the same number of successfully requested operations.
taking the languagetool as an example we find that all approaches couldnot cover three operations getwords addword and deleteword.
two parameters username andapikey in those operations are labeled as required parameters i.e.
username andapikeymust be filled in each request when testing those operations .
however we observe that the implementation of languagetool is different from descriptionsintheopenapispecification.specifically intheimplementation of languagetool username andapikeycould not be filledsimultaneously otherwise theserverbehavesunexpectedly and throws 5xx responses.
as a consequence we could imply that the gap betweenrestful api specifications andactual implementation of restful service could affect the effectiveness of restful api testing.
.
bug detection rq2 subsequently we analyze the bug defined in section .
discovering the capability of each approach.
table presents the statistical results of the averaged bugs detection with running tools for 4duetopagelimitation weleaveexperimentresult codecoverageandsuccessfully requested operations for hour and hours in our website .hours each round.
since one bug can be detected several timesduringtesting weonlyrecordthenumberofuniquebugsforall approaches.
overall we summarize our findings as follows.
first inthosebaselines evomaster bb restler andresttestgenoutperformeachotherindifferentsubjects.wemanuallyanalyze the test sequences generated by baseline and find that restler could sufficiently explore all call sequences theoretically however we have observed that massive invalid call sequences make restler inefficient evomaster bb heuristically generates redundantcallsequencestomakeitinefficient resttestgenis trapped by infeasible call sequences generated from the operation dependency graph which limit its performance.
besides asshownintable3 morestdetectsthemostbugs bold numbersintable3 andstatisticallyoutperformsotherbaselines on testing restful api services.
specifically fig.
6b indicates that morestcoulddetectunknown13bugs byexistingapproaches.it not only shows the comparative performance in bug finding but also the morest s robustness.
similarly to section .
we manually perform a comprehensivestudyinlanguagetooltofigureoutwhyallapproachesfind identicalbugs.wefindthatduetothegapbetweenrestfulapi specificationandtheactualimplementationofrestfulservice see detail description in section .
all approaches get 5xx responses by following the parameter s specifications e.g.
word size is defined by the string type while implemented by the integer type in the languagetool s specification.
this indicates that restful apitestingcouldhelpdeveloperstoidentifytheincompatibilitybetween the restful api specifications and actual implementations.
case study.
two bugs discovered by morest have been confirmed and fixed by the developers of bitbucket.
we conduct acase study tofind out how morest trigers thosebugs.
bitbucketis a git based source code repository hosting service owned by atlassian.
bitbucket server is the self host service provided byatlassianthatallowsuserstodounlimitedapiqueriestothetarget server.
during the testing of bitbucket we identified the followingcallsequencethattriggersinternalservererrorwith500 status code.
in particular create a project at rest ... projects endpoint through post operation.
the project information can be furtherretrievedby getrequestonthesame endpoint.
create arepositoryintheprojectat rest ... projectkey reposendpoint throughpostoperation wherethe projectkey parameterisdefinedinthefirststepasaparameter.
afurthergetqueryon rest ... repos repositoryslug commitswithparameters path test string triggers internal server error.
when debugging mode isenabled thebugmessageisprintedout com.atlassian.bitbucket.
scm.commandfailedexception .
in summary both a project and a repositoryshouldbecreatedfirstlytotriggerthisbug.withtherpg guidance and dynamic rpg updating morest could adaptively generate such call sequences.
.
ablation study rq3 to investigate how rpg and dynamic rpg updating contributes to boosting the testing effectiveness of morest through high level guidanceandadaptiveupdating weperformaablationstudyon eachcomponent.tostudythecontributionsseparately weimplementtwovariantsof morestasfollowing morest no rpgby authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
morest model based restful api testing with execution feedback icse may pittsburgh pa usa a petstore b spreecommerce c bitbucket d languagetool e featureservice f magento figure comparing with baselines in terms of code coverage loc table performance of morest over evomaster bb resttestgen and restler in terms of both the code coverage loc and successfully requested operations sro .
we run this experiment times hours each time and highlight statistically significant results in bold.
we calculate the average increased number by ofmorest of baseline of baseline.
subjectsaverage code coverage loc average of successfully requested operations sro morest evomaster bb resttest gen restler morest evomaster bb resttest genrestler loc loc a12 loc a12 loc a12 sro sro a12 sro a12 sro a12 petstore .
.
.
.
.
.
.
.
.
.
.
.
.
.
spreecommerce .
.
.
.
.
.
.
.
.
.
.
.
.
.
bitbucket .
.
.
.
.
.
.
.
.
.
.
.
.
.
languagetool .
.
.
.
.
.
.
.
.
.
.
.
.
.
featureservice .
.
.
.
.
.
.
.
.
.
.
.
.
.
magento .
.
.
.
.
.
.
.
.
.
.
.
.
.
average increased .
.
.
.
.
.
.
.
table comparing with baseline in terms of the number of detected bugs.
values in bold indicate statistically significant differences between morest evomaster bb resttestgen and restler.
subjectsaverage detected bugs morest evomaster bb resttest genrestler a12 a12 a12 petstore .
.
.
.
.
.
.
spreecommerce .
.
.
.
.
.
.
bitbucket .
.
.
.
.
.
.
languagetool .
.
.
.
.
.
.
featureservice .
.
.
.
.
.
.
magento .
.
.
.
.
.
.
average increased .
.
.
.
disablingrpgguidance morest rpg onlybyremovingthe dynamic rpg updating part.
the results are averaged using fiveruns withtimebudgetonehour toavoidthestatisticsbias.fig.7a presents normalized code coverage of baselines on our datasets to better visualization and understanding we normalize the code coverageby normalized coverage loc loc morest .fig.7bshows the number of detected bugs.
ingeneral asshowninfig.
weobservethat morestoutperformsmorest rpg onlyandmorest no rpgonbothcodecov erageandbugdetection.inspecific wetakepetstoreasanexample.
tocovermoreoperationsrelatedtothe pet schema aninstance ofpetshouldbefirstlycreatedby addpet.however morest norpgfailstogeneratesuchcallsequences whichrestrictsfurther explorationduringtesting.additionally propertiesnamed status withinboth order referstothestatusoforder and pet refers tothestatusofpet schemas leadingtoinvalidproducer consumer authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa yi liu yuekang li gelei deng yang liu ruiyuan wan runchao wu dandan ji shiheng xu and minli bao a successfully requested operations sro b bug detection figure venn diagrams showing both successfully requested operations sro and bug detection that morest evomaster bb resttestgen and restler individuallyand together.
a normalized average code coverage b average unique bug detection figure the performance of morest morest no rpgand morest rpg only on both normalized average codecoverage loc and bug detection.
dependenciesinrpg.theperformanceof morest rpg onlyis limited by such cases.
thus we can infer that the rpg guidance and dynamic rpg updating can both boost the effectiveness of the restful api testing process.
besides aswecanseefromfig.
morestachievesbetterperformance other approaches regarding both code coverage and bug detection.
in particular morest generates call sequences with the guidanceofrpganddynamicallyupdatesrpgtoadaptivelyimprovecallsequencestoobtainhighercodecoverage whichincreasing the possibility to detect bugs.
.
threats to validity the first internal threat comes from the choices of configurable optionsinthedesign.currently weempiricallysetthevaluesfor theseoptionsandtheactualvaluesoftheoptionsusedintheex periments can be found on our website .
although the choice of configurable options can affect the performance of morest the experimentresultscandemonstratethatatleastwiththecurrent set of option values morest can outperform state of the art techniques.
therefore we leave the fine tuning of these options as future work.
another internal threat is that the current rpg model can only reflect the apis documented in the openapi specifications.
for undocumented apis a possible solution is to infer their related schemes in an online manner by analyzing the feedback of the testing process.another possiblesolution isto useclient side analysistechniques togeneratetraffic betweenclients and servers and analyze the traffic to infer the correct usage of the undocumented apis.
we leave the support of undocumented apis as future work.
the external threats mainly come from the experiment settings.
the testing techniques evaluated in the experiments are random by nature.
to mitigate the random factors we repeated each experiment for fivetimes and conducted statisticaltests.
therefore the experimentresultsarestatisticallysound.toaddressthegeneralityconcern wechoseadiversedatasetconsistingofsixrestful services with various sizes and features.
moreover we chose open source restful services so we can perform in depth experiment resultanalysesviascrutinizingthecodecoverageandclassifying the detected failures into unique bugs.
last but not the least to improve the fairness for technique comparison we gave each technique a generous timebudget of hours while in the longest time budget is hour and in the time budget is .
hour.
related work instead of discussing all related works we focus on the restfulservice testing techniques soap service testing techniques and model based testing techniques.
blackbox restful service testing techniques.
several blackbox techniques were proposed to generate meaningful call sequences.resttestgen buildsoperationdependency graphs odgs with the openapi specifications to model restful servicesandcraftscallsequencesviagraphtraversal.thequalityof thegeneratedcallsequencesislimitedbythequalityoftheopenapispecificationswhichdirectlyaffectodgbuilding.meanwhile restler builds call sequences with a bottom up approach which starts with single operation call sequences and gradually extend the call sequences by appending more operations after trial and error.
comparing to these techniques morest can enjoy both high levelguidanceandtheflexibilityofdynamicadjustmentsto achieve better performance.
other than call sequence generation some blackbox techniques focus on improving the operation input parameter generation .
these techniques utilize predefined inter parameter constraints input grammar or mutators to generate diverse input parametersforthetestcases.inputparametergenerationisorthogonal to call sequence generation we plan to adopt advanced input parameter generation in the future.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
morest model based restful api testing with execution feedback icse may pittsburgh pa usa whiteboxrestfulservicetestingtechniques.
evomaster isawhiteboxrestfulservicetestingtechniquewhichinstruments the target restful service and monitors its database to collect usefulexecutionfeedbackanddatatoguidetheevolutionaryalgorithm based test case generation.
comparing to the the blackbox techniques on the one hand evomaster is more effective in testing deeper logic inside the restful service since it can collect and use more information about the target service to guide the test casegeneration.
on the other hand evomaster can only instrument java scala kotlin based restful services and requires access to the database limiting its application to closed source projects or projects implemented with other programming languages.
soaptestingtechniques simpleobjectaccessprotocol soap is a standards based web service access protocol first proposed by microsoft.
some previous works focus on testing soap based web services .
specifically some of them use web services descriptionlanguage wsdl specificationstoguidethetesting process .
despite the similarities rest is proposedtoaddresstheshortcomingsofsoapandisgainingmore popularityinrecentyears .thefundamentalserviceinteraction modelsinrestandsoaparedifferent.therefore testingrestful services requires different strategies.
model basedtestingtechniques.
besidesthetechniquesforrestfulapiandsoapservicetesting model basedtestingtechniques are also related to morest.
in general these techniques use models say a finite state machine to describe the system under testandgeneratetestsbycoveringdifferentstates in the model .
in particular palulu is a technique developed based on randoop which uses a call sequence model to quickly generate legal but behaviorally diverse tests for java classes.
palulu s intuition of using a model to guide the generation of valid api call sequences is similar to morest s. however the difference is that the model used in morest is tailored for restful api and it is dynamically updated during testing.
conclusion inthispaper weproposemorest amodel basedblackboxrestful api testing technique.
morest learns from the openapi specificationstobuildarestful servicepropertygraph rpg which encodes both schema and api operation information.
morest can userpgtoprovidehighlevelguidanceforcallsequencegeneration andcontinuouslyrefinetherpgwithexecutionfeedback.weevaluatedmoreston6opensourcerestfulservicesandtheresults showed that morest can significantly outperform state of the art techniques in both coverage and bug detection.