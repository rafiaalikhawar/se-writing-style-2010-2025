physframe typecheckingphysicalframesofreference for robotic systems sayali kate purdueuniversity usa skate purdue.edumichael chinn universityof virginia usa mec2wr virginia.eduhongjunchoi purdueuniversity usa choi293 purdue.edu xiangyuzhang purdueuniversity usa xyzhang cs.purdue.edusebastian elbaum universityof virginia usa selbaum virginia.edu abstract aroboticsystemcontinuouslymeasuresitsownmotionsandtheexternalworldduringoperation.suchmeasurementsarewithrespect tosomeframeofreference i.e.
acoordinatesystem.anontrivial robotic system has a large number of different frames and data have to be translatedback and forth from aframe to another.
the onus is on the developers to get such translation right.
however this is very challenging and error prone evidenced by the large numberofquestionsandissuesrelatedtoframeusesondevelopers forum.
since any state variable can be associated with some frame reference frames can be naturally modeled as variable types.
we hence develop a novel type system that can automatically infer variables frametypesandinturndetectanytypeinconsistencies andviolationsofframeconventions.theevaluationonasetof180 publiclyavailablerosprojectsshowsthatoursystemcandetect 190inconsistencieswith154truepositives.wereported52todevelopersandreceived18responsessofar with15fixed acknowledged.
our techniquealsofinds violations of common practices.
ccs concepts software and its engineering abstract data types software defectanalysis.
keywords physical frame of reference frame consistency type checking static analysis z score mining robotic systems acm reference format sayali kate michael chinn hongjun choi xiangyu zhang and sebastian elbaum.
.
physframe type checking physical frames of reference for robotic systems.
in proceedings of the 29th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse august 23 28 athens greece.
acm new york ny usa pages.
an extended version is available at arxiv .
esec fse august 23 28 athens greece copyright held by the owner author s .
acm isbn .
introduction roboticsystemshaverapidlygrowingapplicationsinourdailylife enabled by the advances in many areas such as ai.
engineering suchsystemsbecomesincreasinglyimportant.duetotheunique characteristicsofsuchsystems e.g.
theneedofmodelingthephysical world and satisfying the real time and resource constraints robotic system engineering poses new challenges to developers.
oneoftheprominentchallengesistoproperlyusephysicalframes ofreference.specifically theoperationofaroboticsysteminvolves moving individual body parts and interacting with the external world.
it entails precisely measuring positions and orientations of body parts and external objects.
all these measurements are representedwithrespecttoasetofcoordinatesystems alsocalled frames ofreference orframesinshort .forexample inathree dimensional coordinate system the location is meaningless unless we know the frame to which this location refers to.
the origin of a frame provides the reference position whereas theorientation of the three axes tells us the directions in which they point to.
further the origin and orientation of a frame itself may be defined relative to anotherframe andsoon.
roboticsystemsusuallyfollowamodulardesign inwhichbody parts and control software components are developed independently by various parties.
as such different components often usedifferentframes.forexample acamerahasthe cameraframe throughwhichthephysicalworldismeasuredfromthecamera s perspective.
in this frame the center of camera is the origin and the axes follow the orientations of the camera.
the body of a robot has thebody frame whose origin is the center of the body and axes arepre definedbasedontheshapeofrobot.measurementsinthe camera frame have to betranslated to the body frame before they can be used in body related computation.
since the camera can bemountedatdifferentplacesandmovesduringoperation such translation has to be done by the developers in software.
more discussion about frames and an example can be found in section .
mostroboticsystemsaredevelopedingeneralpurposelanguages such as c c facilitated by domain specific libraries.
such languages do not have intrinsic support for the additional complexity induced by the use of frames.
for example although popular libraries such as ros provide functions to facilitate translation between frames the onus is on the developers to determine the referenceframesofprogramvariables theplaceswheretranslation 45this work is licensed under a creative commons attribution international .
license.
esec fse august athens greece s.kate m. chinn h.choi x.zhang s.elbaum figure1 forumpoststhatshowframesinroboticprogrammingaredifficulttohandle.
note right sidesnapshotistakenfrom page licensed underthe cc by3.
is needed and correctly implement the concrete translations.
since translation is often done by vector matrix operations many developers even realizetheir own translation functionsfrom scratch withoutusingrosapis.asaresult useofframesiserror prone even for experienced developers.
this is evidenced by the fact that a large number of questions and issues for a robotic system project areusuallyregardingreferenceframes.figure 1showsthatquestionstaggedwith tf akeywordforrosframesupport are among the top ten types of questions by ros developers such as confusedaboutcoordinateframes tftransformsareconfusing and isthereaneasierwaytofindthecoordinatesofapointinanotherframe .also roswikiidentifiestransformissuesasoneof thetop5commonproblems.besidesthedifficultiesofgettingthem rightduringdevelopment misuseofframesmaycauserobotruntime malfunction code reuse problems and maintenance difficulties after deployment.
ros provides a number of tools to help developers debug frame relatedproblems .thesearemostlyruntimetoolsthatcanfacilitatevisualizationofframes relationbetweenframes detailsofa transformation between two frames e.g.
when it is created and by whichcomponent .
however it isalways more desirable to detect problemsasearlyaspossibleinthedevelopmentlife cycle.astatic tool that can scan and detect frame misuses before running the system would be highly desirable.
to the best of our knowledge there are unfortunately nosuch tools.
in this paper we introduce and implement a novel fully automatedstatictooltoidentifyframerelatedproblemsinros based projects.
developers direct the tool to operate on a project directory and the tool automatically models the project and checks for potential frame faults.
since each physical state related variable e.g.
sensor reading acceleration velocity and position is associated with some frame our tool builds on such such associations which are similar to variable types by nature.
we hence propose a type system to model reference frames.
a traditional type systemoftenstartswithtypeannotationsthatrequiredevelopersto know variable types in the first place which is difficult in our context as knowing the right frames is usually difficult.
instead our technique automatically infers frames and performs type consistency checks leveraging ros conventions that can be extracted from its specifications and mined from code repositories.
the technique uses frame information sources such as static data values exchanged between components and the ros frame apis for assigning frame types and defines type propagation and checking rulesbasedonthestandardcoordinateconventionsdocumentedin ros enhancement proposals reps and the semantics of frame related operations such as displacements and rotations.
as partofourcontributionwepresentatypelanguageasavehicletodescribe these type rules which constitute the foundation for our domain specific staticanalyzer.
our contributionsare summarizedas follows we propose a fully automated type inference and checking techniqueforphysicalframesinros basedprogramstodetectframe inconsistenciesandconvention violations.
we define frame and transformation abstract types and our systemautomaticallyinferssuchtypesforvariables.thisisachieved bynovel abstractionof framerelatedprogram semantics.
we present a data driven approach to identifying commonly followedpracticesthatmaynotbedocumentedanywhere.our systemalsochecksfor violations of such practices.
we implement a tool physframe and evaluate it on ros projects from github.
it reports type inconsistencies with 154truepositives .
.wereport52fromprojectsthatare recently active to developers and have received responses so far with fixed confirmed.
it also detects violations of common practices.
reference framesand ros .
frames acoordinatesystemthatisusedasareferenceformeasurementsof quantitiessuchaspositionandvelocityiscalleda frameofreference in short a frame.it isdefined by two components an origin point andtheaxessystem.aroboticsystemoftenconsistsofmanyparts eachhavingatleasta bodyframe withtheoriginatthecenterof therigidshapeofthepart andaxespointingtosomeorthogonal directions.itallowsmeasurementsintheperspectiveofthepart.
thebodyframeforthebaseofarobotisoftencalled base link .it is one of the most important frames in a robot as measurements in thisframedescribehowtherobotasawholeseestheworld.the bodyframeforacameraiscalledthe cameraframe .ifthepartis asensor itoftenhasotherframestodenotesensorreadings.for example acamerahasmultiple opticalframes includingthe color framemeasuring rgb format image the depth frame measuring depth image and the ir framemeasuring infra red image.
these framesarecenteredatthecorrespondingsensors e.g.
lens instead ofthe camera body.they are differentfrom the camera frame.
therearealsothe odometry odom frame themapframe and theearth frame to denote the physical world i.e.
how the world sees the robot and its surroundings.
the odomframe represents robot s initial pose and does not move with the robot.
it is like a thirdpersonstandingattherobot sstartingpositionandobserving themotionofrobotintheenvironment.the mapframeprojects everythinginalocalizedmapsuchasinsidearoom.itislikeathird person standingsomewhereintheroom notthestartingpoint of the robot and observing the robot and its environment.
the earth frameisan earthcenteredframe.
during operation sensor readings are acquired regarding the corresponding sensor frames.
they are then transformed to the body frames of the parts where the sensors are installed and eventually to the base link frame and some world frame s in which controlalgorithmsusethetransformedvaluestocomputeactuation signals.
these signals may undergo the inverse transformations untiltheyreachtheactuators.asimplecommodityrobotmayhave 46physframe type checkingphysical frames of reference forroboticsystems esec fse august athens greece figure frames inasimple robot up to different frames as shown in figure in appendix in andvalueshavetobecorrectlytransformedbetweenany pairofframes.itisaheavyburdenfordeveloperstogetallthese transformations right.
figure2showsasimplerobot.observethateachofitspartshas itsownbodyframe e.g.
camera link laser andbase link .there are also the world frames such as odomandmap.
suppose if the vehicle locates an obstacle then it knows the obstacle s position inthecamera depth optical frame.thispositionisdifferentfrom thepositionoftheobstacleinthe mapframe.inordertoanswer the question what is the position of an obstacle in the room?
thevehicleneedstoknowhowthe camera depth optical frameis positioned and oriented relative to the base link frame and how thebase link frameispositionedandorientedrelativetothe map frame then has to convert the obstacle position from the camera depth optical frame all the way to the mapframe.
moreover the position of the obstacle in the frame of front right wheel front right wheel is different from that in the base link frame.
hence to know the position with respect to the front right wheel the vehicle needs to know the position and orientation of front right wheelframe relative to the base link frame.
different body frames may have different axis orientation conventions.
figure 2presents two axis orientations labeled as f1 and f2.
each part has a default forward facingdirection e.g.
thenoseofanaerialrobotandthe frontofacamera thevalues forward backward left right etc.
are definedregardingthedefaultdirection.f1andf2arewidelyused inros.moreover variouslibrariesusedifferentconventions.for example x right y up z backward axis orientation is widely usedinopengl.
.
rosandframes the robotic operatingsystem ros isan open source software framework for building robotic applications.
its modular distributed nature has made it widely used.
its users range from a novice developer working on a hobby project to industries.
ros providesvariouscomponentssuchasdrivers localizationpackages odometer packages developed by the community in addition to the corecomponents.itprovidesapackagecalled tfortf2 to support transformation between frames.
ros transforms.
tospecifyframesandtransformations developersleveragethe tflibrarytoexplicitlypublishtransformationsbetween frames called transforms inros which alsoimplicitly introducetheframes.atransformconsistsofaparentframeand achildframe uniquelyidentifiedbytheirids.rosdevelopersoften say a transform is from the parent to the child.
for example map odom means a transform from the mapframe to the odom frame.
it is defined by providing the displacements of the child frame s origin and the rotation of its axes regarding the parent frame.
however the transform is used to translate states in the child frametotheparentframe nottheotherwaysuggestedbyitsname .
weunfortunatelyhavetoinheritsuchtermambiguityfromros.
in the rest of the paper we explicitly distinguish the name of a transform andits use instate translation to avoid confusion.
after transforms are published other ros components such as standardcontrolalgorithms subscribetothesetransformsbased on their names and use them in computation without knowing how they are implemented.
hence these core algorithms can be agnostic to concrete systemcomposition.
launch files.
many parts have fixed and static relative positions e.g.
camera mounted at a fixed position of an aerial robot.
the transformsbetweentheirframescanbestaticallydefinedin launch files whichareakindofstaticinitializationfilesthatdefinehow to start executing a robotic system.
the transforms for frames with dynamic relative positions e.g.
when a camera is mounted ona gimbal have to be publishedand updatedon the fly during operation.theyarehenceimplementedbycode.anexamplelaunch file snippetcan be foundinappendix a in .
tf tree.
transformsare potentiallyneededinbetweeneachpair offrames.
however specifying implementingtransformsforeach pair entails substantial and error prone efforts.
ros has a clean hierarchicaldesigntoreducethecomplexity.ifweconsideraframe as a node and a transform between two frames as an edge ros requires all published frames and transforms to form a tree that is no cycles and each node having only one parent.
we call it a tf tree.
as such the developer only needs to focus on realizing the transforms denoting individual edges.
ros then automatically constructs the transform from an arbitrary frame f1to another arbitraryframe f2 byfirstperformingthetransformsfrom f1tothe lowest common ancestor frame of the two and then the transform from the ancestor to f2.
it can be easily inferred that such a design substantially reduces the developers burden.
the below figure shows the tf tree for the robot in figure .
observe that while the developers only need to develop and publish transforms denoted by the edges ros allows transforms from a frame to anyother frame.
the red edges form a transformpath between front right wheel tocamera depth optical whentherightwheel onthe front ofthe robot uses data from the camera depthsensor.
.
frame conventionsin ros all ros projects follow certain conventions when manipulating frames.
violation to these conventions would cause integration maintenance andreuseproblems.ourtechniqueleveragesthese conventionstoautomaticallyinferandcheckframetypes.there are two sources for extracting conventions ros specification and 47esec fse august athens greece s.kate m. chinn h.choi x.zhang s.elbaum launchfiles.theformerisexplicitandthelatterisimplicit.since ros conventions are often related to static coefficients values e.g.
orthogonal axesorientations theyare difficultto extractdirectly from code where coefficients are largely variables.
explicitconventionsfromrosspecifications.
theseconventionscan be classifiedintothe following three categories.
namingconventions.
rosapplicationsusemessagestoexchange data between components.
the frame id field in a message specifiestheframeforthedatainthatmessage.theseidsfollowcertain conventions.
for example map is used for the map frame and base link for the body frame of the robot s base optical framesshould have an optical suffix .
axisorientationconventions.
accordingto bodyframesshould havethe x forward y left z up orfluaxisorientation i.e.
f1 orientation in figure optical frames should have the x right y down z forward orientation i.e.
f2 infigure .
treeorderconventions.
recallthatinaroboticsystem thepublished frames and transforms are organized in a tf tree.
ros requires tf treesfollowapartialorder earth map odom base link .
note that while a concrete tf tree for a specific robotic system mayomitsomeoftheseframesandhaveadditionalframes such an order must be respected.
the reason is that the order optimizes the performance for mostly commonly seen transforms.
implicit conventions from ros launch files.
launch files provide a rich resource for mining implicit conventions.
we focusonextracting twokindsofimplicitconventions.
co occurrenceconventions.
roboticsystemsofasamekindshare similarityintheirphysicalcompositions.assuch theyoftenuse similarframesandtransforms.thisisreflectedbyco occurrences oftransforms inlaunchfiles.for example agroundvehiclerobot withtwowheelshasonewheelonitsleftandtheotherwheelon its right.
if a transform from base link to the frame of left wheel is defined then a transform from base link to the frame of right wheel isalsodefined.
value conventions.
certain transforms are associated with fixed coefficientvaluessuchas0rotationanglesor0displacementvalues.
for example a transform from camera depth tocamera depth opticalmusthave 0displacementvalues.
motivation tomotivateourtechniqueweusecodefromthe simultaneouslocalization and mapping slam component orb2 slam2 links inthecaptionoffigure .localizationandmappingalgorithms like orb are key to the operation of modern mobile robots incrementallybuildingamapoftherobotsurroundingsutilizing itscameraastherobotnavigates.thiscomponent however uses differentconventionsfromrosandhencethemostimportanttask for interfacingthen isto perform appropriate frameconversions.
thecodesnippetinfigure 3aimstoimplementatransformto facilitate translation of states from the ros cameraframe to the rosmapframe using the environment model of orb slam2.
the conversion implementation however is incorrect and physframe catchesthis errorbytype checking.
constructingtheaforementionedtransformisnon trivial and consists of three groups of operations.
first given some ros state inthechild cameraframewiththeconventionalfluorientation it figure example ofincorrect transformbetween frames source source should be translated into orb s rdf orientation x right y down z forward .
second the position of the cameraframe in the map frameneedstobedetermined.however sinceorb slam2modelstheenvironmentinthe cameraframe onecanonlyquerythe position of mapframe in the cameraframe so it needs to be transposed to acquire the position of cameraframe in the mapframe.
third thetransformshouldtranslatetheresultsbacktoros sflu orientation.the code shownfails to accomplishthe last step.
function publishpositionastransform starting at line takes the orb slam2 s position matrix denoting the mapframe s position in the cameraframe i.e.
variable position and constructs a ros transform line by invoking transformfrommat whichstartsatline1.inline4itacquirestherotationmatrix fromtheorb slam2 spositionmatrix whichincludesbothdisplacementsandrotation andperformstranspositionbyfunction t .
line clones it to tf camera rotation .
line creates a matrix denoting rotation of an flu axis system anti clockwise for degree with respect to the xaxis shown to the right of thecode .lines13and17createtwoadditionalrotationmatrices.
lines compose the three matrices and the earlier rotation matrix.
line creates a ros transform from displacements denoted by tf camera translation and rotation denoted by tf camera rotation .whenthetransformisusedinstatetranslation a state is multiplied with tf camera rotation which equals to invyz rz rx rotation .thefirstthreematrixesareequivalentto transformingthefluorientationofthestatetotherdforientationasshownontherightofline25.thefourthmatrix rotation thentranslatesthestatefromthecameraframetothemapframe.
however the constructed transform is problematic as it forgets tofurthertranslatebacktoflu.thisbugwillcausedownstream system mis behaviors which could be devastating if the camera 48physframe type checkingphysical frames of reference forroboticsystems esec fse august athens greece figure overview of physframe readingsarethedominantsourceforcontroldecisions.itisfixed by appending the inverse rotation matrices of invyz rz andrxto tf camera rotation after line23 to changerdf to flu.
physframe associateseachstatevariablewithaframetypethat abstracts both the displacements and orientation of the frame in itsparentframe.italsoassociateseachtransformvariablewitha transformtypethatdenotesthedisplacementsandrotationneeded inframe translation.it propagates such types following operation semanticsandchecksconsistency.intheexamplecode itassociates matrixrxatline10withatransformtypefromthefluorientation atotheorientation b.thetypeisderivedfromtheconstantmatrix values.itfurtherassociatesmatrix rzatline13withatransform type from flu to the orientation c andinvyzat line from flu tod.
by modeling the semantics of matrix multiplications at lines and it determines that the transform at line has the type from flu to rdf.
this yields a type error at lines when the transform is published by function sendtransform because ros convention demands both camera frame and map frame to have flu whereas the transform convertsfluto rdf.
observethatitisdifficulttogetsuchtransformationrightdueto its intrinsic subtlety and complexity.
while this is only a one step transform as mentioned earlier a non trivial robotic system has more than different frames and transforms between any pair maybenecessary.theexamplebugisjustoneofthemanykindsof bugsphysframe detects.othersincludemissingframeandbroken tf tree.more discussioncan be foundinsection .
.
.
ourapproach .
overview figure4presents an overview of physframe .
it takes as input a c rosproject andoutputsframeinconsistenciesandimplicit conventionviolations.
physframe consistsofthreecomponents implicit convention miner file processor andtypechecker .
theminertakesadatabaseof statictransformsextractedfrom the launch files of a large repository of over mature ros projectsfromgithubandperformsdataminingtoinferimplicitconventions.
the miner identifies frequent static patterns that include pair of transforms that commonly co exist in a project transforms commonlyhavingzerodisplacements andtransformscommonly havingzerorotation.sincethesepatternsmayhappencoincidentally the miner computes a frequency for each pattern to quantify itscertainty weusez score asafrequencymeasure andreports it if it is above a specified z score threshold.
the mining process is executed once on the collected static transform database but can be updated as new static transforms are incorporatedinto the database.
the produced rule conventions are then used in theanalysisforeachsubjectrosprojecttoidentifyanti patterns.
details can be foundinappendix bin .
a ros project often contains multiple executable subsystems each having its own tf tree.
physframe has to analyze these subsystemsoneatatime.thefile processorseparatesaprojectinto subsystems eachconsistingofagroupofc c sourcefilesand launch files that are executed together.
a subsystem usually has aseparateinitiallaunchfile.thefile processorhencestartsfrom these top level launch files identifies the child launch files and the corresponding cmakelists files which indicate the source files involvedineachsubsystem andinturnfindsfile groupsthatrepresent the project s subsystems.details are elided.
thetypecheckerthentakespatternsandfilegroupsinformation togetherwithprojectfiles andtypesvariablesandstatementsin thec c sourcefiles.typeerrorsarereportedwhentheprogram cannotbeproperlytyped.
physframe reports7kindsoftypeerrors and kinds of type warnings as inconsistencies and reports kinds of implicit convention violation warnings see section .
.
.
warningsmaynotleadtobrokenfunctionalitiesbutproblemsin code maintenance and reuse.
in the following we will focus on explainingthe type system.
.
typesystem before introducing the formal language and type rules we intuitively explain how frames and transforms are used.
typically onesteptransformobjectsareexplicitlycreatedtofacilitatetranslation of states in a child frame e.g.
position to a parent frame.
a transform specifies the relative position and orientations of the child frame in the parent frame denoted by displacements and rotations.
italsospecifiesthe string idsforthechildandparentframes.anid istheuniquerepresentationofaframe.thecreationsoftransforms also implicitly define frames through the ids .
they are implicit as therearenoexplicitrosdatastructuresforframes.astatevariable can be explicitly associated with some frame id yielding a stamped arosterm statevariable.atransformcanbeexplicitlyappliedto somestampedvariable inachildframe toacquireitscorrespondenceintheparentframe.one steptransformscanbepublished andhencebecomepartoftheglobaltftree.assuch transforms betweenarbitraryframes e.g.
thosemultiplestepsapart canbe automaticallyconstructedbytraversingthetree section .
.to define a one step transform developers often explicitly specify the entailed rotation.
a rotation can be composed from others.
for example a60degreerotationcanbecomposedfromtwo30degree rotations.
plain state variables not stamped can be operated on just like regular c c variables data structures.
as such even they implicitly belong to some frames frame inconsistencies cannot be detected.
furthermore ros does not provide type checking mechanism even for stamped variables.
the c c type system cannot offer help either as it does not have any domain knowledge.
forexample itcantypeavariabletoarostransformdatastructure but cannot identify the specific transform type i.e.
the parent andchildframesandthe displacementsandrotation involved.
.
.
a simplified language and types.
ros is based on c c with a set of library functions.
while our type system supports the complex syntax of c c ros and models the frame related apis 49esec fse august athens greece s.kate m. chinn h.choi x.zhang s.elbaum weuseasimplifiedlanguage fordiscussionbrevity.thelanguage focuses on modeling frame related semantics and ignores the standard c c types operations and statements.
it directly models anumberofros tfapisaslanguageprimitives.moreover since ouranalysisisflowinsensitive controlstructurelikeconditional statements andloopsare less relevantandhence not modeled.
types.we define three types frame type frame that representstheframeinformationofastatevariable transformtype transform that represents frame transforms and rotation type rotation thatrepresentschangesintheaxes directions.notethat theseare not ros types but rathertypes in physframe .
frame type.
this is an abstract type and always used with some concrete state type such as pointandpose indicating points and poses in a specific frame respectively.
for example ros uses tf stamped t t x ... string id todenotea ttypestate objectassociatedwithaframeidentifiedby id.theframetype s definitionisas follows.
frame id pid x y z d x dy dz itiscomposedofeightfields iddenotingthe string nameofframe pidthenameofitsparentframetype thenextthreefields x y z beingthepositions oftheframe s originwith respect toitsparent frame where theirvaluesare oftype displacement .
displacement r where risastaticnumericalvalue and representsavalueunknownstatically.thenextthreefields dx dy dz encodethe x y z axesorientations ofaframe withvaluesofthe orientation type orientation left right up down forward backward they denote the orthogonal orientations of axes regarding the bodypartcorrespondingtotheframe .theyareindependentofthe placementofthebodypartregardingitsbase.forexample although acameramaybeinstalledwitharbitrary andevendynamic angles regardingarobot sbody theorientationofthecameraframe saxes isforward left up flu which is orthogonal regarding the camera.
althoughaxesorientationsareorthogonal differentcomponents and robotic frameworks have different orientation conventions transformations needto be explicitly performedbydevelopers.
transform type.
ros allows developers to create transform objects that denote transformation from a frame to another e.g.
using the tt transformer class .
we associate such objects with a transformtypethatabstractsinformationtofacilitateconsistencyand convention checks.the transform type isdefinedas follows.
transform cid pid x y z r here cidandpidarethechildandparentframeids respectively x y zareabstract valuesofthe aforementioned displacement type and rdenotesanabstractrotation whichwillbeexplainednext.
the displacementsandrotation togetherdefineatransformation.
rotation type.
rotations change axes orientations of a frame.
ros allowscreationoffirst orderrotationobjects e.g.
throughtheros tt transform class and manipulations of these objects.
they canbefurtherusedtoconstructtransformobjects.inthiswork we are interested in orthogonal rotations such as those with or degreesastheyareusedinchangingaxesorientations.wehence program p colonequals statement s colonequals1 s2 x v x y x yopz fx stamped s x fx.id s x get data fx fx fy fx external fx transform to s fy tx new transform schd spnt x y z rx sendtransform tx tx lookuptransform spnt schd fx apply transform tx fy rx v3 rx x rx ry rz publish stopic fx statevar x y z stampedstatevar fx fy fz transformvar tx ty tz rotationvar rx ry rz constvector v conststring s figure language definerotation type as follows.
rotation dsx dsy dsz the three fields dsx dsy dszare variables of dirswitch type dirswitch x x y y z z fielddsxholds a value indicating that the axis denoted by the value points in the same direction as the previous xaxis i.e.
the x axis before rotation .
fields dsyanddszwork in a similar way.
we use the following example to explain the semantics.
let z x y be arotationtype.
it switches orientations of axes such that zaxis points in the same direction as the previous xaxis direction xaxis points in the same direction as the previous y axis direction i.e.
thecurrent xaxisistheoppositeoftheprevious yaxis and ypoints in the same direction as the previous zaxis direction.
assumea variableofframetype ... forward left up .
after applying the aforementioned rotation a new frame type ... right down forward is derived.
value means the rotation is not orthogonalorcannotbe determinedstatically.
language.
figure5presents the language.
we call all ros state variables statevar such as tf point andtf pose .
state variables are frame agnostic.
when they are explicitly associated with someframe theybecome stampedstatevar1 correspondingto tf stamped point andtf stamped pose etc.inros.weuse x y z forstatevarandfx fy fzforstampedstatevar .wealsousevariables tx ty tzandrx ry rzto denote transform and rotation variables.
notethatthesevariablesarenottyped.theirtypeswillberesolved byourtyperules.wedistinguishdifferentkindsofvariablesjust for betterreadability.
statement x v denotes a state variable assignment using a constant vector.
a scalar variable can be considered as a vector variable with one dimension.
function stamped explicitly associates xwith a frame denoted by a string s corresponding totf stamped t stamped in ros.
ros allows stamping a state variable with an empty id and later explicitly setting the id fieldofthestampedvariable.acommonerroristhatthedeveloper stampsanemptyframeandlaterforgetstosettheframe.statement fx.id s models the set frame operation.
function get data retrieves the plain state from a stamped state variable.
function external modelsthesituationswherestampedstatevariablesare 1ros uses the term stamped to denote that a variable is contextualized with a frame.
wehence useasimilartermhere.
50physframe type checkingphysical frames of reference forroboticsystems esec fse august athens greece publishedbylibraries without sourcecodeand hencebeyondour analysis.
function transform to transforms fyto a target frame denoted by s yielding a new stamped variable fx.
it corresponds to ros functions such as tf transformer transformpoint .
function new transform createsaone steptransformobjectfor translatingstatesinthechildframetotheircorrespondencesinthe parent frame.
it specifies the parent and child frame ids by spnt andschd respectively thedisplacements bystatevariables x y z and the rotation by rx .
the displacements and rotation specify the linear and angular positions of the child frame with respect to the parentframe.
this primitive correspondsto creating a ros tf stampedtransform object.
one step transforms can be publishedbyfunction sendtranform suchthattheybecome edges of the tf tree section .
.
function lookuptransform finds a transformfromframe spnttoframeschd.thesetwoframesmaynot correspond to any publishedone step geometric transforms.
recall that ros automatically constructs a transform by finding a path fromspntto the lowest common ancestor in the tf tree and then toschd.
it corresponds to tf transfomer lookuptransform .
function apply transform appliesa transform txto a stamped variablefy.assuch fymusthavethechildframetypeof txandfx havetheparentframetypeof tx.statement rx v3 3 specifies a constant rotation by a times matrix.
one can also specify a dynamic rotation from a matrix vector variable.
two rotations can be aggregated to one by matrix multiplication .
a stamped variablecanbepublishedtoatopic.any remote subscribesofthe topicwillreceivethe value.as such the variable sframemust be properly set.otherwise remoteparties cannotmake sense ofit.
whilephysframe supportsconditionals loops functions and otherframerelatedros apis.
they are elidedfrom our language.
.
.
typerules.
table1presentsthetyperules.theserulesinfer typesfor statevariablesand frame related variablesand check for any inconsistencies that is variables cannot be properly typed e.g.
a variable having more than one types following the rules.
weusemeta variables t and rtorangeovertheinfinitesets offrame transform androtationtypes.
in our rules a variable x meansthat xhas type.astatement x ... meansthat the statement has type which is equivalent to the left hand side variablexhaving typeaswell.ingeneral aruleisreadasfollows ifthepremisesaresatisfied e.g.
typechecked theconclusionsare yielded.the rulesare driven bythe syntax ofthe language.
data assignment rules.
ruler1specifies that for a copy statement if the right hand side is typed to the left hand side is typed to aswell.rule r2requiresthatinabinaryoperationofstatevariables the two operands must have the same type .
then we conclude theresultofthestatementhasthesametype.rule r3specifiesthat ifxis typed to which has the sas the frame id we can conclude fxhas the same type .
note that type inference is flow insensitive ifxwas free i.e.
untyped the rule types it to .
ruler4types an explicitsetframestatementtothetypedenotedbytheidstring s. ruler5specifiesthatifastatevariable xisacquiredfromastamped variablefx xinherits the type of fx.
ruler6specifies two stamped variables inacopy statementmusthave the same type.
transformation related rules.
ruler7types a transformation statement.specifically themeaningoffunction reachable isdefined in figure .
it asserts that there is a direct indirect transform fromreachable s1 s2 s1ands2share some common ancestor in the tf tree and hence reachable from eachother disp x braceleftbiggr xholdsa constant r rafter constantpropagation otherwise rotate dx dy dz dsx dsy dsz nx ny nz with nx dx dsx x opposite dx dsx x dy dsy x opposite dy dsy x dz dsz x opposite dz dsz x otherwiseny ... nz ... tree form with edge s1 s2 addingannewedge denoted by s1 s2doesnot break the tftreeform orthogonalize v3 braceleftbigg dsx dsy dsz dsx dsy dsz otherwise dsx x v1 x v1 y v1 y v1 z v1 z v1 otherwisedsy ... dsz ... compose ds x ds y ds z ds x ds y ds z dsx dsy dsz dsx ds xds x x ds xds x x ds yds x y ds yds x y ds zds x z ds zds x z otherwiseny ... nz ... figure auxiliary functions used intype rules fy sframe 1totheframe denotedby s.ifso weconcludethat fx has type.
rule r8types a statement that creates a one step transformfrom schd spnt x y z rx .itentailstheintroductionofan implicitframetype cwhoseidis schd parentidis spnt displacements are those abstracted from x y zusing the disp function defined in figure and axes orientations are resulted from applying the abstract rotation specified by the rotation type rofrxto theorientationsoftheparentframe.function rotateisdefinedin figure6.ittakesa3 dimensionsourceorientation withvalues left right forward etc.
and a dimension rotation with values x y etc.
andproducesaresulted3 dimension targetorientation.
specifically theresult xorientation denotedas nxisdeterminedby searching for which rotationdimension has value of x or x .
if theyrotation has value x denoted as dsy x nxhas the same orientationastheoriginal yorientation i.e.
dy .ifthevalueis x theorientationisflipped.anexampleofsuchrotationcanbefound inthe discussionofrotation type at the end of section .
.
.
ruler9types a statement that publishes a transform tx.
it requirestheedge fromtheparentframetothechildframedoesnot break the tf tree e.g.
by introducing cycles or having multiple parents for a child.
the tree form with edge function not only checks the condition but also adds the edge to the tf tree if the condition is satisfied.
rule r10types a statement that looks up a transform from an arbitrary parent frame to an arbitrary child frame in the tf tree.the transformmay not be any of the created one steptransforms butratherautomaticallycomposedbyrosby traversing the tree.
it requires reachability between the two frames in the tree which implicitly demands the existence of the two 51esec fse august athens greece s.kate m. chinn h.choi x.zhang s.elbaum table type rules r1y x y r2y z x yorz r3 .id s x fx stamped s x r4 .id s fx.id s r5fx x get data fx r6fy fx fy r7 .id sreachable .id 1.id fy 1 fx transform to s fy r8rx r c schd spnt disp x disp y disp z dx dy dz schd!
spnt p.id spnt dx dy dz rotate p.dx p.dy p.dz r tx new transform schd spnt x y z rx schd spnt disp x disp y disp z r r9tx ttree form with edge t.pid t.cid sendtransform tx t r10reachable spnt schd t.pid spnt t.cid schd tx lookuptransform spnt schd t r11tx tfy t.pid .id t.cid .id fx apply transform tx fy r12 r orthogonalize v3 rx v3 r r13rx x r14 r ds x ds y ds z r ds x ds y ds z ry rrz r r compose r r rx ry rz r r15ry dsx dsy dsz rz rx ry rz dsx dsy dsz r16fx publish stopic fx frames.
rule r11specifies that when typing a statement applying a transform txto astamped variable fy thetransform s child frame mustequalto fy sframe anditsparentframeistheresultingframe.
r16types a statement that publishes a stamped variable.
it requires that the variable isproperly typed.
rotation relatedrules.
ruler12typesthecreationofarotationfrom a3 3constantvector.function orthogonalize isusedtoabstract thevectortothecorresponding dirswitch abstractvalues.itsdefinitioncanbefoundinfigure .specifically anorthogonal3 3vector is composed of three orthogonal unit vectors i.e.
each row and each column has only one non zero element of value or .
now if we consider that rows represent initial x y zorientation andcolumns represent then changed x y zorientation then the column position of the non zero element in a row indicates theaxisofthechangedorientationthatisthesameastheaxisof theinitialorientationrepresentedbytherow.forexample value in row and column denotes that the direction of yaxis of initial orientation becomes the direction of xaxis of the changed orientation.
when the matrix does not denote orthogonal rotation the resultedtype is .
ruler13types a rotation creation from a variable i.e.
nonconstant .
it usuallycorresponds to angular transformationthat is neededforstatetranslationacrossframes butnotfororientation changes.
for example if a cameracan spin regarding the body its readings regarding the camera frame have to go through a dynamic angular transformation in order to be interpreted regardingtable type checkingofexample infigure st statement type rule 6tf cam rotation tmp r13 10rx x z y r12 13rz y x z r12 20tf cam rotation rx tf cam rotation x z y r15 21tf cam rotation rz tf cam rotation z x y r14 23tf cam rotation invyz ... z x y r14 25rtmp tf cam rotation z x y 30ttmp new transform scam smap ... rtmp errorbecause rotate f l u z x y r d f r8 the bodyframe.
notethat in this case theangular transformation isindependentofframeorientations.boththecameraandthebody frameshaveorthogonalorientations.rule r14typesarotationcompositionstatement.itleveragesfunction compose toderiveanew rotation type.
in thefunction definitioninfigure ds x ds y ds z and ds x ds y ds z bothdenotechange in the orientation where the formerchange isfollowedby thelatter.
forexample rzandrx vectors in our motivating example figure represent y x z and x z y changesrespectivelyasperrule r12.partainthebelowfigure showsthese orientation changes ina sequence whereas part b shows the orientation change that is computed by aggregating these two changes.
note that both parts result into the same orientation.
r15typesarotationcompositioninwhichoneoftherotationsis notstaticornotorthogonal.notethatanarbitraryangularrotation can be integrated with an orthogonal axes orientation rotation.
since we only model and check axes orientation the resulted type isthe one that represents orthogonalorientationchanges.
example.
table2presents part of the example code in figure writtenin our languageandthe types computedbythe type rules.
thefirstcolumnshowstheoriginallinenumbersofthestatements.
st 6isanassignmentofarotationvariablefromastatevariable.
the state variable tmpgets a value from the external value state variablerotation.therefore asperrule r13 tf cam rotation istyped to .st 10and13aretheassignmentsofrotationvariablesfrom constantvectors.rule r12allowstyping rxandrzto x z y and y x z respectively.
further st 20and21denote thecomposition of rotations the former is typed with the type of rxbyr15as thetypeof tf cam rotation is whereasthelatteristypedwith z x y whichiscomputedbycomposingtypesof rzandtf cam rotationusingrule r142.st 23and25aresimilarlytyped.finally st constructs a new transform object.
however it cannot be properlytypedbyrule r8asapplyingrotation z x y totheparentmapframewiththeconventionalorientation forward left up i.e flu yieldstheorientation right down forward contradicting withtherosorientationconventionfluforthecameraframe.on theotherhand physframe correctlytype checksthefixedversion.
soundnessandcompleteness.
the essenceof physframe isto leverage flow insensitive static analysis like type checking to 2physframe uses ssato handlevariablere definitions.
52physframe type checkingphysical frames of reference forroboticsystems esec fse august athens greece findframerelatedbugs.itisautomatedanddoesnotrequireany usertypeannotationsforsubjectrosprojects.assuch thetype systemisneithersoundnorcomplete.thisisbecausesometype rules are uncertain.
for example in rule r12 a matrix representing orthogonal angular transformation may not be intended for frame axesorientationchanges butratherbecausetheparentandchild bodypartsareinstalledinawaythattheyformsomeorthogonal angle s while their frame axes orientations are identical both flu .
however since there isno way for physframe to knowthe real meanings of such rotation without user input it considers this an axes orientation rotation which is the most common case.
and stamped variables from third party libraries are widely used and physframe maynotbeabletotypethem.therefore physframe has both false positives and false negatives.
on the other hand we foresee future robotic system development frameworks may support full fledged frame types which the developer can use to declaretheirvariables.withsuchexplicittypedeclarations asound andcomplete type systemcan be developed.
.
.
framerelatedproblems.
physframe reports7kindsoftype errors 2kindsoftypewarningsand3kindsofviolationsofimplicit conventions.
the firsttwoare alsocalledinconsistencies.
type errors.
thisfirstkindis tftreerelatederrors.
theseerrors includea frame having multiple parent frames frames forming a cycle andframes not following conventional orders such as a map framemustbe the ancestorofabody frame section .
.
thesecond kindoftype errorsis incorrect framesor transforms.
rosallowsdeveloperstostampastatevariable xwithanempty id.
if these variables are published meaning that other components from different parties may receive such data they should be stamped with a proper frame rule r16 .
moreover if they are used in transforms runtime errors will be triggered as well.
in these cases physframe reports a missing frame error .
although notexplicitlymodeledbyourrules afewrosdatatypesrequire explicitly specifying child frame ids.
if child frames are not set physframe reportsmissing childframe errors .
atransformisrequiredtohavedifferentparentandchildframes ruler8 .
otherwise it is meaningless.
physframe reports a redundant transform .
ruler8requires that the displacements and rotationinanewlycreatedtransformshouldyield relative positionsandaxesorientationsconsistentwiththeparentframeand ros conventions e.g.
body frames should have forward left up flu orientations .
otherwise itreports incorrecttransforms .
type warnings.
asensortransformthatdefinesasensorframe with respect tosome other robotic body part like base link wrist etc.
or vice versa should have at least some non zero displacement s rotation s as a sensor s center unlikely aligns with a body part scenter.
physframe reportsawarningwhenasensortransformhaszerodisplacementsandrotations.foratransformfrom parenttochild rosnamingconventionsfollowtemplates parent to child and child in parent whichgivetheclear meanings of the transform.
developers however often inverse the parentandthechildintransformvariablenames.
physframe hence reportsreversed name warnings .
these two are warnings as they maynotaffectthefunctionalitiesbutratherdegrademaintainability.
suchcheckingsarenotexplicitlymodeledintyperulesalthough physframe supports them.implicit convention violations.
as mentioned in section .
implicitconventionsareminedfromlaunchfiles.assuch theymay notberequiredbutrathercommonlyseen.
physframe reportsthree kinds ofwarnings.
the first is null displacement expected warning meaning that certain transforms or frames are supposed to have null displacements.the secondis nullrotationexpected warning meaningthatcertaintransformsaresupposedtohavenullrotations.
thethirdisthat co occurrenceviolation warningswhenframesthat are commonly seen together in other projects are not present in a project.
such checkings are performed as an additional step afterframeandtransformtypesareinferred.thereasonisthatitis hard to implement implicit conventions as type rules as the mined conventionsmaychangedependingontherepositoriesusedand the z score threshold setting.
evaluation we address the following questions rq1.how effective and efficientisphysframe indisclosingframerelatedinconsistencies?
rq2.what is the response from developers on the inconsistencies reported by physframe ?rq3.what kinds of implicit conventions are violatedandwhat isthe impact of z score onresults?
.
experiment setup implementation .
we have implemented a prototype of physframein around lines of python code.
it utilizes a third party component cppcheck to obtain an xml dump for a c c file providing an intermediate representation.
it contains program tokens symboltablesforscopes functionsandvariables andan astforeachstatement.wehavealsoimplementedconstantpropagationtoresolvevariablestostaticvalueswhenpossible.theminer isimplementedusingmysqldatabaseandsqlscript.implementationdetailscanbefoundinappendixcin .thedatabaseforthe implicitconventionminerisbuiltfromalistofrosprojectsthat containatleastonelaunchfilewitha static transform publisher .we useonlythematureprojectsfromthislist.weconsideraprojectmaturewhenithasmorethan30commits.thedatabasecontains12.1k statictransformsin5.3klaunchfilesfrom2.2kmatureprojects.the tool and data is available at artifacts .
we run the type checker on ros projects from github.
they include a projects from the ros kinetic distribution that contain at least one issue or a commit related to frame b randomly selected projects from the ros indigo distribution and c randomly selected ros projects that contain at least onestatictransform.amongtheseprojects 69arematureand99 not with less than commits .
note that we consider evaluation on unmature projects important as well because they are likely by non expertrosdevelopersthatcanbenefitmorefrom physframe .
table7inappendixin showsthestatisticsoftheseprojects.
onaverage eachprojecthas45source launchfilesand52491loc withthe largestone having433filesandover 7million loc.
examination process .
we examine each of the reported inconsistenciesbyreviewingthecorrespondingsourcecodeandmark it astrue positive tp orfalse positive fp .
the manual examination poses a threat to the validity of results presented in this paper please refer to appendix d in .
we mitigate it by crosschecking beingveryconservativeinmarkingtps andconfirmation 53esec fse august athens greece s.kate m. chinn h.choi x.zhang s.elbaum table inconsistenciesby category with thefirstseven type errors thelasttwotype warnings category number of inconsistencies number of repositories total tp fp total tp fp c c launch c c launch c multiple parents in frame tree c cycle in frame tree td incorrect frame order in tree c incorrect transform td redundant transform td missing frame td missing child frame td reversed name typewarning c sensor null typewarning total table summary oftrue positive inconsistencies report response countinconsistency categories foundby searching commit historyorissue reports of repositories.3td missing frame 1c incorrect transform fixed by developers beforewereported them.1td missing frame 1td redundant transform 1c cycle in frame tree 1c multiple parents in frame tree reported and either fixed by developersor readyto accept a pull request.2td missing frame 1td missing child frame 1td redundant transform 1td incorrect frame order in tree reported and acknowledged by developers in some cases confirmed as a useful fix to others for reusing the package node .1td missing frame 5td reversed name 2c sensor null 2td incorrect frame order in tree reported butrefused by developersonthe grounds that reuseof the package node is not easy orthe package is nolonger maintained.3td missing frame reported butno responsefrom developersyet.12td missing frame 1td missing child frame 4c incorrect transform 14td reversed name 1td incorrect frame order in tree 2c multiple parents in frame tree foundin a package nodethat is reused by otherdeveloper.
the issue is either fixed or acknowledged by other users in the original repositoryof the node.2td missing frame 4td missing child frame foundin backup copy files in repositories.5td missing frame potential issues.
8td missing frame projectsnot activein past twoyears.55td missing frame 2td missing child frame 3c incorrect transform 10td reversed name 1c sensor null 3td incorrect frame order in tree 1c multiple parents in frame treetable implicitconvention warningsby category category z z z z w r w r w r w r w sig null rot exp w name null rot exp w name co occurrence with developers.
the implicit convention violation warnings are by their nature more difficult to determine if they denote real bugs.
we hence run the tool on the same set of projects with different z score threshold values and study the reported warnings.
all type checkingrunsareonadellpoweredger420linuxserverwithtwo intelxeone5 .90ghz8 coreprocessorsand192gbofram.
.
results andobservations rq1.
effectiveness and efficiency.
physframe reports inconsistencies with 154true positivesand81.
truepositive rate.
theseinconsistencies belongto 100projects over ofthetotal we examined.
this number is specially significant considering that manymoreframerelatedbugsreportedinearlierversionsofthe systemsmayhavebeendetectedby physframe .physframe also reports45 9implicitconventionviolationwarningswhen the z score threshold is set to respectively which corresponds to p values smaller than .
for z to p values smaller than0.00001forz .theaverageanalysistimeis52secondswith themaximum1190seconds.furtherdetailscanbefoundintable6 inappendix in .
inconsistencies by category.
table3summarizes inconsistencies by theircategory withthefirstseventypeerrorsandthelasttwotype warnings.thefirstcolumnliststhecategories.eachhaseithera c or td prefix denotingwhetheritisa correctness ora technical debt issue respectively.
the correctness issues represent the typesofinconsistenciesthatviolaterosconventionssuchasatree representation of all the frames in an application sensor frames shouldhavenon nulltransformswithrespecttorobotbodyframes andincorrecttransforms.theincorrecttransformissuesinclude those that have invalid displacement rotation like our motivating example insection which can leadto problems duringruntime andthosethatdonotfollowrosnamingconventions discussed in section .
while defining a child frame in the transform which affectcodereadabilityandmaycauseissuesduringcodereuse.the technicaldebt issuesrepresentthetypesofinconsistenciesthat 54physframe type checkingphysical frames of reference forroboticsystems esec fse august athens greece may make code maintenance and understanding difficult and may leadtopotentialruntimeproblemsduringcodereuse collaboration.
thenextfivecolumnsshowthetotalnumberofinconsistenciesfor eachcategory tp casesinc c codeandinlaunchfiles fpcases in c c code and in launch files respectively.
further the last threecolumnsshowthenumberofprojectswithinconsistencies tps andfps respectively.
many of the reported inconsistencies are about missing frames i.e.
developers forgot to set frame ids for published state values.
fp cases of this type are observed due to usage of stamped data typesforstoringnon framedata e.g.
binarymaskofimage usage ofstampedtransformfortfoperationsthatdonotneed frame id fieldvalue andpassingofstampeddatatypevariablestofunctions whose signature is not available during analysis.
similar sources of false positives affect other categories.
physframe also found many reversednamewarnings.forexample rosexpectstransformvariables to follow the naming convention of parent to child .
we find that many developers use the names reversed.
this may causemaintenanceandreuseissuesastheconventionisexpected by other parties.
physframe also identified frame type inconsistencies similar to our motivating example in section 3and tftreeerrors.giventhatrosisbuilttoencouragecollaborative development even the issues affecting code readability or reuse canbeimportant.wehavethreecasestudiesinappendixein .
rq2.developerresponses.
table4summarizesthedistribution ofthetruepositivesacrossdifferentreportingactions developer responses and inconsistency categories.
row below the table title shows that4ofthe154true positives physframe uncovered wereknownissuesbythedevelopers.
row2showsthatanother four were fixed by the time we reached the developers.
among the remainingtruepositives wereportedthe52thatbelongtoprojects that showed activity in the past years rows .
we received 18responseswith15eitheracknowledgingthisissueorfixingit and declining our reports because either it is not seen as relevant project is not intended for external use hence conventions do not needtoberespected orprojectnolongermaintained.row8shows thatphysframe found bugs in reused versions of projects that have already been fixedinthe originalrepositories.
rq3.implicitconventionviolations.
table5showsthethree kindsofimplicitconventionviolations physframe has foundand theimpactofz scorethreshold.w meansthenumberofwarnings and r the number of projects with warnings.
the most popular kind is w name null rot exp meaning that a transform with a specific name is expected to have rotation w sig null rot expis similar except that a transform is identified by parent and child frame ids instead of name.
some of the w sig null rot exp warningsarepersistent withdifferentz threshold meaningthat conventions adoptedbyalmostallprojectsare being violated.
related work component basedrobotsoftware.
component basedprogramming hasbeenextensivelyusedinrobotdevelopment aiming to facilitatereuse.followingthe principle severalrobotsoftware frameworks such as open robot control software orocos ros .player miro havebeendevelopedand widely used.
these frameworks commonly provide communication infrastructure across components and substantial librarysupport.
as such respecting conventions is critical for these infrastructures.
unfortunately they provide no compile time support to ensureframeconventions oneofthemosterror proneaspectsof robot programming.
physframe is a type checking technique that systematically detectsproblems inusing frames.
typecheckinginroboticsystems.
typechecking isa well known technique to improve software reliability.
in robotic software due to its domain specific characteristics variables oftenhavephysical worldsemantics.additionaltypecheckingcan hence be performed considering the physical world.
unit type checking is the most common robotic software type system whichtype variableswithphysicalunitinformation.theseminal work in the type checking of units and dimensionsextendsaprogramminglanguage.ayudante buildsandcompares clusters of variables based on dataflow and the meaning of variablesnamestodetecttype e.g.
unit inconsistencies.therecent work on phriky supports dimensionality type checks in ros without developer annotations and phys extends it with probabilistic type inference to detect more inconsistencies.
in this workweextendthetypecheckingtoreferenceframesinrobotic software whichrequires adistinct type system.
frame safety.
lowry et al.
proposed a general abstract interpretationsystemforcertifyingdomain specificpropertiesand provideacasestudytocertifynaiflibraryprograms frame safety.
the case study checks limited properties e.g.
frame consistencies and thesystem needs annotations for program inputs.
in contrast oursisafullyautomatedtoolcheckingmanypropertiesforros projects e.g.
tf tree shape and frame orientations without requiringannotations.ourabstractdomainsarehencedifferentfrom theirs andour method istype systembased.
the workby basir et al.
onautomated theoremproving for automatically generated codealsopresentedacasestudytoverifytwoframe safetyrequirements.meta amphionsystem helpsdomainexpertsbuild domain specific program synthesizers.
in the context of framesafety we believe that this work would enable the synthesis of programsthatareframe safegiventhecorrectdomaintheory.in our work we focus on finding frame issues in the already developedcode.overallwedonotneedannotations haveapush button approach andprovideabroad assessment of real code.
conclusion wedevelopafullyautomatedtypecheckingtechniqueforreference frames in robotic system which is one of the most subtle and error proneaspectsinroboticsoftwareengineering.weexplainthe semanticsofframesandframetransformations andproposeanovel way to abstract them.
type checking rules are developed based on the domain specific semantics.
applying our technique to ros projects from github discloses over errors and warnings with 154truepositives.wereported52ofthemandreceived18responses bythe time ofsubmissionand15 fixed acknowledged.