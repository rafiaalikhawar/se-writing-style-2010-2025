synthesis ofweb layouts fromexamples d ylan lukes dlukes eng.ucsd.edu ucsandiego la jolla ca usajohn sarracino jsarracino cornell.edu cornelluniversity ithaca ny usacoracoleman ccoleman eng.ucsd.edu ucsandiego la jolla ca usa hila peleg2 hilap cs.technion.ac.il technion haifa israelsorinlerner lerner eng.ucsd.edu ucsandiego la jolla ca usanadia polikarpova npolikarpova eng.ucsd.edu ucsandiego la jolla ca usa abstract wepresentanewtechnique forsynthesizingdynamic constraintbased visual layouts from examples.
our technique tackles twomajor challenges of layout synthesis.
first realistic layouts especially on the web often contain hundreds of elements so the synthesizer needs to scaleto layouts of this complexity.
second in common usagescenarios examples contain noise sothe synthesizerneeds tobetoleranttoimpreciseinputs.toaddressthesechallengeswe propose a two phase approach to synthesis where a local inference phase rapidly generates a set of likely candidate constraints that satisfythegivenexamples andthena globalinference phaseselects asubsetofthecandidatesthatgeneralizestounseeninputs.this separation of concerns helps our technique tackle the two challenges the local phase employs bayesian inference to handle noisy inputs whiletheglobalphaseleveragesthe hierarchical natureof complexlayoutstodecomposetheglobalinferenceprobleminto inference of independent sub layouts.
we implemented this technique in a tool called mockdown and evaluated it on nine real world web layouts as well as a series of widespread layout components and an existing dataset of androidapplications.ourexperimentsshowthat mockdown is able to synthesize a highly accurate layout for the majority of benchmarks from just three examples two for android layouts andthatitscalestolayoutswithover600elements about30xmore thanhas been reported inprior work onlayoutsynthesis.
ccs concepts softwareanditsengineering sourcecodegeneration automaticprogramming programming by example.
keywords program synthesis constraint basedlayouts weblayouts bothauthorscontributed equally to thisresearch.
2work donewhile at ucsan diego.
esec fse august 23 28 athens greece copyright held by the owner author s .
acm isbn .
format dylan lukes john sarracino cora coleman hila peleg sorin lerner and nadia polikarpova.
.
synthesis of web layouts from examples.
in proceedingsofthe29thacmjointeuropeansoftwareengineeringconference andsymposiumonthefoundationsofsoftwareengineering esec fse august 23 28 athens greece.
acm new york ny usa 13pages.
introduction visuallayout istheproblem ofarranginggraphicaluser interface gui elements on screen.
creating layouts is an integral part of developingdesktop mobile andweb basedapplications.inallthese domains thelayoutsmustbe dynamic thatis theabsolutepositions oftheguielements alsocalled views mustadjusttothedimensions of theroot view in order to keep the application functional and aestheticallypleasing for awide range of dimensions .
constraint base d layout.
for webpages dynamic layouts are usually defined using cascading style sheets css .
however theexpressivityofcssislimited forexampleinallowingsibling elementstobedefinedrelativetoeachother.inmobileapplications thisnichehasbeenfilledby declarativeconstraintsystems suchas apple sautolayout andandroid s constraintlayout powerful tools for implementing dynamic layouts.
the key idea of declarative constraint systems is to express local relations between views such as adjacent to or center aligned as constraints and letthelayoutenginesolvetheseconstraintsatruntimetofigure out where to place each gui element given particular root view dimensions.forexample fig.1ashowsascreenshotofaslightly simplifiedversionoftheieeexplorewebsite whichincludes a featured authors panel displaying profiles of three authors.
the desired horizontal layout for this panel can be expressed with constraintsstatingthatthemiddleprofileiscenteredinthepage and the margins on either side of each profile are fixed.
at run time as the user resizes the page the layout responds according to the constraints see fig.
1b the width of the profiles changes preservingcentering andmargins.
while constraint based layouts have been greatly successful in the mobile domain they are not as prevalent for web design.
a potential reason is that a webpage has many more moving parts than a mobile application and the relations between elementsare far more complex making constraintsharder to author.
layoutsynthesis.
apromisingapproachtoeasingthecreationof flexibleconstraint basedlayoutsisto synthesize themautomatically from examples.
for instance a layout synthesizer might take as 651this work is licensed under a creative commons attribution international .
license.
esec fse august athens greece dylan lukes john sarracino coracoleman hilapeleg sorin lerner andnadia polikarpova a layout example1 1200x870 b layout example2 1600x870 figure1 snapshotsoftheieeexplorewebsitelayoutatdifferentpage dimensions.
input the two static snapshots in fig.
and infer a system of constraintsthat matchestheexamples placesallviewjustlike intheinputsnapshotsgiventheircorrespondingdimensions and generalizes beyond the examples produces some reasonable placementfor otherdimensions.
layoutsynthesis enables various newwaysofauthoringdynamiclayouts forexample adesigner maycreateseveralmock upsinadirect manipulationeditorand then automatically convert them into a general constraint based layout alternatively a user can emulate the look of an existing website by scrapinglayoutsnapshotsdirectlyfromthebrowser s rendering ofthe html.
challenges.
in the mobile domain the state of the art in layout synthesis is inferui a tool for generating autolayout constraintsforandroidapplications.atahighlevel inferuiworks byencodingtheproblemasansmtqueryfollowingthegeneral approachofsymbolicprogramsynthesis .extendinglayout synthesis beyond mobile apps most notably to the web domain poses two major challenges scalability web layouts typically have at least an order of magnitude more views than android layouts do the pure smt based approach scales poorly with the number of views in the layout.
noise in a realistic setting both scrapedanduser designedexamplesmightcontainnoise thatis theinput snapshots satisfy the desired constraints only approximately the pure smt basedapproach cannothandle such noisyinputs.
our solution.
in this work we develop mockdown a new layout synthesizer that accepts layout examples e.g.
from a direct manipulation editor or a scraping tool and finds the constraints needed.
these can then be passed on to a web constraint based layoutengine i.e.
thewebequivalentofautolayoutequivalent or be solved in javascript code to set the sizes and positions of views upon resize.
mockdown tackles the two challenges outlined aboveandisabletosynthesizecomplexlayoutsfromrealisticnoisy inputs.
in contrast to the the monolithic smt encoding of prior work the synthesis process in mockdown is split into two phases local inference which considers each constraint in the search space inisolation and globalinference whichconsiderssystemsofconstraintsasawhole.thegoaloflocalinferenceistosuggestasetof candidateconstraints whichmatchtheprovidedexamples butdo not necessarily generalize to unseen dimensions the goal of global inference is to pick a subset of the candidates that generalizes.
for example given just the one example in fig.
1a mockdown s local inference phase would suggest that all author profiles have a fixed widthof340pixels andthattheirouterandinnermarginsarefixed at and pixels respectively .
while these constraints are true forthisexample theycannotallcontinuetoholdifweresizethe page.mockdown s global inference uses a maxsmt solver to pickamaximalsubsetoftheseconstraintsthatis satisfiable fora wide range of page dimensions in this case the global inference must get rid of either the fixed width constraints or one of the margin constraints.
handling noise via bayesian local inference.
mockdown s two phasearchitecturehelpsitaddressthetwomajorchallenges outlinedabove.todealwithnoise thelocalphaseemploys bayesian inference togenerateconstraintcandidatesthat ontheonehand arelikelytogeneratethedata andontheotherhand aresimpleaccording to a domain specific prior.
crucially the smt based global phasenever getsexposedto noisydata.
scalingviahierarchicalglobalinference.
withmockdown s two phase approach the local phase rapidly falsifies unlikely constraints thereby pruning the search space for the computationally intensiveglobalphase.ourexperimentsshow however thatthis pruning is not sufficient to make the global phase scale to complex web layouts.
to further improve performance we leverage the observation that real world layouts are hierarchical the views are arranged in a tree and the layout of the upper layers of the hierarchyisindependentfromthelowerlayers.forexample fortheieee website we first infer the layout of the three author profiles and then independently infer the layout of their contents image name follow... button .
this hierarchical global inference significantly improvesscalabilityforreal worldlayouts wherethenumberof sibling viewsistypicallysmall.
contributions.
in summary thispapermakesthefollowing contributions atwo phase layout synthesis algorithm where a local phase rapidly generates the set of likely candidate constraints that satisfytheexamples anda global phaseselectsa generalizablesubsetoftheseconstraints sec.
.
noise tolerantlocal inference viabayesian learning sec.
.
652synthesisof weblayoutsfrom examples esec fse august athens greece hierarchicalglobalinference whichleveragesthestructure ofreal world layoutsto achieve scalability sec.
.
an implementation of the two phase synthesis algorithm in a tool called mockdown which has been evaluated on real world android and web layouts sec.
.mockdown candiscovertheconstraintsofrealisticlayoutswithasmuch as an order ofmagnitude more elements as previous tools.
motivating example considerthetaskofdesigningadynamiclayoutfortheieeexplore website introduced in fig.
.
in this section we explain how mockdowncaninferaconstraint basedlayoutforthiswebsiteusingtwo examples withthefocusonlayingouttheauthorprofileswithin the featured authors pane .
the inference process is depicted in fig.
to whichwe refer throughout the section.
.
the mockdown interface mockdown takes as input a set of examples i.e.static snapshots of the layout at fixed page dimensions.
concretely every input exampleisajsonfilethatencodesthehierarchyofviewsandtheir absolute positions within the page.
for example fig.
2a shows an excerpt from the mockdown inputs for the two snapshots from fig.
focused on the featured authors pane.
across different examples the set of views and their hierarchy is assumed to be the same here the author profile views turingandhopperare children of theauthorspane while their positions specified via the rect attribute differ.
giventhesetwoexamples mockdown infersasetofconstraints shownin fig.2f.theseconstraintsrepresentlinearrelationships betweenanchorsoftheviews whereananchoriseitheranedge like hopper.left oradimensionderivedfromtheedges like hopper.width orhopper.center x.constraintsofthisformserveasinputtoa constraint layout engine which given a new desired page size for example1300 willgenerateaconcreteplacementof all the viewsthatsatisfiestheconstraints asshownin fig.2gandfig.2h.
inputs to mockdown might comefrom a variety of front ends.
perhapsmostobviously adesignermightuseadirect manipulation tool to manually place the views and specify their hierarchy.
alternatively if a userwould like toreplicate the look of an existing website theycan scrapethisinformationfromthiswebsite shtml renderedinthebrowser infact forevaluationpurposeswehave implementedsuchascrapingfront endfor mockdown .witheitherfront end wecanenvisionaninteractivedesignprocesswhere theuserstartswithasingleexampleandtheniterativelyaddsmore examplesifuponvisualinspectionatanewpagedimensionthey are dissatisfiedwiththe generateddynamic layout.
likewise theoutputsof mockdown mightbeconsumedbya variety of layout engines including the popular engines autolayout andconstraintlayout for the mobile domain and grid style sheets for the web domain.
because the support for constraint basedlayoutinwebbrowsersisnot yet widespread for evaluation purposes we have implemented a simple layout engine that can be embedded into the webpage as javascript and is based onthe kiwi constraintsolver1.
from the json examples to constraints which is commonforallfront endsandconstrainedlayoutengines.inthe rest of this section we detail the two phases of the constraint inference process localandglobalinference.
.
localinference the goal of local inference is to generate a set of candidate constraintsmatching the provided examples.
an excerpt from the outputoflocalinferenceisshownin fig.2d.thistaskcanbesolved efficientlyfollowingtheinvariantinferenceapproachpioneeredby daikon .this approachfirstinstantiatesconstrainttemplates usingvariablesinscopetoproduce constraintsketches andthenfills intheparametersofeachsketch orfalsifiesitaltogether basedon thevariablevaluesobservedintheexamples.
mockdown slocal inference is inspired by this approach but it uses novel domainspecifictechniquesbothfortemplateinstantiationandforparameter inference which enable mockdown to prune the space of candidate constraintsandhandle noise.
visibility guided template instantiation.
althoughouralgorithm is able to infer a variety of constraints including offsets alignments size ratios and constant sizes all of these constraints are in factinstances ofsingletemplate y a x b where x yare anchors and a bare rational constants.
mockdown instantiates this template with concrete anchors from the input examples to generate a set ofconstraint sketches i.e.
constraints where one or bothofaandbareleftasparameters asshownin fig.2c.similarly totype basedtemplateinstantiationindaikon mockdown only generates well formed sketches following domain specific rules thatreflectconstraintforms usedinreal worldlayouts.forexample we generate an offset sketch hopper.left turing.right b butwedo not generatesketches hopper.left a turing.right or hopper.left turing.width b becauseedgeratiosandedge width relations are consideredill formed.
evenaftereliminatingill formedsketches thenumberofsketches generatedforrealisticinputscanbeverylarge.tofurtherprunethe spaceofsketchesweobservethatreal worldlayoutsplaceviews withrespecttotheirimmediateparentsandneighbors.forexample infig.
2we do not want to relate turing.right tobovik.left becausethesetwoviewsarenotimmediateneighbors.toformalize this intuition mockdown builds avisibility graph at each level of theviewhierarchy andusesittogenerateconstraintsonlybetween visibleedgesofparent childorsibling siblingviewpairs twoedges are considered visible if it is possible to draw a straight uninterrupted line between them .
the visibility graph for our example is shownin fig.2b.visibility basedpruningreducesthenumberof sketches generatedfor the ieee example from to .
bayesianparameterinference.
foreachgeneratedsketch mockdownnextlearnsitsparameters a b suchthattheresultingconstraint is satisfied for each input example.
the major challenge for parameterinferenceis noiseintheinputdata.
forexample as shown in fig.
2a the anchor turing.left has values .5px and .15px in the two examples.
the intended margin for this view isactually60px however mostusecasesforlayoutsynthesisinevitably introduce some amount of noise in the examples either duetouserinputorduetonumericalerrorduringrenderingand 653esec fse august athens greece dylan lukes john sarracino coracoleman hilapeleg sorin lerner andnadia polikarpova figure anoverview oftheconstraintinferenceprocess in mockdown .
scraping recallthatallnumbersinjavascriptarerepresentedas floats .atraditional daikon likeapproachwouldinstantiatethe sketchturing.left authors.left bwithb .5giventhefirst example andthenwould falsifythissketchgivenbothexamples erroneouslyrejecting this desirable offsetconstraint.
instead mockdown sbayesianparameterinference algorithm turnseachsketchintoasetofcandidateconstraintsthatmatchthe dataapproximately .
to this end mockdown performs constrained linearregression andthensuggestscandidateparameters drawn fromadomain specificpriordistribution thatfallwithinaconfidenceintervalaboutthelinearfit.inourexample eventhoughthe valueb .5fitsthedataperfectlyintheone examplecase our prioronoffsetsconstrainsthemtobeintegers andhenceparameter inference produces two candidate values b andb seefig.
2d .mockdown also produces a confidence score for eachcandidatebasedonabayesianlikelihoodmodel inthiscaseboth candidates have the score of .
since our offset prior has no preferenceamongdifferentintegersandbothoffsetsfitthedataequally well.afteraddingthesecondexample however thevalue b receives ahigher score because nowitfitsthe data muchbetter.
.
globalinference layout synthesis must produce constraints that generalize to unseenpagesizes withinacertainrange .inourexample theuser expectstheconstraintsproducedby mockdown tohaveasolution i.e.
to generate a placement for all views on the page when the page width ranges between 1280px and 1680px.
candidate constraints produced by local inference fig.
2d do not necessarily satisfythiscriterionfor tworeasons.first a subsetofconstraints might be approximately satisfied by all provided examples but 654synthesisof weblayoutsfrom examples esec fse august athens greece beunsatisfiable on unseen sizes.
this happens most often when constraints are inferred from one example in fig.
2d given one example weinferboththefixedwidthconstraintsforprofiles such ashopper.width and the fixed margin constraints between them these constraints together are unsatisfiable for any width except 1200px.
second due to noise mockdown sometimes infers incompatibleconstraintcandidatesfromthesamesketch forexample the two offset constraints for turing.left with different values ofbtogetherare unsatisfiable.
the goal of global inference to select an optimal subset of the candidateconstraintsthatissatisfiableonarangeofsizesofinterest.
we consider a subset optimal if it maximizes the total confidence scoreoftheconstraintset.intuitively wepreferlargerconstraint sets to minimize the ambiguity in view placement and among incompatibleconstraintswepreferthosewithhigherconfidence score sincetheyaremorelikelytohavegeneratedthedata.tofind theoptimalsubset mockdown usesamaxsmtsolver toselect the maximally satisfiable set of constraints on a random sample of input dimensions from a user specified range.
fig.
2e shows that querying themaxsmt solver with the candidates constraints inferredfromoneexampleonfiveunseensizes including1300x870 leadstoeliminatingconstraintsiiandv whichfixtheoutermargin.
this produces a layout that generalizes to a range of sizes albeit not in the way the user intended.
with two examples as shown in fig.2f thefixedwidthconstraintihasbeenrejectedbythelocal phase hence the only unsatisfiable subset of candidates is the two fixed margin constraints ii and v global inference picks constraint vsince ithas ahigher confidence score.
hierarchical decomposition.
for layouts with many views the maxsmtqueries canbecomputationallyintractable globalinference as described so far takes over min for the simplified ieee layout and times out after min on most real world websites inour experiments.to addressthischallenge weonceagain take advantageoflayout specificintuition incompatibleconstraintstypically appear within the same level of the view hierarchy.
based on thisintuition mockdown shierarchicalglobalinference performs constraintselection independentlyfor eachlevelof thehierarchy.
forexample in fig.2ealltheconflictingconstraintsarebetween authorsanditsimmediatechildren turing hopper andbovik hence there is no need to also consider the constraints between turing anditschildren photo name etc inthesamemaxsmtquery.in this example hierarchical inference reduces the solving time from 130secs to secs.
local inference the local inference phase of mockdown takes as input a view hierarchy and a set of input examples and produces a set of candidate constraints .
aswe explained informally in sec.
.
this phase consistsofthreesteps detectingvisibilitybetweenviews generating a set of constraint sketches based on the view hierarchy and visibility information and filling the sketches with concrete numericparametersbasedoninputexamples.sincethefirsttwo steps are relatively straightforward in this section we focus on the thirdstep noise tolerant parameterinference.
parameterinferencestartsfromasetofsketches s s1 ... sn andasetofexamples e e1 ... em .hereeachsketch sisoftheformy a x b wherex y xareanchorsanda b p are unknown parameters to be instantiated or if the parameter does not make sense for this pair of anchors each example e x q mapsanchorstoarationalvalues.theoutputofparameterinferenceisasetofcandidateconstraints c c1 ... ck whereeach c isoftheform y a x b a b q suchthat cboth instantiates asketch y a x bfroms and approximatelymatchesthe examplese i.e.
e e.e a e b.weformalizethemeaning ofthis approximate matchbelowusing abayesian model.
example.
asarunningexamplefortherestofthissection consider a parameter inference problemwith a singlesketch child.width a parent.width2and two examples e e1 e2 mapping the values of parent.width child.width to and respectively.assumethatthe trueintendedvalueof ais1 you canseethattheexamplesare noisyonaccountofbeingroundedto the nearestwholepixel.
naiveparameterinference.
thesimplestapproachtoparameter inference is daikon style invariant detection .
that is for each sketch initialize a candidate constraint from the first example andtheniteratethroughtheremainingexamples discardingthe candidate if a new example does not match.
this simple approach however failsinthepresenceofnoise in ourrunningexample it would instantiate a .
usinge1 and then rejectthis constraint upon inspecting e2 because .
nequal67 this problem arises even with precise rational arithmetic and is exacerbated by themorecommonfloating pointarithmetic .totacklethisissue we develop anoise tolerant parameterinference algorithm.
bayesian model.
in thepresence of noise wecannot require the constraintscto match the dataeexactly.
instead we need to find parameter values that best explain the data.
the simplest way to formalizethisintuitionisasa linearregression problem i.e.minimizing the mean square error between the line y a x band the examplesine.althoughlinearregressioncanbeperformedefficiently using standard techniques it rarely yields desirable results inourdomain becauseitreturnsarbitraryreal inpractice floating point numbers for aandb whereas we want to bias the inference towardssimplerationalparameters.considerourrunningexample withaslightperturbationofinputvalues linearregressionmight returna .
which is very unlikely to be what the designer intended because the constant is too complex .
even if we round this number to the closest rational with a denominator d wewouldstillgeta complex result a 99insteadofamuch simpler and therefore preferable result a which fits the dataonlyslightlyworse.wecanformalizethistrade offbetween simplicity andfitusing abayesian model.
in this formulation our goal is to maximize the posterior probabilityp c e ofaconstraintgivendata whichbythebayes law isproportionaltothepriorprobability p c oftheconstraintand its fitto data p e c p c e p c p e c this problem is known as bayesian linear regression .
here fit to dataiseasytocomputeusingthemeansquareerrorbetweenthe constraintandthedata p e c exp mse c e thechallenge 2notethatb 0isfixedinthissketch because mockdown ssketchgenerationphase only considers ratio constraintsbetween widths.
655esec fse august athens greece dylan lukes john sarracino coracoleman hilapeleg sorin lerner andnadia polikarpova istodefinetheprior p c suchthatitgivespreferencetosimpler parameters e.g.prefers 3over inour running example.
simplicityprior.
we formalizeourintuitivenotionof complexity forarationalnumber qasitsstern brocotdepth orsb depth q .the sb depthofqisitsdepthinthe stern brocottree whichcan beseenasagrammarforrepresentingallrationalnumbersassequences of left right steps e.g.
l ll lr and so on.hence sb depthmeasuresthesizeofa programrepresentation of a rational and approximates its complexity similarly to traditionalsize basedcomplexitymetricsinprogramsynthesis.inparticular in our example sb depth whilesb depth andhence the latter isconsideredmuchmore complex.
conveniently sb depth q is easy to compute it is equal to the sum of the continued fraction representation of q .
we can therebyavoidcomputingortraversingthestern brocottree and insteadmerelyprecomputethesetofallrationalswithdenominator lessthansome d ourimplementationuses d .thissequence isknownas a fareysequence oforderd.
we define the overall prior p y a x b pm a pa b where the prior pmfor multiplicative parameters is defined as a minimum description length prior using sb depthas the description length.
the prior pafor additive parameters is simpler itis uniformoverallintegervaluesandzeroonnon integervalues.
noise tolerantparameterinference.
given our complex prior thebayesianlinearregressionproblem cannotbesolvedanalytically.weproposeanalgorithmtosolvethisproblemefficientlybut approximately based ontwo domain specific insights.
first there is a unique model c with parameters a b that maximizes the datafitp e c whichcanbefoundefficientlyusingtraditional linear regression since the posterior is proportional to the data fit we can search for its maximum in the vicinity of c .
second given our prior p c there are only finitely many parameters a b withanon zeroprobabilityinanyboundedbox because amust bearationalwithmaximumdenominator d 100andbmustbe aninteger .basedontheseobservations ouralgorithminfersthe approximately optimal model cby first computing c based only on the data fit and then enumerating and scoring all pairs a b withnon zeroprior that are sufficiently close to a b .
ouralgorithmisdepictedin fig.
.line2performsleast squares linear regression which is constrained by the sketch e.g.b inourrunningexample butignorestheprior.regressionyields threeoutputs themodel c i.e.apairofparameters a b the meansquareerror msebetweeneandc andaconfidenceinterval conf int.
themseis used to determine whether or not to reject the sketch onlines3 ifitislarge indicatingthatourexamplesdonot appear to fit a line we reject thesketch.
in our example mse .
and the sketch is accepted however with the addition of a third datapointthatdoesnotcontinuetheline e.g.parent.width andchild.width msewouldrise to and the sketchwould therefore be rejected.
lines 6 9 iterate over the relevant region of candidate parameters score them according to the posterior and store them in scored params.wecomputetheregiontoiterateoverastheintersectionofconf intandparam space whichrepresentsparameterswith non zeroprior aswearguedabove thisintersectionisalwaysfinite.
in our running example we obtain a conf intof procedure inferparameters s e c mse conf int constrained linreg s e ifmse cutoffthen return scored params forc conf int param space s do score p c p e c add c score toscored params.
returnscored params figure noise tolerant parameterinferencealgorithm.
whichyieldsasetofcandidatevaluesfortheparameter a including andthe desired1 .
globalinference thegoalof mockdown sglobalphaseistopickasubset ofcandidate constraints that generalizes to unseen dimensions.
more formally this phase takes as input a set of candidate constraints cand a score map score c both produced by the local inference as well as a set dims w1 h1 ... wk hk of generalization dimensions where each dimension wj hj q2is a pairofwidthandheightoftherootview.itcomputesa maximal satisfiable subset ofc i.e.asetc csuch that c issatisfiable onalldimensions dims i.e.
wj hj dims there exists a substitution j x qfor all anchors in c suchthat j wj j hjand c c .
j c holds.
anysatisfiablesubset c hasatmostthesamescoreas c summationtext.
score c c summationtext.
score c c .
.
selecting constraintswith maxsmt to select the maximal satisfiable subset of c mockdown relies on amaxsmt solver .forourpurposes amaxsmt queryconsists of quantifier free formula a set of boolean control variables bi and a map weightfrombito numeric weights.
a maxsat solver returns unsatif is unsatisfiable and otherwise returns a model mof which maximizes summationtext.
weight bi m true i.e.the totalweightofcontrolvariables setto true3.
we encode the problem of finding c as a maxsmt query.
to this end we introduce the following variables for each constraint ci c we introduce a boolean control variable biwithweight score birepresents whethercishould be includedin c foreachpairofanchor x xanddimension wj hj dims weintroducearationalvariable xjtorepresenttheplacement ofanchor xunderthis dimension.
next we construct the formula as a conjunction of the following sub formulas foreachdimension j root.width j wj root.height j hj foreachconstraint ianddimension j bi cj i wherecj iis the constraint ciwitheachanchor xreplacedby xj 3alternatively amaxsmtsolvercanalsobeusedtooptimizeagivenobjectivefunction subject to alogical formula weuse thisfunctionality in the next section.
656synthesisof weblayoutsfrom examples esec fse august athens greece procedure synthhier c dims score worklist c whileworklist nequal do focus dims f worklist.pop cf restrict focus c c f select cf focus dimsf score c c c f forchild children focus do dimsc calc dims focus dimsf child c worklist.push child dimsc returnc figure mockdown globalgeneralizationalgorithm finally we add domain specific facts about anchors such as xj andx.widthj x.rightj x.leftj.
given this query the solver attempts to find a placement for all anchorsundereachdimensionin dimsthatsatisfiesconstraintsin c if it cannot satisfy all the constraints it is free to set some bi tofalse renderingallformulasoftheform bi cj ivacuous and effectively disabling the constraint ci.
when the solver returns a modelm we compute the result c as the set of all constraints whose corresponding control variables are set to true c ci m true .
this set is satisfiable because by construction of weknowthat ci c m cj i holds andhencewecanextract the substitution jfrom the modelmby taking j m for every anchor x. this set is also maximal because the solver guarantees to maximize the total weight of control variables set to true whichisequal to the totalscore ofchosenconstraints.
.
hierarchical decomposition whilethemaxsmtencodingof sec.
.1issimpleandworkswell forsmalllayouts itisintractableonrealisticweblayouts sincethe query becomestoolargetosolveefficiently.toimproveperformance weleverageacommonlayoutdesignprincipleinwhichthe layout of aview is determined onlyby the layout of its immediate parent and siblings.
based on this principle we can decompose the global maxsmt query into smaller queries for individual levels of the view hierarchy.
more specifically instead of solving the global query which specifies the layout of all anchors x our algorithm iteratively solves sub queries xfor each anchor x x where xonly specifies the layout of the direct children of x and so is generallymuchsmaller andthussignificantlyeasiertosolve than the global .we present this algorithm in fig.
.
thealgorithmmaintainsaworklistofsub problems whereeach subproblem is represented as a pair focus dimsf of afocus view anditsgeneralizationdimensions.theworklistisinitializedwith the root view rootand input dimensions dims.
in each iteration the algorithmpicks a sub problem focus dimsf fromtheworklist and computes the set c f which is the maximal subset of layout constraintsforthe directchildren offocussatisfiableacross dimsf.to thisend restrict focus c picksoutthesetcf cofcandidate constraintsthatmentiontheanchorsofthedirectchildrenof focus andselect cf focus dimsf score invokesthemaxsmtconstraint selectionprocedurefrom sec.
.
restrictedtothecandidates cfand using focusas the root view.
the algorithm then adds the selected constraints c fto the output.
finally lines 9 11 add a new sub problem to the worklist for eachdirectchildof focus.
in this last step the challenge is to pick the right generalization dimensions dimscforthesub problemrootedat child.iftherangeof dimensions is too narrow the algorithm might return a set c that isnotactuallysatisfiable iftherangeistoobroad thealgorithm mightreturnasetthatisnotmaximal.toaddressthischallenge we again use a maxsmt solver to calculate the lower and upper boundonthedimensionsof child giventhecurrentlychosenlayout constraintsc .
for example to calculate the upper bound the algorithmcreatesamaxsmtquerywiththemaximizationobjective child.width child.height subject toc andtheupperbound on the dimensions of the parent focus.
the dimensions dimscare then chosenatequalintervals between the lowerandthe upperbound.
we encode this query inthe function calc dimsinline10.
evaluation mockdown is implemented in python and typescript.weusez3version4.
.
asamaxsmtsolveranda wrapper4aroundthekiwi forkofcassowary injavascript as the constraint layout engine.
our implementation5and our benchmarksandanalysisscripts6are open andpubliclyavailable.
researchquestions.
inourevaluation weseekanswersforthe following researchquestions.
rq1 doesmockdown enablelayoutsynthesisforabroadvariety ofwebapplications?
rq2 is noise tolerant inference necessary for layout inference?
rq3 does hierarchical decomposition help mockdown to scale withlayoutsize?
rq4 how general is mockdown i.e.is it applicable to domains beyondthe web?
.
benchmarksandmetrics benchmarks.
weevaluate mockdown onacombinationofbenchmarks from previous tools in the literature and our own curated benchmark suite.
one challenge in evaluating a tool like mockdownis assessing its behavior on websites of realistic scale and structure.wecollectourrealisticbenchmarksfromexistingwebpagesusingawebscraperimplementedinjavascript7 whichreturnsajsonintheformatshownin fig.
.welikewisetranslate benchmarks from previous tools into this json format.
for rq1 rq2 andrq3 weevaluate mockdown on asetofreal fullwebpages macrobenchmarks and microbenchmarks smallbenchmarks that test specific aspects of layout synthesis.
for rq4 we additionally use a suite of android layouts from the literature .
macrobenchmarks.
wecollectedasetof ninereal worldwebsites listedintab.
usingourscraper.foreachwebpage weidentifieda rangeofpagesizesinwhichthelayoutbehaveslinearly andscraped examples within this range.
the dimensions for both train and test exampleswereselectedrandomlywithintherange.ourbenchmark websitescoveravarietyofapplications authorisapersonalpage 657esec fse august athens greece dylan lukes john sarracino coracoleman hilapeleg sorin lerner andnadia polikarpova ofone oftheauthors the three fwt benchmarksare samples fromthefreewebtemplatescollection ddgistheduckduckgo searchengine hnisthehackernewsnewssite aceisthe acecodeeditor conference isasoftware engineeringconference website ieeexplore is thefullieee explore website which we present in simplified form in sec.
.
the number of views in these websites range from fwt running to over hn which isoveranorderof magnitudelarger thanlayoutshandledbyprior work .eachwebsitewasscrapedat20differentsizeswith10 designatedas training examplesand10 as test examples.
microbenchmarks.
we assembled two groups of microbenchmarks synthetic repetitive programmaticallygeneratedlayouts andextracted sub layoutsofthemacrobenchmarks .theextracted microbenchmarks were systematically constructed by taking each macrobenchmark a real website and extracting all its substantialsublayouts.forexample fortheieeexplorewebsite the microbenchmarks extracted are the navigation top bar search bar collection of authors featured news featured articles upcoming conferences and website footer.in order totestrq3 hierarchical scaling weselectedasubsetofextractedmicrobenchmarks named hierarchical inwhichthetop levelelementisaone dimensional grid andthe subelements rangeincomplexityfrom1to 23views with a nesting depth of to levels.
an array of elements is a commonlayoutdesignpattern whichwaspresentinseveralformsin manyofourbenchmarks.forexample fortheieeexplorewebsite boththecollectionofauthorsandtheupcomingconferencesare arrays.mockdown scalesbyhierarchicaldecompositionandarray elements are siblings in the layout hierarchy so the hierarchical benchmarks demonstrate the impact of hierarchical decomposition onthe overallperformance ofthe algorithm.
thenumbersandsizesofbenchmarksineachgrouparelisted intab.
each microbenchmark has roughly analogous complexity to the evaluation ofprior work .
numeric noise.
numeric noise can come from several different sources suchasapproximatingarationalratiousingfinite precision numbers such as floating point quirks in the device specific renderingengine andnumericalerrorsinfloatingpointarithmetic.as demonstratedinourevaluation sec.
.
real worldlayoutshave numeric noiseandcause noise intolerantsynthesis to fail.
metrics.
weevaluatethequalityofinferredlayoutsbyusingthe synthesized constraints to predict the placement of views at the pagesizesdesignatedfortesting anddirectlycomparingthesepixel dimensions to the original ground truth view which is scraped from either a browser or an android device depending on the dataset .
we use twodifferentmetrics to quantify layoutquality rmsd the root mean squared deviation of view corners from the original placement to our computed placement averaged overviewsinthetestset.rmsdcapturesthepixeldifferencebetweenapredictedrenderingandactualrenderingwithmoreweight towardsoutliers forexample arenderingwithrmsdunder1is visuallyindistinguishablefromtheoriginal whilearenderingwith rmsdover 5wouldlook differentto an averageviewer.
accuracy percentageofviewsplacedwithinapixelofthe originalview.thoughusedinpriorwork itcanbemisleading as a layout with low accuracy but low rmsd can be visually more similarto the original than one with highaccuracy but highrmsd.incontrastrmsd doescapturelook and feelequivalence soaccuracyismainly useful for comparison when rmsdislow.
.
rq1 applicabilitytorealisticapplications for each macro and microbenchmark we run mockdown on the training examples to synthesize constraints.
we then pass these constraints to the kiwi layout engine along with the page sizes fromthetestexamples whichgivesusacomputedplacementfor each of the test examples.
we compare these computed placements to the original scraped placements at the test example sizes.
for the microbenchmarks we set a synthesis timeout of minutes and for the macrobenchmarks we set a timeout of minutes .
since synthesistimesmightvaryfromruntorun weraneachexperiment threetimes andaveragedrunning times.
for each benchmark we measure the size of the benchmark numberofviews aswell asthefollowing metrics avgrmsd becausermsdissensitivetopagedimension weaverageitover testing dimensions accuracy as defined in the previous subsection synthtime thetime mockdown takestosynthesizethe layout the numberofconstraints inmockdown soutput and resizetime thetimeforkiwitocalculateanewplacementat page resize time averagedover the test set.this metricneedsto be lowbecauselayoutsaremeant tobe interactive andthelayout wouldbe recomputedwhen the userresizedtheir window.
we performed this experiment twice once with training examples and once with training examples in order to measure theeffectofthenumberoftrainingexampleson mockdown .both experiments were evaluatedon10 testingexamples.
results.
the results for the macrobenchmarks are given in tab.
andfor microbenchmarksin tab.
.overall mockdown successfully finds a layout for all microbenchmarks and for most macrobenchmarks onlytimingouton conference the3 example author and the example ace.
moreover independently of the number of training examples the synthesized layouts closely match the original applications with all rmsds below .
in addition the accuracy is also relatively high above for all benchmarks except hn.
notice however that for hn mockdown still closely replicates the visuallookoftheoriginallayout seethelowrmsd andindeed the two layouts are almost identical to a visual inspection.
it is not clear why the accuracy would be low for hnin particular but it couldbeduetoroundingerrorfromsolving6000constraints.we omitresizetime intheinterestofspace allresizetimesarebelow .0004seconds andallbut hnarebelow0.0001seconds indicating that synthesized layouts can be used in an interactive setting with dynamicresizing.tosumup weanswerrq1 intheaffirmative mockdown synthesizes layouts that closely match the application for manyrealistic webapplications.
.
rq2 noise tolerance to evaluate the utility of noise tolerant local inference and the impactofourinductivebiasesoferrorandsimplicity weperforman ablationstudycomparingthreedifferentlocalinferencealgorithms baseline thisisarigiddaikon styletemplateinstantiationalgorithmwhichinstantiatesinvariantsdirectly fromtheinput data as describedin sec.
.
658synthesisof weblayoutsfrom examples esec fse august athens greece table performanceof mockdown on macrobenchmarks.
benchmarknumber numberoftimeouts rms avg accuracynumberof synthesis ofviews examples constraints time s fwt running .
.
author .
ddg .
.
fwt space .
.
ace .
fwt main .
.
conference ieeexplore .
.
hn .
.
table2 averageperformanceof mockdown oneachgroup ofmicrobenchmarks.
groupnumber of number of number oftimeoutsrmsaccuracynumber of synthesis benchmarks views avg examples avg constraints time s synthetic .
.
extracted .
.
nt none this implements the noise tolerant template instantiation but does not output confidence scores that guide global inference.
nt all thisimplementsthefullnoise tolerantinferencealgorithm withconfidence scores basedonsimplicity anderror.
we ran each algorithm on the full microbenchmarks set and collected synthesistime accuracy and rmsderror as definedabove.ourexperimentalsetupissimilarto sec.
.
weuse 3and10trainingexamplesandsetasynthesistimeoutof3minutes.
weraneachbenchmarkthreetimes andourplotspresentalltrials ratherthanaggregating eachindividualbenchmark.
results.
fig.
5presents rmsd and accuracy and fig.
6presents synthesis times for theseexperiments.
thebaselinealgorithmisbrittleinthepresenceofnumericnoise and so cannot be used for synthesis of realistic web layouts.
as seeninfig.5a 24of the192 trials 64microbenchmarks at trials each for3trainingexampleshaveveryhighrmsderror above .
when given training examples fig.
5b baselinedoes even worse with30of192trialswithahaveveryhighrmsderror.this is because with more training samples a necessary constraint is morelikelytoberuledoutduetonoise leadingtosomeanchors beingcompletelyunconstrainedandthusrenderedveryfarfrom theirintendedposition.bothnoise tolerantvariants nt noneand nt all alleviatethebrittlenessandachievelowerror.while nt none is visually similar to the original layout it does not consider the qualityofcandidateconstraints andthislackofbiasintheselection of the layout invariants results in a lower accuracy than that of a 3trainingexamples b trainingexamples figure5 ablationstudyoferrorandaccuracyfordifferent noise toleranceapproaches.
a 3trainingexamples b trainingexamples figure ablation study of synthesis time for different noise toleranceapproaches.
baseline as seen in fig.
5aandfig.
5b.
the full noise tolerant inferencealgorithmusesinductivebiastopickinvariants which improves the quality of the selected invariants as demonstrated by the improvement inboth accuracyandrmsderrorin nt all.
withregardstosynthesistime fig.
noise tolerancehasan overhead and nt noneandnt allareslowerthanthenativebaselinealgorithm.thisisbecausethebaselinealgorithminfersstrictly fewer candidate invariants.
the difference between nt noneand nt allisnegligible whichindicatesthebiasesdonotimpedeperformance.withmoretrainingexamples thedifferencebetweenthe baseline performance and the noise tolerant performance narrows as additional examples focus the inductive bias of noise tolerant inference resultinginfewer candidate invariants.
tosumup weanswerrq2 intheaffirmative noise tolerant inference is necessary for layout inference as it allows mockdown to always find precise constraints and achieve a low error.
this does come withaperformance overhead but not alarge one.
.
rq3 scaling to testhow mockdown scaleswiththesizeofthelayout we use thehierarchical microbenchmarks which have a one dimensional gridlayout.foreachofthesegridmicrobenchmarks wegenerate variantsofdifferentsizesbytruncatingthegridafter nelements withnranging from one to ten or the original size whichever 659esec fse august athens greece dylan lukes john sarracino coracoleman hilapeleg sorin lerner andnadia polikarpova is smaller .
we then run two variants of mockdown the originalversion hierwithhierarchicalgloballearning asdescribedin sec.
4and a flat version flatthat does not perform hierarchical decomposition and instead performs global inference with a singlemaxsmtquery.foreachgridbenchmarkandtoolvariant we measure synthesis time on training examples.
we ran each experiment five times and average the results for each benchmark.
results.
we present the results in fig.
.
overall we find that hieroutperforms flat sometimes drastically.
on almost half of ourbenchmarks 5of11 bothvariantsfinishquicklyandsothe synthesis time is comparable.
this is because these benchmarks arerelativelysimplesodecompositiondoesnotprovideabenefit.
on all of the remaining benchmarks hierperforms strictly better forallsizes scaling linearlyinthenumberofelementsinthearray and with the exception of hn posts ten decomposition results in tractable subproblems.
even in this case hieroutperforms flat which cannot make progress at all this is because each array itemis itselfcomplex anddeeplynested withanelementsizeand depthof23and6.moregenerally hierreducesthesynthesistask to the hardest subproblem.
by contrast flatattempts to solve a single global task and so becomes intractable from a certain size in benchmarks.
we therefore answer rq3 in the affirmative hierarchical deconstruction is crucial for synthesizing web layouts.
.
rq4 generality in this experiment we evaluate whether mockdown still performs well when input examples are not generated by our scraper and more generally are not from the web domain.
to this end we usethe benchmarksuite fromthelatest versionof thelayoutsynthesizerinferui .
the suite consists of android layouts andisasubsetofthepopularricodataset .foreachandroid application the dataset contains layout renderings at different dimensions.weevaluated mockdown usingtwooftheselayoutsasa trainingsampleandthethirdasatestsample.wemeasuredrmsd accuracy synthesistime andresizetime allasdefinedabove with asynthesis timeout of minutes and we ran the experiment 3times to collectaggregate data.
results.
we present rmsd and accuracy in fig.
.
overall mockdownperformswellonthesebenchmarks synthesizinganindistinguishable layout rmsd less than for of android apps and anaccuratelayoutfor 538of them .
of the remaining99 apps time out.
there are two potential causes for this.
first the structureofappsinthe inferuidatasetisflattened sohierarchical decompositionisnotapplicable.second the2trainingexamples cause local inference to produce many more candidate constraints.
we do not report a direct comparison between mockdown and inferuibecause the techniques are complementary.
inferuiis designed to synthesize layouts from a single example and relies on android specific biases to deal with the resulting ambiguity.
mockdown on the other hand is designed to be more domaingeneral and henceisunable toproduce good qualityresults from justoneexample.running mockdown onasingleexampleresulted insignificantly worse results thanthosereportedfor inferui.
nevertheless wefinditencouragingthatjustasingleadditional input example already allows mockdown to produce highly accurateresultswithoutrelyingonandroid specificdomainknowledge.tosumup weanswerrq4 inthe affirmative mockdown successfullysynthesizes layoutsforandroidapplicationsusinginput examples from an existing dataset.
.
threatsto validity themainthreattovalidityforourexperimentsistheirorigin.first some of our microbenchmarks are generated synthetically though wehavetriedtocounterthisbygeneratingrepresentationsofcommonlayoutidioms e.g.
acenterpanelwithfixedmargins .second our macrobenchmarks and by extension the extracted set of microbenchmarksarescrapedfromexistingwebsites.thenumeric noisethatexistsinscrapedlayouts e.g.
noiseduetorounding representsonlyonesourceofdatafor mockdown andmaynotmatch thetypeofnoisethatwillappearinlayoutsbuiltbyadesignerina direct manipulation tool.
in principle mockdown s noise tolerant local inference should be able to handle that kind of noise as well butweleave theempiricalevaluaitonofthisclaimtofuturework.
discussion unsupported layouts.
our results indicate that high errors coincide with longer synthesis times or timeouts.
this is often the caseinlayoutsthatrequireconstraintsthat mockdown doesnot support such as constraints for aspect ratios or constraints for rendering text.
the unsupported constraint would not be found inthelocalinferencephase leavingglobalinferencetopickfrom manypoorcandidates makingits work more time consuming.
additionalexamples.
unlike many works in example based synthesis mockdown speedsupwhengivenmoreexamples.this isabenefitofthedivisionoflaborbetweenlocalandglobalinference moreexamplesruleoutmoreconstraintsatthelocalphase resultinginfewer inputsto the globalphase.
the cost of noise.
mockdown s noise tolerance increases the numberofcandidateconstraintstobeconsideredbyglobalinference whichimpactsperformance.however webelievethemore accuratelayoutsareworththelongersynthesistimes.mostrealistic inputs whetherderivedbyscrapingordirectmanipulation contain noise makinghandling noisyinputscrucial.
success of decomposition.
hierarchical decomposition proved usefulinisolation makingcomponentslikegridstractable.however whensynthesizingfullwebpagesthisstillmaynotbeenough.
since hierarchical decomposition handles the relation between neighboringcomponents itisasefficientasitshardestsubtask i.e.
the viewwiththe mostdirectchildren .
related work inferui .the closest work to ours is inferui which synthesizesconstraint basedandroidlayoutsfromasingleexample.
in the original work inferuireduces synthesis to a single smt query that requires the layout to precisely match the example and satisfy a set of robustness properties on unseen sizes e.g.
views do not overlap views fit on screen .
to improveefficiency inferuiusesaprobabilisticmodellearnedfrom 660synthesisof weblayoutsfrom examples esec fse august athens greece a hierarchical b flat figure synthesis time in seconds of hierarchical and flat global generalization algorithms as a function of the number of elements inagrid based layout.
lowerisbetter.
figure mockdown s error and accuracy on android layouts.
programmer written layouts.
in the followup work the handcrafted robustness properties and the probabilistic model are replaced with a learned neural model thatstrengthens the synthesis specification withan additional predictedexample.
at a high level the difference between both inferuitechniques andmockdown is thatinferuiuses adomain specific bias either hand crafted or learned to synthesize simpleandroid layouts up to views from a singleinput while mockdown synthesizes domain general andcomplexlayouts up to hundreds of views frommultipleinputs.inferuihasnomechanismtohandle noise in the input examples though their layout dataset does contain noisyinputs .noisydatadoesnotimpact inferuiasmuchbecause whenlearningfromoneexample thesynthesizercaninstantiate templateswiththenoisydataandproducecandidateconstraints albeitwithslightlyincorrectcoefficients .incontrast withmultiple examples noisy data is problematic because the correct constraint template isrejectedoutrightas itcannotfitthe noisydata.
we consider mockdown complementary to inferui our approachismoregeneral atthecostofrequiringafewmoreexamples fromtheuser.aninterestingdirectionoffutureworkistocombine mockdown s noise tolerant hierarchical inference engine with inferui stechniques for incorporatingdomain specific bias.
visual layout synthesis.
other tools that assist users with creating guis either donot take the example basedapproach focus on aspects of gui other than the visual layout or generate static vector graphics level layouts from images or hand drawings .mockdown could complement the latter line of work by further generalizing the output of such tools intoaresizable constraint basedlayout.arelatedareaissynthesis of graphics programs from images which focuses on recognizing repetitive patterns in images and typically considers a small number of visual elements so scalability is less of a concern .constraintinference.
daikon haspioneeredthetemplatebasedconstraintinferencetechniquethatourlocalinferencebuilds upon mockdown enhancesthistechniquewithdomain specific optimizationssuchasvisibility guidedtemplateinstantiationand statisticalparameterinference.thereisarichbodyofworkondatadriven inference of inductive loop invariants .
althoughthesetechniquesalsoinferlinearrelationsfromdata the setting is very different invariant inference assumes abundance of data and ability togenerate counter examples so the challenge is to efficiently find constraints that precisely fit the data while generalization to unseen data isnot an issue.
program synthesis.
programsynthesisfromexampleshasbeen usedtoautomatetasksinmanydomains suchasdatawrangling and web scraping .mockdown s global inference technique is based on symbolic program synthesis whichusesaconstraintsolver tosearchthespaceofprograms.
maxsatand maxsmt solvershavebeenusedfor optimalprogram synthesis e.g.
in .
some program synthesis techniques are capable of handling noisy examples but most are geared towards detecting outliers a few completely wrong examples whereas mockdown needstobe tolerant againsta small amount of noise in each example.
the only work we are aware ofthathandlesnoisedistributedoveralargeportionofexamples is butthistechniqueisspecifictoversion spacealgebrasand isnot applicable to constraint basedlayoutsynthesis.