buildsheriff change aware test failure triage for continuous integration builds chen zhang school of computer science fudan university shanghai chinabihuan chen school of computer science fudan university shanghai china xin peng school of computer science fudan university shanghai chinawenyun zhao school of computer science fudan university shanghai china abstract testfailuresareoneofthemostcommonreasonsforbrokenbuildsin continuousintegration.itisexpensivetodiagnosealltestfailuresin abuild.astestfailuresareusuallycausedbyafewunderlyingfaults triagingtestfailureswithrespecttotheirunderlyingrootcausescan save test failure diagnosis cost.
existing failure triage methods are mostlydevelopedfortriagingcrashorbugreports andhencenotap plicableinthecontextoftestfailuretriageincontinuousintegration.inthispaper wefirstpresentalarge scaleempiricalstudyon163 brokenbuildscausedbytestfailurestocharacterizetestfailuresinrealworldjavaprojects.then motivatedbyourstudy weproposeanew change aware approach buildsheriff totriagetestfailuresineach continuousintegrationbuildsuchthattestfailureswiththesamerootcauseareputinthesamecluster.ourevaluationon200brokenbuildshas demonstrated that buildsheriff can significantly improve the state of the art methods on the triaging effectiveness.
ccs concepts software and its engineering software testing and debugging.
keywords test failures failure triage continuous integration acm reference format chen zhang bihuan chen xin peng and wenyun zhao.
.
buildsheriff change aware test failure triage for continuous integration builds.in 44thinternationalconferenceonsoftwareengineering icse may pittsburgh pa usa.
acm new york ny usa 13pages.
also with shanghai key laboratory of data science and shanghai collaborative innovation center of intelligent visual computing.
bihuan chen is the corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn ... .
introduction continuousintegration ci hasgainedwidespreaduseandcontinuedgrowth asithelpsdetectintegrationerrorsearlier enhancedeveloperproductivity andreducedevelopmentrisk .
each integration is verified by an automated build that includes dependencyinstallation codecompilation staticanalysis andtestcaseexecution.however cibuildsoftenbreak i.e.
fail anddevelopersneedtospendmucheffortintroubleshootingbrokenbuilds .as evidencedbyseveralrecentstudieswithopen sourceandindustrialprojects testfailuresareoneofthemostfrequent typesofcibuildfailures e.g.
testfailuresareresponsiblefor59.
of broken builds in open source java projects .
developers need tomanuallylocalizeandrepairtheunderlyingfaultsoftestfailures ineachbuild.however itisnon trivialfordeveloperstoanalyze testfailuresinabuildbecauseabuildisnotalwaystriggeredforevery commit anda build maychange multiple source codefiles.
in that sense it is usually time consuming and expensive to manually diagnose test failures in each build.
toreducetestfailurediagnosiscost anumberoftechniqueshave beenproposedfromdifferentperspectives.onelineofworktriesto design fault localization techniques to automatically localize faults thatcausetestfailures .anotherlineofworktries todevelopprogramrepairtechniquestoautomaticallyfixfaults .
orthogonaltothesetwotypesoftechniques testfailuretriagetech niquesaredesignedtoclustertestfailuresthatarecausedbythesamefaultintothesamecluster .inthisway testfailurediagnosis canberealizedbyonlyanalyzingonetestfailureineachclusterbut not all the test failures which can reduce manual diagnosis cost or boost automated fault localization and program repair techniques.
existingfailuretriagemethodsaremostlydesignedtotriagecrash orbugreports.sharingthesameproblemastestfailuresincibuilds multiplereportscanbefiledforthesamefault.thesemethodscanbegroupedintostacktrace based e.g.
profiling based e.g.
andtext basedmethods e.g.
dependingonwhatinformation i.e.
stacktraces executionprofiles and textual descriptions is used to measure failure similarity.
unfortunately stacktrace basedmethodsarenotapplicableinthe contextoftestfailuretriageincibecause theyarenotdesignedfortest failuresinci andarenotawareofthetestfailurecharacteristicsandpo tentiallyvaluableknowledgeinciforbettertriage.
first weshowinour study sec.
.
that73.
ofbrokenbuildswithtestfailuresarecaused ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa chen zhang bihuan chen xin peng and wenyun zhao byassertionfailures whichdonotreportanyinformativeexception stacktrace.asaresult stacktrace basedmethodscouldhaveapoorperformanceontriagingassertionfailures.second wealsoreportinourstudy sec.
.
thattestfailuresin78.
ofthe200randomlyselectedbrokenbuildsshareonerootcause.hence stacktrace basedmethodscouldtendtotriagetestfailuresintoonesingleclustersuchthattheycouldstillyieldanoverallgoodperformancealthoughtheyhaveapoorperformanceontriagingtestfailuresintomultipleclus ters.third codechangesincibuilds avaluableknowledgeincibutnotavailableincrashorbugreports usuallyhaveagreatimpactontestresults .thus stacktrace basedmethods simplyrelyingon stacktraceswithouttakingintoaccountcodechanges couldbelesseffective.profiling basedandtext basedmethodsarealsonotappli cabletotestfailuretriageincibecauseexecutionprofileswouldimpose too large overhead to be practically used in ci while textualdescriptions whichareoftenwrittenbyusersincrashorbugreports of test failures are not produced during automated ci builds.
inthispaper wefirstpresentalarge scaleempiricalstudy using 371brokenbuildscausedbytestfailuresfrom1 337githubjava projects tounderstandtestfailuresincibuilds.wecharacterizetheprevalenceoftwotypesoftestfailures i.e.
exceptionfailuresandas sertionfailures andmotivatethepotentialvalueandthedesignin sightsoftestfailuretriage.then weproposeanew change aware approach buildsheriff totriagetestfailuresforcibuildssothattestfailureswiththesamerootcauseareputtothesamecluster.thekeyideaof buildsheriffistoconsidercodechangesasimportanttriageknowledgeasrootcausesoftestfailuresareoftenintroducedbycodechanges .wedevelopapipelineofthreestrategiesbasedoncomplexityofcodechanges change awarestacktracesimilarity andex ceptionmessagesimilarityforexceptionfailuretriage andapipeline of two strategies based on complexity of code changes and changeawaretestcodesimilarityforassertionfailuretriage.tothebestofour knowledge thisisthefirstworktotriagetestfailuresingeneralci.
toevaluatetheeffectivenessandefficiencyof buildsheriff we compareditwithonenaivemethodandthreestate of the artmeth ods on200brokenbuildswithrespectto20metrics.our evaluation results have demonstrated that i buildsheriff can significantlyimprovethenaivemethodon13ofthe20metrics e.g.
by14 onthenumberofcorrectlytriagedbuilds and77 onthe numberofmissedrootcauses ii buildsheriffcansignificantly improvethebestofthestate of the artmethodson15ofthe20met rics e.g.
by45 onthenumberofcorrectlytriagedbuilds and28 on test failure inspection effort saving and slightly improve the best of thestate of the art methods on 4of the metrics and iii the average time overhead to triage a build is .
seconds.
in summary this paper makes the following contributions.
weconductedalarge scaleempiricalstudytocharacterizetestfailures in real world java projects and motivate test failure triage.
weproposedanewchange awareapproach buildsheriff totriage test failures in ci builds effectively and practically.
we conducted experiments on broken builds to demonstrate the effectiveness and efficiency of buildsheriff.
motivation inthissection wefirstpresentanempiricalstudyoftestfailures and then introduce motivating examples of test failures.
.
an empirical study of test failures dataset.
toconstructthedatasetforourempiricalstudyoftestfailures westartwiththedatasetproposedbyzhangetal.
which includesthecibuildhistoryof3 799javaprojectsongithub.tothebestofourknowledge itisthelargestavailabledatasetofcibuilds.
toeasetheextractionoftestfailureinformationfrombuildlogs we focusonprojectsthatusemavenastheautomatedbuildtool whichresultsin1 763projects.tofurtherensurethatciiscommonlyused weexcludetheprojectsthatonlyhavelessthan100builds whichrestrictsourselectionto1 739projectswithatotalof3 842builds.ofthesebuilds .
buildshaveabuildstateof erroredor failed whicharealsoknownas brokenbuilds.inparticular .
ofthesebrokenbuilds covering1 337projects arecausedby test failures which is lower than the .
as reported by beller et al.
using423javaprojects .thedifferencemaybeduetothedifferentscaleofstudies.still testfailureisanon negligiblefailure type of broken builds and affects many of the java projects.
noticethatatestisconsideredasfailedinciifitthrowsanexception i.e.
exceptionfailure orfailsanassertion i.e.
assertionfailure andthe buildlogfrommavenprojectsalsoprovidesasummaryofthenumber of tests that signals exception failures and assertion failures.
researchquestions.
using163 371brokenbuildswithtestfailures hereafter referred to as test failed builds from projects our study is designed to answer the following research questions.
rq1 howmanytest failedbuildsinaprojectexhibitthesymptom of exception and assertion failures during test execution?
rq2 howmanytestsinatest failedbuildsignalexceptionandassertion failures during test execution?
rq3 howmanyrootcausesaffectfailedtestsinatest failedbuild?
inrq1 wemeasureforeachprojecttheratiooftest failedbuildsthat exhibitthesymptomofexceptionandassertionfailuresduringtestex ecution andcomputetheratiodistributionacrossallprojects.ourre sultsfrom rq1aimtocharacterizetheprevalenceofbothexception andassertionfailures andmotivatetheneedforatriageapproachtosupportbothofthem.in rq2 wemeasureforeachtest failedbuild thenumberofalltestsandthenumberofteststhatsignalexceptionandassertionfailures andcomputetheirdistributionacrossalltest failedbuilds.in rq3 werandomlyselect100test failedbuildswith exception failures and test failed builds with assertion failures manuallytriagethefailedtestsvialocatingtheirrootcauses andre portthedistributionofthenumberofrootcauses.ourresultsfrom rq2andrq3aimtomotivatethepotentialvalueoftriagingtest failuresinci anddemonstratethespecificcharacteristicsoftest failures in ci to better design a triage approach.
test failedbuildanalysis rq1 .
overall .
ofthe test failed builds covering projects exhibit the symptomofexceptionfailures and119 .
covering1 246projects exhibitthesymptomofassertionfailures.indetail fig.
1ashowsthe distributionoftheratiooftest failedbuildsthathaveexceptionfail uresandassertionfailuresacrossallprojectsinviolinplot.thethreelinesineachplotrespectivelydenotetheupperquartile themedianandthelowerquartile.wecanseethatatleast24.
.
and85.
ofthetest failedbuildscontainexceptionfailuresin75 and25 oftheprojects whereasmorethan55.
.
and100 ofthetest failedbuildshaveassertionfailuresin75 and25 oftheprojects.
theseresultsindicatethatassertionfailuresareevenmorecommon authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
buildsheriff change aware test failure triage for continuous integration builds icse may pittsburgh pa usa a the ratio of test failed builds b the number of failed tests c the number of root causes figure distributions of the ratio of test failed builds the number of failed tests and the number of root causes thanexceptionfailurestocausetest failedbuilds.therefore testfailuretriageincishouldsupportbothexceptionandassertionfailures andexistingstacktrace basedfailuretriagetechniques whichmainly support exception failures are not directly applicable in ci.
failedtestanalysis rq2 .
fig1breportsthedistributionofthe numberofalltests intheleftviolinplot andthenumberoffailedtests intherightviolinplot acrossthe80 778test failedbuildsthathaveexceptionfailuresandthe119 514test failedbuildsthathaveassertionfailuresinlogarithmicscale.wecanobservethatin75 and25 ofthetest failedbuildsthathaveexceptionfailures thereareatleast50 403and1 636tests whileatleast1 3and9testssignalexception failures and in and of the test failed builds that have assertionfailures thereareatleast132 536and2 000tests whileatleast1 2and4testssignalassertionfailures.comparedtothenum berofalltests thenumberoffailedtestsisrelativelyverysmall.in particular 586ofthe80 778test failedbuildshaveatleasttwo testssignalexceptionfailures andtheirmediannumberoftestssig nalingexceptionfailuresis6 while62 494ofthe119 514test failedbuildshaveatleasttwotestssignalassertionfailures andtheirmedian number of tests signaling assertion failures is .
these results demonstrate that multiple test failures are moderately common in cibuilds whichrepresentsthepotentialreductionoftestfailure diagnosis cost that can be achieved by test failure triage.
rootcauseanalysis rq3 .
werandomlypick100test failed builds that have at least two tests signal exception failures and test failedbuildsthathaveatleasttwotestssignalassertionfailures achievingaconfidencelevelof95 andamarginoferrorof9.
.itis worthmentioningthatover30 ofthese200brokenbuildsweretriggeredaftermorethantwocommits andonaverage aroundnine sourcecodefileswerechangedineachofthe200brokenbuild.thus itisnon trivialfordeveloperstodiagnosetestfailuresinabuild.twooftheauthorsseparatelydiagnosefailedtestsinthese200test failedbuildsbyinvestigatingthepreviouscommitsthatmayintroducethefailure thesucceedingcommitsthatmayfixthefailureandthebuildloginordertoidentifytherootcauseforeachfailedtest.wedefinearootcauseasthecodechangesthatintroducethefailure.then theyinvestigateinconsistentcasestogethertoreachconsensus.wespentaround1.5person monthtocompletethemanualanalysis.fig.
1creportsthemanualtriageresults i.e.
thedistributionofthenumberofrootcausesacrossthe200test failedbuilds.wecanseethatthefailed testswithexceptionfailureshavethesamerootcausein82builds and havemultiplerootcausesin18builds.thefailedtestswithassertionfailureshavethesamerootcausein75builds andhavemultipleroot0 .
.
!
!
.
.
!
.
.
.
.
.
.
.
.
.
.
.
.
.
!
.
.
.
.
a exception failure in test testnumdecompositionlevelslossless !
.
.
.
!
!
.
.
!
.
.
.
.
.
.
.
.
.
.
.
.
.
!
.
.
.
.
!
.
.
b exception failure in test testreadrasterlevel0lossy .
!
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
!
!
!
.
!
c exception failure in test testsavebytestiling figure part of exception failures in bioformats causesin25builds.theseresultsindicatethattestfailuresinalarge partofthetest failedbuildshaveonlyonerootcause.thus testfail uretriageincishouldbeawareofthisspecificcharacteristic.exist ingstacktrace basedfailuretriagetechniquesfailtodoso andtheir triagemodeltendstotriagetestfailuresintoonerootcausesuch that it can still yield an overall good performance although it has a poorperformanceontriagingtestfailureswithmultiplerootcauses.
.
motivating examples of test failures fig.2showstheexceptionlogofthreeofthe62exceptionfailuresin a build of the project bioformats .
the first line of the log includes the signature of the test that signals the exception failure.
the secondlineshowstheexceptionmessagethatiscomposedoftwoparts i.e.
theexceptiontypeandadeveloper writtenmessage.therestofthelineslisttheexceptionstacktrace.fig.
3showsthecodechanges thatcausetheexceptionfailures.thecallto mciis.close wasinserted after reader.dispose in method readimage in fig.3a causingthefailureinfig.
2a.similarly thecallto mciis.close was insertedafter reader.dispose inmethod readraster infig.3b whichcausedthefailuresinfig.
2band2c.infact thecodechangein fig.3acausedsixofthe62exceptionfailures andthecodechangein authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa chen zhang bihuan chen xin peng and wenyun zhao !
!
!
!
!
!
!
!
!
a code changes in readimage injaiiioserviceimpl.java !
!
!
!
!
!
!
!
!
b code changes in readraster injaiiioserviceimpl.java figure part of code changes in bioformats fig.3bcausedtheremaining56exceptionfailures.tofixthefailures mciis.close shouldbecalledbefore reader.dispose .ourapproachcansuccessfullytriagethe62exceptionfailuresintotwoclusterswithrespecttothetworootcauses detailswillbeintroducedinsec.
.
.itisalsoworthmentioningthatthetworootcausessharethe samenaturebutoccurindifferentcodelocations andhenceweconsider them as two root causes but not one root cause.
fig.4presentstheexceptionlogofthetwoassertionfailuresina buildoftheproject retrofit .thefirstlineofthelogincludesthesignatureofthetestthatsignalstheassertionfailure.thenextfivelinesreporttheassertionmessagethatiscomposedoftwoparts i.e.
theas sertionerrortypeandtheexpectedandactualvalueintheassertionstatement.theremaininglinesshowtheexceptionstacktrace.fig.
showsthetestcodeofthetwofailedtests andfig.
6showsthecode changesthatcausetheassertionfailures.thecodechangesinfig.
6a renamed converterfactory tofactory whilethecodechangesin fig.6brenamed callbackexecutor toexecutor .
the two renamingrefactoringswerenotconsistentlyappliedontheassertionstate mentsinthetwotestsinfig.
whichcausedthefailuresinfig.
.to fixthefailures thesamerenamingrefactoringsshouldbeappliedon the two tests.
our approach can correctly triage the two assertion failuresintotwoclusterswithrespecttothetworootcauses i.e.
the two renaming refactorings details will be introduced in sec.
.
.
approach inthissection wefirstpresentanoverviewof buildsheriff andthen introduce each step of buildsheriff in detail.
.
overview fig.7presentstheoverviewofourchange awaretestfailuretriageapproach.buildsheriffisdesignedtotriagefailedtestsineachcibuild ofatargetprojectsothatthefailedtestswiththesamerootcauseare putinthesamecluster.buildsheriffistriggeredwhenacibuildfrom aprojectrepositoryoccurs.itworksinthreesteps triageknowledge preparation sec.
.
exceptionfailuretriage sec.
.
andassertion failuretriage sec.
.
.itfirstpreparestriageknowledgebyanalyzingthebuildlog theprojectsourcecode andthecodechangesfromthepreviouspassedbuild.basedonthetriageknowledge itthenuses different strategies to triage exception failures and assertion failures.thekeycharacteristicofourtriagestrategiesistheawareness .
.
.
.
.
!
.
.. .
.
.
.
.
.
.
.
.
.
!
.
!
.
.
.
!
.
.
!
.
.
.
!
.
.
.
.
.
!
.
.
!
.
a assertion failure in test callbackexecutornullthrows .
.
.
.
.
.
!
.
.. .
.
.
.
.
.
.
.
.
.
.
.
.
!
.
!
.
.
.
!
.
.
!
.
.
.
!
.
.
.
.
.
!
.
.
!
.
b assertion failure in test converternullthrows figure assertion failures in retrofit !
!
!
!
!
!
!
a c od eo ft e s tcallbackexecutornullthrows !
!
!
!
!
!
!
b c od eo ft e s tconverternullthrows figure test code in retrofit !
!
!
!
!
!
!
!
!
a code changes in addconverterfactory b code changes in callbackexecutor figure part of code changes in retrofit of code changes.
buildsheriffis currently implemented for java projects that use travis as ci service and maven as build tool.
.
triage knowledge preparation buildsheriffhasthreestepstopreparethetriageknowledgeforexceptionfailuresandassertionfailures.thetriageknowledgeisthree fold testfailures i.e.
testsignature exceptionmessage stacktrace and test code code changes at the file method and field level that potentiallycausethetestfailures and filedependencies thatcapture thecodechangeimpactsthatalsopotentiallycausethetestfailures.
testfailureanalysis.
asthebuildlogcontainsawell formatted summaryoftestfailures wefirstuseregularexpressionmatchingto authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
buildsheriff change aware test failure triage for continuous integration builds icse may pittsburgh pa usa ci build test failures code changes file dependenciestest failure analysis code change analysis file dependency analysisexception failure triage assertion failure triagetriage knowledge preparation failed test clusters failed test clusters figure approach overview of buildsheriff extracttwosetsoffailedteststhatrespectivelysignalexceptionfailuresandassertionfailures andparsethetestsignature si i.e.
class name and test method name and the line number of the test code that signals the failure for each of the failed tests.
if no test failure occurs i.e.
the build is not a test failed build buildsheriff stops.
then forafailedtestsignalinganexceptionfailure weuseitstest signaturetolocateandparsetheexceptionmessage ms andthestack tracestfrom the build log.
the exception message contains the exceptiontypeandadeveloper writtenmessage whilethestacktrace consists of an ordered list of frames i.e.
methods that were active onthecallstackbeforetheexceptionoccurred.generally iftwoex ceptionfailuressharethesamerootcause theyaremorelikelytobesimilarintheexceptionmessageandthestacktrace.differently forafailedtestthatsignalsanassertionfailure wedonotextracttheas sertionmessageandthestacktracebecauseoftheirlowdiscrimina tion.specifically theassertionmessagesinthebuildlogmostlycon tainthesameerrortype e.g.
java.lang.assertionerror while thestacktracesmostlyconsistofsimilarmethodsthatdonotbelongtothetargetprojectbutareassertion relatedmethodsfromthetesting infrastructure e.g.
junit as the methods before the assertion statementinthetestssuccessfullyreturned.inthatsense assertionfailures that have different root causes could have similar assertionmessagesandstacktraces.forexample alltheframesexceptforthe firstframein thetwostacktraces infig.
4aremethods fromjava reflection junitandmaven andareexactlythesame althoughthe two assertion failures have different root causes.
finally forafailedtestthatsignalsanassertionfailure weobtain thetestmethodfromtheprojectsourcecodeaccordingtoitstestsig nature andtailorthetestcode tcfromthefirstlineofthetestmethod tothelinenumberofthetestcodethatsignalstheassertionfailure.inotherwords onlytheexecutedtestcodeisincludedin tcbecause theunexecutedtestcodeisactuallynotrelatedtothetestfailure.
however forafailedtestsignalinganexceptionfailure wedonottai lorthetestcodeasthetriageknowledge.thereasonisthattestssig nalingexceptionfailures comparedtotestssignalingassertionfail ures aremostlypartiallyexecuted andhencetheexecutedtestcode contains less informative knowledge for exception failure triage.
formally we define an exception failure xein the exception failuresxeofabuildasa3 tuple angbracketleftsi ms st angbracketright anddefineanassertion failurexaintheassertionfailures xaofabuildasa2 tuple angbracketleftsi tc angbracketright.
codechangeanalysis.
motivatedbythefactthatrootcausesof testfailuresareoftenintroducedbycodechanges weconsider codechangesasimportanttriageknowledge.insteadofconsidering codechangesfromthepreviousbuild weconsidercodechangesfromthepreviouspassedbuildbecauseallcodechangesinpreviouscon secutivefailedbuildscanpotentiallycausethetestfailuresinthecur rentbuild.tothisend weusethecodedifferencingtoolcldiff to obtain the changed source code files fc methods mcand fields dcfrom the previous passed build to the current build.
filedependencyanalysis.
codeaffectedbythecodechanges canalsopotentiallycausetestfailures.thus weusecodedependen ciestocapturesuchcodechangeimpactsandseverasthetriageknowl edge.wemodelcodedependenciesatthefile levelratherthanmethod levelgranularityfortworeasons.ononehand weareinspiredbyre centstudiesonpracticalregressiontestselection whichshow thatbetterresultscanbeachievedbyselectingtestsatacoarser file level comparedtoafiner method level granularityofcodedepen dencies.ontheotherhand itismoreefficienttoanalyzefiledepen denciesthanmethoddependencies whichisimportantforpracticalfailuretriageinci.specifically weadoptanincrementalwaytoanalyze file dependencies.
we first construct a file dependency graph g angbracketleftv e angbracketrightforthetargetprojectwhenthefirsttest failedbuildoccurs.eachnodein vdenotesasourcecodefile andeachedgein e denotesausagedependencybetweentwofiles.afilecanuseallfilesfromitsownpackage orfilesfromotherpackagesviaimportstate mentorfullyqualifiedname.thus weusejdttoparseeachsourcecodefile i.e.
toparseitsownpackageandimportstatementstoiden tifypotentiallyusedfilesandestablishusagedependencies.herewedonotanalyzefileusageswithfullyqualifiednameduetoitsheavyweightanalysiscostanditsuncommonadoption.notethatthisstep isaone timejobforthetargetproject.then weupdate gforeach subsequenttest failedbuildbyparsingchanged i.e.
deleted added and modified files from the previous test failed build.
.
exception failure triage buildsheriffachievesthetriageofexceptionfailures xeinabuild by a pipeline of the following three strategies.
s1e complexityofcodechanges.
generally thehighercomplexityofcodechangesinabuild thehigherchanceofcausingtestfailures andthelargernumberofrootcausesfortestfailures.how ever cirequiresdeveloperstofrequentlymergetheircodetofinder rorsasearlyaspossible.therefore codechangesinabuildaremostlynotcomplex andasrevealedbyourstudy sec.
.
alargepartoftestfailedbuildshaveonlyonerootcausefortestfailures.motivatedby these observations we propose a strategy s1eto use the complexity ofcodechangestodeterminewhether xehasonerootcauseornot.
here weusethenumberofchangedmethods i.e.
mc astheindicatorofcodechangecomplexity andconsider xeashavingoneroot causeif mc islowerthanathreshold e i.e.
mc e .thus if mc eis satisfied buildsheriff triages all exception failures into one cluster otherwise it uses the next strategy in the pipeline.
s2e change awarestacktracesimilarity.
astacktraceisan orderedlistofframesonthecallstackwhenanexceptionoccurred.eachframerepresentsamethod andrecordsitsenclosingfilename.
astacktracecarriesimportantinformationfordebugging .we proposeanewchange awarestacktracesimilaritymetricbasedontheinsightthatahigherweightshouldbegiventotheframesthatare closertocodechangesbecausesuchframesaremorelikelytobe affectedbycodechangesandbeblamedfortheexception.based on this metric we propose a clustering strategy s2eto triagexe.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa chen zhang bihuan chen xin peng and wenyun zhao basedontheaboveinsight wefirstdefinethedistanceofaframe mtocodechanges asformulatedineq.
wherefmdenotestheenclosing file of m anddt prime fm fc g denotes the distance of fmto achangedfile fc fconthefiledependencygraph g.basically dt m iszeroifmitselfischanged andoneiftheenclosingfileof m ischanged otherwise dt m ismeasuredbytheminimumdistance offmto all changed files on giffmreaches some changed file and a large value mdteiffmdoes not reach any changed file.
dt m m m c fm fc minfc fcdt prime fm fc g fmreachsome f c mdte otherwise then wedefinetheweight orimportance ofaframe mbasedon thedistancetocodechanges dt m asformulatedineq.
wherece isacoefficientforthedistancetocodechanges.thesmallerthedistance to code changes the higher the weight.
w m e ce dt m then wedefinethesimilarityoftwostacktraces st1 m1 m1 ... andst2 m2 m2 ... usingthes rensen diceindex i.e.
eq.
.
sim st1 st2 summationtext.
m st1 st2w m summationtext.
m st1w m summationtext.
m st2w m finally weapplythesingle linkageagglomerativeclusteringtechnique toclusterexceptionfailures xebasedonthesimilarityof thestacktracesofexceptionfailures.inotherwords weusethemaximumstacktracesimilarityofallexceptionfailurepairsbetween twoclustersastheclusterdistance asformulatedineq.
wherex1e andx2eare two clusters of exception failures and we use a cluster distance threshold dtstas a stopping criterion for clustering.
dt x1 e x2 e maxx1e x1e x2e x2esim x1 e.st x2 e.st whenthestacktracesize i.e.
thenumberofframes ofanexceptionfailureissmall thestacktracecontainslessinformativeknowledgeforfailuretriage.hence weuse s2eifthemaximumstacktrace sizeoftheexceptionfailuresislargerthanasizethreshold sizest i.e.
maxxe xe xe.st sizest otherwise we use the next strategy.
s3e exceptionmessagesimilarity.
anexceptionmessagecontainstheexceptiontypeandadeveloper writtenmessage whichpo tentiallydescribestherootcause symptom orhandlinghintofthe exception.intuitively twoexceptionfailureshavingthesamerootcause arelikelytohavesimilarexceptionmessages.hence wedesignaclusteringstrategy s3ebasedonexceptionmessagesimilaritytotriage xe.
first wedefinethesimilarityoftwoexceptionmessages ms 1and ms 2based on their levenshtein distance at the token level as formulatedineq.
wheret ms denotesasequenceoftokensin ms split by white space and dt t ms 1 t ms 2 denotes the levenshtein distance i.e.
the minimum number of token level edits i.e.
insertion deletionandsubstitution tochange t ms 1 intot ms 2 .
sim ms 1 ms 2 maxlen th dt t ms 1 t ms 2 maxlen th maxlen th max t ms 1 t ms 2 we then apply the single linkage agglomerative clustering techniquetoclusterexceptionfailures xebasedonthesimilarityoftheexceptionmessagesofexceptionfailures i.e.
eq.
.weuseacluster distance threshold dtms as a stopping criterion for clustering.
dt x1 e x2 e maxx1e x1e x2e x2esim x1 e.ms x2 e.ms example.
givenexceptionfailuresinfig.
buildsheriffadopts s2etoachievethetriage.thedistanceofeachframetocodechangesis highlightedintheleftofeachframeinfig.
.asexplainedinsec.
.
theexceptionfailuresinfig.
2aand2bhaddifferentrootcauses even thoughtheirstacktraceslooksimilar.ontheotherwayaround theex ceptionfailuresinfig.
2band2chadthesamerootcause eventhough theirstacktraceslookdissimilar.buildsheriffcorrectlytriagesthemduetoourconsiderationofthedistanceofeachframetocodechangesincomputingstacktracesimilarity.indetail buildsheriffgivesthehighestweighttotheframeof readimage andreadraster because theyarechanged asshowninfig.
.withsuchweightedsimilarity measure buildsheriffsuccessfullytriagesthefailuresinfig.
2aand 2bintotwoclusters asthestacktraceinfig.
2acontains readimage butnot readraster andthestacktraceinfig.
2bcontains readraster butnot readimage anditalsocorrectlytriagesthefailuresinfig.
2b and2cintothesamecluster asbothstacktracesinfig.
2band2ccontainreadraster .thestate of the artmethod failsonthesecases.
.
assertion failure triage buildsheriffachievesthetriageofassertionfailures xainabuild by a pipeline of the following two strategies.
s1a complexityofcodechanges.
similartoexceptionfailure triage weproposeastrategy s1atousethecomplexityofcodechanges todeterminewhether xahasonerootcauseornot.weregard xaas havingonerootcauseifthenumberofchangedmethods i.e.
mc islowerthanathreshold a i.e.
mc a .thus if mc ais satisfied buildsheriff triages all the failed tests into onecluster otherwise it uses the next strategy in the pipeline.
s 2a change awaretestcodesimilarity.
thetestcode tcofan assertion failure is the executed code when the assertion failure occurred.
intuitively a higher test code similarity between two assertionfailures ahigherlikelihoodthattheysharethesamerootcause.similartoourchange awarestacktracesimilaritymetric wedesignachange awaretestcodesimilaritymetricbasedontheinsightthatahigherweightshouldbeassignedtocodetokensthatarecloserto code changes as such code tokens are more likely to be affected by codechangesandbeblamedfortheassertionfailure.usingthismetric we develop a clustering strategy s2ato triagexa.
basedontheaboveinsight wefirsttokenizetestcode tcintoalist ofcodetokens t1 t2 ... .then wedefinethedistanceofacodetokenttocodechanges asformulatedineq.
whereftdenotesthe enclosing file of tiftcorresponds to the name of a method or a field and dt prime ft fc g denotes the distance of ftto a changed file fc fcon the file dependency graph g. basically dt t is zero ift ischangedandcorrespondstothenameofamethodorafield and one ifftis changed otherwise dt t is measured by the minimum distance of ftto all changed files on gifftreaches some changed file and a large value mdtaifftdoes not reach any changed file.
dt t t m c dc ft fc minfc fcdt prime ft fc g ftreachsome f c mdta otherwise authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
buildsheriff change aware test failure triage for continuous integration builds icse may pittsburgh pa usa then wedefinetheweight orimportance ofacodetoken tbased onthedistancetocodechanges dt t asformulatedineq.
whereca is a coefficient for the distance to code changes.
w t e ca dt t then wedefinethesimilarityoftwotestcode tc1 t1 t1 ... and tc2 t2 t2 ... using the s rensen dice index i.e.
eq.
.
sim tc1 tc2 summationtext.
t tc1 tc2w t summationtext.
t tc1w t summationtext.
t tc2w t we finally use the single linkage agglomerative clustering technique to cluster assertion failures xabased on the similarity of the testcodeofexceptionfailures i.e.
eq.
.weuseaclusterdistance threshold dttcas a stopping criterion for clustering.
dt x1 a x2 a maxx1a x1a x2a x2asim x1 a.tc x2 a.tc example.
givenassertionfailuresinfig.
buildsheriffadopts s2atorealizethetriage.thecodetokensofthetestinfig.
5aare try new retrofit builder callbackexecutor null fail catch nullpointerexception e assertthat e hasmessage and callbackexecutor null .
retrofit builder and callbackexecutor respectivelyhaveadistanceof1 1and0tocodechanges andother codetokenshaveadistanceof mdtatocodechanges.similarly retrofit builder and addconverterfactory infig.
5brespectivelyhave adistance of1 1and 0tocodechanges.
asintroducedinsec.
.
theassertionfailuresinfig.
4haddifferentrootcauses eventhough theirfailedtestsinfig.
5looksimilar.buildsheriffsuccessfully triagesthembecauseofourconsiderationofthedistanceofeachtestcodetokentocodechangesincomputingtestcodesimilarity.specif ically buildsheriffgivesthehighestweightto callbackexecutor and addconverterfactory becausethecorrespondingmethodsarechanged asshowninfig.
.asthetestcodetokenwiththehighest weight is different in the two tests buildsheriff correctly triages thetwofailuresintotwoclusterswithweightedsimilaritymeasure.
.
usage scenario of triage results aftertriagingtestfailures buildsheriffpresentsdeveloperswitha setofclusters andnotifiesdevelopersthateachclusterhasasetoftestfailureswhoserootcauseisconsideredasthesame.foreachtestfail ureinacluster buildsheriffprovidesdeveloperswiththedistance information to code changes e.g.
fig.
and tells developers that methodsonstacktracesormethodsintestcodethathavesmalldis tancetocodechangescanbethestartingpointtolocaterootcauses.
then developers can use the triage results in two potential scenarios.usagescenario1 developersarerequiredtochoosethefirst test failure in each cluster as the representative to find and fix root causes andrerunallthetests.whensomerootcausesarenotfixed i.e.
sometestsstillfail developersneedtoinspectalltheremainingtestfailuresineachcluster.
usagescenario2 insteadofinspectingall the remaining test failures ineach cluster when some root causes arenotfixedbyinspectingthefirsttestfailureineachcluster developers need to inspect the first test failure of the remaining test failures ineach cluster rerunall thetests anditerate thisprocess until all the root causes are fixed i.e.
all the tests pass .thedifferencesbetweenthetwousagescenariosarethatmoretest failuresareinspectedbydevelopersin usagescenario1 thaninusagescenario2 butmoreexecutionsofallthetestsareneededin usage scenario than inusage scenario where at most two executionsofallthetestsareneeded .infact thelowerboundonthe number of inspected test failures is achieved in usage scenario2 atthecostofmoreexecutionsofallthetests.inotherwords the two usage scenarios have a differenttradeoff between the number of inspected test failures and the number of executions of all the tests.practicalusagescenarioscanbein between usagescenario 1andusagescenario2 .inthatsense thesignificanceof buildsheriff is that it reduces test failure diagnosis cost for ci developers by reducing the number of inspected test failures or the number of executions of all the tests through effectively triaging test failures.
evaluation wehaveimplementedbuildsheriffin17.0klinesofjavacode and havereleasedthecodeanddataof buildsheriffatourwebsite .
.
evaluation setup toevaluatetheeffectivenessandefficiencyof buildsheriff wedesigned our evaluation to answer the following research questions.
rq4 howistheeffectivenessof buildsheriffintriagingtestfailures compared with the state of the art approaches?
sec.
.
rq5 how is the efficiency of buildsheriff in triaging test failures compared with the state of the art approaches?
sec.
.
rq6 howisthecontributionofeachtriagestrategyinbuildsheriff to the achieved effectiveness of buildsheriff?
sec.
.
rq7 howisthesensitivityofeachparameterinbuildsheriffto the effectiveness of buildsheriff?
sec.
.
dataset.
weusedthe100brokenbuildswithexceptionfailures andthe100brokenbuildswithassertionfailuresfrom rq3ofourempiricalstudyinsec.
.1asthedatasetforourevaluation.theground truth has already been constructed during the analysis of rq3.
comparisonapproaches.
forrq4andrq5 weselectedthree state of the artapproaches i 1frame whichtriagescrashreportsusing the top frame in stack traces.
we selected it because it is practi callyusedinmozilla .ii 1file whichtriagescrashreportsusing thenameofthesourcefileinwhichthetopframeisdefined.wese lecteditasitachievedthehighesttriageprecisioninarecentempiri calstudy .iii rebucket whichtriagescrashreportsbasedonthe number of functions in two stack traces the distance of those func tionsfromthetopframe andtheoffsetdistancebetweenthematchedfunctions .weselecteditasitoutperformedthetriagemethodin microsoft s windows error reporting system.
moreover given the results in rq3 we developed one naive method 1cluster which simply puts all test failures into a single cluster.
evaluationmetrics.
tocomprehensivelyevaluatethetriageeffectiveness we used the number of builds whose failures were correctlytriaged referredtoas c.b.
asanoverallindicatoroftriageeffectiveness used the number of executions of all tests a developer needstorun referredtoas t.e.
andthenumberoftestfailuresadeveloperneedstoinspect referredtoas t.f.
inthetwousagescenariosdiscussed insec.
.5toreflect theeffortsaving fora developer when using buildsheriff and used the number of missed root authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa chen zhang bihuan chen xin peng and wenyun zhao table effectiveness comparisons to the state of the art on exception failures approach c.b.
t.e.
t.f.
t.e.2t.f.
m.r.
purityi.p.
fm.
randjac.f.
m.ent.
c.e.
m.i.
v.i.
e.d.
b.pre.
b.rec.
b.fm.
1cluster .
.
.
.
.
.
.
.
.
.
.
.
.
.
1file .
.
.
.
.
.
.
.
.
.
.
.
.
.
1frame .
.
.
.
.
.
.
.
.
.
.
.
.
.
rebucket .
.
.
.
.
.
.
.
.
.
.
.
.
.
buildsheriff .
.
.
.
.
.
.
.
.
.
.
.
.
.
table effectiveness comparisons to the state of the art on assertion failures approach c.b.
t.e.
t.f.
t.e.2t.f.
m.r.
purityi.p.
fm.
randjac.f.
m.ent.
c.e.
m.i.
v.i.
e.d.
b.pre.
b.rec.
b.fm.
1cluster .
.
.
.
.
.
.
.
.
.
.
.
.
.
1file .
.
.
.
.
.
.
.
.
.
.
.
.
.
1frame .
.
.
.
.
.
.
.
.
.
.
.
.
.
rebucket .
.
.
.
.
.
.
.
.
.
.
.
.
.
buildsheriff .
.
.
.
.
.
.
.
.
.
.
.
.
.
causes when a developer inspects one test failure per cluster referredtoas m.r.
tomeasuretheimpactofineffectivetriage.further asthegoalof buildsheriffistoproduceasetofclustersoftestfailureswhoserootcauseisconsideredasthesame weneedtocompare thedistancebetween theclustersgeneratedby buildsheriffand the ground truth clusters manually constructed.
to this end we used all the five families of clustering evaluation metrics in amig et al.
as different families capture different perspectives of four clusteringqualities i.e.
clusterhomogeneity aclustershouldnot mixtestfailures withadifferentrootcause clustercompleteness testfailureswiththesamerootcauseshouldbegroupedintothe same cluster rag bag introducing noise into a noisy cluster is less harmfulthanintroducingnoiseintoacleancluster and clustersize versusquantity asmallerrorinabigclustershouldbepreferable to a large number of small errors in small clusters .
we briefly list the five families as follows and the detailed definition and the satisfaction level of the four qualities can be found in amig et al.
.
metricsbasedonsetmatching purity inversepurity i.p.
andtheir combination f measure fm.
.
metricsbasedoncountingpairs randstatistic rand jaccardcoefficient jac.
and folkes and mallows f. m. .
metricsbasedonentropy entropy ent.
classentropy c.e.
mutual information m.i.
and variation of information v.i.
.
metric based on edit distance edit distance e.d.
.
metricsbasedonbcubed bcubedprecision b.pre.
bcubedrecall b.rec.
and their combination bcubed f measure b.fm.
.
forent.
t.e.
t.f.
m.r.
c.e.
v.i.ande.d.
thelowerthebetter andfor the others the higher the better.
.
effectiveness evaluation rq4 table1showstheresultsof 1cluster 1file 1frame rebucketand buildsheriffwithrespecttothe20effectivenessmetricsonthe100 brokenbuildswithexceptionfailures.
t.e.andt.f.forusage scenario1aredenotedas t.e.1andt.f.
whilet.e.andt.f.forusage scenario2 aredenotedas t.e.2andt.f.
.thenaivemethod1clusterachievedworseperformanceon16ofthe20metricsthanbuildsheriff.specifically with1clusterin usage scenario1 developerswouldinspect263ofthe1 903testfailuresandrun118executions of all tests which are .
and .
more than with buildsheriff.inotherwords buildsheriffwouldsave81.
ofthetestfailureinspectioneffortand13.
ofthetestexecutioneffort.with 1cluster in usage scenario developers would inspect testfailures and run executions of all tests which are .
less and .
morethanwithbuildsheriff.inotherwords buildsheriff wouldsave18.
ofthetestexecutioneffortatthecostof3.
more test failure inspection effort.
besides developers would miss of the root causes when only inspecting one test failure per cluster with 1cluster which is .
more than with buildsheriff.
onthe otherhand thestate of the art methods1file 1frame andrebuckethadsimilarresultsonallthemetricsexceptfor t.f.
t.f.
c.e.
v.i.ande.d.onwhich1fileachievedbetterresults while buildsheriff outperformed them on all the metrics.
in particular buildsheriff significantly improved the best of the three stateof the art methods on all the metrics except for t.e.
t.e.
purity f. m.andb.pre.
i.e.
by .
on c.b.
.
on t.f.
.
on t.f.
.
on m.r.
.
on i.p.
.
on fm.
.
on rand .
onjac.
.
on ent.
.
on c.e.
.
on m.i.
.
on v.i.
.
one.d.
.
on b.rec.
and .
on b.fm.. table2showstheresultsonthe100brokenbuildswithassertion failures.comparedto1cluster buildsheriffachievedbetterperformanceon13ofthe20metrics.althoughdeveloperswouldinspect and of the test failures with 1cluster in usage scenario and2 which are .
and .
less than with buildsheriff developers would run and executions of all tests which are .
and .
more than with buildsheriff.
in other words buildsheriffwouldsave12.
and35.
ofthetestexecutioneffortatthecostof5.
and12.
moretestfailureinspection effort.
besides developers would miss of the root causes whenonlyinspectingonetestfailureperclusterwith1cluster which is .
more than with buildsheriff.
ontheotherhand 1fileandrebucketachievedsimilarresults buthadbetterresultsthan1frameonmostofthemetrics while buildsheriffoutperformed1file 1frameandrebucketonallthe metrics except for f. m.. in particular buildsheriff significantly improved the best of the three state of the art methodson all the metrics except for purity i.p.
f. m. b.pre.andb.rec.
i.e.
by53.
on c.b.
.
on t.e.
.
on t.f.
.
on t.e.
.
on t.f.
.
on m.r.
.
on fm.
.
on rand .
onjac.
.
on ent.
.
on c.e.
.
on m.i.
.
on v.i.
.
on e.d.
and .
on b.fm.. theseresultsdemonstratethati thenaivemethodwouldmissthe highestnumberofrootcauseswhendevelopersonlyinspectone testfailureperclusteralthoughitcouldachievearelativelyhigh number of correctly triaged builds and hence advanced failure authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
buildsheriff change aware test failure triage for continuous integration builds icse may pittsburgh pa usa table contributions of each strategy in buildsheriff on exception failures approach c.b.
t.e.
t.f.
t.e.2t.f.
m.r.
purityi.p.
fm.
randjac.f.
m.ent.
c.e.
m.i.
v.i.
e.d.
b.pre.
b.rec.
b.fm.
1file .
.
.
.
.
.
.
.
.
.
.
.
.
.
1frame .
.
.
.
.
.
.
.
.
.
.
.
.
.
rebucket .
.
.
.
.
.
.
.
.
.
.
.
.
.
s2e .
.
.
.
.
.
.
.
.
.
.
.
.
.
naive s2e19 .
.
.
.
.
.
.
.
.
.
.
.
.
.
simple s2e26 .
.
.
.
.
.
.
.
.
.
.
.
.
.
s3e .
.
.
.
.
.
.
.
.
.
.
.
.
.
s2e s3e3144111451102 .
.
.
.
.
.
.
.
.
.
.
.
.
.
s2a .
.
.
.
.
.
.
.
.
.
.
.
.
.
buildsheriff .
.
.
.
.
.
.
.
.
.
.
.
.
.
table contributions of each strategy in buildsheriff on assertion failures approach c.b.
t.e.
t.f.
t.e.2t.f.
m.r.
purityi.p.
fm.
randjac.f.
m.ent.
c.e.
m.i.
v.i.
e.d.
b.pre.
b.rec.
b.fm.
1file .
.
.
.
.
.
.
.
.
.
.
.
.
.
1frame .
.
.
.
.
.
.
.
.
.
.
.
.
.
rebucket .
.
.
.
.
.
.
.
.
.
.
.
.
.
naive s2a24 .
.
.
.
.
.
.
.
.
.
.
.
.
.
simple s2a28 .
.
.
.
.
.
.
.
.
.
.
.
.
.
s2e .
.
.
.
.
.
.
.
.
.
.
.
.
.
s3e .
.
.
.
.
.
.
.
.
.
.
.
.
.
s2e s3e29 .
.
.
.
.
.
.
.
.
.
.
.
.
.
buildsheriff .
.
.
.
.
.
.
.
.
.
.
.
.
.
triageisneeded andii thestate of the artstacktrace basedfailure triageisnotwellapplicabletotriageexceptionandassertionfailures in ci while buildsheriff is capable of achieving this goal.
wefurtheranalyzedtheintersectionsamongthecorrectlytriaged buildsbythesemethods.forthebuildswithexceptionfailures 58and59ofthecorrectlytriagedbuildsby1cluster 1file 1frame and rebucket were also correctly triaged by buildsheriff and of the correctly triaged builds by buildsheriff were not correctly triagedbyanyothermethod.similarly forthebuildswithassertionfailures 41and52ofthecorrectlytriagedbuildsby1cluster 1file 1frameandrebucketwerealsocorrectlytriagedbybuildsheriff and of the correctly triaged builds by buildsheriff were not correctly triaged by any other method.
summary.
buildsheriff significantly outperformed the naive methodandthebestofthestate of the artmethodson13 ofthe20 metricsintriagingexceptionfailuresandassertionfailuresinci builds.
buildsheriff achieved a test execution effort saving of up to35.
atthecostofupto12.
moretestfailureinspectioneffort when compared to 1cluster and achieved a test execution effort savingofupto15.
andatestfailureinspectioneffortsavingof up to .
when compared to the state of the art methods.
.
efficiency evaluation rq5 weanalyzedtheaverageend to endtimeoverheadofthefivetriage methods over the broken builds.
1cluster 1file 1frame rebucketandbuildsheriffrespectivelytook0.
.
.
.13and .61secondstotriageabuild.weexcludedthetimeoverheadofconstructingthefiledependencygraph whichonaveragetook15.48sec ondsforeachproject fromthetimeoverheadof buildsheriffasit wasaone timejobforeachproject.instead buildsherifftook0.
secondstoupdatethefiledependencygraph.whilebeingtheslow estduetocodechangeanalysis buildsheriffisstillpracticalforci.
summary.
buildsherifftook1.61secondstotriagetestfailures in a ci build which was acceptable for practical usage in ci.
.
ablation study rq6 asbuildsheriffadoptsthreestrategiesfortriagingexceptionfailuresandtwostrategiesfortriagingassertionfailures webrokedownthebrokenbuildswithrespecttothestrategiesthattriagedthem.58ofthe100brokenbuildswithexceptionfailuresweretriagedby s1e and56ofthemwerecorrectlytriaged 28weretriagedby s2e and25of themwerecorrectlytriaged and14weretriagedby s3e and13ofthem werecorrectlytriaged.56ofthe100brokenbuildswithassertion failuresweretriagedby s1a andallofthemwerecorrectlytriaged and 44weretriagedby s2a and33ofthemwerecorrectlytriaged.theseresultsdemonstratethateachstrategycontributestotheeffectivenessof buildsheriff.as s1eands1aarenotrelatedtostacktracesandthus canalsobeusedincombinationwith1file 1frameandrebucket weusedthe42brokenbuildswithexceptionfailuresthatwerenottriagedby s1etofurtherinvestigatetheadvantageof s2eands3e andusedthe 44brokenbuildswithassertionfailuresthatwerenottriagedby s1a to further investigate the advantage of s2a.
table3reportstheresultsof 1file 1frame rebucket buildsheriffanditsvariantswithrespecttothe20metricsonthe42brokenbuildswithexceptionfailures.wecanobservethatifweonlyused s2e i.e.
thefifthrowintable s2estilloutperformed1file 1frameand rebucketonallmetricsthankstoitsconsiderationofcodechanges butachievedworseresultsthanapipelinecombinationof s2eands3e i.e.
thelastrow .ifwegavethesameweighttoeachframeinastack trace i.e.
naive s2einthesixthrow naive s2ehadadegradationon allmetrics comparedto s2e.ifweonlydistinguishedwhetheraframe waschangedornotwithoutconsideringchangeimpacts i.e.
simple s2eintheseventhrow simple s2eachievedbetterresultsthannaive s2ebuthadworseresultsthan s2e.theseresultsshowtheadvantage ofconsideringcodechangesandtheirimpactsduringstacktracesim ilaritymeasure.besides ifweonlyused s3e i.e.
theeighthrow s3e achievedworseresultsthan s2eandapipelinecombinationof s2eand s3eonmostofthemetrics.ifweadoptedaweightedcombinationof s2eands3ebyequallyweightingstacktracesimilarityandexception authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa chen zhang bihuan chen xin peng and wenyun zhao a e b a c ce d dtst e sizest f dtms g ca h dttc figure results of parameter sensitivity analysis messagesimilarity i.e.
s2e s3eintheninthrow s2e s3esuffereda degradationonmostofthemetrics.theseresultsindicatetheadvantageofcombining s2eands3einapipeline.further ifweadopted s2a from assertion failure triage i.e.
the tenth row s2ahad the worst resultsonmostofthemetrics.itdemonstratestherationalityofnot considering test code similarity for exception failure triage.
table4reportstheresultsof 1file 1frame rebucket buildsheriffanditsvariantswithrespecttothe20metricsonthe44brokenbuildswithassertionfailures.wecanseethat s2a i.e.
thelastrowin table4 outperformed 1file 1frame and rebucket on all metrics exceptfor t.f.
t.f.
i.p.
f. m. c.e.
e.d.andb.rec..itshowsthatstack traces provide a limited triage capability for assertion failure.
if we gavethesameweighttoeachtestcodetoken i.e.
naive s2ainthefifth row naive s2ahadadegradationon16ofthe20metrics compared tos2a.ifweonlydistinguishedwhetheratestcodetokenwaschanged ornotwithoutconsideringchangeimpacts i.e.
simple s2ainthesixth row simple s2aachievedbetterresultson15ofthe20metricsthan naives2abuthadworseresultsonallmetricsthan s2a.theseresults demonstratetheadvantageofconsideringcodechangesandtheir impactsduringtestcasesimilaritymeasure.moreover ifweadopted s2e s3eandapipelinecombinationof s2eands3efromexceptionfailuretriage i.e.
theseventhtoninthrows theyhadworseresults on14ofthe20metrics.itindicatesastrongercapabilityoftestcodethanstacktracesandassertionmessagesforassertionfailuretriage.
summary.
each triage strategy contributes to the effectiveness of buildsheriff in triaging exception and assertion failures.
.
parameter sensitivity analysis rq7 eachtriagestrategyinbuildsheriffhassomeconfigurableparam eters.wetunedtheseparametersinthreeways.for eins1eand a ins1a weconfiguredthemfrom1to10byastepof1toevaluatetheir impactonthetriageresultsof s1eands1a.theresultsarereportedin fig.8aand8b wherethe x axisdenotesthevalueof eand a and they axisdenotesthenumberofcorrectly incorrectlytriagedbuilds bys1eands1a.as eand aincreased boththenumberofcorrectly andincorrectlytriagedbuildsincreased.as s1eands1aaredesiredto achievealownumberofincorrectlytriagedbuildssothatotherstrategies can be tried a small value of and was set to eand a.force dtstandsizestins2e dtms ins3e andcaanddttcins2a we configured ceandcafrom0.1to2byastepof0.
dtst dtms anddttc from0.51to1.0byastepof0.
and sizestfrom1to50byastepof1 toevaluatetheirimpactonthetriageresultsof buildsheriff.here eand awasfixedto7and3.parametersin s2eands3eweretunedtogether and2.5million i.e.
configurationswereran toobtaintheoptimalconfiguration.similarly i.e.
configurations were ran to obtain the optimal configuration of the two parameters in s2a.
the results are shown in fig.
8c 8h where the xaxis denotes the parameter value and the y axis denotes the number of correctly triaged builds by buildsheriff.
as ceandcaincreased thenumberofcorrectlytriagedbuildsincreasedandthensta bilized.as dtstanddtms increased thenumberofcorrectlytriaged buildsdecreasedduetotheincreasinglystrictclusterdistancethresh old.as sizestincreased thenumberofcorrectlytriagedbuildsfirstincreased thendecreasedandfinallystabilized.as dttcincreased the numberofcorrectlytriagedbuildswasstableatfirst thenincreased and finally decreased.
the optimal configuration of ce dtst sizest dtms caanddttcis .
.
.
.
and .
.
as these parameterschanged thenumberofcorrectlytriagedbuildswasalways above which was significantly higher than the achieved results of 1file 1frame and rebucket.
in that sense the effectiveness of buildsheriff is not very sensitive to these parameters.
formdteins2e weheuristicallysetitasoneplusthemaximumof thedistancesoftheframesthatreachchangedfileson gforallthe 100brokenbuildswithexceptionfailures.weheuristicallyset mdta ins2ain the same way.
in this way both mdteandmdtawere configured to .
we used such a heuristic way that the parameter configurationspaceisreduced andframesandtestcodetokensthatdo not reach any changed file can still contribute to triage.
notethatinsec.
.2and4.
wereportedtheresultsoftheoptimal configuration of buildsheriff.
for 1file 2frame and rebucket we also reported the results of their optimal configuration.
summary.
overall thesensitivityoftheconfigurableparameters to the effectiveness of buildsheriff is acceptable.
.
discussion assumptions.
as buildsheriff is designed for test failure triage incibuilds itcanbeusedforsoftwaresystemswhosedevelopment authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
buildsheriff change aware test failure triage for continuous integration builds icse may pittsburgh pa usa processfollowsthecontinuousintegrationpractice wheredevelopersfrequentlymergetheircodechangesintoacentralrepository and builds and tests then run.
therefore if the continuous integrationpracticeisnotfollowed orthecontinuousintegrationpractice is followed but the software system has a small number of tests buildsheriff will become not applicable or be less helpful.
threats.
onethreattoourevaluationisthatthesizeofourdata setisnotlarge.thisisprimarilyduetotheexpensiveeffortinbuildingthegroundtruthaswearenotfamiliarwiththebusinesslogicofopen sourceprojects.weplantocollaboratewithourindustrialpart nerstodeployourtoolintotheircitogetdevelopers feedback.be sides buildsheriffisevaluatedbasedonbrokenbuildsacrossheterogeneous projects.
we plan to evaluate buildsheriff within the build history of one project.
in addition two usage scenarios in sec.
.5areconsideredinourevaluation andtherecouldbeotherusagescenarios.however webelievethetwousagescenariosarerep resentativeinpractice.itisalsohardtodeterminewhethertestexecutioneffortortestfailureinspectioneffortismoreexpensive andthus we evaluate the triage effectiveness with both dimensions.
limitations.
first buildsheriffonlytriagestestfailures butcannotdirectlypinpointtherootcausesinsourcecodewhichwouldbe useful for developers to fix test failures.
second some engineering effort is needed to extend buildsheriff to support other programminglanguages otherciservicesandotherbuildtoolsbyproviding specific implementations for triage knowledge preparation.
third the design of buildsheriff does not consider flaky tests.
if a flaky testistriagedintoaclusterthathasadifferentrootcausefromflaki ness andisselectedastherepresentativetestformanualinspection the root cause of the cluster will not be fixed.
therefore flaky tests could reduce the effort saving capability of buildsheriff.
to mitigatethisproblem wecanapplyflakytestdetectiontechniques e.g.
before buildsheriff.
notice that there is no failure that is due toflakinessinourevaluationdataset.last exceptionmessagesmaybenotavailableforsomefailedtests.inallthefailedtestsin80 broken builds with exception failures .
of the failed tests contain exception messages.
without such messages s3ebecomes useless.intheextremecase buildsheriffwithout s3estilloutperforms the existing methods i.e.
the fifth row in table .
related work stacktrace basedfailuretriage.
brodieetal.
usedthelongest subsequenceofcommonfunctionsinstacktracesastheindicatorofstacktracesimilaritytoidentifyre occurringfailures.toimproveit brodieetal.
andmodanietal.
removedrecursionanduninformative functions fromstack traces before stacktrace matching.
bartzetal.
proposedamachinelearningtechniquetofindsimilarstacktraces.however thistechniquerequiresfeatures e.g.
process name that are often not available in test failures in ci.
glerumetal.
proposedthecrashbucketingalgorithminwindowserrorreporting wer byanalyzingmemorydumpscollected fromusers.thistechniquerequiresknowledge e.g.
heapcorruption that are not available in test failures in ci.
kim et al.
p r o posedcrashgraphstoprovideanaggregatedviewofthestacktracesinthesamebucketinwer.differently koopaeiandhamou lhadj modeled and abstracted the stack traces in the same bucket as anautomaton.dangetal.
improvedthealgorithmin bymeasuringsimilaritybetweentwostacktraces.however itneedsto learn parameters value from historical buckets.
mozillagroupedcrashreportsbythetopfunctioninthestacktrace whichwasthenimprovedbydhaliwaletal.
.lerchandmezini compared stack traces with tf idf to group bug reports.
thesetechniquesusestacktracesimilaritytotriagecrashorbug reports.
differently our work is focused on triaging test failures foreachcibuild.inthiscontext codechangesineachbuildprovideagoodsourceofknowledgefortriage andthusweinvolvecode changesinmeasuringstacktraceandtestcodesimilarity.moreover thesetechniquesarenotapplicabletoassertionfailuresassuchfailures do not report any informative stack trace but our work does.
tothebestofourknowledge onecloselyrelatedtestfailuretriage work was recently proposed by golagha et al.
.
it targeted test failuresinci.however thistechniquewasspecificallydesignedforautomotiveindustry andthusthegeneral bughistoryandtestcase similarity features are not available in test failures in general ci.
profiling basedfailuretriage.
podgurskietal.
usedprofilesoffailureexecutionsandsuccessfulexecutionstogroupfailures.francisetal.
improveditbyrefiningtheinitialclassificationof failures.
liu et al.
measured the failure similarity on dynamic slices.
given failing and passing executions liu et al.
locatedbuglocationforeachfailure andregardedtwofailuresassimi larifroughlythesamebuglocationwassuggested.digiuseppeand jones clusteredfailureswiththesemanticconceptsthatwereexpressedintheexecutedsourcecode.golaghaetal.
clusteredfailed tests with execution profiles.
however they would impose large overhead due to profiling which are not practical for ci .
cuietal.
triagedcrashesbasedonprogramsemanticsreconstructedfrommemorydumps.phametal.
usedthesymbolicexecutiontreetoclusterfailedtests.vantonderetal.
usedtheapproximatedfixestogroupcrashes.thesetechniquesaimtoachievesemantic awarecrashtriage butwouldsufferscalabilityissueinci.
text based failure triage.
the textual information e.g.
title anddescription inbugreportsareusedtoidentifyduplicatebug reports.varioustechniqueshavebeenusedtoachievethispurpose e.g.
natural language processing machine learning information retrieval and topic modeling .however fortestfailuretriageinci thereis no such descriptive text that can be utilized.
crashanalysis.
other crash analysis methods include fault localization andfailure inducingchangeidentification crash prioritization and assignment crash reproducing and crash root cause classification .
it is interesting to explore how they can practically work in ci.
conclusions inthispaper motivatedbyourlarge scalestudyontestfailuresinci weproposeanewchange awareapproach buildsheriff totriage testfailuresineachcibuild.ourevaluationhasindicatedthatbuildsheriff can significantly improve the state of the art and be practically used in ci with a time overhead of .
seconds for a build.