mosat finding safety violations of autonomous driving systems using multi objective genetic algorithm haoxiang tian yan jiang state key lab of computer sciences at iscas university of chinese academy of sciences china tianhaoxiang20 otcaix.iscas.ac.cn jiangyan99 otcaix.iscas.ac.cnguoquan wu state key lab of computer sciences at iscas university of chinese academy of sciences university of chinese academy of sciences nanjing college joint laboratory on cyberspace security china southern power grid china gqwu otcaix.iscas.ac.cnjiren yan state key lab of computer sciences at iscas university of chinese academy of sciences china yanjiren99 otcaix.iscas.ac.cn jun wei state key lab of computer sciences at iscas university of chinese academy of sciences chongqing school university of chinese academy of sciences china wj otcaix.iscas.ac.cnwei chen state key lab of computer sciences at iscas university of chinese academy of sciences university of chinese academy of sciences nanjing college china wchen otcaix.iscas.ac.cnshuo li dan ye state key lab of computer sciences at iscas university of chinese academy of sciences nanjing institute of software technology china lishuo19 yedan otcaix.iscas.ac.cn abstract autonomous driving systems adss are safety critical systems and safety violations of autonomous vehicles avs in real traffic will cause huge losses.
therefore adss must be fully tested before deployed on real world roads.
simulation testing is essential to find safety violations of ads.
this paper proposes mosat a multi objective search based testing framework which constructs diverse and adversarial driving environment to expose safety violations of adss.
specifically based on atomic driving maneuvers mosat introduces motif pattern which describes a sequence of maneuvers that can challenge ads effectively.
mosat constructs test scenarios by atomic maneuvers and motif patterns and uses multi objective genetic algorithm to search for adversarial and diverse test scenarios.
moreover in order to test the performance of ads comprehensively during long mile driving we design a novel continuous simulation testing technique which runs the scenarios generated by multiple parallel search processes alternately in the simulator and can continuously create different perturbations to guoquan wu and dan ye are the corresponding authors.
iscas is the abbreviation of institute of software chinese academy of sciences.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse november singapore singapore association for computing machinery.
acm isbn .
.
.
.
we demonstrate mosat on an industrial grade platform baidu apollo and the experimental results show that mosat can effectively generate safety critical scenarios to crash adss and it exposes distinct types of safety violations in a short period of time.
it also outperforms state of the art techniques by finding more distinct safety violations on the same road.
ccs concepts software and its engineering search based software engineering software verification and validation .
keywords autonomous driving system safety violation multi objective genetic algorithm acm reference format haoxiang tian yan jiang guoquan wu jiren yan jun wei wei chen shuo li and dan ye.
.
mosat finding safety violations of autonomous driving systems using multi objective genetic algorithm.
in proceedings of the 30th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse november singapore singapore.
acm new york ny usa pages.
introduction autonomous driving systems adss are complicated and the safety of adss is significantly important .
therefore adss must be evaluated thoroughly before they are deployed into real world .
however testing adss in real world requires too many esec fse november singapore singapore haoxiang tian yan jiang guoquan wu jiren yan jun wei wei chen shuo li and dan ye driving miles and will take tremendous cost and time .
compared with physical tests simulation based testing provides lots of advantages such as controllable environments trying a large number of scenarios and creating dangerous scenarios without risking human life.
recently researchers have raised lots of methods to construct virtual simulative scenarios to assess adss .
a popular approach is leveraging naturalistic driving environment to construct virtual simulative scenarios .
however due to the rareness of safety critical events under naturalistic conditions this approach is inefficient.
to improve the efficiency lots of work focus on developing a set of pre crash scenarios from crash databases .
however these test scenarios are pre defined and fixed.
adss may perform well in these tests but the performance under broader conditions may not be adequately assessed1.
considering the high dimensional and complex input space of adss in order to expose safety critical scenarios effectively some recent studies apply searchbased techniques which optimize the search process towards safety critical scenarios .
most of them e.g.
define the input of a test scenario as a vector consisting of multiple variables with value ranges and apply multiobjective evolutionary algorithm to explore the input space.
however the designed scenario is simple and these techniques also cannot test adss in an evolving traffic environment in which various perturbations of traffic participants to avs can be performed to try to expose the potential safety violations of adss.
this paper proposes mosat a novel multi objective searchbased approach to ads testing.
mosat applies pareto optimality to maximize perturbations of participants behaviors to ads and diversity of generated scenarios while minimizing ettc estimation time to collision of the av to generate adversarial and diverse scenarios for exposing various safety violations of ads.
specifically in order to challenge ads effectively based on atomic maneuvers mosat introduces motif pattern which describes a sequence of driving maneuvers that can generate challenging behaviors for ads to make it have more chances to run into safety violations.
mosat runs generated test scenarios in the simulator continuously by parallel execution of multiple search processes to test the performance of adss comprehensively during the long mile driving.
we demonstrate mosat on baidu apollo an industrial grade ads platform widely used to control avs on public roads.
the experimental results show that mosat can effectively generate safety critical scenarios to crash ads and can expose distinct types of safety violations in a short period of time.
it also outperforms state of art ads testing techniques by finding more distinct safety violations on the same road.
to summarize this paper makes the following contributions we formulate our ads testing approach as a multi objective search technique considering the degree of perturbations of participants behaviors to av and the diversity of scenarios besides widely used ettc metric in existing work and can generate adversarial and diverse scenarios.
in order to expose safety violations of the ads effectively during the search based on atomic maneuvers mosat introduces motif pattern which increases the chance to disturb the ads in the generated scenarios.
we design a spatiotemporally continuous driving environment in which the scenarios generated by multiple search processes are executed alternately in the simulator to test ads comprehensively during the long mile driving.
it also improves the efficiency of simulation testing by avoiding ads reconnection and simulator reset.
we implement mosat and demonstrate its capabilities on baidu apollo an industry grade ads system and the evaluation results show that mosat can efficiently find more types of safety violations than existing ads testing techniques.
approach overview the aim of mosat is to efficiently generate adversarial and diverse safety critical scenarios to find safety violations of adss.
in the test scenario the vehicle connected to ads under test is called ego vehicle and other vehicles are called npc non player character vehicles.
variation suiteevaluate ga initializerscenario generator simulation test ads multi objective fitnessconnect mutationcrossover monitor record replay figure overall framework of mosat mosat models npc vehicles driving behaviors as low level atomic genes and high level motif genes.
an atomic gene represents the basic driving maneuver supported by the simulator e.g.
lane change acceleration while a motif gene is interpreted as a series of atomic genes driving maneuvers related to ego vehicle which can challenge ads effectively.
a scenario in mosat is characterized by a set of driving behavior sequences of npcs.
the first population is generated by randomly initialized scenarios.
based on initial scenarios mosat uses genetic algorithm to search for adversarial and diverse scenarios.
the scenarios are evaluated by multi objective fitness function which guides the search process to keep optimized parent individuals for next generation see section .
.
during the search the variation operators including crossover and mutation operators are defined to manipulate individuals.
we will explain them in detail in section .
.
mosat runs generated scenarios in the simulator.
to support testing ads continuously during long mile driving mosat runs multiple search processes in parallel and the generated multiple scenarios will be executed in the simulator alternately to create continuous perturbations to the ads under test.
mosat records the running data e.g.
the actual trajectories of npc vehicles and ego vehicle required for evaluating the fitness value of individuals and feeds the monitored data back to the corresponding search process when one scenario completes.
during the execution of the scenario in the simulator mosat checks whether the safety violation for ego vehicle will occur.
if true the running data will be 95mosat finding safety violations of autonomous driving systems using multi objective genetic algorithm esec fse november singapore singapore saved and can be replayed automatically when needed.
section describes the proposed continuous simulation testing technique.
scenario representation .
modeling driving maneuvers we useai tto denote the tthmaneuver of the ithnpc vehicle in the scenario.
the behaviors of ithnpc vehicles are determined by a sequence of ai t which is represented by i ai ai ... aim m is the number of maneuvers in the vehicle s driving.
the maneuvers are implemented and supported by svl simulator apis including accelerate decelerate follow lane and change lane.
however the driving behaviors of npc vehicles by random combinations of atomic maneuvers are very unlikely to disturb ego vehicle as the sequence of random maneuvers can make npc vehicle far away from ego vehicle during the driving and thus cannot challenge the ads under test effectively.
to address this limitation mosat introduces motif pattern based on atomic maneuvers which can make npc vehicle move close to ego and do challenging driving behaviors to create effective perturbations.
a motif gene is interpreted by a series of atomic maneuvers triggered by the relative position between the npc vehicle and ego vehicle such as ahead behind left front right front left behind and right behind.
currently we conclude four kinds of common motif patterns based on the studies of some pre crash scenarios in nhtsa in which participants near ego vehicle do specific maneuvers to challenge adss.
figure figure figure and figure shows the behavior models represented by finite state machine of four supported motif patterns in mosat which are ahead side front behind andside behind respectively.
each model characterizes the conditional maneuvers of npc vehicles in which dis the distance between npc vehicle and ego vehicle dsafe is the minimum safe distance vis the speed of npc vehicle vminis the predefined minimum speed to decelerate lis the lane where npc vehicle lies during the driving legois the lane where ego vehicle lies and ris a random value between and .
note that the driving behavior in each motif pattern will be allocated with a fixed time slot to execute and the driving maneuver will be terminated when the given time slot is consumed.
if the driving behavior in the selected motif pattern has already been completed before the time slot is exhausted the npc vehicle will continue to drive at a constant speed which is the last speed when the time slot is consumed .
figure shows the behavior model of ahead motif pattern when npc vehicle is in the front of ego vehicle on the same lane.
there are three possible driving behaviors decelerate brake and change to the adjacent lane and then back to the original lane.
all three driving behaviors have the same possibility to be triggered.
figure shows the behavior model of side front motif pattern when npc vehicle is in the front of ego vehicle on a different lane including left front and right front .
the npc vehicle first changes to the lane where ego vehicle locates and then randomly performs one of the following maneuvers decelerate change lane and brake with the same probability.
figure shows the behavior model of the behind motif pattern when npc vehicle is behind ego vehicle on the same lane.
if the distance between npc vehicle and ego vehicle d is greater than figure ahead motif pattern figure side front motif pattern the predefined safe distance dsafe which is set to speed 2sin mosat the npc vehicle will continue accelerating until dis less thandsafe.
then the npc vehicle will change to the adjacent lane and accelerate until the relative position of npc vehicle is in the left front or right front of ego vehicle.
figure behind motif pattern figure shows the behavior model of the side behind motif pattern when npc vehicle is behind ego vehicle on a different lane including left behind and right behind .
when this pattern is 96esec fse november singapore singapore haoxiang tian yan jiang guoquan wu jiren yan jun wei wei chen shuo li and dan ye triggered the npc vehicle will accelerate until its position is in the left front or right front of ego vehicle.
figure side behind motif pattern .
genetic representation of test scenario mosat perturbs the driving maneuvers of npc vehicles in an evolving environment to challenge ego vehicle in the test scenarios.
the search of the perturbations can be considered as an optimization problem that can be solved using genetic algorithm.
in mosat each test scenario corresponds to an individual in genetic algorithm.
figure shows the genetic representation of a test scenario.
c1 c2s1 chromosome chromosome 2b1 b2 m1 bi mj.
.
.atomic gene motif gene .
.
.
cn chromosome n figure the genetic representation of a test scenario each individual test scenario consists of one or more chromosomessi c1 c2 ...cn .
we encode the sequence of driving maneuvers of one npc vehicle as one chromosome consisting of atomic genes biand motif genes mj.
an atomic gene corresponds to one atomic driving maneuver and a motif gene corresponds to a series of atomic driving maneuvers specified in the motif pattern.
during the execution the motif pattern will be instantiated into a sequence of driving maneuvers motif gene according to the npc s relative position to ego vehicle as shown in section .
.
when executing driving maneuvers in the simulator for atomic gene bi the time step is set to second and for motif gene mj the time step is set to seconds.
the running time of one scenario is determined by the chromosome with the longest execution time in the individual.
when a new evolution starts mosat will create kindividuals which are initialized randomly by sequences of atomic genes and motif genes as the first population.
multi objective search to search for adversarial and diverse scenarios which can expose safety violations of ego vehicle mosat adopts a multi objective genetic algorithm nsga ii to build successfully improved paretooptimal solutions considering the following three objectives objective risk of the scenario.
it concerns the probability of a collision between ego vehicle and npc vehicles in the constructed scenario objective interference to ego vehicle.
it concerns the deviation of ego vehicle s trajectory from the planned route and the jerk of ego vehicle e.g.
emergency braking during driving objective diversities of the scenarios.
it concerns the difference of the npc vehicles trajectories in each generated test scenario with the already found safety violation scenarios.
it should be noted that these objectives are equally important and orthogonal.
a multi objective fitness function that contains the three objectives listed above is designed to determine whether the individual should be retained or eliminated.
the optimal individuals will further be variated by mutation and crossover operators during the search.
when the evolution gets stuck mosat forces a restart.
.
multi objective fitness function according to the objectives listed above the multi objective fitness function consists of the following metrics the minimal estimation time to collision mettc the deviation of ego vehicle s trajectory from planned route dfp the variation rate of ego vehicle s acceleration voa the average euclidean distance of npc vehicles trajectories for found safety violation scenarios aedf .
mettc is the metric of objective .
dfp and voa are the metrics of objective .
aedf is the metric of objective .
mosat maximizes dfp and voa for adversarial perturbations and aedf for diversities of scenarios while minimizing mettc for high collision risk.
mettc mettc of an individual is the minimal ettc between ego vehicle and npc vehicles in the scenario.
ettc is defined as the time required for a vehicle to collide with an object if both continue at their present speed and do not change their paths .
x2 y2 is the position of the npc vehicle when one gene ends and x y is the position of ego vehicle at that time x y is the estimated collision position at that time.
v2is the speed of the npc vehicle and vis the speed of ego vehicle.
1and 2is the driving angle with road direction of ego vehicle and npc vehicle.
ettc p y y x x v x y2 y1 x1tan x2tan tan tan y x2 x1 y1cot y2cot cot cot mosat calculates ettc of each gene in the individual and the minimal ettc is the mettc.
for a scenario where safety violations of ego vehicle occurs the corresponding mettc is .
the smaller the mettc the higher the fitness score.
dfp dfp is the maximal offset between the planned route and the actual driving path of ego vehicle.
in the scenario the planned route of ego vehicle is following the lane and driving at a constant speed.
according to ego vehicle s position and speed at the start time of the scenario mosat computes the position of its planned route every .
second and represents the planned driving path astre e0 e1 ... en .
mosat records actual driving path of ego vehicle as tra p0 p1 ... pn .
the calculation of dfp is dfp max t q pt.x et.x pt.y et.y the larger the dfp the higher the fitness score.
97mosat finding safety violations of autonomous driving systems using multi objective genetic algorithm esec fse november singapore singapore voa voa is the maximal acceleration change during ego vehicle s driving.
mosat records the actual speed of ego vehicle during driving and computes the acceleration every second.
the calculation is voa max t vt vt vt vt the larger the voa the higher the fitness score.
aedf mosat calculates the average euclidean distance of npc vehicles trajectories in the individual with the ones in each recorded safety violations scenario.
for the calculation of euclidean distance of two npc vehicles trajectories in different scenarios the initial position of ego vehicle is first converted to origin coordinates in the map and then the positions of npc vehicles trajectories are converted to the corresponding coordinates according to their locations relative to ego vehicle s initial position.
the larger the aedf the higher the fitness score.
mosat calculates the fitness score of one individual at the end of scenario execution.
when all the scenarios of this generation have been executed these individuals are further manipulated by variation operators see section .
to generate new candidate individuals for the next generation.
among these individuals and their parents mosat selects the top k ones as the new generation by using pareto optimality.
.
variation operators the variation operators consist of two types crossover and mutation.
we define a suite of variation operators to manipulate individuals which is shown as algorithm .
algorithm the suite of variation operators input parents p crossover probability threshold c mutation probability threshold m output population pn pn sc fori in range p do select parent individual xi p generater u ifr threshold cthen sc sc xi end if end for foreach two individuals xi xj scdo x i x j uniformcrossover xi xj pn pn x i x j end for fori in range p do select parent individual xi p ifisnotcollision xi then select gene with min ettc gm xi x i genemutation gm else generater u ifr threshold mthen x i twopointcrossover gm else x i shuffle gm end if end if x i pn x i end for return pn the crossover operator is used across individuals.
mosat randomly generates crossover rate rc for each individual anddetermines whether it will be crossed line line .
for all individuals withrc thresholdc mosat conducts uniform crossover of each two line line to improve the diversity of individuals.
the mutation operator is applied in the individuals which is more complex including gene mutation two point crossover and shuffle.
for the scenarios without collision of ego vehicle mosat selects the gene with minimal mettc to conduct gene mutation line line to improve the perturbation to ego vehicle and create more adversarial scenarios.
for the scenarios where safety violations occur mosat randomly generates mutation rate rm .
according to rm mosat conducts two point crossover rm thresholdm or shuffle rm thresholdm to increase the diversity line line .
.
.
crossover.
the variation across individuals is achieved by single point crossover of chromosomes among different individuals.
figrefcrossover shows an example of crossover operation.
for two individualss1ands2 the crossover point is chosen randomly within the number of chromosomes in one individual.
the crossover point in this example is and the child individuals s3ands4are generated by the crossover.
figure an example of crossover .
.
mutation.
mutation is the inner individual variation.
mutation operators are further classified as three types gene mutation two point crossover and shuffle.
gene mutation gene mutation is to modify one gene in one of the chromosomes of the individual.
if the gene is an atomic gene mosat modifies its parameter values or replaces it with a motif gene.
if the gene is a motif gene mosat replaces it with an atomic gene and randomly generates its parameter values including direction and speed.
figure shows an example of gene mutation for a motif gene.
figure an example of gene mutation for a motif gene two point crossover firstly two chromosomes of the individual will be randomly selected.
two random points are then chosen 98esec fse november singapore singapore haoxiang tian yan jiang guoquan wu jiren yan jun wei wei chen shuo li and dan ye on each selected chromosome and the genes between them are exchanged shown as figure .
the chromosome c1andc2in the individuals1are selected and the crossover points are p1andp2.
the genes on c1andc2betweenp1andp2are exchanged.
figure an example of two point crossover shuffle shuffle is to randomly change genes orders in each chromosome of the individual shown as figure .
there are two chromosomes c1andc2in the individual s1.
the shuffle operation ofs1will swap the gene orders randomly in the c1andc2 respectively.
figure an example of shuffle to determine the thresholds for thresholdmandthresholdc we tested different values within the range of thresholds that existing genetic algorithms recommends and chose .
for thresholdm and .
forthresholdcrespectively.
.
restart to resolve the convergence issue during the search process mosat designs restart mechanism which will be triggered by the stagnation of three consecutive generations that is the individuals in three consecutive generations keep the same during the search we regard it as a sign that the evolution is less likely to generate new safety critical scenarios .
simulation test in this step the generated scenarios by search process will be executed in the simulator.
existing search based ads testing techniques execute each generated scenario in the simulator by reconnecting ads and resetting the simulator repeatedly which has two main limitations the scenarios generated by search process are usually simple and have a short duration and cannot challenge the ads continuously for long miles driving after executing each scenario the simulator needs to reset its state and reconnect with ads which is time consuming.
according to our experiments simulator resetting and ads reconnection time will account for about two thirds of the total scenario execution time.
in order to assess the ads comprehensively in the long time driving and improve the test efficiency at the same time we design a spatiotemporally continuous driving environment in which the scenarios generated by multiple search processes are executed alternately to construct a more complex scenario as a whole that searc hprocess test simulationeach generated scenario datasearch process p1s1 p2s1 p1s2 p2s2 ... p2sn p1sn coordinate conversion execution resultexecution resulteach generated scenario datafigure the execution of simulation test.
can challenge ads continuously in one test.
figure shows the proposed scenario execution process in the simulator.
to execute the scenarios continuously mosat runs multiple search processes in parallel and it also maintains a queue that saves the scenarios generated by different search processes.
each scenario also has a process id which denotes the search process that generates it.
initially mosat starts the simulator connects with ads sets ego vehicle s starting point and spawns it to drive in the simulator.
then the scenarios saved in the queue will be executed.
mosat retrieves the scenario data from the head of the queue computes the real time position of each npc according to its relative position to ego and executes the maneuvers of npcs specified in each chromosome.
when npc vehicles finish the specified behaviors mosat feeds the recorded data positions and speeds of ego vehicle and npc vehicles from the simulator back to the corresponding search process according to process id of the scenario then mosat clears npc vehicles created by the last scenario and resets the state of ego vehicle to drive by following the current lane at constant speed if its behavior is abnormal e.g.
cannot move .
then it fetches the next scenario from the queue and computes the initial positions of npc vehicles relative to ego vehicle s current position in the simulator.
after that it spawns npc vehicles to drive according to the specified maneuvers.
before each scenario starts to execute mosat will take a snapshot of the current state of the ego vehicle e.g.
its position and speed and check whether a safety violation for ego vehicle occurs during the execution of the scenario.
if true the scenario will be saved and can be replayed automatically for failure reproduction and diagnosis in the simulator.
evaluation in this section we apply mosat to generate safety critical scenarios for testing baidu apollo an industrial grade level ads system.
to evaluate the efficiency and effectiveness of mosat we answer the following research questions.
rq1 how effective is mosat in finding safety violations of ads?
rq2 how effective and efficient is mosat to expose safety violations compared to existing state of the art techniques?
.
experiment setup we conducted the experiments on ubuntu .
with gb memory an intel core i7 cpu and an nvidia gtx2060 ti.
apollo .
and svl .
an end to end autonomous vehicle simulation platform were selected to evaluate mosat.
apollo .
is equipped with a wide range of sensors including two camera sensors one at the top and another in front of ego vehicle one 99mosat finding safety violations of autonomous driving systems using multi objective genetic algorithm esec fse november singapore singapore gps one radar and one lidar.
during the experiments all sensors are turned on.
for long mile testing of apollo we choose the sanfrancisco map with the longest roads in the svl map library to run scenarios generated by mosat shown as figure which contains various types of roads.
note that our approach is not tied to particular simulators.
now we choose svl as it supports the connection with apollo.
figure road types in evaluation .
experiment design for rq1 we run mosat to generate scenarios and evaluate the performance of the ads in the scenarios.
the collision listener is set on the ego vehicle to monitor safety violations of apollo which are then manually classified into different types based on the npc vehicles trajectories and possible design deficiencies in apollo.
for rq2 we evaluate mosat with two baselines av fuzzer and verifai .
the first baseline av fuzzer is an open source search based testing technique which uses genetic algorithm to evolve npc vehicles movements to expose safety violations of adss.
the second baseline verifai is a software toolkit for formal analysis of ai based cps cyber physical system which can generate test scenarios by optimized sampling in feature spaces to falsify the defined property.
here we use verifai to find safety violations of adss.
we run mosat verifai and av fuzzer for the same amount of time and compare their effectiveness and efficiency from the following aspects how many types of safety violations can be found?
how much time does it take to generate one scenario?
how many scenarios are generated to find a safety violation?
how long does it take at least to expose all found types of safety violations of ads under test?
how distinct are different types of safety violations?
note that to answer rq1 and rq2 we run each experiment for hours.
the experiments were repeated times considering the randomness of the approaches and the average results were computed and compared in the following.
the operational design domain in our experiments includes following conditions road road types include highway and urban way and road shapes include straights crossings t shaped curves weather sunny in daytime traffic facilities traffic lights and lane markings on roads speed limit the speed of npc vehicles on urban way is below 16m s and below m son highway.
the deceleration acceleration of npc vehicles is in .the major safety requirement that mosat concerns is that the ads under test should avoid collision with participants in scenarios.
mosat computes mettc to estimate the collision risk of the ego vehicle.
the other potential safety factors include following traffic regulations e.g.
pedestrian avoidance following lane directions and traffic lights .
to set an appropriate number of vehicles in the scenario too few npc vehicles cannot create perturbations to the av too many npc vehicles are likely to lead to collisions between npc vehicles so that they cannot fully perform the specified actions we set the number of chromosomes n in each scenario and lanenum is the number of lanes of the road.
the number of chromosomes in each scenario generated by each search process is the same.
for the number of genes in each chromosome we set the number of genesl in each chromosome as too few genes cannot create diverse and complex situations while too many genes will waste a large amount of running time.
to ensure npc vehicles have more chances to impact ego vehicle mosat sets the initial distance between npc vehicle and ego vehicle is no more than meters.
k is the number of selected optimal individuals in each generation.
to balance the search effects and evolving costs mosat randomly generates k for each search process.
.
result analysis rq1 for each run on average scenarios min and max are generated by mosat and min and max out of them have safety violations.
one safety violation of apollo occurs in generated scenarios.
based on vehicle trajectories and possible design deficiencies in apollo all safety violation scenarios are categorized into distinct types which are all revealed in the first hours of each experiment.
to study how distinct the different types of safety violation scenarios found by mosat are we calculate euclidean distances between npc vehicles trajectories across the different types of safety violation scenarios above.
the larger the distance the more different the safety violation types.
the results are shown in figure .
the minimum distance is .
meters between type and type and the maximum distance is .
meters between type and type .
the average distance between different types of safety violations is .
meters.
it can be seen that the found different types of safety violation scenarios are distinct from the perspective of npc vehicles trajectories.
before understanding the exposed potential deficiencies for the found safety violations we first introduce the main functionality of each module in apollo.
generally there are seven main modules in apollo including sensor module perception module localization module prediction module routing module planning module and control module.
the sensor module preprocesses input data and filters sensor noise.
the perception module receives data from sensor module and uses computer vision and deep learning techniques to detect static objects e.g.
lanes traffic signs and dynamic objects e.g.
vehicles in the surroundings.
the localization module provides the real time location of the av.
the prediction module predicts the behavior of all objects detected by the perception module.
the routing module generates high level navigation information based on the current location and destination of the av.
the planning module computes a safe driving trajectory for the av using the 100esec fse november singapore singapore haoxiang tian yan jiang guoquan wu jiren yan jun wei wei chen shuo li and dan ye type2 type3 type4 type5 type6 type7 type8 type9 type10 type11 type3 type4 type5 type6 type7 type8 type9 type10 type11 type4 type5 type6 type7 type8 type9 type10 type11 type5 type6 type7 type8 type9 type10 type11 type6 type7 type8 type9 type10 type11 type7 type8 type9 type10 type11 type8 type9 type10 type11 type9 type10 type11 type10 type11 type11 type type type type type type type type type type figure euclidean distances of different types of safety violations found by mosat.
output from localization and prediction modules.
the control module generates control commands e.g.
throttle brake steer angle according to the trajectory from planning module.
in the following we show an example for each type of safety violation and analyze the potential deficiencies of apollo.
example shown as figure ego vehicle rear ends the npc vehicle which is overtaking ego vehicle.
in the scenario ego vehicle is driving along the lane and an npc vehicle which has a short distance with ego vehicle cuts into the lane where ego is driving.
then the npc vehicle brakes and ego vehicle rear ends it.
the reason of this collision is that the prediction module fails to predict the intention of overtaking vehicle and the planning module fails to make control module decelerate immediately when the npc vehicle brakes in the front.
hence ego vehicle doesn t decelerate in advance to keep a safe distance with the front vehicle leading to rear end collision.
egoexample a ego a ego a figure example of 1st type of safety violation scenarios example shown as figure ego vehicle hits the npc vehicle from the side.
the npc vehicle is driving on the lane line and ego vehicle hits it from the side.
in this scenario the sensor module has sensed the npc vehicle but the perception module fails to detect the size of the npc vehicle correctly leading to the collision.
egoexample a ego a ego a figure example of 2nd type of safety violation scenarios example shown as figure ego vehicle is driving along the lane and the npc vehicle drives at a slow speed on the adjacent lane.
the npc vehicle cuts into the lane when ego vehicle drives egoexample a ego ego figure example of 3rd type of safety violation scenarios closely.
the prediction module fails to predict the future trajectory of the npc vehicle leading to the collision.
example shown as figure ego vehicle collides with a starting vehicle during the overtaking.
the perception module detects the vehicle has stopped ahead on the lane and the planning module outputs the overtaking instruction.
when ego vehicle cuts into the original lane the npc vehicle starts driving to the adjacent lane.
the perception module fails to detect the lane change action of the npc vehicle leading to the collision.
egoexample a a figure example of 4th type of safety violation scenarios example shown as figure ego vehicle collides with one of the two lane changing vehicles.
the two npc vehicles aandb are changing lanes at the same time.
the perception module detects their lane changing behaviors.
the planning module of ego vehicle reacts to the lane changing action of vehicle abut doesn t react to the lane changing action of vehicle bin time.
egoexample b a ego ego figure example of 5th type of safety violation scenarios example shown as figure the npc vehicle is driving in the front of ego vehicle on the same lane and it is decelerating during changing to the adjacent lane.
the perception module detects 101mosat finding safety violations of autonomous driving systems using multi objective genetic algorithm esec fse november singapore singapore the lane changing of the front vehicle and the prediction module predicts the npc vehicle will finish the lane changing within a short time.
therefore ego vehicle continues to drive at the current speed.
the reason for this collision is that the planning module doesn t change the planned trajectories although the perception module detects the deceleration of the npc vehicle.
egoexample a ego ego figure example of 6th type of safety violation scenarios example shown as figure the two npc vehicles aandb are driving in front of ego vehicle.
the vehicle ais on the same lane as ego vehicle and the vehicle bis on the adjacent lane.
when vehiclebis driving close to vehicle a the perception module wrongly detects the two vehicles as one vehicle on the adjacent lane making ego vehicle accelerate and collide with vehicle b. a ego egoexample a b a ego figure example of 7th type of safety violation scenarios example shown as figure the npc vehicle driving ahead changes to an adjacent lane then ego vehicle accelerates.
the npc vehicle cuts into the lane of ego vehicle when ego vehicle drives close to it.
as the prediction module fails to predict the trajectory of npc vehicle s continuous behaviors the localization module and planning module do not keep the safe distance of ego vehicle with the npc vehicle on the adjacent lane which makes too small time for ego vehicle to avoid the collision.
ego egoexample a ego a figure example of 8th type of safety violation scenarios example shown as figure two npc vehicles aandb are driving ahead of ego vehicle on the same lane.
the distance betweenaandbis small.
the perception module fails to detect vehiclebdriving ahead of vehicle a. when vehicle achanges to the adjacent lane ego vehicle accelerates and the planning module doesn t make ego vehicle decelerate immediately leading to the rear end collision.
example shown as figure ego vehicle is following vehicle awith a small distance between them and vehicle ais following vehicleb.
the vehicle bsuddenly decelerates and then vehicle a rear ends vehicle b. as the perception module of ego vehicle doesn t detect vehicle b s deceleration and the rear end between vehicle egoexample b ego b a ego b a figure example of 9th type of safety violation scenarios egoexample b a ego b a b a ego figure example of 10th type of safety violation scenarios aand vehicle b the planning module fails to react to the collision ahead in time.
example shown as figure ego vehicle tries to overtake the npc vehicle bdriving slowly ahead on the lane.
the trajectory is planned as a curvy trajectory by the planning module.
when ego vehicle enters the adjacent lane the vehicle ais accelerating from behind on the same lane which is not detected by the perception module of ego vehicle leading to the collision with a. egoexample b a b a b a figure example of 11th type of safety violation scenarios to evaluate the benefits brought by motif patterns and spatiotemporal continuous environment we implemented two variant versions of mosat called mosatmandmosats respectively.
inmosatm sequences of driving maneuvers of npc vehicles consist of only atomic maneuvers without motif patterns and chromosomes are crossed and mutated by only atomic genes.
in mosats each generated test scenario is executed separately with repeated ads connection and simulator reset.
we run mosatm andmosatsfor hours on the same roads as mosat.
table comparison results of mosatmandmosats mosatmmosats safety violation types time cost for one scenario 18s 63s number of scenarios to exp ose one safety violation93 time to find out all safety violation types15h 33h table shows the comparison result of mosatmandmosats.
mosatmexposes types of safe violations 1st 3rd 5th 7th 10th 11th .mosatmgenerates scenarios min and max and scenarios min and max are safety violation scenarios.
one safety violation occurs out of generated scenarios on average and all types of safety violations are revealed in the first hours.
102esec fse november singapore singapore haoxiang tian yan jiang guoquan wu jiren yan jun wei wei chen shuo li and dan ye it can be seen that for mosatm the safety violation exposure frequency and exposed types of safety violations are fewer than mosat.
we can conclude that motif pattern is more effective in generating safety violation scenarios and finding more types of safety violations.
on average mosatsgenerates scenarios min and max scenarios min and max out of them have safety violations.
types of safety violations are exposed by mosats and all of them are revealed in the first hours.
it can be seen that the test efficiency of mosatsis lower than mosat.
based on the experimental result we can conclude that the proposed spatiotemporal continuous environment can improve the test efficiency of scenario generation and execution.
.
result analysis rq2 we run av fuzzer and verifai on the same freeway and urban way as mosat.
in hour running verifai generates more than scenarios and av fuzzer restarts more than times and generates more than scenarios.
note that as the running time of each experiment is long enough there is little difference among the experimental results of runs.
therefore we only analyze and compare average results in the following.
we compare the three approaches from five aspects number of found safety violation types time cost for one scenario number of generated scenarios to expose one safety violation time to find all safety violation types that each tool can average euclidean distance across different types of safety violations.
figure shows the growth in the number of safety violation types found by the three approaches over time.
it can be seen that the types of safety violations found by mosat are the most.
the convergence of verifai is the fastest and the safety violation types found by verifai are the least.
the convergence speed of av fuzzer close to mosat and most types of safety violations are observed in the first hour search.
all types of safety violations are revealed in the first hour search.
3h 6h 9h 12h 15h 18h 21h 24hnumber time mosat av fuzzer verifai figure the growth in the number of found safetyviolation types over time mosat vs av fuzzer.
table shows the comparison result of mosat and av fuzzer.
av fuzzer generates scenarios in hour running min and max of them are safetyviolation scenarios min and max .
on average it takes 55seconds to generate and run a scenario and one safety violation of apollo occurs in generated scenarios.
av fuzzer finds types of safety violations and all of them occur in the first hours.
we calculate euclidean distances of npc vehicles trajectories across the types of safety violation scenarios.
we randomly select one safety violation scenario for each type and calculates the euclidean distance among them.
the calculations for mosat and av fuzzer are conducted and repeated for times respectively.
the average euclidean distance for av fuzzer is .
meters and for mosat this value is .
meters.
table comparison with av fuzzer mosat av fuzzer safety violation types time cost for one scenario 24s 55s number of scenarios to exp ose one safety violation27 time to find out all safety violation types19h 21h euclidean distance across types of savfety violations72.
.
compared with av fuzzer mosat can find more types of safety violations in apollo in a shorter time.
the safety violation exposure frequency in mosat is higher which shows that mosat can efficiently generate more adversarial scenarios.
the average euclidean distance across different types of safety violations found by mosat is larger than av fuzzer which shows that mosat can generate more diverse safety violation scenarios.
mosat generates and executes test scenarios with less time.
for mosat the time to find all types of safety violations is close to av fuzzer.
moreover all types of safety violations found by av fuzzer are all exposed by mosat 1st 3rd 7th 10th 11th .
this shows that mosat is more effective to expose different types of safety violations.
the distinctions of different types of safety violation scenarios found by mosat are also larger.
mosat vs verifai.
table shows the comparison of mosat and verifai.
verifai provides three optimized sampling algorithms to compute npc vehicles trajectories cross entropy ce bayesian optimization bo and halton ha .
in hour running of each experiment each sampling method is used to run for hours as they fall into the local optimum quickly and the results are shown as table .
table comparison with verifai ce bo ha safety violation types time cost for one scenario 54s 35s 29s number of scenarios to exp ose one safety violation3 time to find our all safety violation types0.8h .6h .5h euclidean distance across types of savfety violations26.
.
.
103mosat finding safety violations of autonomous driving systems using multi objective genetic algorithm esec fse november singapore singapore table shows the effect of the three sampling algorithms in verifai.
it can be seen that for verifai it consumes more time to generate and execute one test scenario.
the sampling algorithms make npc vehicles trajectories close to ego vehicle in all scenarios so the safety violation exposure frequency of scenarios in verifai is higher but the convergence of verifai is much faster than mosat.
however verifai only finds types of safety violations of apollo which are all discovered by mosat 3rd 4th 5th 7th .
the smaller euclidean distances across different types of safetyviolation scenarios show that the diversity of safety violations found by verifai is less than the ones found by mosat.
from the experimental result we can conclude that mosat is more effective to generate distinct critical scenarios.
discussion to increase the chance to disturb the ads in the generated scenarios we propose four types motif patterns based on four supported atomic driving maneuvers in svl simulator which can be further instantiated into nine different motif genes when running the scenario in the simulator.
it should be noted that the proposed motif patterns can be extended and we plan to investigate more atomic driving maneuvers and motif patterns in the future.
currently our approach is implemented based on svl simulator and evaluated by using baidu apollo as the connection between apollo and svl is supported officially.
although we heard that svl simulator is not supported in the future our approach does not depend on any specific simulator and it can also be applied to other popular simulators e.g.
carla as long as they provide apis to connect with industrial grade av system.
related work testing is a conventional technique to assess adss.
some studies bridge conventional testing techniques to avs .
corso et al.
inject noise into the input sensor data of avs and leverage adaptive stress testing techniques to find both vulnerabilities and failures of perception in avs.
hauer et al.
present a suitable test ending criterion and methodology for ads testing.
majzik et al.
combine various model based techniques to address the system level testing of the situation dependent behavior of avs.
tuncali et al.
design and demonstrate a testing framework that is compatible with test case generation and automatic falsification methods which are used to evaluate closed loop properties of ads.
chen et al.
propose an efficient fault injector for finding safety critical bits in ml components.
these approaches focus on assessing components i.e ai modules ml modules etc in adss.
however as an ads consists of many safety critical components that work together it is important to assess ads software end toend to understand the deficiencies of the system.
due to the huge input space and functional complexity of adss how to fully test adss have received significant attentions in recent years .
scenario based techniques are widely used in ads testing .
some researchers utilize machine learning techniques e.g.
reinforcement learning optimal sampling to find the optimum solution of test scenarios.
koren et al.
formulate the av testing as a markov decision process and use reinforcement learning algorithms to findthe most likely failure scenarios.
dreossi et al.
apply formal methods to model behaviors of systems that include artificial intelligence and machine learning in the presence of environmental uncertainty and analyze the systems.
parameters of environments are sampled in the input spaces and augmented to search for falsifications for specifications of the ads.
however existing techniques still require lots of time to optimize sampling and generated scenarios tend to be similar which is challenging to scale adss testing to such a rapidly developing av industry such as apollo which releases updates on a weekly basis .
the key task of testing adss is to create safety critical scenarios.
to find out safety violations of adss effectively and efficiently evolutionary algorithms are applied to improve the criticality of the generated test scenarios .
kluck et al.
outline the use of genetic algorithm to aim at obtaining critical scenarios that form the basis for virtual verification and validation of adss.
abdessalem et al.
provided an approach to generate critical scenarios for adss by combining multiobjective search with surrogate models developed based on neural networks.
they further propose to define a set of hybrid test objectives distance functions that combine traditional coveragebased heuristics with new heuristics specifically aimed at generating critical scenarios which can reveal feature interaction failures.
in these works the input of a test scenario is defined as a vector consisting of multiple variables with value ranges and various search based testing techniques are used to explore the input space.
different from these works av fuzzer perturbs the driving maneuvers of participants in an evolving traffic environment which generates test scenarios towards safety violation scenarios through high level variation operations.
compared with av fuzzer mosat is more effective and efficient by introducing motif pattern and spatiotemporal continuous environment.
the fitness function also considers multiple objectives to generate diverse and adversarial scenarios while single objective is designed in av fuzzer.
conclusion in this paper we propose mosat a multi objective search based testing framework for ads testing by constructing diverse and adversarial scenarios to expose safety violations of adss.
based on atomic driving maneuvers mosat introduces motif patterns to generate adversarial behaviors for avs.
mosat applies pareto optimality to maximize the perturbations to av and the diversity of generated scenarios and minimize ettc metric to effectively expose various safety violations of ads.
mosat runs the generated test scenarios in the simulator continuously by parallel execution of multiple search processes to test the performance of av comprehensively in long mile driving.
the experimental results based on an industrial grade ads system baidu apollo show that mosat can find more types of safety violations efficiently than existing state of the art techniques.