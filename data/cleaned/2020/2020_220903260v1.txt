vulcurator a vulnerability fixing commit detector truong giang nguyen singapore management university singapore singapore gtnguyen smu.edu.sgthanh le cong singapore management university singapore singapore tlecong smu.edu.sghong jin kang singapore management university singapore singapore hjkang.
phdcs.smu.edu.sg xuan bach d. le university of melbourne melbourne australia bach.le unimelb.edu.audavid lo singapore management university singapore singapore davidlo smu.edu.sg abstract open source software oss vulnerability management process is important nowadays as the number of discovered oss vulnerabilities is increasing over time.
monitoring vulnerability fixing commits is a part of the standard process to prevent vulnerability exploitation.
manually detecting vulnerability fixing commits is however time consuming due to the possibly large number of commits to review.
recently many techniques have been proposed to automatically detect vulnerability fixing commits using machine learning.
these solutions either did not use deep learning or use deep learning on only limited sources of information.
this paper proposes vulcurator a tool that leverages deep learning on richer sources of information including commit messages code changes and issue reports for vulnerability fixing commit classification.
our experimental results show that vulcurator outperforms the state of the art baselines up to .
in terms of f1 score.
vulcurator tool is publicly available at ntgiang71096 vfdetector and .yw3mn xbzdi with a demo video at ccs concepts computing methodologies supervised learning supervised learning by classification security and privacy vulnerability management .
keywords vulnerability fixing commits deep learning bert acm reference format truong giang nguyen thanh le cong hong jin kang xuan bach d. le and david lo.
.
vulcurator a vulnerability fixing commit detector.
inproceedings of the 30th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse november singapore singapore.
acm new york ny usa pages.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than the author s must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse november singapore singapore copyright held by the owner author s .
publication rights licensed to acm.
acm isbn .
.
.
.
introduction open source software oss vulnerabilities can severely damage systems.
an infamous example is the equifax data breach1 which led to millions of cases of identity theft.
another example is log4shell2 incident which led to many vulnerable cloud services and applications.
for vulnerability management the information of vulnerabilities are collected in the common vulnerabilities and exposures cve or national vulnerability database nvd .
oss users can use vulnerability information such as vulnerable version s of a specific third party library or how the vulnerability is fixed to make informed decisions e.g.
migrating the dependencies to invulnerable versions or patching their own client code.
unfortunately in practice there is often a delay between the time a vulnerability is fixed and the time it is publicly disclosed leading to a risk that oss users are unaware of vulnerabilities in their applications.
therefore oss users would benefit from a tool that automatically detect security relevant changes i.e.
vulnerabilityfixing commits that are not yet disclosed .
many existing techniques have recently proposed solutions for automatically identifying vulnerability fixing commits.
several approaches use deep learning but only consider only commit messages and code changes.
our recent work hermes combines information from commit messages code changes and issue reports however uses support vector machine svm .
in this paper we introduce vulcurator a tool using a deep learning to detect vulnerability fixing commits based on commit messages code changes and issue reports.
different from previous works vulcurator leverages bert based models to represent both text based and code based information of a commit.
specifically we use two roberta models for commit messages and issue reports respectively and a codebert model for code changes.
the output probabilities from the aforementioned classifiers are aggregated using a stacking ensemble to form the final output probability.
based on the output probability vulcuratorprovides a list of commits ranked by their likelihood of being vulnerability fixing commits.
to evaluate the performance of vulcurator we conduct an empirical evaluation on two benchmarks including the sap dataset proposed by sabetta et al.
and a newly collected dataset of tensorflow vulnerabilities.
while the former contains vulnerabilityfixing and non vulnerability fixing commits written in java sep 2022esec fse november singapore singapore truong giang nguyen thanh le cong hong jin kang xuan bach d. le and david lo and python the latter contains vulnerability fixing and non vulnerability fixing commits from tensorflow a well known deep learning framework.
we compare vulcurator with two recently proposed approaches hermes which uses support vector machine classifiers using information from commit messages code changes and issue reports and vulfixminer a deep learning model classifying code changes from commits.
our experiments show that vulcurator outperforms hermes by .
and .
on the sap and tensorflow dataset respectively and vulcurator improves over vulfixminer by .
and .
.
background and related work vulnerability fixing commit classification.
vulnerability fixing commit classification has been an active and challenging topic in software engineering research.
zhou et al.
use word2vec to represent commit messages and forward it to a k fold stacking model for classification.
zhou et al.
fine tuned codebert to transform code changes into embedding vectors and then use one layer neural network to classify commits.
sabetta et al.
and zhou et al.
proposed to train message classifier and code change classifier separately before combining them for commit classification.
the former approach uses support vector machine while the latter uses lstm and multi layer cnn.
nguyen et al.
recently proposed hermes which uses issue reports as a third source of information using an issue classifier and an issue linker.
the issue linker maps commits without explicitly linked issues to best matching issues.
bert based models.
roberta is a multi layer bidirectional transformer model which is trained on a large dataset of natural language.
codebert a variant of roberta is trained on large scale dataset consisting of bimodal data points which refer to natural language programming language pair and unimodal data points which refer to only programming language.
both roberta and codebert have shown to be effective in various tasks including vulnerability fixing classification type inference program repair program analysis or defect prediction .
3vulcurator architecture figure provides an overview of vulcurator .
our tool takes as input a json file containing a list of commits with their messages code changes and linked issues.
note that vulcurator allows commits without explicitly linked issues.
in these cases vulcurator leverages an issue linker which is built based on an issue corpus for mapping each commit to the most relevant issue in the corpus.
then vulcurator feeds each type of commit information to their the corresponding classifiers i.e.
message classifier patch classifier or issue classifier .
each classifier produces a probability indicating the likelihood of a commit being a vulnerability fixing commit.
then the predicted probabilities from three classifiers are combined using stacking ensemble to form the final probability.
issue linker.
vulcurator first recovers commit issue link for every commit without any corresponding issues as only a fraction of commits are explicitly linked to issue reports .
particularly similar from hermes vulcurator uses frlink to map each commit without any corresponding issues to its most figure overview of vulcurator similar issue in the input data based on a pre defined similarity function.
the similarity function is calculated with respect to the term frequency inverse document frequency tf idf of natural language terms and code terms in commit message code changes and issue content.
the tf idf value of every word is calculated once using tfidfvectorizer3and stored locally using pickle4for the model inference phase.
from the findings of prior work the accuracy of commit issue linking affects the classification performance.
by limiting the issue linker s similarity threshold only accurate links will be recovered.
patch classifier.
we use the same approach as vulfixminer for the patch classifier of vulcurator .
codebert5is used as the core model.
for code changes of each file the added code and removed code version of code changes are extracted separately.
the codes are tokenized using codebert tokenizer and then formed as input for codebert following the format below rem code added code where rem code and add code are the sequence of tokens of the removed code and added code respectively are special tokens given by codebert denoting the classification separation and end of sequence token respectively.
the input will tfidfvectorizer.html a vulnerability fixing commit detector esec fse november singapore singapore be forwarded to the codebert to obtain an embedding vector i.e.
vector of numerical numbers representing the semantic of code changes of each file.
finally the embedding vectors are forwarded by an aggregator followed by a neural classifier to output the final probability for each commit.
message classifier.
the message classifier leverages the multilayer bidirectional transformer model roberta .
specifically a commit message is tokenized into tokens using robertatokenizer and then forwarded into the base version of the roberta model6 and a softmax function to obtain the output probability.
issue classifier.
similar to the message classifier the issue classifier also uses the base version of roberta model.
the model takes the commit issue s title and body as inputs and outputs the predicted probability that the commit corresponding to the issue is for vulnerability fixing.
stacking ensemble and output prediction.
given the output probabilities from the three aforementioned classifiers vulcuratorleverages a logistic regression model which acts as a stacking ensemble classifier to produce the final probability for each commit.
commits with a final probability larger than a threshold will be deemed as vulnerability fixing commits.
by default the classification threshold is set as .
but vulcurator allows users to adjust the threshold see details in section .
usage .
installation user can either clone our github repository and install required dependencies or use our docker image to run vulcurator .
for full customization of vulcurator a user can follow the following steps.
.
preparation vulcurator contains a built in issue linker and pre trained classifiers which users can directly use.
however users can build their own issue linker and classifiers following instructions below.
issue linker.
user can customize issue corpus by providing a folder that contains files that store issue reports followed our predefined format see details in our github repository where each issue contains issue title issue body and issue comments optional .
given the corpus users can use their own issue linker by using the following commands python linker builder.py corpus path corpus path vulcurator models.
users can also train new classifiers for vulcurator with their own dataset by using the following command python model builder.py data path path to data note that the training dataset must follow a pre defined format which is provided on our github repository .
.
inference vulcurator provides command line interface with two modes for end users prediction andranking .
input format.
to use vulcurator users need to prepare data following our pre defined json format as below id commit id message commit message issue title issue title body issue body comments patch ... prediction mode.
in prediction mode given the input of a dataset of commits vulcurator returns a list of likely vulnerability fixing commits along with the confidence scores.
although vulcurator sets the classification threshold at .
by default vulcurator allows the threshold to be adjusted with the option threshold .
users can use the following command to obtain the results python application.py mode prediction input input path threshold threshold output output path ranking mode.
in ranking mode users can input data following our format and vulcurator will output a list of commits sorted by the probability that the commits is vulnerability fixing.
users can use the following commands python application.py mode ranking input input path output output path performance evaluation in this section we investigate the following research questions rq1.
how effective is vulcurator ?
rq2.
how much does each classifier contribute?
.
experimental setting .
.
dataset.
we empirically evaluate vulcurator using two datasets the sap dataset proposed by sabetta et al.
and a newly prepared tensorflow dataset.
for each dataset we use data for training and the remaining for testing.
sap dataset we evaluate our tool on the sap dataset which is widely used .
the dataset contains vulnerability fixing commits of widely used open source projects manually curated by sap security research over a period of four years.
non vulnerabilityfixing commits are randomly sampled with a ratio of five nonvulnerability fixing commits for one vulnerability fixing commit from the same project.
in total the dataset contains vulnerabilityfixing and non vulnerability fixing commits in which of the commits are explicitly linked to issues.
tensorflow dataset we introduce a new dataset with commits from tensorflow which is a well known deep learning library.
the purpose of the dataset is two fold.
first with the increase of vulnerabilities in deep learning libraries in recent years we would like to investigate whether vulcurator is also applicable in thisesec fse november singapore singapore truong giang nguyen thanh le cong hong jin kang xuan bach d. le and david lo table f1 score of vulcurator and hermes on sap dataset.
the number with the asterisk denotes the result of vulfixminer model message issue patch ensemble hermes .
.
.
.
vulcurator .
.
.
.
table f1 score of vulcurator and hermes on tensorflow dataset.
the number with the asterisk denotes the result of vulfixminer model message issue patch ensemble hermes .
.
.
.
vulcurator .
.
.
.
domain.
second we wish to avoid overfitting our experiments and tool design to the sap dataset.
to construct the dataset we collect all vulnerability fixing commits of tensorflow which are listed on national vulnerability database nvd up until may .
we randomly sampled non vulnerability fixing commits from tensorflow s repository using the same setting as nguyen et al.
and sabetta et al.
.
as a result our dataset contains vulnerabilityfixing and non vulnerability fixing commits.
in this dataset no commit is explicitly linked to an issue.
.
.
evaluation metrics.
similar to prior studies both precision and recall are important.
therefore we use f1 score which is the harmonic mean of precision and recall to evaluate the effectiveness of vulcurator and hermes.
in our task a true positive tp is a vulnerability fixing commit that is correctly detected.
a false positive fp is a non vulnerabilityfixing commit that is incorrectly detected as vulnerability fixing.
a false negative fn is a vulnerability fixing commit that is not detected.
precision p and recall r are computed as follows p tp tp fpr tp tp fn then the f1 score is calculated as follows f1 p r p r .
experimental result .
.
rq1 effectiveness.
to answer this question we train and test both vulcurator and hermes on the two datasets.
the experimental results are shown in tables and .
on the sap dataset all vulcurator s base models and the whole model outperform hermes s. specifically vulcurator s message issue patch classifiers and the whole model improve hermes s counterparts by .
.
.
and .
in terms of f1 respectively.
on the tensorflow dataset while vulcurator s message classifier has a decrease of .
in message classifier compared to hermes vulcurator issue classifier and patch classifier improves over hermes by .
and .
respectively leading to an overall .
improvement over hermes.
the experiment results suggest that vulcurator benefits from the use of pre trained deep learning models.
a sap dataset b tensorflow dataset figure relationship between true positive cases predicted by three base classifiers of vulcurator the patch classifier of vulcurator uses the same model as vulfixminer .
the improvement in f1 of the ensemble model over the patch classifier alone from .
to .
on sap dataset and .
to .
on tensorflow dataset shows that combining multiple sources of information allows vulcurator to outperform vulfixminer .
this result also validates the finding of nguyen et al.
that using information from the issue tracker boosts classification performance.
.
.
rq2 ablation study.
we investigate if different sources of information capture different aspects of a commit.
on the sap dataset figure.
2a out of discovered vulnerability fixing commits there are and commits that can only be exposed by message classifier issue classifier patch classifier respectively.
the similar finding is also found in tensorflow figure.
2b .
the experimental results show that each classifier helps detect unique vulnerability fixing commits.
conclusion and future work we present vulcurator a tool for detecting vulnerability fixing commits.
vulcurator combines multiple sources of information such as commit messages code changes and issue reports in a deep learning model.
in the future to better support security researchers in monitoring commits we plan to apply explainable ai techniques to provide explanations for each prediction.
acknowledgment this project is supported by the national research foundation singapore and national university of singapore through its national satellite of excellence in trustworthy software systems nsoetss office under the trustworthy computing for secure smart nation grant tcssng award no.
nsoe tss2020 .
any opinions findings and conclusions or recommendations expressed in this material are those of the author s and do not reflect the views of national research foundation singapore and national university of singapore including its national satellite of excellence in trustworthy software systems nsoe tss office .
xuan bach d. le is supported by the australian government through the australian research council s discovery early career researcher award project number de220101057vulcurator a vulnerability fixing commit detector esec fse november singapore singapore