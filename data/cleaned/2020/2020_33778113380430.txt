demystify official api usage directives with crowdsourced api misuse scenarios erroneous code examples and patches xiaoxue ren zhejiang university hangzhou zhejiang china xxren zju.edu.cnjiamou sun australian national university canberra act australia jiamou.sun anu.edu.auzhenchang xing australian national university canberra act australia zhenchang.xing anu.edu.au xin xia pilcrow monash university melbourne vic australia xin.xia monash.edujianling sun zhejiang university hangzhou zhejiang china sunjl zju.edu.cn abstract api usage directives in official api documentation describe the contracts constraints and guidelines for using apis in natural language.
through the investigation of api misuse scenarios on stack overflow we identify three barriers that hinder the understanding of the api usage directives i.e.
lack of specific usage context indirect relationships to cooperative apis and confusing apis with subtle differences.
to overcome these barriers we develop a text mining approach to discover the crowdsourced api misuse scenarios on stack overflow and extract from these scenarios erroneous code examples and patches as well as related api and confusing apis to construct demystification reports to help developers understand the official api usage directives described in natural language.
we apply our approach to api usage directives in official android api documentation and android tagged discussion threads on stack overflow.
we extract api misuse scenarios for api usage directives of classes and methods from which we generate the demystification reports.
our manual examination confirms that the extracted information in the generated demystification reports are of high accuracy.
by a user study of developers on api misuse related error scenarios we show that our demystification reports help developer understand and debug api misuse related program errors faster and more accurately compared with reading only plain api usage directive sentences.
also with ningbo research institute.
also with pengcheng laboratory.
contribute equally as co first author.
also with data61 csiro.
pilcrowcorresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
icse may seoul republic of korea association for computing machinery.
acm isbn .
.
.
.
concepts software and its engineering software libraries and repositories .
keywords api usage directive api misuse stack overflow open information extraction acm reference format xiaoxue ren jiamou sun zhenchang xing xin xia and jianling sun.
.
demystify official api usage directives with crowdsourced api misuse scenarios erroneous code examples and patches.
in 42nd international conference on software engineering icse may seoul republic of korea.
acm new york ny usa pages.
.
introduction application programming interfaces apis provide the access to the features or data of an operating system framework or other service.
official api documentation such as java api specification andandroid api reference describes the important api knowledge.
among different types of api knowledge api usage directives are contracts constraints and guidelines that specify what developers are allowed not allowed to do with the api.
a recent work by li et al.
calls such directives as api caveats because they are the knowledge that developers should be aware of to avoid api misuse.
they extract a large number of api caveats from official api documentation and organize them into an api caveats knowledge graph to improve the accessibility of api caveats knowledge.
in this work we are concerned with another important aspect of api usage directives in official api documentation i.e.
the understandability of api usage directives.
our investigation of the misuse scenarios of android apis in stack overflow questions reveal three correlated barriers that hinder the understanding of api usage directives.
first api usage directives are often abstract and lack specific usage context to illustrate when they are applicable.
second an api usage directive often involve several cooperative apis but it may be described in just one or some apis and its relationships to other apis especially newly introduced apis may not be explicitly documented.
third several apis may support similar but different features but their subtle differences are often hard to ieee acm 42nd international conference on software engineering icse icse may seoul republic of korea xiaoxue ren jiamou sun zhenchang xing xin xia and jianling sun spot or understand from api usage directives.
we identified the three barriers by observing randomly sampled stack overflow questions that mention some android apis.
as stack overflow has over million android questions it is hard to collect accurate statistics.
but the results of our approach could provide a rough estimation of the potential impact of the three barriers on correct api usage we had extracted api misuse scenarios for api usage directives of classes and methods.
section will illustrate these three barriers with concrete examples.
as our examples show these barriers often result in the overlook or misunderstanding of certain api usage directives which in turn results in api misuses.
in face of unexpected program errors caused by api misuses a common practice nowadays is to ask for help on community question and answering q a websites like stack overflow.
over time such websites have become a repository of crowdsourced api misuse scenarios erroneous code samples and patches for fixing the misuses which once discovered and attached to the corresponding official api usage directives will help to demystify convoluted official api usage directives.
in this work we design a text mining approach to achieve this objective.
we first use the api caveat extraction patterns developed in to extract the sentences describing api usage directives in official api documentation.
considering each extracted api usage directive sentence as a search query we combine the bm25 ranking and a word embedding based sentence matching to measure the macro level and micro level relevance of the api usage directive sentences and the stack overflow discussion threads a discussion thread is a question plus all its answers .
next we consider the relevant stack overflow discussion threads as the api misuse scenarios for a given api usage directive and heuristically extract high quality erroneous code examples from the questions the patches from the answers and related apis and confusing apis from the extracted erroneous code examples and patches.
finally a demystification report is generated which summarizes relevant api misuse scenarios erroneous code examples and patches and related and confusing apis for a given api usage directive.
we apply our approach to official android api documentation and android tagged discussion threads on stack overflow.
we extract api usage directive sentences for api classes and api methods.
we identify api misuse scenarios for api usage directive sentences of api classes and api methods.
for api misuse scenarios we are able to extract erroneous code examples and patches.
by the statistical sampling method we confirm that the accuracies with the error margin .
at confidence level of the extracted api misuse scenarios erroneous code examples and corresponding patches related apis and confusing apis are .
.
.
.
respectively.
we design a user study to evaluate the usefulness of the generated demystification report for api usage directives in help developers understand api usage directives and debug relevant api misuses.
our user study involves developers and erroneous code snippets caused by api misuses.
our results show that participants assisted by our demystification report can identify and debug api misuses faster and more accurately especially for complex api usage directives compared with those who are given only plain api usage directive sentences.table example of lack of specific usage context concerned api synchronousqueue concerned api usage directivethey are well suited for handoff designs in which an object running in one thread must sync up with an object running in another thread in order to hand it some information event or task.
api misuse scenariosynchronize handler creation and accessing related api s loopper handler runnable confusing api s none table example of indirect api usage directives concerned api intent.action chooser concerned api usage directivein this case the chooser action should be used to always present to the user a list of the things they can do with a nice title given by the caller such as send this photo with api misuse scenarioandroid direct shared related api s intent.createchooser sharedcompat.intentbuilder.createchooserintent confusing api s sharedcompat.intentbuilder.getintent this paper makes the following contributions by investigating the api misuse scenarios regarding api usage directives we identify three correlated barriers that hinder the understanding of api usage directives.
we design an open information extraction method to extract api misuse scenarios erroneous code example and patches from stack overflow to demystify api usage directives.
we apply our method to large scale api usage directives and stack overflow discussions and confirm the high accuracy of our information extraction method and the usefulness of the generated demystification reports for debugging api misuse related program errors.
motivating examples we now describe three examples1to illustrate the three barriers that hinder the understanding of api usage directives respectively and how the api misuse scenarios on stack overflow can help developers overcome these barriers by learning from somebody else s unfortunate mistakes related to api usage directives.
it is important to note that we organize the discussion in terms of the main barrier involved in each example but the three barriers have compound effects on api misuses.
furthermore a api usage directive may have several api misuse scenarios.
due to space limitation we show only one scenario for each example for illustration purpose.
.
lack of specific usage context according to the api reference of synchronousqueue synchronous queues support handoff designs in which an object running 1more examples can be found in our github repository.
926demystify official api usage directives with crowdsourced api misuse scenarios erroneous code examples and patches icse may seoul republic of korea table example of confusing apis with subtle differences concerned api intent.flag activity new document concerned api usage directive... whether the recent entry for it is kept after the activity is finished is different than the use of flag activity new task ifthis flag is being used to create a new recents entry then by default that entry will be removed once the activity is finished api misuse scenariohow to create the same activity multiple times to have an effect like google chrome tabs?
related api s flag activity multiple task setflags confusing api s flag activity new task in one thread must sync up with an object running in another thread in order to hand it some information event or task.
reading this abstract usage guideline developers may not realize in which part of android applications the handoff design can be useful.
the stack overflow question synchronizing handler creation and accessing illustrates a specific erroneous scenario that demands the use of the handoff design.
in this scenario the main ui thread uses the handler created in another thread to post some processing task to the message loop of that thread.
as the handler is created asynchronously to the main ui thread the handler will sometimes be null at the time the main ui thread uses it.
the accepted answer suggests that synchronousqueue is a perfect solution to solve this problem.
inspecting this erroneous scenario developers can learn not only specific usage contexts of synchronousqueue but also observe several apis looper handler runnable that are related to the use of synchronousqueue.
.
indirect api usage directives according to the api reference of intent.action chooser it should be used to always present to the user a list of things they can do .
the api reference also points out a static helper function intent.createchooser as a convenience an intent of this form can be created with the createchooser function .
however the api reference of intent.createchooser does not explicitly mention when this helper function should be used.
that is developers may not realize the api usage directive associated with intent.
createchooser which is only explained for intent.action chooser .
similarly another helper function sharecompat.intentbuilder.createchooserintent can also be used to create the intent of action chooser .
it does not explicitly mention the relevant api usage directive either.
even worse it was added in version .
.
.
the intent.action chooser description does not mention this new helper function.
the stack overflow question android direct shared illustrates an api misuse scenario in which the developer uses the wrong api sharecompat.intentbuilder.getintent but what he should use is sharecompat.intentbuilder.createchooserintent as suggested by the accepted answer.
as a result the developer cannot achieve the goal the share dialog must show the most used contacts from messaging apps like whatsapp contacts .
as the accepted answer only suggests the correct api to use the otheranswer complements the accepted answer by quoting the api usage directive of intent.action chooser to explain why createchooserintent should be used instead of getintent .
in addition there is another answer which solves the problem using intent.createchooser .
inspecting this api misuse scenario developers can observe two helper apis intent.createchooser sharecompat.intentbuilder.createchooserintent that are related to the api usage directive of intent.action chooser as well as a confusing api intentbuilder.getintent .
.
confusing apis with subtle differences then intent class declares many flags some of which have very similar names such as flag activity new document and flag acti vity new task.
although they look very similar the api reference of flag activity new document warns that ... whether the recent entry for it is kept after the activity is finished is different than the use of flag activity new ta sk if this flag is being used to create a new recents entry then by default that entry will be removed once the activity is finished .
this warning indicates some subtle difference between the two flags.
first this warning is quite convoluted second flag activity new task does not have this warning.
the question how to create the same activity multiple times to have an effect like google chrome tabs?
illustrates an exact scenario in which the developer misuses flag activity new task but should use flag activity new document instead.
this type of misuse also occurs in other questions such as how to make tasks in overview screen looks like together like chrome?
.
in the second scenario the developer made another error.
he did not realize that he not only needs to use the right new document ornew task flag but also needs to use that flag together with flag activity multiple task .
as a result his program did not work as expected although he tried each flag individually.
this cooperative usage need is described in the api reference of the three flags but the descriptions lack specific usage context.
inspecting these two api misuse scenarios developer can understand better the subtle difference between the two confusing flags new document ornew task from the errors caused by their misuses.
furthermore they can understand better the cooperative need of using them with the flag multiple task.
approach figure shows an overview of our approach which includes four main steps extract api inventory api usage directives and discussion threads from official and crowdsourced documentation finding api misuse scenarios extracting erroneous code examples and patches and generating demystification report.
.
extracting api inventory api usage directives and discussion threads our approach aims to finding api misuse scenarios in crowdsourced documentation which can be used to demystify api usage directives in official api documentation.
therefore the raw input to our approach include both official api documentation and crowdsourced documentation.
in this work we exemplify and evaluate our approach with official android api documentation and stack 927icse may seoul republic of korea xiaoxue ren jiamou sun zhenchang xing xin xia and jianling sun official api documentation data processing remove tags tokenize extracting api usage directives by li et al.
extracting api inventory api inventory api name url api usagedirective sentencesdiscussion threads filtering candidate discussion threads by api mentions stack overflow posts macro micro level relevance checking api usage sentence concerned api a list of candidate discussion threads api misuse scenariosselecting high quality code examples in questionsselecting high quality code examples in recognized answers filtering recognized answerscandidate patch s erroneous code example s patch s code matching candidate erroneous code example s recognized answers demystification report concerned api intent.action chooser concerned api usage directives in this case the chooser action should be used to always present to the user a list of the things they can do.. misuse scenario android direct shared erroneous code example intent shareintent sharecompat.intentbuilder .from getactivity .settype text plain .settext stitle n urlpost .getintent if shareintent.resolveactivity getactivity .getpackagemanager !
null startactivity shareintent patch you should use .createchooserintent instead of .getintent related api none confusing api none misuse scenario android intent action send option to only once erroneous code example intent sendintent new intent sendintent.setaction intent.action send sendintent.putextra intent.extra text text sendintent.putextra intent.extra subject subject sendintent.settype text plain patch intent sharingintent new intent android.content.intent.action send sharingintent.settype text plain sharingintent.putextra android.content.intent.extra text body.tostring startactivity intent.createchooser sharingintent share using?
related api intent.action send settype putextra createchooser extra text confusing api setaction extracting api inventory api usage directives and discussion threads finding api misuse scenarios generating demystification report extracting erroneous code examples and patches figure main steps of our approach overflow questions and answers.
android system has complex apis and android api documentation contains a large number of api usage directives .
stack overflow is the most popular community question and answering site for computer programming and it contains over .
millions android tagged questions that provides a rich source for android api misuse scenarios.
from the official android developers website we crawl both api reference anddeveloper guides web pages as of march .
we discard web page navigation content and retain the main api reference and tutorial content.
by parsing the semi structured api reference content we build an inventory of android apis.
the api inventory stores the fully qualified name of each api and its url in the android api reference website.
we use the api usagedirective extraction patterns developed by li et al.
to extract api usage directives from the crawled android api reference and develop guide documentation.
these api usage directive extraction patterns essentially look for uage directive indicating sentence patterns.
table and shows some examples of the extracted api usage directive sentences in which the directive indicators are highlighted in red.
readers are referred to for the complete list of directive indicating sentence patterns.
we use the entity linking method in to link the extracted api usage directive sentences to the corresponding apis in the api inventory.
from the latest stack overflow data dump of 4th march we collect the android tagged questions and their answers as a corpus of discussion threads.
the content of a question and all its answers is merged into a discussion thread.
the questions with no answers are discarded as they has little value for problem solving.
we retain the textual content and extract the long code snippets in pre code but remove the content in image .
long code snippets are stored separately from the textual content and are linked to the questions and answers from which they are extracted.
note that short code elements in code in text remain in text to keep the sentence integrity.
all html tags are removed from the text.
we split thetext into sentences by punctuation and use domain specific tokenizer to tokenize the sentences.
this tokenizer preserves the integrity of code like tokens and the sentence structure.
for example it treats the api connectedtread.cancel mentioned in text as a single token rather than a sequence of tokens connectedtread .
cancel .
this supports accurate detection of api mentions in stack overflow text and accurate identification of api misuse scenarios and corresponding erroneous code examples and patches.
for the extracted long code snippets we use the api linking method developed in to determine the api s used in the code snippets against the official api inventory.
we use a modified version of an antlr parser to tokenize code snippets.
.
finding api misuse scenarios given a api usage directive we try to find relevant api misuse scenarios in the corpus of stack overflow discussion threads.
the api of this given api usage directive is referred to as the concerned api.
first we detect the mentions of the concerned api in the discussion threads to narrow down the candidates.
then we combine the bm25 ranking and the word embedding based sentence matching to estimate the macro and micro level relevance of candidate discussion threads to the given api usage directive sentence respectively.
each relevant discussion thread is considered as a api misuse scenario for the given api usage directive see table table and table for examples .
a api usage directive may have multiple api misuse scenarios as illustrative in figure .
.
.
filtering candidate discussion threads by api mentions.
we detect the mentions of the concerned api in discussion threads in two ways.
first if a token in a discussion thread matches the name of the concerned api this token is considered as a mention of the concerned api.
in the informal discussions on stack overflow it is common that a class is mentioned without package name and a method is mentioned without package class name or parameters .
therefore we perform the partial name matching between 928demystify official api usage directives with crowdsourced api misuse scenarios erroneous code examples and patches icse may seoul republic of korea the tokens and the api names.
second a discussion thread may not explicitly mention the api name but it may reference the api url in the api reference website.
therefore we also examine each hyperlink in the discussion thread.
if a hyperlink matches the url of the concerned api in the api inventory this hyperlink is considered as a mention of the concerned api.
the discussion threads that mention at least once the concerned api are the candidates for finding api misuse scenarios.
.
.
determining the relevance of discussion threads to api usagedirective sentence.
we consider the given api usage directive sentence as a search query and each of the candidate discussion threads as a document in the corpus of all android tagged discussion threads.
our relevance function combines the macro level relevance by the bm25 ranking and the micro level relevance by the wordembedding based sentence matching sm w2v .
the relevance estimation considers only the textual content of the discussion threads but not the large code snippets in the discussion threads.
macro level relevance by okapi bm25 the okapi bm25 a ranking function based on the term frequency inverse documentfrequency tf idf metric.
it is simple to compute and has been widely used by search engines to rank the documents according to their relevance to the search query.
in our application of bm25 except removing regular stop words e.g.
is the we retain all other tokens in text for indexing.
letqibe a term in the search query qanddbe a document.
the correlation score of a term qiinqanddis calculated by tf qi d i.e.
the term frequency of qiin the document d. the higher the term frequency is the more relevant the document is to the query term.
the correlation score of qanddis the weighted sum of the correlation score of each query term and the document as follows scorebm25 q d n i 1idf qi tf qi d k1 tf qi d k1 b b d avgdl where d is the length of the document din tokens and avgdl is the average document length in the corpus k1andbare free parameters usually k1 andb .
.idf qi is the inverse document frequency weight of the query term qi which is computed as idf qi logn n qi .
n qi .
wherenis the total number of documents in the corpus and n qi is the number of documents containing qi.
that is the more documents contain the query term the less important the query term is towards the overall query document correlation.
we use scorebm25 q d to estimate the macro level relevance of a discussion thread dto a given api usage directive sentence q. micro level relevance by word embedding based sentence matching we learn domain specific word embeddings using the continuous skip gram model on the corpus of all androidtagged discussion threads.
the continuous skip gram model learns the word representation of each word that is good at predicting the surrounding words in the sentences in a corpus.
the learned word embeddings can capture important syntactic and semantic features of words and improve the performance of many natural language processing tasks including text retrieval we learn domainspecific word embeddings because recent studies show that domain specific word embedding outperforms general word embedding for domains specific text retrieval.
we set the word embeddingdimension at as this setting has the best performance on similar corpora in existing studies .
given a sentence s we obtain the sentence embedding vsby average pooling i.e.
average the word embeddings of the words in the sentence.
we measure the similarity of the two sentences by the cosine similarity of the two sentence embeddings.
using this method we compute the similarity of the given api usage directive sentenceqand each of the sentences sin a discussion thread d and use the highest similarity score as the micro level relevance scorew2vof the discussion thread to the given api usage directive sentence.
that is scorew2v q d maxs dcos vs vq .
combined relevance given a api usage directive qand a discussion thread d the macro level relevance scorebm25 q d indicates the relevance of the whole discussion thread to the api usage directive while the micro level relevance scorew2v q d identifies a sentence in the discussion thread that is the most relevant to the api usage directive.
finally we average the macro level relevancescorebm25 q d and micro level relevance scorew2v q d as the overall relevance.
we observe that when a discussion thread is relevant to a api usage directive the discussion thread likely discusses some misuses of the concerned api.
therefore if the overall relevance of the api usage directive and the discussion thread is above the user specified threshold we consider the discussion thread as a api misuse scenario for the api usage directive.
we empirically set the threshold at .
in our current implementation which achieves a good balance of accuracy and diversity in finding api misuse scenarios on a small validation dataset of randomly sampled api usage directives.
.
extracting erroneous code examples and patches given a api misuse scenario on stack overflow for a api usage directive we attempt to extract the erroneous code example s from the question and the patch es from the answer s .
we observe that the question in a api misuse scenario usually contains erroneous code example s which is a good practice advocated by the stack overflow community but the answers may provide code patch es or just explain the patch es in natural language e.g.
you should use createchooserintent instead of getintent .
the demystification report in figure illustrates some examples of the erroneous code examples and patches code or natural language extracted from the api misuse scenarios for intent.action chooser.
as not all code examples in stack overflow questions and answers are of good quality we adopt the heuristics developed by nasehi et al.
to extract high quality erroneous code examples and patches in api misuse scenarios.
first we check if the api misuse scenario has recognized answers.
according to a recognized answer is an accepted answer an answer with the vote greater than or an answer with the normalized vote greater than .
.
the normalized vote is calculated by x x xmin xmax xminwhere xis the vote of an answer in a discussion thread.
if the api misuse scenarios has one or more recognized answers then we use the code filters developed in to extract high quality code examples in both the question and the recognized answers.
the filters filter out too long code 120lines roughly about a4 pages which has too much distractive information and code 929icse may seoul republic of korea xiaoxue ren jiamou sun zhenchang xing xin xia and jianling sun fragments showing error information like stack traces.
the retained code snippets in the questions are candidate erroneous code examples and the retained code snippets in the recognized answers are candidate code patches.
if a recognized answer does not contain code snippets but its length is less than lines and it mentions certain apis e.g.
the accepted answer in the api misuse scenario android direct shared we use the answer text e.g.
you should use createchooserintent instead of getintent as a candidate natural language patch.
however if the answer already contains a candidate code patch its text is omitted.
letcanebe a candidate erroneous code example and canpbe a candidate patch code or natural language .
we establish the correspondence between caneandcanpbased on their similarity by bag of token matching.
bag of token matching is essentially the same as the bag of words model for information retrieval.
we call it bag of token in our work because our tokenizer preserves the integrity of code like tokens rather than split them into separate english words see section .
.
we use bag of token matching rather than code differencing commonly used for comparing programs for two reasons.
first a candidate patch can be in natural language rather than code snippet.
second code snippets on stack overflow are rather informal and often incomplete.
for example a code patch may copy modify only a small portion of erroneous code.
thus code differencing techniques designed for comparing different versions of a complete program will not work for our erroneous code examples and patches.
in this work if the similarity of caneandcanpby bag of token matching is .
we consider caneandcanpas a pair of erroneous code example and patch see figure for illustrative examples.
some program errors are caused by wrong api call sequence and the answers sometimes copy the entire code snippet in the question and change just the statement sequence.
in such cases bag of token matching gives the similarity .
however we observe that the answerers sometimes copy the entire code snippet in the question but they just discuss the copied code without changing anything in code.
in such cases the code in the answer is not really a patch to the erroneous code in the question.
so when the similarity ofcaneandcanpis we further compute their sequence similarity by the difflib tool.
if the sequence similar is also we will discard canpbut consider the corresponding answer text as a candidate patch.
.
generating demystification report finally we compose the found api misuse scenario s and the extracted pairs of erroneous code example s and code patch es if any into a demystification report for the given api usage directive and the concerned api.
figure shows an example of the demystification report.
to assist developers in understanding the demystification report we detect and highlight the code differences between the erroneous code example and the corresponding code patch if their similarity is .
.
if the patch is in natural language we highlight the api s in the erroneous code that are mentioned in the natural language patch.
furthermore we extract related apis and confusing apis from the code differences between the erroneous code example and the corresponding code patch and list these apis in the demystificationreport.
we obtain three sets of apis set1contains all apis extracted from the code differences between the erroneous code and the corresponding patch.
set2contains all apis extracted from the erroneous code.set3contains all apis mentioned in the api reference document for the concerned api e.g.
flag activity multiple task forflag activity new document createchooser forintent.
action chooser .
we consider the apis that the question askers misuse in their erroneous code but the answerers do not use in their patch as likely confusing apis.
so we identify confusing api s by set1 set2 i.e.
the apis appear in the code differences at the erroneous code side.
we further identify related apis by set1 set2 excluding the concerned api and the confusing api s .
see section and figure for examples of related apis and confusing apis extracted from api misuse scenarios.
quality of extracted information for demystification report our approach forms a demystification report to assist the understanding of a api usage directive.
the content of the demystification report is extracted from the community q a discussions on stack overflow which is informal noisy software text.
we carefully examine the quality of three types of extracted information for the demystification reports api misuse scenarios erroneous code examples and patches and related api and confusing apis.
.
experiment setup .
.
experimental datasets.
we build an api inventory from android api reference and developer guides.
we carefully verify our web crawler implementation to ensure its correctness in extracting api information from the web documentation.
using the method in we extract api usage directive sentences for api classes and api methods.
the accuracy of this api usagedirective extraction method has been evaluated in the two previous studies which extract the api usage directive sentences from the same android documentation as our study.
the reported accuracies are .
and .
in the two studies respectively.
we use the stack overflow data dump of 4th march in this study which has android tagged questions and answers.
from these discussion threads we identify api misuse scenarios for api usage directive sentences of api classes and api methods.
api usage directives have one api misuse scenario have two and have three or more.
for api misuse scenarios we are able to extract erroneous code examples and patches.
for api misuse scenarios we extract some related apis and or confusing apis.
.
.
evaluation method.
as our approach extracts large numbers of data instances i.e.
api misuse scenarios erroneous code examples and patches and related apis and confusing apis for api usage directives we adopt a statistical sampling method to examine the minimum number min of api usage directives for each type of the extracted information in the demystification report.
this sampling method ensures that the estimated accuracy is in a certain error margin at a certain confidence level.
this min can be determined by the formula min n0 n populationsize .
in the equation n0depends on the selected confidence level and 930demystify official api usage directives with crowdsourced api misuse scenarios erroneous code examples and patches icse may seoul republic of korea the desired error margin n0 z2 .
e2 wherezis a confidence level s z score and eis the error margin.
we use the error margin .
at confidence level in our evaluation.
given large numbers of api usage directives and api misuse scenarios min is approximately at this statistical setting.
the two authors independently evaluate the accuracy of the sampled data instances.
they judge whether or not a data instance i.e.
a api misuse scenario a combination of an erroneous code example and a patch a related api or a confusing api is relevant to the given api usage directive.
we compute cohen s kappa to evaluate the inter rater agreement.
for the data instances that the two authors disagree they have to discuss and come to a consensus.
based on the consensus annotations we evaluate the quality of each type of the extracted information.
.
.
evaluation metrics.
as the identification of api misuse scenarios and the identification of erroneous code examples and patches are a ranking task we use mean average precision k map k and mean reciprocal rank mrr to evaluate the effectiveness of our information extraction method for finding candidate items.
although many candidate items could be found we assume that developers would be interested in only the top relevant ones.
therefore we compute map k k .
map k can be computed bymap k q i 1avep k qi q whereqis the set of all api usage directives and avep k qi is average precision k for the i th api usage directive.
avep k qi is k j 1p j rel j rel k wherep jis the precision j rel j is if the item at rank jis relevant otherwise and rel jis the number of all relevant items at and before rank k. if all relevant items are ranked at the top of the list the map k is .
note that irrelevant items contribute to theavep k qi .
mrr is defined as mrr q i rank i q whererankiis the rank position of the first relevant item.
if the first relevant item is ranked at the top position for all q the mrr is .
in addition map k and mrr we compute the accuracy of each type of the extraction information which is the percentage of the actually relevant data instances over all the extracted data instances.
because our task is an open information extraction problem where the set of all relevant items is unknown we cannot compute recall.
.
quality of finding api misuse scenarios .
.
baseline methods.
to find relevant api misuse scenarios for a given api usage directive our approach combines the macro level relevance by the bm25 ranking and the micro level relevance by the word embedding based sentence matching sm w2v see section .
.
.
we consider using only the bm25 or the sm w2vas a baseline.
these two baselines finds api misuse scenarios for a api usage directive sentence in the same database of stack overflow discussion threads filtered by api mentions as our method.
if the similarity of a discussion thread and a api usage directive sentence is .5by the bm25 or the sm w2v we consider the discussion thread as a api misuse scenario.
furthermore we use google search and the search engine of the stack overflow website so search as the other two baselines which simulate the situation when developers search api misuse scenarios for a api usage directive sentence on the web.
we limit google search to search only the stack overflow website.
as thisstudy involves only android tagged questions we add the keyword android to the query for the google search and add android tag to the query for the so search.
google search and so search search all android tagged discussion threads without filtering discussion threads by api mentions.
we consider the top returned discussion threads as the api misuse scenarios that developers would find using these two public search engines.
.
.
results.
table reports the performance of different methods for finding candidate api misuse scenarios for the sampled api usage directives.
for these api usage directives our method finds at least one api misuse scenario.
the map k and mrr metrics are computed based on the consensus annotations by the two annotators.
the column acc.
improv.
reports the accuracy of the api misuse scenarios extracted by different methods and the improvement by our method over the baselines.
the column kappa is the inter rater agreement of the two annotator s independent annotations.
as shown in table the cohen s kappa metrics for all methods are .
which indicate at least substantial agreement between the two annotators.
stack overflow search engine performs the worst accuracy .
in finding api misuse scenarios because it uses very primitive keyword based search .
the two annotators mostly agree kappa metric achieves .
on the irrelevance of the so search results as the api misuse scenarios for api usage directives.
google and the sm w2v i.e micro level sentence matching has similar performance in ranking candidate api misuse scenarios but smw2vhas a better accuracy due to its more strict selection threshold smw2v62.
versus google search .
.
the high mrr of these two baselines suggest that the first return results are very likely to be relevant api misuse scenario.
however the decreasing map k as k increases indicates that some relevant api misuse scenarios are ranked low in the search results.
inspecting the search results by google search and the sm w2vreveals that these two baselines tend to return a diverse set of stack overflow questions which may be related to the concerned api at the sentence level but these questions may not provide relevant api misuse scenarios for the concerned api usage directive.
for example google returns at rank the question get correct referrer application on deep linking for the api usage directive note that this is not a security feature you can not trust the referrer information applications can spoof it.
of the method activity.getreferrer .
unfortunately only some part of this discussion thread explains how to use the method in the code and