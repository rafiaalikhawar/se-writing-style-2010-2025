deep learningbased featureenvydetectionboostedby real worldexamples boliu beijing institute of technology china liubo bit.edu.cnhui liu beijing institute of technology china liuhui08 bit.edu.cnguangjieli nationalinnovation institute of defensetechnology china liguangjie er .com nanniu universityof cincinnati usa nan.niu uc.eduzimao xu beijing institute of technology china zimaoxu bit.edu.cnyifan wang huaweicloud china wangyifan14 huawei.com yunni xia chongqinguniversity china xiayunni hotmail.comyuxia zhang beijing institute of technology china yuxiazh bit.edu.cnyanjiejiang beijing institute of technology china pekinguniversity china yanjiejiang bit.edu.cn abstract feature envy is one of the well recognized code smells that should be removed by software refactoring.
a major challenge in feature envy detection is that traditional approaches are less accurate whereasdeeplearning basedapproachesaresufferingfromthelack ofhigh qualitylarge scaletrainingdata.althoughexistingrefactoringdetectiontoolscouldbeemployedtodiscoverreal worldfeature envy examples the noise i.e.
non feature envy within the resulting data could signi f icantly in f luence the quality of the training dataaswellastheperformanceofthemodelstrainedonthedata.
to this end in this paper we propose a sequence of heuristic rules andadecisiontree basedclassi f ierto f ilteroutnon featureenvy reportedby state of the art refactoring detection tools.the data after f ilteringserve as the positive items in the requested training data.
from the same subject projects we randomly select methods thataredifferentfrompositiveitemsasnegativeitems.withthe real world examples both positive and negative examples we design and train a deep learning based binary model to predict whetheragivenmethodshouldbemovedtoapotentialtargetclass.
different from existing models it leverages additional features i.e.
coupling between methods and classes cbmc and the message passing coupling between methods and classes mcmc that have notyetbeenexploitedbyexistingapproaches.ourevaluationresults on real world open source projects suggest that the proposed approachsubstantiallyoutperformsthestateoftheartinfeature envy detection improving precision and recall by .
and .
respectively.
corresponding authors permissionto make digitalor hard copies of allor part ofthis work for personal or classroom use is granted without fee provided that copies are not made or distributed forpro f itorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe f irstpage.copyrightsforcomponentsof thisworkownedbyothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspeci f icpermission and or a fee.
request permissions from permissions acm.org.
esec fse december san francisco ca usa copyright held by the owner author s .
publicationrightslicensed toacm.
acm isbn ... .
concepts softwareanditsengineering softwaremaintenancetools software evolution .
keywords software refactoring feature envy code smells acm reference format bo liu hui liu guangjie li nan niu zimao xu yifan wang yunni xia yuxia zhang and yanjie jiang.
.
deep learning based feature envy detection boosted by real world examples.
in proceedings of the 31stacmjointeuropeansoftwareengineeringconferenceand symposium on the foundations of software engineering esec fse december san francisco ca usa.
acm new york ny usa 13pages.
introduction the term code smells was coined by beck and fowler to representbaddesignsinsourcecodethatmayreducethereadabilityand maintainabilityofsoftwareprojects.differentcategoriesofcode smell e.g duplicated code lazy class andlong method have been proposed and intensively studied in both industry and academic community .consideringtheprevalenceandimpactofcode smells hundredsofautomatedorsemi automatedapproacheshave been proposed to identify and resolve such code smells .
code smells also widely serve as a useful indicator of software quality andpilotlampsfor software refactorings .
feature envy is one of the most well known and well studied codesmells .methodsassociatedwithfeatureenvysmells are often called feature envy methods ormisplaced methods .
suchmethodsaremoreinterestedin featuresof otherclassesthan theirenclosing classes andthustheyshouldbe movedfrom their enclosingclassestothoseclassesthattheyareinterestedin.the movementisknownas movemethodrefactorings .featureenvy methodsoften resultinunnecessarycoupling betweenclasses increasingthedifficultyofmaintenance .tothisend researchers haveproposeddozensofapproaches toolstodetectfeatureenvy methods automatically and to recommend solutions i.e.
movemethod refactorings .
908esec fse december3 san francisco ca usa boliu huiliu guangjie li nan niu zimao xu yifanwang yunnixia yuxiazhang andyanjiejiang themostsimpleandintuitivewaytoidentifyfeatureenvymethodsistomanuallydesignasequenceofheuristicrulesandtodetect feature envy methods withsuch prede f ined rules.
well known examples include jdeodorant andjmove .
although such heuristics basedapproachesaresimpleandintuitive itisdifficult tode f inecomprehensiveandaccurateheuristicsanditisalsodif f icult to f ind the optimal setting of the thresholds that are often indispensableforheuristicrules .tothisend researchersleverage traditional machine learning techniques like svm and decision trees to automatically learn rules for feature envy detection.
although such traditional machine learning techniques havetheabilitytolearnsimplerulesfromsmalllabeleddatasets complexmappings especially nonlinear mappings fromcomplex featuresofsourcecodetothepredictionareoftenbeyondthereach ofsuchtechniques .tolearnsuchcomplexmappings rules more advanced deep learning techniques have been applied to the detection of feature envy smells .
although deep learning techniqueshavethepotentialtolearncomplexmappings theyoften requestalargenumberoflabeledhigh qualitytrainingdatathat are difficult to obtain .
the size and quality of the training data can signi f icantly in f luence the performance of the resulting models .
to this end liu et al.
collected negative items i.e.
methodsnotassociatedwithfeatureenvysmells byrandomly sampling methods in high quality open source projects assuming thatallsuchmethodsarewell placedandarenotassociatedwith feature envy smells.
based on the same assumption liu et al.
generatedpositiveitems i.e.
featureenvymethods byrandomly moving methods within high quality open source projects and the resulting methods after move method refactorings envy their original enclosing classes where they were placed before move method refactorings and thus they could be taken as feature envy methods.althoughthisnovelapproachtogeneratingtrainingdata hassuccessfullyincreasedthesizeoftrainingdatasets italsoraises serious concerns about the quality of the generated data the arbitrarily and intentionally created feature envy smells could be essentially different from those in real world projects that are createdorganicallybydevelopers.asaconclusion thechallengein feature envy detection is that traditional approaches are less accurate whereas deep learning based approaches are suffering from the lackofhigh qualitylarge scale training data.
in this paper we boost deep learning based feature envy detectionbyreal worldexamples.althoughexistingrefactoringdetectiontools e.g.
refactoringminer couldbeemployedto discoverreal world movemethodrefactoring examples thenoise i.e.
non feature envy within the resulting datacouldsigni f icantly in f luencethequalityofthetrainingdataaswellastheperformance ofthemodelstrainedonthedata.theevaluationresultsinsection con f irm that directly employing the output of refactoringminer astrainingdatawouldresultinasubstantialreductioninperformance.tothisend weproposeasequenceofheuristicrulesand adecisiontree basedclassi f ierto f ilterout potentialmovemethod refactorings that are not associatedwithfeature envy smells.
another contribution of the paper is that we design a new deep learning based model by leveraging features i.e.
coupling between methods and classes cbmc andmessage passing coupling between methodsandclasses mcmc thathavenotyetbeenexploitedbyexistingapproachesforfeatureenvydetection.thethirdcontributionisthatwedesignandleverageasequenceofheuristicsrulesbesides the deep learning based classi f ier to make the f inal decisions in feature envy detection.
we evaluate the proposed approach on f ive real world open source projects.
our evaluation results suggest that the proposed approach substantially improves the state of the art improvingprecisionandrecallby38.
and20.
respectively.
thepaper makesthe following contributions an automated approach to collecting real world feature envy examples andapubliclyavailablelarge scalehigh qualitydataset ofreal world feature envy methods.
a deep learning based approach called fetruth to detecting andresolvingfeatureenvysmells leveragingnewfeaturesnot yet employedfor this task.
an initialevaluation of the proposedapproach.
related work .
heuristics basedapproaches structuralinformationofsourcecode especiallydependencies is widelyusedinheuristics baseddetectionoffeatureenvysmells.for example tsantalis and chatzigeorgiou proposed a distancebased approach to identify move method refactoring opportunities andintegratedtheapproachintothewell knownrefactoringtool jdeodorant .
they rede f ined the jaccard distance to measurethedistancebetweenmethodsandclasses.ifamethodiscloser to a class than its enclosing class and it satis f ies a set of preconditions that enable a legal move method refactoring the method shouldbemoved.salesetal proposedasimilarity basedapproachjmovetosuggestmovemethodrefactorings.theycomputed theaveragesimilaritybetweenamethodandaclassaccordingto theirdependencies.ifamethodismoresimilartoaclassthanits enclosing class it should be moved.
mayvan et al.
p r o po s eda metric basedapproachtoidentifyfeatureenvysmells.theysummarized code metrics that have already been exploited by existing approaches for feature envy detection.
based on the resulting metrics they de f ined the formal speci f ication of feature envy smells anddetectedsmellsaccording to the metrics basedspeci f ication.
textual information is also useful for feature envy detection because the semantic information embedded in identi f iers e.g.
method names and class names represents the roles of software entities e.g.
methodsandclasses andsuchrolesarecriticalfactors for feature envy detection.
for example bavota et al.
leveraged relationaltopicmodels rtm torecommendmovemethodrefactoring opportunities by exploiting both textual information and structuralinformationtoderivesemanticandstructuralrelationships between methods.
based on such relationships the approach calledmethodbook identi f ies feature envy smells and suggests destinations for the feature envy methods.
palomba et al.
p r o posed a text based approach to detecting code smells including featureenvysmells .theyextractedtextualcontents i.e.
identi f iers and comments and normalized them by a typical information retrieval normalization process.
the normalized textual content wasemployedtocomputethe textual similaritybetweenmethods andclasses.ifamethodismoresimilartoaclassthanitsenclosing class itshould be moved.
evolutionhistoriesandrefactoring historiescouldbeexploited forthedetectionoffeatureenvysmells.forexample palombaet 909deep learning basedfeature envy detectionboostedby real worldexamples esec fse december3 san francisco ca usa al.
exploited change histories to detect feature envy smells.
theyassumedthatamethodaffectedbyfeatureenvysmellsshould changemorefrequentlytogetherwiththeenviedclassthanwiththe classwhereitisactuallyplaced.consequently ifamethodchanges more frequently together with a class than with its enclosing class the method is a feature envy method.
liu et al.
p r o p o s e da n approach to identify move method refactoring opportunities based onrefactoring histories.oncedevelopers move method u1d45aoutof class u1d436 the approach recommends moving such methods in u1d436that have the strongestrelationship andgreatestsimilaritywith u1d45a.
.
machinelearning basedapproaches kreimer employed decision tree based classi f ication to detect design f laws including feature envy smells .
fontana et al.
conducted an empirical study comparing the performance of different machine learning techniques in detecting codesmells.theirevaluationresultssuggestthatmachinelearning techniquescansigni f icantlyimprovetheperformanceofcodesmell detection.similarly amorimetal.
evaluatedtheperformance ofdecisiontree baseddetectionofcodesmells.theirexperiment results suggestthat decision trees result inthe bestperformance.
nucci et al.
replicated the study by fontana et al.
with a more realistic dataset.
however their evaluation results revealed that the high performance achieved in the previous study was due to the speci f ic characteristics e.g.
unrealistically balanceddatasetandbiasedvalidationmethods oftheselectedlimited dataset.
in contrast the effect of traditional machine learning techniques incode smelldetection islimited.
.
deeplearning basedapproaches liu et al.
are the f irst to apply deep learning techniques morespeci f ically cnnandfullyconnectednetworks tothedetectionandresolutionoffeatureenvysmells.theyexploitedtextual informationandcodemetrics i.e.
thedistancebetweenmethods andclasses asinputtoaneuralnetwork basedclassi f ierwhose output indicates whether a given method should be moved from its enclosing class to another given class.
they realized that existing datasets are too small for deep learning based techniques andthustheyproposedanovelapproachtocreatelarge scalelabeleddatasetsautomaticallybyrandomlymovingmethodsinhighquality open source projects.
their evaluation results suggest that the deep learning based approach signi f icantly outperforms the state of the art in detecting feature envy smells and in recommending solutions for feature envy methods.
barbez et al.
applied multi layerperceptions i.e.
fullyconnectedfeedforwardneural networks tothedetectionoffeatureenvysmells.besidescnnand fullyconnectednetworks otherdeep learningtechniqueshavealso been applied to the detection and resolution of feature envy smells.
hadj kacemandbouassida adopted codingcriterion and avariational autoencodertoextractthesemanticfeatures hidden in the source code which are fed to a logistic regression classi f ier to detect feature envy smells.
kurbatova et al.
exploited code2vec tocomputethesimilaritybetweensoftwareentities whichimproves the performance offeature envy detection.
cuietal.
proposedanapproachtorecommendmovemethod refactoring opportunities named rmoveby exploiting structuralandsemanticrepresentationsofcodesnippets.theyinvestigated the performance of various code embedding and graph embedding techniquesanddifferentmachine deeplearningclassi f iersinrecommendingmovemethodrefactorings.sharmaetal.
conducted anempiricalstudyondeeplearning baseddetectionofcodesmells.
they found that cnn rnn and autoencoder have been widely usedinthis f ield andthuscomparedtheperformanceofthesedeep learningtechniques indetecting feature envy smells.
theproposedapproachdiffersfromsuchapproachesintroduced in the preceding paragraphs in that it automatically collects largescalereal worldexamplesastrainingdatatoboostthedetectionand resolution of feature envy smells.
besides that it also exploits new features i.e.
cbmcandmcmc thathavenotyetbeenexploited byexisting approaches.
.
discoveringappliedsoftwarerefactorings automateddiscoveryofsoftwarerefactoringsistouncoverrefactoringsappliedbydevelopersinreal worldprojects.thebene f its of discovering such refactorings are twofold.
first it facilitates the understanding of software evolution i.e.
what kind of changes have been made and the rationale for the changes.
second the discovered refactorings may serve as a benchmark for the evaluation of approaches in refactoring recommendations.
to this end dig et al.
proposedthe f irstapproach called refactoringcrawler todiscoversoftwarerefactorings.itexploits shinglesencoding to match software entities between two successive versions of the same project and identi f ies moved deleted added modi f ied untouchedsoftwareentities.itthenleveragespre de f inedheuristic rules to identify refactorings based on the matched software entities.
for example if a method u1d45ain the older version matches method u1d45a inthelaterversionbuttheirenclosingclasses notedas classes u1d434and u1d435 donotmatch refactoringcrawler wouldreport thatthereisamovemethodrefactoringmovingmethod u1d45afromits enclosingclass u1d434to class u1d435.
prete et al.
proposed a logic programming based approach called ref finder to discover software refactorings.
ref finder encodes refactoring types into template logic rules andextractslogicfactsconcerningtwosuccessiveversionsintoa logic database.
a logic programming engine is then employed to identify refactorings by converting the logic rules into logic queriesandexecutingthequeriesonthelogicdatabase.
refdiff proposed by silva et al.
is a similarity based approach to discovering software refactorings.
it differs from other approaches in that it computes the similarity between software entities i.e.
two successive versions with a variation of the tf idf weighting scheme andaweightedjaccardcoefficient .
refactoringminer proposed by tsantalis et al.
is a state of the art approach to discovering refactorings.
the key to this approach is an ast based statement matching algorithm that does not request any user de f ined thresholds.
the algorithmaccuratelyandautomaticallymatchessoftwareentitiesbetween two successive versions.
based on the matched entities refactoringminer exploitspre de f inedrules similartothoseused byrefactoringcrawler to detect refactorings.
their evaluation results suggest that refactoringminer can signi f icantly improve the state ofthe art inrefactoring detection.
910esec fse december3 san francisco ca usa boliu huiliu guangjie li nan niu zimao xu yifanwang yunnixia yuxiazhang andyanjiejiang figure overview of theproposed approach approach .
overview anoverviewoftheproposedapproachispresentedinfig.
.for convenience wecalltheproposedapproach fetruthwhere fe is the abbreviation of feature envy and truth suggests that the approach is boosted by thetruth i.e.
real worldexamples and itcould tellyouthe truthoffeature envy.
fetruthtakes as input the evolution histories of open source projectsstoredinversioncontrolsystems e.g.
github extracts real worldfeatureenvyexamples andtrainsadeeplearning based prediction model with the extracted examples.
in the testing phase fetruthtakesasinputthesourcecodeofasoftwareprojectand generatesalistoffeatureenvysmellsassociatedwithmethodsin theproject aswellassuggestedrefactoringsolutionstoresolvethe feature envy smells.the overallprocessof fetruth isas follows fetruthminesfor potentialmovemethod refactorings by applyingrefactoringminer to the evolution histories of opensourceprojects.
fetruthremovesnon featureenvyfromthepotentialrefactorings by heuristics based f iltering and learning based f iltering.
the methods moved by the remaining move method refactorings are taken as positive samples.
methodsnotinvolvedinanypotentialmovemethodrefactorings are taken as negative samples.
with such positive and negative samples collected in the preceding steps fetruthtrains a neural network based classi f ier to predict whethera given method shouldbe moved to another class.
fetruth leverages the trained classi f ier as well as a sequence of heuristic rules to predict whether a given method in the testing projectisassociatedwith featureenvysmells .ifyes fetruthalso suggestswhichclass themethodshould be movedto.detailsofthe key steps are presentedin the following sections.
.
miningformovemethodrefactorings featureenvysmellsareoftenresolvedbymovemethodrefactorings .
consequently it is practical to discover methods associated with feature envy smells by mining for move method refactorings in open source projects.
to this end we employ refactoringminer todiscover potentialmove method refactorings.refactoringminer is selected because it is well known widely used and representing the state of the art in automated discovery mining ofsoftwarerefactorings.ittakesasinputtwo versions i.e.
a commit and its parent in the commit history of the same project compares and matches software entities between the two versions and generates a list of potential move method refactorings as well as other categories of refactorings that are ignoredby fetruth by asequenceof pre de f ineddetection rules.
although refactoringminer representsthestateoftheart not alloftheidenti f ied movemethodrefactoringsareassociatedwith feature envy smells and it also results in some false positives i.e.
theactualchangesmadearenotmovemethodrefactorings .accordingtoourempiricalstudyinsection .
upto43.
ofthereported potentialmovemethodrefactoringsarenotassociatedwithfeature envy smells or are false positives.
for convenience we call such potentialrefactoringsas non featureenvy intherestofthispaper.
toguaranteethequalityofcollectedreal worldexamples fetruth leveragesheuristics based f ilteringandclassi f ication based f iltering to identify and remove such non feature envy.
details of the f iltering are presentedin section .3and section .
respectively.
.
heuristics basedfiltering the proposed approach is to identify feature envy methods that should be moved from their enclosing classes to other classes 911deep learning basedfeature envy detectionboostedby real worldexamples esec fse december3 san francisco ca usa that they envy.
consequently for a given feature envy method it should explicitly have its enclosing class where it is and its target class where it should be moved in the same version.
however refactoringminer often reports potential move method refactoringwherethetargetclassofthemovementdoesnotexistintheold version i.e.
u1d449 u1d45b orthesourceclassdoesnotexistinthenewversion i.e.
u1d449 u1d45b .
a typical example is that when a class is moved to a different package refactoringminer may report methods within the class as moved methods where the class in the old version is noted as the source class and the same class in the new version is noted as the target class.
in this case the target class does not exist in the old version.
consequently it is unlikely for feature envy detection algorithms including the proposed approach to identify them as feature envy methods because the algorithms cannotrecommendmovingamethodtoanonexistentclass.another typical example is that when a class noted as u1d434 is merged into another class noted as u1d435 refactoringminer may report that the methods within u1d434have been moved to the merged class i.e.
class u1d435 .
in this case the source class i.e.
class u1d434 o ft h emove method refactorings donot exist in thenewversion u1d449 u1d45b .such detection isnotappropriateasfeatureenvyexamplesbecauseitisa merge classrefactoringor inlineclass refactoring insteadofasequenceof movemethodrefactorings.therefore thesepotentialmovemethod refactorings should not be part of the training data because they are not associatedwithfeature envy smells.
toexcludesuchpotentitalrefactorings weexcludeapotential move methodrefactoring if thesourceclassofthepotentialrefactoringdoesnotexistin the newversion we notethis heuristic ruleas u1d43b1 or the target class of the potential refactoring does not exist in the old version we notethis heuristic ruleas u1d43b2 .
besides the heuristic f iltering rules proposed in the preceding paragraph wealsoleverageanotherrule notedas u1d43b3 toexclude testing methods constructors overriding methods and overridden methods if the method is moved by a potential move method refactoringisatestingmethod aconstructor anoverridingmethod or an overridden method the method should not be taken as a featureenvymethod .testingmethodsareexcludedbecausetheproposed approach is specially designed for production code.
notably testingmethodsareoftensubstantiallydifferentfrommethodsin productioncode.atestingmethod locatedinatestingclass frequentlycallsmethodsandaccesses f ieldsfromtheclass notedas productclass it is testing.
as a result it inherently envies the productclass anditmaybemisclassi f iedbyfeatureenvydetection tools as a feature envy method.
to this end the proposed approach as well as other existing approaches e.g.
fedeepproposed by liu et al excludes testing methods.
constructors are excluded because they cannot be moved atall.
overriding and overriddenmethodsareexcludedbecausetheycannotbemoved across inheritance hierarchies and moving between ancestors and descendants are often taken as pull up or push down method refactoringsinsteadof movemethodrefactorings .pullup andpushdown methodrefactoringsaredesignedtoshare orconceal functionality andinterfacesamongsiblingclasses insteadofremovingfeature envy smells.
consequently the involved methods are often not associatedwithfeature envy smells.
.
learning basedfiltering besidestheheuristicsintroducedintheprevioussection wealso leveragealearning basedapproachtofurther f ilteroutnon feature envy.
more speci f ically we leverage a decision tree based classi f ier to distinguish false positives from true positives according to a sequenceoffeatures ofthe potentialmove methodrefactorings.
a potentialmove methodrefactoring isrepresentedas u1d45d u1d440 u1d447 u1d45f u1d45a u1d45a u1d460 u1d450 u1d461 u1d450 where u1d45aand u1d45a refer to the method before and after refactoring whereas u1d460 u1d450and u1d461 u1d450represent the source class and the target class of themovement.methodscalling u1d45aand u1d45a arenotedas u1d436 u1d44e u1d459 u1d459 u1d452 u1d45f u1d45a and u1d436 u1d44e u1d459 u1d459 u1d452 u1d45f u1d45a respectively.
theexploitedfeaturesofapotentialmovemethodrefactoring are explainedas follows u1d45f u1d460 u1d450 the ratio of callers to the original method that survived the movement i.e.
u1d45f u1d460 u1d450 u1d436 u1d44e u1d459 u1d459 u1d452 u1d45f u1d45a u1d436 u1d44e u1d459 u1d459 u1d452 u1d45f u1d45a u1d436 u1d44e u1d459 u1d459 u1d452 u1d45f u1d45a acallertotheoriginalmethod u1d45asurvivesthemovementifand onlyif itcalls u1d45a after themovement.
u1d45f u1d460 u1d450 the number of survived callers divided by the number of callers to u1d45a i.e.
u1d45f u1d460 u1d450 u1d436 u1d44e u1d459 u1d459 u1d452 u1d45f u1d45a u1d436 u1d44e u1d459 u1d459 u1d452 u1d45f u1d45a u1d436 u1d44e u1d459 u1d459 u1d452 u1d45f u1d45a u1d450 u1d460 u1d461 thenumberofcommonstatements matchedstatements according to refactoringminer appearing in both u1d45aand u1d45a i.e.
u1d450 u1d460 u1d461 u1d446 u1d461 u1d44e u1d461 u1d452 u1d45a u1d452 u1d45b u1d461 u1d460 u1d45a u1d446 u1d461 u1d44e u1d461 u1d452 u1d45a u1d452 u1d45b u1d461 u1d460 u1d45a where u1d446 u1d461 u1d44e u1d461 u1d452 u1d45a u1d452 u1d45b u1d461 u1d460 u1d45a represents all statementswithin method u1d45a.
u1d45f u1d450 u1d460 u1d461 thenumberofcommonstatementsdividedbythetotal number ofstatements in u1d45a i.e.
u1d45f u1d450 u1d460 u1d461 u1d450 u1d460 u1d461 u1d446 u1d461 u1d44e u1d461 u1d452 u1d45a u1d452 u1d45b u1d461 u1d460 u1d45a u1d45f u1d450 u1d460 u1d461 the numberofcommon statementsdividedbythetotal number ofstatements in u1d45a i.e.
u1d45f u1d450 u1d460 u1d461 u1d450 u1d460 u1d461 u1d446 u1d461 u1d44e u1d461 u1d452 u1d45a u1d452 u1d45b u1d461 u1d460 u1d45a features u1d45f u1d460 u1d450and u1d45f u1d460 u1d450 concern to what extent u1d45aand u1d45a share the samecallerswhereas features u1d450 u1d460 u1d461 u1d45f u1d450 u1d460 u1d461 and u1d45f u1d450 u1d460 u1d461 concern the similarity between the method bodies of u1d45aand u1d45a .
such outside features concerningthecallerstothemethods andinsidefeatures concerningthemethodbodies togethermayhelpidentifywhether u1d45a isanevolvedversionof u1d45a.notably mostofthefalsepositives reported by refactoringminer are caused byincorrect matching between u1d45aand u1d45a u1d45a issomewhatsimilarto u1d45a whichresultsin incorrectmatching but u1d45a isnotanevolvedversion of u1d45a andthus they donot form amove methodrefactoring.
withtheextractedfeatures wetrainadecisiontreetolearnhow toclassifypotentialrefactoringsintofalsepositivesandtruepositives.
it takes u1d45f u1d460 u1d450 u1d45f u1d460 u1d450 u1d450 u1d460 u1d461 u1d45f u1d450 u1d460 u1d461 u1d45f u1d450 u1d460 u1d461 as input and generates a binary output that suggests whether the given potential move methodrefactoringisassociatedwithfeatureenvysmells.decision trees are one of the most popular and commonly used machine 912esec fse december3 san francisco ca usa boliu huiliu guangjie li nan niu zimao xu yifanwang yunnixia yuxiazhang andyanjiejiang learningtechniques for classi f ication .
comparedto othermachinelearningtechniques decisiontreesareintuitive interpretable and adjustable via manual pruning to optimize classi f ication .
we do not employ more powerful deep learning techniques because theyrequestalargenumberoflabeledtrainingdatathatwedonot have.in contrast decision trees work well onsmall datasets.
.
collecting negativesamples intheprevioussections wecollectreal worldsamplesoffeature envymethodswith refactoringminer andasequenceof f iltersas introduced insections .
.
.
in this section we explain how we collectnegativesamples i.e.
methodsnotassociatedwithfeature envy smells.
such negative examples together with the positive samplesconstitutethecompletelabeledtrainingdataforfeature envy detection.
we f irst collect all methods in subject projects where positive samplesarecollected.fromsuchmethods weexcludethefollowing methods methods that cannot be moved across inheritance hierarchies e.g.
constructors overriding methods and overridden methods testing methods that are out of the scope of the proposed approach methods that violate move method refactoring preconditions provided by eclipse jdt e.g.
the target class should not inherit a method having the same signature of the moved method methods thathave beenmovedbypotential movemethodrefactoringsaccording to the detection results of refactoringminer .
the remaining methods are noted as candidate negative samples .
considering that in most high quality projects negative samples are often signi f icantly more popular than positive samples feature envy methods we conduct undersampling so that the total numberofnegativeexamplesequalsthenumberofpositivesamples.
to maximize the diversity of the negative examples we sample no more than a single method from each class and keep the same samplerateonallsubjectprojects.
.
detectionandresolutionoffeatureenvy first thefollowingmethodsareautomaticallypredictedasnegative i.e.
methodsnotassociatedwithfeatureenvysmells constructors overriding methods and overridden methods.
these methods are predicted as negative because they cannot be moved across inheritancehierarchies.forothermethods weleverageaneural network based classi f ier for automated prediction.
an overview of theclassi f ierispresentedinfig.
2anditsdetailsarediscussedas followings.
.
.
inputoftheclassifier.
theclassi f iertakesasinputamethod noted as u1d45a and a potential target class noted as u1d436 u1d461 to which the method could be legally moved.
it generates a binary prediction to suggest whether u1d45ashould be moved to u1d436 u1d461.
notably existing tools like eclipse jdt can automatically and accurately validate whether u1d45acouldbelegallymovedtotargetclass u1d436 u1d461.consequently we reuse eclipse jdt to collect all potential target classes for a given method u1d45aand leverage the classi f ier to predict whether u1d45a shouldbe movedtoany ofthe potentialtarget classes.
figure neuralnetworkbased classi f ier theinputoftheclassi f ierconsistsofbothtextualfeaturesand structuralfeatures code metrics u1d456 u1d45b u1d45d u1d462 u1d461 u1d45b u1d44e u1d45a u1d452 u1d460 u1d45a u1d452 u1d461 u1d45f u1d456 u1d450 u1d460 where u1d45b u1d44e u1d45a u1d452 u1d460consistofthree identi f iers u1d45b u1d44e u1d45a u1d452 u1d460 u1d45b u1d44e u1d45a u1d452 u1d45a u1d45b u1d44e u1d45a u1d452 u1d436 u1d460 u1d45b u1d44e u1d45a u1d452 u1d436 u1d461 where u1d45b u1d44e u1d45a u1d452 u1d45a u1d45b u1d44e u1d45a u1d452 u1d436 u1d460 u1d45b u1d44e u1d45a u1d452 u1d436 u1d461 represent the name of the method to be tested the name of its enclosing class and the name ofthepotentialtargetclass.structuralfeatures u1d45a u1d452 u1d461 u1d45f u1d456 u1d450 u1d460consistofa sequenceofcode metrics u1d45a u1d452 u1d461 u1d45f u1d456 u1d450 u1d460 u1d451 u1d456 u1d460 u1d461 u1d45a u1d436 u1d460 u1d451 u1d456 u1d460 u1d461 u1d45a u1d436 u1d461 u1d450 u1d44f u1d45a u1d450 u1d45a u1d436 u1d460 u1d450 u1d44f u1d45a u1d450 u1d45a u1d436 u1d461 u1d45a u1d450 u1d45a u1d450 u1d45a u1d436 u1d460 u1d45a u1d450 u1d45a u1d450 u1d45a u1d436 u1d461 where u1d451 u1d456 u1d460 u1d461 u1d45a u1d436 is thejaccard distance between method u1d45aand class u1d436 .let u1d446 u1d45abetheentitysetofmethod u1d45aand u1d446 u1d436bethe entity set of class u1d436 the distance between u1d45aand u1d436is de f ined as follows u1d451 u1d456 u1d460 u1d461 u1d45a u1d436 u1d446 u1d45a u1d446 u1d436 u1d446 u1d45a u1d446 u1d436 notably theentitysetofasoftwareentity e.g.
amethodoraclass includesallmethodsand f ieldsaccesseddirectlybytheentity.besidesthedistance asde f inedbyequation thathasbeenexploited by existing deep learning based approaches our approach alsoexploits cbmcandmcmc.
u1d450 u1d44f u1d45a u1d450 u1d45a u1d436 isthenumberofmethodsfromclass u1d436thatarecalleddirectlyby u1d45adividedbythetotal number ofmethodsdirectlycalledby u1d45a u1d450 u1d44f u1d45a u1d450 u1d45a u1d450 methodscalled by u1d45a methodsof u1d436 methods called by u1d45a u1d45a u1d450 u1d45a u1d450 u1d45a u1d436 isthefrequencyofinvocationsfrommethod u1d45atoclass u1d436dividedby the totalfrequency of invocations from u1d45a u1d45a u1d450 u1d45a u1d450 u1d45a u1d450 method invocations from u1d45ato u1d436 method invocations from u1d45a 913deep learning basedfeature envy detectionboostedby real worldexamples esec fse december3 san francisco ca usa .
.
architecture of the classifier.
the architecture of the classi f ier is presented in fig.
.
the textual features are f irst fed into an embedding layer to convert them into numerical vectors.
we leverage the well known and widely used word2vec a s theembeddinglayer andreusethepubliclyavailablepre trained word2vecmodel .theoutputsoftheembeddinglayer together with other structural features are fed into convolutional neural networks cnn .theoutputsofthecnnlayersaretransformed into one dimensional vectors by the following f latten layers.
such vectors are merged into a single one dimensional vector by the following mergelayer and theresulting vector isfed into a dense layer.theoutputlayergeneratesthebinaryprediction i.e.
whether u1d45ashouldbe movedfromits enclosing class to the target class u1d436 u1d461.
.
.
classifier based prediction.
for each method to be tested notedas u1d45a fetruth f irstleverages eclipsejdt tocollect potentialtargetclassestowhichthemethodcouldbelegallymoved.
notably fromthepotentialtargetclasses weremovealldataclasses thatdo not contain anymethods or contain getter settermethods and constructors only we note this heuristic rule as u1d43b4 .
such classes are specially designed to store data variables only and movingmethodstosuchclassesmaybreaktheprinciple.besides if u1d45aisan instance method i.e.
anon static method and its atarget classiscomposedofonlystaticmembers weremovethisclassfrom the target classes we note this heuristic rule as u1d43b5 .
consequently we exclude themfrom potentialtarget classes.
ifamethoddoesnothaveanypotentialtargetclass themethodis deemed negative not associated with feature envy smells we note this heuristic rule as u1d43b6 .
otherwise fetruth leverages the neural network based classi f ierrepresented in fig.
2to predictwhether themethodshouldbemovedtothegivenpotentialtargetclass.the prediction isoften interpretedas positive andthe potential target class is called candidate target class if the output is greater than .
.otherwise itisinterpretedas negative.ifthepredictionis negativeforallpotentialtargetclasses themethodisnotassociated withfeature envy smells.otherwise it is afeature envy method.
formethodspredictedaspositive fetruthalsosuggestssolutions i.e.
where they should be moved.
if method u1d45ahas only a singlecandidatetargetclass fetruth suggestsmovingthemethod to this class.
if it has multiple candidate target classes fetruth suggestsmoving u1d45atothecandidate target classthatresultsinthe largestoutputofthe classi f ier.
evaluation .
research questions the evaluation was designed to answer the following research questions rq1.canfetruth improve the state of the art in feature envy detection?
rq2.arethe f iltersproposedinsections .
.4accurateinexcluding non feature envy in potential move method refactorings reportedby refactoringminer ?
rq3.towhatextentcandata f ilteringimprovetheperformance offetruth?
rq4.to what extent can real world examples outperform randomlygeneratedtraining data inboosting fetruth?table subject projects part2 projects snapshot noc nom loc jsoup 9b40b7b csv 989c495 compress 231a466 cli 7d1363e time b9a83fb rq5.howdoesthesizeoftrainingdatain f luencetheperformance offetruth?
research question rq1 concerns whether fetruth can substantiallyoutperformexisting approachesinfeatureenvydetection.to answerthisquestion wecompare fetruthagainsttheapproach proposed by liu et al.
jdeodorant andjmove .
since liu et al.
did not explicitly name their approach we call it fedeepfor convenience in the rest of this paper.
such baseline approaches are selected for comparison because they represent the state of the art.
research question rq2 concerns the accuracy of the f ilteringintroduced insections .
.4whereas rq3concerns its in f luence on the performance of the proposed approach.
rq4 concerns the bene f its of replacing randomly generated training datawithreal worldexampleswhereasrq5concernstheimpact ofthe size ofthe training data.
.
subject projects thesubjectprojectsaredividedintotwoparts.the f irstpart noted aspart1 consisting of java projects was used to discover real worldfeature envyexamples i.e.
collection of trainingdata .
the second part noted as part2 consisting of open source java projects wasusedtoevaluatetheproposedapproachandtheselectedbaselineapproaches.
the projects inthe f irstpart were selectedfromgithub weselectedthetop500mostpopularjava projects withthelargestnumbersofstars toconstitutethe f irst part of the subject projects.
the projects in the second part were selected from defects4j .
these projects were selected because theyare fromdifferentdomainsandaredeveloped maintainedby different teams which may help to reduce the potential bias in the evaluation.
besides all of them are well known and widelyusedopen sourceprojects.table 1presentsanoverviewofthe5 javaprojectsinthesecondpartwherethe snapshot speci f iesthe version of the selected projects nocandnomrepresent the number of classes and the number of methods within the projects.
loc represents the number of sourcecode lines.
.
process first we applied refactoringminer to the selected subject projects in part1 anditreported30 599potential movemethod refactorings.fromthem werandomlysampled600potentialmove methodrefactorings andrequestedthreeexperienceddevelopers whowerefamiliarwithmovemethodrefactoringsandfeatureenvy smellstoindependentlyandmanuallymarkedthemastruepositives i.e.
movemethodrefactoringsassociatedwithfeatureenvy smells ornon featureenvy.alloftheparticipantswererequired 914esec fse december3 san francisco ca usa boliu huiliu guangjie li nan niu zimao xu yifanwang yunnixia yuxiazhang andyanjiejiang table improving thestate oftheart approach project reported accepted acceptedtargets precision accuracy destination fetruthjsoup .
csv .
compress .
.
cli time total .
.
fedeepjsoup .
csv compress .
cli time .
total .
.
jdeodorantjsoup .
csv compress cli time .
total .
jmovejsoup csv compress cli time total to have java background.
they had a median of years of programmingexperienceand3.5yearsexperiencewithsoftwarerefactoring.incaseofinconsistentlabeling thepotentialrefactorings were discussed together by the participants to reach an agreement which resulted in consistently labeled samples.
notably the three developers achieved high consistency with a fleiss kappa coefficient of0.
.thesizeofthesample guaranteeda con f idencelevelofover95 andamargin oferrorof5 .
second wetrainedthedecisiontree based f ilter aspresented insection .
withthe600manuallylabeledsamples.afterthat we leveraged the resulting decision tree based f ilter and heuristicsbased f ilter as presented in section .
to identify all positive examplesreportedby refactoringminer whichresultedin14 real worldfeatureenvymethods.wealsocollected14 209negative examplesasintroducedinsection .5tomakeupabalancedtraining dataset called rw dataset .
third we trained the proposed approach fetruth with the training data collected in the preceding paragraph.
we trained the baseline approach fedeep with equally sized training data called rg dataset where positive examples were randomly generated by fedeep onthesamesubjectprojects andnegativeexamples were consistent with those in rw dataset .
after that we applied the resulting models and other selected baseline approaches i.e.
jdeodorant andjmove tothe f iveprojectsin part2and requested three experienced developers to independently and manually validate all of the reported feature envy smells.
to reducethethreatstovalidity theparticipantsdidnotknowwhichofthe featureenvysmellswerereportedbytheproposedapproachorthe baseline approaches.
in case of inconsistency they were requested to discuss together and they reached an agreement on all items.
based on the manual validation we computed the performance of the evaluatedapproaches.
.
rq1 improvingthestate oftheart the evaluation results are presented in table .
reported presents the total number of potential feature envy smells reportedbytheevaluatedapproacheswhereas accepted presents how many of them were con f irmed according to the given ground truth.
accepted targets presents how many of the target classes recommended by the approaches were con f irmed.
precision presents the precision in smell detection.
accuracy destination presents the accuracy of the approaches in recommendingtargetclassesfor the con f irmedfeature envy methods.
from table 2we make the following observations fetruhwasaccurateindetectingfeatureenvysmells.amongthe 41items reportedby fetruh have been manuallycon f irmed resulting in a precision of .
.
fetruhwas also accurate in suggestingtargetclassesforfeatureenvymethods.for29feature envy methods it succeededin recommendingtarget classes for ofthem resultinginaprecision of .
.
fetruhsubstantially outperformed the state of the art in feature envy detection.
it resulted in the highest precision .
915deep learning basedfeature envy detectionboostedby real worldexamples esec fse december3 san francisco ca usa 1private void populateproviderwithextraprops poolingconnectionprovidercp properties props throwsexception properties copyprops newproperties copyprops.putall props ... if cpinstanceof c3p0poolingconnectionprovider copyprops.remove c3p0poolingconnectionprovider.
db max cached statements per connection copyprops.remove c3p0poolingconnectionprovider.
db validate on checkout copyprops.remove c3p0poolingconnectionprovider.
db idle validation seconds copyprops.remove c3p0poolingconnectionprovider.
db discard idle connections seconds setbeanprops cp.getdatasource copyprops listing1 example falsepositive reported by fedeep substantiallyhigherthanthatof fedeep .
jdeodorant .
and jmove .
the minimal improvement is .
.
.
.
.
fetruhalso led to the largest number of accepted items i.e.
true positives substantially larger thanthatof fedeep jdeodorant andjmove .
theproposedapproach fetruhisaccurateinsuggestingdestinationclassesforfeatureenvymethods.itsaccuracy .
is higher than that of jdeodorant and comparable to that offedeep .
and jmove .
note that all of the evaluated approaches were evaluated on thesamedataset andthustheyshouldhavethesamenumberof positives i.e.
the total number of feature envy smells .
as a result the improvement in the number of accepted items true positives equals the improvement in recall because recall true positives positives.
consequently compared to fedeep jdeodorant and jmove fetruhimprovedthe recallby .
and625 respectively.
we conclude based on the preceding analysis that fetruth substantiallyimprovedthestateoftheartindetectingandresolving feature envy smells.
in the following paragraphs we explain with exampleswhy fetruthcan outperformbaselineapproaches.
the example code in listing 1explains why fetruhsucceeded in avoiding some false positives reported by fedeep.
the methodpopulateproviderwithextraprops is from the class stdschedulerfactory in open source project quartz .fedeepreported it as a feature envy method because it accesses four f ields ofclass c3p0poolingconnectionprovider lines6 andthus it suggested moving it to class c3p0poolingconnectionprovider .
however original developers refused to move the method.
the relationship between class stdschedulerfactory and class c3p0poolingconnectionprovider followsthewidely used factory pattern wherethe factory isresponsibleforcreatingobjects whereasproviders areresponsibleforprovidingrequesteddata.
the involved method populateproviderwithextraprops initializes f ields of the created object with data from providers including the target class c3p0poolingconnectionprovider and other providers .
consequently the current decision well follows the widely used factory pattern and there is no need to move the method.
besides thetargetclass c3p0poolingconnectionprovider isdesigned to provide static f ields only and it should not contain complex operations onsuch f ields.1booleanisendoffile intc returnc extendedbufferedreader.
end of stream 5classextendedbufferedreader extendsbufferedreader static f inal int end of stream ... listing2 example true positive missed by baseline p i i n g i h i i fil i g l i g fil i g p i i n g i n g i p i i n g i p i i n g i figure filtering ofpotential move method refactorings ourapproach fetruthdidnotreportthemethodinlisting 1asa featureenvysmellbecauseitstrainingdatadidnotcontainanyrealworldfeatureenvymethodsthatshouldbemovedfromafactory class factory toaproviderclass provider .itmaysuggest thatmethodsarerarelymisplaced bydevelopers betweenfactories and providers.
however the training data automatically generated byfedeepdid contain four arti f icial feature envy methods that should be moved from factories to providers.
such unreal training dataresultedin incorrect prediction onthe methodin listing .
the example code in listing 2explains why fetruth succeeded in identifying some true positives missed by the baseline approaches.themethod isendoffile isfromtheclass lexerinopensource project commons csv .fetruth reported the method in listing2asafeatureenvysmellbecauseitstrainingdatacontained common patterns i.e.
a boolean method isendof was moved totheclasstowhichthe f ieldaccessedinitsconditionalexpression belongs .
however the training date generated randomly by fedeepdid not contain such patterns.
notably the heuristic based baseline approaches also missed the method presented in listing .
.
rq2 accurate filteringofmovemethods to answer rq2 we randomly sampled and validated out of items that have been fed into the f ilters.
the size of the sample guaranteed a con f idence level of and a margin of error of .
the manual checking was conducted by three experienced developers in the same way as they labeled training data as introducedinthe f irstparagraphofsection .
.theyachievedhigh consistency with a fleiss kappa coefficient of .
.
notably whilelabelingtheitems theparticipantsdidnotknowtherationale ofthe f iltersortheresultsofthe f ilters whichmighthelptoreduce potential bias.
the manually created labels served as the ground truthforthe evaluation of the accuracyof the f ilters.
the evaluation process and evaluation results are plotted in fig.3where negative samples are those that were reported by refactoringminer as potential move method refactorings but weredeniedmanuallybytheparticipants.suchnegativesamples 916esec fse december3 san francisco ca usa boliu huiliu guangjie li nan niu zimao xu yifanwang yunnixia yuxiazhang andyanjiejiang table3 performanceof fetruth with withoutdatafiltering metricswithout filteringwith filtering reported accepted acceptedtargets precision .
.
accuracy destination .
.
should be identi f ied and f iltered out by the proposed f ilters.
in contrast the positive samples are those that were reported by refactoringminer as potential move method refactorings and were con f irmed manually by the participants.
ideally all of the positive samples should pass the f ilters.
from fig.
3we make the following observations first a large percentage of the potential move method refactorings reported by refactoringminer was not associated with feature envy smells.
the negative items account for .
ofthe reportedsamples.
second theheuristics based f ilterwaseffectiveandaccurate.it successfully identi f ied out of the negative items whereas none ofthe 166positive items were f ilteredoutbymistake.
third thedecisiontree based f ilterwasaccurateaswell.it f iltered out out of the negative items fed into the f ilter whereas only outofthe 213positive items were misclassi f ied.
finally thetwo f ilterstogether f ilteredout98.
of the negative samples whereas only .
of the positive exampleswere f ilteredoutbymistake.
based on the preceding analysis we conclude that the f ilters proposedinthispaperhavethepotentialto f ilteroutmostofthe negative samples accurately without signi f icant loss in positive samples.consequently with refactoringminer andsuch f ilters it is practical to construct a large scale and high quality dataset of feature envy smells which in turn may boost learning based approachesto detecting andresolvingfeature envy smells.
.
rq3 impactofexample filtering to evaluate the effect of example f iltering we disabled the f iltering and repeated the evaluation keeping the testing data unchanged .
the evaluation results are presentedin table .
from table 3we make the following observations the f iltering had a substantial and positive impact on the performance in detecting feature envy smells.
enabling it improved theprecisionby31.
.
.
.
.thenumberof true positives accepted alsoincreasedslightly from to .
the f iltering substantially reduced the number of false positives i.e.
reported accepted from24 28to12 witha substantialreduction of100 .
the f iltering also had a positive impact on the accuracy of the approach in suggesting destinations for feature envy methods.
the accuracywasslightlyimprovedfrom .
to .
.
weconcludefromtheprecedinganalysisthatsimplyemploying the refactoring histories from refactoring miners without essentialtable effect ofreal world examples metricsrandomly generated datareal world examples reported accepted acceptedtargets precision .
.
accuracy destination .
f ilteringmayresultinasubstantialreductionintheperformance of feature envy detection.
this reduction stems primarily from the failureto f ilteroutmovemethodrefactoringsthatarenotassociated withfeatureenvysmellsandarefalsepositives.consequently it becomes evident that the un f iltered move method refactorings not only introduce noise into the training dataset but also hamper themodel sabilitytogeneralizeaccurately therebyreducingthe performance offeature envy detection.
.
rq4 effect ofreal worldexamples toinvestigatetheeffectofreal worldexamples wereplacedsuch exampleswithrandomlygeneratedtrainingdata i.e.
rg dataset andrepeatedtheevaluation.notably incontrasttoansweringrq1 we employ the same neural network architecture i.e.
fetruth for this evaluation.
testing data were kept untouched as well.
the evaluationresultsarepresentedintable .fromthistablewemake the followingobservations exploitingreal worldexamplessubstantiallyimprovedtheprecision of the proposed approach.
the improvement in precision is .
.
.
.
.
exploitingreal world examplesimp rovedthe numberoftruepositives accepted from25to witha substantial improvement of16 .
replacing random examples with real w orld examples improved the performance in the recommendation of target classes.
the accuracywasimprovedfrom to .
.
weconcludethatreal worldexamplesaremoreeffectivethan randomly generated training data.
this conclusion arises from the observation that applying modelstrainedonrandomlygenerated data to real world examples results in a substantial reduction in performance.thereductioncanbeattributedtothefactthatrandomly generated data often do not align with real world examples.
consequently when these models trained on such randomly generateddata aretestedonreal worldexamples theytendtoidentify fewerinstancesoffeatureenvymethodsandtheirsuggestedtarget classesare less accurate.
.
rq5 impactofdata size fig.4presents how the size of the training data in f luences the performance of the proposed approach.
from this f igure we make the followingobservations the precision of the approach in both detecting feature envy smells and recommending solutions target classes keeps increasingwiththeincreaseintrainingdata.itmaysuggestthat 917deep learning basedfeature envy detectionboostedby real worldexamples esec fse december3 san francisco ca usa precsion accuracy destination accepted accepted targets figure performanceof fetruth vs.sizeoftrainingdata theperformanceoftheproposedapproachhasthepotentialto be further improvedwithadditionaltraining data infuture.
thenumberofcon f irmedfeatureenvysmellsandthenumber of accepted target classes keeps increasing when the data size increases.
however when the size reaches of the current size therateofincreaseinthe numberbecomes relativelyslow.
based on the analysis we conclude that collecting additional training data may further improve the proposed approach.
this conclusionalignswiththeunderlyingprinciplethatasthetraining data expands the model s performance progressively improves.
thisphenomenonunderscoresthefundamentalnatureofneural networks whichrelyonlargeamountsofdataforeffectivetraining.
.
threatsto validity the f irst threat to external validity is that only a limited number ofsubjectprojectswereusedfortheevaluation.only500subject projects were used for the mining of refactorings and only f ive projectswereusedfortesting.notethatmanualvalidationofthe detection results was tedious and time consuming which significantly limited the size of the testing data.
to reduce the threat we collected projects from different domains and different development teams.
we also publish the implementation of the proposed approach to facilitate further validation on additional subjectprojects.
the second threat to external validity is that the evaluation is con f ined to java projects only.
it is unclear how the proposed approach works on other programming languages although the proposedapproachisexpectedtoworkwithanyobject oriented programming languages because it does not depend on any special characteristicsofjava.the evaluationis con f inedtojavabecause the prototype implementations of the proposed approach and the baseline approach fedeepare con f ined to java projects only and2 refactroingmineriscon f inedtojava projects.
athreattoconstructvalidityisthatthemanuallabelingofpotentialmovemethodrefactorings themanualcheckingofreported featureenvysmells andthemanualcheckingofsuggestedtarget classescouldbeinaccurate.itmightinturnresultininaccuratecalculationoftheperformanceoftheevaluatedapproaches.toreduce thethreat werequestedmultipleparticipantstolabel check the same items and computed the consistency among the participants.
theresultingkappacoefficientssuggestthattheyresultedinahigh levelofconsistency.besides wedidnottellthemtherationaleof theproposedapproach andtheydidnotknowwhichapproaches had reported the potential smells or suggested the target classes.
allofthesemighthelpreduce the bias.
conclusionsand futurework detection and resolution of feature envy smells have been wellstudied and dozens of such approaches have been proposed.
although deep learning techniques have been proven useful in automateddetectionandresolutionoffeatureenvysmells the qualityoftherandomlygeneratedtrainingdataispreventingthem from reaching the maximal potential.
to this end in this paper we boost deep learning based feature envy detection approaches with real world examples.
we propose a heuristics based f ilter and a learning based f ilter to exclude false positives reported by refactoringminers andmanagetogeneratehigh qualityandlarge scale training data for feature envy detection.
we design a new deep learning based classi f ier leveraging new features not yet exploited by existingapproaches and employ the resulting classi f ier as well as asequenceofheuristics rulesto detectfeature envy smellsand to generate solutions for detected smells.
our evaluation results onreal worldopen sourceprojectssuggestthattheproposedapproachsubstantiallyoutperformsthestateoftheartinthedetection and resolution of feature envy smells improving the precision and recallinfeature envy detection by38.
and20.
respectively.
similar to the state of the art feature envy smell detection tools e.g.
fedeep jdeodorant andjmove fetruthonlydetectsmisplaced methods that should be moved from their enclosing classes tootherclassestheyenvy.althoughsuchfeatureenvymethodsare thekeyconcernforcurrentfeatureenvydetectionandresolution tools algorithms there is another category of feature envy only a small part of the method should be extracted and moved outside theenclosingclass.weplantogeneralizetheproposedapproach to dealwithsuch feature envy smellsinfuture.
fetruthwassponsoredbyhuawei oneoftheleadingitcompanies in the world and it has been successfully deployed in the company.notably weadoptaclient serverarchitecture putting all deep learning related modelson aserver deployedwithin the company andintegratingothermodelsintoaplug inoftheide to avoid any deep learning computation on client sides i.e.
pcs of softwaredevelopers .asaresult fortheendusers fetruthisas simple as the traditional heuristics based detection tools and no deeplearninglibrariesordevices are required.we wouldliketo reportdetailedusageofthetoolwithinthecompany andpotentially othercompanies inthe near future.
the large scalehigh qualitydatasetofreal worldfeatureenvy examples constructed in this paper is an important contribution of thispaper.itmayinspireandboostotherlearning basedapproaches tofeatureenvydetectioninfuture.wealsoplaninfuturetofurther enlarge the dataset by mining additional evolution histories of high qualityopen sourceprojects.
data availability thereplicationpackage includingthetoolsandthedata ispublicly available .