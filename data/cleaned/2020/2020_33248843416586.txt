synthesis of infinite state systems with random behavior andreas katis katis001 umn.edu university of minnesota usagrigory fedyukovich grigory cs.fsu.edu florida state university usajeffrey chen chen4233 umn.edu university of minnesota usa david greve david.greve collins.com collins aerospace usasanjai rayadurgam rsanjai umn.edu university of minnesota usamichael w. whalen whalen cs.umn.edu university of minnesota usa abstract diversity in the exhibited behavior of a given system is a desirable characteristic in a variety of application contexts.
synthesis of conformantimplementationsoftenproceedsbydiscoveringwitnessing skolem functions which are traditionally deterministic.
in this paper we present a novel skolem extraction algorithm to enable synthesisofwitnesseswithrandombehavioranddemonstrateits applicability in the context of reactive systems.
the synthesized solutions are guaranteed by design to meet the given specification while exhibiting a high degree of diversity in their responses to externalstimuli.casestudiesdemonstratehowourproposedframework unveils a novel application of synthesis in model based fuzz testing to generate fuzzers of competitive performance to generalpurpose alternatives as well as the practical utility of synthesized controllers in robot motion planning problems.
acm reference format andreas katis grigory fedyukovich jeffrey chen david greve sanjai rayadurgam and michael w. whalen.
.
synthesis of infinite state systems with random behavior.
in 35th ieee acm international conference onautomatedsoftwareengineering ase september21 virtual event australia.
acm new york ny usa pages.
.
introduction programsynthesis aimsatautomatedgenerationofimplementations that meet formal specifications.
it has been thoroughly explored in various contexts such as controller synthesis and automatedprogram repair .
the implementations are generatedfromofthespecification srealizabilityandhavetheform ofdeterministic witnesses.
thus by design they always compute an output that meets the specification and the same output for each particular input.
determinism however prevents us from synthesizingsystemsthattakeadvantageof randomness todiversify their behavior1.
advantages offered by these systems can be better 1for the sake of brevity throughout the paper we refer to such systems using the adjective random e.g.randomsystem design witness controller .
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
ase september virtual event australia association for computing machinery.
acm isbn ... .
when put into context of robot motion planning and fuzz testing.
fuzz testing .synthesisofrandomdesignsallowsonetospecifyandcreatesystem specific fuzzers .theideaistofollowa mindsetsimilartohow model basedtesting techniquesutilizethe system under test sut specificationtogeneratetestcases .
we propose to use the fragment of the model related to the sut inputstosynthesizeafuzzerthatrepeatedlygeneratesrandom and sometimes malformed tests.
this fragment can be alternatively viewed as the fuzzer s specification which can be further enriched withpropertiesthatdictateitsbehaviorwhencertaintestingobjectivesaremet.forexample whenavulnerabilityisdetected wecan limit the fuzzer s next generated test cases within a desired range around the test that exposed the issue.
system coverage is also one such objective where we can dictate how the fuzzer diversifies the generated tests through its specification improving the chances of reachingpreviouslyunexploredsystemstates.fromaqualitative standpoint synthesis in model based fuzz testing can be consideredasaviablehigh levelsolutionthatdoesnotrequiretheuser to createextensive corpora oftests.
furthermore thesynthesized fuzzerscanbeastrong sut specificalternativetogeneral purpose model based fuzzers.
.
robotmotion planning .
in coverage path planning problems the goal is to maximize the area that a robot can cover while avoiding obstacles .
furthermore randomness canserve asan additional security barrier in avoidance games that involve adversaries with learning capabilities.
a random strategy is inherently harder toinferandexploit.inthespecialcaseofinfinite stateproblems it is an even bigger challenge as the current state of the art in automata learning is limited to finite state problems .
wetreatsystemsintheaforementionedapplicationsasso called reactive systems which have to exhibit specification compliant behavioragainstanunpredictableenvironment.examplesarecommonlyfoundinaviation autonomousvehicles andmedicaldevices.
synthesis of random reactive designs is offered by the recent reactive control improvisation rci framework but limited onlytofinite statesystems i.e.
overthebooleandomain relies on probabilistic analysis to determine the realizability of the specification anditssynthesizedwitnessesrequirefurtherrefinement to be applicable in real world scenarios.
we present a novel approach to synthesis of random infinitestate systems whose corresponding specifications may involve constraints over the linear integer or real arithmetic theories lira andthusnotlimitedtofinite statesystems.theintuition behindthiseffortistoallowreasoning andconsequentlysynthesis 35th ieee acm international conference on automated software engineering ase ase september virtual event australia andreas katis grigory fedyukovich jeffrey chen david greve sanjai rayadurgam and michael w. whalen over ranges of safe reactions instead of computing witnesses with deterministic responses.
the pursuit of generality poses new challenges for which we propose a novel skolemization procedure tosimulate randomness.
we build on top of state of the art reactive synthesis approach for deterministicsystemscalledjsyn vg .ititerativelygenerates a greatest fixpoint over system states that ensures the realizabilityofthegivenspecificationbutoffersonlyabruteandinflexible strategyforwitnessextraction viapredeterminedskolemization rules .
our key novelty is in a new algorithm that enables replacing deterministic assignments in the skolem functions with applicationsof uninterpretedrandomnumbergenerators.uninterpretedfunctionsallowustoreasonaboutsolutionswithrandom broad and most importantly compliant behavior.
thenewskolemextractionalgorithmpreservesjsyn vg simportantproperties.thus theprocedureremainscompletelyautomated unlikepreviousworkoninfinite statesynthesisthatrequiresadditional templates or the user s intervention .
more importantly our work imposes no performance overheads over jsyn vg remaining thus competitive with other state of the art tools which could be considered for random synthesis .
we implementedtheskolemextractionalgorithmandapplieditintwo distinct case studies.
model based fuzz testing .
we are the first to explore the applicability of reactive synthesis in fuzz testing.
on a chosen set of applications designed forthe darpa cyber grand challenge the synthesized fuzzers performed competitively against wellestablished tools afl aflfast both in terms of code coverage as well as exposing vulnerabilities.robot motion planning .
we synthesized safe robot controllers thatparticipateinavoidancegamesonbothboundedandinfinite arenas.
using simulation we show how the synthesized controller leads to the robot being capable of avoiding its adversary while moving in random patterns.
we demonstrate how the synthesized strategiesaresafebydesign nomatterwhatbiasisintroducedatthe implementation level.
furthermore we showcase why randomness in the controller behavior is a mandatory feature if synthesis is to be considered for coverage path planning problems.
to summarize the contributions of this work are squaresolidthe first complete formal framework that enables specification and synthesis of random infinite state reactive systems squaresolidanovelskolemizationprocedurethatenablesrandomsynthesis withnoperformanceoverhead bytakingadvantageofuninterpreted functions to reason about ranges of valid reactions squaresolida novel application of synthesis in model based fuzz testing where we generated reactive fuzzers yielding competitive results in terms of system coverage and vulnerability detection and squaresolidthe application of synthesized random controllers in safety problems for robot motion planning outlining important advantages over deterministic solutions.
therestofthepaperisstructuredasfollows.sect.2providesthe necessary formal background on which our work depends.
sect.
illustratesandsect.4describesindetailthealgorithmforsynthesis of random skolem functions.
the implementation is outlined inalgorithm jsyn vg parenleftbig a vecx vecy gi vecy gt vecy vecx vecy prime parenrightbig cf.
.
input a vecx vecy assumptions gi vecy gt vecy vecx vecy prime guarantees output angbracketleftrealizable skolem angbracketright unrealizable 1f vecy latticetop 2while latticetopdo 3 vecx vecy.
f vecy a vecx vecy vecy prime.gt vecy vecx vecy prime f vecy prime angbracketleftvalid validregion vec x vecy skolem angbracketright ae val 5ifvalidthen if vecy.gi vecy f vecy then return angbracketleftrealizable skolem angbracketright else return unrealizable 8elsef vecy f vecy extractunsafe validregion vec x vecy 9end sect.
and the case studies are presented in sect and sect.
.
finally we discuss related work in sect.
and conclude in sect.
.
background and notation afirst orderformula issatisfiableifthereexistsanassignment m calledamodel underwhich evaluatesto latticetop denotedm .ifeverymodelof isalsoamodelof thenwewrite .aformula is calledvalidif latticetop .
for existentially quantified formulas oftheform y. x y validityrequiresthateachassignmentof variables in xcan beextended to a model of x y .
for a valid formula y. x y a termsky x is called a skolem i f x sky x is valid.
more generally for a valid formula vecy.
x vecy over a vector of existentially quantified variables vecy there exists a vector of individualskolemterms oneforeachvariable vecy where0 j n andn vecy such that latticetop x sk vecy x ... sk vecy x .
.
synthesis with jsyn vg webuildontopof jsyn vg areactivesynthesisprocedurethattakes formal specifications in the form of assume guarantee contracts.
systemsaredescribedintermsofinputs vecxandoutputs vecy usingthe predicate i vecy to denote the set of initial outputs and t vecy vecx vecy prime for thesystem stransitionrelation wherethenext primed outputs vecy prime dependonthecurrentinputandstate.
assumptions a vecx vecy correspondtoassertionsoverthesystem scurrentstate whilethesetof guarantees isdecomposed intoconstraintsover theinitialoutputs gi vecy and guarantees gt vecy vecx vecy prime that have to hold over any valid transition i.e.
with respect to t vecy vecx vecy prime .
the algorithm behind jsyn vg performs a realizability analysis todeterminetheexistenceofagreatestfixpointofstatesmeeting the contract that can lead to an implementation.
furthermore the computed fixpoint can be directly used for the purposes of synthesis asitpreciselycapturesacollectionofsystemoutputconstraints which when instantiated define safe reactions.
formally the computed fixpoint is a set of viableoutputs guaranteed to preserve safety by requiring that a valid transition to another viable output is always available.
viable vecy def vecx vecy.
a vecx vecy vecy prime.gt vecy vecx vecy prime viable vec y prime the coinductivedefinition of viable statesis sufficient to prove the realizability of a contract as long as the corresponding deci sion procedure can find a viable output that satisfies the initial 251synthesis of infinite state systems with random behavior ase september virtual event australia guarantees gi vecy vecy.gi vecy viable vec y given a proof of the contract s realizability the problem of synthesis is formally defined as the process of computing an initial output vecyinitand a function f vecx vecy such that gi vecyinit and vecx vecy.viable vecy viable f vecx vecy hold true.
alg.
summarizes jsyn vg.
it begins with the generic candidate fixpointf vecy latticetopand solves the formula for the validity line4 thatcorrespondstothedefinitionofviableoutputsineq.
.if isvalidandanoutputvectorin f vecy existsthatsatisfiestheinitial guarantees thenthecontractisdeclaredrealizable andawitnessing skolem term is extracted.
if is invalid the algorithm extracts the largestsubsetof f vecy a vecx vecy denoted validregion vec x vecy suchthat the following formula is valid vecx vecy.
validregion vec x vecy vecy prime.gt vecy vecx vecy prime f vecy prime due to the possibility of validregion vec x vecy strengthening the assumptions a vecx vecy we additionally extract a set of constraints over unsafestates extractunsafe from validregion vec x vecy .thenegation of this set is then added as a new conjunct to the candidate f vecy andthealgorithmiteratesuntileither isvalidor f vecy .
for further details we refer the reader to the original paper on jsyn vg .
.
realizability and synthesis withae val the greatest fixpoint algorithm described by jsyn vg uses aeval an algorithm to determine the validity of formulas and to generate deterministic witnessesin theform of skolemterms.
thelatterfeatureisalsothepointofinterestbehindthiswork as randomnesscanbeintroducedthroughreplacingthepartof aeval s skolemization strategy with our new proposed algorithm.
alg.
gives a brief pseudocode of ae val2.
the idea is to enumerate all models of vecxand to extend each of them to a model of y. because a naive enumeration would be endless ae val generatesasequenceofmodel basedprojections mbps eachof whichgroups modelsof vecx.formally anmbpfor model misa formulap vecx such that m p vecx andp y. vecx y .
to create it ae valgathersallliteralsof whichareevaluatedtotrueby m line6 .
theseliterals arefurtherreferred toas skolemconstraints .inlineararithmetic eachskolemconstraintiscomposedonlyof arithmeticrelations linearcombinationsover vecxandy andnumeric constants.
finally to obtain an mbp pre ae val just eliminates y from the conjunction of skolem constraints line .
theextractskprocedure usedforskolemextraction implements an inflexible strategy to transform skolem constraints to local skolem terms we refer the reader to the original paper on ae val for further details .
the final skolem term has a form of adecision tree where preconditions are placed on the nodes and localskolemterms i.e.
outputsof extractsk areontheleaves i.e.
the nested if then else structure ite sky vecx def ite pre sk1 y vecx ite pre sk2 y vecx ... ite pre skm y vecx skm y vecx 2note that for simplicity of presentation in the pseudocode we assume a single existentiallyquantifiedvariable y however thealgorithmandtheimplementation can handle any vector vecy .algorithm ae val parenleftbig vecx y. vecx y parenrightbig cf.
.
input vecx y. vecx y data mbpspre skolem constraints skolem terms sk output return value valid invalid of vecx y. vecx y validregion skolem 1m 2while latticetopdo 3ifm logicalandtext.
i pre vecx then return angbracketleftvalid latticetop decisiontree pre sk angbracketright 5if m vecx y m logicalandtext.
i pre vecx then vecx y lscript lscript literals m lscript pre vecx qelim y vecx y sk vecx y extractsk vec x y logicalandtext.
c vecx y c m m 10else return angbracketleftinvalid m logicalortext.
i 1pre vecx emptysetalt2 angbracketright finally inthecasethattheinputformula vecx y. vecx y isinvalid ae val returnsm logicalortext.
i 1pre vecx as the formula s maximal region of validity i.e.
themaximalsetofmodelsoftheuniversallyquantified variables for which the formula becomes valid.
this region is used by jsyn vg in order to further refine the candidate fixpoint during each of its iterations alg.
line .
random synthesis motivating example in this section we demonstrate a complete run of the synthesis procedureandshowhowthestandardsynthesizedwitnessesare unable to exhibit random behavior.
as an example we use a safety robot motion planning problem from neider et al.
.
in this problem a robot is placed on a one dimensional grid with two players theenvironmentandthesystem controllingitsmovement.eachplayercanchoosetoeithermovetherobotleftorright ornot moveitatall werefertothesechoicesusingthevalues .the robot startsat position andthe safety propertyfor the system is to retain the robot in the area of the grid for which position .
fig.
shows an assume guarantee contract for the example described in the lustre language.
the contract has the singletoninput vecx x internally identified by the realizable statement and the outputs vecy y position .
the contract assumption is that the environment will only make legal choices i.e.
a vecx vecy def x x .
the initial guarantee refers to the initial position of the robot and the system choices for movement i.e.
gi vecy def position y y .ontheotherhand the transitional guarantee captures the safety property along with the statefulcomputationstepforthenewposition i.e.
gt vecy vecx vecy prime def position prime position x y prime position prime y prime y prime thetransitionrelationfor positionisdefinedusinglustre s and 3variableproperty is local to the contract.
formally local variables are treated as system outputs.
252ase september virtual event australia andreas katis grigory fedyukovich jeffrey chen david greve sanjai rayadurgam and michael w. whalen node onedim x y int re turns var ok1 ok2 bool position int let assert x and x position pre position x y ok1 y and y ok2 position property ok1 property ok2 realizable x tel figure assume guarantee contract in lustre.
void skolem if position x y else if position x position x y position x e l s e y figure synthesized deterministic witness in c. preoperators .4the safety properties are captured by ok1and ok2 declared as such using property .
theprocedurebeginswithacalltojsyn vgusingthecontract as its input.
the contract is realizable and the greatest fixpoint of viable states is f vecy def position .
ae val declares that the formula def vecy vecx.
a vecx vecy f vecy vecy prime.gt vecy vecx vecy prime f vecy prime isvalid and extracts a skolem term as a witness.
fig.
presents a direct translationofthefunctiontoc.thesynthesizedimplementation behaves in a deterministic way under the following conditions whenever position x the system chooses to move left y ifposition xequals0 or then thesystem choosestodo nothing or move right respectively y position x for any other case the system chooses to do nothing y .
whiletheimplementationpreservessafety thesetofpossible actions are limited due to the deterministic assignments to the outputy.
interestingly for this particular implementation the systemforcestherobottogobacktopositionsthataredangerously close to the unsafe region!
similarly the corresponding solution byneideretal.isthewinningset whichwouldtranslateto implementations where the system would never move the robot beyondposition .nevertheless implementationsexistforwhich thesystemcanexerciseabroadersetofbehaviors.forthisexample 4intuitively the problem is formalized in a manner where the position of the robot is updatedafterbothplayersmakeachoice withthesystemreactingtothechoiceof the environment.inparticular wheneithercondition or istrue thesystemcan freelychooseanypossiblemoveactionwithoutviolatingthesafety properties.
fig.
shows an implementation that can theoretically exerciseanysuchpossibleassignment weexplainwhyinsect.
.
.
inthefollowingsections wepresentanewmethodtosynthesize a random witness that can in theory provide all such possible permutations using a single implementation.
synthesizing random designs thestandardskolemtermextractionalgorithminae valdoesnot support the generation of skolem functions with random variable assignments.inthissection wepresentanewproceduretocompute witnesses that can be used to simulate random behavior.
.
overview our proposed algorithm preserves the overall structure of ae val as well as the soundness of its results .
the main idea is to replace the deterministic assignments that eventually appear in the leaves of the generated decision tree with applications of uninterpreted functions which when translated at the implementation level canbeviewedasfunctioncallstoauser definedrandomnumber generator.
we refer to these functions as uninterpreted random number generators definition4.
uninterpretedrandomnumbergenerator urng .
urng is an uninterpreted function frng h lscriptclosed uclosed l u t1 ... t d b b t t t wheret z r hisacollectionofrightsideexpressionsextracted from the set of disequalities d lscriptandudetermine the bounded interval for the randomly generated value and lscriptclosed uclosedare booleanflags that whenset identifythecorresponding boundasbeingclosed.withoutlossofgenerality werequirethefollowing postconditions to hold on any supplied implementation of frng h h.frng h nequalh algorithm extractsk vec x y input variables vecx y skolem constraints vecx y logicalandtext.
r e d g ge l ler vecx y output termsk such that y sk vecx vecx y lscriptclosed uclosed 2ife nequal emptysetalt2then return asn e s.t.e e 3ifg ge nequal emptysetalt2then lscript max g ge lscriptclosed g emptysetalt2 max g max ge 6ifl le nequal emptysetalt2then 7u min l le 8uclosed l emptysetalt2 min l min le 9if lscript vecx u vecx then return lscript 10h asn d d d 11if lscript undef u undefthen return frng h latticetop latticetop 12if lscript undefthen return frng h latticetop uclosed u 13ifu undefthen return frng h lscriptclosed latticetop lscript 14returnfrng h lscriptclosed uclosed lscript u 253synthesis of infinite state systems with random behavior ase september virtual event australia frng h lscript u lscript u frng h latticetop lscript u lscript u frng h latticetop lscript u lscript u frng h latticetop latticetop lscript u the use of urngs allows us to reason about valid regions of valuesforvariableassignmentsinsteadofaparticularvalue.furthermore the postconditions defined for these functions play an integral role in determining the soundness of the resulting skolem function.
it is important to note that we do not have to reason regarding the emptiness of the intervals.
the intuition behind this is that such computed constraints infer an unrealizable contract.
in these scenarios ae val would declare the input formula as invalid and the skolem extraction algorithm would never be invoked.
.
algorithm alg.3showsourproposedprocedureforextractingskolemfunctionsthatallowforrandomchoices.itisinvokedfromalg.2and takes a set of universally quantified variables vecx an existentially quantifiedvariable y andskolemconstraints computedinalg.
.
alg.3constructsagraphofafunctionthatisembeddedinarelation specifiedbyaconjunctionofexpressionsovertherelational operators nequal using the following constraints edef y fi x iddef y nequalfi x igdef y fi x i gedef y fi x iledef y fi x ildef y fi x i inadditiontotheconstraintsabove alg.3alsoutilizesthefollowing helper functions where nequal asn y e x def emin s def asn s max s def asn s min s def ite asn s min s s asn s min s s s s max s def ite asn s max s s asn s max s s s s operatormin max computesasymbolicminimum maximum of the given set of constraints.
while the algorithm is applicable forbothliaandlra thefollowingtransformationsareusedfor the case of integers a b a b 1a b a b these transformations help avoid clauses containing and .
line initializes the value of the boolean flags lscriptclosedanduclosedto false andline2handlesthecasewhereequalityconstraintsexist overy.
lines to construct the expressions for the lower and upper bounds and the truth of the flags depends on the symbolic comparison between the symbolic minima and maxima.
line 9handles the case where the lower bound is equal to the upperbound.
it should be noted that for cases handled by lines and only deterministic choices exists.
lines to attempt to compute an expression containing a urng that considers the set of disequalities d. first the algorithmextractstheright handsideofdisequalitiesinline10.ifbothbounds are undefined line returns the application of the urng frng h latticetop latticetop where and are represented as free variablesthatcanbelatermappedrespectivelytotheminimumand maximum arithmetic representations supported by the implementation e.g.
int min andint max for integers in c .
if only the lowerboundisundefined line12 weuse frng h latticetop uclosed u to generate a random value with an unconstrained lower bound.similarly we handle the case where no constraints exist for the upper bound in line .
in line both lscriptanduare defined and the algorithm returns frng h lscriptclosed uclosed lscript u to capture a random valuewithintherespectivebounds.inallabovecases when h nequal emptysetalt2 the urng is expected to generate a value that satisfies all disequality constraints in d. for the special case where d emptysetalt2 there are no such disequalities over yand the skolem term can freely assign any value within the computed bounds lscriptandu.
asanillustrationofourprocedure wepresentsummarizedruns over the following examples.
example4.
.
considertheformula x. y1 y2.
x y1 y2 over lia where x y1 y2 def x y1 3x y2 x x y1 5x y2 x theformulaisvalidsincethereexistsanassignmentto y1and y2thatsatisfiestheconstraintsin foranyx.inordertoconstruct such a witness ae val needs to consider two separate cases for x i.e.
the constraints x andx .
underx the deterministic skolem terms would be 3x fory1andx fory2.
for the random case alg.
computes frng y1 emptysetalt2 latticetop 3x andfrng y2 emptysetalt2 latticetop x .
underx thedeterministictermswouldbe 3x 1fory1andx 1fory2 while alg.
computes thefunctions frng y1 emptysetalt2 latticetop 5x and frng y2 emptysetalt2 latticetop x respectively.
note that for the random case the above terms are finally combined into the skolem term for y1 y2.
x y1 y2 sk vecy x def ite x y1 frng y1 emptysetalt2 latticetop 3x y2 frng y2 emptysetalt2 latticetop x y1 frng y1 emptysetalt2 latticetop 5x y2 frng y2 emptysetalt2 latticetop x example .
.
consider an assume guarantee contract for a system with the input vector vecx x1 x2 x3 r3and one output y rand the following constraints squaresolida x1 x2 def x1 x2 squaresolidgi y def latticetop squaresolidgt y x1 x2 y prime def y prime y prime nequalx1 y prime nequalx2 the above specification is realizable as there are infinitely many assignmentsto ythatsatisfytheguarantees ggivenanyvalueof x1 x2in .
using alg.
we retrieve the following skolem term to enable random behavior note that input x3is not included in the seth i.e.
the first argument of the function 254ase september virtual event australia andreas katis grigory fedyukovich jeffrey chen david greve sanjai rayadurgam and michael w. whalen void skolem if position x y randval else if position x position x y position x e l s e y randval figure synthesized random witness.
double ran dval bool lflag bool uflag double lbound double ubound int min lflag ?
lbound lbound int max uflag ?
ubound ubound int range max min double rnd double rand .
double rand max int value int d ouble range rnd return value min figure example random number generator.
sky vecx def frng y x1 x2 .
example .
.
consider the contract from fig.
.
the details of the synthesis procedure remain identical with the deterministic approachupuntiltheskolemizationstep.fig.3showsthecimplementation for the random witness that is synthesized using alg.
.
our proposed skolemization procedure returns the assignment valueforythatisequivalentto frng latticetop latticetop fortheconditions underwhichthesystemcansafelychoosetomovetheroboteither left right ornotatall.theactualchoiceisrandomlymadethrough the application of a function named randval.
the implementation of the function is then left to the engineer s discretion an example is given in fig.
.
it is important to note that throughout this section we presentedalg.3assumingthattheinputformula vecx y toae valis disjunction free.
themain difference betweenthe originalskolemizationprocedureinae valandournewoneisthattheformerdoesnotprovideallpossibleskolemterms whilethelatterdoes.
thus theoriginalae valalgorithmisnotsensitivetotheshape oftheoriginalformula butournewalgorithmrequiresaspecial treatmentforthedisjunctions.infact ourapproachisgeneralizable tothe caseofarbitrary formulasviaconverting themthedisjunctive normal form dnf .
the set of skolem functions can then be generatedforeachofthedisjunctseparately.thefinalsolutionis thencomposedfromthese partialskolemfunctionsalongwitha parameter that randomly picks one of them.
.
soundness and completeness in this section we prove that alg.
is sound and can provide allpossible skolem terms given a set of skolem constraints vecx y .
aswenotedinthebeginningofsect.
.
skolemconstraintsare createdfromliteralsofaformulainlineararithmetic thusitcannot contain disjunctions.
theorem .
soundness of skolem extraction .
assuming that the properties from def.
.
hold alg.
returns valid skolem terms.
proof.toprovethisstatement itsufficestoshowthatanycomputedskolemterm sky vecx byalg.3accompaniedbytheassociated postconditions in def.
.
implies the input skolem constraints in vecx y .returnlines2and9inextractskaretrivialcases asthey reducetoasimpleassignmentfromequalityconstraints.line11 refers to the case where no bounds have been defined and the computedskolemtermisaurngthatutilizestheunconstrained variables and along with postcondition to ensure the choice of an arbitrary value within the specified domain.
lines to handle the case where inequalities exist that determine the lower and upper bounds lscript vecx andu vecx .
if the lower bound is undefined line returns a urng that is guaranteed to provide a randomvaluebetween anduasperpostconditions4and5.we prove the soundness of terms provided by line in a similar manner.
if both bounds exist then in line the skolem term returned isaurngguaranteedtoprovideavaluewithintherangespecified by lscript vecx u vecx as per postconditions .
square theorem .
completeness of skolem extraction .
the skolemtermsgeneratedbyalg.3aresufficienttorepresentallpossible witnesses of the conjunctive formula in eq.
.
proof.it suffices to prove that no weaker set of postconditions pc prime i.e.
pc pc prime exists such that vecx.pc prime sk vecx vecx sk vecx we prove this by contradiction assuming that pc primeexists whenever alg.
returns.
lines2and9 .alg.3returnsthedeterministicassignments asn e and lscript for which no weaker postconditions exist.
line11.
in this case no bounds have been defined and postcondition5isusedtodenotearangewithunconstrainedbounds and .
formally we can simplify this postcondition to pc true for whichnoweakerpostconditionexists.itisalsonoteworthytostate that weaker postconditions exist but all of them have to violate at least one disequality in d. line .
we have lscript undef i.e.
no constraints exist for the lower bound and the skolem term sk vecx frng h latticetop uclosed min u is returned.
depending on whether the upper bound uis closed ornot wehavetwocases.forbrevity weshowtheproofforthe case where uis closed and the corresponding case for the open bound follows similar principles.
255synthesis of infinite state systems with random behavior ase september virtual event australia squaresolidwhenuis closed the output constraints are simplified to vecx sk vecx sk vecx uand the skolem term sk vecx frng h latticetop latticetop u is returned with postcondition capturing the term s range.
assume that a weaker postcondition pc primeexists such that eq.
holds.
without loss of generality we pick pc prime frng h latticetop latticetop u withu prime u. therefore we have that pc pc prime but eq.
doesnotholdfor pc prime asthenewtermmayprovidethevalue u primeas an output falsifying vecx sk vecx .
line .
similar to proof for line .
line .
lscript nequalu nequalundef and as such the output constraints can be simplified into vecx sk vecx lscript sk vecx u where .w e have the following cases corresponding to the possible ranges lscript u .
in this case we have sk vecx frng h lscript u and aspostcondition pcthesecondpostconditionfromdef4.
.
assume that a weaker postcondition pc primeexists such that eq.
holds.
we can pick pc prime frng h lscript u .
inthiscase pc pc primeholds buteq.2doesnothold aswe can pick any of the assignments sk vecx lscript sk vecx u which violate the constraints in reaching a contradiction.
lscript u .
similar to the previous proof by picking e.g.
pc prime frng .
lscript u .
similarly we can pick pc prime frng .
.
similarly we can pick pc prime frng where lscript prime lscript.
square implementation and evaluation we implemented our random synthesis algorithm as a complementaryproceduretotheoriginalsynthesisframeworkjkind a java implementation of a popular kind model checker .
following kind the input contracts are expressed using the lustre dataflow language .
jkind provides support for synthesis both throughthefixpointalgorithminjsyn vgaswellasitspredecessor jsyn arealizabilitycheckingalgorithmbasedonthe k induction principle .
our proposed skolemization procedure in alg.
is a new extraction method that is performed after the validity checking procedure in ae val thus making it inherently compatiblewithbothjsynandjsyn vg5.itisnoteworthythatour approachdoesnot addanyperformanceoverheadto thebaseline implementation of jsyn vg as shown in table .
sincethesynthesizedskolemfunctionsareexpressedinthesmtlib .
language by default we translate them into executable c implementations.
for the purposes of this paper we mapped the application of urngs to calls to random number generators of uniformly distributed values unless otherwise noted.
the evaluation process of our work is twofold 5the modified version of jsyn vg for random synthesis is available at https github.com andrewkatis jkind tree synthesis.
the modified version of ae val with the new skolemization procedure is available at fuzzersynthesis.
g94 g393 g286 g272 g349 g296 g349 g272 g258 g410 g349 g381 g374 g38 g437 g460 g460 g286 g396 g100 g258 g396 g336 g286 g410 g68 g381 g374 g349 g410 g381 g396 g58 g94 g122 g69 g882 g115 g39 g94 g455 g374 g410 g346 g286 g400 g349 g400 figure fuzzer synthesis and testing diagram empirical.
we performed case studies in applications where synthesis of random designs can be beneficial.6for the first case study we conducted an experiment in the context of model based fuzz testing where the goal was to synthesize reactivegrayboxfuzzers capableofexposingvulnerabilities that can crash an application through random test case generation.thesecondstudy revolvesaround controllersynthesisfor avoidance games in robot motion planning.
synthesistime.weinvestigatedtheeffectthatourskolemization algorithm had on jsyn vg in terms of synthesis time.
furthermore wecompared ourworktodt synth astateof the art synthesis tool for infinite state problems .
case study reactive fuzzers in our first case study we explored the applicability of synthesized implementationswithrandombehaviorinfuzztesting.wefocused on model based approaches to examine a system under test sut theinputspecificationofwhichwasusedtoderivetestcases see utting et al.
for a detailed survey .
in the past model based fuzztestingrevolvedaroundtheuseofstructureddescriptionsof thesysteminputintheformofgrammarsandasophisticatedimplementationofafuzzerthat givenagrammar wouldcontinuously feed random inputs to the sut .
we show that synthesisoffersaviablealternativetechniqueinthiscontext where thegeneratedimplementationscanserveassut specificfuzzers requiring for configuration nothing but the input specification for the sut.
.
setup and evaluation themainintuitionisthatthesut sinputdescriptioncanbeviewed asasubstantialfragmentofthefuzzer sspecification whichcan thenbeusedtosynthesizeareactiverandomtestcasegenerator.fig.
depicts our exact setup where the designer already has aspecification for the sut and uses jsyn vg with our skolemiza tion algorithm to automatically generate a corresponding fuzzer.
thefuzzeristhenattachedtothesut target alongwithanaccompanied monitoring service monitor that tracks progress with respect to the sut related statistics e.g.
coverage .
following the definitionof grayboxfuzzing afeedbackloopexistswheremonitoredinformationcanbesubsequentlyfedtothefuzzer inorderto dictate the generation of future test cases.
using this setup we proceeded with a thorough performance evaluation of our synthesized fuzzers following guidelines that were recently proposed by klees et al.
6the benchmarks are publicly accessible online.
.
m9.figshare.
256ase september virtual event australia andreas katis grigory fedyukovich jeffrey chen david greve sanjai rayadurgam and michael w. whalen table fuzzer performance comparison and synthesis times.
afl aflfastsynthesized fuzzerw o corpus w corpus w o corpus w corpus system under test coverage crashed?
coverage crashed?
coverage crashed?
coverage crashed?
coverage crashed?
synthesis times s basic messaging .
.
.
.
.
.
dive logger .
.
.
.
.
.
divelogger2 .
.
.
.
.
.
email system 2 .
.
.
.
.
.
movie rental service .
.
.
.
.
.
palindrome .
.
.
.
.
.
ptaas .
.
.
.
.
.
quadtree conways .
.
.
.
.
.
scuba dive logging .
.
.
.
.
.
user manager .
.
.
.
.
.
sut selection .weconsideredtenapplicationsfromthedarpa cybergrandchallenge cgc abenchmarkcollectionthathas been extensively used in the past to assess the performance of fuzzers due to the high degree of interactivity between the sut andtheuser .theoriginalcollectionwasaimedtowards the evaluation of automated reasoning and testing tools and each applicationisintentionallydocumentedinawaythatisinsufficient to derive a precise specification from the documents themselves.
tosimulatethecontextunderwhichsynthesiswouldmakemost sense as a tool we closely inspected and ran each application in order to identify the types and sequences of inputs each applica tion takes.
the manual process of discovering and writing input specifications per application was non trivial as each application differsconsiderablyfromtherest andwasthemainfactortothe study being limited to a subset of ten applications.fuzzerspecification .afterinspectingeachapplicationtoidentify thekindsofinputsthatittakes wewroteacorrespondingassumeguaranteecontractforafuzzer.eachfuzzerspecificationconsists ofpropertiesthatcapturethevalidrangesofvaluesforeachone ofthesutinputs.moreover thespecificationisstateful making eachfuzzerreactivetochanges orlackthereof incoverageresults frompreviouslygeneratedtests.wespecifiedthebehaviorofthe fuzzer in such a way that for the majority of its runtime validinputs are fed into the sut.
as long as no progress is made in termsofcoverage thefuzzerattemptsgeneratinginvalidtestswith probability p .
.
formalization .
all of the aforementioned elements that comprise the fuzzer specification can be expressed using a set of safetypropertiesoverthesutinputs whereeachsetpreciselycapturesthe conditions under which a in valid value is generated for the correspondinginput.anexamplepairofsuchpropertiesisthefollowing squaresolidprop1def p prime p prime squaresolidprop2def cv p .
p .
in primesys nelementsvalid variables pandinsysare fuzzer outputs with insysalso serving as a corresponding input for the sut.
the value of p is picked randomly for each test and it determines whether the next primed system input in primesyswill be assigned to a valid value i.e.
avaluein svalid ornot.variable cv isaninputtothefuzzerand can be viewed as a flag which when set informs the fuzzer that the previous test resulted in progress in system coverage e.g.
line coverage improved .
if such progress was not observed then we allow the fuzzer to randomly consider invalid values in subsequent 7the public cgc benchmark collection is available at more specifically when p .
p .
the fuzzer will generate an invalid value i.e.
a value that does not satisfy the constraintsthatdefine svalid.followingthenotationthatwedescribed inprevioussections thesynthesisproblemforthepropertiesabove is to ensure that p cv insys p prime in primesys.
prop1 prop2 is valid.
synthesisandevaluation .usingthefuzzercontracts wesynthesized a fuzzer for each application and ran it against the sut usingthesetupinfig.
.wesetthetimeoutforeachfuzzingcampaignto nine hours and monitored the sut line coverage gcov as well as crashes.tocompareperformance wealsoranfuzzingcampaigns usingafl andaflfast usingtheirdefaultconfigurations.
weselectedthesetoolsprimarilyduetoaflbeingoneofthemost prominenttoolsinthearea whileaflfastisarecentextensionto afl that has been shown to perform better with respect to vulnerabilitydetection.8bothtoolswererunbothwithandwithoutan initialcorpusinordertoprovideamorecompletepictureoftheir performance whether the user provides additional information or not.toremainfairwithrespecttotheevaluation thecorporawere created using tests that exercise application locations that are as deep as possible.
table shows the results of our experiments.
most of the applications contain unreachable code related to debugging methods and as such coverage is not attainable using gcovwithout further modifications to the source code.
while we were able toachieve line coverage for the majority of the benchmarks the application movie rental service was the worst performing with only .
.
despite that the synthesized fuzzer outperformed bothaflandaflfastoneitherconfigurationwithasignificant margin.infact oursynthesizedfuzzersoutperformedbothafland aflfastonfourapplicationsandremainedwithin4 ofthe best performingtoolforfiveothers with quadtree conways being the only exception.
more interestingly seven of the synthesizedfuzzers were able to crash the corresponding application at least once whereas afl aflfast were only able to crash three.
considering the performance results along with the low synthesistimeperfuzzer webelievethatsynthesisofmodel basedfuzzersshould be considered a viable tactic towards testing systems where aspecificationalreadyexists.arguably asynthesizedfuzzerisas easy to use as a general purpose tool like afl.
furthermore the userdoesnothavetoprovideadditionalinformationthroughacorpus a procedure in testing that often times can be time consuming 8both afl and aflfast do not support line coverage reporting natively.
to monitor coverage weused afl cov awrappertoolthatenablestheuseof gcovwithafl and its variants.
257synthesis of infinite state systems with random behavior ase september virtual event australia andcumbersome asbothvalidandinvalidinputsequenceshave to be considered for a successful campaign.
case study robot motion planning in our second study we synthesized implementations for robots participating in two player safety games against an adversary.
the study is furthermore split into two parts.
.
simulating avoidance games weexperimentedonsimulatinganavoidancegameinabounded arena where the synthesized solution was used against two differentadversarialscenarios.boththepropertiesoftherobotand the adversary were specified using their position in terms of x y coordinates.
formally we described the game using the following properties squaresolidinitial state the robot starts in xinit yinit similarly for the adversary .
squaresolidvalidtransitions x prime robot where isuserdefinedandcapturesthemaximumdistancebetweensubsequent moves similarlyfor y coordinateandtheadversarialtransitions .
squaresolidin boundsproperty xrobot xmin xrobot xmax similarlyfor they coordinate .
squaresolidavoidance property xrobot nequalxadversary yrobot nequalyadversary.
the first scenario in our presentation involves the adversary patrolling on a specific route while in the second the adversaryis always moving towards the robot.
trajectory videos for both scenarios are available online9.
.
.
real coordinates.
fig.
shows three possible trajectories thatweregeneratedafterrunningthesynthesizedsolutionfor1000 turns against the patrolling adversary.
both robots move in the arenausingrationalcoordinatesina5x5box.theinitiallocation fortherobotisthepoint .
.
andtheadversarybeginsitsroute from .
.
.
while the adversary has a predetermined route the robot is allowed to move towards any possible direction vertically horizontallyanddiagonally .moreover therobotcanmoveatvary ingdistancesupto0.1unitsawayfromitscurrentposition inbothaxes i.e.
xrobot x prime robot .
andsimilarlyfortheyaxis .fig.6a indicates how the synthesized solution can respond in a randompattern covering different parts of the bounded arena while preserving safety.
fig.
6b and 6c demonstrate the resulting trajectories when the user introduces bias in the values returned by the randomnumbergenerators usingthesamegeneratedwitnessfrom ae val.
as a result the robot was limited to moves that would retain its position within the central area of the arena and closetothebottomleftcornerofthepatrollingadversary sroute .
.
.
integer coordinates.
forthisexperiment weaimedtodemonstrate the advantages that randomness can provide with respect tohowwellarobotcoversaboundedarena inspiredbyworkin coveragepathplanningproblems.fig.7showshowtwotrajectoriesevolvedoverseveralturns 250and1000turns forasimilarmotion planning problem usingintegercoordinates.
to demonstrate 9picturesandvideosofthesimulatedgamespresentedinthissectionwereanonymized and made available at theadversary.inthisgame theadversaryisaggressivelychasing after the robot in a random fashion.
the robot s objective remains thesame i.e.
movewithintheboundedarenawhileavoidingthe adversary.therobot sinitiallocationisthepoint whilethe adversary begins at .
infact fig.7a 7c and7eshowmovesperformedbyarandom controller while fig.
7b 7d and 7f depict the behavior of the deterministic solution provided by the standard synthesis algorithm injsyn vg.
itis apparent thatthe former visits100 states inless than turns whereas the latter visits only states in turns.thiscomparisonshowcasestheadvantagesthatarandom solution can provide in terms of overall coverage as well as the diversity of behaviors that can be observed and exercised when an implementation can be generated that always considers the entire set of safe choices instead of an instantiated strategy.
evaluation synthesis time ourcase studyin robotmotion planningwas inspiredby resultsin this context from the most recent and related work on dtsynth .
this reactive synthesis framework incorporates learning techniques to generate winning sets for infinite state safetygames in the form of decision trees.
dt synth has been shown tooutperformpreviousproposedsynthesistools bothininfinitestate consynth andfinite stateproblems rpni synthand sat synth .whiletheauthorsdonotexplicitlytalkaboutrandomness the winning sets provided by dt synth are sufficient to generate implementations with diverse behavior.
despite this fact thegeneratedwinningsetsaresubsetsofthegreatestfixpointof safestates whichwouldleadtoimplementationsthatonlyexerciseafragment ofthereachablestate space.anexampleis thewinning set that we mentioned for the motivating example in section .
notethatdt synthworksonlyforfinite branchinggamegraphs and the user must additionally specify a minimum value for thenumber of successors for each vertex in the graph.
an incorrect valueforthisthresholdcanleadtounsoundwitnesses.withour jsyn vg suchadditionalknowledgeisnotrequiredfromtheuser sinceitisonlyreliantontheoriginalspecificationandisguaranteed to provide sound results thanks to theorem .
.
table2presentsthecomparisonof jsyn vganddt synth.as an addendum we included the synthesis times for the problemsusing the existing deterministic synthesis algorithm in jsyn vg.
as we mentioned in sect.
the performance is identical when compared to synthesizing random witnesses.
forthepurposesofthiscomparison weusedtheinfinite state benchmarks presented in the original paper on dt synth as well as the simulated avoidance games from sect.
.
namelybounded evasion andbounded evasion ints.
the two tools have similarperformanceforhalfthebenchmarks withsignificantdifferences for the rest.
for diagonal the main distinction is that dt synth requires the definition of two additional expressions toguidethelearning procedure whereasjsyn vgfindsasolution without additional templates.
on the other hand dt synth s ability to synthesize memoryless strategies allows for faster synthesis forsolitarybox where the robot is simply moving freely within 258ase september virtual event australia andreas katis grigory fedyukovich jeffrey chen david greve sanjai rayadurgam and michael w. whalen .
.
.
.
.
.
.
.
a .
.
.
.
.
.
.
.
b .
.
.
.
.
.
.
.
c figure random trajectories of a robot irregular solid line while avoiding a patrolling adversary inner square .
table synthesis time of dt synth and jsyn vg seconds .
benchmark jsyn vgjsyn vg random dt synth box .
.
.
diagonal .
.
.
evasion .
.
.
follow .
.
.
limitedbox .
.
.
solitarybox .
.
.
square .
.
.
program repair .
.
.
repair critical .
.
.
synth synchronization .
.
.
cinderella c .
.
cinderella c .
.
bounded evasion .
.
unsupported bounded evasion ints .
.
an infinite arena while staying within a horizontal stripe of width equal to three.
jsyn vg is targeted to synthesis of stateful systems and as such a more elaborate strategy is generated.
inthecaseof repair critical dt synthappearstobemoreefficient in termsof handling disjunctive expressions inthe specification whilefor synth synchronization dt synthseemstorequire more elaborate hypotheses in order to come up with a witness.
thelatterisfurtherdemonstratedintheresultsforthe cinderella andbounded evasion ints games where dt synth fails to synthesizeawitnesswithinthetimeoutof15minutes.incontrast jsyn vg computesagreatestfixpointofsafestatesandsynthesizesasolutionina fewseconds.finally forthegame bounded evasion dt synth does not currently support the theory of linear real arithmetic.
related work the idea of synthesizing reactive designs with random behavior isrelevanttosynthesisforpermissivegames.thisareahasbeenexploredinthepastforfinite stateproblems .morerecently fremont and seshiadescribed a formal extension tothe theory of control improvisation to support reactive synthesis .
their probabilisticapproachislimitedtofinite stateproblemsandpractically useful only for the subset of safety games.
the end result is a maximally randomized finite word generator called an improviser where each word satisfies the predetermined probability thresholdconstraints.incomparison ourapproachsynthesizesdesigns for infinite state problems that simulate randomness.
furthermore we do not provide guarantees regarding the randomness of the responsesfromthe synthesizedwitness.instead we focusonsynthesizingwitnessesthatconsiderregionsofvaluesascandidates tovariableassignments aproblemreducibletosmt.inourcase theendproductisanimplementationthatcanbefurtherrefined by theengineer witha customprobability distribution toretrieve randomvalues.thisprovidesinvaluablefreedomastheusercan thenchoosewhethertoexpressbiasthroughtherequirementsor through the random number generators themselves.
the original work on jsyn vg targeted the area of infinite state problems.
in this context beyenne et al.
first proposed a templatebasedapproachcalledconsynth wherethespecificationisaccompaniedby atemplateregarding theshapeofthe solutiontoguide thesynthesizertowardsasolution .incontrast jsyn vgisacompletely automated approach exempting the user from necessity to furtherreasonabouttheshapeofthecomputedsolutionandallowing to focus on expressing the problem in the form of input output contracts.
permissive solutions for infinite state games have primarily beenproposed inthe contextsupervisor synthesis where a controller is synthesized considering a formal representation of the behavior inputs provided by the participating plant.
comparedtothiswork ourproposedsolutionexplorestheapplicabilityofsynthesizedcontrollerswithrandombehavior whilethe overallsynthesis taskisinherentlyharder duetonot requiringan exact implementation of the controller s environment.
neiderandmarkgrafrecentlyproposeddt synth alearningbasedapproachtosynthesizingwinningsetsforinfinitestategames 259synthesis of infinite state systems with random behavior ase september virtual event australia a turns b turns c turns d turns e turns f turns figure trajectories and area coverage over time of random left column versus deterministic right column controller.
in the form of decision trees as an extension to previous work byneiderandtopcuforfinite stateproblems .dt synthrequires additional knowledge regarding the number of successor states where lack thereof can lead to unsound results.
similarly to consynth for more complex problems the game specification is supported by additional syntactic expressions that help the learner converge faster to a solution.
in contrast our skolem extraction algorithmisguaranteedtoprovidesoundwitnessesanddoesnot depend on additional user provided input.
conclusion wehavepresentedanovelskolemizationprocedurefortheae val solver enabling the synthesis of infinite state reactive implementations with random behavior.
the proposed solution is an extension to the synthesis algorithm jsyn vg that computes a greatest fixpointofsafestates.theproductisawitnesswherevaluesinsidesafe regions are being considered as equally safe candidate assignments.our solutionprovides theengineer withflexibilitywhen it comestointroducingadditionalbiasthroughthespecificationor the implemented random number generators.
tothebestofourknowledge thisisthefirstworkthatiscapable of synthesizing random infinite state systems.
we showed how the extendedsynthesisframeworkcanbeeffectivelyusedtosynthesize promising solutions in the context of robot motion planning as well as a novel application in fuzz testing.
in the future we wish to continueexploringtheareaofreactivefuzzersynthesis particularly in the context of identifying a formal specification standard.
to expand its applicability in robot motion planning we wish to explore waystosupportlivenessspecifications aswellassoftrequirements.
theoutstandingresultofthisworkisaskolemextractionprocedure general enough to be applicable to other unexplored aspects of the synthesis problem.