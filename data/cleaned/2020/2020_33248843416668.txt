mofuzz a fuzzer suite for testing model driven software engineering tools hoang lam nguyen nguyehoa informatik.hu berlin.de humboldt universit t zu berlin germanynebras nassar nassarn informatik.uni marburg.de philipps universit tmarburg germany timo kehrer kehrer informatik.hu berlin.de humboldt universit t zu berlin germanylars grunske grunske informatik.hu berlin.de humboldt universit t zu berlin germany abstract fuzzing or fuzz testing is an established technique that aims to discover unexpected program behavior e.g.
bugs security vulnerabilities orcrashes byfeedingautomaticallygenerateddatainto aprogramundertest.
however the applicationoffuzzingtotest model drivensoftwareengineering mdse toolsisstilllimited becauseofthedifficultyofexistingfuzzerstoprovidestructured well typed inputs namely models that conform to typing and consistencyconstraintsinducedbyagivenmeta modelandunderlying modeling framework.
by drawing from recent advances on both fuzz testing and automated model generation we present threedifferent approaches for fuzzing mdse tools a graph grammarbasedfuzzerandtwovariantsofacoverage guidedmutation based fuzzer working with different sets of model mutation operators.
ourevaluationonasetofreal worldmdsetoolsshowsthatour approachescanoutperformbothstandardfuzzersandmodelgenerators w.r.t.
their fuzzing capabilities.
moreover we found that each ofourapproachescomeswithitsownstrengthsandweaknessesin terms of fault finding capabilities and the ability to cover different aspects of the system under test.
thus the approaches complement each other forming a fuzzer suite for testing mdse tools.
ccs concepts softwareanditsengineering model drivensoftwareengineering software testing and debugging.
keywords model driven software engineering modeling tools fuzzing automated model generation eclipse modeling framework acm reference format hoang lam nguyen nebras nassar timo kehrer and lars grunske.
.
mofuzz a fuzzer suite for testing model driven software engineering permission to make digital or hardcopies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
ase september virtual event australia association for computing machinery.
acm isbn ... .
in 35th ieee acm international conference on automated software engineering ase september virtual event australia.
acm new york ny usa pages.
introduction fuzz testing aka.
fuzzing automatically generates a large number of inputs and feeds them to the program under test to discover unexpectedprogrambehaviorandevaluatetheprogram sreliability.
sinceitsinitialintroductionbymilleretal.
fuzzingviatools like afl has been widely adopted due to its conceptual simplicityanditsproveneffectiveness .variousadvanced approaches have been proposed to improve the performance of fuzzersthroughguidingtheinputgenerationprocess .
furtherimprovementshavebeenmadebyincludingtargetedinput string mutations or problem specific generators .
however theapplicationoffuzzingtotestmodel drivensoftware engineering mdse tools is still limited.
this is due to the difficultyofexistingfuzzerstoprovidestructured well typedinputs namelymodelsthatconformtotypingandconsistencyconstraintsinducedbyagivenmeta modelandunderlyingmodeling framework.
in this paper we investigatethe fuzzing of mdse tools which are based on the eclipse modeling framework emf a reference implementation of omg s essential meta object facility emof which has emerged as a de facto standard in the context of open source mdse environments and tool chains.
tools workingwithemfmodelsasinputhaveaprocessingpipelineas illustratedinfigure1.theparsingstagetranslatesamodelfrom someexternalrepresentation typicallyanxmifile intoaninternalrepresentation anobjectstructurewhichcanbeconceptually considered as an abstract syntax graph asg which can be easily processed in terms of the core functionality e.g.
code generation model editing model comparison etc.
of the tool.
models passing theparsingstagearesyntacticallyvalidinthesensethattheyrespectbasicconsistencyconstraintsimposedbyemf aka.validemf models andtheyareproperlytypedw.r.t.thegivenmetamodel.optionally syntacticallyvalidmodelsmayneedtopassa validation stage checking further semantic consistency constraints notably multiplicity constraints or arbitrary well formedness rules e.g.
formulated in ocl defined by the meta model.
parsing andvalidationcorrespondtowhatisreferredtoassyntacticand semantic stage in respectively.
input models may be rejected 35th ieee acm international conference on automated software engineering ase byeachofthesestages andthetool scorefunctionalityremains untested.
consequently fuzzers for effectivelytesting emf based toolsmustgenerateinputmodelswhichatleastadheretoemfand typingconstraints arequirementwhichisnotmetbyanyofthe existing fuzzing approaches.
wepresentmofuzz afuzzersuitefortestingmdsetoolswhich tackles this challenge by drawing from two research fields that have developed independently of each other namely i mutationandgenerator basedfuzzing seesection2.
and ii automated modelgeneration seesection2.
.basically theformerprovides inspirationtoguideafuzzertowardseffectivelycoveringthesystem under test i.e.
in our case the mdse tool under test while the latter provides the technology to generate valid models.
while this idea appears to be obvious it is yet unclear which combinations of fuzzing approaches and technologies for model generation are the most effective ones which constitutes the main research question weaim to answer in this paper.
weproposethreedifferentfuzzerstogeneratemodelsthatserve asinputsforfuzzingmdsetools i agraphgrammar basedfuzzer that attempts to cover different aspects of the input domain as fast aspossible andtwomutation basedapproachesthataimtoincrementally evolve inputs to exercise deep paths using either ii a set of customly defined mutations built on top of the emf edit api or iii a set of edit operations specified as model transformationrules which are generated from the given meta model .
the graph grammar based fuzzer is inspired by the idea of using a constructive specification of the input format to generate syntactically valid inputs by construction.
while this idea has been explored for textualinputformatsusingcontext freegrammars ourapproach is integrated with an emf model generator which is based on theconceptofinstance generatinggraphgrammars.ourmutationbased fuzzers are guided in the sense that promising seed inputs areselectedbyafeedbackloopthatleveragescoverageinformation fromthesystemundertest.theirvariationpointliesinthelevel of consistency being preserved by the model mutations.
wehaveevaluatedourfuzzingapproachesonasetofreal world mdse tools based on emf.
our experimental results show that allapproaches can outperform existing fuzzers and automated model generatorsw.r.t.theeffectivenessoftheirfuzzingcapabilites.moreover we found that each of our approaches comes with its own external model representation parsingmdse tool core functionalityvalidationmodel loading not emf compliant not properly typed parsing error validation errornot well formedinternal model representation figure processing pipeline of emf based mdse tools models need to be loaded into an asg based internal rep resentationtobeprocessedbythetool theymustbeatleastemf compliant and properly typed w.r.t.
the given meta model such that the tools s core functionality is reached.strengths and weaknesses in terms of fault finding capabilities and the ability to cover different aspects of the system under test.
thus theapproachescomplementeachother formingafuzzersuitefor testingmdsetoolswhichcancontributetoincreasethematurity of modeling tools.
this is still considered as one of the biggest obstacles for adopting mdse in practice .
state of the art and related work ourworkonmofuzzbuildsonexistingapproachesintwoareas namely work on fuzzing in general and work on automated model generation.inthefollowing wereviewthestate of the artonboth areas and highlight the need for our research on mofuzz.
.
fuzzing the main idea behind fuzzing is to test the program by repeatedlyfeedingitwithrandominputdatathatmaybesyntacticallyor semantically malformed.
usually fuzzing approaches are classified based on the level of program analysis that is employed blackbox whitebox o r greyboxfuzzing .
besides fuzzing tools can alsobeclassifiedbasedonhowtheyproducenewtestinputsinto mutation based andgenerator based fuzzers.
.
.
mutation based fuzzing.
mutation basedfuzzerslikezzuf orafl generatenewinputsbyrandomlymutatingwell formed seed inputs.
the mutations usually operate on raw test inputs represented as a sequence of bytes and ignore complex input file structures.
advances in fuzzing mostly operate on providing guidance for the mutations and the search process to improve the coverageofthesystemundertest.specifically toolslikeaflfast use a coverage guided greybox fuzzing approach to systematically exploretheinputstatespaceandprioritizemutationsoftestinputsinthefuzzingcorpusthatcovernovelprogramareas.basedonthisidea aflgo extendedthecoverage guidedfuzzingideatowards directedgreyboxfuzzing bysteeringthesearchthroughselecting inputs that help to reachspecific code areas instead of novel ones.
in contrast fairfuzz and steelix do not determine which input to mutate but how to mutate the input.
fairfuzz proposes a targeted mutation strategy that tries to focus the location in the input string that will likely generate mutants to hit rarely covered branches.
similarly steelix uses light weight static analysis to gain information that pinpoints interesting bytes in the input.
the study by pham et al.
shows that randomness of byte mutationscanbeineffectiveandhencetheyusededicatedstringbased mutation operators that correspond to the input structure intheirtoolaflsmart.theyshowedthataflsmartcanimprove coverage and identify more vulnerabilities than aflfast and afl.
.
.
generator based fuzzing.
generator basedfuzzingaddresses the limitation of traditional fuzzers like afl which are likely tofail to generate valid inputs for programs which expect highly structured inputs .
totacklethisproblem generator basedfuzzerssuchaspeach or csmith leverage domain specific knowledge of the input format to generate input files that are syntactically valid by construction.thegeneratedinputfilesarethusmorelikelytopassthe earlyinputprocessingstagesandtotestthecorefunctionalityof 1104theprogram.sometoolsusefileformatspecifications ora context free grammar to describe the syntax of inputs.
generator based fuzzers do not require seed inputs.
instead the inputfilesareoftengenerated atrandom usingthefileformatspecification.adrawbackoftheseapproachesisthatwhilethegenerated inputsmay be syntacticallyvalid theyarelikelystill semantically invalid.
for instance a syntactically correct javascript file that refers to variables that are not defined in the current execution context will result in an error in the semantic analyzer.
.
.
hybrid fuzzing approaches.
there are several approaches thattrytocombinemutation basedfuzzingmethodswithgeneratorbased methods in order to mitigate their weaknesses.
for example skyfire learns a probabilistic context sensitive grammar from an initial corpus and a context free grammar in ordertoproduceacorpusthatconsistsofvalidandwell distributedinputs.thegeneratedcorpuscanthenbefedtoanymutation based fuzzer e.g.
afl to improve the code coverage thereby increasing its likelihood of finding vulnerabilities.
in contrast langfuzz and jsfunfuzz use a tight integration of generator and mutation based fuzzing in order to generate syntacticallycorrectjavascriptcodefragments.superion e xtends skyfire and applies a greybox fuzzing technique which uses grammar aware trimming and mutation strategies.
the evaluation showsthat this approachimprovesthe bug finding capabilities and code coverage compared to afl and jsfunfuzz .
finally zest integrates ideas of coverage guided fuzzing i.e.mutation basedfuzzing withcoverage feedback and random generator basedfuzzing.inparticular zesttransformsa pseudo random input generator into a deterministic parametric input generatorby mapping the random choices of the generator to fixed bit parametersequences.theseparametersequencescanbemutatedusingcommonbit levelmutationoperatorsinordertodirectly control the input generation process.
by leveraging code coverage and validity feedback zest can then automatically guide the parametricgeneratortoproduceinputsthateffectivelytestthesemantic analysis stage.
.
automated model generation in the last decade the automatic generation of instances of a given meta model has gained considerable attention by the mdse re search community.
in the sequel we review existing approaches w.r.t.totheircapabilitytogeneratevalidemfmodels whichhas emerged as a de facto standard in mdse.
the internal structure of anemf modelcan beconceptually considered as typed attributed graph aka.
asg whose node and edge types are drawn from ameta model serving as type graph a formal treatment of typing conformancecanbefound e.g.
in .inthesequel westicktothe object oriented terminology which is more common in the emf community i.e.
nodes andedges ofa model sasg arereferred to asobjectsandreferences respectively wherecontainmentsarea specific kind of reference.
an emf model is said to be valid if it adherestoallemfconstraintsasformalizedin .mostnotably each object must not have more than one container and cycles ofcontainmentsmustnotoccur.semanticvalidityisspecifiedby additionalwell formednessconstraintsdefinedbyameta model such as multiplicity constraints or arbitrary ocl expressions.existingapproachestoautomatedmodelgenerationvarysubstantially w.r.t.
the level of consistency of the generated modelsand the performance of the generation algorithm.
typically the higher the consistency guarantees the slower and less scalable the modelgeneration.fromatechnicalpointofview existingmodel generation approaches can be classified as follows.
.
.
solver based approaches.
solver based approaches generate modelsbytranslatingameta modelintoalogicalformulaandusing anoff the shelfsolvertofindpossiblesolutions.theapproaches presentedin usealloy forthis purpose.other approaches are based on csp modeling or rely on smt solvers .whilesolver basedapproachesarecapableofgenerating models that respect arbitrary well formedness constraints theirscalabilityislimitedtogeneratingprettysmallmodels .
more recently a graph solver known as viatra solver has been presented for the automated generation of valid emfmodels respecting arbitrary well formedness rules.
while exper imental results indicate that the approach performs better than existingapproachesusingalloy itsscalabilityandefficiencyisstill limited .
.
.
grammar based approaches.
grammar based approaches translateagivenmeta modelservingasdeclarativelanguagespecificationintoaconstructiveonewhichisthenusedforthesakeof modelgeneration.mougenotetal.
convertagivenmeta model intoatreegrammarwhichisusedtouniformlycreatetreestructures.
uniformity means that for a tree of given size in number of nodes themethodiscapableofuniformlygeneratingalltreestruc turesofthatsize.however modelsarereducedtotheircontainment structure which is a severe oversimplification in practice.
ehrig et al.
present an approach for converting type graphs with restricted multiplicity constraints into instance generating graph grammars that can be used to systematically enumerateall properly typed models of a modeling language.
taentzer generalizesthatapproachtoarbitrarymultiplicies.recently nassar et al.
developed the emf model generator which extends and advances the ones in and respects emf constraints as well.
.
.
mutation based approaches.
mutation basedgeneratorstake a potentiallyempty modelasinputandmanipulateitbyapplying modelmodifications.thesidiffmodel generator smg proposed by pietsch et al.
performs model manipulation by applying modeleditingoperations.however thesmgneedstobeconfigured by a stochastic controller which needs to be trained on a realworld model history.
it has mainly been developed as a testbed for evaluating different learning strategies .
in contrast the atlanmod emf random instantiator an emf based tool which is still under active devlopment can be used out of the box.
it generatesemfmodelsbyusingprobabilitydistributionsforeach meta class and property defined by the meta model with uniform distributions as the default configuration.
.
need for further research mutation based and generator based fuzzers are applied to createtestinputsindifferentinput fileformats includingxsltand xml jpegandpng javascript just tonameafew.however whilesomeofthem notablyxmlformats 1105are similar to external representations of models serialized in xmi thereisafundamentaldifferencew.r.t.totheirinternalstructure.
first structured representations of models form an abstract syntax graph asg insteadofa strictlyhierarchical documentobjectmodel aka.domtree .second thiscomplexityisfurtheraggravatedby the fact that a model s asg must at least be properly typed and adhere to validity constraints of the underlying modeling framework e.g.
emf to pass the model loading process cf.
figure .
such consistency constraints in the input files are typically not enforced by traditional xml based tools e.g.
office environments orwebbrowsers whichhavebeenconsideredassystemundertest in previous approaches on structure aware fuzzing.
on the contrary existing work on automated model generation providesthetechnologytogeneratesyntacticallyorevensemanticallyvalidmodels.however therehasbeenlimitedresearchon their capabilities for the sake of fuzz testing mdse tools.
previous applicationsofautomatedmodelgenerationincludebenchmarking model queries and transformations model driven search andoptimization orvalidatingthesuitabilityofmdsetools to deal with large input models .
an application scenario which is close to ours is model transformation testing.
this has been first addressed by fleurey et al.
motivated by the concept of equivalence classes in black box testing and later beenextended and implemented in .
the basic idea is that equivalence classes are formed by certain meta model patterns andthegeneratedmodelsshouldrepresentsuitablerepresentatives of these equivalence classes.
the goal however is to find bugsin application specific model transformations while we aim for testing generic or language specific mdse tools.
the closest related work focuses on the automated differential testing of cyber physical system cps tool chains e.g.
matlab simulink .cyfuzz randomlygenerates possiblyinvalid models and attempts to iteratively fix them based on the errormessages of the system under test.
however since this approach is unable to produce large realistic models it has been subsequently improved by incorporating semi formalspecifications as well as cps language specific mutation techniques .
while these techniqueshavebeenshowntobeeffective theyaretightlycoupled with simulink which limits the portability to other modeling languages and mdse tool suites.
in contrast our goal is to develop afuzzersuitewhichisbasedonemfandthusapplicabletoawider rangeofgeneral purposeaswellasdomain specificmdsetools.
anothertechnique deepfuzzsl learnsalanguagemodelfrom existingvalidsimulink models and isable togenerate further valid models with high probability though it requires a large number of seed models for deep learning.
since their accessibility is often limited see e.g.
we aim to abstain from relying on seed models but only require to have access to a meta model that describes the abstractsyntaxaswellasthestaticsemanticsofitsinstancemodels.
thisisareasonableassumptionsincemeta modelsarethestandard way to define a modeling language and they can be expected to be publicly available in the context of the emf ecosystem.
insum itisyetunclearwhichcombinationsoffuzzingapproaches and technologies for model generation are the most effective onesforfuzztestingmdsetools which constitutestheguiding researchquestion weaim to answerin this paper.
approach .
overview a general overview of our fuzzer suite called mofuzz is given in figure .
it takes as input the meta model of the input domain as well as the mdse tool to be tested.
internally we build upon jqf version1.
afeedback directedfuzztesting framework forjava.jqfperformson the flybytecodeinstrumentationtomea surecodecoverageandrepeatedlyexecutestheprogramundertest using inputs provided by custom input generators.
furthermore jqfprovidesimplementationsforvariousfuzzingalgorithms includingthezestalgorithm seesection2.
.
whichwillbeused as a baseline technique in our evaluation.
weprovidethreedifferentinputgenerationstrategies i agraph grammar based method that attempts to cover different aspectsof the input domain as fast as possible by leveraging a recently introduced efficient model generator and two mutation based approaches that aim to incrementally evolve inputs to exercisedeep paths using either ii a set of customly defined mutations builtontopofthegenericemfeditapi or iii asetofconsistencypreserving edit operations cpeos specified as model transformationruleswhicharegeneratedfromthegivenmeta modelusing the approach and supporting tool suite presented in .
.
generator based fuzzing the main aim of using a generator based fuzzing approach is to generate models covering different aspects of the input domainas fast as possible while adhering to a high level of consistency.
although the strongest consistency guarantees are provided by solver based generators see section .
existing tools are waytoo inefficient for our purpose of fuzzing they fail to generatelarge numbers of models in a short amount of time.
from the re maining model generators the emf model generator which has beenrecentlypresentedbynassaretal.
representsthemost promising trade off between consistency and performance.
the generated models are valid emf models which are properly typed and which respect well formedness rules up to arbitrary multiplicity constraints defined by the meta model.
additionally the tool cangeneratelargevalidmodels withuptohalfamillionelements in a few minutes in less than minutes for simple meta modelsand in about minutes for more comprehensive ones .
for the sake of self containedness we briefly recall the general model generationprocess beforewepresentthespecificconfigurationwhich is integrated into our fuzzing suite mofuzz.
.
.
graph grammar based model generation.
followingthetypicalschemaofgrammar basedapproachestomodelgeneration the emf model generator translates a meta model into a constructive languagespecification i.e.
thegrammar whichcanbethenused for the sake of model generation.
here the grammar is realized as a model transformation system mts which is implemented in therule based transformation language henshin .different kinds of rules and transformation units are designed to increasethemodel size handle andimprovethe degree of violations andto support user parameterizations.
the mts can be then used togenerate emf models according to various strategies.
typically the model generation is performed in twophases.
first the model !
!
!
!
!
!
!
!
!
!
!
figure high leveloverviewof mofuzz.
increasephasecreatesmodelelementswithoutviolatinguppermultiplicitybounds.then the modelcompletion phasecompletesthe intermediate model to a valid emf model through interacting with the model repair tool emf repair .
.
.
mofuzz specific generation strategy.
forthesakeoffuzzing weconfigurethemodelincreasephasewithtwokindsofproduction rules additional node creation andadditional edge creation.
the former create an asg object of a certain type together with its incoming containment reference from a suitable container and the latterinsertsacross treereferencebetweentwosuitableexisting objects.
the rules are derived for each meta class and reference typeofthemeta modelandequippedwithapplicationconditions to prevent introducing upper bound violations and to preserve the emf constraints.
all rules are wrapped into one so called independentunit whichiterativelyexecutesoneofitscomprisedrulesina non deterministic way.
derivedfromouroverallaimsofusingagenerator basedfuzzer the intuitions behind this strategy are as follows the rules are designed to be atomic i.e.
they perform basic changes and thus allpossiblestructuresofamodelcanbeproduced.byconstruction the rules cover all the meta model types.
thus they can broadly exploreand produce all possible valid emf models for the given meta model.moreover findingarulematchishighly efficientsince itrequiresoccurrencesofasmall sizedgraphpatterntobefound.
the classification into two different kinds of rules increases the possibility of finding an applicable rule.
additionally their atomicdesign increases the flexibility of combining them in any order.
finally thisstrategystartsthemodelgenerationprocess fromscratch and thus it is independent of the quality of a given seed model which in principle could be fed as an input into the emf model generator.thisstrategycangeneratelargemodelsefficiently.in mofuzz however we choose a setting that limits the model size to avoid scalability problems of executing the mdse tools under test thelimithasbeensetto500elementsinourexperimentspresented in section .
.
mutation based fuzzing in this approach we propose to adopt one of the most widely used techniquesinautomatedfaultdetection namelycoverage guided greyboxfuzzing cgf tothedomainofmdse.
based on a set of initial inputs cgf iteratively applies various mutations to the inputs to produce new test inputs.
the key idea is thentoretainonlythosenewinputsthatincreasecoverage thus effectively exploring the program space in an iterative manner.
in particular weproposetoimplementcgfintwophases a generation phaseand amutation phase in thegeneration phase random seed models are generated until a pre configured target meta model coverage has been achieved.
the goal is to have a diverse set of seed inputs that cover different aspects oftheprogramundertest.
however weinitializeour inputqueuewithonlythemostrecent e.g.
50asusedinourexperiments inputs that covered new parts of the mdse tool under test.
the intuitionbehind thisapproachisthat thefirst inputsusually only coverprogramlocationsthatcanbetriviallyreached.incontrast laterinputsthatarestillabletoexecuteadditionalcoveragebeyond those trivial paths may be more worthwhile to retain.
inthemutationphase aninputmodelisselectedfromthequeue and a set of mutations is applied to it.
as described earlier if the mutated input executes newcoverage it is also added to the queue otherwise it is discarded.
this process is repeated until the timeout isreachedortheusermanuallyabortstheprocess.however traditional fuzzers that utilize cgf usually operate on binary textual inputs and therefore apply mutations on the bit level which is not veryeffectivefortheinputdomainofinstancemodels.thus we requiremutationoperatorsthatoperatedirectlyonthemodel level instead.
weprovidetwoconcreteimplementationsoftheabovedescribed two phased approach namely one that makes use of the genericemf edit api section .
.
and one that is based on rule based mutations section .
.
.
.
.
custom mutations based on the generic emf edit api.
forthe first technique we use different kinds of model mutations in order to address the different requirements of each of the two phases.
sincethemutationoperatorsareimplementedbasedontheemf edit api we refer to this technique as mofuzz cgf emfedit.
generation phase forthethegenerationphase webuild upon the existing emf random instantiator developed by the naomod team formerly known as atlanmod see section .
.
.
similartotheapproachbymougenotetal.
theemfrandom instantiatorrandomlygeneratesemfmodelsbyutilizingthecontainment hierarchy defined by a given meta model in two steps first thecontainmenttreeispopulatedwithrandomlyinitialized objects in a depth first manner until a pre configured target sizeis reached.
the tree traversal may be pruned at random pointsor if a pre configured maximum depth is reached.
the result isa model that conforms to the containment hierarchy defined by the meta model.
second cross tree