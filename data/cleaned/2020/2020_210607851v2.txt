code integrity attestation for plcs using black box neural network predictions yuqi chen singapore management university singapore yuqichen smu.edu.sgchristopher m. poskitt singapore management university singapore cposkitt smu.edu.sgjun sun singapore management university singapore junsun smu.edu.sg abstract cyber physical systems cpss are widespread in critical domains and significant damage can be caused if an attacker is able to modify the code of their programmable logic controllers plcs .
unfortunately traditional techniques for attesting code integrity i.e.
verifying that it has not been modified rely on firmware access or roots of trust neither of which proprietary or legacy plcs are likely to provide.
in this paper we propose a practical code integrity checking solution based on privacy preserving black box models that instead attest the input output behaviour of plc programs.
using faithful offline copies of the plc programs we identify their most important inputs through an information flow analysis execute them on multiple combinations to collect data then train neural networks able to predict plc outputs i.e.
actuator commands from their inputs.
by exploiting the black box nature of the model our solution maintains the privacy of the original plc code and does not assume that attackers are unaware of its presence.
the trust instead comes from the fact that it is extremely hard to attack the plc code and neural networks at the same time and with consistent outcomes.
we evaluated our approach on a modern six stage water treatment plant testbed finding that it could predict actuator states from plc inputs with near accuracy and thus could detect all effective code mutations that we subjected the plcs to.
finally we found that it is not practically possible to simultaneously modify the plc code and apply discreet adversarial noise to our attesters in a way that leads to consistent mis predictions.
ccs concepts software and its engineering embedded software security and privacy embedded systems security computing methodologies neural networks .
keywords cyber physical systems programmable logic controllers attestation code integrity checking neural networks adversarial attacks permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than the author s must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse august athens greece copyright held by the owner author s .
publication rights licensed to acm.
acm isbn .
.
.
.
reference format yuqi chen christopher m. poskitt and jun sun.
.
code integrity attestation for plcs using black box neural network predictions.
in proceedings of the 29th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse august athens greece.
acm new york ny usa pages.
introduction cyber physical systems cpss characterised by their deeply intertwined software components and physical processes are prevalent in many highly sensitive domains.
they appear for example as the industrial control systems of critical public infrastructure automating complex multi stage processes such as the treatment of raw water or the management of power grids.
cpss of this kind will typically consist of sensors e.g.
flow indicators for estimating the state of the physical process actuators e.g.
motorised valves for effecting change on it as well as programmable logic controllers plcs that receive sensor readings over a network and compute the appropriate commands to send to actuators.
compromising any one of these components or plcs can potentially allow an attacker to manipulate the system into a damaging physical state.
this has motivated a huge variety of research into defending and assessing cpss spanning techniques based on anomaly detection fingerprinting invariant based monitoring trusted execution environments and fuzzing .
although these techniques successfully cover a number of different cps threat models few of the countermeasures specifically address the critical problem of attesting the integrity of plc code i.e.
verifying that no unauthorised changes have been made to the original program or memory.
this can leave the system susceptible to the effects of worms most famously stuxnet which compromised plcs in nuclear facilities to cause gas centrifuges to tear themselves apart .
incorporating an attestation solution can help improve the trustworthiness of devices connected to the physical processes assuring for example that attackers have not discreetly embedded some subtle attack scenario.
unfortunately traditional attestation solutions cannot readily be applied to the plcs that cpss use in practice.
software attestation solutions based on challenge response protocols for example require firmware access to be implemented which proprietary plc manufacturers are unlikely to provide and solutions based on root of trust technologies such as trustzone or sgx require the use of specific types of hardware from the outset preventing their use on legacy controllers or low powered embedded devices.arxiv .07851v2 jul 2021esec fse august athens greece yuqi chen christopher m. poskitt and jun sun an alternative approach is behavioural attestation orcps attestation in which the integrity of plc code is attested by comparing its behaviour against mathematical models of how it should behave.
this is a weaker form of attestation in the sense that that it cannot detect code modifications that do not cause a change of behaviour but it nonetheless can verify that a plc is always operating in the expected way.
it also has the significant advantages of being possible to deploy without requiring the modification of legacy devices any access to firmware or any access to trusted hardware features which is typically missing from real world cpss.
instead it can be implemented on independent devices e.g.
raspberry pis that read the inputs outputs of plcs verify them against mathematical models and alert plant engineers when the actual commands to actuators deviate.
these devices should of course be trustworthy too a problem we address shortly.
the main difficulty in implementing this kind of code integrity checking for plc programs is in obtaining models that are suitably expressive and accurate for predicting their behaviour and which can be trained without relying on unrealistic assumptions about the system or attackers.
in previous work we attempted to address this with an approach in which faults or mutants are injected into the plc programs and traces of abnormal sensor readings are collected.
these traces are used to train a supervised machine learning ml model that can effectively classify between behaviour resulting from the original plc programs and those that have been modified.
however this solution was only assessed on a simulator of a cps and faces several challenges to be implemented for real plcs.
in particular the large amount of data traces it requires would lead to a correspondingly large amount of wasted resources especially as many random mutations have no physical effects and must be filtered out running arbitrarily mutated plc programs in a real plant is unlikely to be allowed due to safety concerns and the solution did not explore the possibility of adversarial attackers with knowledge of the code attestation mechanism.
in this paper we propose a practical code integrity checking solutionbased on privacy preserving black box models that attest the behaviour of plc programs.
our approach can be applied to actual i.e.
not just simulated critical infrastructure without incurring any resource wastage or safety issues and without requiring any trusted hardware components.
instead of mutating code and waiting for physical effects as in we mutate the values of plc inputs and observe the actuator commands that are immediately issued as a result e.g.
open valve switch on pump .
we implement an information flow analysis to identify the most important of these manipulations then use the corresponding data to train a highly accurate neural network for predicting actuator commands from plc inputs which can thus be used to attest the actual outputs.
the practicality and generality of our approach is due the fact that data collection and model training can be done entirely with offline copies of the plc code that fully characterise the cyber part of the system we avoid the need for any complex and likely inaccurate process modelling eschewing the costs and risks of using the real system during training.
furthermore our solution exploits the black box nature of the model to ensure that the attester protects the privacy of the original plc code and that it remains trustworthy in the presence of attackers who are aware of it and even know the parameters of the model.
the trust instead comes from the fact thatit is extremely hard to attack plc code and an ensemble of neural networks at the same time and with consistent outcomes .
to evaluate our approach we implemented our behavioural attestation solution for the secure water treatment swat testbed a scaled down version of a modern six stage water purification plant.
swat involves chemical processes such as ultrafiltration dechlorination and reverse osmosis controlled by six plcs that communicate with each other and sensors actuators over a layered network hierarchy.
using faithful cross validated python translations of its plc programs we identified the most important inputs i.e.
sensor readings actuator states and variables generated data sets relating them to outputs i.e.
actuator commands then trained multi class neural networks for predicting actuator states from different input values.
we found them to be effective as attestation models achieving near prediction accuracy and able to detect all of a series of effective plc code modification attacks.
finally given that recent work has shown neural networks to be susceptible to adversarial attacks i.e.
inputs specially crafted using knowledge of the models in order to cause them to make mistakes we subjected our solution to an adversarial attacker finding that it was not practically possible to change the behaviour of plcs while simultaneously causing the attesters to make consistent mis predictions using discreet adversarial noise.
organisation.
in section we present an overview of the swat testbed plc programs existing approaches for remotely attesting code integrity and then describe the threat model assumed in our work.
in section we introduce our behavioural attestation solution for plc code describing how to implement it for cpss in general as well as for swat specifically.
in section we evaluate the effectiveness of our technique for protecting cpss against code modification attacks and adversarial attacks.
in section we discuss some related work before concluding in section .
background in this section we present an overview of swat the water treatment testbed we use to evaluate our approach.
following this we review existing solutions for remotely attesting code integrity then give a summary of and justification for our threat model.
swat testbed.
the secure water treatment swat testbed figures is a scaled down version of a real world water purification plant intended to support research into techniques for defending and securing critical infrastructure.
swat is capable of producing up to five gallons of safe drinking water per minute which it does so through a six stage process involving steps such as de chlorination reverse osmosis and ultrafiltration.
the testbed has been the subject of multiple hackathons involving researchers from both academia and industry.
furthermore a comprehensive dataset generated from seven days of swat s normal operation as well as four days with attack scenarios is available for download and has been used as a benchmark for evaluating multiple different cps defence and testing techniques.
the six stages of swat are controlled by dedicated allen bradley controllogix programmable logic controllers plcs which communicate with each other as well as the sensors and actuatorscode integrity attestation for plcs using black box neural network predictions esec fse august athens greece fit101mv101p101 p102stage plc raw water storestage plc chemical dosingnacl tank t201 p201 2p203 4fit201ait201hcl tank t202 naocl tank t203 p205 6staticmixerstage plc ultrafiltration uf uf feedwater tank t301 lit301ufsystemp301 p302fit301dpit301mv302ait301ait302ait303stage plc dechlorinationstaticmixerp401 p402ait401fit401nahso3 tank t402 uvdechlor.stage plc reverse osmosis ro stage plc backwash ait202ait203mv201 ait402cartridgefilterp501 p502 ait501ait502ait503fit501rosystemuf backwashtank t602 ait504fit502mv501fit503mv502mv503ro permeatetank t601 p601mv301lit101raw watertank t101 p403 p404p602ro feedwater tank t401 lit401 figure simplified overview of swat blue arrows indicate water flow dashed solid rectangles indicate sensors actuators figure the secure water treatment swat testbed relevant to each stage.
each plc cycles through its program computing the appropriate commands to send to actuators based on the latest sensor readings and values of various input variables of which there are across the six plcs .
the system consists of sensors in total including water flow indicator transmitters fits tank level indicator transmitters lits and chemical analyser indicator transmitters aits .
among the actuators are motorised valves mvs for controlling the inflow of water to tanks and pumps ps for pumping the water out.
figure provides an overview of the six stages as well as the main sensors and actuators involved.
the network of the swat testbed is organised into a layered hierarchy compliant with the isa99 standard providing different levels of segmentation and traffic control.
the upper layers of the hierarchy levels and respectively handle operation management e.g.
the data logging historian and supervisory control e.g.
touch panel engineering workstation .
level is a star network connecting the plcs and implements the common industrial protocol cip over ethernet ip.
finally the lowest layer of the hierarchy is level which consists of ring networks ethernet ip over udp that connect individual plcs to their relevant sensors and actuators.the sensors in swat are associated with manufacturer defined ranges of safevalues which they are expected to remain within at all times during normal operation.
if a sensor reports a true reading outside of this range we say the physical state of the cps has become unsafe .
if a level indicator transmitter for example reports that the raw water tank in stage one has become more than a certain percentage full or empty then the physical state has become unsafe due to the risk of an overflow or underflow .
unsafe pressure states indicate the risk of a pipe bursting and unsafe levels of water flow indicate the risk of possible cascading effects in other parts of the system.
swat implements a number of standard safety and security measures for water treatment plants such as alarms reported to the operator for when these thresholds are crossed and logic checks for commands that are exchanged between the plcs.
scada software and tools developed by rockwell automation are available to allow the plant engineer to monitor and intervene in the system.
in addition several defence mechanisms developed by researchers have been installed see section .
some of these are based on offline analyses i.e.
that use sensor and actuator data logged by the system s historian.
plc programs.
plcs are programmed using domain specific languages that were designed for engineers without a traditional programming background.
the iec open standard supports five different high level languages for plc programming including textual languages e.g.
structured text instruction list as well as visual languages e.g.
ladder diagram function block diagram .
we focus on plc programs written using the structured text language in which programs are block structured and syntactically similar to pascal.
roos compares the constructs of pascal and structured text e.g.
iteration case blocks highlighting the total absence of recursion in the latter.
note that while our paper focuses on one plc language the black box nature of our approach allows it to be applied to plcs programmed in any other.
the example code snippet from plc1 of swat in figure left implements the control logic of the raw water inlet valve mv101 and pumps p101 p102 in the process of opening the raw water outlet valve mv201.
specifically the variable mv101 sr.enablein whenesec fse august athens greece yuqi chen christopher m. poskitt and jun sun open raw water outlet valve mv201 mv raw water inlet valve control mv 101 sr.enablein mv 101 sr.set hmi lit101.al mv 101 sr.reset hmi lit101.ah setd mv 101 sr mv101 autoinp mv 101 sr.out p raw water duty sr.enablein p raw water duty sr.set hmi mv201.status and hmi lit301.al p raw water duty sr.reset hmi mv201.status or hmi lit301.ah setd p raw water duty sr p raw water duty autoinp p raw water duty sr.out if hmi p1 shutdown then hmi p1 state hmi p1 shutdown end if open raw water outlet valve mv201 mv raw water inlet valve control mv 101 sr.enablein mv 101 sr.set mv 101 sr.reset hmi lit101.ah setd mv 101 sr mv101 autoinp mv 101 sr.out p raw water duty sr.enablein p raw water duty sr.set hmi mv201.status and hmi lit301.al p raw water duty sr.reset hmi mv201.status or hmi lit301.ah setd p raw water duty sr p raw water duty autoinp p raw water duty sr.out if hmi p1 shutdown then hmi p1 state hmi p1 shutdown end if figure structured text program snippet from plc1 of swat before left and after right a code modification attack assigned to indicates that the system should open mv101 in this process by default.
hmi lit101.al andhmi lit101.ah are the low and high alarms for the water level of tank t101.
alarms are critical thresholds for certain sensors in swat.
if the sensor value reaches a threshold it will raise the corresponding alarm.
function setd is called to check whether some critical conditions are satisfied which may influence the behaviour of the corresponding actuator.
in this example if the low alarm for lit101 is triggered mv101 should be opened and if the high alarm for lit101 is triggered mv101 should be closed.
the logic of pump p101 p102 is similar.
pump p101 should be on in this process while p102 as a standby should be off all the time unless p101 malfunctions.
meanwhile if mv201 is open and the lit301 raises a low alarm pump p101 should be switched on.
if mv201 is not open or lit301 raises a high alarm then pump p101 should be switched off.
finally if the system receives the shutdown command the process of opening mv201 will be over.
the right side of figure is the same code snippet but during a code modification attack.
in this example we assume that the attacker maliciously modifies the plc code to assign the values of mv101 sr.enablein and mv 101 sr.set to .
when the modified code is executed by the system in this process the valve mv101 will be closed perpetually.
as mv101 is the raw water inlet valve water will not flow into tank t101.
as a consequence tank t101 may underflow while the whole process of water treatment will terminate.
remote attestation.
there are two main categories of techniques for attesting the code integrity of remote embedded devices.
first hardware attestation which assumes that the remote device has some trusted platform module tpm or other kind of trust anchor e.g.
support for arm trustzone or intel sgx .
typically a verifier issues a challenge to the remote device the prover which computes a cryptographic signature or message authentication code over the challenge and a hash of the binary code being attested .
it is also possible to remotely attest some dynamic runtime behaviours e.g.
control flow .
unfortunately the requirement for specific types of hardware may prevent the use of such techniques in cpss that use legacy plcs or low powered embedded devices unless they can be interfaced with separate tpm boards .second software attestation which is intended for resourceconstrained devices that are unable to implement schemes based on trusted hardware level support.
these are also challenge response schemes but the main difference is that the verifier determines whether or not the prover has been compromised by relying on the amount of time required to compute a response .
seshadri et al.
proposed the first software attestation scheme which computed a checksum over the memory of the prover in a such a way that an attacker cannot modify that memory without changing the amount of time required to compute the correct checksum.
to implement such schemes a procedure must be either pre programmed into the remote device s memory or downloaded from the verifier.
some recent versions of plc firmware e.g.
in the siemens s7 series include apis for checksum generation over control logic which can help support some software attestation schemes but without this software attestation may be challenging in general as plcs are typically proprietary and manufacturers may be unwilling to support firmware access.
given the challenges of applying hardware and software attestation techniques to cpss a third category of techniques has emerged in which controllers are attested by comparing their behaviour against mathematical models of how they should behave.
valente et al.
for example propose that verifiers introduce false control signals and compare the system dynamics against a model to attest that sensors and controllers are operating correctly.
roth and mcmillin similarly use process feedback to implement a distributed attestation protocol for a smart grid.
as neither of these behavioural attestation schemes require hardware or firmware access they can be applied to cpss such as swat once a suitably expressive and accurate model has been constructed for predicting the controllers effects on sensors and actuators as discussed in section .
threat model.
we assume that potential attackers are insiders i.e.
attackers originating within the organisation who have access to the plc code as well as the ability to arbitrarily modify it.
as attackers need to be able to check whether their plc code modifications successfully brought about unsafe physical states we assume that they are able to access the true sensor readings by some means.
furthermore we assume that attackers are aware of the presencecode integrity attestation for plcs using black box neural network predictions esec fse august athens greece algorithm learning a model for attestation input plcp set of labels lencoding all combinations of actuator commands output model for attestation mp 1translate program of pto imperative program cpwith an ordered vector of inputs icp 2cross validate cpagainst data traces from p 3identify the most important inputs i cpofcp alg.
4traindata 5repeat randomly generate values for all inputs icpand runcp on them letl ldenote the label encoding the actuator commands issued by cp 8traindata traindata l where thevis are the values of i cp 9until timeout 10train a model mpontraindata 11returnmp of plc attesters have full knowledge about their underlying models e.g.
the parameters of the neural networks and are able to intercept and modify the sensor actuator and input variable values received by the plcs and attesters note that attesters and plcs are physically connected on the same network and thus receive the same inputs .
these are standard assumptions in the context of attackers that are able to craft adversarial samples .
in practice insiders may only have a strict subset of these abilities but by assessing our plc attesters against a theoretically powerful attacker we can conclude that we can also defend against weaker attackers that may exist in reality.
approach and implementation the overall goal of our approach is to be able to remotely attest that plcs are behaving in the same way as they would under their original programs without requiring any trusted hardware without requiring resource intensive training methods and without requiring the unrealistic assumption that our verifiers are themselves impenetrable from attack.
to achieve this we propose a practical and general attestation solution based on predictive models for plc inputs outputs.
our models can be trained entirely on offline code while remaining highly accurate for the real cps.
our approach consists of the following main steps.
first input output data collection using faithful offline copies of the plc programs with the most important inputs identified using an information flow analysis.
second the training and validation of neural network models for predicting plc behaviours.
algorithm provides a high level overview of these two steps for obtaining a model.
finally with the models obtained their deployment in devices to behaviourally attest the plcs of the real system.
in the following we describe how to implement these three broad steps in general and how they were implemented for the swat water treatment testbed section in particular.
.
data collection by input mutation in this step we convert the plc programs e.g.
structured text code to equivalent imperative programs e.g.
in python that can be utilised for data collection offline.
following this we perform an information flow analysis to identify the most important inputs for a given plc i.e.
those most likely to lead to a change in behaviour and then repeatedly execute the offline version on different values of those inputs to determine what the digital output commands to the actuators would be.
the goal of this data collection is to be able to train models on sufficiently large sets of input output relations so as to cover as many normal and abnormal e.g.
exception handling scenarios as possible.
offline plc code.
the main prerequisite to implement our approach for a cps is to have faithful offline copies of its plc programs written in an imperative programming language.
this is a reasonable assumption to make a plc program e.g.
ladder logic function block diagram or structured text largely consists of a sequence of assignments and conditional statements that are executed repeatedly over a continuous loop.
this kind of logic is easily translated to the control structures of traditional imperative languages.
for cpss with multiple plcs we translate each plc into a separate script that can be run independently.
this assumption can be made as the outputs are determined uniquely by the inputs plcs are deterministic .
furthermore when considering a plc in isolation process modelling is not required to compute the output.
implementation for swat.
we satisfied this prerequisite by adapting the swat simulator used in previous work which contains python translations of the six actual plc programs i.e.
faithful translations of the original structured text code such as figure .
our adaptation extends the simulator by adding the control logic for chemical processes and pressure the original version focused only on water flow.
we did not require the partial process models included in the original simulator which approximated the physics of water flow.
instead we use only the simulated plc code which has been translated accurately and cross validated against the real plcs operating in the testbed.
identifying important inputs.
before mutating inputs we must first identify which of the inputs should be targeted.
real world plcs often process a large number of inputs and attempting to include all of them may lead to challenges in scalability especially when it comes to training using a larger feature vector would require more data and could lead to a more complicated model.
to address this we propose an information flow analysis on the offline plc code to determine which of the inputs are most important in the sense that they are most likely to have an effect on the output.
in particular we perform a dynamic dependency analysis that repeatedly mutates subsets of plc inputs executes the code then increases an importance score for those inputs if the mutations changed the output.
after several iterations the most important inputs i.e.
with the highest importance scores can then be selected for constructing the feature vectors used in training.
algorithm summarises the steps of this process which was inspired by the information flow analysis of mathis et al.
but simplified to the setting of plc programs.
as the main body of plcesec fse august athens greece yuqi chen christopher m. poskitt and jun sun algorithm identifying the most important inputs input plc codecp vector ofninputsicp number of inputs to select m set of labels lencoding actuator commands output important inputs i cp icp where i cp m 1initialise importance scores s where s n 2repeat construct a vector v of values for icp extracted from a normal data trace letl ldenote the label encoding the actuator commands issued by cponv constructk a set of randomly selected indices k n fork kdo constructv fromvby randomly mutating the value ofvk letlk ldenote the label encoding the actuator commands issued by cponv iflk lthen s s 11until timeout 12slicei cpfromicpby selecting the minputs with highest importance scores in s 13returni cp code is essentially a while loop with a big switch case structure we do not instrument the code at intermediate points but rather mutate different input values at random then observe and score the effects that these mutations have on the output.
again this can be determined entirely by executing the offline plc code and does not require any process modelling.
intuitively algorithm works as follows.
first it instantiates the inputs with some values from a normal data trace e.g.
extracted from a historian and executes the offline code on them to determine the actuator commands that would be issued.
second a subset of the values are mutated independently and separately if running the program again returns a different output an importance score for the input is increased.
finally after repeating the first two steps a number of times the inputs with the highest importance score are returned.
this simple and practical approximation can be used to select subsets of plc inputs that are more likely to be useful for learning a model.
implementation for swat.
the number of important inputs was manageable enough that all important inputs could be used in feature vectors see section .
that is we used our analysis simply to identify the inputs that accumulated any importance score above zero.
as a result we included all sensor readings actuator states and variables concerning plc state as input.
we excluded variables that our analysis did not find to be important for our predictions such as timers and healthy state variables which only serve to raise alarms in the scada.
generating inputs.
once the important input variables of a plc have been identified data collection can begin.
we are aiming totrain models on combinations of important inputs and the corresponding digital outputs of plcs.
as the outputs are determined uniquely and deterministically by the plc program this is achieved simply by repeatedly generating multiple important input values at once executing the offline plc code on them and logging the digital output commands issued.
this is done without reference to the physical process and thus can be repeated for any combination of valid inputs without the concerns of time i.e.
due to slow processes safety or resource wastage.
furthermore this approach is general and can be applied to a number of different cpss owing to the fact that process modelling is not required and that plc programs are treated as black boxes.
in order to be able to train the model on sufficiently large data sets covering both normal and exception handling scenarios and given that there is little cost to execute offline plc code we use a simple random mutation strategy to generate important input values.
in general there may be some heuristic strategies for generating important inputs but they may lead to bias in the learnt models as methods that influence the sampling probability lead to sampling bias.
for example we could use importance as the criterion of a heuristic strategy but then the sampling probability of inputs with larger importance scores is higher perhaps leading to a model that is less accurate on inputs with lower importance.
implementation for swat.
for swat we consider each offline plc program in turn.
the input values passed to each plc consist of actuator states the values of plc variables and discretised representations of sensor readings in the form of alarms .
for example the continuous sensor reading of tank level sensor lit101 can trigger four alarms lit101.h lit101.hh lit101.l lit101.ll indicating four different height marks high highhigh low lowlow .
we randomly generate several different combinations of inputs alarms actuators variables execute the offline plc programs on them and collect the digital actuator commands returned as output.
we repeat this process until a certain amount of input output data has been collected as determined by experimentation see section .
.
model training and validation in this next step we use the data we collected to train models for predicting plc behaviour then validate that the predictions learnt from the offline code are also correct for the real plcs.
model training.
with raw input output data collected from our offline plc programs the next step is to organise that data into feature vectors that can be trained on by an appropriate learning algorithm e.g.
neural network .
in this work we assume that the digital outputs of plcs are actuator commands each indicating one of a finite number of discrete states that they should enter e.g.
actuator a123 on .
with this assumption we can learn multiclass single label classifiers in which the label represents a unique combination of discrete actuator states i.e.
as commanded by the plc outputs .
our feature vectors then consist of a fixed order of values for a number of important inputs with a single label representing the combination of actuator states that this would achieve.
these are easily constructed from the raw input output data collected in the previous step.code integrity attestation for plcs using black box neural network predictions esec fse august athens greece alarmssensorsactuator statesvariablesnn1attestationmodel nn2 oralternative newactuator states figure behavioural attestation model for swat once the feature vectors have been collected we use them to train a supervised ml model.
in particular we explore neural networks.
while certain other models explored experimentally in section are capable of learning the input output relation neural networks are an appropriate choice for our context as we can exploit their black box nature.
first they obfuscate the structure and workings of the plc programs ensuring that the attester maintains the privacy of that code difficult to infer it from the neural network alone .
second it is extremely difficult to attack both the plc code and the neural network at the same time in the sense of adding a wrong behaviour to the plc and manipulating the neural network to consistently make that altered prediction.
this gives an additional level of implicit trust that simpler models do not have.
implementation for swat.
the model required figure for swat is slightly more complicated as the plc program expects not sensor readings but rather alarm values e.g.
lit101.hh section .
.
while it is possible to add some pre processing code that maps sensor readings to alarms given the presence of adversarial attackers we instead chose to obfuscate this mapping by using a multi label neural network single layer sigmoid activation for each node in the output layer .
this neural network identified as nn1 in figure then feeds alarm values as inputs to the main and more complicated neural network we use for attestation nn2.
to train nn1 we use a simple program that randomly generates a large amount of sensor data and their associated alarms the mappings of which are known in this case .
we then train individual neural networks for single sensors before combining them all into nn1 which is highly accurate essentially .
to train the main model i.e.
the more complicated nn2 we organise the raw inputs into feature vectors and corresponding output labels l where the vector contains a fixed order of alarm values nn si actuator states ai and variable values vi.
note that for swat s plcs we include allimportant sensors actuators and state variables we exclude timers and healthy state variables which are used to raise alarms to the scada system .
here lindicates a label that represents a unique combination of the actuator states relevant for the particular plc.
in plc1 for example there are three actuators motorised valve mv101 and pumps p101 p102.
we can uniquely represent the combination of their states using bits two bits for mv101 which can be open closed or changing between the two and one bit for each pump which can be on or off .
the label i.e.
for example represents the state in which pumps p101 p102 are on and valve mv101 is closed.
these feature vectors are then used to train a neural network nn2 with two hidden layers containing and neurons respectively relu as the activation function adam as the optimiser learning rate of .
cross entropy loss function .
in section we also learn other kinds of models that could be used in conjunction to further build trust.
model validation.
before utilising the learnt models as part of our remote attestation solution it is important to validate that their predictions are also correct with respect to the realsystem a discrepancy could occur for example if there was a bug in the plc code translation .
to validate our models we need to collect data by running the actual system under a range of normal conditions that span as many of the model inputs as possible.
after this period of time we extract the data logs from the system s historian and perform a simple analysis for every combination of inputs relevant to a plc at time t extract from the logs the states of relevant actuators at timet i then check that these are the same states as predicted by the models for those inputs.
the value of iis determined to reflect the maximum amount of time required for an actuator command to take effect in the system as the state transition is typically not instant .
apart from checking the future states we can compare the commands generated by the cyber part directly and immediately.
implementation for swat.
we validated our models against data extracted from live runs of the real system including sensor actuator and variable data arranged in a time series.
we combined multiple runs of the system approximately four hours in total from different starting points selected to maximise the dataset s coverage of normal states and thus ensure a larger number of combinations of plc inputs.
our validation experiment section then proceeded as described in the general case but with different values forito account for the different lengths of time it takes for a pump to change state less than a second and a motorised valve to fully open or close approximately seconds .
note that the actuator commands start taking effect immediately and these time delays are only to account for how long it takes for the actuators to complete their actions.
.
attesting the behavioural integrity of code in this final step of our approach we use our learnt models to build a remote attestation solution for the real plcs.
intuitively the idea is to constantly monitor the actual inputs outputs of those plcs check them against the predictions of the models and raise an alarm should the behaviour ever differ.
code attestation of this kind can be implemented in the workstation or on independent devices e.g.
raspberry pis attached to the plcs that are able to read the inputs plcs receive and the commands they send out.
our attestation scheme is simple yet practical for cpss as it can be implemented for any kind of plc regardless of language or hardware.
as we focus on modelling the control logic we avoid the limitations of works e.g.
that assume the existence of accurate and comprehensive models of the physical processes.
while simple to implement our approach maintains a high level of trust in the presence of powerful adversarial attackers withesec fse august athens greece yuqi chen christopher m. poskitt and jun sun knowledge of the attesters and their underlying models.
we exploit the black box nature of the underlying neural network to protect the privacy of the original plc code and rely on the fact that it is near impossible to change the behaviour of the plc code and manipulate the neural network in such a way that it makes the same wrong prediction for that case.
in addition our attesting devices can run an ensemble of different predictive models simultaneously such as multiple variants of neural networks or a support vector machine svm in order to reduce the chances of adversarial attackers succeeding and increase overall trust.
implementation for swat.
our behavioural attestation solution for swat follows exactly the aforementioned scheme we expand upon details of the particular attestation models trained and attacks detected in our evaluation section .
evaluation we evaluate the effectiveness of our cps attestation approach for detecting code modification attacks using its implementation for the swat testbed section .
.
research questions our evaluation is designed around the following key research questions rqs rq1 training which combination of data size and learning algorithm leads to the most accurate model?
rq2 validation is our attester able to effectively predict commands in a real system?
rq3 attack detection is our attester able to detect code modification attacks?
rq4 adversarial attacks is our attester robust against attackers with knowledge of the model?
rq1 is concerned with the factors that lead to the most accurate model for predicting actuator commands from plc inputs.
these include the amount of data required and the variant of learning algorithm.
rq2 is concerned with validating that the learnt models of our attesters are capable of making accurate predictions for the real plcs and not just the offline translations of them .
finally rq3 and rq4 are concerned with the effectiveness of our solution at fulfilling its primary purpose detecting attacks.
these include code modification attacks as well as adversarial attacks that exploit knowledge of the model s parameters in order to go undetected.
.
experiments and discussion we present the design of our experiments for each rq in turn as well as the results and conclusions that we draw from them.
the programs developed to implement these experiments on the swat testbed are all available online .
rq1 training .
our first rq considers which combination of learning algorithm and training dataset size leads to the most accurate model for attestation.
to investigate this based on the method described in section we train models for all six of swat s plcs using sets of data containing between and feature vectors at intervals of .
the input values for each set is randomly generated afreshtable accuracy higher is better of the neural network attesters after training on different amounts of data data plc1 plc2 plc3 plc4 plc5 plc6 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
table accuracy higher is better of the svm attesters after training on different amounts of data data plc1 plc2 plc3 plc4 plc5 plc6 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
table accuracy higher is better of the random forest attesters after training on different amounts of data data plc1 plc2 plc3 plc4 plc5 plc6 .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
each time i.e.
the combinations of input values are not necessarily included in the combinations of inputs values etc.
.
in addition to neural networks we also train svm models and random forests rfs to assess their potential use in an ensemble of attestation models.
for each variant of learnt model we calculate its accuracy using fold cross validation obtaining a ratio that indicates the number of correct predictions the classifier made for the feature vectors in the training set.
a value of indicates that all predictions were wrong whereas indicates that all predictions were correct.
results.
tables and present the results of this experiment.
ultimately accuracy is very high across the board for our neural network and svm models indicating that the models are expressive enough to accurately predict the outputs of plcs for every process of swat.
the rf models however suffer from lower accuracies for plcs which we suspect is due to their sensitivity to large numbers of features as well as the larger number of plc state variables in particular such variables in plc5.
while our nn and svm models are already very accurate for training sets of size we choose to fix as our amount of training data for thecode integrity attestation for plcs using black box neural network predictions esec fse august athens greece table false alarm rates lower is better for different attestation models before retraining model plc1 plc2 plc3 plc4 plc5 plc6 nn .
.
.
.
svm .
.
.
.
rf .
.
.
.
.
.
remaining experiments to maximise the accuracy.
given that the data is collected entirely from the offline plc code i.e.
no process simulation involved it can be collected very quickly.
our neural network attestation model achieves near accuracy across all data set sizes.
rq2 validation .
although our first rq established that our neural network models are highly accurate this is based on training data obtained from the offline plc programs.
in this rq we aim to consider whether the accuracy of the models also translates to the realplcs of the cps.
to investigate this we performed multiple runs of the swat testbed and collected a comprehensive dataset consisting of sensor actuator and variable values.
rather than run the system continuously we initialised multiple runs from different starting configurations in order to maximise a simple coverage criterion to cover all normal states of swat.
we collected hours of data from this process covering all normal states and thus maximising the number of different plc inputs to validate our models against.
for each row of data we extracted the inputs and fed them to our learnt model then compared the actuator states predicted against the actualactuator states logged after a number of seconds.
in particular we checked after 1s for pumps whereas for valves which change state more slowly we checked for predicted changes between 710s after the command is issued.
for each model we calculated thefalse alarm rate i.e.
a ratio expressing the number of wrongly predicted actuator states as swat was not under attack all such wrong predictions would be considered false attestation alarms .
a value of indicates that there were no false alarms a value of indicates that every prediction was considered a false alarm.
results.
table presents our results for the plc attesters across all variants.
our neural network and svm models perform very well with near zero false predictions for plcs and .
the neural network outperformed the svm model on plc4 seeing false alarm rates of .
and .
respectively.
the rf model interestingly had some success for plc4 .
but in most cases performed much more poorly than the other models.
using the rf would be ineffective in practice due to the large number of false alarms raised.
despite the near zero false alarm rates for plcs and the neural network as well as the svm model performed surprisingly poorly for plc2 .
.
upon investigation we found that the model was predicting just one combination of inputs incorrectly and that this particular combination appeared several times in the dataset i.e.
bias .
we added copies of the correctly labelled feature vectors to the training set retrained the neural network and were able to achieve a new false alarm rate for plc2 of .
.
for svm .
for rf .following its re training our neural network attestation model can predict future actuator states with practically no false positives.
rq3 attack detection .
our third rq is concerned with the utility of our attestation solution can it actually detect attacks in practice?
in particular can it detect code modification attacks on the plcs?
given that we are attesting the behavioural integrity of plc code we refine this question further to whether attacks that change the input output behaviour of the plcs in any way can be detected?
to investigate this question we designed a similar experiment to that of our previous work and randomly generated mutants for every plc program using their faithful offline translations.
we randomly generated mutants for each plc using the same mutation operators as to generate one mutation per copy.
furthermore we also had to ensure that our mutants were effective .
in our previous work this was done by running the mutated code on a simulated physical process.
in our new approach we only need the fully accurate plc code to establish effectiveness.
in particular given a mutant program and the original we run both with randomly generated inputs until we uncover different actuator outputs establishing the effectiveness of the given mutant if no differences in output are found the mutant is discarded and replaced .
for each set of effective mutants we then randomly generate inputs until we have that produce different outputs between the mutant and the original.
finally for each of these inputs we use our attestation model to predict what the normal output should be for the given inputs and deem the attack detected if the prediction is different from the outputs caused by the mutant.
results.
we used our neural network and svm attestation models to make predictions for all combinations of inputs i.e.
effective input combinations for each of the mutants .
we found that both the models could detect all mutants across all the input combinations i.e.
the predictions differed from the abnormal outputs of the mutants suggesting their efficacy for detecting code modification attacks.
as our rf model had high false alarm rates rq2 we could not meaningfully evaluate it as a detector.
our plc code attesters were able to detect all code modification attacks with success.
rq4 adversarial attacks .
our fourth and final rq assesses the robustness of our models against adversarial attackers i.e.
attackers that have knowledge of the model s parameters and can craft noise designed to cause it to make an incorrect prediction e.g.
to mask a code modification in the actual plc .
this experiment is important as recent work e.g.
suggests that neural networks are brittle against adversarial samples.
we investigate the rq in two parts is the adversarial attacker able to achieve anychange of behaviour within various bounds of noise and is the adversarial attacker able to achieve a specific change of behaviour within those same bounds of noise?
to investigate these questions first the attacker must tackle nn1 figure the neural network that maps sensor readings to alarms.
essentially the attacker applies small amounts of noise within bounds of and to combinations of inputs extracted from the normal dataset in order to computeesec fse august athens greece yuqi chen christopher m. poskitt and jun sun table success rates adding noise to achieve anychange of output for nn2 noise nn .
.
.
svm .
.
.
table success rates adding noise to achieve a particular change of output for nn2 noise nn .
.
.
svm .
.
.
which alarms it is capable of changing.
note that any amount of noise larger than this is very likely to be detected by other defence mechanisms in the system.
then for part the attacker searches for a combination of these alarms that causes one of the actuator commands in nn2 s output to change marking a success if such a combination can be found.
for part we randomly sample input values from the normal dataset and compute the outputs that nn2 will give for each of them.
next we flip one of the actuator commands in these computed outputs and then have the adversarial attacker search for alarms that it can modify within the noise bound that bring about that same actuator output.
this essentially represents a scenario where an attacker is attempting to cause a specific mis prediction so as to mask a separate plc code modification attack.
results.
table presents the success rates for an adversarial attacker engaging in the first scenario described earlier.
again given a set of inputs success is declared if the attacker is able to determine the alarms it can manipulate by applying n of noise to sensor inputs and use those alarms to change anyof the outputs of nn2.
as can be seen for both our neural network and svm models the attacker only becomes successful at effecting change for the higher bounds of noise.
these are large levels of noise which are likely to be detected by other standard defence mechanisms in the system e.g.
anomaly detectors or invariant checkers.
table presents the success rates for an adversarial attacker engaging in the second scenario.
this time success is declared if the attacker is able to determine the alarms it can manipulate by applyingn of noise to sensor inputs and use those alarms to change the outputs of nn2 to some specific output.
in comparison to the first scenario the success rates of the attackers plunge e.g.
.
for neural networks using noise and the numbers remain very low even for higher levels of noise less than .02for neural networks .
these numbers illustrate the challenge an attacker would face in their goal to change the behaviour of a plc and then also manipulate the attestation model to make a consistent mis prediction.
even if such a powerful attacker existed achieving a desired and consistent manipulation within a reasonable amount of time is unlikely to be practical.
it is not practically possible for an adversarial attacker to consistently manipulate the plc code and the model using discreet levels of noise.we remark that according to our threat model the attacker could also potentially change one of the actuator values fed as input to nn2.
however this would be caught immediately as actuator values are discrete as opposed to continuous sensor values in which noise can affect the neural network but not the plc .
.
threats to validity and limitations there are some threats to the validity of our results.
first as our experiments were applied to a single cps it is possible that the results do not generalise to other systems.
however we highlight that our approach was designed with generality as a principal goal unlike previous attestation work e.g.
we do not require any process modelling to train our attestation models we only need faithful offline copies of the plc code.
for swat we translated and learnt from programs written in an industry standard language structured text suggesting that the plcs of other systems should be possible to translate and train on too.
second owing to the lack of benchmarks for code modification attacks on cpss and the lack of documented code modification attacks for swat specifically we followed our previous work in evaluating the attesters on randomly generated code modification attacks i.e.
mutants .
it is possible that these mutants are not representative of the modifications that an intelligent attacker might make and that our results might not apply to certain zero day attacks.
however the high levels of accuracy success rates for random effective code modifications and the solution s robustness against consistent adversarial attacks increase our confidence.
the main limitation of our approach is that code modifications are only detected at the moment they impact the black box input output behaviour of a plc.
unlike traditional hardware and software attestation approaches section we would not be able to to detect a modification that has no impact on the plc s behaviour e.g.
the equivalent of skip .
in practice however plc attackers must change the input output behaviour to eventually be able to cause physical damage elsewhere in the system.
our approach can detect an incorrect command the moment it occurs and immediately issue a warning.
related work in this section we highlight some related work addressing the broader themes of this paper ensuring the integrity of cpss and critical infrastructure in particular.
note that key related work specifically addressing the remote attestation of embedded devices was reviewed earlier in section .
several different approaches have emerged over the last few years for detecting and preventing cps attacks.
these include techniques based on anomaly detection where the logs of the physical data are analysed to identify suspicious events and anomalous behaviours digital fingerprinting where sensors are checked for spoofing by monitoring time and frequency domain features from sensor and process noise and invariant based checkers which monitor for violations of invariant properties over sensor and actuator states .
a key difference between many of these works and ours aside from the specific target of code modification attacks is the need for either significantcode integrity attestation for plcs using black box neural network predictions esec fse august athens greece amounts of data from the real system for training or knowledge of the underlying processes and control operations e.g.
for designing physical invariants .
ultimately we see these approaches as complimentary to our code integrity checking approach fingerprinting approaches for example might complement our behavioural attesters by detecting adversarial noise in the network section .
the strengths and weaknesses of different countermeasures has been the focus of various studies.
erba and tippenhauer spoof sensor values e.g.
using precomputed patterns and are able to evade three black box anomaly detectors published at top security conferences highlighting the need for complementary approaches such as ours.
urbina et al.
evaluated several attack detection mechanisms in a comprehensive review concluding that many of them are not limiting the impact of stealthy attacks.
our code integrity checking solution addresses this point in the sense that we assume attackers may have knowledge of the attestation model then exploit the black box nature of the neural network in order to maintain trust.
c rdenas et al.
propose a general framework for assessing attack detection mechanisms but in contrast to the previous works focus on the business cases between different solutions.
for example they consider the cost benefit trade offs and attack threats associated with different methods e.g.
centralised vs. distributed.
sun et al.
systemise existing knowledge on plc code modification attacks specifically concluding that plcs need a full chain of protection where solutions such as ours are used in tandem with complementary approaches e.g.
based on formal verification e.g.
or stealthy attack detection.
the need to develop a chain of protection for plcs is further motivated by the emergence of advanced attacks that target these devices specifically .
garcia et al.
for example demonstrate a feasible attack within the firmware of allen bradley plcs using a physics aware rootkit that can modify control commands before they are sent out to actuators.
plcs can also fall prey to worms such as plc blaster which injects malicious control logic into vulnerable plcs identified after a network scan.
our plc code attestation solution is specifically designed to detect such changes in behaviour but will only do so once the injected code is executed and the actuator commands issued are changed.
this defence strategy could be complemented by a number of other plccompatible approaches e.g.
dynamically generating monitoring control invariants from scada logs fingerprinting mining temporal invariants dependencies for safety vetting or control flow integrity monitoring .
the idea of using code mutations as a way to obtain and learn from abnormal behaviour of cpss was first explored in .
instead of mutating the plc code our work mutates the plc inputs leading to a more general and practical attestation solution.
mutations have been explored in a number of other cps contexts too.
for example brandl et al.
apply mutations to specifications of hybrid systems rather than to the plc programs themselves in order to derive distinguishing model based test cases that can be seen as classifiers.
a discrete view of the system is used for generating test cases with qualitative reasoning applied to represent the continuous part.
chowdhury et al.
also use mutations but to find bugs in model based design tools for cpss such as simulink.
as a testbed dedicated for cyber security research many different countermeasures have been developed for swat itself.
theseinclude anomaly detectors typically trained on the publicly released dataset using unsupervised learning techniques e.g.
.
ahmed et al.
implemented fingerprinting systems based on sensor and process noise for detecting spoofing.
adepu and mathur systematically and manually derived physicsbased invariants and other conditions to be monitored during the operation of swat.
feng et al.
also generate invariants but use an approach based on learning and data mining that can capture noise in sensor measurements more easily than manual approaches.
conclusion we proposed a practical code integrity checking solution based on privacy preserving black box models that attest the behaviour of plc programs.
our approach advances the state of the art through its generality and practicality by focusing on translations of the plc code instead of process models as in previous work our models can be trained for real critical infrastructure not just process simulators entirely offline thus avoiding the problems of resource wastage and safety concerns.
furthermore our code integrity checking scheme can be implemented without requiring any firmware modification or trusted hardware components problematic for proprietary and legacy plcs and by exploiting the black box nature of the underlying neural network does not assume that attackers are unaware of its presence or model parameters.
we implemented our technique for swat a six stage water treatment testbed learning attestation models that could achieve near accuracy and detect all of a series of plc code modification attacks.
finally we subjected our attesters to the manipulations of an adversarial attacker finding that it was not practically possible to change the behaviour of the plcs while simultaneously causing the attesters to make consistent mis predictions using only discreet levels of adversarial noise.