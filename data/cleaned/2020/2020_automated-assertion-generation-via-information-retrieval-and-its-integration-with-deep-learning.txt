automated assertion generation via information retrieval and its integration with deep learning hao yu school of software and microelectronics peking university china yh0315 pku.edu.cnyiling lou department of computer science purdue university usa lou47 purdue.eduke sun key laboratory of high confidence software technologies peking university ministry of education china sunke stu.pku.edu.cn dezhi ran key laboratory of high confidence software technologies peking university ministry of education china dezhiran pku.edu.cntao xie key laboratory of high confidence software technologies peking university ministry of education china taoxie pku.edu.cndan hao key laboratory of high confidence software technologies peking university ministry of education china haodan pku.edu.cn ying li national research center of software engineering peking university china li.ying pku.edu.cnge li key laboratory of high confidence software technologies peking university ministry of education china lige pku.edu.cnqianxiang wang huawei technologies co. ltd. china wangqianxiang huawei.com abstract unit testing could be used to validate the correctness of basic units of the software system under test.
to reduce manual efforts in conducting unit testing the research community has contributed with tools that automatically generate unit test cases including test inputs and test oracles e.g.
assertions .
recently atlas a deep learning dl based approach was proposed to generate assertions for a unit test based on other already written unit tests.
despite promising the effectiveness of atlas is still limited.
to improve the effectiveness in this work we make the first attempt to leverage information retrieval ir in assertion generation and propose an ir based approach including the technique of ir based assertion retrieval and the technique of retrieved assertion adaptation.
in addition we propose an integration approach to combine our irbased approach with a dl based approach e.g.
atlas to further improve the effectiveness.
our experimental results show that our ir based approach outperforms the state of the art dl based approach and integrating our ir based approach with the dl based equal contribution corresponding author permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
icse may pittsburgh pa usa association for computing machinery.
acm isbn .
.
.
.
can further achieve higher accuracy.
our results convey an important message that information retrieval could be competitive and worthwhile to pursue for software engineering tasks such as assertion generation and should be seriously considered by the research community given that in recent years deep learning solutions have been over popularly adopted by the research community for software engineering tasks.
ccs concepts software testing unit tests information retrieval keywords unit testing information retrieval test assertion deep learning acm reference format hao yu yiling lou ke sun dezhi ran tao xie dan hao ying li ge li and qianxiang wang.
.
automated assertion generation via information retrieval and its integration with deep learning.
in 44th international conference on software engineering icse may pittsburgh pa usa.
acm new york ny usa pages.
.
introduction unit testing validates the correctness of the software system under test by basic units.
a basic unit refers to a small and functionally discrete component e.g.
a method or a class in a software system.
compared with other levels of testing e.g.
integration testing and system testing unit testing can help detect and diagnose failures more quickly especially for complex software systems .
a typical unit test includes a test input and test oracle e.g.
assertions ieee acm 44th international conference on software engineering icse authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hao yu yiling lou ke sun dezhi ran tao xie dan hao ying li ge li and qianxiang wang and the latter serves as the specifications for the desired behavior on the given test input.
to reduce manual efforts in writing unit tests a large number of tools have been proposed to generate test inputs automatically falling into three major categories.
random testing e.g.
randoop which conducts feedback directed random testing by analyzing collected execution traces.
dynamic symbolic execution e.g.
jbse which dynamically conducts symbolic execution with techniques designed to deal with programs that operate on complex heap inputs.
search based testing e.g.
evosuite which applies genetic algorithms to generate and optimize test inputs toward satisfying a coverage criterion.
besides generating test inputs such tools can automatically generate assertions with two main categories of traditional approaches which help detect only crashing faults or regression faults and are incapable of detecting non crashing faults in the current version in the absence of a previous version .
capture and assert .
for example randoop and evosuite create assertions based on capturing and asserting the return values of all non voidreturn methods of the method sequence in the generated test input evosuite further reduces these assertions based on mutation testing .
differential testing .
for example diffgen generates assertions from runs on two different versions of a class by checking the equality equivalence of method call return values and receiver object states from the two versions.
to complement the traditional approaches of assertion generation based on other already written unit tests atlas a deep learning dl based approach takes a test method without any assertion i.e.
test input only along with its focal method i.e.
the method under test .1in particular the input to atlas is a pair a test method without assertion along with its focal method including these two methods respective method names and method bodies.
in the rest of this paper we refer to such pair as focal test and multiple pairs as focal tests.
the output to atlas is a meaningful assertion corresponding to the focal test i.e.
one similar to what developers would have written .
in contrast to the traditional approaches atlas offers two major advantages of assertion generation.
first atlas can generate meaningful assertions for detecting non crashing faults in the current version whereas the traditional approaches typically help detect only crashing regression faults with generated assertions being unmeaningful.
for example an industrial evaluation of assertions generated by evosuite shows that in manually written tests the assertions are meaningful and useful unlike the generated ones .
thus developers can more desirably inspect assertions recommended by atlas when the developers are writing unit tests in their ide .
second atlas can generate assertions for the code under test in the form of even uncompilable source code whereas the traditional approaches require the code under test to be compilable and executable.
in other words atlas can be applicable even during in progress development of the code under test e.g.
during test driven development .
1when constructing the dataset used to evaluate atlas the atlas authors exclude test methods with multiple assertions while keeping only test methods each with a single assertion in addition the atlas authors determine the focal method for a test methodtas the last non junit framework api method invoked in t.however the effectiveness of atlas is restricted by two major limitations inherent in dl.
first assertions generated by atlas are not explainable due to the un explainable nature of dl .
because a recommended assertion may not be an actual assertion applicable for developers the developers need to inspect the recommended assertion.
in this process of inspection providing explanations on why an assertion is recommended is valuable to assist the developers.
second approaches based on sequence to sequence dl models suffer from the exposure bias and disappearance of the gradient resulting in poor effectiveness in generating a long sequence of tokens as an assertion.
in particular we calculate the accuracy of atlas in generating assertions of different lengths on the dataset used by atlas and we find that atlas performs well .
accuracy in generating a short assertion with fewer than tokens whereas much worse only .
accuracy in generating a long assertion with more than tokens .
to address the preceding limitations in this paper we propose an approach based on information retrieval ir including the technique of ir based assertion retrieval and the technique of retrievedassertion adaptation.
the input and output of the technique of ir based assertion retrieval are the same as those of atlas.
this technique first retrieves the assertion whose corresponding focaltest is most similar to the given focal test based on the jaccard similarity coefficient.
to improve the quality of the retrieved assertion the technique of retrieved assertion adaptation further adjusts tokens in the retrieved assertion based on the context.
since the focal test corresponding to the assertion is also attained when using ir to retrieve the assertion the developers can attain a valuable reference when inspecting the assertion.
in addition since ir is based on similarity it is less challenging for our approach to generate a long assertion.
besides the ir based approach in this paper we also propose an integration approach to integrate our ir based approach with any dl based approach e.g.
atlas to enable more powerful assertion generation.
in particular our integration approach carefully examines the compatibility between our retrieved assertion and the current focal test if the compatibility is higher than the threshold determined by a validation set we directly return the retrieved assertion as the final result otherwise we further apply the dl based approach to generate an assertion.
we evaluate our approaches on two datasets an existing dataset dataoldused in altas and a new dataset datanewconstructed in our work.
while dataoldsimplifies the assertion generation problem by excluding some challenging cases i.e.
unknown tokens datanewisdataold s extended version that includes not only the originaldataoldbut also those excluded cases with unknown tokens.
our experimental results show that the accuracy and bleu score of our ir based approach are substantially higher than atlas the technique of ir based assertion retrieval alone already outperforms altas with .
and .
higher accuracy on both datasets respectively in addition the technique of retrievedassertion adaptation further improves the accuracy by .
and .
on both datasets respectively.
furthermore our integration approach which combines our ir based approach with the existing dl based approach atlas achieves the highest accuracy on assertion generation i.e.
.
and .
on both datasets additional .
and .
over atlas respectively.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated assertion generation via information retrieval and its integration with deep learning icse may pittsburgh pa usa in summary this paper makes the following main contributions ir based approach.
we make the first attempt to leverage ir in assertion generation including the technique of ir based assertion retrieval and the technique of retrievedassertion adaptation.
integration approach.
we propose an integration approach for integrating our ir based approach and a dl based approach e.g.
atlas to enable more powerful assertion generation.
evaluations.
we construct a more comprehensive dataset compared to the dataset used by atlas including more practical and challenging cases in assertion generation and extensively evaluate our approaches on both the original dataset and the newly constructed dataset.
results and practical implication.
our experimental results show that even the technique of ir based assertion retrieval alone already outperforms the state of the art dlbased approach and the technique of retrieved assertion adaptation further improves the accuracy moreover integrating our ir based approach and the dl based approach could achieve a higher accuracy.
our results convey an important message that an ir based approach can be competitive and worthwhile to pursue for software engineering tasks such as assertion generation and should be seriously considered by the research community given that in recent years dl solutions have been over popularly adopted by the research community for software engineering tasks.
the remainder of this paper is organized as follows.
section introduces the background and related work.
section details the proposed ir based and integration approaches.
sections and describe the experimental setup and experimental results.
section discusses the threats to validity of our work.
section concludes this paper.
background and related work in this section we first introduce altas.
then we detail the related work based on ir and the related work of integrating ir and dl.
.
dl based assertion generation with the recent development of dl approaches are increasingly proposed to utilize advanced dl techniques to tackle software engineering tasks such as fault diagnosis and fixing code summarization and code clone detection .
recently watson et al.
propose the first dl based assertion generation approach named atlas which applies neural machine translation nmt to generate an assertion for the given focal test.
atlas aims at predicting a meaningful assertion to validate the correctness of the focal method.
to collect the dataset for training atlas watson et al.
first extract test assert pairs taps from junit based projects in github where each pair consists of the focal test and its relevant assertion.
the initial tap set is then preprocessed into two datasets i raw source code where taps are simply tokenized ii abstract code where taps are first tokenized and the uncommon tokens are further represented by their respective belonging type and sequential id.
these two datasets are used to evaluate atlas respectively.
.
information retrieval with the rapid expansion of human knowledge and information storage fast and accurate ir from a massive and multi modal database becomes an urgent need.
in recent years ir techniques have been widely applied in different software engineering tasks such as feature location code search concept location software reuse and traceability link recovery between software artifacts .
ir techniques fetch the object that best matches the given query from the database.
researchers have leveraged various similarity coefficients in ir.
for example jaccard a widely used similarity coefficient measures the similarity between two sets of data based on their overlapping and unique items.
the following formulation presents jaccard s calculation where xandyare two sets.
the value varies from to and a higher value indicates a higher similarity.
j x y x y x y .
integration of ir and dl there exists work that leverages ir to boost dl techniques for tasks other than assertion generation.
for example liu et al.
and parvez et al.
propose to incorporate ir into dl for the task of code generation and summarization.
in addition liu et al.
propose to generate a commit message by a novel hybrid approach of conducting ir followed by dl.
our work shares the same general intuition of combining ir and dl with the aforementioned work but we tackle a different problem i.e.
assertion generation and we propose a novel integration approach.
in addition our contributions also include the novel ir based assertion generation and adaptation approaches.
approach in this section we introduce the proposed approaches in this work.
our approaches include an ir based approach and an integration approach.
the ir based approach contains two techniques ir based assertion retrieval and retrieved assertion adaptation .
section .
first introduces the technique of ir based assertion retrieval in short asirar .
given a focal test in the test set irarretrieves the most similar focal test in the training set and directly adopts its corresponding assertion as the output.
section .
presents the technique of retrieved assertion adaptation in short as raadapt to automatically modify the retrieved assertion.
section .
further illustrates an integration approach to combine a dl based approach e.g.
atlas and the proposed ir based approach.
.
ir based assertion retrieval irar the basic idea of iraris to retrieve the assertion whose corresponding focal test has the highest similarity with the given focal test.
more specifically irarfirst uses javalang to tokenize each focal test in the training set and test set and removes duplicated tokens from each focal test to enable more efficient retrieval then given a focal test in the test set irarcalculates its jaccard similarity coefficient with all the focal tests in the training set and retrieves the one with the highest similarity coefficient finally the assertion corresponding to the retrieved focal test is returned as the expected authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hao yu yiling lou ke sun dezhi ran tao xie dan hao ying li ge li and qianxiang wang assertion.
when there is a tie in similarity calculation irarselects the first one appearing in the training set.
algorithm ir based assertion retrieval irar input testf the focal test to generate assertion for.
input trainf all focal tests in the training set.
input traina all corresponding assertions in the training set.
output retrievedf the focal test retrieved by irar.
output retrieveda the assertion retrieved by irar.
max retrievedf retrieveda fori 1tolen trainf do jaccard compute testf trainf ifjaccard max then max jaccard retrievedf trainf retrieveda traina returnretrievedf retrieved a algorithm presents the detailed workflow of irar.
being the inputs to the algorithm testfis the input focal test whose assertion would be generated by irar trainfandtrainaare the lists of all the focal tests and their assertions in the training set.
irarcalculates the jaccard similarity between the input focal test and each focaltest in the training set line selects the one with the highest similarity lines and returns its assertion as the output line .
listing a tap example in the test set focal test testreporterroronwrongdateeffective java.lang.string drl rule x date effective asbrdfh when n s string then n end n org.kie.internal.builder.knowledgebuilder kb org.kie.internal.
builder.knowledgebuilderfactory.newknowledgebuilder kb.add neworg.drools.core.io.impl.bytearrayresource drl.
getbytes resourcetype.drl haserrors return errors !
null assertion to generate org.junit.assert.asserttrue kb.haserrors listing a tap example in the training set focal test testfailedstaticimport java.lang.string drl package org.drools.test n import function org.does.not.exist.foo n rule x when n then n end org.kie.internal.builder.knowledgebuilder kb org.kie.internal.
builder.knowledgebuilderfactory.newknowledgebuilder kb.add neworg.drools.core.io.impl.bytearrayresource drl.
getbytes resourcetype.drl haserrors return errors !
null assertion org.junit.assert.asserttrue kb.haserrors for example to generate an assertion for an input focal test in listing irarcompares it with each focal test in the training set finds the most similar one as shown in listing and returns its corresponding assertion.
iraris based on the intuition that similar focal tests are likely to have the identical assertions.
it is thereason why irarworks well for this example.
however it is also very common for two similar focal tests to share similar but not identical assertions.
for those cases directly returning the retrieved assertion would fail to generate a precise assertion.
to address this issue in the next section we then propose an adaptation technique to modify the retrieved assertion.
.
retrieved assertion adaptation raadapt althoughirarcannot always retrieve fully correct assertions from the training set it can return almost correct assertions that are very similar to the correct ones.
therefore we further propose an automated adaptation technique raadapt which modifies a retrieved assertion toward the correct one based on context information.
for a retrieved assertion raadapt performs the following adaptation procedure.
step decide whether the assertion should be modified.
since not all the retrieved assertions need adaptation a pre identification should be made first to avoid mistakenly modifying a correct assertion.
raadapt considers an assertion necessary for adaptation if it contains at least one token absent from the input focal test.
step decide which token i.e.
invoked method variable or constant should be modified.
raadapt considers a token that is absent from the input focal test as a candidate token for modification.
step decide what value a candidate token should be replaced with.
raadapt determines the replacement value by analyzing the token correspondence between the focaltests in the test and training sets.
we observe that most retrieved assertions have identical syntactic structures as the correct ones but with several inconsistent special tokens e.g.
invoked method names variable names or constant values .
therefore the current raadapt mainly considers the replacement operation during adaptation.
we believe thatraadapt can be further extended with more edition operations e.g.
addition or deletion in future work.
listing a false tap example in the test set focal test should build an entity with the right name builder.setname name org.bonitasoft.engine.identity.model.scustomuserinfodefinition entity builder.done getname return name assertion org.junit.assert.assertequals name entity.getname listing a false tap example in the training set focal test should build an entity with the right id builder.setid 1l org.bonitasoft.engine.identity.model.scustomuserinfodefinition entity builder.done getid return id assertion org.junit.assert.assertequals 1l entity.
getid authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated assertion generation via information retrieval and its integration with deep learning icse may pittsburgh pa usa algorithm retrieved assertion adaptation raadapt input t the focal test to adapt assertion for.
input tir the focal test retrieved by irar.
input air the assertion retrieved by irar.
output a ir the assertion adapted by raadapt .
imt vart cstt extracttokens t imtir vartir csttir extracttokens tir imair varair cstair extracttokens air adaptim needadapt imt imtir imair adaptvar needadapt vart vartir varair adaptcst needadapt cstt csttir cstair if!adaptim and !adaptvar and !adaptcst then returnair im tir im t trim imtir imt var tir var t trim vartir vart cst tir cst t trim csttir cstt relpaceim getreplacemap im t im tir imair relpacevar getreplacemap var t var tir varair relpacecst getreplacemap cst t cst tir cstair a ir replace air relpaceim relpacevar relpacecst returna ir functionneedadapt tkt tktir tkair needadaptation false fortkair tkairdo iftkair tktandtkair tktirthen needadaptation true break returnneedadaptation functiongetreplacemap tkt tktir tkair relpacemap dict fortktir tktir tkair do replace max fortkt tktdo temp computesimilarity tktir tkt iftemp max then max temp replace tkt relpacemap replace returnrelpacemap algorithm shows the details of raadapt .
in lines raadapt first extracts three categories of tokens all the invoked methods variables and constants defined in t tir andair the inputs to raadapt storing these tokens in nine sets.
separately processing the categories of the invoked methods variables and constants can makeraadapt more effective because there is no replacement relationship across the three categories.
for the example code fragments in listings and raadapt extracts the nine sets of tokens imtis vartis andcsttis imtiris vartiris and csttiris imairis varairis andcstairis .
step .
in lines and raadapt determines whether an assertion in the training set retrieved by irarneeds to be adapted.
the criterion for the need of adaptation is whether at least an invoked method in imairhas not appeared in imtbut appeared inimtir at least a variable in varairhas not appeared in vart but appeared in vartir or at least a constant in cstairhas not appeared in csttbut appeared in csttir.
for the example code fragments in listings and getid in imairhas not appeared in imtand1lincstairhas not appeared in cstt so we need to do a replacement analysis for 1l and getid .
step .
line of the algorithm removes the overlapping elements betweenimtirandimtfrom each of these two sets resulting in im tirandim t respectively.
the elements in im tirare the tokens i.e.
invoked methods here that should be modified.
lines and do the same for the pair of vartirandvartand the pair of csttir andcstt respectively.
for the example code fragments after the overlapping elements are removed im tiris im tis var tiris var tis cst tiris cst tis .
step .
in lines raadapt selects all the replacement values for invoked methods variables and constants the selection is based on one of the two strategies described in sections .
.
and .
.
.
in lines the algorithm replaces the invoked methods variables and constants in airto be replaced and returns the adapted assertion a ir.
for step we design two replacement strategies to decide the replacement value one is based on heuristics denoted as rah adapt and the other one is based on neural networks denoted as rann adapt .
we then introduce these strategies in sections .
.
and .
.
.
.
.
heuristics based strategy rah adapt.in functiongetreplacemap computesimilarity ofrah adaptis calculated based on the sub tokens resulted from hump splitting of tktirintktirandtktintktand the positions of tktirandtkt.
we first determine whether tktirand tktcontain the same sub tokens resulted from camel case splitting.
iftktirandtktcontain the same sub tokens after camel case splitting we put tktto a candidate set.
then we select the replacement value according to the positions of tktirintktirandtktintkt.
here we select the token tktthat is closest to the position of token tktir.
for example getid in listing needs to be respectively compared with setname and getname in listing .
the camel case of getid is split into get and id the camel case of getname is split into get and name and the camel case of setname is split into set and name .
the position of getid in tiris the position of getname in tis and the position of setname intis .
therefore getid will be replaced with getname .
the constant 1lin listing needs to be replaced and cst tirhas only one element name so 1l is directly replaced with name .
.
.
neural network based strategy rann adapt.the heuristic based strategyrah adaptperforms replacement based on lexical similarity which might ignore semantic information embedded in programs.
we then propose another neural network based replacement strategyrann adapt which augments lexical similarity with semantic information and calculates the replacement value via a neural network authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hao yu yiling lou ke sun dezhi ran tao xie dan hao ying li ge li and qianxiang wang architecture for code adaptation.
rann adaptconsists of three components embedding first order semantic information enriching first order information with high order semantic information and combining semantic information with the aforementioned lexical similarity.
in the first component rann adaptcaptures the first order information with word2vec which maps each word to a n dimensional vector space r. we use am nmatrixmfor this semantic mapping wheremdenotes the size of vocabulary a vocabulary typically refers to a set of unique tokens used in the text corpus .
the second component captures high order information by injecting the semantics of context into the current token.
in particular we employ a bidirectional recurrent neural network architecture bi rna which delivers information forward and backward simultaneously.
at every step bi rna updates the representation of the current token iiwith its forward and backward context enrichingii s initial first order information with high order information.
hereris the recurrent algorithm used to update information and ir iis the output of semantic enhancement of ii.
ir i at last we use a linear layer to combine semantic similarity with the lexical similarity.
the semantic similarity is calculated with cosine coefficient and the cosine coefficient between more similar tokens is larger.
in line of algorithm we employ dot production to calculate the cosine coefficient between the tokens for replacing irtir ioftktirand its candidate irt ioftkt in function getreplacemap as the following equation.
here sdenotes the replacement score of tktirandtkt.p1andp2are the parameters trained byrann adapt.
s p1 irtir i irt i p2irtir iandirt icontain same sub token s p1 irtir i irt iotherwise rann adaptis optimized by maximizing the negative log likelihood on the replacement possibility s. .
integration an ir based approach retrieves assertions from the training set and could be highly effective especially when there are similar cases in the training set.
on the other hand a dl based approach learns to generate assertions based on the training set and is capable of generating new assertions absent from the training set.
intuitively these two approaches are complementary and thus could be further combined to enable more powerful generation of assertions.
in this section we propose an integration approach based on a compatibility inference model which calculates the compatibility between the retrieved assertion and the current focal test to determine whether to directly return the retrieved assertion or apply a dl based approach to generate a new assertion.
figure presents the workflow of our integration approach.
the first two steps are our proposed ir based approach including the techniques of irarandraadapt which retrieves an assertion based on the jaccard similarity and adapts the retrieved assertion if necessary.
after adaptation we then employ a semantic compatibilityinference model to calculate the compatibility of the adapted assertion.
if the compatibility is lower than the specified threshold denoted as tin figure we turn to the dl based approach e.g.
atlas for generating a new assertion.
in our approach tis decided based on the validation set.
we next introduce our compatibility inference model in detail.
recall that the adaptation technique deals with syntactic compatibility by replacing incorrect tokens.
we further utilize semantic compatibility to find an incompatible assertion.
this problem is similar to the task of neural language inference nli which is usually solved with a binary neural inference model.
typically a binary neural inference model reasons about evidence between the hypothesis and premise to infer their relationship i.e.
entailment or contradiction .
however our problem is different where the relationship is ternary rather than binary .
since the assertion is retrieved from its training focal test an inference model should not only consider the compatibility between the retrieved assertion and the input focal test but also consider the compatibility between the retrieved focal test and the input focal test.
based on this insight we propose a ternary neural inference model which could be viewed as an extension of a recently proposed binary neural inference model named esim .
we model the local evidence of compatibility among the retrieved assertion the retrieved focal test and the input focal test with an attention based rnn model.
we then combine the evidence from three code sequences with a neural network which maps evidence features to the final compatibility.
experimental setup in this section we describe datasets and metrics used in our experiments.
our source code datasets and experimental results are available on our project website .
we conduct experiments to answer the following research questions rq1 how does the proposed ir based assertion retrieval techniqueirarperform compared to the latest dl based assertion generation approach i.e.
atlas ?
rq2 how do the proposed retrieved assertion adaptation techniquesrah adaptandrann adaptimprove the effectiveness?
rq3 how does the proposed integration approach boost dl based and ir based approaches?
.
datasets .
.1dataold.we denote the original dataset used by atlas as dataold which consists of real world test assertions from opensource projects in github.
as mentioned in previous work dataoldis constructed in a simplified way it excludes the assertions that contain tokens absent from the focal test and the vocabulary.
such tokens are called unknown tokens according to the common practice in natural language processing .
for example in listing the tokens voter andvotematch are unknown tokens that do not appear in the focal test or the vocabulary.
dataold excludes such cases and in total contains data items which are further divided into training validation and test sets by the ratio of .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated assertion generation via information retrieval and its integration with deep learning icse may pittsburgh pa usa 2xwsxw rpsdwlelolw rfdo whvw rfdo whvwv dqg vvhuwlrqvlq 7udlqlqj 6hw5hwulhyhg rfdo whvw 5hwulhyhg vvhuwlrq gdswdwlrq qdo vlv6lplodulw dofxodwlrq1hhg gdsw gdswdwlrq rfdo whvw5hwulhyhg rfdo whvw vvhuwlrq5hwulhyhguhsodfhjhw1dph hqwlw jhw g jhw1dphjhw g hv gdswhg vvhuwlrq1r6hpdqwlf rpsdwlelolw qihuhqfhzlwkuljkw guljkwqdphhqwlw zlwkjhw1dph ylghqfh0dsslqj ylghqfh qihulqj edvhg vvhuwlrq hqhudwrq 8vh 5hwulhyhg vvhuwlrq5hwulhydo gdswdwlrq qwhjudwlrq hqhudwhg vvhuwlrq gdswhg vvhuwlrqs ws s w figure workflow of the integration approach .
.2datanew.in fact dataoldsimplifies the test generation problem by excluding some challenging cases i.e.
assertions with unknown tokens for generation.
therefore it may fail to represent real world data distribution and threaten the validity of experimental results.
therefore in this work we further construct an extended dataset i.e.
denoted as datanew based ondataoldby adding those excluded cases with unknown tokens back to dataold.
in addition to the original items in dataold datanewconsists of extra items with unknown tokens.
in total the newly constructed dataset datanewcontains data items which are also further divided into training validation and test sets by the ratio of .
listing an example of assertion with unknown tokens focal test voidvotematch match exact single sectioned many orgs affiliation.setorganizationname philipps universitat marburg resetorgnames some other inst philipps universitat marburg voidresetorgnames string... orgnames mockito.when getorgnamesfunction.apply organization .thenreturn lists.newarraylist orgnames assertion asserttrue voter.votematch affiliation organization table shows the detailed statistics of dataoldanddatanew including their distribution over different assertion types.
.
metrics in line with previous work we use the following metrics in our experiments.
.
.
accuracy.
we mainly use accuracy to evaluate the effectiveness of assertion generation techniques.
in particular only the assertion that is the same with the ground truth would be considered as accurate.
accuracy calculates the ratio of accurate assertions to all the generated assertions.
.
.
bleu.
following previous work we use the muti bleu score to evaluate the similarity of generated assertions with the ground truth.
bleu has been widely used in machine translation systems .
the score first calculates the modified n gram for bleu n n precision of a candidate sequence i.e.
generated assertions to the reference message i.e.
the ground truth and then measures the average modified n gram precision with a penalty for overly short sentences.
experimental results tables and present the overall effectiveness i.e.
accuracy and bleu of all techniques studied in the experiments including the compared baseline i.e.
atlas irar two adaptation techniques rah adapt rann adapt and the integration approach.
.
rq1 effectiveness of irar .
.
overall effectiveness of irar.as shown in tables and the proposed irartechnique substantially outperforms the compared dl based approach atlas on both datasets in terms of both accuracy and bleu.
in addition we can observe that the difference is much more prominent on the more challenging dataset i.e.
datanewwith unknown tokens .
the reason might be that existing dl based approaches may have a weaker capability of generating assertions with unknown tokens and thus perform substantially worse ondatanew i.e.
almost drop in accuracy .
effectiveness on different assertion types.
we further compare the effectiveness of irarand atlas on assertions of different types.
each column in table represents the assertion type and each cell presents the number of correct generated assertions and the corresponding proportions in the brackets.
as shown in the table we observe that irarcould consistently outperform atlas on all the assertion types indicating the generality of irarin generating different assertions.
effectiveness with different similarity coefficients.
iraruses jaccard as its default similarity coefficient.
we investigate the impact of different ir similarity coefficients on the effectiveness of irar.
in particular we implement two other variants of irarwith two widely used similarity coefficients overlap and dice which compute the similarity of two given sets i.e.
xandy as follows.
overlap x y x y min x y dsc x y x y x y table presents the accuracy of irarwith different similarity coefficients on both datasets.
the results show that the similarity coefficients have little impact on the effectiveness of irar indicating the generality of the irarfamily in assertion generation.
in summary our results suggest that the proposed irarapproach outperforms the existing dl based approach atlas including on different assertion types and with different ir similarity coefficients.
to further understand these results we next analyze their successful and unsuccessful cases in sections .
.
and .
.
respectively.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hao yu yiling lou ke sun dezhi ran tao xie dan hao ying li ge li and qianxiang wang table detailed statistics of each type in dataoldanddatanew asserttype total equals true that notnull false null arrayequals same other dataold datanew table accuracy of irar rah adapt rann adapt and integration datasetappr oachatlasi rarrah adaptrann adaptintegration dat aold .
.
.
.
.
datanew .
.
.
.
.
table muti bleu of irar rah adapt rann adapt and integration datasetappr oachatlasi rarrah adaptrann adaptintegration dat aold .
.
.
.
.
datanew .
.
.
.
.
.
.
correct generated assertions.
to further investigate the correct assertions generated by irarand atlas we compare the length of correct assertions i.e.
the number of tokens in each assertion .
figure shows the distribution of the length of correct generated assertions where the x axis represents the length of assertions and the y axis represents the number of corresponding assertions.
interestingly as shown in the figure we can observe thatirartends to outperform atlas on longer assertions.
for example on dataold atlas is more effective than irarwhen the target assertion contains fewer than eight tokens whereas atlas becomes less effective than irarwhen the target assertion contains more than eight tokens.
we also observe similar trends ondatanew althoughiraris always more effective than atlas their difference is more prominent with the increasing length of assertions.
to further confirm our observation we then calculate the average lengths of the correct assertions generated by atlas andirar respectively.
on dataold the average lengths of the correct assertions generated by atlas and irarare .
and .
respectively on datanew the average lengths of atlas and irar are .
and .
respectively.
our results suggest that irarhas a stronger capability of generating correct long assertions than atlas.
one potential reason may be that it is still very challenging for existing dl based approaches to generate long sequences from scratch while it is feasible for ir based approaches to retrieve long sequences from existing data.
in addition our results also indicate the complementarity between dl based and ir based approaches especially for assertions of different lengths also motivating the combination of these two approach categories for more powerful assertion generation.
we further look into the correct assertions generated by atlas.
interestingly we find most of them exist in the training set.
more specifically in dataold among correct assertions that can be generated by atlas .
assertions exist in the training figure length distribution of correct assertions set if the abstraction strategy is applied.
recall that the abstraction strategy in atlas replaces specific tokens e.g.
identifiers and variable names with abstract tokens to reduce the infrequent tokens and the size of the vocabulary.
similarly in datanew we also observe that the majority of correct generated assertions i.e.
.
are the assertions existing in the training set.
intuitively the strength of dl based approaches over ir based approaches lies in intelligently creating new assertions that have never appeared in the training set.
however our results show that most assertions generated by atlas exist in the training set while only a few correct assertions are new and created by atlas.
the preceding observation explains why even a simplistic ir approach can outperform a dl based approach also suggesting the limited capability of existing dl based assertion generation in generating correct assertions.
.
.
incorrect generated assertions.
we then look into the assertions that cannot be successfully generated by atlas or irar.
in particular we calculate the edit distance between the incorrect generated assertions and the labeled assertions i.e.
the ground truth in table .
interestingly although there are a large number of assertions that cannot be successfully generated by atlas or irar a considerable ratio of these incorrect generated assertions are very similar to the correct ones i.e.
their edit distance is rather small.
for example among the and incorrect assertions generated by atlas on dataoldanddatanew respectively i.e.
.
and i.e.
.
assertions have only one different token from the correct assertions while i.e.
.
and i.e.
.
assertions have no more than three different tokens from the correct assertions.
similarly among the and incorrect authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated assertion generation via information retrieval and its integration with deep learning icse may pittsburgh pa usa table detailed statistics of atlas and irarfor each assert type approacha sserttypetotal equals true that notnull false null arrayequals same other atlas d ataold irar dataold atlas datanew irar datanew table accuracy of different similarity coefficients datasetappr oachjaccar d dice overlap dat aold .
.
.
datanew .
.
.
assertions retrieved by irarondataoldanddatanew respectively i.e.
.
and i.e.
.
assertions have only one different token from the correct assertions while i.e.
.
and i.e.
.
assertions have no more than three different tokens from the correct assertions.
inspired by the preceding observation we further categorize those incorrect generated assertions whose edit distance is only one token away from the correct assertions according to the type of the incorrect token.
table presents the number of assertions in each token category.
from the table we can find that a majority of incorrect assertions generated by atlas or irarhave a wrong constant value compared to the correct assertions indicating that generating constant values can be a major challenge in assertion generation.
such a challenge is not surprising since the candidate space of a constant value is often very large making it challenging to predict a constant value correctly.
in addition we can also find that a considerable number of assertions are incorrect because their assertion types are incorrect.
for example on dataold incorrect assertions generated by atlas irar can be modified into correct assertions if their assertion types are fixed.
compared to incorrect constant values fixing incorrect assertion types is often less challenging since fixing types has a limited number of enumerations.
in summary a considerable number of incorrect assertions generated by atlas and irarare very similar to correct assertions and these incorrect assertions can still be helpful to developers or provide useful information for assertion generation.
in addition many incorrect assertions may become correct after only one token e.g.
related to assertion type is modified.
furthermore our results also motivate the intuition of our adaptation technique.
.
rq2 effectiveness of raadapt in table column total shows the overall accuracy of rah adapt andrann adaptondataoldanddatanew.
we can find that both adaptation techniques can substantially improve irar andrann adaptcan achieve higher improvement than rah adapt.
for example rah adapt andrann adaptimproveirarby .
and .
on dataold whiletable edit distance between correct assertions and incorrect assertions generated by atlas and irar datasetedit1 atlas dataold irar dataold atlas datanew irar datanew table token types to be modified within one edit distance datasettokentotal api variable constant asserttype atlas d ataold irar dataold atlas datanew irar datanew .
and .
on datanew respectively.
in addition rah adapt rann adapt can further outperform the dl based approach atlas substantially i.e.
.
.
improvement on dataoldand .
.
improvement on datanew.
furthermore the other columns in table present the effectiveness of adaptation on assertions of different types.
from the table we can observe a consistent improvement of both adaptation techniques on all the assertion types.
we further analyze the successful and unsuccessful cases of our adaptation techniques.
in particular we find that on dataold and incorrect retrieved assertions are modified into correct assertions by rah adaptandrann adapt respectively similarly on datanew and incorrect retrieved assertions are modified into correct ones by rah adaptandrann adapt respectively.
on the other hand our adaptation techniques are likely to modify a correct assertion into an incorrect one.
ondataold a small number of correct retrieved assertions i.e.
and are mistakenly identified by rah adaptandrann adapt respectively as incorrect assertions and further modified into incorrect assertions and the numbers on datanew are and .
in summary our adaptation techniques successfully modify a considerable number of incorrect assertions into correct ones at the cost of mistakenly modifying a small number of correct retrieved assertions explaining the overall effectiveness of adaptation.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may pittsburgh pa usa hao yu yiling lou ke sun dezhi ran tao xie dan hao ying li ge li and qianxiang wang table detailed statistics of rah adaptandrann adaptfor each assert type appr oacha sserttypetotal equals true that notnull false null arrayequals same other rah a dapt dataold rann adapt dataold rah adapt datanew rann adapt datanew table detailed statistics of integration for each assert type appr oacha sserttypetotal equals true that notnull false null arrayequals same other integration dat aold integration datanew a rah adapt b rann adapt figure complementarity between atlas irar rah adapt andrann adaptindataold a rah adapt b rann adapt figure complementarity between atlas irar rah adapt andrann adaptindatanew5.
rq3 effectiveness of integration .
.
complementarity between dl based and ir based approaches.
figures and present the overlapping between the correct assertions generated by the dl based approach i.e.
atlas and the ir based approaches i.e.
irarandraadapt .
from the figures we can find that dl based and ir based approaches are complementary.
for example on dataold between atlas and rah adapt correct assertions are uniquely generated by atlas while correct assertions are uniquely generated by rah adapt between atlas andrann adapt correct assertions are uniquely generated by atlas while correct assertions are uniquely generated by rann adapt.
such a complementarity is consistent on datanew.
the results indicate that integrating both approaches can even enable more powerful assertion generation.
.
.
effectiveness of integration.
table presents the effectiveness of integration on all assertions and assertions of each type.
from the table we can observe that integration consistently outperforms dl based and ir based approaches on all assertions.
the results suggest the effectiveness of our proposed integration approach also showing that integrating dl based and ir based approaches can be a promising direction for automated assertion generation.
threats to validity one major threat in our work comes from not comparing the ability to generate assertions that are compilable and can find bugs between our approaches and other existing approaches of test case generation.
although being compilable can be another indicator for assertion quality automated build has always been a challenging task highly dependent on external internal settings resources .
therefore it is challenging to automatically compile large scale subjects.
to ensure the scale of our experiments we do not use being compilable and the ability to find bugs as metrics.
note that we check the syntax of assertions generated by our ir based approach and all the generated assertions conform to the syntax.
these results are expected since the retrieval mechanism of our ir based approach can ensure the syntactic correctness of the generated assertions.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated assertion generation via information retrieval and its integration with deep learning icse may pittsburgh pa usa conclusion in this paper we have made the first attempt to leverage information retrieval ir in assertion generation and propose an ir based approach including the technique of irarand the technique of raadapt .
we have also proposed an integration approach for integrating our ir based approach and a dl based approach such as atlas to further improve the effectiveness.
our experimental results have shown that atlas can be outperformed by irar which achieves the accuracy of .
and .
on two datasets respectively.
moreover our rah adapttechnique can help achieve accuracy of .
and .
on both datasets respectively.
finally the integration approach achieves the accuracy of .
and .
on both datasets.
our work has conveyed an important message that an ir based approach can be competitive and worthwhile to pursue for software engineering tasks such as assertion generation and should be seriously considered by the research community given that in recent years dl solutions have been over popularly adopted by the research community for software engineering tasks.