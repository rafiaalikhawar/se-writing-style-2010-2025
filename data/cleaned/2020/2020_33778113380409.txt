gang of eight a defect taxonomy for infrastructure as code scripts akond rahman tennessee tech university tennessee usa arahman tntech.edueffat farhana nc state university north carolina usa efarhan ncsu.educhris parnin nc state university north carolina usa cjparnin ncsu.edulaurie williams nc state university north carolina usa lawilli3 ncsu.edu abstract defects in infrastructure as code iac scripts can have serious consequences for example creating large scale system outages.
a taxonomy of iac defects can be useful for understanding the nature of defects and identifying activities needed to fix and prevent defectsiniacscripts.
thegoalofthispaperistohelppractitioners improvethequalityofinfrastructureascode iac scriptsbydeveloping a defect taxonomy for iac scripts through qualitative analysis.
wedevelopataxonomyofiacdefectsbyapplyingqualitativeanalysis on defect related commits collected from open source software oss repositoriesoftheopenstackorganization.weconduct a survey with practitioners to assess if they agree with the identified defect categories included in our taxonomy.
we quantify the frequency of identified defect categories by analyzing commits collected from oss repositories spanning across to .
our defect taxonomy for iac consists of eight categories including a category specific to iac called idempotency i.e.
defects that leadtoincorrectsystemprovisioningwhenthesameiacscriptis executedmultipletimes .weobser ve the surveye d66practitioners toagreemostwithidempotency.themostfrequentdefectcategory isconfigurationdatai.e.
providingerroneousconfigurationdata iniacscripts.ourtaxonomyandthequantifiedfrequencyofthe defectcategoriesmayhelpinadvancingthescienceofiacscript quality.
ccs concepts software and its engineering software defect analysis keywords bug category configurationas code configurationscripts defect devops infrastructure as code puppet software quality taxonomy acm reference format akond rahman effat farhana chris parnin and laurie williams.
.
gang of eight a defect taxonomy for infrastructure as code scripts.
in proceedings of 42nd international conference on software engineering seoul republic of korea may icse pages.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may seoul republic of korea association for computing machinery.
acm isbn ... .
introduction infrastructureascode iac isthepracticeofautomaticallymaintaining system configurations and provisioning deployment environments using source code .
iac scripts are also known as configuration as code scripts or configuration scripts .
informationtechnology it organizationsusetools suchaschef1 and puppet2to implement the practice ofiac.
the use of iac has yielded benefits for it organizations such as general motors gm andtheeuropeanorganizationfornuclearresearch cern .using chef gm increased software deployment frequency by a factor of .cernusespuppettomanage15 000serversandtoprocess 000terabytesofdataeveryday .puppethashelpedcernto minimize service disruptions and reduce deployment time .
despite the above mentioned benefits defects with serious consequencescanappeariniacscripts.forexample adefectinaniac scriptcreatedanoutageresultinginbusinesslossesworthof150 million usd for amazon web services .
other example consequences of defects in iac scripts include outage for github anddeletionofuserdirectoriesfor 270usersincloudinstances maintained by wikimedia commons .
a defect taxonomy for iac scripts can help practitioners understand thenature ofdefects and identifypossible development activities for defect mitigation.
figure presents an example of a security defect which exposes users passwords in logs3.
the defect is mitigated by adding secret true which prevents the password getting exposed in logs3.
identification of certain defect categories such as security defects similar to figure can helppractitioners to make informed decisions on what development activities could be adopted to improve the quality of iac scripts.
the importance of defect categorization has been recognized by the research community .
for example linraesv squez et al.
stated categorizing vulnerabilities can help androiddevelopers infocusingtheirverification validation v v activities .accordingto catolinoetal.
understandingthebug type represents the first and most time consuming step to performin the process of bug triage since it requires an in depth analysis .
adefecttaxonomyforiac anareathatremainsunexplored can help practitioners in understanding the nature of defects and help in improving iac script quality through activities such as triaging defects prioritizing v v efforts and measuring iac script quality.
we observe practitioners asking about defect categories for iac scriptsinonlineforumssuchasreddit iwanttoadoptpuppetinmyorganization.beforeadoptioniwanttobeawareofthequalityissues that may arise in puppet scripts.
can someone give me some pointers ieee acm 42nd international conference on software engineering icse glance cache config default auth url value auth url default admin tenant name value keystone tenant default admin user value keystone user default admin password value keystone password default admin password value keystone password secret true figure example of a security related defect where a password is exposed in logs.
the defect is mitigated by adding secret true .
on what type of bugs defects appear for puppet scripts?
.
while theforummembersofferedsuggestionsonpossiblecategoriesof defects e.g.
syntax related defects these suggestions lack substantiation.
we hypothesize that through systematic empirical analysis we can develop a taxonomy and derive defect categories for iac using open source software oss repositories.
thegoalofthispaperistohelppractitionersimprovethequalityof infrastructure as code iac scripts by developing a defect taxonomy for iac scripts through qualitative analysis.
we answer the following research questions rq whatcategoriesofdefectsappearininfrastructure as code scripts?
rq how do practitioners perceive the identified defect categories for infrastructure as code scripts?
rq howfrequentlydotheidentifieddefectcategories appear in infrastructure as code scripts?
we derive a defect taxonomy for iac by applying descriptive coding on1 448defect relatedcommitmessagescollectedfrom ossrepositoriesmaintainedbytheopenstackorganization .
wesurvey66practitionerstoassesshowpractitionersperceivethe identified defect categories.
to automatically identify iac defect categories we develop a tool called automated categorizer of infrastructure as code defects acid and apply acid on commits collected from oss repositories hosted by github mozilla openstack and wikimedia commons .
we list our contributions as following a taxonomy that includes eight defect categories for iac scripts section .
an evaluation of how practitioners perceive the identified defect categories section .
.
an analysis of how frequently the identified defect categories occur section .
.
and a tool called acid that automatically identifies instances of defect categories from repositories with iac scripts section .
we organize rest of the paper as following we discuss background and related work in section .
we describe the defect categoriesandsurveyresultsinsection3.wedescribetheconstruction and evaluation of acid in section .
we describe our empirical study in section .
we discuss our findings and limitations respectively in sections and .
we conclude the paper in section .
background and related work here we provide necessary background and discuss related work.
an example puppet script include server class sample service flag service flag true if service flag path var var www html else path var var www html pages service apache2 ensure running enable true path path var comment refer dependentclass server variable service flag if else block specifying apache2 service attribute enable of apache2 service figure annotation of an example puppet script.
.
background puppetscriptsareanalyzedinourresearchstudy.typicalentities ofpuppetincludemanifests .manifestsarewrittenasscripts thatusea.ppextension.inasinglemanifestscript configuration data can be specifiedusing variables and attributes.
programming constructs such as the service resource are also available to specifyservices.weprovideasamplepuppetscriptwithannotationsin figure2.infigure2 aservicewiththetitle apache2 isspecified.
configurationdataarespecifiedusing and respectively for attributes and variables.
.
related work our paper is closely related to prior research on software defectcategories.
chillarege et al.
proposed eight defect categories algorithm assignment build checking documentation function interface and timing.categoriesproposed bychillaregeet al.
wereusedbycinqueetal.
tocategorizedefectsforairtraffic control software.
wan et al.
investigated defects in blockchain systems and observed that semantic defects are the most dominant runtime defect categories.
linares vasquez et al.
provided a taxonomy to categorize vulnerabilities for android based systems.
zheng et al.
studied defects collected from the openstack cloud management system and observed that .
of the studied defectsinvolveincorrectoutput.islametal.
studied2 716stack overflow posts related to deep learning libraries and observed configuration data to be the most frequent category.
theabove mentioneddiscussionshowsthatdefectcategorizationofspecializedsoftwaresuchasandroidanddeeplearningprovidevaluetotheresearchcommunity.however similarresearch efforts are absent for iac.
sharma et al.
and bent et al.
investigated code maintainability aspects of chef and puppet scripts.
jiangandadams investigatedtheco evolutionofiacscripts and other software artifacts such as build files and source code.
rahmanandwilliamsinseparatestudiescharacterizeddefective iac scriptsusing text mining andby identifying sourcecode properties .
hanappi et al.
proposed a model based test frameworktoautomaticallytestconvergenceofiacscripts.rahman et al.
identified occurrences of security smells i.e.
codingpatternsindicativeofsecurityweaknessesthatalsoincluded occurrences of hard coded passwords.
the above mentioned 753discussion highlights the lack of studies that investigate defect categories for iac and motivate us further to investigate defect categories of iac.
defect taxonomy for infrastructure as code scripts in this section we answer rq what categories of defects appear in infrastructure as code scripts?
.
first we describe our methodology then we present the identified defect categories.
.
methodology to develop defect taxonomy qualitative analysis we use descriptive coding on defect relatedcommits.
defect relatedcommits havecommit messages that indicate an action was taken related to a defect .
we derivedefect relatedcommitsbymanuallyinspecting7 808commits that map to puppet scripts.
while determining defectrelated commits a rater inspected if the commit message expressed an action that was taken to remove or repair an error while developing an iac script.
we collect the set of commits from oss repositories maintained by the openstack organization as openstack provides cloud based infrastructure services and our assumption is thatananalysisofcommitscollectedfromopenstackcouldgive us insights on defect categories.
we use commits because commits summarize changes that are made to a script and could identify the types of changes that are being performed on a script.
descriptive coding is a qualitative analysis technique that summarizes the underlyingthemefromunstructuredtext .weselectdescriptive coding because we can obtain i a summarized overview of thedefect categoriesthat occurforiac scripts and ii contexton howtheidentifieddefectcategoriescanbeautomaticallyidentified.
weusepuppetscriptstoconstructourdatasetbecausepuppetis considered as one of the most popular tools for configuration management andhasbeenusedbycompaniessince2005 .
we extract commit message text from the defect related commits as well as any existing identifier to a bug report in the commit message.
we combine the commit message with any existingbugreportdescriptionandrefertothecombinationasenhanced commitmessage ecm .ifnobugidentifierispresentinthecommit message then the commit message becomes the ecm.
we use ecmstoderivedefectcategoriesasfollowing firstweidentifytextpatternsthatdescribeareasonand orasymptomofadefect where defectisdefinedas animperfectionthatneedstobereplacedor repaired .
figure provides an example of our qualitative analysis process.
we first analyze the ecm for each commit where an iac script is modified and extract snippets that correspond to areasonorsymptomofadefect.fromthesnippetprovidedinthe bottomleftcorner weextractrawtext fixconfigoptions .next we generate the initial category e.g.
we generate fixing config.
options from this raw text.
finally we determine the defect category configuration data by combining initialcategories.
we combine thesetwoinitialcategories asbothcorrespondtoacommonpattern of fixing configuration data defects.
multiple defect categories can be identified in an ecm.
the first and second author individually conduct a descriptive coding processon 448defect related ecms.
uponcompletion ofthis process we record the agreements and disagreements for the identified defect categories.
the first and second author respectively identified eight and ten categories.
the cohen s kappa is .
which according to landis and koch is substantial agreement .thesecondauthoridentifiedtwoadditionalcategories hard codedvaluesandnetworksetting.upondiscussion thefirst and second authors agreed that both hard coded values and network setting can be merged with the category configuration data as defects related to configuration data include both.
.
answer to rq defect taxonomy for iac ourdevelopedtaxonomyincludeseightdefectcategories.weobserve one category idempotency to be unique to iac whereas the other defect categories have been observed for other software systemsasreportedinpriorliterature .wereporteach defect category in an alphabetical order with examples below conditional this category represents defects that occur due toerroneouslogicand orconditionalvaluesusedtoexecuteone ormultiplebranchesofaniacscript.conditionallogicdefectsalso appear for other types of software systems such as machine learning relational databases text editor software and deep learning software .
example conditional logic defects can lead to erroneous status output.
for example for a wikimedia commons project cdh whencheckingthestatusofmysqladmin aconditionallogicdefect causedtheoutputtobe zero bothinthecaseofsuccessand failure of mysqladmin s ping command.
configurationdata thiscategoryrepresentsdefectsthathappenduetoerroneousconfigurationdatathatresideiniacscripts.
an example configuration data defect downloaded from an oss repository i s config dir etc service name where wrong configuration data is provided.
the fix is config dir etc hekad .
practitionershavereportedconfigurationdatadefectsiniacscriptstocausedeploymentproblemsforthegoogleappengine and inavailabilityofstackexchange anonlinequestionandanswer platform .
configuration data includes five sub categories i data for storage system such as mysql mongodb and sqlite ii dataforfilesystemsuchasspecifyingfilepermissionsandfile names iii datafornetworksetupsuchastcp dhcpportsand addresses mac addresses and ip table rules iv data for usercredentials such as usernames and v data for caching systems such as memcached.
priorresearchhasobservedconfigurationdatadefectstoappear for machine learning software build systems blockchain software eclipsesoftwareprojects andmozillaprojects .
example configurationdata relateddefectscausedeployment failures in the case of openstack bug value of an attribute host ip wasnotsettothecorrectipaddress whichleadto a deployment task to fail.
other example consequences of configurationdatadefectsincludeprovisioningerrorsforobjectstorage systems such as openstack swift5.
dependency this category represents defects that occur when executionofaniacscriptisdependentuponanartifact whichis either missing or incorrectly specified.
the artifact can be a file 754enhanced commit message raw text initial category defect category fix configuring cinder multibackend fix configuration of cindermultibackend set every backendto his own section.
fix configuration of listen ad dresses heat s services fix config options deprecated injunofix configuring fix configuration of cinder multibackend fix configuration of listen ad dresses fix config optionsfixing configuration data fixing configurationoptions provided asconfiguration dataconfiguration data figure an example to demonstrate the process of deriving iac defect categories using descriptive coding.
class package puppet manifest or a module.
previously practitionershavereportedthatmanagingdependenciesiniacscripts leadstocomplexity statingdependencymanagementasa nightmare becauseincorrectlyspecifieddependenciescouldlead to execution of iac scripts in the wrong order.
dependency related defects have been reported for machine learning and audio processing software .
example dependency defects cause deployment errors6.a c cording to the bug report6 a user faces an error when installing an openstack project called neutron which provides networking as a service in debian and ubuntu.
the error occurred because ofspecifyinganincorrectpackageasadependency.dependency defects can also cause installation errors .
documentation this category represents defects that occur whenincorrectinformationaboutiacscriptsarespecifiedinsource code comments in maintenancenotes and in documentation files suchasreadmefiles.documentation relateddefectshavebeen reported in prior studies chillarege et al.
identified documentationasoneoftheeightdefectcategoriesforodc.storeyetal.
and tan et al.
have reported that erroneous information expressed in source comments can lead to defects in source code.
example accordingtoabugreport7 theformatofspecifying policies for the openstack nova project is incorrectly specified in thecommentsofaniacscript whichcanleadtopuppetruntime errors.otherexamplesofdocumentation relateddefectsareproviding incompatible license information in comments and missing licenseheaders whichcanhavenegativeimplicationsonthe distribution of software .
idempotency this category represents defects that violate the idempotency property for iac scripts.
for iac idempotency is the property whichensures thateven after nexecutions where n theprovisionedsystem senvironmentisexactlythesameasitwasafter thefirst executionof therelevant iacscripts.
we usea reddit post8to explain further.
in the post the user mentions that a new string is appended every time the iac script is executed.
such execution becomes problematic when the script is run multiple times because the desired behavior is that the new string will only be defectshavenotbeenreportedinpriorresearchrelatedtodefect categorization for non iac software.
however in iac related publications researchershavereportedtheexistenceofidempotency defects for chef scripts and for cfengine scripts .
example anidempotencydefectcausedunwantedchangesto artifacts that should not be modified9.
idempotency related defects can cause file backup problems package update problems database setup problems logging problems and network setup problems .
security thiscategoryrepresentsdefectsthatviolateconfidentiality integrityoravailabilityfortheprovisionedsystem.examplesecurity relateddefectsincludeexposingsecretsinlogs specifying ssl certificates that lead to authentication problems and hard coding secrets such as passwords .
prior research on defect categorization has also observed security related defects to appear in other types of software systems e.g.
in blockchain projects video game software cloud management software and oss apache linux and mozilla projects .
example settingupuseraccountsiscommoniniacscripts but in the process user confidentiality may be breached.
for example thesecuritydefectfromsection1islistedinabugreport .
thedefectleakspasswordsusingvariablessuchas rabbit password in puppet logs.
the defect impacts seven openstack projects and isfixedbyaddingthe secret attribute .anotherexampleiskeeping atokenaliveindefinitely whichprovidesaccesstoanyonewithout authentication and lasts indefinitely if not disabled11.
service this category represents defects related to improper provisioning and inadequate availability of computing services suchasloadbalancingservicesandmonitoringservices.servicerelateddefectscanbecausedbyimproperspecificationofattributes whileusingthe service resourceforpuppet orchef orthe service module for ansible .
service related defects have previouslyreportedforcloudmanagementsoftware .rahmanand williams reportedprovisioningofwebserviceanddatabase services to appear in defective iac scripts.
755example service related defects can cause provisioned services to stop unexpectedly as it happened for a provisioned mysql service12.
the defect occurred as the provisioned service was not workingwithatitleprovidedasinput.otherexamplesofservicerelated defects include not being able to start monitoring services such as nagios and load balancing services such as haproxy .
syntax thiscategoryrepresentsdefectsrelatedtosyntaxiniac scripts.
syntax defects have also been reported in prior research studies ray et al.
and pascarella et al.
in separate studies identifiedgenericprogrammingdefectsforossgithubprojects whichincludedprogrammingsyntaxerrors.islametal.
also identified syntax related defects for deep learning projects.
example theopenstackfuelplugindevelopmentworkflow usesacontinuousintegrationpipeline whichgenerateserrorsifiac scriptsfailstylechecks.otherexamplesofsyntax relateddefects include specifying wrong types for variables .
answer to rq1 defect taxonomies can shape tool development testingandverificationefforts andeducationaboutsoftware development.asdiscussedinsection2.
thedomainofiaclacksadefecttaxonomy andthustheabilitytoprioritizetooldevelopment testingandverificationefforts anddisseminatesoftwaredevelopment knowledge in the classroom could be limited.
answer to rq1 contributes to the above mentioned needs by providing i a defect taxonomy and ii a discussion related to consequences for each defect category.
.
rq practitioner perception wepresentthemethodologyandfindingsforrq howdopractitionersperceivetheidentifieddefectcategoriesforinfrastruc ture as code scripts?
.
.
methodology for rq .practitioner agreement with the identifieddefectcategoriesinsection3.2canindicatetherelevance of the eight categories.
we answer rq 2by deploying an online survey to practitioners.
in the survey we ask practitioners howmany years they worked with iac scripts.
then we provide def initions and examples for each category.
we wanted to assess if practitionersagreethatourcategoriesareinfactiac relateddefectcategories.weasked wehaveidentifiedeightdefectcategoriesfor iac puppet scripts.eachofthesecategoriesarelistedbelow.to which extent do you agree with our list?
.
we construct the survey following kitchenham and pfleeger s guidelines i use likert scaletomeasureagreementlevels stronglydisagree disagree neutral agree andstronglyagree ii addexplanationsrelatedtothe purposeofthestudy howtoconductthesurvey preservationof confidentiality andanestimateofcompletiontime and iii conductapilotsurveytogetinitialfeedback.fromthefeedbackofthepilot survey weaddedanopen endedtextboxsothatsurveyedpractitioners can further respond.
the survey questionnaire is available and included in our verifiability package .
we offered a drawing of two usd amazon gift cards as an incentive for participation following smith et al.
s recommendations on incentivizing surveys.
we deploy the survey to servicedocumentationconditionalsyntaxsecuritydependencyconfig.dataidempotency percentage response strongly disagree disagree neutral agree strongly agree figure findings from survey.
practitioners mostly agree with idempotency.
practitionersfromapril19 2019toaugust15 .wedistributed the survey to practitioners via e mail following the internal review board irb protocol .
we collect practitioner e mail addresses from the oss repositories used in our empirical analysis.
.
.
answer to rq .of the practitioners responded.
we observethe eight categories to have relevanceamongst practitioners ofthe66surveyrespondentsagreewithoneof the eight categories.
respondents agree most with idempotency withanagreementrateof79 .theleastagreeduponcategoryis service.detailsofoursurveyresultsislistedinfigure4 wherethe defectcategoriesaresortedfromtoptobottombasedonagreementrate.thepercentageofrespondentswhoagreedorstronglyagreed with each category is listed on the right.
weacknowledgethesurveyresponseratetobelow .
.however low survey response rates are not uncommon in software engineering research smith et al.
reported software engineering surveyresponseratetovaryfrom6 to36 .fromemailresponses we observe the following reasons for low response inactive or undeliverable email addresses of practitioners practitioners ask ing for full confirmation on receiving monetary incentives and practitioners not using puppet in recent years.
practitioners provide reasoning on why they agree disagree or remainneutral.forexample onepractitionerconsideredsyntaxrelateddefectstobelessimportant assyntax relateddefectsshouldbefound duringinitialtesting .thepractitioneridentifiedidempotencyandconditionaldefectsas twokeyones .anotherpractitioner highlightedtheimportanceofidempotency statingidempotency defects may not produce functional issues but can cause product indirectissues .wenoticecontraryviewsrelatedtoidempotency as well.
one practitioner stated i have never run into defects in puppet sidempotencymechanisms insteadthepractitionerclaimed dependency related defectsto beprevalent stating debugging dependency loops is tricky and happens often .
another practitioner indicated limitations of iac tools as a possible explanation on why dependencydefectscouldbefrequent theproblem withthese tools it is not clear how to do it .
for practitioners who provided neutral responses the presence of defects is more relevant than the category i am more concerned aboutthedefectitselfratherthanitscategory.ifihavethatinfo it will be good but it is not mandatory .
practitioners also reported defect categories not included in our taxonomy learningcurve maintainability parallelism scalability support and usability .
parallelism and scalability are 756performance related features of iac tools.
learning curve maintainability support and usability are related to user experience of iac tools.
answer to rq2 we observe our identified defect categories to have relevance amongst practitioners.
surveyed practitioners have varyingopinionsonwhatdefectcategoriesaremorefrequentiniac development which are possibly formed by their own experiences.
furthermore practitionershavereportedwhatadditionaliacdefect categories may exist that is not included in our taxonomy.
automated categorizer for infrastructure as code defects catgegorization of iac defects using raters is resource consuming.
in prior research huang et al.
emphasized the importance of determining defect categories using an automated technique stating the process of manual software defect categorization as at besta mundane mind numbing activity .
anautomated tool to detect iac defect categories can be useful to i analyze reposito ries with iac scripts at scale ii mitigate recall bias common in incident reviews e.g.
practitioner bias in recalling defects in iac scripts13 and iii provide groundwork for future defectrelatedtoolsforiac.researcherscanusesuchautomatedtoolto automatically identify which script includes what defect category.
weconstructanautomatedtoolcalled automated categorizer forinfrastructureascode defects acid toautomaticallyidentify iac defect categories at scale.
acid analyzes each ecm and determineswhetherornotanyofthe eight identifieddefectcategories canbeidentifiedfromtheecm.acidtakesoneormultiplerepositoriesasinput andasoutputreportsthedefectcategoryforeach ecm.ifnoneoftheeightcategoriesareidentified acidreports nodefect indicatingnodefectisidentified.acidcanreport anecmtobelongtomultipledefectcategories.acid sdesignis language independent.acidusesrules whichusesdependency parsing and pattern matching to detect defect categories with ecms.
we first describe how we construct the rules used by acid to detect defect categories.
next we use a running example toillustrate the components of acid and how acid determines a defectcategory.finally weevaluatetheaccuracyofacidbyusing an oracle dataset.
rules used by acid we construct rules needed for acid by abstracting patterns that appear in the ecms and their correspondingdiffs obtainedfromthe61openstackossrepositories.
our hypothesis is that we can abstract patterns from the ecms and their corresponding diffs to automatically detect defect categories for other datasets.
we use table to demonstrate our approach.
the ecm column presents a set of ecms that include fix a string pattern that represents a defect related action.
the dependent column shows the string patterns upon which the defect related action is applied.
for example for fix catalog compilation when not configuring rule construction ecm dependent fixcatalog compilationwhennot configuringendpoint compilation fix spurious warning in pipeline check warning fix puppet lint characters lint typo fix typo endpoint fix is appliedupon compilation .wecanabstractpatternsusing fix andtokensinthe dependent columntoconstruct a rule to identify a defect category.
for example in table the keywords compilation warning lint and typo islinkedwith fix .thefirstauthorlookedintothesetof1 448ecmstodetermine whatstringpatternsneedtobecapturedasdependentstoconstruct rules.
some ecms such as varioussmall fixes which is downloaded fromanossrepositorycalled fuel plugin contrail indicatethat a defect related action occurred but do not clearly express whatdefectcategorycouldbeidentified.weaddressthischallengeby inspecting diffs of ecms in addition to dependency parsing.
from thediffsofecmswecanidentifycodeelementsandusethemin rules for any of the eight categories.
as an example in figure we present the changeset for the ecm various small fixes .
we observe that configuration data are changed using three variables network scheme cidr and netmask .
an ecm can include a sentence that expresses defect related actions for multiple defect categories.
for example for fix dependenciesandvarioustypos whichisdownloadedfromanossrepos itory weobserveactionstakentoresolvetwodefectcategories dependency defect and syntax defect.
for ecms with one or multiple sentences acid maps an ecmto multiple defectcategories if multiplerulesaresatisfied.therulesacidusestodetecteachoftheeightdefectcategoriesislistedintable2.intable2 the category and rule column respectively presents thedefect categories and correspondingrulestodetectthecategory.thepresentedrulesusefunctions.thefunctionsusestringpatternmatchingtocheckifsen tencesand ordiffsofanecmsatisfyacertaincondition.amappingofthefunctionsandstemmedstringpatternsareprovidedintable3.
forexample the hasdefect x.sen functionreturnstrueifanyof the provided string patterns listed in table appear for a sentence in an ecm x.sen.
in table functions chan edinclude x.dif f chan edcomment x.dif f andchan edservice x.dif f identify if the diff of ecm xconsists of changes in include statements comments andservice resources respectively.
datachan ed x.dif f identifies if the diff includes a change in configuration data.
except for function hasdefect string patterns for all other functions are derived from our qualitative analysis process.
we derive string patternsfor hasdefect frompriorwork listedintable3.
forfourcategories conditional idempotency security andsyntax acid does not use diff content because our qualitative analysis didnot identifyany puppet specific codeelement inthediffs that express the defect category of interest.
execution of acid we construct ecms using git mercurial andbugreportapis andfeedtheecmsasinputtoacid.acid network scheme hiera network scheme cidr settings netmask cidr to netmask cidr netmask short netmask to cidr netmask network scheme hiera hash network scheme cidr pick get network role property neutron mesh cidr arrowhookleft get network role property contrail vhost0 cidr netmask pick get network role property neutron mesh arrowhookleft netmask get network role property contrail vhost0 arrowhookleft netmask netmask short netmask to cidr netmask figure diff of ecm various small fixes .
configuration dataarechangedinthediffindicatingtheecmtoberelated with category configuration data .
table rules to detect defect categories category rule conditional hasdefect x.sen hascond x.sen .dep configuration datahasdefect x.sen hasstorconf x.sen .dep hasfileconf x.sen .dep hasnetconf x.sen .dep hasuserconf x.sen .dep hascachconf x.sen .dep datachan ed x.diff dependency hasdefect x.sen hasdepe x.sen .dep chan edinclude x.diff documentation hasdefect x.sen hasdoc x.sen .dep chan edcomment x.diff idempotency hasdefect x.sen hasidem x.sen .dep security hasdefect x.sen hassecu x.sen .dep service hasdefect x.sen hasserv x.sen .dep chan edservice x.diff syntax hasdefect x.sen hassynt x.sen .dep table string patterns used for functions in rules function string pattern hasdefect error bug fix issu mistake incorrect fault defect flaw hascond logic condit boolean hasstorconf sql db databas hasfileconf file permiss hasnetconf network ip address port tcp dhcp hasuserconf user usernam password hascachconf cach hasdepe requir depend relat order sync compat ensur inherit hasdoc doc comment spec licens copyright notic header readm hasidem idempot hassecu vulner ssl secr authent password secur cve hasserv servic server hassynt compil lint warn typo spell indent regex variabl whitespac uses four steps to identify a defect category sentence tokenization text pre processing dependency parsing and rule matching.
weuse table to describe how acid processes an example ecm update incorrect comment about nova network status.
the network manifestcontainedacommentthatsaidthatnova networkwasno longer receiving any patches.
that s not actually the case so replace the comment with a new description that describes the current state which is downloaded from the puppet nova repository15.
the ecm also includes a change in comment as shown in figure .
optional whether the network service should be enabled.
defaults tofalse defaults totrue figure6 diffofecmusedasrunningexamplewheresource code comments are changed.
table example to demonstrate acid s execution step step step step update incorrect comment aboutnova network statusupdat incorrectcomment aboutnova network statuhead depe rule matchedfor documenta tion defect as per table the network man ifest contained acomment that saidthat nova network was no longer receiving any patches.network man ifest containcomment thatsaid that novanetwork was no longerreceivani patchhead depe no match that s not actuallythe case so replacethe comment witha new descriptionthat describes the current state.that not actualcase so replaccomment with newdescriptthat describ current statehead depe no match step sentencetokenization weapplysentencetokenization oneachecmtosplitanecmintomultiplesentences.inthecaseof table the ecmincludes three sentences and upon application of step we obtain three individual sentences i update incorrect commentaboutnova networkstatus ii thenetworkmanifest containedacommentthatsaidthatnova networkwasnolonger receiving any patches and iii that s not actually the case soreplace the comment with a new description that describes the current state .
step text pre processing from each ecm we remove english stopwords suchas a the and by .next weremovespecialcharactersandnumericliterals.then weapplyporterstemming oneachwordforeachecm.acidwillapplytextpre processing for each of the individual sentences for the ecm provided in table .
the output of text pre processing is provided in the step column.
step dependencyparsing usingdependencyparsing w e identify heads and dependents for output obtained from step .
dependency parsing identifies a head an action item and dependents i.e.
the words in the sentence which are dependent upontheactionitem.forexample intable4weobservethekeyword updat to be a head.
the dependent for updat is comment .
to identifydependentsandheads weusethespacyapi which leveragesdatasets whereheadsanddependentsareannotatedby human raters for the english language .
using this annotation dependency parsing identifies what tokens in a sentence are heads anddependents.weusetheidentifiedheadsanddependentsinthe next step.
output after step for our example ecm is listed in step of table .
step rulematching fromdependencyparsingoutputofstep weapplyrulematchingtodetermineadefectcategory.therules arelistedintable2.ifasentenceforanecmsatisfiesanyofthe rules thecorrespondingdefectcategoryisassignedtothatecm.
for our running example we observe the rule hasdefect x.sen 758table acid s accuracy for oracle dataset category occurr.
precision recall conditional .
.
configuration data .
.
dependency .
.
documentation .
.
idempotency .
.
security .
.
service .
.
syntax .
.
no defect .
.
average .
.
hasdoc x.sen.dep chan edcomment x.dif f issatisfiedas i the ecm satisfies hasdefect x.sen as the keyword incorrect appearsin updatincorrectcommentaboutnovanetworkstatu ii the sentence updat incorrect comment about nova network statu includesadependent comment whichsatisfies hasdoc x.sen.dep and iii asshowninfigure6 commentsarechangedinthedifffor theecm so chan edcomments x.dif f issatisfied.fortheother sentences no rules are matched no match in column step .
therefore the ecm belongs to documentation .
evaluation of acid we use raters who are not authors of the paper to construct an oracle dataset to evaluate acid.
to construct the oracle dataset raters perform closed coding where they map each assigned ecm to any of the categories identified insection3.
.themappingtaskwasmadeavailableusingawebsite16.
each rater was provided the ieee standard classification for software anomalies and a handbook on puppet for reference.
we recruit raters from a graduate level class of students where students volunteered to participate in constructing the oracle dataset.
the graduate class is focused on devops principles.
we used balanced incomplete block design to select and distribute the132 ecms amongst the22 raters so thateach ecm is reviewedbyatleasttworaters.uponcompletionofthemapping task weobservetheagreementratetobe71.
andcohen skappatobe0.
whichis substantialagreement accordingtolandisand koch .
the first author resolved disagreements.
uponcompletionofconstructingtheoracledataset weevaluate acid by computing the precision and recall of acid for the oracle dataset.
precision refers to the fraction of correctly identified categoriesamongthetotalidentifieddefectcategories asdetermined by acid.
recall refers to the fraction of correctly identified defect categories that have been retrieved by acid over the total amount ofdefectcategories.wereporttheprecisionandrecallvaluesfor eachdefectcategoryintable5.weobservetheaverageprecision and recall to be respectively .
and .
across all categories.
we notice that false negatives occur when the dependency parsing technique incorrectly identify tokens in the ecm that have no relationshiptoadefectcategoryoridentifiestokensthatarerelated toanincorrectcategory.forexample fortheecm fixfollowing warnings instead of warnings dependency parsing incorrectly identifies following asthedependent.weobservekeywordmatchingtocontributetofalsepositives forexampleacidincorrectly identifiestheecm bug1085520 supportinstance storebacked oss repositories satisfying curation criteria ghb moz ost wik initial repo.
count criteria iac scripts criteria not a clone criteria commits month criteria contributors final repo.
count amis for builders.
add new secrets.
as a security related defect even though the ecm corresponds to adding a new feature.
verifiability all constructed datasets and acid s source code are available online .
acid is also available as a docker image for use17.
empirical analysis in this section we provide the methodology and findings for theresearch question rq3 how frequently do the identified defect categories appear for infrastructure as code scripts?
table attributes of the four datasets attribute ghb moz ost wik repo.
type git mercurial git git tot.
repos tot.
commits tot.
puppet scripts tot.
puppet related commits time period .
datasets we conduct our empirical analysis with four datasets of puppet scripts.weconstructthreedatasetsfromtheossrepositoriesmaintained by three organizations mozilla openstack and wikimedia commons .
we select repositories from these three organizationsbecausetheseorganizationscreateorusecloud based services.
we construct the other dataset from oss repositorieshosted on github as companies tend to host their popular oss projectsongithub .inourcollectedrepositoriesiac related ecms correspond to defects that have been previously reported by respective practitioners.
munaiahetal.
advocatedforcurationofossrepositories before conducting empirical analysis.
we apply the following criteriatocuratethecollectedrepositories criteria atleast11 of the files belonging to the repository must be iac scripts.
jiang and adams reportedthatinossrepositoriesiacscriptsco exist withothertypesoffiles suchassourcecodefiles.theyobserved a median of of the files to be iac scripts.
by using a cutoffof we assume to collect repositories that contain sufficientamount of iac scripts.
criteria the repository is not a copy of another repository.
criteria the repository must have at least two commits per month.
munaiah et al.
used the threshold of at least two commits per month to determine which repositories have enough software development activity.
we use this threshold tofilterrepositorieswithlimitedactivity.
criteria therepository hasatleast10contributors.ourassumptionisthatthecriteriaof 759table sanity checking acid s accuracy category occurr.
precision recall conditional .
.
configuration data .
.
dependency .
.
documentation .
.
security .
.
service .
.
syntax .
.
no defect .
.
average .
.
atleast10contributorsmayhelpustofilteroutirrelevantrepositories.
previously researchers haveused thecutoff of atleast nine contributors asacurationcriterion.asshownintable6 291repositoriesmetourfilteringcriteria.attributesofthecollected repositories are available in table .
.
sanity check for acid beforeapplyingacidforalldatasets weapplyasanitycheckto assess acid s detection performance for ecms not included in the oracledataset.
thefirst authorrandomlyselected 500ecmsfrom each of the four datasets and applied acid on ecms.
we report the precision and recall in table .
we observe the recall for alldefectcategoriesis .
whichindicatesacid sabilityto detect mostexisting defectcategories butgenerate falsepositives.
.
rq frequency of defect categories inthissection weanswer how frequently do the identified defect categories appear in infrastructure as code scripts?.
.
.
methodology for defect category frequency.
weanswer rq3byreporting defectproportion and scriptproportion values as well as temporal frequency for each defect category.
defect proportion refers to the percentage of commits in the dataset that belong to a defect category similar to hindle et al.
.
the defect proportion metric provides a summarized view of defect category frequency across the whole dataset whereas script proportion refers to the proportion of scripts that are modified in commits thatinclude atleastonecategory.
practitionerscanfind script proportion valuesuseful asthemetricquantifieshowmanyscripts include at least one defect category.
defect year shows how each category of defects evolve with time and summarizes temporal trends.wereportthetemporalfrequencyforeachyearusingequation where we calculate the metric defect year for a certain category xthat occurs in year y. defect year x y of ecms in year yand marked as defect category x total ecms in year y .
.
answer to rq how frequently do the identified defect categories appear in infrastructure as code scripts?
we report defect proportion and script proportion values for the eight categoriesin table .
configuration data defects is the most frequently occurringcategorybasedonthedefectproportionmetric.network is the most frequent subcategory .
.
of the identifiedtable defect and script proportion for defect categories defect prop.
script prop.
categ.
ghb moz ost wik ghb moz ost wik cond.
.
.
.
.
.
.
.
.
conf.data .
.
.
.
.
.
.
.
depe.
.
.
.
.
.
.
.
.
docu.
.
.
.
.
.
.
.
.
idem.
.
.
.
.
.
.
.
.
secu.
.
.
.
.
.
.
.
.
serv.
.
.
.
.
.
.
.
.
synt.
.
.
.
.
.
.
.
.
total .
.
.
.
.
.
.
.
configurationdatadefectsarenetworkdefects.frequencyofsubcategories for configuration data defects is available online .
we observe .
.
scripts to be modified in commits related to configuration data which is the highest across all defect categories.
as reported in the total row in table we observe .
.
.
and .
of all commits to include at least one of the eightdefectcategories respectively forgithub mozilla openstack and wikimedia.
also we observe .
.
.
and .
of all scripts to include at least one defect category respectively forgithub mozilla openstack andwikimedia.similartodefect proportion based on script proportion values we observe configurationdata relateddefectstobethedominantcategoryacrossall four datasets.
infigure7 thex axispresentsyears andthe y axispresents defect year valuesfor eachyear.from figure7 over timewe observe defectstobereportedacrossalldatasetsasindicatedby total .
forconfigurationdata relateddefects thedefect yearvaluedoes notreducetozero indicatingconfigurationdatadefectstobereported throughout the entire lifetime period for all four datasets.
ourdefectcategoriescancorrelate.correlatingcategoriesare detectable ifrulesformultiplecategoriesaresatisfiedthenacid will report an ecm belonging to multiple categories.
ecms that tested positive for two categories were .
.
.
and .
respectively forgithub mozilla openstack andwikimedia.
ecms that tested positive for three categories were .
.
.
and .
respectively for github mozilla openstack and wikimedia.foranyofthedatasetswedonotobserveecmsthat tested positive for four or more defect categories.
answertorq3 configurationdataisthemostdominantdefect category.ouridentifieddefectcategoriescancorrelate forexample ecms that tested positive for two categories were .
.
across four datasets.
discussion we discuss our findings in this section.
practitionerperceptionandobservedevidence according to srikanth and menzies documenting developer beliefs should bethestart nottheend ofsoftwareengineeringresearch.oncepreva lentbeliefsarefound theyshouldbecheckedagainstreal worlddata suggestingresearcherstocomplementsurveydatawithsoftware repository data.
we too have complemented survey data with analysisofossdata.wehavereportedvaryingpractitionerperceptions for the identified categories in section .
.
.
we notice congruence condition conf data depend document idempot security service syntax total yeardefect year github a condition conf data depend document idempot security service syntax total yeardefect year mozilla b condition conf data depend document idempot security service syntax total yeardefect year openstack c condition conf data depend document idempot security service syntax total yeardefect year wikimedia d figure evolution of defect proportion for eight categories github 7a mozilla 7b openstack 7c and wikimedia 7d.
for each dataset total presents the proportion of commits which includes at least one category of defect.
for two categories configuration data and dependency are the second most agreed upon category and also frequently occurs in oss datasets.
on the other hand service defects are least agreed upon but they are more frequent than idempotency the defect category surveyed practitioners most agreed upon.
in the reddit post mentioned in section practitioners reported only one defect category syntax.
along with syntax our taxonomyincludessevenotherdefectcategories.suggestionsfromonlineforumscouldbeinconclusive andpractitionerscanfindour taxonomy helpful.
mitigation companiescanmitigatetheoccurrenceofdefects by incorporating tools that target one or more of the identifiedcategories during iac development.
for example companies can adopt rspec puppet to reduce conditional and service defects.
761tools such as tortoise librarian puppet and puppetstrings might be helpful respectively in mitigating configurationdata dependency anddocumentationdefects.staticanalysis tools such as slic and puppet lint might respectively be helpful in mitigating security and syntax defects.
mitigation of idempotency defects might be possible through early detection of idempotency with hummer et al.
s approach that uses modelbased testing to detect idempotency.
implications ourpapercanbehelpfulinthefollowingmanner betterunderstandingofdefects useofdefinitionsandexamples in section .
to understand the consequences of iac defect categories and activities needed to mitigate each defect category triaging defects using our taxonomy practitioners can find what iac relateddefectcategoriesarebeingreportedforalongperiod helping them make informed decisions on defect triaging measuringiacscriptquality useourreportedfrequencyintable as a reference saving manual effort zou et al.
identified three reasons why practitioners find automated defect categorization important better resource allocation saving manual work in classifying defects and facilitating postmortem analysis.
for automated categorization of iac defectsacid canbe helpfulfor practitioners.
manual analysis of one ecm on average has taken seconds perrater whereas acidtakes0.09secondsona macosmojave laptop with .
ghz intel core i5 processor and gb memory.
acidcouldbeusefulforteamsthatdon thaveraterstoperform postmortem analysis using qualitative coding and constructing iac relatededucation materials educatorswho conductiac relatedcoursesattheundergraduateandgraduatelevel can use section .
to showcase what types of quality issues can arise while developing iac scripts.
futurework researcherscan investigateifabove mentioned recommendations can actually reduce defects in iac scripts.
the coding patterns that acid use could be further leveraged in investigating if defect categories for iac such as configuration data can be detected at compile time.
threats to validity we briefly describe the limitations of our paper in this section.
conclusion validity the derived defect categories and the oracledatasetaresusceptibletoraterbias.inbothcases wemitigate rater bias by allocating multiple raters.
also we use the content of commitmessagestodeterminethedefectcategoriesforiacscripts which is limiting as commit messages do not always express a defect related action.
practitioners may use other keywords that we did not include.
we mitigate this limitation by using a set of defect relatedkeywords derivedfrompriorresearch andshowntobeadequateindetectingdefect relatedcommits .also acid uses dependency parsing that relies on annotated datasets mined from news articles which can be limiting to capture dependencies.
external validity we have not analyzed proprietary repositories andourfindingsarelimitedtoossdatasetswithpuppetscripts.
wemitigatethislimitationbyminingossrepositoriesfromgithub and three organizations.
we conduct our empirical study with one iactoolcalledpuppet.weacknowledgethatourfindingsmaybelimited to puppet.
however evidence demonstrates our categories toexistacrosslanguages e.g.
idempotencyappearsforchef andcfengine .consideringfrequencyandcategory schwarzet al.
foundconfiguration relatedcodesmellstogeneralizeacross multiplelanguages whichsuggeststhatourfindingsrelatedtoconfiguration data defects may generalize too.
furthermore acid sdesign is language independent.
acid uses dependency parsing and pattern matching to detect defect categories.
internalvalidity thedefectcategorylistisnotcomprehensive as the derivation process is dependent on the collected commits andraterjudgment.wemitigatethislimitationwith1 448ecms and two raters to derive defect categories.
we acknowledge the limitations of the rules presented in table as the construction is dependentupontheecmsanddiffsofthecollectedcommits along withthefirstauthor sjudgment.practitionerscanusecertainstring patternstodescribeacategorythatwedidnotlist.wemitigatethis limitation by inspecting ecms and diffs to derive the used string patterns.
conclusion defectsiniacscriptscanhaveseriousconsequences.defectcategorization can help practitioners to make informed decisions on how to mitigate iac defects.
we applied qualitative analysis on defect related commits to identify defect categories for iac scripts.
wesurveyed66practitionerstoassessifpractitionersagreewith theidentified defectcategories.next weconstructeda toolcalled acid and apply acid on commits from repositories to automatically identify defect categories in iac scripts.
ourderivedtaxonomyconsistsofeightdefectcategoriesthatincluded idempotency a category specific to iac.
amongst survey respondents of the practitioners agreed with idempotencyrelated defects and ofthe practitionersagreed with one of the identified defect categories.
we observe configuration datarelated defects to be the most frequent defect category whereas idempotencyistheleastfrequentlyoccurringdefectcategory.using our reported defect category frequency results practitioners can prioritize v v efforts by fixing configuration data defects that occur in .
.
of iac scripts.
our research can be helpful for practitioners to improve iac scriptquality astheycanuseacidtoidentifydefectcategoriesau tomatically anduseourdefinitionsandexamplesofeachidentified defect category to assess the importance of the identified defect categories.ourtaxonomyofiacdefectscanhelppractitionersin understanding the nature of defects and guide them in triaging defects prioritizing v v efforts and measuring iac script quality.
we hope our findings will facilitate further research in the domain iac script quality.