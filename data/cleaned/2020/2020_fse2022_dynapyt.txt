dynapyt a dynamic analysis framework for python aryaz eghbali aryaz.eghbali iste.uni stuttgart.de university of stuttgart stuttgart germanymichael pradel michael binaervarianz.de university of stuttgart stuttgart germany abstract python is a widely used programming language that powers important application domains such as machine learning data analysis and web applications.
for many programs in these domains it is consequential to analyze aspects like security and performance and with python s dynamic nature it is crucial to be able to dynamically analyze python programs.
however existing tools and frameworks do not provide the means to implement dynamic analyses easily and practitioners resort to implementing an ad hoc dynamic analysis for their own use case.
this work presents dynapyt the first general purpose framework for heavy weight dynamic analysis of python programs.
compared to existing tools for other programming languages our framework provides a wider range of analysis hooks arranged in a hierarchical structure which allows developers to concisely implement analyses.
dynapyt features selective instrumentation and execution modification as well.
we evaluate our framework on test suites of popular open source python projects lines of code in total and show that it by and large preserves the semantics of the original execution.
the running time of dynapyt is between .2x and 16x times the original execution time which is in line with similar frameworks designed for other languages and .
.
faster than analyses using a built in tracing api offered by python.
we also implement multiple analyses show the simplicity of implementing them and some potential use cases of dynapyt.
among the analyses implemented are an analysis to detect a memory blow up in pytorch programs a taint analysis to detect sql injections and an analysis to warn about a runtime performance anti pattern.
ccs concepts general and reference cross computing tools and techniques software and its engineering software maintenance tools .
keywords dynamic analysis python acm reference format aryaz eghbali and michael pradel.
.
dynapyt a dynamic analysis framework for python.
in proceedings of the 30th acm joint european permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than the author s must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse november singapore singapore copyright held by the owner author s .
publication rights licensed to acm.
acm isbn .
.
.
.
engineering conference and symposium on the foundations of software engineering esec fse november singapore singapore.
acm new york ny usa pages.
introduction python has evolved into one of the most important programming languages.
it is widely used across many application domains e.g.
machine learning scientific computing server side web applications game development and natural language processing.
in addition to serving as a language to develop glue code and scripts large scale python code bases are behind widely used websites and apps used by billions of people.
moreover highly popular frameworks and libraries such as pandas numpy django and pytorch are implemented in python.
in python has become the secondmost popular of all languages across code hosted at github.
the popularity of the language combined with its dynamic language features such as the absence of statically declared types or the ability to add and remove object attributes at runtime make python a prime target for dynamic analysis.
indeed several dynamic analyses have been proposed e.g.
to detect bugs to enforce differential privacy or to slice programs .
however compared to other popular dynamic languages e.g.
javascript which have seen a surge of dynamic analyses over the past few years dynamic analysis for python has not yet become mainstream.
we argue that the sparsity of dynamic analyses for python is at least partially due to a lack of suitable frameworks to build on.
to ease the implementation of dynamic analyses general purpose dynamic analysis frameworks have been created for other languages e.g.
pin and valgrind for native binaries disl and roadrunner for java jalangi for javascript and wasabi for webassembly.
these frameworks all share the idea of providing to analysis developers an easy to implement interface to observe events during a program s execution typically in the form of callbacks or hooks an analysis implements.
these hooks are then invoked by the analysis framework during the program s execution typically by instrumenting the program before its execution.
yet despite the importance of python there currently is no such framework for python hindering the development of dynamic analyses.
this paper presents dynapyt the first general purpose dynamic analysis framework for python.
from the perspective of an analysis developer the framework offers a set of hooks into specific kinds of runtime events such as function calls writes of object attributes and control flow decisions.
given an analysis that implements some of these hooks and a program to analyze dynapyt instruments the program s code via source to source transformation.
the instrumentation code wraps the existing code with calls into the dynapyt november singapore singapore eghbali and pradel table comparison of general purpose dynamic analysis frameworks.
frameworktarget languagepay per usenb.
of hookshierarchy of hooksbehavior manipulation jalangi2 javascript wasabi webassembly sys.settrace python dynapyt python runtime engine which dispatches the runtime events to the corresponding analysis hooks.
by default the instrumentation preserves all behavior of the original program.
however dynapyt also allows analyses to manipulate the behavior e.g.
to modify the value that gets written into an object attribute or to flip the outcome of a control flow decision.
dynapyt addresses several challenges that prior dynamic analysis frameworks handle only partially or not at all.
one of them is the fact that there are many different runtime events of potential interest.
for example there are nine kinds of memory accesses eleven different control flow events and kinds of binary operations.
to enable an analysis writer to easily select events of interest dynapyt arranges a total of events into an event hierarchy and allows the analysis writer to select events at an appropriate level of abstraction.
another challenge is to impose as little overhead as needed to perform a specific analysis.
to this end dynapyt follows a pay per use principle which adds instrumentation code only when needed to keep track of exactly those runtime events an analysis is interested in.
as a result the runtime overhead imposed by the framework scales with the complexity of the analysis.
to put dynapyt s contributions in perspective table compares existing dynamic analysis frameworks and our work.
jalangi and wasabi are two frameworks for other languages which have inspired our design.
both lack the event hierarchy that dynapyt offers but instead offer only a flat set of and hooks for analyses to implement respectively.
the only other technique available for python is sys.settrace a built in function offered by the cpython implementation of the language.
it allows for observing every executed opcode but does not follow the pay per use principle.
moreover it focuses only on observing behavior but in contrast to dynapyt lacks the ability to manipulate an execution.
we empirically compare with sys.settrace in section and provide a detailed discussion of it in section .
in addition to language agnostic challenges dynapyt needs to address unique challenges due to specific features of python and the characteristics of their semantics.
for example these challenges include the way self and super are resolved which can easily lead to undefined