detectingand understanding javascriptglobalidentifier conflicts onthe web mingxue zhang chinese universityof hong kong hong kong sar china mxzhang cse.cuhk.edu.hkwei meng chinese universityof hong kong hong kong sar china wei cse.cuhk.edu.hk abstract javascriptiswidelyusedforimplementingclient sidewebapplications and it is common to include javascript code from many differenthosts.however inawebbrowser allthescriptsloaded inthesameframeshareasingleglobalnamespace.asaresult a scriptmayreadorevenoverwritetheglobalobjectsorfunctionsin other scripts causing unexpected behaviors.
for example ascript canredefineafunctioninadifferentscriptasanobject sothatany callofthat functionwouldcause an exception at run time.
we systematically investigate the client side javascript code integrity problem caused by javascript global identifier conflicts inthispaper.wedevelopedabrowser basedanalysisframework jsobserver tocollectandanalyzethewriteoperationstoglobal memorylocationsbyjavascriptcode.weidentifiedthreecategories of conflicts using jsobserver on the alexa top 100k websites and detected145 conflictson31 615websites.
werevealthatjavascriptglobalidentifierconflictsareprevalent andcouldcausebehaviordeviationatruntime.inparticular we discovered that redefined functions were called after being overwritten and many scripts modified the value of cookies or redefinedcookie relatedfunctions.ourresearchdemonstratedthat javascript global identifier conflict is an emerging threat to both the webusersandthe integrityofwebapplications.
ccs concepts softwareanditsengineering softwaresafety security andprivacy browser security .
keywords javascript identifier conflicts webapplications acmreference format mingxuezhangandweimeng.
.detectingandunderstandingjavascript global identifier conflicts on the web.
in proceedings of the 28th acm joint europeansoftwareengineeringconferenceandsymposiumonthefoundationsofsoftwareengineering esec fse november8 13 virtual event usa.
acm new york ny usa 12pages.
.
permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
esec fse november 8 13 virtual event usa associationfor computing machinery.
acm isbn ... .
introduction it is very common to separate code of different functionalities into multipleexternaljavascriptfilesandincludethescriptsfrommany different hosts in developing web applications.
this allows a developer to reuse the code in other third party programming libraries and to easily build an application rich of functionalities.
for example to include a social plugin like the facebook like button a web developerneedstoincludeonlyaremotescriptfromfacebookand add two div tags inher his webpage .
whileenhancingthefunctionalityofanapplication theincluded third party scripts may cause unexpected behavior to the developer sowncode.in javascriptand manyotherprogramminglanguages developersuseanidentifiertorefertoavalue objectora function in memory.
in the client side javascript runtime environment i.e.
thewebbrowser thereexists asingleglobalnamespace for all identifiers in scripts loaded in the same frame.
any variable or function defined in a script s own main scope is available to any otherscriptexecutinginthesameframe.thismeansthatascript can not only directly call global functions and read the values of global variables in another script but also modify its global objects or functions.
since javascript is a weakly typed programming language ascriptcanevenchangethetypeofaglobalvariable function without immediately causing any exceptions or errors.
suchkindofglobalidentifierconflictscancompromisethe integrity ofthedeveloper sowncode causingittotakeadifferentbranch return an incorrectvalue orsimply crash etc.
global identifier conflicts are difficult to prevent.
on the one hand to avoid identifier conflicts a developer needs to carefully examinethesourcecodebeforeshe heincludesathird partyscript whichcouldbeverydifficultbecauseofcodeminimizationorobfuscation.she he might have to changeall conflictinglocations in her his own code to have a conflicting script included unless an alternativenon conflictingscriptcanbeused.ontheotherhand if no conflict is found a script might still cause a conflict in the future.thethird partycodeishostedonaremoteserverandcan bemodifiedbythescriptprovideratanytimewithoutnotifications.
the developer can enforce integrity check of a script for example by using subresource integrity or thesha256 option of the content securitypolicy csp .the application however can bebrokenwhenevertheremotecodeneedstobeupdated e.g.
due to a security advice .
further a script can dynamically include any otherscripts whichmayalsocontainglobalidentifiersthatconflict withtheexistingones.thiscouldbeprohibitedbyconfiguringa csppolicy.however csphadalimitedadoptionrate because many websites require to dynamically load additional scripts from arbitrarysources.forexample millionsofwebsitesmakeprofitsby 38esec fse november8 virtualevent usa mingxue zhang andweimeng including advertisingscripts whichcan include additionalscripts from otherpartnersinthe real timeauctionprocess.
priorresearchhavestudiedpotentialglobalidentifierconflicts between two javascript libraries.
in the authors generated syntheticclientstotestiftwolibrarieswouldcausedifferentbehaviorswhentheyareloadedunderdifferentsettings.suchclientscan test only the simple operations of the libraries whereas the code in realapplicationscouldbemuchmorecomplex.theresultcannot reflecttheconflictsinrealapplications whichmayincludemore than two libraries.
the applications may even include custom code thatisdynamicallyloadedfromboththedevelopers ownhostsand the third party hosts.
finally the analysis is based on a selective record replaydynamicanalysisframework thatinstruments selectedsourcecode.thus thetooldoesnotcoveranyadditional code that isdynamically loaded.
inthispaper weaimtostudyjavascriptglobalidentifierconflicts inrealwebsites.we faceseveralchallenges.first mostjavascript codeisasynchronouslyexecutedascallback.itisdifficulttoreason about which definition is valid when a variable is used.
second javascriptisaweaklytypedand dynamicprogramminglanguage.
static analysis is likely to overestimate the conflicts resulting in manyfalsepositives.third notallcodeinarealwebsiteisavailable statically.asitecanloadmultipleexternalscriptsfromarbitrary sourcesdynamicallyatruntime.fourth javascriptsupportsobjectorientedprogrammingfeatures.awritetoaglobalobjectcanbe performedwithin the methodofthat objectitself.
to overcome the above challenges we develop jsobserver a browser baseddynamicanalysisframeworkthatmonitorsandlogs writeoperationstojavascriptglobalmemorylocations i.e.
variables and functions .
we perform just in time code instrumentation by modifying the chrome v8 javascript engine.
the instrumentation allows us to cover all code that is executed at run time.
we dynamically insert the monitoring code when a script performs an operationrelatedtomemorywrite.
specifically we maintaina shadowvariabletoperformdynamictypeinference.welogafunctiondefinitionwhenafunctionisfirstparsedinv8orafunction literalisassignedtoavariable.welogeachmemorywriteoperation includinganassignment anobjectdefinition creation anda functionreturn.sincetheobjectsinjavascriptarecopied passedby reference instead of by value we also implement a shadow and immutable identifier property that uniquely identifies each javascript objectin memory.this makesalias analysismuchsimpler andaccurate.withthelogs wedetectthreekindsofconflicts variable valueconflict functiondefinitionconflict andvariabletypeconflict.
although our analysis is not sound because we do not test all possible execution paths it is precise as every conflict we detect musthave happened.
weimplementedaprototypeof jsobserver basedonthechromiumbrowserversion71 andusedtheprototypetoanalyzethemain pages of the alexa top 100k websites.
we show that this class of codeintegrityproblemisverycommon overall wefound36 function definition conflicts on websites variable type conflicts on websites and variable value conflicts on websites.
the conflicts were mainly caused by the use of short simple identifiers and duplicate inclusion of scripts.
in particular becauseofconflicts cookieson109websitesweremodified andmanycookie relatedfunctionswereredefined.ourresearchdemonstratesthestrongneedtoisolatejavascriptcodefromdifferentorganizationsintoseparate namespaces.
to thebest of our knowledge we are thefirst tosystematically measureandanalyzejavascriptglobalidentifierconflictsonalarge scale.in summary we make the following contributions.
we develop jsobserver a browser based dynamic analysis frameworkforstudyingjavascriptglobalidentifierconflicts.
we perform an empirical study on alexa top 100k websites andmake our data publiclyavailable.
we characterize the detected conflicts in real web applicationsanddiscuss the security implications.
the rest of this paper is organized as follows.
we define our research problem in 2. we describe the design of jsobserver and our methodology in 3. in 4 we characterize the global identifier conflictsanddemonstrateseveralinterestingcaseswedetected.we discussthelimitationsofourstudyandfutureworkin 5.finally we discuss relatedwork in 6andconclude in 7. problem statement in thissection we firstformallydefine the threetypesof conflicts that we study then demonstrate the scope of our research and finally discuss our research challenges.
.
definitions we consider conflicts caused by writes by multiple scripts to the same global memory location i.e.
a variable or a function in javascript.
a global memory location can be accessed through one or more global identifiers in any scope in javascript.
all memorylocationsarepropertiesofsomeobject.theycanbeaccessed throughthedotnotationorthebracketnotation.forexample both window.x andwindow.x.y point to a property named as y of the objectwindow.x which is a property named as x of the global objectwindow.
the identifierwindowis often omitted e.g.
as inx .
global functions are also considered as properties or more precisely methods of the object window.
we define three categoriesofjavascript globalidentifier conflictsnext.
valueconflicts.
valueconflictshappenwhentwoormorescripts write to the same global variable with different values in the same type.
for example a script s1may assign1to the variablestate whichisthenoverwrittenbyanotherscript s2to0.thecontrolflow ofs1can be changed if it later uses this variable in a conditional statementinacallbackfunction.notethatthewritestothesame propertyofaglobalobjectvariable e.g.
loc.x withdifferentvalues inthe same type are alsoconsideredas valueconflicts.
function definition conflicts.
this type of conflicts occurs if twoormorescriptsdefineaglobalfunctionwiththesamename.
theruntimebehaviorisnormallyundeterminedanddependson theorderofthefunctiondefinitions.normally thefunctiondefined inascript that ismostrecently loadedisselectedbythe browser.
type conflicts.
a type conflict occurs when the same global location i.e.
a variable or a function is written by multiple scripts with values of different types.
for example fwas defined by script s1as a global function.
script s2may assign a string to f which would surprises1and cause it to crash when it calls f to handle someuseractions.changingthetypeofapropertyofaglobalobject variable byadifferentscript alsoconstitutes to atype conflict.
39detectingandunderstandingjavascript globalidentifier conflicts onthe web esec fse november8 virtualevent usa .
scopeofresearch wefocusonstudyingaformofjavascript codeintegrity problem caused by global identifier conflicts.
the conflicts can be caused by scriptsfromeitheradifferentorganization i.e.
thecross organization conflicts orthesameorganization i.e.
theintra organizationconflicts.
we study the following three kinds of cross organization conflicts athird partyscriptoverwritesaglobalvariable function defined by a first party script a first partyscript overwrites aglobalvariable functiondefinedby a third party script and3 a third party organization s script conflicts with another third party organization s script.
although a web developer may also write codethat causesany of thethree types ofconflictsdefined in 2. we think this is probably the design choice of the developer.
therefore we donot report conflictsoccurredwithin the same script.
in our research an organization is recognized by the domain name excludingthetopleveldomain tld ofascript ssourceurl.
forexample scriptsloadedfrom andadservice.
google.co.uk belongtothesameorganizationbecausetheirdomain names are both google.
we acknowledge that this is not the best way to detect all domain names of a particular organization.
for example both and are owned by amazon cdn.a.com and may also belong to the sameorganization a.com.
however such cases cannotbeeasily detectedwithoutadditionalinformationprovidedbyhumans.we leaveitasafutureworktoimprovethemethodtodeterminethe relationships oftwodomainnames.
aconflictingscriptcanbeeitherdirectlyincludedbytheweb developer or indirectly included by another script in the same web frame.
the conflicting script has the default full privilege to accessanycontentinitsembeddingframe.wedonotconsidercode injectionattackslikecross sitescripting xss althoughtheyare otherformsofthreatstotheintegrityofclient sidejavascriptcode.
codeinjectionattacksareactuallyorthogonaltoglobalidentifier conflicts as a conflicting script already executes in the target frame.
note that our research goal is not to determine a conflict as malicious or benign as many of the conflicts can be caused unintentionally.
rather we aim at detecting the conflicts that can compromise the integrity of a script and analyzing the potential security implications.
.
research challenges we face the following challenges indetecting the conflicts.
asynchronous execution.
javascript is single threaded in the browser.mostscriptsareasynchronous i.e.
theexecutionofmultiple scripts can be interleaved with callback functions.
therefore staticreachingdefinitionanalysisisimprecisebecauseavariabledefinedinthemainfunctioncanbeasynchronouslyusedinacallback function andasynchronously redefinedbyanotherscript.
type inference.
javascript is a dynamically typed and weaklytyped programming language.
an identifier can be used for data of differenttypeswithoutexplicittypeconversions.thetypecheckis performedatruntime.therefore apurelystaticanalysisapproach isnot sufficient to detectvariable type conflicts.
object support.
objects in javascript are supported by its prototype mechanism.
except for the primitive types all other variablesare of the type object.
a script can overwrite a part i.e.
a property ofanobjectindirectlybyinvokingamethodoftheobject.we need to identify thereceiver object whena writeoperation occurs within a method instead of a normal function.
in particular thisis acommonlyusedidentifierinjavascript andcanpointtodifferent objects in different contexts.
for example thispoints to the global objectwindowinanormal function scope orintheglobalscope it referstoanobjectwhenitisaccessedwithinthescopeofamethod oftheobject.inordertodeterminethetargetofawrite weneed to inferprecisely whichobject thispointsto.
aliasanalysis.
allobjectsinjavascriptarecopied passedbyreferenceinsteadofbyvalue.therefore thesamegloballocationmay bepointedbymultipleidentifiersindifferentscripts.forinstance a globalvariablexcanbemodifiedindirectlybyascriptthatwritesto thepropertyofy e.g.
y.property ifyisanaliastox.further when passed as an argument to a parameter of a function a global object can be modified through the parameter within the function.
inotherwords todetectthewritestoagloballocation weneedto keeptrack ofallidentifiers oraliasespointing to the same object.
design and methodology in thissection wepresent jsobserver abrowser based dynamic analysisframeworkfordetectingjavascriptglobalidentifierconflicts at run time.
we record each function definition in the v8 parser to detect function definition conflicts 3. .
we perform just in time instrumentation of all javascript code that is executed tocoverallwritestoamemorylocation 3.
.therecordsallow ustodetectconflictingwritesbydifferentscriptstothesameglobal memory locations 3. .
.
recording globalfunctiondefinitions the rootcauseoffunctiondefinitionconflicts is that twoor more scriptscandefinetheirfunctionsusingthesameglobalidentifier i.e.
functionname .therefore weneedtofindallfunctionsthat are defined in each script.
a developer can define a global function in two ways defining a named function directly in the global scope e.g.
functionf args stmts and2 assigningafunction literal to a global variable e.g.
window.f function args stmts .notethatascriptmayassignafunctionliteralwitha non empty function name to a variable e.g.
varx functionf args stmts .thatfunctionname e.g.
f isaninvalididentifier i.e.
undefined injavascript.
finding the first type of function definition is not difficult.
in thev8engine theparserneedstofirstparsethejavascriptcode in the global scope before the compiler outputs the target code.
therefore jsobserver logs all global functions with a non empty name.
thelog includesauniqueid e.g.
timestamp theposition of the function definition an id of the script and an id of the executioncontext.thetimestamp likelogidenablesustounderstand ateachpointoftimewhichdefinitionisvalid.wecanalsoleverage it to study variable type conflicts involving a global function.
in particular wecandetermineifafunctionischangedtoanobject orif an objectischangedto afunction.
findingthesecondtypeoffunctiondefinitionrequiresustoalso monitor writesto globalvariables.
we discuss itnext.
40esec fse november8 virtualevent usa mingxue zhang andweimeng .
recording writes to variables in this section we describe how jsobserver logs the write operations to variables.
a javascript variable can be written in primarily twoways directlywrittenbyassigningavaluetoitorbycopying anothervariabletoit or2 partiallywrittenbyassigningavalue orbycopyinganothervariabletooneofitspropertiesifthevariablebeingwrittenisanobject.thevaluethatcanbewrittentoa variableoritspropertiescanbeinseveralcategories aprimitive typevalue e.g.
anumberorabooleanvalue anobjectliteral e.g.
a b and an object initialized with a constructor e.g.
newperson john .however capturingallthewrites to avariable isvery challenging.
first variables in different scopes can use the same identifier name .weneedtodifferentiatelocalvariablesfromglobalvariables toavoidoverestimation.totellifanidentifier visaglobalvariable or not jsobserver checks the scope of the current statement s wherevisused.ifthecurrentscopeisthe globalscope theidentifier invisglobalandisdirectlylogged.ifthecurrentscopeisa function scope jsobserver wouldsearchtheidentifier vintheparameter list and declaration list of the current function.
if vis found in the lists it is determined as a local name otherwise jsobserver continues to search the lists of an outer function scope until either a match is found or itreaches the global scope.
a special situation isthatthecurrentscopeisanobjectscopeorafunctionscopeinan object i.e.
a method and the identifier points to a property of the currentobject e.g.
this.p.thisrequiresustoinferwhichobject the keywordthispointsto whichwe describe next.
second variables of non primitive types i.e.
objects are copied orpassed by referenceinsteadof by value injavascript.
in order todetectthewritesto thesameobject weneedtoidentifyallthe validaliases to it.
one intuitive approach is to keep track of all the assignmentsinvolvinganobjectoravariableofanobject.however thisapproachiserror pronebecauseanobjectcanbepassedinto severalnestedfunctioncallsorassignedasapropertyofanother object.
an object variable vcan also be assigned to another objectobj e.g.
v obj hencebecomesanewaliasto obj.further anobjectcanbeself referencedinitsmethodswiththekeyword this which can potentially pointto any object.
to solve this challenge jsobserver maintainsauniqueandimmutableshadowid property id ofeachjavascriptobjectinv8.wheneveran object is being written we can identify it with this shadow id property regardless ofthe javascript variable name being used.
torecordthetypeofavariable weleveragethe typeofoperator in javascript.
however if its operand is an expression instead of a simpleidentifier theexpressionwouldbeevaluatedagainwhenwe inferthetypeusingit.thiswouldcausesomeunexpectedbehavior.
forexample considertheassignmentstatement arr f .
tologthetypeofthememorywritedestination wecanuse typeof arr .thiswouldcauseanadditionalupdateofthevalueof i such that the type of the wrong memory location is returned.
toavoidthiskindofsideeffects weintroduceashadowvariable v for each direct write operation to a variable in our instrumentation.thewriteisappliedtotheoriginalvariablefirst andthen applied to the shadow target in a nested assignment statement.
jsobserver recordsthetypeofthewritetargetbyspecifyingthe shadowvariable as the operand of typeof.table instrumentation forrecording writeoperations.
.v e v v e recordwrite v v v e .v e v v e recordwrite v v v e .v1 v2 e v v1 v v2 e recordwrite v2 v v e recordwrite v1 v v v v2 e .v.p e v v v .p e recordwrite v.p v v .p e .
p1 e1 o p1 e e1 p2 e e2 ... p2 e2 ... recordwrite o .p1 o e e1 recordwrite o .p2 o e e2 .new obj ... new obj ... this.p e o this o .p e recordwrite this.p o o .p e we next discuss in detail the instrumentations that jsobserver performsforeachtypeofwriteoperationstoamemorylocation assignmentstatements and2 objectliteralandconstructorexpressions.wesummarizetheinstrumentationsin table1.whenanyof thewriteoperationsisexecuted jsobserver infersandrecordsthe typeofthememorywritetarget v thevalueofthetargetifitisa primitivetypevariable theexpressions eintheoperation aunique log id and the ids of the script and the execution context using a custom function recordwrite v s t e .
inside the function it infers the type of the write target vby evaluatingtypeoft where tis a shadow variable whose type is identical to that of v. it logs theshadowidproperty s. id wheresisanaliastothewrite target object.
if the target is of a primitive type the variable tis passed tosand the functioninstead logsthe valueof t. the write sourceexpression eisalsorecorded.
.
.
assignmentstatements.
assignmentstatementsarethemost direct way that a script can write to a variable.
for each direct write targetvin an assignment statement where vis a variable jsobserver creates a shadow variable v for it automatically.
in particular jsobserver replacestheassignmentstatementwitha nested assignment statement which writes to both vandv as the first rule shown in table .
this avoids evaluating an expression likearr twice.
for a shorthand operator e.g.
jsobserver also creates a shadow variable v for the direct write target v as the second ruleintable1.incasethatanestedassignmentstatementisfound jsobserver wouldvisittheabstractsyntaxtree ast ofthenested assignmentstatementandreplaceeachassignmentstatementnode individually rule in table1 .
we need to also identify an object when it is partially written through its property.
we could again try to leverage the above shadow variable to get the shadow id to avoid re evaluation of 41detectingandunderstandingjavascript globalidentifier conflicts onthe web esec fse november8 virtualevent usa anexpression asin v v.p e .however theshadowvariable would be an alias to the source object ebeing assigned to the property instead of an alias to the target object v. further if the writesource stypeisaprimitivetype theshadowvariable v would be avaluecopy ofitinstead ofan alias to it.
in such a situation where the write target is a property of an object variable e.g.
v.p jsobserver creates a shadow variablev oftheparentobjectvariable vinsteadofitsproperty v.p.it then applies the writeto the property through the shadow variable instead of the original variable e.g.
v .p to avoid expression re evaluation rule 4in table1 .asaresult weareabletoidentify property writes to the same object.
for example a method writes to one property of the owner object through this.p .
jsobserver willtransferthecodeinto v this v .p and identifytheownerobjectthroughthevalue v .
id .onespecial caseisthatthepropertyisalsoanobject.suchawritewouldnot modifythatobjectrepresentedbytheproperty whichwasessentially an alias but make the property either a new aliasto another objectbeingassignedtoitoraprimitivetypevariable.therefore we do not create a separate shadow variable for an object property.
wedocheckthetypeoftheproperty e.g.
typeofv .p ratherthan that ofthe shadowobjectto detecttype conflicts.
.
.
object literal and constructor expressions.
to detect a write conflicttoapropertyofaglobalobject jsobserver needstorecord allwrites to it including the initialdefinition.a property can be defined in two ways.
first the property is directly initialized in anobjectliteralexpression asrule 5in table1.jsobserver creates a shadow variable o for the newly created object and calls recordwrite torecordthewritetoeachpropertyoftheobject.the unique object id would also be logged with the shadow variable o .
second a property pmay be defined within the constructor or a method of an object through the identifier this as rule intable .
in the case of an object constructor jsobserver also createsashadowvariable o fortheobjectinsidetheconstructor.
jsobserver then logs the write to the property this.pand also the shadowid of thisthrougho .
with the help of the unique object shadow id we avoid the burden of tracking the aliases to an object.
in our analysis stage we are able to search backward in the logs to find all write records withthe same objectshadowid to detectany writeconflicts.
.
detecting conflicts inthissection wediscusshowweleveragetherecordscollectedby jsobserver to detectthe three types ofglobalidentifier conflicts.
.
.
functiondefinitionconflicts.
thedetectionofglobalfunctiondefinitionconflictsisverystraightforward.wesimplycheck the function definitions in each frame to find if the same global functionhadbeendefinedformorethanoncebydifferentscripts.
however a global function can also be defined by assigning a function literal to a global identifier.
to detect conflicting function definitions by function literal writes we also find assignment logs where the type of the write target is function and search the target identifier i.e.
the functionname inthe function definitionlogs.
.
.
valueconflictsandtypeconflicts.
ifaglobalvariableisof aprimitivetype itdoesnothaveanalias.wewillsearchanyotherwrite records to the same global identifier.
if the logged values intworecordsaredifferentandthewritesareperformedbytwo different scripts we report it as a variable value conflict.
however ifinonerecordthetypeoftheglobalvariableisdifferent wereport itas avariable type conflict.
if a global variable is an object a value conflict may happen in two situations.
first the variable vitself is overwritten with another variable.
this can be easily detected by searching only the assignment records to the same identifier v. we do not need to check if one of its aliases is overwritten because that would effectively invalidate this variable vas an alias.
second a property oftheobjectiswritten.thiscanbedetectedbysearchingthewrite recordsofalltheobject svalidaliaseswithregardstothecurrent assignment.
if the types of the property in two writes are the same wereportitasavariablevalueconflictifeitherthetypeisobject or thetypeisaprimitiveonebutthevaluesaredifferent.otherwise if the types differ we report it as a variable type conflict.
note that if the conflictiscausedbythe same script we do not report it.
variable and function type conflicts.
we find that a special type of conflict may occur i.e.
a global identifier is used as both a global function name and a global variable name.
we call it as variableandfunctiontypeconflicts.forexample fcouldbedefined by a script as a global function.
another script may assign a primitive type value or an object to feither before or after this function definition.similarly aglobalvariable vofeitheraprimitivetypeor anobject maybeassignedwithafunctionliteralbyanotherscript asinv function ... .in order todetect this kind oftype conflicts weneedtocrosscheckthefunctiondefinitionlogsand variable writelogs.
in particular for each identifier thatis defined asaglobalvariable wesearchitinthefunctiondefinitionlogsas well as the variable write logs to determine if it is also ever defined as afunction.
.
implementation weimplementedaprototypeof jsobserver basedonchromium version71.
.
.98usingabout4klinesofc code.wemodified the v8 parser to record global function definitions.
we modified the v8 bytecode generator to add our instrumentation code for recording writes to memory locations.
the write operation logs recorded by jsobserver are stored in a string asglogs which is implemented in the webkit layer as a property of the domwindow class.
all the logs are dumped into the file system on the fly in pageloadphase.theprototypebinariesareavailablewiththe .
zenodo.
.
we plan to release the source code of our prototype implementationpublicly.
evaluation in this section we first describe the data collected in our web crawling 4. then characterize the detected global identifier conflicts by demonstrating what type of conflicts are generated 4. bywhichscripts 4.
.further weprovidecasestudies 4. and analyze the affected websites and possible reasons of conflicts 4. .
finally we measure the performance of jsobserver 4. .
42esec fse november8 virtualevent usa mingxue zhang andweimeng table categorization ofglobalidentifierconflicts.
category websites conflicts conflicts function definition .
third first .
third diff third .
first third .
third same third .
first first .
unknown .
variable type .
third first .
third diff third .
first third .
third same third .
first first .
unknown .
variable value .
third first .
third diff third .
first third .
third same third .
first first .
unknown .
.
datasetandavailability wecrawleddatafromthemainpagesofalexatop100kwebsites usingjsobserver in october .
for each website we recorded the writes to all identifiers and the calls to functions within 120s in anassignmentlogfile andstoredthedefinitionsofglobalfunctions inafunctiondefinitionlogfile.duringourexperiment .
websitesdidnot finish loadingwithin2 minutes.excluding those thattimedoutorcrashedinourdatacollectionprocess wesuccessfullygatheredassignmentlogfilesfrom79 .
websites andfunction definitionlogfilesfrom .
websites.
thecollecteddataispubliclyavailablewiththe .
categoryofconflicts inthissection wecharacterizejavascriptglobalidentifierconflicts basedonthe categoriesthat we definein 2. .
.
.
function definition conflicts.
in total we detected function definition conflicts on websites.
in particular there are1 065suchcaseswhereafunctionliteralwasdirectlyassignedto an identifier which was used as a function name by another script.
we considerthis as aspecialtype offunction definitionconflicts.
we then characterize these conflicts based on the class of the conflictingscripts i.e.
thirdpartyorfirstparty.wecurrentlyare notabletodeterminetheclassofadynamicallycreatedinlinescript because it does not have a source url.
the class is unknown for conflictsinvolvingsuchinlinescripts.excludingthem wewereable to categorize35 .
conflicts.
table2lists thebreakdown ofthesefunctiondefinitionconflicts.
cross organization and intra organization conflicts.
overall we detected .
cross organization function definition conflicts.
in particular .
cases were caused by a third partyorganization sscriptthatredefinedfunctionsofother third partyscripts.wealsodiscovered1 .
conflictswhere a third party script modified a function defined by a first party script and .
cases where first party scripts overwrote functions defined by a third party script.
this indicates that scriptstable topduplicatefunctions.
function websites conflicts gtag typeof ez getquerystring getcookie classcallcheck could break the integrity of other scripts loaded from a different organizationbyoverwriting the function definitions.
themajority 666or88.
offunctionredefinitionswere intra organizationconflicts.
.
ofthemwerecaused byfirst partyscriptsoverwritingotherfirst partyscripts andthe conflictingdefinitionswereusuallysimilar.wethinkthisisnota goodcoding practice.
conflicts on browser internal objects.
interestingly we detected function definition conflicts onbrowser internal objects and3ofthemarecross organizationconflicts.forexample athirdparty and a first party script assigned different function literals toself.onerror .selfisareservedpropertyofthe windowobject and points to the current window.
the third party script therefore redefinedthewaythatruntimeerrorswerehandled.theseconflicts obviouslybroketheintegrityofscriptsfromotherorganizations.
we also found intra organization function definition conflicts on the internal objects.
in particular of them were found on methods of internal objects.
for instance document.write and document.writeln were modified on and websites respectively.webelievethesewerethedevelopmentchoices asthescripts were all loaded from the first party domain.
however exposing the builtin methods to all scripts is dangerous because any scripts could changethe defaultbehaviorof the embedding websites.
duplicatefunctiondefinitionandduplicatescriptinclusion.
we identified several conflict cases where the two function definitionswereidentical whichwecall duplicatefunctiondefinition .
thismighthappenwhenthesamescriptisincludedformultiple times.intotal wefound10 .
casesthattheconflicting functiondefinitionswereactuallyidentical and9 .
such conflictsweredetectedbetweenscriptsofthesameorganization.
theother953 .
duplicatedefinitionswereprobablycaused byincludingthe same libraries hostedbydifferentorganizations.
table 3liststhe top functions of which we detected a duplicate definition.ascanbeseen somecommonlyusedfunctions e.g.
gtag andgetcookie wererepeatedlydefinedwiththesamecode.
onepossibleexplanation isdevelopersusuallywould not checkif a scripthas beenloaded before loading it twice.in total we found .
function definition conflicts caused by duplicate inclusion of scripts.
duplicate inclusion does not necessarily break the functionality of the embedding pages but still could cause unexpectedbehaviors e.g.
invokingthesamefunctionformultiple times.therefore we stillconsiderthis as abadcoding practice.
we do realize that our method to identify duplicate function definitionsisnotcomprehensive sinceafunctioncouldbeimplementedinvariousways.forexample a b isfunctionally equivalenttoif a b .however itisnotourmainfocusto thoroughly compare the behavior of different functions which cannotbe easily decided.
43detectingandunderstandingjavascript globalidentifier conflicts onthe web esec fse november8 virtualevent usa table topredefined functions.
function websites conflicts getcookie aksb.done aksb.measure aksb.mark typeof table categorization ofcalls to redefined functions.
category calls conflicts calls third first .
third diff third .
first third .
third same third .
first first .
unknown .
topredefinedfunctions.
afterexcludingidenticalfunctiondefinitions weobtainthetopfivefunctionsthatweremostfrequently redefined by scripts from different organizations as listed in table4.notethatthetopfunctionisrelatedtocookies.byoverwriting cookie related functions a malicious third party script could exposeawebsitetosecurityrisks whichwewilldemonstratelater.
meanwhile thetopfunctionsthatarepropertiesofglobalobject aksbwere all redefined by one third party script .furtherinvestigationshowsthatthe first partydefinitionofthesefunctionscontainedverysimplecode e.g.
writes to an array.
the third party script modified them to record several important events e.g.
domcontentloadedeventend .
for these conflicts we think the first party developers included someinitialcodesnippetprovidedbytheakamaisdks e.g.
aksb whichwouldupdatetheircode at runtime.
call after redefinition.
toestimatetheimpactofthefunction definition conflicts we further searched in our logs to check if the functionswerecalledaftertheywereredefinedbyadifferentscript.
table 5gives the breakdown of the calls to the redefined functions.
specifically wedetected39caseswherethird partydefinedfunctionswereoverwrittenbyfirst partyscripts andwerecalledbythe third partyscripts later.wealsofound29caseswherethefirst party scripts called a function that had been overwritten by a third party script.
in particular of them were cookie related functions.
one examplewasdetectedonthewebsite where afunctioncreatecookie wasfirstlydefinedinafirst partyscript butthenoverwrittenbyathird partyscript.afterthat thefunction createcookie was called by the first party.
such a conflict could introduce severe security risks as a malicious third party script could manipulate the value of cookies to force a user to use the attacker ssession.
summary.
wediscoverthatfunctiondefinitionconflictsexist on over 9k popular websites.
.
conflicts were caused by scriptsfromdifferent organizations and1 611functionsgot called after being redefined by a different script.
we found conflictsonbrowserbuiltinmethods andsomecookie related functionswerefrequentlyredefined whichcouldbeexploited to expose the websites andtheirusersto security risks.
.
.
variable type conflicts.
we detected variable type conflicts across websites.
the results are presented in table .
cross organizationconflicts.
asshownin table2 .
variabletypeconflictswerecausedbyscriptsfromdifferentorganizations.forexample onthewebsite net thevariablelocaleswasoriginallydefinedasastring quot ar ae quot... and a third party script from 12c719211bdf.
bitsngo.net modifiedittoanobject.similarly athird partyscript fromxml.adbetnet.com overwrotethevariable posdefinedbyanotherthird partyscript from the number 4to an object.
meanwhile wealsodetected434 .
caseswhereafirst party script modified the type of a third party defined variable.
for instance afirst partyscriptmodifiedavariable formercalledarguments fromfalsetoanobject andthatvariablewasoriginallydefinedby a third party script from d1lxhc4jvstzrp.cloudfront.net .
this shows that scripts in any class could be affected by variable type conflicts which can introduce potential risks because inconsistent types could cause runtimeexceptions andleadto behaviordeviation.
intra organizationconflicts.
similartofunctiondefinitionconflicts most 702or84.
ofvariabletypeconflictswerecaused by scriptsoverwriting variablesin scripts from the same organization.
we believe these conflicts could be the design choice of the developers because the conflicting scripts were loaded from the same organization s domains.
they could also cause difficult todetectbugs if the developersof conflictingscripts were not aware ofthe conflicts.
variableandfunctiontypeconflicts.
wedetected971 .
special type conflicts where a primitive value or an object was assigned to an identifier before or after the identifier was used as a globalfunctionname.specifically 3ofthemweredirectlydeclared as a function.
for example the variable ischrome was defined as truein a first party script on before a function was assigned to it.
we detected .
type conflicts that a function was modified to be a non function variable.
as a result anycalltothemwouldcausearuntimeexception.wealso found one special case on the website where afirst partyscriptmodified dropdown toanobject afterdeclaring it as a function itself.
such a conflict caused a typeerror when dropdown wascalledlater.this could be an implementationerror.
further inspection showed that out of type conflicts involvedidentifierswithalengthlessthan3 e.g.
ma nn etc.this suggests that developers should use unique longer and meaningful names to avoid the type conflicts.
summary.
we detected variable type conflicts on over 3k websites and .
were caused by scripts of different organizations.
especially global functions could be redefined as non functionvariables whichcouldcauserun timeerrorswhen they are called.
these conflicts were mainly caused by scripts using simplefunction names e.g.
nn.
it indicatesthat thedevelopers should choose unique names to avoid the conflicts.
.
.
variablevalueconflicts.
we detected81 variablevalue conflictsacross27 199websites.interestingly wedetected10 .
cookie relatedvariablevalueconflicts asshownin table6.
cross organizationandintra organizationconflicts.
wedetected18 .
cross organizationvariablevalueconflicts 44esec fse november8 virtualevent usa mingxue zhang andweimeng table cookie value conflicts.
categorysame organization diff organization conflict website conflict website valuemodification addition deletion and .
of them were caused by third party scripts overwriting first party variables.
for example ga.lwas modified from...437to...447by a third party script on the website .meanwhile wefound2 .
cases where a third party defined variable was modified by first party scripts.
we also found .
value conflicts that were causedbyscriptsofthesameorganization andmostofthem or49.
werecausedbyfirst partyoverwritingfirst partyvariables.
we thinktheseare the developmentchoices.
conflictson browser internal objects.
intotal wefound228 casesthatmultiplescriptswrotetocookieswiththesamename.in particular 116conflictscausedexistingcookievaluestobemodified astheconflictingscriptsassigneddifferentvaluestocookieswith thesamename pathanddomain and19ofthemwerecausedby scripts from different organization.
one example is on the website whereathird partyscriptfrom ie1 sscbf.
cdnppb.net overwrote the value of cookie bfsdfrom... to ... .
in this example the cookie value was originally defined by a first party script.
we believe this is a privilege abuse.
we also found97casesthatcookievaluesweremodifiedbyscriptsofthe sameorganization.
although it shall be legitimatefora first party script to modify a cookie we think third party scripts shall not modify cookies whichallbelong to the firstpartysite.
moreover wedetected5casesthatscriptsremovedanexisting cookiebysettingtheexpiretimetoapastone.oneexamplewas found on website where a third party script removed an existing cookie gcl au that was originally defined by another third party script from googletagmanager.com .
we believe the above example is legitimate as civic computing providesaserviceforcookiecomplianceundergdpr .however removing an existing cookie may usually cause the server side program to malfunction.
inadditiontodocument.cookie wealsofound52variablevalue conflictsonotherinternalobjectproperties and7ofthemarecrossorganizationconflicts.oneexamplewasfoundonwebsite http popcornnowis.blogspot.com where a third party script overwrote window.name defined by another third party script loaded from a differentdomain.
booleanvalueconflicts.
wealsodetected1 258booleanvalue conflicts onglobal identifiers which were usedto control the program behavior.
for instance on website a first partyscript defined avariable adblock astrue then athirdparty script modified it tofalse.
this variable was used to represent the existence of an ad blocker.
in the case it is false an advertising scriptfrom doubleclick.net wouldbeincluded.however thiscan be abused by other third party scripts.
for example a script can always set adblock to true to prevent the injection of ads from google doubleclick andto injectits ownadsinstead.1window.uioverlay function l 2if document.readystate in complete loaded 3require function e e.apply null i 5else 6document.addeventlistener domcontentloaded function ...uioverlay.apply null e listing original definition ofwindow.uioverlay .
it reveals that because of variable value conflicts the control flow of javascript code and the appearance of the embedding page could also be influenced.
although html elements can be directly modified using javascript it is much more difficult to reason about the indirectmodificationcausedbyglobalidentifier conflicts.
summary.
wedetected81 212variablevalueconflictsonover 27kwebsites.116conflictscausedanexistingcookietobemodified.also 27conflictswerecausedbythird partyscriptsoverwriting internal object properties.
we believe they are privilege abuse.
some first party defined boolean values were modified bythird partyscripts resultingindifferentexecutionpathsof the first party program.
the findings demonstrate thatvariable valueconflictscould changeprogram behaviors.
.
conflicting scripts we characterize the global identifier conflicts based on the conflictingscripts withafocusonthe cross organizationconflicts.
.
.
functiondefinitionconflicts.
wedetected961uniquescripts redefining a function of another script from a different organization.
as shown in table the top script doczy full .
min.jsredefined third party functions on the website https modeloinicial.com.br whichincludedaduplicatescriptfroma third partycdnhost cdn.plune.com .thesituationsforothertop scripts were similar.
even though the conflicting function definitions were identical including the same code for multiple times could result inundesiredeffectsandshould be avoided.
the most prevalent scripts causing function definition conflicts are listed in table .
similar to the top script aksb.min.js that we had discussed in 4. the script containr.js redefinedwindow.
mpfcontainr whichwasoriginallyaverysimplefunctiondefined by the first party.
in contrast the scripts from exoclick.com and wololo.net containedduplicatedefinitionoffunctions whichhad beendefinedbyfirst partyscripts.furtherinvestigationshowsthat on some websites e.g.
the script fromexoclick.com was indirectly included by other third party scripts and it contained identical code as the script it overwrote.
wethinkthattheseconflictingscriptswereoperatedunderdifferent domain names but might actually belong to the same organization andthe conflictswere causedbyunexpectedduplicateinclusion.
in contrast the script from static.tacdn.com indeed changed the definitionoffunction window.uioverlay on23websitesthatall came from tripadvisor.com .
we think static.tacdn.com might be a cdn host of tripadvisor.
however as shown in listing and listing theredefined functiondoes notwaituntil thedomhas been fully loaded before proceeding.
such a conflict could cause different behaviors on the embedding page and should be avoided.
45detectingandunderstandingjavascript globalidentifier conflicts onthe web esec fse november8 virtualevent usa 1window.uioverlay function 2require function e e.apply null t listing redefinition ofwindow.uioverlay .
table topscriptsoverwriting globalidentifiers.
conflictscript url conflict category targets function definition variable type variable value .
.
variable type conflicts.
we detected scripts causing cross organizationtypeconflicts.thetopfivescriptsarealsolisted intable .
four of them are first party inline scripts that redefined variablesaj adspot aj zoneandaj server etc.
fromundefined toacertainvalue.thesevariableswereoriginallydefinedbythe third partyscripts andwereeventuallyusedtodeterminetheadvertisements to inject.
this indicates that by overwriting certain customvariables a malicious scriptcouldindirectlycontrolimportantdomelements e.g.
ads that are shownto the visitors.
thenoticeablescript intable8modifiedvariable blogroll channel id fromanumber toundefined on websites after using it as the id of an injected div element.
this reveals that variables could be modified by otherscripts toundefined causing exceptions when referenced.
.
.
variablevalueconflicts.
intotal wedetected7 419unique scriptsmodifyingthevalueofvariables defined inscriptsofother organizations.
the most commonly included script came from facebook.net .itwasdetectedtomodifythevalueof fbq.version from .
to .
.
on2 541websites.
fbq.version wasinitially defined by the first party scripts and was used to determine the versionofafacebookscriptincludedontheembeddingwebsites.in thiscase webelievethefirst partydevelopersintentionallyallowed fbevents.js to updatethe versionnumber.
in addition three of the top scripts were third party scripts that addednewcookievalues.similarly threeofthetopprevalentscripts modifiedthevalueofcookiesonhundredsofwebsites.forinstance thescriptfrom cr.acecounter.com addedanewcookie acefcid whosevaluewasusedbythefirst partywebsitetodeterminethe source url of an image on that page.
this suggests that cookies arecommonwritetargetsofdifferentscriptsanditisriskytoallow third partyscripts to setthe cookies ofafirst partywebsite.
.
casestudies in this section we discuss several interesting conflicts detected by jsobserver to further demonstratethe potentialrisks.
overwritingfunctionstomodifydomcontent.
wedetected functiondefinitionconflictsthatcouldcausemodificationsofdom elements.forexample onthewebsite thefirst partytable topprevalent conflictingscripts.
conflictscript url websitecategory function definition variable type variable value 1function addhtml 2var html ... img ...src png ... 3if ismobile.android 4html div ... a href ... ... a aceder div 6else if ismobile.ios 7html div ... a href ... ... a aceder div ... ... 10document.body.innerhtml html listing first party definition of addhtml on 1function addhtml 2var html ... img ...src .net ... logo portal.png ... 3html div ... a href ... a aceder div ... ... 5document.body.innerhtml html listing third partyredefinition ofaddhtml .
definition ofaddhtml was overwritten by a third party script fromcloudfront.net .
as shown in listing andlisting the thirdparty script redefined the function to insert a different image and a different div element into the embedding website.
we believe thattheseconflictsshouldbeavoidedbecauseunexpectedelements mightbe includedonthe embedding page.
redefiningcryptographyfunctions.
wealsofoundcaseswhere criticalcryptographyfunctionsweredefinedbymultiplescripts.for example thewebsite contained duplicatedefinitionsofseveralcryptographyfunctions e.g.
b64 hmac md5 binl2b64 andcore hmac md5 etc.our inspection shows thatthis website included two scripts that contain identical definitionsofthesefunctions.however athird partyscriptcanmodify core hmac md5 to generate fake message authentication code mac to breakdata integrity.
conflicting adsensepublisher ids.
interestingly wedetected on several websites that first party inline scripts wrote different adsensepublisherids.forexample onthewebsite the developer s scripts wrote two different values ca pub ... andca pub ... to the same global identifier google ad client .
it is used as a unique identifier of a publisher s adsense account to distribute the advertising revenues.
in this case we believe that first party developers may have two different 46esec fse november8 virtualevent usa mingxue zhang andweimeng figure1 rankdistributionofwebsitescontainingconflicts.
adsenseaccounts.however amaliciousscriptcouldstealtheadvertisingrevenuesbysimplyreplacingthevalueof google ad client withher his ownpublisherid.
.
affectedwebsites andreason ofconflicts .
.
affectedwebsites.
wedividetheaffectedwebsitesinto1 groups according to their ranks and calculate the rank distribution whichisdepictedin figure1.asisshown websitesinallgroups were affected by global identifier conflicts.
additionally the conflicts caused by scripts from both first party and third party are uniformly distributed.
in particular we detected conflicts on some top ranked websites.oneofthetopaffectedwebsitesis .
it included two scripts that assigned different callback functions totheoneventhandler window.onerror usingwindow.onerror function ... which would directly replace any existing event handler .
the second script therefore redefined the way how runtime javascript errors were handled on amazon.
our inspection shows that the two scripts were both first party inline scripts andtheseconddefinitionactuallycallstheoriginaleventhandler.
we believe that this is an implementation error.
the developer could haveused window.addeventlistener error function ... toavoidreplacingallexistingeventhandlers.anotherexample is whose alexa ranking was .
the value of a global variable adefined by a first party script was modified from an object to a string by another first party script from the same domain.
we consider this as a bad coding practice which mightresult from the use ofsimplevariable names.
ourstudyindicatesthatallwebsites includingthetopranked ones are subjectto javascript globalidentifier conflicts.
.
.
possiblecauseofconflicts.
wederivedthedistributionof cross organization conflicts regarding the length of conflict targets.
as shown in figure for all categories of conflicts shorter conflict targetsweremuchmorelikelytobeoverwrittenbyotherscripts.in particular .
functiondefinitions conflicts .
variable type conflicts and .
variable type conflicts weredetectedonvariables functionswhosenamescontainnomore than characters.
the top redefined identifiers include tmr hsq anda etc.this suggests the use of short and common names is figure conflict distribution regarding conflict targets length.
table slowdownon pageloadingtime.
round average x max x incompleteloading .
.
.
.
.
.
one possible cause of global identifier conflicts and the developers should assignlonger andunique names to avoid the conflicts.
asdiscussedin 4.2and 4. duplicatescriptinclusionisanother cause of function definition conflicts and is actually not rare it caused .
of function definition conflicts .
web developers should be careful when including scripts as duplicate inclusions could cause undesiredeffects.
.
performance of jsobserver wemeasuretheslowdownonpageloadingtimetoevaluatetheperformanceoverheadincurredby jsobserver .specifically weuseda vanillachromiumbrowserandtheprototypeof jsobserver tovisit thealexatop100websitesseparately waitedforatmost5minutes beforeclosingthebrowser andcalculatedtheaveragepageloading timeandtheaverageslowdowninthreerounds.theexperiment resultsare shownin table9.
asshown jsobserver incursan average slowdown of .96x and the maximum slowdown is around 200xon whichincluded35scripts.this showsthat jsobserver incursloweroverheadcomparedwithsimilar tools e.g.
jalangi .
however we also observed that several pages did not finish loading within minutes.
the reason is we injectedmultipleinstructionsforeachsimplewritetoamemory location.
we willfurther discuss in 5. discussion we discuss the limitations of our current work the possible mitigationofthe identifier conflictthreat andour future work.
overhead and coverage.
jsobserver introduces high performance overhead as it injects several instructions for each write toamemorylocation.therefore manywebsitescouldnotfinish loadingwithin2minutesinourexperiment.ourgoalwasnotto detect allpossibleconflicts inreal time.instead we triedto detect asmanyaswecould.indeed wewerestillabletogathermanylogs 47detectingandunderstandingjavascript globalidentifier conflicts onthe web esec fse november8 virtualevent usa generatedwithinthetimeoutandrevealtheglobalidentifierconflictproblemintherealworld.weplantooptimizetheperformance ofjsobserver to improve the efficiency ofdata collection.
falsenegatives.
ourconflictdetectionalgorithmisprecisebut not sound.
during data collection we did not trigger any ui event.
therefore all the detected conflicts occur during normal page load andtheremightbefalsenegativeswhentheconflictscanonlybe triggeredbyspecificsequenceofuievents.nevertheless wedid not aim to detect all the potential identifier conflicts.
we leave it as afutureworktoexplorethetriggerconditionsofconflictsonthe web.
script isolation.
a script can access and overwrite the global identifiers in another script due to the fact that all the scripts includedinthesameframesharethesameglobalnamespace.this indicatesthattheglobalidentifierconflictproblemcanbesolved by isolating the scripts that write to the same memory location.
therefore we can leverageexisting browser isolation mechanism toisolatedifferentjavascriptcodeinseparateexecutionenvironments.
however this may introduce a significantly high overhead at run time and break the functionality of code that depends on eachother.we leave itas our future work.
avoidingcommon identifiers.
ouranalysisshowsthatmany scriptsusedsimpleorpopularidentifier names e.g.
i getcookie etc.
which is another cause of conflicts.
therefore the problem might also be mitigated by ensuring that the same identifier is not used by multiple scripts.
for example we can statically or dynamically instrument javascript code by appending different random strings to the identifiers in different scripts.
we plan to implement andevaluate such amechanisminthe future.
related work javascript conflict analysis.
patraet al.
proposed conflictjs anautomatedapproachtoanalyzingtheconflictsbetween javascriptlibraries.however theystudiedonlyalimitednumberof javascript libraries in a synthetic environment.
in real world applications there could be more than two javascript libraries.
further conflictjsis built on top of jalangi whichisa dynamicjavascript analysisframeworkbasedonselectiverecord replaytechnique .
therefore theyarenotabletodetecttheconflictsindynamically loaded code.
in contrast jsobserver is able to detect the conflicts betweenanyscripts includingthosethataredynamicallyloaded.
zhanget al.
also detected javascriptidentifierconflictsby instrumenting the chromium browser.
nevertheless they covered only an incompletesetofjavascript features.
javascripttypeinference.
pradeletal.
proposedtypedevil to detectidentifiersthathaveinconsistenttypes.jensen et al.
proposed a static analysis framework for javascript and implemented an analysis prototype on top of .
hackett et al.
presentedahybridtypeinferenceapproachforjavascriptbasedon points to analysis.
these works focus on inferring javascript type information within a single script.
however our dynamic analysis frameworkaimstodetectthetypeinconsistencyofglobalidentifiersacrossdifferentscripts.meanwhile therehavebeenseveral learning based approaches to predicting the type for javascript code .
they aimed to statically infer about a variabletypeandthereforeenablethegenerationofmuchfastercode which is orthogonal to our work.
in our work we leverage the javascript built intype checker to inferthe type of avariable at run time.
cross domainscriptinclusion.
yueandwang studiedseveral insecure practices regarding javascript including duplicate inclusion.
ratanaworabhan et al.
and richards et al.
analyzed the behavior of popular javascript libraries.
richards et al.
focused on the security risks imposed by the use of eval .
nikiforakis etal.
analyzedscriptinclusionsonalexatop10k websitesandrevealedfourvulnerabilitiesthatcouldbeexploitedto attackpopularwebsites.lauinger etal.
showedmanywebsites includedoutdatedorvulnerablelibraries andpopularlibraries e.g.
jquery couldbeincludedformultipletimes.inthiswork wefocus onthe globalidentifierconflictsratherthanthetrustrelationship between scripts.
except forfunction definitionconflicts thatcould result from duplicate inclusions jsobserver can also detect other categoriesofconflicts.
dynamicanalysisofjavascript.
manystaticanalysisapproaches e.g.
failtoreasonabouttheruntimebehaviorsofjavascript code.
therefore prior works have studied the dynamicanalysis of javascript.gong etal.
proposeddlinttodynamicallydetect the violations of several coding quality rules at run time.
in theauthorscombinedstaticanddynamicanalysistodetectsuspicious javascript code e.g.
unusually long functions.
in contrast our analysis focuses on statement level conflicts especially the conflicting writes to memory locations in different scripts.
in the authors allowed forced execution of javascript code to explore all the possible paths and revealed malicious behaviors.
other analysis includes data race detection determinacy analysis javascript performance profiling concurrency error detection and crashpathcomputation .these techniques are orthogonal to jsobserver which focuseson javascript global identifier conflicts.
conclusion we have investigated a form of javascript code integrity problem thejavascriptglobalidentifierconflictproblemontheweb withan analysisframeworkdevelopedbasedonthechromiumbrowser.we collected data from the main pages of the alexa top 100k websites and detected three categories of conflicts.
we demonstrated that many websites were affected by identifier conflicts.
in particular we detected conflicts on popular websites.
it is even alarmingthatthird partyscriptscouldcompromisetheintegrityof first partycodeandcookiesbecauseoftheprivilegeofaccessing the same global namespace.
our research shows that javascript globalidentifierconflictisanemergingthreattoboththewebusers and the integrity of web applications and highlights the need to isolate javascript code from differentorganizations.
acknowledgment the workdescribed in thispaper waspartly supported by a grant from the research grants council of the hong kong special administrative region china cuhk24209418 .
48esec fse november8 virtualevent usa mingxue zhang andweimeng