inference and test generation using program invariants in chemical reaction networks michael c. gerten iowa state university ames iowa usa mcgerten iastate.edualexis l. marsh iowa state university ames iowa usa almarsh iastate.edujames i. lathrop iowa state university ames iowa usa jil iastate.edu myra b. cohen iowa state university ames iowa usa mcohen iastate.eduandrew s. miner iowa state university ames iowa usa asminer iastate.edutitus h. klinge iowa state university ames iowa usa tklinge iastate.edu abstract chemical reaction networks crns are an emerging distributed computationalparadigmwhereprogramsareencodedasasetofabstract chemical reactions.
crns can be compiled into dna strands which perform the computations in vitro creating a foundation for intelligent nanodevices.
recent research proposed a software testingframeworkforstochasticcrnprogramsinsimulation however it relieson existingprogramspecifications.in practice specifications are often lacking and when they do exist transforming them intotestcasesistime intensiveandcanbeerrorprone.inthiswork weproposeaninferencetechniquecalledchemflowwhichextracts 3typesofinvariantsfromanexistingcrnmodel.theextracted invariants can then be used for test generation or model validation against program implementations.
we applied chemflow to crnprogramsrangingfromtoyexamplestorealbiologicalmodels with hundreds of reactions.
we find that the invariants provide strongfaultdetectionandoftenexhibitlessflakinessthanspecificationderivedtests.inthebiologicalmodelsweshowedinvariantsto developers and they confirmed that some of these point to parts of the model that are biologically incorrect or incomplete suggesting we may be able to use chemflow to improve model quality.
ccs concepts software and its engineering software testing and debugging.
keywords chemical reaction networks test generation invariants petri nets acm reference format michael c. gerten alexis l. marsh james i. lathrop myra b. cohen andrew s. miner and titus h. klinge.
.
inference and test generation using program invariants in chemical reaction networks.
in 44th international conference on software engineering icse may pittsburgh pa usa.
acm new york ny usa pages.
https this work is licensed under a creative commons attribution noderivs international .
license.
icse may pittsburgh pa usa copyright held by the owner author s .
acm isbn .
introduction manynon traditionalprogrammingparadigmshaverecentlyemerged including techniques to leverage physical processes to embed computationsinnanodevices called molecular programming .
chemical reaction networks crns are one such paradigm where programs are encoded as a set of abstract chemical reactions .crnsareofspecialinterestbecausetheycan be compiled into a program using dna strands and then executed in vitro .
as a result crns help catalyze the development of intelligent nanodevices devices that could be leveraged for purposes such as intelligent drug delivery .
sincecrnsformthefoundationoflivingorganisms theseare alsoofinteresttobiochemistsandsyntheticbiologists engineers of new biological functions who build models to describe the physical program implementations bothsynthesizedandnatural .
therearenownumerousrepositoriesofreusablebiologicalparts availableonline manyofwhichcanberepresentedascrns .
some of these repositories have even been likened to the github for synthetic biology .
several recent advances include higherlevelprogramminglanguagesthatcompileintocrns .
recently crns have even been formulated to represent neural networksandthesehavebeenshowntobeeffectiveandefficient atcommonclassificationtasks suggestingapotentialfor nanolearning.ifweexaminerecentpublicationspromotingnovel uses programmingapproachesforcrnswefindthatasmanyas halfofthepapersintherecent dnaconferences ar e onthistopic.andifweexaminetheacmdigitallibrarywefind recentpaperscrossingdomainssuchassoftwareengineering in venues such as tosem tse icse ase re and computational biology networking and chemistry domains.
whilethescienceofprogrammingcrnsisexploding validating theircorrectnesslags.muchofthestateoftheartinvalidatingcrns usesmodel checkingor otherformal approachessuch astheorem proving .
however scalability of model checking is often an issue in particular in crns that have faults .
usershaveinsteadstartedtoaskabouttestingonforumssuchas matlab help forum .
the crn community uses two primary semantics for crns which differ in how the crns are simulated evaluated .
in this work we focus on one type stochastic crns.
in recent work we proposed an automated software testing framework for stochastic crns chemtest .however chemtest relies onthe existence ieee acm 44th international conference on software engineering icse icse may pittsburgh pa usa gerten marsh et al.
of program specifications.
these specifications define both the program inputs and the oracles using a temporal logic.
as we demonstrate in our motivating examples writing manual specifications for stochastic crns is time consuming and potentiallyerrorprone.andasintraditionalsoftware crnsmayhave ambiguousspecifications maybeautogenerated ormaycomewithoutanyspecifications suchasbiologicalorganisms .allofthese issues suggest the need for automated inference and generation techniques.sincecrnsareknowntobeequivalenttoacommon structure in distributed software testing petri nets and there is alargebodyof literatureonwaystoanalyze thesenetworks weaskifwecanleveragethatresearchtoanalyzecrnsandextract invariant propertiesofthecrns.ifwecaninferacrnsbehavior sufficiently we have a powerful technique that can be used for test generation and to validate known models.
in this paper we explore this idea.
we have created a technique called chemflow .chemflowextractslinearinvariantsfromstochastic crns using a form of gaussian elimination.
it creates different typesofinvariants somewhichcanbeeasilyincorporatedintoa testing framework.
others require more complex harnessing reactioncounting .weimplementedandevaluatedbothinthiswork.
chemflow is significant forthe software engineering community aswemovetothenewnanocomputationalworld asisalreadyhappening weneedtoprovidestrongsoftwareengineeringpractices that can guide and ensure program correctness.
we evaluate chemflow by first comparing tests created from its invariantsagainstmanuallygeneratedtestcasesforawiderangeof crnprogramswhichhave specifications.wefindthatthe invariantshavegoodfaultdetectionandthattheytendtobelessflaky.
wealsoseethataddingreactioncountingincreasesthequalityof theinvariants.wethenevaluatetheuseofinvariantdetectionin four subjects which lack manual specifications.
two of these are based on metabolic models of a living organism escherichia coli .
we presented the biological invariants to developers bioinformaticists who work with these types of models and write programs toanalyzethem.theypointedoutthatsomeinvariantsrepresent potential inconsistencies between the model and known behavior.
the contributions of this work are a linear invariant inference technique for chemical reaction networks called chemflow alargestudyshowinginvariantsprovidegoodfaultdetectionandcanindicatepotentialproblemswithmodelquality an analysis of some tradeoffs between different types of invariants and manual specifications.
inthenextsectionwepresentsomemotivatingexamplesand background.
we follow this with a presentation of our invariant test generation technique section .
we then present our study in sections and followed by discussion.
we present related work in section .
finally we conclude and present future work.
motivation and background we begin with some motivating examples to demonstrate the need for automated invariant inference in crns.
we then present some background on crns and the state of the art in crn testing.
.
three motivating examples scenarioone unclearspecifications webeginwithoneofour subject programs obtained from a tutorial on building crns for which we needed to write test cases.
the author of this tutorial presents a crn that satisfies the specification suppose we are given a state with an unknown number of molecules of species x and y and we want to decide whether or not x is equal to y modulo .they then present a program with five reactions see background below forspecificsofcrnprogramnotationetc.
.ourinterpretationof this specification is that the program accepts two inputs x and y and performs modulo arithmetic.
it then returns a boolean result or stating if these are equal.
we quickly realized the specificationwasunclear.weinitiallyassume da0or1r eturnvalue but of course this may also be or any strictly positive value if true .thespecificationfailstostatewhichwaytheprogramworks.
in our initial incorrect test cases we checked for a return value of 1astrue.manytestsfailedandittookhoursandmanyiterations to determine the exact specifications for this simple correct crn.
scenario two autogenerated code.
anotherof ourstudy subjects hailstone4 isanauto generatedcrncreatedbyacompiler using a high level domain specific language.
this function hailstone is a well known function.
however the particular formulation of the program has reactions and species.
although we know the general functional properties of hailstone we do not knowtheexactvaluesofthevariousinput outputsandwecould not extract complete specifications manually for this program.
scenario three model quality for existing programs.
the lastexampleisforevaluatingconformanceofamodelanditsimplementation.weagainlookatoneofourstudysubjects acrn extracted from the metabolic model of a living organism.
the crn isamodel nottheactualprogramimplementation.whileourorganismiswellstudied therearenoexactspecificationsforaliving organism.
these are learned over time using years of collective experimentation.
in addition the organisms evolve.
we therefore want to extract specifications from the existing model and compare with the organism s known behaviors.
the biological crn has almost reactions and as many species.
.
chemical reaction network programs chemical reaction networks crns and its many variants are widelyusedtomodeltheinteractionsofmolecules .here weusethestochasticmass actionvariantwhichmodelsthestate ofthenetworkwithintegralcountofmoleculesratherthanrealvaluedconcentrations.crnsarenowcommonlyusedtodevelop chemical algorithms by carefully specifying the interactions between abstract molecules.
recently researchers have developed methodsto synthesizeabstract chemicalnetworks intostrandsof dna molecules .
roughly the stochastic model of a crn is defined as a pair n s r where sis a finite set of species abstract molecule types and risafinitesetof reactions thatoperateoverthespecies.
areactioniscomposedofreactantsandproducts whicharevectors of species and are often denoted using the format a b2.
c d. 1194program invariants in chemical reaction networks icse may pittsburgh pa usa the reaction above depicts the interaction of two molecules aand b thatcometogetherinsolution interact andproducemolecules c andd.
the rate of the reaction is proportional to the rate constant .43andtheproductofthenumberof aandbmoleculesinsolution.
inthestochasticmodel thisoverallratedeterminesaprobability that the reaction will occur and how long it will remain in the new state sojourntime .thus ifthenumberof amoleculesis10and thenumbersof bmoleculesis2 thenthepropensityofthisreaction firingataspecifictimeisdeterminedbythequantity10 .
v where vis the volume of the solution.
the probability that the reaction fires is determined by its propensity and the propensity of all the other reactions in the system.
when the volume is constant we can write the above reaction as a b c d. we give an example crn to illustrate the semantics of a stochastic crn.
consider the crn n s r with species s x y pe po andrconsisting of the following four reactions.
x po y r1 po po pe r2 pe po po r3 pe pe pe r4 thiscrncomputes parity i.e.
whetherthenumberofinputmolecules xis even or odd.
the output is a single molecule po odd number inx orpe evennumberin x andpreservestheinitialnumber ofxin the species y. to see how this works we initialize xto andpe po and yto zero noting that the number of molecules inxis an odd number.
at the end of the computation the species peshould be and poshould contain a single molecule that indicates the initial input in xwas odd.
we can examine the behavior more clearly by looking at a traceof the crn over time.
table showsthetraceandenumeratesthemoleculecountsofthecrn after each reaction occurs.
it represents only one of many different orderingsthereactionsmayoccur.notethatifnotallordersleadto the correct results the failure is probabilistic which leads to flaky crns and flaky crn testing.
flaky tests can also occur when they are evaluated before the crn stabilizes.
table example of a crn execution time reaction xp op ey initial values .
x po y41 .
x po y32 .
po po pe30 .
x po y21 .
x po y12 .
po po pe10 .
pe pe pe10 .
x po y01 .
pe po po01 end of simulation as we see in table at time .
reaction r1 fires which converts a molecule of xinto a molecule of po.
since there is only a single pomolecule present no other reactions can fire and so reaction r1 must fire again.
this occurs at time .
where another xis converted and we now have two pomolecules.
atthis point both reactions r1 and r2 are enabled and one is chosenprobabilisticallyproportionaltothereaction spropensity.
on our example reaction r2 is chosen at time .
.
as more reactions are enabled the state of the molecules changes according to the rules of the reactions that fire eventually leaving a single molecule of peorpo.
in this state no reaction can fire and the system remains stable.
.
testing crns in prior work we proposed a stochastic crn testing framework chemtest which uses a multi step process .
in that work we comparedscalabilitywithmodelcheckinganddemonstratedthe needforanalternativeapproachtocrnverification.wesummarize chemtesthere.first testsareformulatedfromspecifications as statedinourfirstmotivatingexample usingalineartemporallogic ltl .boththeprograminputsandthepropertieswhichmusthold the oracles are defined by the ltl.
these become abstract test cases.fourtypesoftestcasesaredesigned.functionaltestcases are properties on the program output.
equation shows a functional abstract test for subtraction from the chemtest artifact website.
itissubtracting x2fr om x1andtheresultgoesintospecies y.y can never be negative hence any negative values become .
the propertystatesif x2isgreaterthan x1then future globally y at evaluation time t will be equal to zero.
metamorphic tests are also used.
these are compared against two program executions.
equation states if x1 prime the second execution isgreaterthan x1and x2isheldconstant then future globallyat evaluation time t y primeis greater than y. x1 fg x1 fg y two other tests types are defined.
internal tests can be either functionalormetamorphic buttestpropertiesofaninternalspecies ratherthanaprogramoutput.hypertestsaresetsoftestcasesacross whichapropertyholds.theyareusedforprobabilisticprograms whicharenotguaranteedtogivethesameanswereachrun.wedo not use either of these test types in this paper.
as can be seen by the examples writing ltl test cases may be cumbersome and can require significant manual effort.
it also requires a full set of program specifications.
onceabstracttestsarecreated chemtestusescategorypartition to define sets of inputs which generate concrete test cases .
the test specificationlanguage tsl isastandardwaytoimplement the category partition method on a program input space.
tsl first partitionsaprogrambyitsparametersandforeachparameteritdefines choicesorequivalenceclassesofvalues.thesetofparameters and choices for the program becomes the tsl model.
in stochastic crnsspeciesareparametersandchoicesarethespeciesconcentration equivalence classes e.g.
we might use odd number of species zero species large number of species .
constraints between inputs can also be specified using temporal logic to help restrict invalid test inputs some of the specifications require that x1 x2 for instance .usingtheconcretetests chemtestthenrunsthetestcases on a crn simulator in the matlab simbiology package .
the properties of each test run are checked for correctness at a 1195icse may pittsburgh pa usa gerten marsh et al.
!
figure chemflow overview.
in 1it pre processes thedata performs gaussianelimination and flow analysis.once invariants are extracted they can be used either for model comparison and quality and or test generation and testing.
specifiedtimeduringsimulation.becausetestscanbeflaky each simulation is run a number of times.
chemflow we now present chemflow.
figure shows an overview of chemflow.
we begin with a stochastic crn.
we then pre process and use our tool we call chem flows step to extract invariants.
theinvariants canbeofthree types.thesecan thenbecompared against an implementation for model quality or they can be automaticallytranslated intoabstracttestcases.theabstract testcasesarethenconcretizedandusedfortesting byassigning sets of inputs and associated oracles using category partition.
we discussthekeyaspectsofinvariantextractionnext followedbyan example of test generation.
.
invariant extraction chemical reaction networks are known to be equivalent to petri nets in fact petri nets were originally conceived to describe chemical processes where molecules species and reactions in crns become tokens places and transitions in petri nets.
thus crnsinheritmostofthetheoreticalresultsoriginallyderivedfor petri nets and vector addition systems .
in particular we utilize the well known petri net concept of linear invariants or p flows .eachp flowisaweightedsumofnumbersoftokens in places that is guaranteed to remain constant.
for example in thecrn specifiedbyreactions r1 r4 we seethatthe number ofxmoleculesplusthenumberof ymoleculesisaconstantthat depends on the initial value of x. in the trace shown in table we seethat x y 5holdsatalltimesduringthecrnexecutionand that x yis a p flow.
we can also derive relationships from inequalities .
for example po y pe is an invariant of the crn.
moreover we can utilize relationships found in the crn by counting the number of times a reaction fires in the crn.
this information gives us additionalequalityinvariants.forexample intheaboveexample r1 y says that the number of times r1 has fired plus the number of ymolecules is at any time during the execution of the crn.
a more interesting invariant for this system is r2 po y which is also true for all time the crn is executing.
thisinequalitycanonlybeevaluatedwithspecialcountingharness which evaluates how often a reaction has occurred.we now give a more detailed description of how these relationships are derived.
we start with an equation for the number of molecules for each species as the initial number of molecules modified by the number of firings of each reaction multiplied by the netchangeforthatspecieswhenthatreactionfires.forourcrn shown above we would obtain the linear equations x xinitial r1 y yinitial r1 po poinitial r1 r2 pe peinitial r2 r3 r4.
theseholdforanynon negativenumberoffiringsforeachreaction i.e.
foralltimeaftertheinitialconfiguration.next werearrange eachequation keepingtheinitialvaluesontherighthandside and moving everything else to the left hand side.
we now obtain x r1 xinitial y r1 yinitial po r1 r2 poinitial pe r2 r3 r4 peinitial wecanthenuseaseriesofelementaryoperations namelymultiplyingequationsonbothsidesbyaconstantoraddingoneequationto another with the goalofeliminatingthereactioncountingterms.
for our example adding the first equation to the second eliminates r1 giving us x y xinitial yinitial this is the linear invariant discussed above x y for the inputs xinitial and yinitial .
similarly subtracting the second equation from the third gives the linear invariant po y r2 poinitial yinitial an important observation is now in order.
for any linear invariant obtained fromthese equations its right handside whichis aconstant canbeobtainedfromitsleft handside bysubstitutingthe initialcountforeachspeciesandzeroforeachreactioncount.to seethatthispropertyistrue notethatitholdsinthestartingequations and remains true after performing any elementary operation.
it therefore suffices to manipulate the left sides of the equations only keeping in mind that the right side is always a constant that can be recovered from the initial configuration.
1196program invariants in chemical reaction networks icse may pittsburgh pa usa based on the above discussion we implemented a standalone tool chem flows that reads a crn model and derives its linear invariants.
prior to its use we pre process the crns to a standard format and eliminate any non integer coefficients using a multiplicative factor.
we also split bi directional reactions.
chem flows first indexes the crn species and reactions and then builds the stoichiometrymatrix mofthecrn knownalsoastheincidence matrixinpetrinetliterature .thismatrixhasarowforeach speciesand acolumn foreach reaction and element m is the net change in species swhen reaction roccurs.
the left side of the initial set of equations is given by the matrix maugmented with i denotedas where iistheidentitymatrixofdimension number of species.
the augmented matrix is then reduced using gaussian elimination with integer arithmetic.
after reduction the rows contain the linear invariants each true at all times and for any sequence of reactions that may occur.
our chem flows tool then classifies each linear invariant into one ofthree categories.
thefirst category labeled flows contains relationships between species only without reaction counts.
these are obtained from rows whose reaction count coefficients are all zero.thesecondcategory labeled inequalities areusedtoderive the inequalities used in this study but may also be used in test harnessesthatutilizereactioncounting.theseareobtainedfrom rowscontainingatleastonenon zeroreactioncountcoefficient and whose reaction count coefficients all have the same sign.
the third category labeled irreducible requiresreactioncountingtoevaluate.
theseareobtainedfromrowscontainingreactioncountcoefficients ofdifferentsigns whichpreventderivationofaninequalityinterms of species counts.
.
test generation we now summarize the procedure for generating test cases using acrnprogramfromourstudy hailstone h1 .steponecreates invariants using the chem flows tool.
the hailstone input file for thechem flows program and its output is shown below x p o h m p o p o p e p e p o p o p e p e p e h h d m b a b a p e d p e c e y p o a p o c o y c e p o y p o d c o p e y p e a flows constant 3x 3m 1b 1a 1c o 3h 3m 6d 1b 1a 6y 7c o ce y co inequalities remove reactions constant reaction m b a co reaction po m b a co reaction reaction po m pe b a co reaction d y co reaction b a co reaction b a co irreducible reaction reaction y co reaction reaction cotheoutputfromthe chem flows programisusedtogeneratean abstracttest inputsandanoracle andsubsequentconcretetests.
we begin by describing how we transform an expression in the flowssection of the output into an ltl formula.
each expression in the flows section is transformed by setting it equalto someconstant g which mustbe trueatallevaluationtimesofthesimulation t .forexample in the output shown above the first flow x1 m b a co transforms to the to ltl formula 3x1 3m 1b 1a 1co constant to generate a concrete test we need values for the species in the formula.fortheinputspeciesweuseatslmodel.oncetheinitial values are generated the concrete test is created by setting each of the species involved in the abstract test to its initial value.
we then evaluatetheexpressiontocalculatetheconstant.thisconstantis placed within the ltl global operator g and forms a concrete test.
inthecase whenthespeciesarenotinput species wesetthemto zero.intheaboveexample thefunctionhasonlyoneinputspecies x1.thetslfollowschemtestwhichhascategoriesfor x1such aseven odd zeroormaximumandanenvironmentwhichcontrols themaximumvalues toensurewehavecombinationswhichare small medium and large .
all the other species are set to .
if x1i s set to then the the concrete test 3x1 3m 1b 1a 1co isusedtotesttheoutputtraceofthecrn.manyofourcrnshave multiple input species.
eachexpressioninthe inequalities sectioncanbetransformed intoanabstracttestandconcretetestusinganearlyidenticalprocedure.
for these expressions any terms in the expression that refers to a reaction firing is ignored and the same procedure for flows is performed.
however the invariant is no longer an equality but ratheralessthaninequality.theconstantisagainfoundbysetting the species involved to their initial values and using equality to determine the constant.
for example the first expression in the inequalities section becomes m b a co .
initial values of m b a co the irreducible section has expressions that contain reaction firing but cannot be used as an inequality.
as such reaction counting must be used to utilize these expressions.
the inequalities section also contains expressions with reaction firing hence both sections canbeusedwithreactioncountingforcreatingabstractandconcretetests.sincereactioncountingexpressionsareequalities the invarianttheyrepresentaretreatedthesameasintheflowssection.
howeverabstracttestsfromtheseexpressionsmustutilizereaction counting to evaluate the property of the crn.
.
implementation we first run the crn models through a script that scales any reactions to eliminatenon integer coefficients.
this model is thenfed intothe chem flows tool which extractsand classifiestheinvariants.amatlabscriptthenprocessesandtranslateseachinvariant into a set of abstract test cases based on the invariant type.
the concrete inputs are generated from a tsl program.
since the invariantabstracttestshavenoconstraintsontheinputvalueswe 1197icse may pittsburgh pa usa gerten marsh et al.
endupwithasetoftestscontainingthecartesianproductofthe tsl categories for all input species.
weusethechemtestframeworkusingmatlabsimbiology to run tests.
it accepts the crn the set of concrete inputs and the abstract test cases.
itthen executes the test cases and processthe traces to extract passing or failing test cases.
evaluation we evaluate the quality of chemflow by asking three research questions.
artifacts for this study are available online rq1 howeffectivearetheflowinvariantscreatedbychemflow?weanswerthisquestionusingfaultdetectioncomparedwith specification based test suites.
rq2 whatistheimpactoneffectivenessandefficiencywhen weaddinequalityandirreducibleinvariants?
weevaluatethe change in fault detection and the time to execute.
rq3 does chemflow provide useful information when we lackspecifications?
weexamineif theinvariantscanfind faults in the mutants and if they indicate potential model quality issues.
.
study subjects wegatheredasetof13benchmarkcrnprogramsfrom a prior workoncrntesting b theliterature c acrnsimulationtool and d a metabolic model from an online database.
they range in size and complexity from a single reaction to almost reactions.
allofthecrnscanbefoundonoursupplementarydatawebsite.
for ofof these crns weeither have existing manualtest suites from chemtest or we followed gerten et al.
s approach to buildourowntestsuitesbasedonspecifications.weexaminethe other four crns in a regression environment where no manual tests are available.
table summarizes the characteristics of the crnsorderedbythenumberofspecies followedbythenumber ofreactions.thefirstcolumngivesthecrnnameanditsacronym used throughout the rest of this paper.
the second column