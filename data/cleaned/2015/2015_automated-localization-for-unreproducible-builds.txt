automated localization for unreproducible builds zhilei ren key laboratory for ubiquitous network and service software of liaoning province school of software dalian university of technology dalian china zren dlut.edu.cnhe jiang key laboratory for ubiquitous network and service software of liaoning province school of software dalian university of technology dalian china jianghe dlut.edu.cn jifeng xuan school of computer science wuhan university wuhan china jxuan whu.edu.cnzijiang yang department of computer science western michigan university kalamazoo mi usa zijiang.yang wmich.edu abstract reproducibility is the ability of recreating identical binaries under pre defined build environments.
due to the need of quality assuranceandthebenefitofbetterdetectingattacksagainstbuild environments the practice of reproducible builds has gained popularityinmanyopen sourcesoftwarerepositoriessuchasdebianand bitcoin.
h owever identifying the unreproducible issues remainsalabourintensiveandtimeconsumingchallenge because of the lacking of information to guide the search and the diversity of the causes that may lead to the unreproducible binaries.
inthispaperweproposeanautomatedframeworkcalledreploc tolocalize theproblematicfilesfor unreproduciblebuilds.reploc featuresaqueryaugmentationcomponentthatutilizestheinformation extracted from the build logs and a heuristic rule based filtering component that narrows the search scope.
by integrating the two components with a weighted file ranking module reploc is able to automatically produce a ranked list of files that are helpfulinlocatingtheproblematicfilesfortheunreproduciblebuilds.
we have implemented a prototype and conducted extensive experiments over real world unreproducible debian packages in four different categories.
by considering the topmost ranked file only reploc achieves an accuracy rate of .
.
if we expand our examination to the top ten ranked files in the list produced by reploc the accuracy rate becomes .
.
considering that there arehundredsofsourcecode scripts makefiles etc.
inapackage reploc significantly reduces the scope of localizing problematic files.
moreover with the help of reploc we successfully identified and fixed six new unreproducible packages from debian and guix.
ccs concepts softwareanditsengineering maintainingsoftware software evolution permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may june gothenburg sweden association for computing machinery.
acm isbn ... .
unreproducible build localization software maintenance acm reference format zhileiren hejiang jifengxuan andzijiangyang.
.automatedlocalizationforunreproduciblebuilds.in icse icse 40thinternational conference on software engineering may june gothenburg sweden.acm newyork ny usa 11pages.
introduction asanindicatoroftheabilitythatthebinariescouldberecreated consistentlyfromsource recentyearshavewitnessedtheemerging idea of reproducible builds.
given the source files the reproducibility is described as the ability of building identical binary under pre definedbuildenvironments .inthisstudy sourcefilesincludesourcecode scripts makefiles buildconfigurations etc .
checkingthereproducibilityofsoftwarecreatesaverifiablelinkage thatbridges the gapbetween thereadable source filesand the binary packages which is important from various perspectives.
firstly reproducibilityisveryimportantforthesafetyofbuild environments.forsoftwareecosystems attacksagainstthebuild environment may lead to serious consequences.
by compromising the system to produce packages with backdoors malicious behaviors such as trusting trust attack may be introduced duringthebuildtime.forexample in2015 over4 000iosappli cations were infected by a counterfeit version of apple s xcode developmentenvironment knownasxcodeghost .xcodeghost injectedmaliciouscodeduringcompilingtimesothatdevelopers unknowinglydistributedmalwareembeddedintheirapplications .
obviously a solution is to ensure that the same source files always lead to the same binary packages so that an infected different binary immediately raises alarms.
unfortunately a major obstacleofdetectingsuchattacksliesinthetransparencygapbetween the source filesand their compiled binary packages.
due to non deterministicissuessuchastimestampsandlocales itisnot uncommonthatrebuildinganapplicationyieldsdifferentbinaries evenwithinsecurebuildenvironments.therefore thesekindsof attacksofteneludedetectionbecausedifferentbinariesofthesame application is normal.
besides detecting attacks against build environments validating the reproducibility is also helpful in debugging and finding certain acm ieee 40th international conference on software engineering authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhilei ren he jiang jifeng xuan and zijiang yang release critical bugs e.g.
libical dev .
.
.
furthermore in the context of and continuous integration and software upgrade reproducible packages could be helpful in caching and reducing redundant operations e.g.
by eliminating the necessityof delivering the different binaries compiled from the same source files.
due to the significant benefits many open source software repositories have initiated their validation processes.
these repositoriesincludegnu linuxdistributionssuchasdebianandguix as well as software systems like bitcoin .
for instance since the number of debian s reproducible packages has been steadily increasing.figure1presentsthetrendofthereproduciblebuilds indebian .asofaugust2017 over of debian spackages could be reproducibly built.
despitetheefforttowardsreproducibility manypackagesremain unreproducible.
for example according to debian s bug trackingsystem bts asofaugust23 thereare2 342packages that are not reproducible for the unstable branch targeting the amd64 architecture.
such large number of unreproduciblepackages implies the challenges in detecting and then fixing theunreproducible issues.
in particular the localization task for the problematicfilesistheactivityofidentifyingthesourcefilesthat cause unreproducibility which ranks source files based on theirlikelihoodofcontainingunreproducibleissues.currently thelocalization task is mostly manually conducted by developers.
since theremaybehundredstothousandsofsourcefilesforapackage the localization tends to be labor intensive and time consuming.
to address this problem we consider the source files as text corpus and leverages the diff log1generated by comparing the differentbinariestoguidethesearch.assuch thelocalizationofthe problematic files can be modeled as a classic information retrieval ir problem given the source files and the diff log determine thoseproblematicfilesfromthesourcefilesthatarerelevanttothe unreproducible issues.
the ir model has the potential to automate the localization task.
however the localization task is challenging due to its unique characteristics.
first theinformationforlocatingtheproblematicfileswithin thesourcefilesisverylimited.thediffloggeneratedbycomparing the different binaries which is considered as the input of the ir process may not be sufficiently informative.
we call this challenge aninformationbarrier .inaddition therearemanycausesthat may lead to unreproducible builds such as embedding timestamps infilesandrecordingfilelistsinnon deterministicorder.thedetailed issues are manually listed in debian s documentation .
moreover the diverse types of files in a package also add to thecomplexity of localizing the problematic files which may residein not only the source code but also other types of files such as scripts makefilesandbuildconfigurations.wecallthischallengea diverse cause barrier .
to break through the barriers we propose a localization framework called reploc that targets the localization task in search ofproblematicfilesforunreproduciblebuilds.givenanunreproduciblepackagewithtwodifferentbuiltbinariesastheinput reploc produces a list of ranked source files.
reploc features two componentsthataddressthetwoaforementionedchallenges.for theinformationbarrier wedevelopaqueryaugmentation qa 1generated by diffoscope figure reproducibility status of debian unstable for amd64 componentthatutilizestheinformationextractedfromthebuild logstoenhancethequalityofthequeries representedbythefile names extracted from the difflogs see section .
for the diversecausebarrier wedevelopaheuristicrule basedfiltering hf component.
more specifically we propose heuristic rules that areobtained by summarizing the information presented in debian s documents.
furthermore we employ a weighted file ranking fr componenttocombinetheqaandhfcomponents andbuildanin tegratedframeworktoautomatethelocalizationoftheproblematic files for unreproducible builds.
to evaluate reploc we have collected a real world dataset that consistsof671unreproduciblepackages.sincethesepackageswerelaterfixedwithpatchesfromdebian sbts weknowexactlywhich files caused the unreproducibility and thus can use the facts to evaluatetheaccuracyofreploc.ifweconsiderthetopmostranked file only reploc achieves an accuracy rate of .
.
if we expand therangetoincludetoptenrankedfiles theaccuracyratebecomes .
.
for other metrics such as precision and recall reploc also outperforms the comparative approaches significantly.
to further evaluate the effectiveness of our approach we use reploc on unreproducible packages that have never been fixed before.
with thehelp of reploc we successfully identified the problematic files thenmanuallyfixedtheunreproducibleissuesoverthreedebian packages.
moreover the usefulness of reploc is examined overa different software repository guix in this study .
under the guidance of reploc problematic files for three unreproducible packages from guix are detected and fixed.
this paper makes the following main contributions.
tothebestofourknowledge thisisthefirstworktoaddressthe localization task for unreproducible builds.
weproposeaneffectiveframeworkreplocthatintegratesheuristicfilteringandqueryaugmentation.aprototypehasbeenimplemented based on the approach.
wehaveevaluatedreplocon671unproducibilepackagesthat werelaterfixedinthedebianrepository.theexperimentalresults show that reploc is effective.
we have made the benchmarks publicly available at .
undertheguidanceofreploc wefixedsixunreproduciblepackages from debian and guix and submitted the patches to the btssofthetworepositories.amongthesubmittedpatches four have been accepted.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated localization for unreproducible builds icse may june gothenburg sweden figure reproducibility validation work flow table snippet of altered environment variations configuration first build second build env tz usr share zoneinfo etc gmt usr share zoneinfo etc gmt env lang c fr ch.utf env language en us en fr ch fr env builddir build 1st build 2nd ... ... ... therestofthispaperisorganizedasfollows.insection2 we give the background of this work.
our approach is presented in section followed by experimental study in section .
the threats tovalidityandrelatedworkaredescribedinsections5 .finally section concludes the paper.
background taking debian as a typical example figure illustrates the commonworkflowofvalidatingthereproducibilityofpackages .
first the source files are compiled under two pre defined build environments steps1 .morespecifically thebuildenvironments are constructed by setting up altered environment variables or software configurations.
for instance within debian s continuous integration system 2altered environment variables include locales timezones user privileges etc.
table presents a snippet of the altered environment see for more detailed information .
two versions of binaries can be generated with respect to each environment.thetwoversionsarethencomparedagainsteachother step3 .iftheyarenotbit to bitidentical thelocalizationofproblematic filesthatleadtounreproduciblebuildsisrequired basedonthediff log and the source files step .
the build and the comparison procedures steps can easily be automated but the localization step mainly relies on the developers.unfortunately manualefforttoidentifythefilesthat leadtounreproduciblebuildsisnontrivial.asshowninfigure2 thedifflogsarethemajorsourceoftheinformationtoguidethe localization of the problematic files which unfortunately are not always sufficiently informative.
figure gives a snippet of the diff log for dietlibc a libc implementation optimized for small size.
in the original version .
cvs20120325 astaticlibraryfilediffersbetweenthetwoversions during the build time usr lib diet lib libcompat.a .
asshowninthedifflog diffoscope indicatesthedifferencevia theoutput ofthegnubinary utility readelf.however since the figure diff log snippet for dietlibc a makefile snippet b patch snippet figure makefile and patch snippet for dietlibc diff content may not be well comprehensible e.g.
lines in figure we do not leverage such information in this study.
meanwhile figure4presentsasnippetofaproblematicfile makefile and the patch that fixes the issue.
in figure b line indicates thattherootcauseoftheunreproducibilityliesinthenon stable order of the object files which are fed to the arutility to generate libcompat.a lines of figure a .
the difficulty in this example is that the diff log may fail to provide sufficient information.
though it is possible to match the correct file with only the file name i.e.
line of figure a chances are that other irrelevant files containing the same file name might be matched as well.
theaforementionedexampleillustrateshowproblematicfiles can be detected and fixed.
in reality there are multiple altered buildconfigurationsandcanbemanycorrespondingcausesthat lead to unreproducible builds.
for example changing the timezone environment variable env tz may cause the c c packages thatembed date macrotobeunreproducible andthelocale environmentvariable env lc maytriggerunreproducibleissues of packages that capture the text generated by programs.
these diverse unreproducible causes make the localization task difficult.
our approach in this section we discuss the details of reploc.
figure depicts the work flow of reploc that consists of three components qa hf and fr.
for each component we shall explain its design and implementation companionedwiththeintermediateresultsover the running example dietlibc .
.
query augmentation component theupperpartoffigure5depictstheqacomponent whichenriches the queried information by matching the files in the diff log and the build logs to tackle the information barrier.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhilei ren he jiang jifeng xuan and zijiang yang figure the reploc framework figure build log snippet for dietlibc first thedifflogisgeneratedusing diffoscope .then thequery extraction module takes the diff log as the input and generates the basic query.
in this study the basic query consists of the file names in the diff log.
as mentioned due to the information barrier the information that can be utilized to localize the problematic files is limited other than a list of files that are different within the twobuildprocesses.thus weenhancethequalityofthequeries with the build command retrieval module.
the motivation for this moduleisthat duringthebuildprocess thebuildinformationsuch as the executed commands can be obtained.
moreover based on theco occurrencerelationshipbetweenthefilenamesinthediff logandthebuildcommands we canidentifythebuildcommands with which the files mentioned in the diff log are built.
hence it is rational to augment the query by supplementing the build commands from the build log.
figure6illustratesasnippetofthebuildlogoftheexemplifying package dietlibc .
it can be observed that the build log is more informative and provides supplementary information with respect to the diff log.
more specifically we first split the build log into build command segments with respect to the entering leaving directory tagsgeneratedby make e.g.
lines1and10offigure6 .
with this operation the commands invoked under the same directory can be grouped together as a file of the augmentation corpus denotedasacommandfile .notethatthoughtherearetwoversionsofbuildlogswithrespecttothetwobuildenvironments since we are interested in the build command the choice of either version of build log does not have an impact on the results.
then the relevantfilesinthecorpusareobtainedbyutilizinganirmodel.inessence anyirmodelcanbeadopted.inthisstudy weemploythe vector space model vsm due to its simplicity and effectiveness.table heuristic rule set idrule pcre statement time macro time date macro date gzip arg bgzip s ?
!.
n date cmd date shell s date date py date datetime .datetime .today pl localtime .
localtime system date system.
date date in tex date.
today sort in pipe .
?
!.
lc all .
s sort b gmtime gmtime tar gzip pipe btar b. s bgzip b pl unsorted key ?
!.
sort .
s keys s ls without locale .
.
?
!.
lc all .
s bls b unsorted wildcard ?
!.
sort .
s bwildcard b to realize the vsm based augmentation we calculate the cosine similarity between basic query and the command files.
thereafter the matched commands from the most relevant command files are obtained.
in particular for the vsm model we assign weight value foreachfilewiththe tf idf termfrequency inversedocument frequency measurement whichiswidelyusedinir .inthis paper foraterm tinadocument d itstf idft dvalueiscalculated basedon ft d n nt whereft dindicatesthenumberof t soccurrences in d ntdenotes the number of files in which tappears and nmeans the number of source files.
with tf idfdefined each file isrepresentedasavector andthecosinesimilaritywiththebasic query is used to rank the command files.
sim vecl vecs vecl vecs vecl vecs where vecl vecsrepresents the inner product of the basic query and thecommandfile and vecl vecs denotestheproductof2 normofthe vectors.afterthat thebasicqueryandtheretrievedcontents which are commands executed during the build process are concatenated together as the enhanced query.
running example fordietlibc all the file names in the diff log e.g.
.
usr lib diet lib libcompat.a are extracted as the basic query.
then within the augmentation ar cru bin x86 64 libcompat.a line of figure and the build commandsinthesamecommandfileareretrieved.finally thecontents of theretrieved commandfiles areappended afterthe basicquery as the final query.
.
heuristic filtering component the hf component is designed to capture the problematic files byincorporatingthedomainknowledge whichisrepresentedas frequently observed patterns.
in hf the heuristic rules are constructed based on the following criteria the rules are manually constructedbasedondebian sdocumentation .
therules are summarized for the four major categories of unreproducible issues seesetcion4.
.wetraversethenotesinthedocumentation and capture those issues that are described as perl compatible regularexpression pcre .forexample invoking gzipwithout n argument could be expressed using the negative assertions feature ofpcre rule3intable2 .meanwhile asacounterexample the timestampsembeddedinportableexecutable pe binariesarehard authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated localization for unreproducible builds icse may june gothenburg sweden to be identified by heuristic rules or even by developers .
after manual inspection based on the criteria we obtain heuristic rules which are presented in table and described as follows time macro using c time preprocessing macro in source fileswillembeddifferenttimestampswhencompiledatdifferent times.
date macro embeddingc datepreprocessingmacro in sourcefilesissimilarasthepreviouscase.
gzip arg ifapplying gzip without n argument timestamps will be embedded in the header of the final compressed file.
date cmd capturing the current date with the dateshell command.
py date obtainingdatetimeinpythonscripts.
pl localtime obtainingdate time in perl scripts.
system date recording system time in the compiled binary.
date in tex embedding date in tex files whichinfluencesthebuiltpdffiles.
sort in pipe executesort inpipelinewithoutlocalesetting.
gmtime obtainingcurrent date time.
tar gzip pipe execute tarandgzipin pipeline.
pl unsorted key traversingunsortedhashkeysinperlscript does not guarantee identical order.
ls without locale capturinglswithout locale setting is similar with sort in pipe .
unsorted wildcard usingwildcard inmakefileswithoutsorting similar with pl unsorted key .
by applying the rules over the source files e.g.
with gnu grep r p we obtain a subset of files that may lead to unreproducible builds.notethattheserulesequallytreatthesourcefilesasplain text ratherthanconsiderthefiletypes e.g.
basedonfileextension .
thereasonisthattheunreproducibleissuesmayresideinsnippets ortemplatesthatdonotfollowfileextensionconventions which are eventually embedded into unreproducible binaries.
based on such consideration we do not sort the matched files in hf.
running example fordietlibc thereareintotalfiveproblematic files namely libpthread makefile libdl makefile debian rules implicit and makefile .
among these files makefile see figure b can be captured by the unsorted wildcard rule in which sortdoes not appear before wildcard .
however weshouldnotethattheremaybefalsealarms e.g.
for unexecuted commands or text in the comments.
consequently hf mayfailtoplacethematchedproblematicfilesatthetopofthelist.
.
file ranking component themotivationsbehindthecombinationofhfandqaaretwofold theheuristicrulesinhffocusonthestaticaspectofthesource files i.e.
treat all the source files in a unified way and capture the suspiciousfilesthatmatchthedefinedpatterns.suchmechanism can handle various file types.
unfortunately there may be false alarms especiallyforthosefilesunusedduringthebuildprocess.
the build log based augmentation takes the dynamic aspect of the build process into consideration.
with qa we concentrate on the commands invoked during the build process.
hence by combining themechanisms wecanstrengthenthevisibilityoftheproblematic files that lead to unreproducible builds.
inthefrcomponent thesegoalsarerealizedasfollows.first with the augmented query the relevant files are obtained with the sourcefileretrievalmodule.similarasinsection3.
thevsmmodelisadoptedtocalculatethesimilarityvaluesbetweentheaugmentedqueryandeachsourcefile.second sincewehaveacquiredboththe files retrieved by hf and the similarity values between source filesalgorithm reploc input binary package first binary package second weight output candidate file list result 1begin query augmentation 2log diffoscope first second 3query parse log log 4command files parse build log build log 5relevant command retrieve relevant query command files 6augmented concatenate query relevant commant heuristic filtering 7list 8foreach source file sdo ifsis matched by any rule in table thenlist list s 10end file ranking 11foreach source file sdo ifs listthenws elsews scores calculatesim primewith respect to equation 15end 16returnsort source files score 17end table files retrieved by reploc and its components over dietlibc with successful hits in bold rank fr without qa rank fr with qa changes debian rules debian rules makefile makefile changes debian control debian patches .diff faq diet.c rank hf rank reploc t.c debian rules debian implicit makefile debian dietlibc dev.postinst.in changes debian rules libpthread makefile libugly gmtime.c libdl makefile andtheaugmentedquery inthefilerankingmodule itisnatural to combine these two types of information to better capture the problematicfiles.forexample wecanmodifyequation1andapply sim primeto rank the source files sim prime vecl vecs sim vecl vecs ws wherews for those source files matched by the hf component and ws otherwise.
is a weight parameter to balancethetwoterms e.g.
large valuesmakereplocfavorthe hf component.
withequation2 thesourcefilesarerankedaccordingtotheir modified similarity to the augmented query and the top ranked files are returned as the final results of reploc.
we should note that in this study we adopt the file level localization paradigm in thatthefixingformanyunreproduciblepackagesisnotunique.forinstance statementsdeclaringmissingenvironmentalvariablescanappearanywhereinthefilebeforeitisneeded.hence itisdifficult to establish line level ground truth.
in algorithm we present the pseudo code of reploc which combines qa lines hf lines and fr lines sequentially.
running example in table we present the top five files retrieved by reploc and its individual components.
from the table authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhilei ren he jiang jifeng xuan and zijiang yang wecanobservethatwithoutaugmentingthequery frisableto retrieve two problematic files.
however the topmost ranked fileis a changelog changes in that the file names in the diff log appear in this file.
in contrast with the query augmented fr with qa isabletorankthetwoproblematicfilesatthetopofthelist.
meanwhile althoughhfisabletocapture libpthread makefile thefileisnotassignedtoprankduetootherfalsealarms e.g.
t.c.
finally bycombiningfr qa andhf replocisabletolocatefour problematic files.
experimental results .
research questions inthisstudy weintendtosystematicallyanalyzereploc byinvestigating the following research questions rqs rq1 is reploc sensitive to the weighting parameter ?
rq2 how effective is reploc?
rq3 how efficient is reploc?
rq4 is reploc helpful in localizing unfixed packages?
amongtheserqs rq1concentratesontheimpactoftheweighting scheme between the components in reploc.
rq2 focuses on howwellreplocperformsintermsofdifferentqualitymetrics.rq3 examineswhetherreplocistimeconsuming andrq4investigates the reploc s generalization.
.
data preparation inthisstudy thedatasetisconstructedbyminingdebian sbts.to the best of our knowledge debian is the only repository providing both past version packages and reproducibility related patches whicharecrucialforgeneratingthecorpusandthegroundtruth.
consequently allthepackageswithinthedatasetareextractedfrom debian bts which are tagged as unreproducible bybug reporter viadebtags i.e.
the command line interface for accessing the bts.
according to debian s documentation there are categories of reproducible issues .
there are also two special categories indicating the packages that fail to build from source and the toolchainissues non deterministicissuesintroducedbyotherpackages see section which are not considered in this study.
we download all the categories of bug reports and download the packages with their corresponding patches.
then weapplythevalidationtoolkit 3toobtainthecorrespondingdiff logsandbuildlogs.inthisstudy weconsiderthosecategorieswithmorethan30packages.withsuchcriterion weobtain671packagesinthedataset whichfallintothefourlargestcategories.figure7 a illustrates the statistics of the dataset.
in the figure we present the numbersoftheopenandclosedbugsindebian sbts aswellas the number of packages in the dataset.
among the four categories of packages the timestamps category contains the most packages followed by file ordering randomness and locale .
for all the four categories of packages that are labeled as done thepackagesinthedatasettakeaportionof45 .
.note that there are less packages in the dataset than closed bug reports sincepackagesmaynotbecompilableduetotheupgradeoftheir dependencies.
3thetoolkitrealizessteps1 3offigure2 availableat cgit reproducible misc.git a number of packages b problematic file types figure file statistics of the dataset in figure b we illustrate the statistics of the patches in the dataset.
from the figure we could observe that there are many typesoffilesthatmightbeinvolvedintheunreproduciblebuilds.
for these files the debian rulesfiles which are the main build scripts takethelargestportionofthefixedfiles .
.auxiliaryfiles suchasthe configure scriptsandinputfiles .in takesthe second largest portion .
.
after that there are the makefiles .
scripts such as python perl php files .
c c files .
xml files .
implicit build files .
.
since we classify the files based on their file extensions heuristically there are also .
of the files that are not easy to classify e.g those without file extensions.
this phenomenon conforms with the second barrier mentioned in section i.e.
the causes to theunreproducible builds are diverse which makes the localization task very challenging.
.
implementation and metrics replocisimplementedinperl5.24andjava1.
.alltheexperimentsare conducted on an intel core i7 .
ghz cpu server with gb memory runninggnu linuxwithkernel4.
.
.forthecomparative algorithms we consider four variants of reploc since there is no priorapproach addressing this problem.the first twovariants implement two baseline algorithms which only consider either thehforthefrmodel denotedasreploc hf andreploc fr .
thesetwovariantsareincorporatedtoexaminetheperformance ofitsbuilding blockcomponents.moreover reploc fr couldbe consideredthesimulationofthemanuallocalization sinceinfr theretrievalisrealizedbymatchingsourcefileswithdifflogcontents.then reploc fr qa considersutilizingtheqacomponent to enhance the basic queries extracted from the diff logs.
finally reploc indicates the version discussed in section .
toevaluatetheeffectivenessofreploc metricscommonlyused intheirliteraturesareemployedtoevaluatetheperformanceof reploc includingtheaccuracyrate theprecision therecall and themeanaverageprecision map .themetricsarecomputedby examiningtherankedlistofsourcefilesreturnedbytheframework in response to a query.
the top nsource files in the ranked list iscalledtheretrievedsetandiscomparedwiththerelevancelist to compute the precision and recall metrics denoted by p nand r nrespectively .givenanunreproduciblepackagewithproblematicfiles atop naccuracyratescore e.g.
a a anda of a localization tool is the portion of top nlists a tool provides thatatleastoneproblematicfilecontainsinit .inthisstudy authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated localization for unreproducible builds icse may june gothenburg sweden figure impact of varying wealsoreport p p p 10andr r r .p n meanstheportionofproblematicfilessuccessfullyretrievedina top nlist while r nmeasureshowmanyproblematicfilesare retrieved in a top nlist among all the problematic files p n of files that cause unreproducible builds n r n retrieved problematic files in the top nlist of problematic files.
precision and recall usually share an inverse relationship in that the precision is higher than recall for lower values of nand vice versa for higher values of n. an overall metric of retrieval accuracy is known as mean average precision map which is the average of the average precision ap values over all the problematic files in unreproducible packages.
for an unreproducible package with several problematic files the apis computed as summationtext.1m k 1p k pos k of files related in the patch wheremis the size of a ranking list pos k indicates whether the kthfile in a ranking list is related to the unreproducible build and p kis the precision described in equation .
with apdefined mapcan be calculated by averaging all theapscores across all the unreproducible packages.
.
investigation of rq1 in this rq we intend to investigate whether reploc is sensitive to theweightingparameter .asdescribedinsection3 inequation2 we propose the weighted similarity between queries and source files.
hence in this rq we are interested in investigating reploc s behavior as we alter the weight of the two components.
more specifically foreachcategoryofdataset werandomlyselecthalf of the packages and a grid search from .
to .
with a step of .
is employed to analyze the impact of varying .
consideringthetimestampsandthelocaledatasets wevisually present the trend of the a p r 10and themapvalues againstthe valueinfigure8.fromthefigure thefollowingobservations can be drawn.
first for the randomly selected packages theperformanceofreplocexhibitssimilartrend i.e.
when isset within the range reploc obtains the best results.
second weobservethatreplocisnotverysensitiveto unless istoo large whichwillmakereplocpreferthehfcomponent.hence for the subsequent experiments is set with .
.
answertorq1 experimentalresultsshowthat replocisnot verysensitivetotheparameter whichtosomeextentdemonstrates the robustness of reploc.
.
investigation of rq2 in this rq we examine whether reploc locates the problematic filesaccurately.wepresenttheexperimentalresults anddiscuss thephenomenaobserved.intable4 wefirstgivetheresultsover the datasets.
the table is organized as follows.
the first column indicates the four categories of datasets we built in this study see section .
.
the second column represents the four variants of reploc.then therestofthetablepresentsthemetricsthatevaluate the performance of each variant.
note that for the accuracy rate theprecision andtherecall themetricvaluesareaveragedoverall thepackages.
besides wealsopresent theaggregateperformanceat the bottom of the table.
takingthetimestampsdatasetasanexample severalinteresting phenomena can be observed.
first the performance of reploc hf is not satisfying.
even considering the top results the corre sponding accuracy rate is around .
to examine the representativenessoftheheuristicrules intable5wepresenttheresults of reploc hf with singlerule.
we reportthe a p r andmapof the five rules that perform the best.
among the rules thegzip arg ruleachievesthehighestaccuracyrate.however the a 10valueisbelow30 whichissignificantlyoutperformedby reploc hf that considers all the rules.
similar observations could be drawn for other performance metrics which to some extent confirms the diverse cause barrier.
second by comparing the results of reploc fr qa against reploc fr in table we can confirm the usefulness of qa.
as mentioned reploc fr could be loosely considered the simulation ofmanuallocalization whichtriestomatchtheproblematicfiles withthedifflogcontents.overthetimestampsdataset a 10of reploc fr is71 .
.
withthe augmentationof the query a improves to .
.
moreover when we combine reploc fr qa withhf theperformanceisfurtherimproved i.e.
a 10ofreploc achieves .
which implies that for over of the unreproduciblepackagesinthetimestampsdataset atleastoneproblematic file is located in the top list.
besides similar results are obtainedovertheotherdatasets i.e.
reploc hf andreploc fr performtheworst reploc fr qa outperformsreploc fr considering the a 10value and reploc performs the best.
associated with table we also conduct statistical tests to draw confident conclusions whether one algorithm outperforms the other.
for the statistical test we employ the wilcoxon s signed rank test with a null hypothesis stating that there exists no differencebetweentheresultsofthealgorithmsincomparison.we consider the confidence level i.e.
p values below .
are considered statisticallysignificant andadopt the p 10andr 10as theperformancemetrics.wedonotconsidertheaccuracyrateand themapmetrics inthattheseareaggregatemetrics.overallthe instances when comparing reploc with any of the other three baseline variants the null hypothesis is rejected p value .
for bothp 10andr which implies that reploc outperforms their baseline variants in a statistically significant way.
togainmoreinsightsintothebehaviorofreploc wepresent theperformanceofthefourvariantsagainstthenumberofretrieved results in figure over typical datasets.
in the figure the x axis andthey axisindicatethenumberofretrievedfiles andtheperformance metrics.
from the sub figures we confirm that over both authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhilei ren he jiang jifeng xuan and zijiang yang table comparison results between reploc and its variants dataset model a a a p p p r r r map timestampsreploc hf .
.
.
.
.
.
.
.
.
.
reploc fr .
.
.
.
.
.
.
.
.
.
reploc fr qa .
.
.
.
.
.
.
.
.
.
reploc .
.
.
.
.
.
.
.
.
.
file orderingreploc hf .
.
.
.
.
.
.
.
.
.
reploc fr .
.
.
.
.
.
.
.
.
.
reploc fr qa .
.
.
.
.
.
.
.
.
.
reploc .
.
.
.
.
.
.
.
.
.
randomnessreploc hf .
.
.
.
.
.
.
.
.
.
reploc fr .
.
.
.
.
.
.
.
.
.
reploc fr qa .
.
.
.
.
.
.
.
.
.
reploc .
.
.
.
.
.
.
.
.
.
localereploc hf .
.
.
.
.
.
.
.
.
.
reploc fr .
.
.
.
.
.
.
.
.
.
reploc fr qa .
.
.
.
.
.
.
.
.
.
reploc .
.
.
.
.
.
.
.
.
.
overallreploc hf .
.
.
.
.
.
.
.
.
.
reploc fr .
.
.
.
.
.
.
.
.
.
reploc fr qa .
.
.
.
.
.
.
.
.
.
reploc .
.
.
.
.
.
.
.
.
.
table result of reploc hf with single heuristic rule idrule a p r map gzip arg .
.
.
.
date cmd .
.
.
.
unsorted wildcard .
.
.
.
ls without locale .
.
.
.
sort in pipe .
.
.
.
figure trends of precision and recall of reploc thedatasets replocoutperformstheothervariantssignificantly i.e.
the performance curves for reploc lie above those for other variants whichimpliesthatforallthecasesoftheretrievedresults combiningthetwocomponentsisabletoobtainbetterresults.this phenomenon conforms with our observations in table .
answertorq2 bycomparingthevariantsofreplocover671 realworldpackages weconfirmthatbycombiningtheheuristicrule based filter and the query augmentation reploc is able to outperform its variants.
figure histogram for scale statistics figure histogram for efficiency evaluation .
investigation of rq3 in this rq we evaluate reploc from the efficiency perspectives.
sincemanuallylocalizingtheunreproducibleissuesisatimeconsuming task automating such process is profitable only if the proposed approach is time efficient.
hence we present the time statisticsoftheexperiments.figure10depictsthestatisticsofthesource files as histograms in which the x axis indicates the number ofsource files filenum and the words wordnum and the y axisrepresentstheassociatedfrequency.inthisstudy thenumberoffiles ranges within and the number of words for the majorityofthepackagesrangesaround1 whichimpliesthat manually inspecting the files would be difficult.
sincethescaleofthepackagesinthisstudyvariesgreatly itis intuitivethatthelocalizationprocessoverdifferentpackageswill authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automated localization for unreproducible builds icse may june gothenburg sweden table results of reploc over manpages tr rank reploc fr rank reploc fr qa debian rules debian patches bashisms.patch source man8 mount.
.xml debian rules source tr linkata.sh source manderle.sh source man1 rsync.
.xml makefile source manderle.sh debian manpages tr.prune rank reploc hf rank reploc source man1 gzip.
.xml source manderle.sh source manderle.sh debian patches bashisms.patch debian rules source man1 gzip.
.xml source man1 patch.
.xml varyaccordingly.toinvestigatethisissue wepresenttheresults related to time efficiency considering the three variants of reploc.
infigure11 weillustratethedistributionsofthedatasetscalability and the execution time.
in the sub figures the x axis indicates the time in seconds and the y axis represents the frequency.
from the results we observethat the indexing ofthe documents consumes thelargestportionoftime comparedwithothercomponents.in particular the median of the execution time for reploc is .
seconds.
answer to rq3 in this rq we investigate the efficiency perspectives of reploc.
in this study the indexing of the document consume the majority of the time.
.
investigation of rq4 for rq1 rq3 to evaluate the performance of reploc properly we employthepackagesthathavebeenfixed andadoptthepatches fromthebtsasthegroundtruth.however inthereal worldre producible validation scenario the patches are not available in advance.
hence in this rq we intend to investigate reploc under suchcondition.morespecifically weconsidertwoscenarios i.e.
weapplyreploctothepackagesover debianpackagesthatare previouslyunfixed and theunreproduciblepackagesfromguix.
first we are interested in whether reploc could be generalized to unfixed packages which are obtained from the continuous integrationsystemofdebian.wealsocheckthebts toensurethatthe packageshavenotbeenfixed.weapplyreploctolocalizetheproblematicfiles andthenmanuallycheckandfixtheunreproducible issues.
through localization and fixing unreproducible packages belonging to the timestamps category are fixed i.e.
regina rexx .
fonts uralic .
.
and manpages tr .
.
.
.
we submit the corresponding patches to the bts and the one for fonts uralic has been accepted.
for these packages the problematic files are ranked among the top of the retrieved list by reploc.
for example in table we present the results over the package manpages tr .
the table is organizedsimilarlyastable.
.fromthetable weobservethatreploc is able to localize problematic files effectively i.e.
the problematic filesarerankedthefirstintheresult.thepackageisunreproducible duetotheinvocationof gzipwithout n andtheissuecanbecaptured by the gzip arg rule in source manderle.sh .
however sincetheheuristicrulesfailtocapturethedynamicaspectofthe build process a file source man1 gzip.
.xml unused during compilation is also retrieved.
in contrast with fr and qa we concentrateonthefilesinvolvedbythebuildprocess.bycombiningtable results of reploc over skalibs rank reploc fr rank reploc fr qa package info configure doc kolbak.html src uint32 reverse.c doc unixmessage.html src badrandom here.c doc unix transactional.html src goodrandom here.c doc unix timed.html src md5 transform.c ...... ...... makefile makefile rank reploc hf rank reploc tools gen deps.sh makefile makefile configure src localtm from ltm64.c src uint32 reverse.c src badrandom here.c src goodrandom here.c boththestatic hf andthedynamic hfandqa perspectives the problematicfileisrankedthefirstofthelistwithhigherprobability.
second weconsiderthepackagesfromtheguixrepository to investigate whether the knowledge obtained from debian could begeneralizedtootherrepositories.thereasonswechooseguix arethat therepositoryisinterestedinthereproduciblebuilds practice and itspackagemanagerprovidesthefunctionality ofvalidatingpackagereproducibilitylocally whichfacilitatesthe experimentaldesign.asademonstration welocalizeandmanually fix the problematic files of packages namely libjpeg turbo .
.
djvulibre .
.
and skalibs .
.
.
.
similar with the previous case the patches were submitted to guix s bts .
taking skalibsasanexample wepresenttheresultsofthevariants of reploc in table .
from the table we could observe that the problematicfile makefile isassignedthetoprank.contrarily withoutreploc over900sourcefileshavetobemanuallytraversed.
such observation to some extent demonstrates the usefulness ofreploc in leveraging the knowledge from debian to a different repositorysuchasguix.afterlocalizingtheproblematicfileand manuallyfixing thesubmittedpatchhasbeenacceptedandpushedintothecodebaseofguix .similarly thepatchesfor djvulibre and libjpeg turbo have also been accepted.
answer to rq4 wedemonstratethatreplocishelpfulinlocalizing unfixed unreproducible packages from both debian and guix.
in particular unreproducible issues of packages from both repositories are fixed under the guidance of reploc which have not been fixed before this study.
threats to validity there are several objections a critical reader might raise to the evaluation presented in this study among which the following two threats deserve special attention.
first inthisstudy theheuristicrulesinhfaresummarizedfrom debian sdocumentation.also weleveragethebuildloggatheredfrom the build process.
hence some may argue that the approach cannotbegeneralizedtoothersoftwarerepositoriesbecauseitrelies too much on debian s infrastructure.
to mitigate this threat in reploc attentionispaidsothatthecomponentsarenotspecialized fordebian.forexample despiteknowingthatthedebian rules filestakethelargestportionoftheproblematicfiles seefigure7 b no extra priority is given to these files during ranking.
also in hf weavoidusingheuristicrulesspecifictodebian andintendtomake authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhilei ren he jiang jifeng xuan and zijiang yang the rules as general as possible.
for instance unsorted wildcard is applicable for makefile based build systems and gzip arg is helpful if gzip based compression is involved.
as a result the results of this study can be generalized to other repositories.
as demonstratedinrq4 wehavesuccessfullyappliedreploctoguix.
for other repositories applying reploc should only require minor adaptation.forexample forthefedoraproject thebuildlogcan begatheredbyparsingtheverboseoutputofthe mockbuildtool and the diff log could be generated by diffoscope as well.
second whenconstructingthedatasets theunreproduciblepackages causedby thetool chain issues arenot considered.for these packages theunreproducibleissuesareintroducedbythedepended packages rather than the current package.
hence identification of the tool chain issues is another challenging task that requires furthermanualinvestigation .besides weshouldnotethatfixing thetool chainissuesmayhelpmakemorepackagesreproducible.
for example when reproducible related patches were accepted by gccfromupstream around200unreproduciblepackagesthatdependedon gccbecamereproducibleautomatically .weplanto explore the tool chain issues in the future.
related work .
bug localization related work first thisstudyiscloselyrelatedtothefaultlocalizationstudies especially the ir based approaches.
for example zhou et al.
proposed a specialized vsm based approach andconsiderthesimilaritiesbetweenbugreportstolocalizebuggyfiles.wangetal.
proposeacompositionalmodelthat integrates multiplevariants of vsm.in particular they modelthe compositionofdifferentvsmvariantsasaoptimizationproblem andapplyageneticalgorithmtosearchforthesuitablecompositionpatternbetweenvsmvariants.wangetal.
investigatethe usefulnessofir basedfaultlocalizationtechniques anddiscover thatthequalityofthebugreportsarecrucialtotheperformance of localization tasks.
meanwhile domain knowledge is utilized to improve the performance of ir based bug localization techniques.
ye et al.
find bug fixingfrequencyandbug fixingrecencyofsourcecodefilesarehelpfulforbuglocalization.sahaetal.
findthestructureofbug reportsandsourcecodefilesarealsogoodknowledgeforbuglocalization.theyconsiderbugreportsorsourcecodefilesasdocuments with structured fields e.g.
summary and description or file name classname andmethodname respectively.stack traceinformation in bug report is also analyzed to improve the performance ofbuglocalization.besides versionhistories andsimilar bug reports are proved to be useful.
besides with the development of ir techniques other text mining methodologies are also incorporated to support locating buggy files.
for example due to its effectiveness latent dirichlet allocation lda hasgaineditspopularityinthefieldofbuglocalization.
lukins et al.
propose a static lda based technique for automaticbuglocalization.lametal.
proposealocalization frameworkhylocthatcombinesdeeplearningandir basedmodel.
they integrate deep neural network and a vsm variant to complementthetwostandalonecomponents.experimentalresultsoverreal world projects demonstrate that their proposed model outperformstheindividualmodels.raoetal.
proposeanincremental framework to update the model parameters of the latent semantic analysis whichisthenappliedtolocalizebuggyfiles.experiments over software libraries with ten years of version history validate their framework.
however despite the closeness to these studies we should note that the problem in this study has its unique features.
for example thecounterpartofthebugreportsinir basedfaultlocalization i.e.
the diff logs are not sufficiently informative to guide the retrieval.
.
reproducible build related work to the best of our knowledge there have not been studies on localizingfilesthatcauseunreproduciblebuilds.however therehave been studies that address the importance of reproducible builds.
forexample wheeler describesa practicaltechniquenamed diverse double compiling.
by compiling the source files twice with different compilers and verifying the compiled binaries certain typesofmaliciousattackscanbedetectedandprevented.according todebian sdocumentation thisworkpartiallymotivatestherepro duciblebuildspractice .holleretal.
investigatethediverse compilation under embedded system and experimentally quantify theefficiencyofdiversecompilingforsoftwarefaulttolerance.carnavaletandmannan conductanempiricalstudy focusingon the reproduciblebuilds in thecontext of security criticalsoftware.
basedontheexperimentsontheencryptiontool truecrypt they summarize the challenges of reproducibility in practice.
ruiz et al.
addressthereproducibilityincloudcomputing.theyadoptthe term reconstructable software and propose a prototype to simplify the creation of reliable distributed software.
inthisstudy wefocusonthelocalizationtaskforunreproducible builds which has not been addressed in the existing studies.
conclusions inthisstudy weinvestigatethelocalizationtaskforunreproducible builds.
we present components that consider heuristic knowledge similarity based information as well as their integration as reploc.forempiricalvalidation wecreatefourcategoriesofpublicly availabledatasetswith671unreproduciblepackagesfromdebian.
extensiveexperimentsrevealthatreplocisabletoeffectivelylocalize the files that lead to unreproducible builds.
furthermore with the help of reploc we successfully identified and fixed new unreproducible packages from debian and guix.
forthefuturework weareinterestedinthelocalizationofproblematic files for the tool chain related issues.
also inspired by the record and playtechniques fromthecrashreproductionbased debugging research it would be interesting to leverage these techniques to detect more accurate correspondence between the build commands executed and the built binaries.