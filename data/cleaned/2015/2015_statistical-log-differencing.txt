statistical log differencing lingfeng bao nimrod busany david lo and shahar maoz zhejiang university city college china tel aviv university israel singapore management university singapore abstract recent works have considered the problem of log differencing given two or more system s execution logs output a model of their differences.
log differencing has potential applications in software evolution testing and security.
in this paper we present statistical log differencing which accounts for frequencies of behaviors found in the logs.
we present two algorithms s2kdiff for differencing two logs and snkdiff for differencing of many logs at once both presenting their results over a single inferred model.
a unique aspect of our algorithms is their use of statistical hypothesis testing we let the engineer control the sensitivity of the analysis by setting the target distance between probabilities and the statistical significance value and report only and all the statistically significant differences.
our evaluation shows the effectiveness of our work in terms of soundness completeness and performance.
it also demonstrates its effectiveness compared to previous work via a user study and its potential applications via a case study using real world logs.
i. i ntroduction many works present different kinds of log analyses which take a system s execution log as input and output a model e.g.
a state machine a set of scenarios or a set of invariants which provide data and insights about the behavior of the system that produced the log see e.g.
.
one kind of log analysis is differencing i.e.
comparing logs in order to infer and represent differences between two or more sets of executions .
log differencing has various applications in software engineering.
one example application is in the context of testing e.g.
comparing logs produced in the lab vs. ones produced in the field to improve test design and execution.
another example application is in the context of security e.g.
comparing logs produced by a benign app with ones produced by a similar app suspected to be infected with malicious code.
additional example applications include comprehension in the context of software evolution.
in recent work we have presented a log differencing approach based on finite state models and a notion of kdifferences sequences of kevents that appear in one log and not the other.
the work presented 2kdiff an algorithm that compares two logs and nkdiff an algorithm that compares several logs at once.
in both the results are presented succinctly on top of a single finite state model with relevant transitions highlighted.
an important strength of these two algorithms is that they are sound and complete all reported differences are indeed differences and all differences are reported.
one clear weakness of the 2kdiff and nkdiff algorithms however is that they abstract away the frequencies of thedifferent behaviors in the logs.
this results in two limitations that affect usefulness.
first logs that include the same set of behaviors albeit at very different frequencies are reported as equivalent with no differences found.
second when several differences are reported all are presented as equally important.
in this paper we present statistical log differencing which accounts for frequencies of behaviors.
following our previous work we present s2kdiff an algorithm to compare two logs and snkdiff an algorithm to compare several logs at once both importantly with an additional statistical dimension as follows.
almost any two logs coming from different sets of runs of the same system will not be identical in terms of the frequencies of different behaviors.
however subtle differences in frequencies may be meaningless.
moreover large differences in frequencies that are based only on a small set of traces may not actually represent true differences.
where should the line be drawn between interesting and uninteresting differences?
our answer is based on statistical hypothesis testing.
we let the engineer control the sensitivity of the analysis by setting the target distance between transition probabilities e.g.
d .
and the statistical significance value e.g.
.
.
we then report only and all the statistically significant differences.
on top of the use of hypothesis testing our approach has three additional important features.
first we order the differences by their statistical significance and report them one by one on demand in this order.
this helps engineers focus on the more significant differences first.
second we compute the differences locally at the level of transition probabilities but report them within the larger context of the complete behavior represented by a k tails based finite state model and when applicable a concrete trace from the log .
this helps engineers conceptualize the behavior in question in its correct context.
finally when differencing many logs at once we present a single compact model that includes log indices over the transitions.
logs that are statistically different are put into different groups.
this facilitates the multiple log comparison and allows engineers a quick identification of the differences and the logs where they appear.
we have implemented our algorithms validated the correctness of the implementation and evaluated it against logs generated from models taken from several sources.
our evaluation shows that the statistical analysis is effective in terms of providing the expected statistical guarantees and in terms of its performance.
we report a user study of participants 34th ieee acm international conference on automated software engineering ase .
ieee authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
showing the effectiveness of the algorithms in identifying behavioral differences in comparison to the baselines.
we further report on a case study using real world logs from the work of ghezzi et al.
which demonstrates one potential use of statistical log differencing in practice.
ii.
e xample we use a small and simple example to demonstrate the ability of s2kdiff and snkdiff to reveal significant differences of behaviors between 2logs and nlogs resp.
consider the cvs client model from lo and khoo .
the model has states and transitions with an alphabet of labels.
for our example here we manually created two copies of this model each annotated with different probabilities on its transitions.
we then generated logs from each of the two models and refer to them as l1 .
.
.
l6.
each log includes traces.
the generated logs simulate the behavior of different clients.
the engineer is interested to learn about significant differences in behavior profiles between the clients.
for a high level view of the differences across the logs the engineer runs snkdiff.
figure 1a shows the output of snkdiff on the logs running with k a distance d .
and a significance value of .
.
it consists of a finite state model that captures all the behaviors found in the logs and a csv file with a summary of the comparisons between the logs.
in the output each state is followed by a single event label that appears in at least one of the logs.
a transition between two states si sj indicates that the two corresponding events appeared consecutively in at least one trace in at least one of the logs.
for each transition and for each log snkdiff computes the probability of taking the transition.
then it conducts a set of statistical tests and considers a transition to be differing if there exists at least one pair of logs with a transition probability difference above dand a significance of .
each such transition is highlighted and labeled with a grouping of the logs indices according to their transition probabilities.
logs that belong to different groups are statistically different.
the transition also includes the probabilities of making the transition in each of the log groups.
the width of the transition highlights the significance of the difference in comparison to the other statistically significant differences.
in fig.
1a for example the most significant differences are from state which is followed by the event rnm rename to states and which are followed by the strfl storefile logout labels resp.
consider the transition from state 10to state4.
it shows that the probability of taking the transition equals in and43 in resp.
the transition highlights the major probability difference in obtaining the sequence of events angbracketleftrnm logout angbracketrightbetween the two groups of logs.
this demonstrates the ability of snkdiff to reveal significant differences between sets of logs.
the engineer can now continue to drill down to inspect differences between two selected logs using s2kdiff.
figure 1b shows the output of s2kdiff on logs l1andl4 again with k d .
and .
.
the output of s2kdiff consists of two finite state models that capture all the behaviors found in l1andl4resp.
we focus on the model of l1.
for each transition s2kdiff computes the probability of taking the transition in l1andl4.
then it conducts a statistical proportion test and considers the transition to be differing iff its probability difference is above dwith a significance value of .
the tool shows one differing transition at a time.
for each it finds and highlights the trace in l1that includes it and has the greatest probability difference in being accepted by the two models.
for example fig.
1b shows the model ofl1.
it highlights the significant difference from state to state3 which corresponds to the sequence angbracketleftsetfl setfiletype strfl storefile angbracketright red bold transition .
the transition label shows the transition probabilities .53and0.
in each of the models and the statistical test s p value.
finally s2kdiff highlights the accepting path of the selected trace dashed red lines angbracketleftinit initialize login setfl strfl apndfl appendfile logout dscon disconnect angbracketright.
iii.
p reliminaries we present preliminary definitions that we use later in the paper.
we start with traces and finite state machines and continue with an overview of the k tails algorithm.
we recall earlier log differencing algorithms and conclude with several well known statistical definitions that we use in our work.
a. basic definitions a trace over an alphabet of events is a finite word tr angbracketlefte1 e2 ... e m angbracketrightwhere ei tr.ei .f o rj 1we use tr j to denote the jth element in tr.w eu s e tr to denote the length of tr.
for a positive integer k a k sequence is a consecutive sequence of k or less events denoted by seqk.
kis the set of all k sequences over .
a loglover an alphabet is a set of traces l tr1 ... tr n .
definition finite state machine fsm .a finite state machine fsm is a structure m angbracketleftq qi qs angbracketrightwhere qis a set of states qi qis a set of initial states qs qis a set of accepting states is an alphabet and q p q is a transition relation where p q is the power set of the set of states q. we use subscript notation to refer to the elements of the fsm.
for example mrefers to the transition relation of m. letmbe an fsm over an alphabet .w eu s e l m to denote the set of all words accepted by m. definition probabilistic finite state machine pfsm .
a probabilistic finite state machine is a tuple m angbracketleftq i f p angbracketright whereq are defined similar to an fsm i f q are initial and terminal state probabilities resp.
and p q q are transition probabilities.
further q qi q q q f q a q prime qp q a q prime .
this definition requires that the probability of starting at any of the states in qequals and that for any state q q the probability of transitioning out or terminating equals .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
!
!
!
a output of snkdiff comparing logs l1 ... l6 see sect.
ii withk d .
.
.
red transitions correspond to k differences and are labeled with log indices s.t.
logs in different groups differ statistically.
!
!
b output of s2kdiff comparing l1andl4 see sect.
ii with k d .
.
.
model for log l1.
the red bold transition highlights a k difference between the two logs.
the dashed line corresponds to a selected trace from l1that includes the k difference.
fig.
example outputs of snkdiff and s2kdiff b. k tails k tails is a classic model inference algorithm which has been presented in several variants and implemented in many works e.g.
.
k tails takes a log and a parameter kas input.
it starts by representing the log as an fsmmlincomposed of linear sub fsms one per trace which are joined by adding a single initial state qinit transitioning to the start of each trace via a unique label and a single terminal state qaccto which all traces transition to at the end via a unique label.
notice that the language of mlinequals the set of traces in the log given that each trace is encapsulated by and events.
we refer to this version of the log as the encapsulated version denoted len.
k tails iteratively merges states in the mlinfsm two states are merged iff they are k equivalent i.e.
if their future of length kor less is identical.
when no two remaining states are k equivalent the algorithm terminates and outputs the resulting fsm called a k fsm.more formally we define a function future qmlin p k mapping states in mlinto k sequences.
the kequivalence relation induces a partition of the states of the initial fsmmlininto equivalence classes e e1 e2 ... e m where each of the equivalence classes in eis uniquely defined by its future sequences of length kor less two states s1 s2 eiifffuture s1 future s2 .
when lifted from qmlintoe the function future becomes the injective function id e p k .
for alls ei future s id ei .
definition k fsm .k fsm the fsm computed by ktails for a log land a positive integer k i sa nf s m ml angbracketleftq qi qs angbracketrightwhereq e the set of equivalence classes defined above is the alphabet of the log l e e.a .
e a uniontext braceleftbig e prime s s prime mlin.s e s prime e prime s prime mlin s a bracerightbig qi qinit is an artificial initial state and qs qacc is an artificial terminal state.
for a given k fsm ml generated by running k tails on authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
logl we use l ml to denote the set of all words accepted byml.
among other properties the correctness of the k tails algorithm implies that mlmay over approximate the set of traces inl but may not under approximate it i.e.
l l ml .
consequently every k sequence included in any trace in l i s part of at least one accepting word of ml.
additional useful properties of the k fsm are that all its states are reachable from the initial state qinit and that the accepting state qaccis reachable from all states.
further since we use a variant of k tails that starts from mlin and since each state in mlinis followed by a single future apart from the dummy initial state then all states in the k fsm are followed by single k future.
as a corollary any sequence of kevents that appears in the log corresponds to a unique k fsm state and any k 1sequence that appears in the log corresponds to a unique k fsm transition.
c. earlier log differencing algorithms we recall two existing techniques for log differencing 2kdiff and nkdiff which we extend in this work.
2kdiff.
2kdiff is a sound and complete extension of ktails for comparing two logs.
given a positive integer k 2kdiff compares two logs by focusing on k differences i.e.
ksequences that appear in one log but not the other and present them in the context of a k fsm model using highlighted traces from the logs.
2kdiff is sound and complete modulo the ktails abstraction.
any k sequence that appears in one log and not the other is included in at least one highlighted trace on the k fsm of the respective log and any such highlighted trace contains at least one such k sequence.
nkdiff.
nkdiff is a sound and complete extension of k tails used for comparing many logs.
roughly given a set of nlogs l1 ... l n and a positive integer k nkdiff computes the k difflfsm a single fsm whose transitions are labeled with subsets of log indices.
definition k difflfsm .f or set of logs l l1 ... l n and a positive integer k a k difflfsm ml1...lnis an lfsm angbracketleftq qi qs i label angbracketrightwhere q eis the set of equivalence classes of states from the k fsm ml iis the set of indices ...n is the union of the alphabets of the logs l1toln e e prime e a label e a e prime j s s prime mj lins.t.s prime mj lin s a futurej s id e futurej s prime id e prime bracerightbig e e prime e a e prime e a ifflabel e a e prime negationslash qi qinit is an artificial initial state and qs qacc is an artificial terminal state.
nkdiff is sound and complete its projection on any given index results in the k fsm of the log with that index soundness and any behavior that appears in at least one of the logs is included in it completeness .
the k difflfsm highlights all transitions that correspond to k sequences that only appear in some of the logs and not in others.
d. statistical definitions we recall well known statistical definitions that we use in our work.
we will use bernoulli trials to model the transitionsin the inferred pfsm.
we will use the z test to test whether the difference between probabilities of corresponding transitions is significant.
we will use the 2 test to compare corresponding transitions on many logs and test whether there exists at least one pair of logs with different transition probabilities.
definition bernoulli trials .letx1 x2 ... xnben identical independent trials where each trial has two possible outcomes referred to as success and failure .
let pdenote the probability of a success in a single trial and ydenote the number of successes in ntrials.
then the probability of an outcome y y follows the binomial distribution p y n!
y!
n y !py p y. letx1 x1 ... x n1 andx2 x2 ... x n2 denote two samples of bernoulli trials of size n1andn2with m1andm2successes and let p1and p2denote the sample proportions of success i.e.
pi mi ni .
testing whether the difference between the proportions of two series of bernoulli trials is smaller than a constant can be done using hypothesis testing.
the z test is a popular test for this purpose.
definition z test large sample hypothesis tests for two population proportions using independent samples .the z test is a hypothesis testing procedure for comparing two population proportions.
the null hypothesis of the test is h0 p1 p2 d and the alternative hypothesis is ha p1 p2 d. the value of thez test isz p1 p2 d radicalbig p1 p1 n1 p2 p2 n2.
using the statistic above we calculate the critical value z .
if the value of the statistics is larger than the critical value z z then we reject the null hypothesis h0.
the probability that we correctly rejected the null hypothesis is defined by pval probability z z a.k.ap value.
definition chi square independence test .the chisquare independence test 2 test is used to decide whether two variables v1andv2 are associated.
the null hypothesis is that the two variables are not associated.
the 2 test compares the observed frequencies with the frequencies that we would expect under the null hypothesis of non association.
the test statistic is x summationtext o e e whereorepresents the observed frequency and ethe expected frequency.
to compute the likelihood of the statistics i.e.
p 2 x the 2 test requires the degree of freedom as input.
let r cdenote the number of values that v1 v2take then the degree of freedom of 2is defined as r c .
iv .
s tatistical logdifferencing we now present the main contributions of our work s2kdiff for differencing two logs and snkdiff for differencing many logs.
we give formal definitions and examples but leave the proofs complexity analysis and additional remarks to .
a. from a k fsm to a k pfsm since s2kdiff and snkdiff identify differences between the transition probabilities in the k pfsm models of the logs we first explain how we compute these probabilities.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
letlandmdenote a log and its corresponding k fsm model.
we show how the probabilistic terms of the k pfsm i.e.
i f p def.
are defined.
lettm e e prime denote a transition in m. letv e denote the number of visits made by traces in lto the state em and by v t the number of times that transition tis fired.
then the maximum likelihood estimator mle for the transition probability of tis given byv t v e .
we use the mle formula to infer p the model transition probabilities.
further the k fsm model has unique dedicated source and terminal states by construction hence we define i qi q qi andf qs q qs .
these fully specify the k pfsm extension of the k fsm.
calculating states and transition counters.
.
recall that each state in the k fsm is an equivalence class of states in mlin and that each transition in mlincorresponds to an event in a trace.
therefore the number of visits of traces of a state e mqis given by the number states of mlin i ne.
the number of visits of traces of a transition tm e e prime i s given by the number of states of mlin i nethat are followed by states of mlin i ne prime.
we compute the counters per state and per transition on the fly as the states of mlinare merged.
note that since each statee mis followed by a single k sequence a state resp.
transition counter shows the number of times that each unique k sequence resp.
k sequence appears in the log.
b. s2kdiff differencing two logs at the heart of s2kdiff is a statistical engine that performs a series of statistical tests to identify statistically significant differences between the logs.
to this end we define the notion of a k d difference between two logs.
a k d difference is a sequence of k 1consecutive events that corresponds to a transition in the k pfsms and has probability difference of at leastdbetween the two models.
from here on since each transition in the k psfm corresponds to a unique k sequence we use the terms interchangeably.
let us formalize the above.
definition corresponding transitions .letl1 l2denote two logs and m1 m2their corresponding k pfsms.
let tm1 tm2denote two transitions in m1 m2resp.
we say that tm1 corresponds to tm2iff they correspond to an identical k sequence.
definition k d difference1 .letl1 l2denote two logs andm1 m2their corresponding k pfsms.
consider seqk a sequence of length k .
assume that seqk 1appears in both logs and consider its corresponding transitions tm1 tm2in m1 m2.
letp1 p2denote the transition probabilities of tm1 tm2resp.
given a distance d we say that seqk 1is a k d difference iff p1 p2 d. due to the probabilistic nature of the transitions estimators s2kdiff performs a statistical test to determine if a k d 1note that a transition in a k pfsm corresponds to a sequence of k events in the log see sect.
iii still we refer to these as k d differences.difference is statistically significant.
let us first formulate the probabilistic modeling of each transition.
definition a transition as a bernoulli trial .we model a transition t e e prime in the k pfsm as a bernoulli trial b p where each time that eis visited it can fire twith probability p. definition trace visits as a series of bernoulli trials .let t e e prime denote a transition in the k pfsm.
we model each visit of a trace to eas a single trial in a series of bernoulli trials.
we consider a trial as a success if tis fired and failure otherwise.
to identify statistically significant k d differences we use the above modeling and preform the hypothesis test presented in sect.
iii to compare the probabilities of corresponding transitions between the two models.
specifically to compare corresponding transitions tm1 e1 e prime and tm2 e2 e prime we obtain the source state and transition counters v e1 v e2 v t1 v t2 from the k pfsm models.
to use the formula of the z test def.
we set n1 v q1 n2 v q2 m1 v t1 m2 v t2 a distance d and a significance value .
let p1 p2denote the transition probabilities in the two models.
w.l.o.g.
assume that p1 p2.
we execute the hypothesis test setting the null hypothesis of the test to h0 p1 p2 d. we consider a transition as a k d difference iff the null hypothesis can be rejected i.e.
the test result has a p value below .
we now provide a high level description of the s2kdiff algorithm.
given a positive integer k a difference d and a significance value s2kdiff compares two logs by focusing on k d differences and presents all the statistically significant ones in the context of the models using traces from the logs.
the s2kdiff algorithm.
the algorithm gets two logs k d and as input.
it computes the k pfsm models of the two logs enriched with the number of times that each state and transition are visited by the traces in the corresponding logs.
then it finds all pairs of corresponding transitions.
for each transition the algorithm computes the number of source state n and transition visits m in the two models and performs a z test.
if the pvalof the test is less than i.e.
the transition corresponds the a k d difference the algorithm stores it.
then for each k d difference the algorithm searches for an evidence trace.
to this end the algorithm iterates over the traces in the logs and selects the traces that include the k d difference.
for each trace it computes the acceptance probabilities in both models.
after iterating all traces it chooses the one with the maximal absolute acceptance probability difference.
finally it outputs the results of all statistical tests conducted in a csv format along with a list of k d differences and corresponding traces.
it also outputs the graphs in .dot format with a highlighting of the most significant k d difference and its evidence trace.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
the resulting models of s2kdiff when running with l1 top model l2 bottom model k d .
.
.
the logs are described in example .
example .
we demonstrate the algorithm with a simple example.
consider running s2kdiff with k d .
.05onl1 tr100 angbracketlefta b angbracketright tr100 angbracketlefta c angbracketright tr100 angbracketlefta d angbracketright and l2 tr90 angbracketlefta d angbracketright tr50 angbracketlefta c angbracketright tr150 angbracketlefta b angbracketright tr5 angbracketlefta e angbracketright where the superscript shows the number of repetitions per trace.
the algorithm computes the models based on the encapsulated logs and then finds all pairs corresponding transitions e.g.
it pairs transitions tm1 a andtm2 a which correspond to the k sequence angbracketlefta b angbracketright and transitions tm1 tm2 a which correspond to the k sequence angbracketlefta c angbracketright.
then it iterates over tuples of corresponding transitions and performs a z test per transition.
it classifies the two pairs above as k d differences.
for example the first pair is highlighted in both models .
the parameters of the z test are n1 vm1 m1 vm1 a n2 vm2 m2 vm2 a and the resulting pval .
is well below .
hence s2kdiff considers it significant and highlights it.
to find an evidence trace it iterates over all traces.
the trace angbracketlefta b angbracketrightincludes the k sequence and has an acceptance probability of .
in the models of l1 l2resp.
since it is the only trace that includes the k sequence it is selected and highlighted.
note that the transition tm2 a does not have a corresponding transition in m1.
however since its source state k future a appears in both models it can be tested with n1 vm1 m1 n2 vm2 m2 vm2 a .
we omit the details of handling such cases.
it is important to note that similar to 2kdiff s2kdiff is sound and complete modulo the k sequences abstraction.
theorem s2kdiff soundness and completeness .letk be a positive integer and let l1 l2be two logs comparedusing s2kdiff with m1andm2their corresponding k pfsm models.
then any trace highlighted by s2kdiff over m1is a trace from l1 l2that includes at least one k d difference with respect to l2.
the same holds for m2.
further every k d difference between l1andl2is highlighted by at least one accepted trace in m1orm2.
c. snkdiff differencing many logs we now present snkdiff which extends nkdiff see sect.
iii given a set of nlogs l1 ... l n and a positive integerk snkdiff computes a k difflfsm model that maintains the original soundness and completeness properties.
unlike nkdiff snkdiff accounts for the frequencies of k sequences in the logs and only highlights transitions that have different probabilities in the models of different logs.
importantly only and all statistically significant differences are highlighted.
recall our definition of a k d difference def.
.
snkdiff searches for k d differences by comparing the probabilities of corresponding transitions in the k pfsms of the ndifferent logs i.e.
transitions with source and target states that map to identical k futures .
to this end it conducts a series of statistical tests per transition.
a straightforward yet costly approach would solve snkdiff by performing s2kdiff on all transitions on all pairs of logs.
this however will result in a o n2 runs of s2kdiff per transition.
our approach is different.
we start by employing a 2 test and then apply s2kdiff only to the transitions for which we have an indication of a possible difference.
in our evaluation we show that this heuristics for improved performance does not increase the statistical error.
this is expected because the 2test is conservative as it only checks for a possible difference without accounting for the difference size.
specifically in sect.
iii we presented the 2 test for testing if two variables are associated.
we established that each transition can be viewed as a random variable of a bernoulli trial.
this is our first variable for the test.
for the second variable we consider all the realizations of a transition in all nlogs.
then we model the log id as a variable that characterizes the realizations.
we conduct a 2 test to test if the variable of a transition is associated with the log id.
if the two variables are not associated then the probability of firing the transition is equal in all logs.
if the variables are associated there exists at least one pair of logs with different transition probabilities.
the null hypothesis of the 2 test is that the variables are not associated.
thus snkdiff conducts the test and rejects the null hypothesis when a p value smaller than is obtained.
if the null hypothesis is rejected snkdiff performs a set of pairwise comparisons according to the z test def.
.
finally snkdiff highlights a transition iff the null hypothesis of the z tests is rejected for at least one pair of logs.
example .
to demonstrate the above assume that snkdiff compares a transition between k pfsms of three logs i.e.
ti ei e prime i fori .
let us denote by v ei and v ti the number of visits to the source state and transition in theith log resp.
to conduct the 2 test we construct two contingency tables see table i. authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table i observed and expected values observed log1 log2 log3 tfired v t1 v t2 v t3 tskipped v e1 v t1 v e2 v t2 v e3 v t3 expected log1 log2 log3 tfired pv q1 pv q2 pv t3 tskipped p v q1 p v q2 p v q3 the first table holds the observed values o .
the second holds the expected values e under the null hypothesis which assumes that firing tis unassociated with the log id.
thus an equal firing probability is assumed in the models of all logs.
under this assumption the probability of firing tequals p summationtext i vi ti summationtext i vi ei .
in the tables the first variable which models if a transition was fired takes two values r success failure while the second variable which models the log index takes three values c .
we compute the test statistics x summationtext o e e. then we calculate the likelihood of obtaining the value of the test statistics or larger value p 2 x for 2 distribution with r c degree of freedom.
we refer to this value as thep value of the test.
if the p value is smaller than w e reject the null hypothesis and perform a set of z tests between the logs i.e.
the following pairs are compared t1 t2 t2 t3 t1 t3 for the same value and user defined dvalue.
as the number of differences found per transition by the pairwise comparisons may be large it is useful to aggregate the results of multiple hypotheses tests by grouping the logs.
intuitively a good grouping keeps logs with similar proportions together and separates logs with statistically different proportions.
such a grouping of log indices can be presented to the engineer to communicate the differences across logs.
we present a simple and efficient label grouping procedure.
log index grouping procedure .
first we order the logs by their proportions.
then we initialize a group of logs and add the logs to it until reaching a log that is statistically different for the chosen d from at least one of the other logs in the group.
when we reach such log we initialize a new group and repeat the process until all logs are processed.
theorem .
the procedure ensures that no statistically different logs appear in the same group.
finally we provide a high level description of snkdiff.
the snkdiff algorithm.
the algorithm starts by constructing the k difflfsm see def.
.
it enriches the states and transitions with the trace visit counters one per log.
then to find k d differences that are statistically significant it iterates over its transitions.
for each transition it gets the number of source state and transition visits ni v t q mi v t per log and conducts a 2 test.
if the test result is a p value lower than it continuous to perform a series of pairwise comparisons using the z tests.
if any of the z test is found significant it groups the log indices according to the log index grouping procedure.
then it highlights the transition and labelsit with the groups of log indices.
finally snkdiff returns the labeled k difflfsm along with a summary of the results of the statistical tests preformed per transition in a csv format .
theorem snkdiff soundness and completeness .letk be a positive integer d and let l1 l2 ... lnbenlogs compared using snkdiff.
denote the logs k pfsms by s k pfsm k pfsm ... kpfsmn .
then any reported k d difference corresponds to a statistically significant difference between a pair of models froms soundness and any k d difference between the models in sis reported completeness .
v. e v aluation we present an evaluation in three parts.
the first evaluates the effectiveness of s2kdiff and snkdiff in terms of soundness completeness and performance.
the second is a controlled user study.
the third is a case study using real world logs.
all logs models and implementation code we describe together with their documentation are available for inspection and reproduction from .
a. soundness and performance evaluation we conducted an evaluation of the effectiveness of s2kdiff and snkdiff guided by the following research questions rqa1 do the expected statistical guarantees hold in practice?
statistical soundness rqa2 are all differences reported?
statistical completeness rqa3 do the algorithms scale?
note that although we have theorems that state the soundness and completeness of s2kdiff and snkdiff we still need to evaluate the correctness of the application of the statistical tests i.e.
to observe that the empirical error rate we obtain is below the theoretical guarantee and that the power of the test increases with log size as expected.
this may not be the case e.g.
if the assumption that the log traces are i.i.d.
does not hold or if there are bugs in the implementation of the algorithms.
below we describe the corpus of models and logs we used the different measures the experiments and their results.
corpus of models and logs in the evaluation we used finite state automaton models taken from publicly available previously published works and reports .
the models varied in size and complexity the alphabet size ranged from to the number of states ranged from to and the number of transitions ranged from to .
to facilitate the evaluation we simplified the models by manually eliminating back loops and self loops.
this simplification is not required for our algorithms to work.
we use it to analytically calculate the seqktransition probabilities for use as ground truth.
to produce a log from a model we enriched the model with randomly selected transition probabilities and then created traces using a random trace generator.
the trace generator starts on the dedicated initial state and makes a series of authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
random transitions according to the transition probabilities until reaching the dedicated terminal state.
measures we define two key measures for a set of hypothesis tests the empirical statistical error rate and the empirical power of the test for both the z test and the 2test as follows.
we use the classical true false positive negative measures as summarized below.
z test z z p1 p2 d fn tn p1 p2 d tp fp 2 test 2 2 i j pi pj fn tn i j pi negationslash pj tp fp the error rate of a hypothesis test is defined w.r.t.
the cases in which the null hypothesis holds.
in the z test the null hypothesis holds when p1 p2 d and in the 2 test it holds when i j pi pj.
thus we define the empirical error rate of a series of statistical tests to be the proportion of rejected cases in which the null hypothesis held i.e.
z 2 fp tn fp .
the empirical error rate is expected to be less than the statistical error rate of the test .
the statistical power of a hypothesis test is defined with regards to the cases in which the alternative hypothesis holds.
thus we define the empirical power of a series of statistical tests to be the proportion of rejected cases in which the alternative hypothesis held i.e.
z 2 tp tp fn .
lastly we measure the absolute running times in seconds .
in measuring running times we included all steps from parsing the logs to computing the models running the differencing procedures and outputting the results.
we executed all experiments on an ordinary laptop computer intel i5 cpu .4ghz 8gb ram with windows bit os java .
.
bit.
we executed all runs times to average out measurement noise from the java execution.
s2kdiff experiments and results to answer the three research questions for s2kdiff we conducted the following experiment.
for fixed k d and for each model we produced two random logs of n traces and measured z z and the running time.
rqa1 rqa2 soundness and completeness.
we run s2kdiff with k d .
.
.
and .
.
we obtain z .05in all models i.e.
the the empirical error rate is below the theoretical guarantee as expected see .
we obtained zmedians of .
.
and .
and averages of .
.
and .
for n and resp.
as can be seen zincreases with the log size.
that is the larger the log the more differences the method is able to detect.
this phenomena is well known when conducting statistical tests.
rqa3 performance.
figure shows running times for k d .
.
n ... .
we report running times of k tails and s2kdiff.
we observe that both algorithms scale well and terminate within 1second over the largest logs.
we computed the slowdown of s2kdiff w.r.t.
k tails by dividing the running time of s2kdiff by that of k tails.
we00.
.
.
.
.
.
.
.
.
15000running time s tracesktails s2kdiff snkdiff fig.
the figure reports the average running times of ktails s2kdiff and snkdiff when running with k d .
.
n ... 6k over the 13models.
for snkdiff m .
obtained a median and an average slowdown of .
and .
resp.
we did not identify any relation between the slowdown and the log size n. importantly the running times increase linearly as the log size doubles with a median and an average increase of .
and24.
for k tails and .
and26.
for s2kdiff resp.
this occurs as the number of k sequences quickly converges to a constant.
as a result only the traces reading time is affected by the increase of the log size.
we have evidence showing that s2kdiff achieves the statistical guarantees of its underlying statistical test .
its power varies across models and increases dramatically with the log size.
it incurs an acceptable overhead.
snkdiff experiments and results to answer the three research questions for snkdiff we conducted the following experiment.
for fixed k d .
and .
for each model we produced mrandom logs for m each log of lengthn .
recall that snkdiff consists of a 2 test that is followed by a series of z tests.
the results of thez tests were consistent with the results of s2kdiff see .
we focus here on 2 2 and the running time.
rqa1 rqa2 soundness and completeness.
for fixed k d .
and .
for each model we produced four m random logs each log of length n and run snkdiff over the different models.
we observe that 2 in all of the experiments.
recall that the null hypothesis in the 2 test is that the proportions between the transitions are equal.
this was never the case as we randomly assigned the transition probabilities.
that is in no experiments all four logs had equal probabilities over corresponding transitions.
we observe that 2varies substantially across different models and increases with n. we did not observe any correlation w.r.t.m.
we obtained 2medians of .
.
and .
and averages of .
.
and .
for n and resp.
we repeated the same experiment for k andd .
.
and observed the same phenomenon.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rqa3 performance.
figure shows running times of snkdiff fork d .
.
m n ... .
similar to s2kdiff we observe that the algorithm scales and terminates within 1second over the largest logs.
we measured median and average slowdown of snkdiff w.r.t.
k tails of .
and11.
resp.
similar to k tails and s2kdiff the algorithm requires linear time w.r.t.
the log size.
the additional computation time required to apply the 2 test is negligible.
we run snkdiff for k d .
.
n m and observed linear increase in the running time across all models see .
to test this further we averaged the running time per m across all models and fit a linear line.
we obtained r2 .
.
this indicates that a linear line captures the relation between the number of logs and the running time.
we have evidence showing that snkdiff achieves the statistical guarantees of its underlying statistical tests 2 z .
its power w.r.t.
both tests 2 z varies across models and increases dramatically with the log size.
it incurs an acceptable overhead.
threats to v alidity the selection of models in our evaluation may not represent typical systems.
to mitigate we used publicly available models with non trivial size and complexity taken from previous works see sect.
v a1 .
yet we do not know to what extent these are representative of real world systems.
to generate logs from the models we used a publicly available trace generator .
it is possible that one may get different results if a different trace generator or a different coverage criterion is used.
b. controlled user study we conducted a controlled user study to investigate whether s2kdiff and snkdiff are useful to their potential users.
the study focuses on evaluating pertinent features of the algorithms and the research questions guiding it are rqb1 can using s2kdiff and snkdiff help participants more accurately identify behavioral differences between different versions of the same system?
rqb2 do s2kdiff and snkdiff shorten the time required for participants in identifying if and when a behavioral difference was introduced into a system?
experiment setup independent and dependent variables.
the purpose of the user study is to examine whether s2kdiff and snkdiff provide participants with support in finding statistically significant differences among logs better than some alternatives baselines while considering a number of different logs.
thus our experiment has two independent variables the tool used to find log differences the log set and two dependent variables correctness of the task solution i.e.
answers given by participants and completion time .
similar to our previous work we compared s2kdiff snkdiff against k tails as the baseline.
since the classical k tails model does not include the information required to preform the statistical comparisons we extend themodel with transition probabilities and with state transition trace visit counters see sect.
iv a .
we also allowed participants to use a text differencing tool .
we choose k tails due to its popularity and for consistency with the previous work .
direct comparison to 2kdiff nkdiff could not be done as these only account for existential differences.
we used four models cvs ordset smtpprotocol and zipoutstream see sect.
v a1 .
we chose these models as they include short and comprehensive alphabets and did not yield models that were too large for a human to interpret.
from each model we generated five logs as follows.
first we enriched the models with randomly generated transition probability distributions and copied them.
then to introduce at least a single k difference in the copied model we randomly selected a pair of transitions with an identical source and mutated their probabilities by subtracting .
from one and adding it to the other.
we validated that the mutation resulted in valid transition probabilities.
then we run the trace generator described in sect.
v a over both models and produced three logs from the original model and two from the mutated one.
all logs included traces.
participants and task assignments.
we invited graduate students with background in computer science from two universities.
all participants are senior students except one who is a first year postgraduate.
every participant is required to perform four tasks by analyzing four log sets.
for each task a participant needs to use a log differencing tool to perform it.
among four tasks two are required to use k tails and the other two are required to use s2kdiff snkdiff.
all participants were presented with the log sets in a similar order.
to avoid biases we designed the experiment such that each log was analyzed by each of the tools.
detailed procedure.
to complete a task participants are required to analyze a log set using a specified tool and eventually answer several questions through a web interface.
the following are the three questions that we asked participants for each task is there a sequence whose frequency in one log is more than .
higher than its frequency in another log and the difference is statistically significant?
please specify such a sequence and what is a pair of log ids whose corresponding logs exhibit such difference?
the participants attempt each of the four tasks one by one.
before starting the user study to instruct the participants in answering these questions and completing the tasks they are required to read a tutorial and watch videos explaining the two log differencing tools and how they can be used to complete the tasks using an example task.
note that if a participant answers no to the first question they will not be asked the subsequent questions.
our web interface recorded participants answers and the amount of time they used to complete each task.
results we report our user study results by answering the research questions mentioned earlier as follows.
rqb1 correctness .
after all participants completed the experiments we evaluated the correctness of the participant authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table ii percentage of participants who gave correct answers q1 q2 q3 k tails s2kdiff snkdiff k tails s2kdiff snkdiff k tails s2kdiff snkdiff cvs ordset smtppr otocol zipoutstr eam table iii average completion time results seconds k tails s2kdiff snkdiff k tails s2kdiff snkdiff cvs .
.
smtppr otocol .
.
ordset .
.
zipoutstr eam .
.
answers.
if a participant chose no option for the first question of a task the remaining two questions are labeled as incorrect.
table ii presents the percentage of participants who gave correct answers.
for question it is the percentage of participants who answered yes .
as shown in the table very few participants who use k tails can identify the difference among the log sets.
even though some of them answered yes for the first question they wrongly identified the sequence and the log pairs.
this is because the models generated by k tails are too complex with many transitions.
it is difficult for the participants to switch different browser windows to compare several models.
on the other hand most of the participants who use s2kdiff snkdiff gave the correct answers for question and .
only few participants did not answer the questions correctly we talked with them and found that they did not fully understand the tool as it is the first time they used it.
rqb2 completion time .
table iii presents the average completion time for each task using k tails and s2kdiff snkdiff.
the average completion time for tasks performed using s2kdiff snkdiff is lower than that of k tails.
we also performed wilcoxon signed rank test and found that the differences are all statistically significant at a confidence level of with a large effect size.
c. case study findyourhouse.com from ghezzi et al.
we conducted a case study in order to answer the following research question rqc what kind of insights about the evolution of a system over time and about differences of its usage patterns can one learn by using our tools?
we used a log from the real world application findyourhouse.com presented by ghezzi et al.
.
to parse the log we followed the description of the authors and the regular expressions included in the paper.
in this log each trace includes the pages visited in a single user session.
the log represents data collected over a year of operation with real users.
the alphabet size unique web pages is .
the total number of events is .
the results and figures of the usage scenarios below are provided in .
changes in behavior over time we used the session date to split the original log into disjoint logs each consisting of sessions from one quarter consecutive months .
the logs contained traces resp.
the average trace length is .
.
we then run snkdiff on the logs with k d .
and .
.
executing snkdiff took .01seconds.
out of 335transitions snkdiff reported to have statistically significant difference between at least logs.
we focused on the sales search module and specifically on its first four result pages.
we selected this module because it is the main module of the application it was heavily used by its users and it was analyzed by ghezzi et al.
.
from the snkdiff output when considering the statistically significant transitions we observed the following phenomenon as time progresses from one quarter to the next users are more likely to end their session on earlier search result pages.
this may indicate a possible improvement in the quality of the sales search results a change in the order of the search results or any other change we were unable to contact the original owners of the data for comments on these findings .
as evidence snkdiff found a statistically significant difference in the transition probabilities from the first search page to the second where pq1 .
pq2 .
pq3 .
pq4 .
in quarters 1to4resp.
further the transition probabilities of terminating the session after the first search page were .
.
.
and30.
in quarters 1to4 resp.
and were also statistically different.
note that since all transitions have been observed at least once in each of the logs the algorithms of could not reveal this phenomenon.
also note that the analysis by ghezzi et al.
which presented this log deals with transition frequencies but not with their differences and not with statistical significance.
thus it too could not reveal this phenomenon.
desktop vs. mobile users usage preference we used the user s browser and operating system as documented in the log to separate traces of desktop and mobile users and thus produced two logs of and traces resp.
ignoring traces from bots .
the events alphabet size for the desktop and the mobile logs were and resp.
average trace length was .
and .
resp.
for s2kdiff below we used k d .
and .
.
executing s2kdiff took .
seconds.
out of transitions s2kdiff reported k d differences.
interestingly the mobile users show higher probability of transitioning out of the application in comparison to the desktop users in 6out of the 13common web pages homepage sales anncs renting anncs renting page contacts news article .
for example exiting through the homepage had a transition probability of .
and39.
in desktop and mobile users resp.
the trace selected for the mobile users included a single visit to the homepage .
indeed out of all mobile traces this trace appeared times.
these results are also consistent with the lower number of webpage visits per trace in the mobile log.
this demonstrates how s2kdiff reveals significant differences between the behaviors of desktop and mobile website users which could not be revealed using previous methods.
vi.
d iscussions implications and broader context.
s2kdiff and snkdiff are not meant to replace prior log differencing tools e.g.
our own 2kdiff and nkdiff .
rather they complement the prior work for use cases where differences in frequencies are meaningful.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a use case where the capabilities of the new tools are needed is highlighted in section v c. in that case study s2kdiff and snkdiff have been employed to uncover insights about the evolution of a system over time and about differences of its usage patterns.
2kdiff and nkdiff are unable to uncover such insights as they do not analyze differences in frequencies.
another potential application of log differencing is in the area of malware analysis log differencing can be applied to compare logs of clean and infected apps to identify malicious activities.
the power of s2kdiff and snkdiff to consider differences in frequencies will be beneficial to uncover hidden malicious behaviors that are masqueraded as valid ones e.g.
.
dealing with unstructured logs.
our work like most related work on model inference from logs requires structured logs as input.
in practice many logs are unstructured.
fortunately past studies have proposed preprocessing methods to convert unstructured to structured logs e.g.
.
those methods may be employed to allow our approach to work for unstructured logs.
configuring s2kdiff and snkdiff.
our tools take as input a structured log and parameters k andd.
the choice of the significance level is clear as it is considered a standard many past studies use .
or .
as significance levels for their statistical tests.
the choice of k the parameter for the k tails algorithm is also clear past studies often set the value of kto be or indeed any use of k tails requires the engineer to choose a value for k. the actual parameter whose setting is to be determined is d which ranges between and .
to set this parameter engineers can start with a high value of d close to and gradually decrease it until differences are uncovered.
if more differences are desired the value of dcan be decreased further.
the same strategy is often employed by users of rule based or scenario based specification mining tools e.g.
who need to configure several parameters e.g.
support and confidence.
vii.
r elated work many works suggest means to infer models from logs.
the works differ in the kinds of input logs and output models.
a number of them mined specifications in the form of fsm from a set of logs.
for example beschastnikh et al.
proposed synoptic which infers three kinds of temporal invariants from logs and uses them to refine an inferred fsm .
le et al.
proposed specforge which forges a new fsm from fsms mined by other solutions through model fission and fusion operations .
more recently le and lo proposed dsm that uses the power of a deep learning engine i.e.
long short term memory network to learn fsms from logs .
different from the aforementioned works in this work we focus on producing an fsm capturing differences between two logs s2kdiff and between many logs at once snkdiff.
in an experience report on log based behavioral differencing goldstein et al.
focused on visualizing anomalies.
given two logs they use k tails to build a model for each log and then compare the two models.
their models are enriched withquantitative data but their analysis does not involve statistical guarantees.
their work is limited to comparing two logs while our snkdiff algorithm compares many logs at once.
wang et al.
compared sets of inferred temporal invariants as one of several approaches to examine whether tests are representative of field behavior.
the work does not consider the statistical significance of the differences it finds.
comparing lab and field logs is one potential application of our work.
most related is our recent work which presented 2kdiff and nkdiff.
as we discussed earlier here we extend these algorithms fundamentally.
specifically unlike our present work accounts for the frequencies of behaviors in the logs and provides statistical guarantees about the differences it finds.
in sect.
iv c we presented a procedure for grouping log labels.
scott and knott proposed the scott knott algorithm a clustering based approach which compares multiple variables and breaks them into homogeneous groups i.e.
groups with statistically distinct means.
similarly tantithamthavorn et al.
proposed the scott knott effect size difference test which also accounts for the difference between the means of the groups by incorporating the effect size measure.
in contrast our underlying hypothesis test is different as it also accounts for the distance between the proportions.
further to avoid clutter and emphasize the differences we only include labels of logs that appear statistically different from at least one of the other logs.
viii.
c onclusion and future work we presented statistical log differencing as a means to compute and present differences between two or more execution logs taking into account the frequencies of the behaviors in the logs and reporting only and all statistically significant differences.
our evaluation shows the effectiveness of our work in terms of soundness completeness and performance.
it demonstrates effectiveness using a controlled user study and potential applications via a case study using real world logs.
we consider the following future work.
first for additional statistical confidence and scalability over logs of unbounded length one may consider adapting the approach of our previous work on model inference with statistical guarantees to add another statistical dimension i.e.
allowing engineers to set a required confidence level and then sample from the logs at hand until reaching statistical guarantees about the confidence in the result where the probability of additional sampling to reveal new significant differences is smaller than a required threshold .
second additional case studies to evaluate the use of statistical log differencing in practice and the kinds of insights one can learn from its application.
we specifically consider applications in test generation and execution.