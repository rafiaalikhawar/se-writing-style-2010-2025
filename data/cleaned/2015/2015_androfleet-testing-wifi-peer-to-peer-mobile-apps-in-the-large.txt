androfleet testing wifi peer to peer mobile apps in the large lakhdar meftah maria gomez romain rouvoy and isabelle chrisment inria university of lille france saarland university germany university of lille inria institut universitaire de france france telecom nancy inria france abstract wifi p2p allows mobile apps to connect to each other via wifi without an intermediate access point.
this communication mode is widely used by mobile apps to support interactions with one or more devices simultaneously.
however testing such p2p apps remains a challenge for app developers asi existing testing frameworks lack support for wifi p2p and ii wifi p2p testing fails to scale when considering a deploymenton more than two devices.
in this paper we therefore propose an acceptance testing framework named a ndrofleet to automate testing of wifi p2p mobile apps at scale.
beyond the capability of test ing point to point interactions under various conditions a ndrofleet supports the deployment and the emulation of a fleet of mobile devices as part of an alpha testing phase in order toassess the robustness of a wifi p2p app once deployed in the field.
to validate a ndrofleet we demonstrate the detection of failing black box acceptance tests for wifi p2p apps andwe capture the conditions under which such a mobile app can correctly work in the field.
the demo video of a ndrofleet is made available from ed7xl04.
i. i ntroduction mobile apps have brought the capability to deploy contextaware software systems that go beyond desktop software by adjusting their behavior to end users surrounding environ ment.
in particular wifi peer to peer wifi p2p also known as wifi direct enables mobile devices to discover connect and transfer data to nearby devices via wifi without anintermediate access point as long as they comply with the wifialliance s wifi direct certification .
this communication mode is now widely adopted by mobile apps with more than billion of wi fi direct enabled devices in and billionsexpected by 1some popular examples of wifi p2p apps are multiplayer games messaging and social apps.
however testing wifi p2p apps remains a challenge for app developers because current testing solutions lack support for the distributed nature of wifi p2p interactions.in addition current device emulators lack of an implementation for wifi p2p communication stacks thus developersare forced to use physical devices to test their wifi p2pmobile apps.
testing scenarios typically involve more thantwo mobile devices thus it is hard to scale to hundreds of mobile devices.
furthermore reproducing behaviors becomes provide convenient high speed network services direct to customersparticularly difficult when evaluating stability data integrity peer failure and fault tolerance .
developers then resort to alternative solutions to assess the expected behavior of their wifi p2p mobile apps.
forexample log based testing instruments apps and mines execution logs to detect unexpected behaviors.
given the po tentially large number of mobile devices involved in wifi p2pscenarios log based testing becomes unfeasible for developerswho need to manually explore logs and assess a distributedbehavior.
as existing automated testing methods are falling short on solutions to test wifi p2p at large we introduce a ndrofleet an acceptance testing framework for wifi p2p android apps.
a ndrofleet contributes the following features a ndrofleet builds on a standard acceptance testing framework i.e.
cucumber2 to provide new primitives for describing contextual and distributed scenarios a ndrofleet implements an emulated wifi p2p communication stack to control the p2p interactions of mobile apps through emulated devices finally a ndrofleet provides a large scale deployment platform that can be used to assess the robustness of a wifi p2p app prior to its deployment in thefield along an alpha testing phase.
this feature collectsinsightful metrics on the execution and behavior ofwifi p2p apps.
a ndrofleet is open source and publicly available https github.com m3ftah androfleet.
the remainder of this paper is organized as follows.
section ii describes the a ndrofleet testing framework.
section iii details the implementation of the different parts thatcompose the a ndrofleet framework.
section iv reports on a case study that illustrates how a ndrofleet supports developers to automate the testing of wifi p2p apps.
section vidiscusses the related work in this domain.
finally section vii concludes the paper.
ii.
t esting peer to peer mobile apps in this section we present the a ndrofleet framework to test wifi p2p android apps.
.
c circlecopyrt2017 ieeease urbana champaign il usa t ool demonstrations961 authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
similar to any type of software system developers need to ensure the correct behavior e.g.
absence of bugs and unexpected behavior of wifi p2p apps before deployment.
the conception of peer to peer applications is complex as thecommunication scenarios between peers need to be specifiedand tested.
to test such scenarios there is therefore a need fora runtime environment which is representative of a productiondeployment.
the goal of a ndrofleet is to automate wifi p2p user acceptance testing.a ndrofleet enables developers to create and execute common wifi p2p test scenarios.
in particular the framework provides two main features a dsl domain specific language to describe wifi p2p testing scenarios such as peer discovery andpeer interactions a large scale emulation platform that supports parallel testing on multiple devices as well as the wifi p2p communications among them.
a. describing test scenarios to describe testing scenarios a ndrofleet provides a dsl to developers.
previous research have extended calabashframework 3to add some context based testing .
a ndrofleet adopts a similar approach by extending calabash to introduce a wifi p2p specific vocabulary.
we chose calabash because it is multi platform and delivers a rich and extensiblesyntax based on cucumber.
figure depicts the different a ndrofleet testing directives that can be used to describe typical communication scenarios among peers in wifi p2p apps.
in p2p systems different unexpected context events can happen such as peer discovery peer not in range or connection lost.
however some of these events can lead to failures ofapps.
a ndrofleet lets developers simulate these contextual events that can emerge along an execution.
listing describesan example of a test scenario created with a ndrofleet t o simulate p2p unexpected contextual events.
listing .
a ndrofleet testing directives to manage wifi p2p scenarios switch the device wifi p2p state switch the device wifi p2p permission switch the device wifi p2p statesend the available peer list has changed action change the device wifi p2p namechange the device wifi p2p ip address change the device wifi p2p role as group owner send the device wifi p2p connection lost action get the device wifi p2p state b. peer discovery figure cf.
top right rectangle shows an example of a testing scenario created with the a ndrofleet dsl.
this scenario tests the sharing of a file between two nodes from 3calabash is a user acceptance testing framework glvfryhu v l il luhfw dfwlydwhg vn xvhu wr dfwlydwh l il luhfw 1r lil3 30dqdjhu glvfryhu3hhuv hv v l il luhfw dfwlydwhg hv 1r dloxuh 0hvvdjh1r shhu irxqg 0hvvdjh 6krz shhuv lvw hv 1r v wkhuh d shhu glvfryhuhg 8vhu vhohfw shhu wr frqqhfw wr v shhu lq udqjh 3hhu qrw lq udqjh 0hvvdjh 1r hv 3huplvvlrq ghqlhg 0hvvdjh v hv 1r rhv wkh ss kdyh wkh shuplvvlrq 3hhu grhvq w dffhsw shhulqj 0hvvdjh hv 3hhu ffhsw rqqhfwlrq 1r rqqhfwlrq lqlwldwhg hv 6rph ss vshflilf fwlrqv rqqhfwlrq orvw 0hvvdjh rqqhfwlrq orvw gxulqj 1r hv 6xffhvv 0hvvdjh v l il luhfw vxssruwhg huplvvlrq l il luhfw qrw vxssruwhg 0hvvdjh 1r hv fig.
.
example of a communication scenario with wifi direct node tonode in a wifi p2p file sharing app.
first the developer has to specify the running conditions of the scenario using the peer discovery.feature file these conditions include number of participant nodes i.e.
emulators example given the list of devices a b c discovery configuration example given devices a b are in range for 5s apps installed on each node example myapp.apk is installed on all devices later for each single node the developer specifies the behavior to test.
figure cf.
bottom rectangles shows two examples of test scenarios in two nodes for the file sharingapp.
discovery extension to calabash the apps asking for the list of nearby peers from the wifi p2p hardware component will get this list from the p eerdiscovery .
the list of available peers is configured using thepeer discovery.feature file.
opportunistic peer discovery some of the wifi direct apps emergency apps use wifi direct to create a commu nication infrastructure authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
1rgh l l luhfw 1rgh l l luhfw rvw 0dfklqhfdodedvk dqgurlg1rgh ihdwxuhv dge1rgh ihdwxuhv 1rgh ihdwxuhv 3hhu lvfryhu hdyh 1hwzrun 1rgh l l luhfw qgurlg pxodwru qgurlg pxodwru qgurlg pxodwru lyhq dp orjjhg lq khq dfwlydwh l il luhfw khq vhohfw ghylfh lq olvw ri ghylfhv 7khq suhvv rqqhfw 7khq zdlw wr vhh 36hqg d iloh 7khq vhohfw 3whvw sqj 7khq suhvv 36hqg 7khq zdlw wr vhh loh 7udqvihu rpsohwh lyhq dp orjjhg lq khq dfwlydwh l il luhfw 7khq zdlw wr vhh rqqhfwlrq surpsw 7khq suhvv rqqhfw 7khq zdlw wr vhh loh surpsw 7khq suhvv ffhsw 7khq zdlw wr vhh loh 7udqvihu rpsohwh 6fhqdulr hylfh dsn ss dsn lyhq ghylfhv lq udqjh iru v 6fhqdulr hylfh dsn ss dsn dwdvhwbsdwk 6dqb udqvlvfr fvy shhubglvfryhu ihdwxuh qrgh ihdwxuh qrgh ihdwxuh fig.
.
overview of the a ndrofleet framework .
to prove the ability to support a communication infrastructure based on wifi direct developers have tobe able to use multiple gps datasets that will help the peer discovery to emulate real life nearby peers.
therefore the developers can validate the scalability and the efficiency of the opportunistic communications for these communicationsinfrastructures.
c. running test scenarios to run the specified test scenarios the developer has to provide i test script scenarios for each single node ii device profiles e.g.
os version hardware specification to test the app and iii peer discovery.features as explained in section ii b. the scenarios are executed in parallel in multiple devices using calabash android.
after the execution of the scenarios the developer can gather the test results and improve theapp accordingly and test all the scenarios again using a ndrofleet .
iii.
i mplementation details the a ndrofleet testing framework implements an extension of the calabash testing framework to create testscenarios and execute them.
a ndrofleet is released as a gradle plugin which developers can add to run the testsinside android studio ide.
the a ndrofleet gradle plugin executes the calabash tests in parallel in multiple devices and collects the test results from all devices.
a ndrofleet contains three parts device emulator nodes apeer discovery node and a host machine.w e describe the implementation of these three parts respectively.
device nodes.a ndrofleet uses docker containers to deploy android emulator nodes.
we use the docker technology to provide a lightweight and scalable testing environment.the different nodes communicate among them via weave network.
peer discovery.
the peer discovery node is responsible for emulating wifi direct behavior in the android emulator nodesand notify them about nearby devices.
the communications between device emulator nodes and the peer discovery node is achieved using the akka framework which supports large scale deployment.
in addition the peer discovery node can use a gps mobility dataset to compute the distancesbetween devices and inform the devices when they are in range.
host machine.
finally developers use a host machine to define and run testing scenarios.
the android emulators connect to the developer s machine via adb android debugbridge .
peer to peer mobile apps are complex in nature since they are based on a distributed environment.
thus many aspects ofthe system need to be verified to ensure the correct behaviorof the system under multiple circumstances peer fails peerrefuses connexion peer disappears etc.
.
a ndrofleet implements an emulated version of the android wifi p2p api that can be deployed within an emulator e.g.
genymotion and controlled by the testing environment e.g.
calabash to simulate the discovery of a nearby device and assess the user acceptance testing scenarios.
iv .
c ase study in this section we present a case study to illustrate how androfleet assists developers to automate the testing of wifi p2p android apps.
as application under test aut we use wi fi di re c t an open source app to transfer files authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table i testing scenarios for the wifidirect app scenario expected behavior pass?
a simple image transferring scenario image is transferred yes transferring the image from the group owner image is transferred no deactivating wifi p2p before transfer ask user to switch on wifi p2p yes selecting a file instead of image open as dialog appears yes sending a second file in the same connection the file is sent no disconnect the second peer before starting the file transfer ask user to switch on wifi p2p no connecting to peer without launching discover request on it the file is sent yes between android devices using wifi direct connection.
the aut has more than 000installs on the google play store and its source code is available7.
first of all the developer needs to set up a ndrofleet in the development ide i.e.
android studio .
to do this s he uses the provided gradle p lugin which automatically mocks the android wifi p2p api used in the app.
table i presents relevant testing scenarios for the aut.
the developer describes the scenarios using the a ndrofleet framework.
figure shows the description of scenario a simple image transferring from one device to another.
in particular listing 3a presents the sending scenario in onedevice while 3b displays the receiving scenario in a different device.
next the developer runs the scenarios in the a ndrofleet emulators.
after execution a ndrofleet presents the testing results i.e.
passing and failing tests.
figure shows a screenshot of the testing results of the described case study.
the screen displays the set of tests executed.
green and readcolors mean passing and failing scenarios respectively.
in theexample scenario passed while scenario failed.
each scenario shows the sequential actions that were executed.
ifan action fails a ndrofleet shows error information and the reason of the failure.
for example in scenario theaction then i should see connecting to fails.
the reminder actions of the test are printed in blue meaning that they were not executed since the test execution failed before.after analyzing the testing results the developer can fix theapp and re run the tests until all scenarios successfully pass.
v. d iscussion although the general idea of emulating hardware capabilities e.g.
gps sensors for testing is not new the novelty of androfleet resides in providing an emulated wifi direct environment for testing.
given the increasing popularity ofp2p mobile apps this feature is crucial because none of currenttesting frameworks support wifi p2p.
a ndrofleet reports the following advantages to the mobile development and testing communities extend the capability of an android testing framework to enable the control of peer to peer interactions among mobile apps via wifi direct.
provide enriched vocabulary for testing mobile apps using wifi direct.
automate parallel testing on multiple emulated devices as well as wifi direct communications among them.
reproduce behaviors on failing test scenarios to help developers to fix the apps.
androfleet is specially practical for developers who lack access to a farm of real devices to test.
but even when a crowdof real devices is available current testing frameworks lack primitives to assess distributed behavior.
vi.
r elated work we summarize related work in the main research areas connected to this research testing mobile apps and testing peerto peer systems.a ndrofleet aims to fill the gap between these two areas.
a. testing mobile apps mendez porras et.
al.
presented a systematic literature review on existing testing approaches for mobile apps.
first there is a bunch of approaches providing gui testing of mobile apps.
similar to theseapproaches a ndrofleet also supports gui testing.
while the goal of previous approaches is to provide explorationstrategies to maximize test coverage a ndrofleet provides additional primitives for testing properties specific to peer topeer systems e.g.
connections data interchange .
another family of approaches have proposed cloud based frameworks to test mobile apps .
a ndrofleet also provides a cloud based framework.
in addition a ndrofleet provides multiple emulators which can interact among them in order to test the behavior of a p2p system as a whole.
androfleet provides black box testing to test wifi p2p apps without requiring access to the source code.
previousapproaches propose also automatic black boxtesting of mobile apps.
similar to a ndrofleet other approaches have extended the calabash framework to support the testing of additional features such as touch gestures and sensors i.e.
accelerometer gps etc.
.
similarly a ndrofleet extends calabash with a different purpose to support testing of peerto peer communications.
despite the prolific research in this area current testing frameworks for mobile apps lack support for peer to peerinteractions.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
feature file sharing feature scenario simple image sharing sending given i activate wifi direct given i wait up to seconds for available to appear given i don t see the text disconnect when i take an image then i press the menu keythen i press the text view discover then i should see finding peers then i wait up to seconds for n192168492 to appear then i wait up to seconds for choose file to appear then i press the choose file button then i take a screenshot then i tap in then i tap in a scenario send image file node feature file sharing feature scenario simple image sharing receiving given i activate wifi directgiven i wait up to seconds for available to appear given i don t see the text disconnect when i take a screenshot then i press the menu key then i press the text view discover when i should see finding peers then i wait up to seconds for n192168491 to appear then i touch the n192168491 text then i wait for the connect button to appear then i press the connect button then i should see connecting to then i wait for seconds then i take a screenshot b scenario receive image file node fig.
.
description of sharing file scenario in the aut fig.
.
testing results screenshotb.
testing of peer to peer systems almeida et al.
present a framework and a methodology for testing p2p applications.
the framework is based on controlling nodes individually allowing test cases to preciselycontrol the volatility of nodes during their execution.
similarly a ndrofleet gives developers the ability to control the volatility of nodes during the execution of test scenarios.
zhou et al.
propose a framework to test peer to peer multi player games.
in the authors propose a model based testing for large scale distributed systems and peer to peer communications.
charaf et al.
propose an agentbased architecture for distributed system testing.
marroquin et al.
propose a testing approach based on test cases dependencies for communications protocols.
later the same authors extend their approach to test distributed systems withtest cases dependency architecture.
butnaru et al.
propose a tool for measuring peer to peer platform performance using log messages to get feedback fromdifferent peers.
boldman et al.
explain in a patent a system and methods for testing peer to peer network application byorchestrating unit testing between peers.
gorodetsky et al.
propose peer to peer emulation environment for testing mobilep2p agent applications.
although testing p2p systems has been extensively studied by the research community the testing of mobile p2p appsremains unexplored.
vii.
c onclusion this paper presents a ndrofleet an acceptance testing framework to automate the testing of wifi p2p androidapps.
a ndrofleet provides a large scale emulation platform which supports p2p interactions.
a ndrofleet enables the description of wifi p2p testing scenarios such as peer discov ery and point to point interactions as well as the executionof such tests in a crowd of emulated devices.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.