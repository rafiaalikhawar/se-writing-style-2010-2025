model driven design of heterogeneous synchronous embedded systems huafeng zhang2 yu jiang1 han liu2 hehua zhang2 ming gu2 jiaguang sun2 department of computer science university of illinois at urbana champaign illinois usa.
school of software tsinghua university tnlist kliss beijing china2 abstract synchronous embedded systems are becoming more and more complicated and are usually implemented with integrated hardware software solutions.
this implementation manner brings new challenges to the traditional model driven design environments such as scade and statemate that supports pure hardware or software design.
in this paper we propose a co design tool tsmart edola to facilitate the system developers and automatically generate the executable vhdl code and c code from the formal veri ed syncblock computation model.
syncblock is a lightweight high level system speci cation model with well de ned syntax simulation and formal semantics.
based on which the graphical model editor graphical simulator verication translator and code generator are implemented and seamlessly integrated into the tsmart edola .
for evaluation we apply tsmart edola to the design of a real world train controller based on the international standard iec .
several critical ambiguousness or bugs in the standard are detected during formal veri cation of the constructed system model.
furthermore the generated vhdl code and c code of tsmart edola outperform that of the state of the art tools in terms of synthesized gate array resource consumption and binary code size.
the abstract demo video address is the tool user manual and examples can be downloaded ccs concepts software and its engineering !model driven software engineering keywords model driven development computation model hardwaresoftware co design1.
introduction with the increasing complexity of safety critical applications such as aerospace transportation areas etc.
mixed hardware software solutions are increasingly adopted.
such systems are commonly component based where some components are implemented in hardware to ensure determinacy and stability while others without strict timing and performance constraints are usually implemented in software to save computation resource.
this implementation pattern leads to an increasing heterogeneity of the nal system which challenges the traditional model driven design mdd environment for example scade does not support partitioning and hardware synthesis simulink does not support partition and temporal properties veri cation and the semantics of their underlying computation models are complex and not easy for engineers to handle.
.
main challenge more speci cally the rst challenge is that how to capture the heterogeneous behavior of both hardware and software modules in a uni ed co design model especially for timing consistency.
the behavior of hardware module for synchronous applications is usually controlled by a hardware clock with a strict cycle while the timing of software module usually depends on the size and complexity of the code.
the second challenge is that how to ensure the correctness of the co design model through a complete validation for the static and temporal properties.
the last challenge is that how to overcome the gap between the complex co design model and low level mixed hardware software parallel implementation on a dedicated hardware platform.
proposed toolkit to address the above challenges we implement tsmart edola to assist the co design of complex safety critical synchronous systems which embodies a mixed hardware software solution.
as presented in figure tsmartedola is built on the formal computation model syncblock .
first a graphical model editor based on the syntax of syncblock is provided to support high level modeling of hierarchical system decomposition and concurrent synchronous behavior of both hardware and software components.
second a graphical simulator based on the executive semantics of syncblock is provided to support the interactive graphical simulations of the model under development.
third a veri er translator is provided to translate the selected graphical model to a synchronized labeled transition system that can be formally veri ed directly by tool beagle to get the provably exhaustive.
fourth a code generator is provided to generate vhdl code for the components partitioned into hardware implementation and c code for software implementation.
because the timing inpermission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
ase september singapore singapore c acm.
... .
graphical model editorsimulator verifiercode generator functional requirementsmodel vhdl and c codes model of computation syncblock syntax semantics functional requirements semantics interpretation model transformation synthesis mechanism model constructionvhdl codec code graphical model editor graphical simulator verifier translator code generator mixed hardware software solutionfigure tsmart edola design toolkit builded on syncblock computation model.
it consists of four components graphical model editor graphical simulator veri er translator and code generator.
terval for the behavior of software modules usually depends on the complexity of statements and the speed of processor the code generator needs to generate a scheduling mechanism to keep the timing consistency and synchronization among di erent software and hardware modules which are executed in parallel and independent with each other.
with the support of tsmart edola we are able to shorten the development cycle to build and validate a syncblock model at high level compared to the traditional practice which involves implementing the sketch like design in lowlevel programming languages as c and vhdl.
in addition the graphical model validation through simulation and enhanced formal veri cation opens a user friendly interface for us to uncover design defects at the early development stage.
once we have veri ed safety critical properties over the system model and iteratively improved the design details executable code can be directly generated in c software and vhdl hardware .
the synthesized implementation is compact and has a smaller size than the results of some other vhdl and c code generators.
for example when we apply it to a multifunction vehicle bus control system design given a function that can be modeled by both syncblock and state ow with almost the same number of states and transitions the size of generated vhdl code and c code is reduced by up to and respectively compared to simulink code generators of state ow.
gate array consumption of vhdl synthesis and binary code of c compilation are also smaller by and respectively.
furthermore several safety critical bugs in the standard iec are detected during the model validation of tsmart edola .
contribution main contributions are summarized as we have implemented tsmart edola to support the lightweight formal computation model syncblock to tackle the complexity of the heterogeneous embedded system design where graphical model construction simulation veri cation and e ective partitioning and modularized resource saving code generation are implemented.
we have applied it to a real system design where developers successfully found critical bugs of the iec standard during the model validation and deployed the synthesized system in operation of real subway control.
we have made it publicity free which may motivate scienti c community to use it to work on more real model driven design practice.
paper organization related work is presented in section .
some backgrounds on the formal computation modelsyncblock is presented in section .
section brie y introduces the tool implementation and integration of tsmartedola .
experiment results on the model driven design of a real train control system adopting the mixed softwarehardware solution are presented in section and we conclude in section .
.
related work model driven embedded system design there are large amounts of work and various toolkits in the industry and academia supporting the design of general synchronous reactive embedded software systems.
for example statemate supports statechart which is good for control logic description but the support of the data ow and structure description is limited .
scade uses safety state machine ssm as the formal basis and has been successfully applied in a variety of applications.
while mainly focusing on embedded software scade currently has little support for the synthesis of hardware.
simulink is now widely used with state ow as its basis .
it presents strong modeling simulation and synthesis capability but has no formal semantics for comprehensive veri cation on safety critical applications even with support of design veri er .
except for the three famous industrial frameworks above there are some tools for academia interests.
for example forsyde is implemented on a haskell based domain speci c language served as high level modeling and re nement of digital systems .
polis supports cfsm and uses esterel as the speci cation language for simulation and synthesis .
although it supports the co design of hardwaresoftware the model must be translated and use another separate tool ptolemy for simulation .
others such as galsblock and ddfchart focus on the applications with both synchronous and asynchronous modules implemented in pure hardware .
main di erence of tsmart edola most of the above tools can generate either c or vhdl code for the whole model but few allows to con gure some subsystems to be implemented in c and others in vhdl such as scade and statemate.
modular code generation is highly demanded by engineers.
to guarantee the correctness of such con gurable co synthesis synchronization among the parallel software and hardware modules is supposed to be fed with special scheduling mechanism which is seldom implemented.
tools such as polis and simulink address the modeling and co synthesis problem but the veri cation support needs to be increased with the increasing complexity and number of safety requirements of the system.
our lightweight semantics and modeling elements results in a easier understanding 775mf freemf ask mf out mf enablemf fin send startmf addrmf read mf emptymf initbp startbp nummf ack mf from srammf requestmf initbp nummf ack bp start pool write write addrbp init mf initwrite edge write addr read addrbp init data indata out mf num bp start mfmf init mf pool emptymf request bp start mfin data in mf num read addrmf enable send startmf outmf fin mf pool rammf generator ctrl mf pool ram ctrlmf addrmf readmf ask mf free mf addrmf readpool write mf ask mf freewrite addr bp initmf init bp num mf ack bp start s0 t1 counter s2s1 t2 mf ask var counter var counter clrs3 t3 s4 t5 counter clr t4 mf read mf addr bp num counter write addr counter pool write s5 t5 t5 counter bp init mf free s0 t1 if counter clr counter else counter fi figure a visual example of syncblock parallel computation model including the compound block atom block input data port output data port data ow connection parallel automata local variable and transition.
and increases the veri cation and synthesis ability which makes the life of engineers easier.
in summary tsmartedola is not a subset of scade and simulink it increases the veri cation and synthesis ability of them with the cost of reducing the complex seldomly used features and semantics of the underlying computation model.
notice that even if we just use a subset of elements in ssm and state ow for modeling the synthesis and veri cation ability of the constructed model in the scade and simulink will not be increased.
.
background on syncblock insyncblock computation model a system is speci ed as a combination of compound and atom blocks communicating through point to point channels.
the compound block does not directly conduct computation.
instead it presents the hierarchical decomposition of general component structure and data ow path among them.
the atom block is re ned as parallel automata to capture the component behaviors and detail computations.
we illustrate main features of syncblock with a graphical example in tsmart edola as presented in fig.
.
this module accomplishes the function of master frame generation and sending logic.
at the outermost level compound block mfgenerator is re ned as three sub blocks atom block mfpoolram mfgenerator ctrlandmfpoolramctrl .
theses atom blocks cooperate to generate the master frame to be sent in the train communication network.
the dots attached on the right side of each block are used to denote the output data port while the dots on the left side are used to denote the input data port.
communications among these blocks are realized through the data port connections.
the arrow on the connection indicates the signal ow direction of data exchange and the expression of the connection facilitates the data oriented behavior modeling.
the input data port of the compound block can be connected to the input data port of the re ned atom blocks e.g.
bpstart!bpstart .
the output data port can be connected to the input data port of other blocks e.g.
poolwrite!write edge and the output data port of high level blocks e.g.
send start!send start .
atom block mfpoolramctrl is re ned by two parallel automata with two local shared variables counter and counter clr.
the transition between two states consists of three parts name guard and action.
all statements are dened on the updates of data ports and local variables and all statements of an action aiattached on a transition are exe cuted in parallel.
automata contained in an atom block abi is also executed in parallel and independent of each other but there still might be con icts on read write operations e.g.
counter .
each local variable and output data port can be written by one automaton and the read operation is prior to the write operation.
all atom blocks contained in the model are also executed in parallel.
the complete rules and de nitions can be referred to the manual .
.
tool implementation tsmart edola is implemented on eclipse rich client platform with eclipse graphical editing framework for lines of java code where lines are inherited from tsmart galsblock used for pure hardware design.
the visual interfaces of most model driven design environment are similar but their kernel implementations for simulation veri cation and code generation are di erent because their underlying computation models are totally di erent.
overall structure of tsmart edola is presented in figure .
graphical model editor.
graphical model editor is based on the model construction rules presented in and supports graphical modeling of hierarchical system decomposition point to point channel communication and concurrent synchronous behavior.
it facilitates to capture system requirements and functional descriptions visually via thesyncblock model of figure and the main interface is introduced in figure .
editor for structure and behavior modelelement for compound and atom block contents in thisblock error informationcontents in this projectstructure interface of system decomposition modelled as compound block blocks containedin thelibrarytool bar for model construction simulation verification translation and code generation figure the overall interface of the implemented tsmart edola toolkit.
776the interface shows how to construct the hierarchical structure and data connections among system components.
it contains six views.
the toolbar allows us to create simulate partition verify and synthesize code from the selected blocks in the editor view.
the package explorer shows the projects in the workbench and the models contained in the current project.
the editor view shows the diagram of a selected model and allows us to edit it by adding removing elements.
the palette provides the elements data ports connection idle atom block idle compound block that can be dragged and dropped in the model shown by the editor.
the palette provides a reusable and common system component models library that can be dragged into the editor.
the element explorer shows the contents contained in the block of the selected atom or compound block in the editor view.
the properties view allows us to view and edit the properties of the element selected in the editor view and some error information presentation.
a similar interface to de ne component behaviors is also designed.
when the engineer selects an atom block in the editor view of the structure interface described above clicks it twice then the interface will be opened.
it provides similar views of figure except two di erences.
instead of the elements data ports connection idle atom block idle compound block for structure construction the palette view provides the elements data ports variables transition states that can be dragged to construct parallel automata in the editor view.
the properties view allows us to view and edit the properties of an element especially for the complex actions and priorities attached on each transition.
graphical simulator.
graphical simulator is based on the model interpretation algorithm of syncblock presented in and supports the interactive graphical simulation of the system model.
in the semantics of syncblock it should adhere to the reactions of the real system where each system reaction step mainly involves in three phases import inputs compute changes and export outputs.
during simulation users can explore the system behaviors to check the correctness of the constructed model.
the simulation function provides some basic functions step forward step roll back read inputs from the input les for multi step forward etc.
through the interactive simulation most functional requirements can be checked.
visual graph of the simulated blockstructure of the simulatedblock error informationname and value of input ports name and value of output ports and variablesinitialize forward roll back reset instruction figure the overall interface of the simulation.
the simulation interface provides six views.
the toolbar allows us to do initialization reset execution forward and roll back.
the input view shows the name of the input data ports where the engineer can input the values for each computation.
the output view shows the nameof the output data ports and the shared variables where the engineer can check the values after each computation.
the editor view shows the content of the simulated block.
if we click an atom block twice each automaton contained in this block would be presented.
the transitions in a computation are executed visually and the current active states are highlighted in red.
the element explorer shows the contents and the structure of the simulated blocks in the editor view.
the properties view allows us to view some error information during simulation.
veri er translator.
veri er translator is based on the formal semantics of syncblock and translates selected graphical model to a labeled transition system.
detail translation rules such as each parallel automata atten complex actions split are described in the manual .
the generated transition system is described within the generated les with su x .elts and can be directly invoked by tool beagle for formal veri cation.
we just need to click the button export to etls in the toolbar the syncblock model would be automatically translated into the labeled transition system le and e ciently veri ed by the tool beagle.
the formal veri cation makes up the incompletion of simulation to strengthen the correctness for safety critical requirements.
code generator.
code generator is based on the cosynthesis mechanisms presented in and generates the hardware description les with su x .vhd for the blocks partitioned into hardware implementation and executable software code les with su x .c for the blocks partitioned into software implementation.
noting that many partitioning algorithms have been proposed in the last decades which is not the main concern and contribution of this work and we use our previous algorithms for partitioning.
the key idea is to custom each atom block of syncblock as a node in the partitioning algorithm and nd a bipartition p on a communication graph denoted as g v e where vis a set of nodes fv1 v2 vngandeis a set of edges feijj1 i j ng and p vh vs such that vhsvs v andvhtvs .
then the partitioning problem can be decided by a decision vector x x1 x2 xn representing implementation way of n task modules.
when the value of xiis the task module will be implemented in hardware software .
objective of the problem is changed to search an n dimensional space to nd the optimal value of the decision vector on the objective function of hardware cost h x and time constraints t x .
then for software synthesis we use c sub function call to capture the compound block and c thread de nition to capture the automata contained in the atom block.
because the automata contained in the innermost atom block are running in parallel and synchronized with the clock the thread for each automaton needs to be synchronized with the barrier.
we implement a dynamic barrier in two les named timer.h and timer.c as the synchronization scheduler of all threads.
for hardware synthesis we use the architecture description code of component map in vhdl to capture the compound block and the behavior description code of process de nition in vhdl to capture the automata contained in the atom block.
furthermore to keep the execution cycle consistency between the reaction of hardware fpga processor and the reaction of software arm processor the frequency of the fpga processor is used to initiate the parameter of thesleep function contained in the generated software.
we just need to click the button export model as c and export model as vhdl in the toolbar the syncblock model 777would be automatically translated into the corresponding executable c and vhdl code.
the generated code outperforms the state of the art vhdl and c code generated by other tools in terms of synthesized gate array resource consumption and binary code size.
.
experiment results to evaluate the e ectiveness of tsmart edola we apply it to the model driven design of a multifunction vehicle bus controller mvbc used in the train communication network tcn which is standardized in iec .
we compare it with beaglebone one available design framework for mvbc of class and simulink one framework for general system design .
we mainly compared them in the bug detection of the iec standard and the resource consumption during the model driven design of mvbc.
overall results are presented in tabel and introduced as follow.
more complex example figure the model in tsmart edola for the mvb controller of level .
model construction strictly following the speci cation of the standard iec two types of communication services of mvbc are modeled as eighteen compound blocks presented in figure.
.
modules can be hierarchically constructed and debugged in tsmart edola .
the constructed syncblock model for the whole system is presented in figure with details can be referred to the website in the abstract.
inheriting those modeling of mvbc within class of previous works presented in section we build the model for process data communication which is later partitioned for hardware implementation.
then according to the description of iec we build the model for message communication of class which is partitioned for software implementation.
the mvbc of class supports both process data and message data communication with mixed hardware software implementation as adopted by the most widely used mvbc d113 of duagon company .
model validation after preliminary graphical model simulation the constructed model is translated through veri er translator and safety critical properties are formulated as logic assertions for beagle veri cation.
for example you can formalize the requirement that during data packet retransmission procedure the resent data packet number should be the next packet to be sent as the formula as nk true derive nk number next send unfortunately the assertion fails to pass the veri cation.
through manually analysis of the counterexample provided in beagle we located the violation in the atom block frameretransmission contained in the compound block message service .
the bug is tracked to c statement fexpected nkseqnr send notyet expected credit gcontained in the action of transition for the data retransmission which is located in table of the standard iec .
in this buggy scenario the system fails to update the value of packet number to be retransmitted.
to x the bug the statement needs to be changed to fexpected nkseqnr send notyet expected credit next send expected g .
as presented in table six problems about the message transmission and master rotation are veri ed and detected which can be traced back to the pseudo code descriptions in table and figure of iec .
by xing the bugs in the standard the modi ed syncblock model passes the veri cation.
code generation following the implementation style of duagon company the process data communication related modules partitioned for hardware implementation are synthesized with lines of vhdl code and the message communication related modules partitioned for software implementation are synthesized with lines of c code.
the vhdl code for the atom block mfgenerator ctrl of figure contains lines of code with 7kb in size.
if we use state ow to model this function and generate code by simulink the size grows to kb although number of the state and transition is the same for state ow model and syncblock model.
furthermore because syncblock computation model uses the bounded integer type of the interface declaration in generated vhdl code is mapped to the ranged integer.
this contributes to a great reduction on resource usage when generating the rtl register transfer level le from vhdl code.
when we synthesized all vhdl code into the target device xc6slx16 3ftg256 with the xilinx ise it will cost number of slice registers while for the vhdl code generated by simulink for state ow model the number is increased to .
the generated c code for atom block master transfer is lines with 53kb in size.
but in simulink generated c code is almost doublesized to be 98kb with lines of code for the main logic.
the generated c code can also be compiled and simulated in the visual studio development environment of microsoft and the binary le is kb and kb for the code generated bysyncblock and simulink respectively.
the di erence is mainly derived from the fact that simulink generates many extra con guration les and introduces many libraries for scalability.
similar results hold for the comparison between tsmart edola and beaglebone.
details about the resource utilization of vhdl synthesization and c compilation and the bug detection results are concluded in table which proves the e ciency of the toolkit tsmart edola .
synthesized device then the synthesized binary les for the generated vhdl code and c code can be loaded into the fpga and arm processors on the mvbc network card respectively.
to test the reliability of the co synthesized system we connect the widely used industrial product mvbc card d113 with our synthesized controller card for realtime communication.
the co synthesized system is embedded into an industrial computer to receive instructions from the keyboard.
we use an application running on the industrial computer to monitor the communication and read the message data from the memory.
sequences and contents of data frames are accurately compatible with the de nition in the standard iec .
in addition the automatically co778table resource utilization of vhdl synthesization and c compilation for mvbc system of class and .
vhdl logic utilization tsmart class simulink class tsmart class beaglebone class number of slice registers number of slice luts number of fully used lut ff pairs c compilation tsmart class simulink class tsmart class beaglebone class binary file size kb bug in iec standard detected veri cation simulation veri cation veri cation synthesized mvbc passes the physical and electrical test.
it has been also equipped on a real test train traveling over thirty thousand kilometers without failures.
.
conclusion in this paper we develop the toolkit tsmart edola to facilitate the design of complex synchronous embedded systems with both hardware and software components.
the graphical model construction and validation through simulation and veri cation help us nd problems in the early stage of system design.
after all properties are satis ed we can generate executable implementation from the validated model automatically with some components in c and others in vhdl.
furthermore when we apply it to the model driven design of mvbc based on the standard iec several critical bugs and some other ambiguousness in the standard are detected during the model veri cation and automatic implementation based on the bug free model has been deployed and in operation in real subway controllers.
in the future code generators to java and verilog will also be added code veri ers will also be integrated for the veri cation of the generated code and the toolkit itself and di erent versions for di erent operation systems will be provided.
.
acknowledgment this research is sponsored in part by nsfc program no.
no.
national science and technology major project no.
2016zx01038101 tsinghua university initiative scienti c research program miit it funds research and application of tcn key technologies of china and the national key technology r d program no.
2015bag14b01 .
.