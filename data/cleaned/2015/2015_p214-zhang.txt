assertions are strongly correlated with test suite effectiveness yucheng zhang electrical and computer engineering university of british columbia vancouver bc canada yuchengz ece.ubc.caali mesbah electrical and computer engineering university of british columbia vancouver bc canada amesbah ece.ubc.ca abstract code coverage is a popular test adequacy criterion in practice.
code coverage however remains controversial as there is a lack of coherent empirical evidence for its relation with test suite e ectiveness.
more recently test suite size has been shown to be highly correlated with e ectiveness.
however previous studies treat test methods as the smallest unit of interest and ignore potential factors in uencing this relationship.
we propose to go beyond test suite size by investigating test assertions inside test methods.
we empirically evaluate the relationship between a test suite s e ectiveness and the number of assertions assertion coverage and di erent types of assertions.
we compose test suites in total using assertions of ve real world java projects.
we nd that the number of assertions in a test suite strongly correlates with its e ectiveness and this factor directly in uences the relationship between test suite size and e ectiveness.
our results also indicate that assertion coverage is strongly correlated with e ectiveness and di erent types of assertions can in uence the e ectiveness of their containing test suites.
categories and subject descriptors d. .
testing and debugging d. .
metrics general terms experimentation measurement keywords test suite e ectiveness assertions coverage .
introduction software testing has become an integral part of software development.
a software product cannot be con dently released unless it is adequately tested.
code coverage is themost popular test adequacy criterion in practice.
however coverage alone is not the goal of software testing since coverage without checking for correctness is meaningless.
a more meaningful adequacy metric is the fault detection ability of a test suite also known as test suite e ectiveness.
there have been numerous studies analyzing the relationship between test suite size code coverage and test suite e ectiveness .
more recently inozemtseva and holmes found that there is a moderate to very strong correlation between the e ectiveness of a test suite and the number of test methods but only a low to moderate correlation between the e ectiveness and code coverage when the test suite size is controlled for.
these ndings imply that the more test cases there are the more e ective a test suite becomes the more test cases there are the higher the coverage and thus test suite size plays a prominent role in the observed correlation between coverage and e ectiveness.
all these studies treat test methods as the smallest unit of interest.
however we believe such coarse grained studies are not su cient to show the main factors in uencing a test suite s e ectiveness.
in this paper we propose to dissect test methods and investigate why test suite size correlates strongly with e ectiveness.
to that end we focus on test assertions inside test methods.
test assertions are statements in test methods through which desired speci cations are checked against actual program behaviour.
as such assertions are at the core of test methods.
we hypothesize that assertions1have a strong in uence on test suite e ectiveness and this in uence in turn is the underlying reason behind the strong correlation between test suite size code coverage and test suite e ectiveness.
to the best of our knowledge we are the rst to conduct a large scale empirical study on the direct relationship between assertions and test suite e ectiveness.
in this paper we conduct a series of experiments to quantitatively study the relationship between test suite e ectiveness and the number of assertions assertion coverage and di erent types of assertions.
this paper makes the following main contributions the rst large scale study analyzing the relation between test assertions and test suite e ectiveness.
our study composes test suites in total from test cases and assertions of ve real world java projects in di erent sizes and domains.
1we use the terms assertion and test assertion interchangeably in this paper.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
copyright is held by the owner author s .
publication rights licensed to acm.
esec fse august september bergamo italy acm.
... .
empirical evidence that test assertion quantity and assertion coverage are strongly correlated with a test suite s e ectiveness assertion quantity can signi cantly in uence the relationship between a test suite s size and its e ectiveness the correlation between statement coverage and e ectiveness decreases dramatically when assertion coverage is controlled for.
a classi cation and analysis of the e ectiveness of assertions based on their properties such as creation strategy human written versus automatically generated the content type asserted on and the actual assertion method types.
.
related work code coverage is measured as the percentage of program code that is executed at least once during the execution of the test suite.
there is a large body of empirical studies investigating the relationship between di erent coverage metrics such as statement branch mc dc and test suite e ectiveness .
all these studies nd some degree of correlation between coverage and e ectiveness.
however coverage remains a controversial topic as there is no strong evidence for its direct relation with e ectiveness.
the reason is that coverage is necessary but not su cient for a test suite to be e ective.
for instance a test suite might achieve coverage but be void of test assertions to actually check against the expected behaviour and thus be ine ective.
researchers have also studied the relationship between test suite size coverage and e ectiveness .
in these papers test suite size is measured in terms of the number of test methods in the suite.
di erent test suites with size controlled are generated for a subject program to study the correlation between coverage and e ectiveness.
namin and andrews report that both size and coverage independently inuence test suite e ectiveness.
more recently inozemtseva and holmes nd that size is strongly correlated with e ectiveness but only a low to moderate correlation exists between coverage and e ectiveness when size is controlled for.
none of these studies however looks deeper into the test cases to understand why size has a profound impact on e ectiveness.
in our work we investigate the role test assertions play in e ectiveness.
schuler and zeller propose the notion of checked coverage 2as a metric to assess test oracle quality.
inspired by this work we measure assertion coverage of a test suite as the percentage of statements directly covered by the assertions.
we are interested in assertion coverage because it is a metric directly related with the assertions in the test suite.
in the original paper the authors evaluated the metric by showing that there is a similar trend between checked coverage statement coverage and mutation score.
in this paper we conduct an empirical study on the correlation level between assertion coverage and test suite e ectiveness.
in addition we compose a large set of test suites up to thousands for each subject under test whereas only seven test suites were compared in the original paper.
moreover we study the correlation between statement coverage and test suite e ectiveness to compare with the relationship between assertion coverage and test suite e ectiveness by composing 2we use the terms assertion coverage and checked coverage interchangeably in this paper.test suites with assertion coverage controlled.
cai and lyu studied the relationship between code coverage and fault detection capability under di erent testing pro les.
they found that the e ect of code coverage on fault detection varies under di erent testing pro les.
also the correlation between the two measures is strong with exceptional test cases while weak in normal testing settings.
however they did not examine the role assertions might play in di erent pro les on the e ectiveness of test cases.
to the best of our knowledge we are the rst to investigate the in uence of di erent assertion properties on suite e ectiveness.
we classify assertion properties in three categories and study the e ectiveness of each classi cation separately.
.
experimental design the goal of this paper is to study the relationship between assertions and test suite e ectiveness.
to achieve this goal we design controlled experiments to answer the following research questions rq1 is the number of assertions in a test suite correlated with e ectiveness?
rq2 is the assertion coverage of a test suite correlated with e ectiveness?
rq3 does the type of assertions in a test suite in uence e ectiveness?
we examine these three main aspects of assertions in our study because almost all test cases contain assertions but the number of assertions varies across test suites see table we aim to investigate if the number of assertions plays a role in e ectiveness the fraction of statements in the source code executed and checked directly by assertions should intuitively be closely related to e ectiveness we set out to explore if and to what degree this is true and assertions have di erent characteristics which may potentially in uence a test suite s e ectiveness such as their method of creation e.g.
humanwritten automatically generated the type of arguments they assert on e.g.
boolean string integer object and the assertion method itself e.g.
asserttrue assertequals .
all our experimental data is publicly available.
.
terminology test case a junit4 test method annotated with test .
we use the terms test method and test case interchangeably in this paper.
test suite the collection of a subject program s test cases.
test suite size number of test cases in a test suite.
master original test suite the test suite written by the developers of a subject program.
.
subject programs to automate data collection we selected java programs that use apache maven4as their build system and junit4 as their testing framework.
we select programs of di erent sizes to ensure the experiment results are not project size dependent.
our set of subjects contains ve projects in di erent application domains.
jfreechart is a free java chart library for producing charts.
apache commons lang is a package 215table characteristics of the subject programs.
id subjects java sloc test sloc test cases assertions statement coverage assertion coverage 1jfreechart 2apache commons lang 3urban airship java library 4lambdaj 5asterisk java total average table number of assertions per test case.
id min 1st q. median 3rd q. max mean .
.
.
.
.
.
.
.
.
.
of java utility classes for the classes that are in java.lang s hierarchy.
urban airship java library is a java client library for the urban airship api.
lambdaj is a java project for manipulating collections in a pseudo functional and statically typed way.
the last subject asterisk java is a free java library for asterisk pbx integration.
the characteristics of these subject programs are summarized in table .
lines of source code are measured using sloccount .
columns illustrate test suite size in terms of number of test methods assertion quantity statement coverage and assertion coverage of each subject s master test suite respectively.
table presents descriptive statistics regarding the number of assertions per test case for the subject systems.
.
procedure to study the relationship between assertions and test suite e ectiveness a large set of test suites with di erent assertion related properties are required.
in this section we present how the experiments are conducted with respect to each research question.
we rst discuss the variables of interest then explain how test data are collected by generating new test suites and nally describe how the results are analyzed.
.
.
effectiveness of assertion quantity rq1 in order to answer rq1 we investigate three variables namely number of test methods number of assertions and test suite e ectiveness.
we collect data by generating test suites in three ways randomly controlling test suite size and controlling assertion quantity.
for each set of test suites we compute the correlation between the three variables.
number of test cases.
we implemented a tool that uses the javaparser library to identify and count the total number of test cases in a given test suite.
number of assertions.
for each identi ed test case the tool counts the number of test assertions e.g.
asserttrue inside the body of the test case.
test suite e ectiveness.
e ectiveness captures the fault detection ability of a test suite which can be measured as a percentage of faults detectable by a test suite.
to measure 5we were surprised to see such high max numbers of assertions per test case so we manually veri ed these numbers.
for instance the max assertions for jfreechart are in the testequals test method of the org.jfree.chart.plot.categoryplottest class.the fault detection ability of a test suite a large number of known real faults are required for each subject which is practically unachievable.
instead researchers generate arti cial faults that resemble developer faults using techniques such as mutation testing.
in mutation testing small syntactical changes are made to random locations in the original program to generate a large number of mutants.
the test suite is then run against each mutant.
a mutant is killed if any of the test case assertions fail or the program crashes.
mutation score.
the mutation score calculated as a percentage of killed mutants over total number of non equivalent mutants is used to estimate fault detection ability of a test suite.
equivalent mutants are syntactically di erent but semantically the same as the origin program and thus undetectable by any test case.
since there is no trivial way of identifying equivalent mutants similar to other studies we treat all mutants that cannot be detected by a program s original master test suite as equivalent mutants when calculating mutation scores for our generated test suites.
mutations are produced by transforming a program syntactically through mutation operators and one could argue about the eligibility of using the mutation score to estimate a test suite s e ectiveness.
however mutation testing is extensively used as a replacement of real fault detection ability in the literature .
there is also empirical evidence con rming the validity of mutation testing in estimating test suite e ectiveness .
we use the open source tool pit to generate mutations.
we tested each of our subject programs to ensure their test suites can successfully execute against pit.
we use pit s default mutation operators in all of our experiments.
generating test suites.
to answer rq1 we generate test suites in three di erent ways from the master test suites of the subject programs.
random test suites.
we rst generate a set of test suites by randomly selecting a subset of the test cases in the master test suite without replacement.
the size of each generated test suite is also randomly decided.
in other words we generate this set of test suites without controlling on test suite size or assertion quantity.
controlling the number of test methods.
each test case typically has one or more assertions.
a test suite with more test cases is likely to contain more assertions and vice versa.
from our observations if test suites are randomly generated there exists a linear relationship between test suite size and the number of assertions in the suites.
if there is a linear relationship between two properties a e.g.
assertion quantity and b e.g.
suite size a relationship betweenaand a third property c e.g.
e ectiveness can easily transform to a similar relationship between bandc through transitive closure.
to remove such indirect in uences we generate a second set of test suites by controlling the size.
more speci cally a target test suite contains all of the 216test methods but only a subset of the assertions from the master test suite.
based on the total number of assertions in the master test suite we rst select a base number b which indicates the size of the smallest test suite and a step numberx which indicates size di erences between test suites.
therefore the i th test suite to be generated contains all of the test cases but only b x irandomly selected assertions of the master test suite.
controlling the number of assertions.
we also generate another set of test suites by controlling on assertion quantity.
to achieve this we rst assign test cases to disjoint buckets according to the number of assertions they contain.
for instance for jfreechart test cases are assigned to three disjoint buckets where bucket lowcontains test cases with or less assertions bucket middle contains test cases with or assertions and bucket high contains the rest of test cases which have or more assertions.
we divide test cases in this way such that each bucket has a comparable size.
then we generate test suites from each of the buckets randomly without replacement.
following this process with a similar test suite size test suites generated from bucket high always contain more assertions than test suites generated from bucket middle and so forth.
correlation analysis.
for rq1 we use pearson and kendall s correlation to quantitively study the relationship between test suite size assertion quantity and test suite e ectiveness.
the pearson correlation coe cient indicates the strength of a linear relationship between two variables.
the kendall s correlation coe cient measures the extent to which as one variable increases the other variable tends to increase without requiring that increase to be represented by a linear relationship.
.
.
effectiveness of assertion coverage rq2 to answer rq2 we measure a test suite s assertion coverage statement coverage and e ectiveness.
we collect data by rst looking at the set of test suites which were randomly generated for rq1 then generate a new set of test suites by controlling their assertion coverage.
for each of the two sets of test suites we study and compare the correlations between the three variables using the same analysis methods as described in section .
.
.
explicit mutation score.
not all detectable faults in a program are detected by test assertions.
from our observations mutants can either be explicitly killed by assertions or implicitly killed by program crashes.
programs may crash due to unexpected exceptions.
program crashes are much easier to detect as they do not require dedicated assertions in test cases.
on the other hand all the other types of faults that do not cause an obvious program crash are much more subtle and require proper test assertions for their detection.
since the focus of our study is on the role of assertions in e ectiveness in addition to the mutation score we also compute the explicit mutation score which measures the fraction of mutants that are explicitly killed by the assertions in a test suite.
table provides mutation data in terms of the number of mutations generated for each subject number of mutants killed by the test suites number of mutants killed only by test assertions e.g.
excluding crashes and the percentage of mutants killed by assertions with respect to the total number of killed assertions.
from what we have observed in our experiments pit always generates the same set of mutants for a piece of sourcetable mutation data for the subject programs.
id mutants killed killed by assertions killed by assertions code when executed multiple times.
thus to measure the explicit mutation score of a test suite we remove all assertions from the test suite measure its mutation score again and then subtract the fraction of implicit killed mutants from the original mutation score.
assertion coverage.
assertion coverage also called checked coverage measures the fraction of statements in the source code executed via the backward slice of the assertion statements in a test suite.
we use the open source tool javaslicer to identify assertion checked statements which are statements in the source code executed through the execution of assertions in a test suite.
javaslicer is an open source dynamic slicing tool which can be used to produce traces of program executions and o ine dynamic backward slices of the traces.
we automatically identify checked statements of a test suite by identifying all assertion statements and constructing slicing criteria using javaslicer to trace each test class separately and mining the traces computed in the previous step to identify dynamic backward slices of the assertions and nally since each backward slice of an assertion includes statements from the test case calls to the junit apis and statements from the source code we lter out the data to keep only the statements pertaining to the source code.
for large test suites we observed that using javaslicer is very time consuming.
thus we employ a method to speed up the process in our experiments.
for all the test classes in each original master test suite we repeat steps above to compute the checked statements for each test method individually.
each statement in the source code is uniquely identi ed by its classname and line number and assigned an id.
we then save information regarding the checked statements of each test method into a data repository.
once a new test suite is composed its checked statements can be easily found by rst identifying each test method in the test suite then pulling the checked statements of the test method from the data repository and nally taking a union of the checked statements .
the assertion coverage of a generated test suite is thus calculated as the total number of checked statements of the suite divided by the total number of statements.
statement coverage.
unlike assertion coverage which only covers what assertion statements execute statement coverage measures the fraction of the source code covered through the execution of the whole test suite.
in this paper we select statement coverage out of the traditional code coverage metrics as a baseline to compare with assertion coverage.
the reason behind our selection is twofold.
first statement coverage is one of the most frequently used code coverage metrics in practice since it is relatively easy to compute and has proper tool support.
second two recent empirical studies suggest that statement coverage is at least as good as any other code coverage metric in predicting e ectiveness.
gopinath et al.
found 217statement coverage predicts e ectiveness best compared to block branch or path coverage.
meanwhile inozemtseva and holmes found that stronger forms of code coverage such as decision coverage or modi ed condition coverage do not provide greater insights into the e ectiveness of the suite.
we use clover a highly reliable industrial code coverage tool to measure statement coverage.
generating test suites.
to answer rq2 we rst use the same set of test suites that were randomly generated for rq1.
in addition we compose another set of test suites by controlling assertion coverage.
we achieve this by controlling on the number of checked statements in a test suite.
similarly based on the total number of checked statements in the master test suite of a program we prede ne a base number b which indicates assertion coverage of the smallest test suite and a step number x which indicates assertion coverage di erences between the test suites.
when generating a new test suite a hash set of the current checked statements is maintained.
if the target number for checked statements is not reached a non duplicate test method will be randomly selected and added to the test suite.
to avoid too many trials of random selection this process is repeated until the test suite has checked statements.
this way the i th target test suite has an assertion coverage of b x i n wherenis the total number of statements in the source code.
.
.
effectiveness of assertion types rq3 rq3 explores the e ectiveness of di erent characteristics of test assertions.
to answer this research question we rst automatically assign assertions to di erent categories according to their characteristics then generate a set of sample test suites for each category of assertions and nally conduct statistical analysis on the data collected from the generated test suites.
assertion categorization.
assertions can be classi ed according to their characteristics.
some of these characteristics may be potential in uence factors to test suite e ectiveness.
we categorize assertions in three ways human written versus generated.
human written test cases contain precise assertions written by developers about the expected program behaviour.
on the other hand automatically generated tests contain generic assertions.
commonly it is believed that human written test cases have a higher fault detection ability than generated assertions.
we test this assumption in our work.
assertion content type.
test assertions either check the value of primitive data type or objects of di erent classes.
we further classify java s primitive data types into numbers for int byte short long double and oat strings for char and string and booleans .
this way depending on the type of the content of an assertion it falls into one of the following classes number content type string contenttype boolean content type orobject content type .
we explore whether these assertion content types have an impact on the e ectiveness of a test suite.
for assertion content type we apply dynamic analysis to automatically classify the assertions in a given test suite to the di erent categories.
we rst instrument test code to probe each assert statement for the type of content it asserts on.
then we run the instrumented test code and use the information collected to automatically assign assertions to the di erent content type categories.assertion method type.
it is also possible to categorize assertions according to their actual method types.
for instance asserttrue and assertfalse assertequals and assertnotequals and assertnull andassertnotnull can be assigned to di erent categories.
we investigate if these assertion method types have an impact on e ectiveness.
for assertion method types we parse the test code and syntactically identify and classify assertions to di erent assertion method type classes.
generating test suites.
under each assertion categorization for each assertion type we compose sample test suites each containing assertions.
a sample test suite contains all test methods in the master test suite but only randomly selected assertions of the target type.
for instance a sample test suite of the type string content type will contain all the test methods in the master test suite but only randomly selected string content type assertions.
to quantitively compare the e ectiveness between humanwritten and generated assertions for each subject program we generate sample test suites each containing human written assertions from the master test suite and sample test suites each containing automatically generated assertions using randoop a well known feedback directed test case generator for java.
we use the default settings of randoop.
analysis of variances.
for assertion content type and assertion method type since there are multiple variables involved we use the one way anova analysis of variance statistical method to test whether there is a signi cant di erence in test suite e ectiveness between the variables.
before we conduct the anova test we used the shapirowilk test to pretest the normality of our data and levene s test to pretest the homogeneity of their variances.
both were positive.
anova answers the question whether there are signi cant di erences in the population means.
however it does not provide any information about how they di er.
therefore we also conduct a tukey s honest signi cance test to compare and rank the e ectiveness of assertion types.
.
results in this section we present the results of our experiments.
.
effectiveness of assertion quantity ignoring test suite size.
figure depicts plots of our collected data for jfreechart.6figures 1a and 1b show that the relationship between test suite size and e ectiveness is very similar to the relationship between assertion quantity and e ectiveness.
as the plot in figure 1c shows there exists a linear relationship between the number of test methods and the number of assertions in the randomly generated test suites.
table shows the pearson p and kendall s k correlations between e ectiveness with respect to suite size m and assertion quantity a for the test suites that are randomly generated for all the ve subjects.
as the table shows there is a very strong correlation between number of assertions in a test suite and the test suite s e ectiveness and the correlation coe cients are very close to that of suite size and e ectiveness.
this is consistent with the plots of figure .
6note that we observed a similar trend from the other subjects and only include plots for jfreechart due to space limitations.
.
.
.
.
.
.
number of test casesmutation score a .
.
.
.
.
.
number of assertions b number of test casesnumber of assertions c figure plots of a suite size versus e ectiveness b assertion quantity versus e ectiveness and c suite size versus assertion quantity for the randomly generated test suites from jfreechart.
the other four projects share a similar pattern consistently.
table correlation coe cients between test suite size and e ectiveness m and assertion quantity and e ectiveness a .
pshows pearson correlations and krepresents kendall s correlations.
subject id p m p a k m k a p value .
.
.
.
2e .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
the correlations between assertion quantity and e ectiveness are slightly higher or equal to the correlations between the number of test methods and e ectiveness.
finding our results indicate that without controlling for test suite size there is a very strong correlation between the e ectiveness of a test suite and the number of assertions it contains.
controlling for test suite size.
table shows our results when we control for test suite size.
column shows the number of assertions in the smallest test suite and column shows the di erence in assertion quantity between generated test suites.
columns and present the pearson and kendall s correlations respectively between the assertion quantity and the e ectiveness of the test suites that are generated from the ve subjects by controlling test suite size.
as the high correlation coe cients indicate in this table even when test suite size is controlled for there is a very strong correlation between e ectiveness and assertion quantity.table correlations between number of assertions and suite e ectiveness when suite size is controlled for.
subject id base step p a k a p value .
.
2e .
.
.
.
.
.
.
.
finding our results suggest that there is a very strong correlation between the e ectiveness of a test suite and the number of assertions it contains when the in uence of test suite size is controlled for.
.
.
.
.
.
.
.
number of test casesmutation scorehighmiddlelow figure plot of mutation score against suite size for test suites generated from assertion buckets low middle and bucket highfrom jfreechart.
the other four projects share a similar pattern consistently.
controlling for assertion quantity.
figure plots the e ectiveness of the test suites generated by controlling for the number of assertions.
three buckets of high middle and low in terms of the number of assertions were used for generating these test suites see section .
.
.
from low to high each bucket contained and test cases in total and the average number of assertions per test case was .
.
and .
respectively.
from the curves in the plot we can see that the e ectiveness increases as the number of test methods increase.
however comparing the curves there is a clear upward trend in a test suite s e ectiveness as its assertion quantity level increases.
for every given test suite taken from the lower curve on the plot there exits a test suite with the same suite size that has a higher e ectiveness because it contains more assertions.
finding our results indicate that for the same test suite size assertion quantity can signi cantly in uence the e ectiveness.
.
effectiveness of assertion coverage to answer rq2 we rst computed the assertion coverage statement coverage and mutation score of the randomly generated test suites see subsubsection .
.
.
figure 4a .
.
.
.
.
.
.
r .9927jfreechart .
.
.
.
.
.
r .9936apache commons lang .
.
.
.
.
.
.
r .9417urban airship java library .
.
.
.
.
.
.
r .9631lambdaj .
.
.
.
.
.
.
.
r .9459asterisk java .
.
.
.
.
.
.
r .8321jfreechart .
.
.
.
.
.
.
.
r .9901apache commons lang .
.
.
.
.
.
r .8327urban airship java library .
.
.
.
.
.
.
r .8634lambdaj .
.
.
.
.
.
.
.
r .8014asterisk javamutation scoreexplicit mutation scoreassertion coveragefigure mutation score above and explicit mutation score below plot against assertion coverage for the ve subject programs.
each box represents the test suites of a given assertion coverage that were generated from the original master test suite for each subject.
the kendall s correlation is .
.
between assertion coverage and mutation score and .
.
between assertion coverage and explicit mutation score.
plots our results.
the two tted lines both have a very high adjustedr2and p value smaller than 2e this indicates a very strong correlation between assertion coverage and e ectiveness as well as statement coverage and e ectiveness.
the plot also shows that a test suite having the same assertion coverage as another test suites s statement coverage is much more e ective in detecting faults.
compared with statement coverage assertion coverage is a more sensitive predictor of test suite e ectiveness.
.
.
.
.
.
.
coverage01020304050mutation scoreassertion coveragestatement coverager .9836r .
a 02000400060008000number of assertions051015202530assertion coverage b figure plots of a mutation score against assertion coverage and statement coverage b assertion coverage against assertion quantity for the randomly generated test suites from jfreechart.
figure 4b plots assertion coverage against number of assertions in a test suite.
from the plot assertion coverage of a test suite increases as test suite size increases.
however the increasing rate of assertion coverage decreases as test suite size increases.
there is a strong increasing lin ear relationship between assertion coverage and test suite e ectiveness.
therefore it is expected that test suite effectiveness increases as test suite size increases but with a diminishing increasing rate which is again consistent with our results in subsection .
.
finding our results suggest that assertion coverage is very strongly correlated with test suite e ectiveness.
also ignoring the in uence of assertion coverage there is a strong correlation between statement coverage and the effectiveness.
controlling for assertion coverage.
figure shows box plots of our results for the test suites generated by controlling their assertion coverage.
the adjusted r2value for each regression line is shown in the bottom right corner of each box plot.
it ranges from .
to .
between assertion coverage and mutation score and .
to .
between assertion coverage and explicit mutation score.
this indicates assertion coverage can predict both mutation score and explicit mutation score well.
table summarizes statistics for these test suites.
column contains the kendall s correlations between statement coverage and mutation score .
.
column presents the kendall s correlations between statement coverage and explicit mutation score .
.
.
when assertion coverage is controlled for there is a moderate to strong correlation between statement coverage and mutation score and only alow to moderate correlation between statement coverage and explicit mutation score.
for instance only about of the mutants generated for urban airship library id and lambdaj id are explicitly detectable mutants correspondingly there is only a weak correlation .
.
220table statistics of test suites composed at di erent assertion coverage levels.
subject id assertion coveragestat.
coverage corr.
mutation score statement coverage general explicitgeneralexplicit .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
between their statement coverage and explicit mutation score.
a higher fraction of the mutants generated for the other three subjects are explicitly detectable mutants and thus the correlation between their statement coverage and explicit mutation score increases signi cantly from .
to .
.
columns in table pertain to the average mutation score average explicit mutation score and average statement coverage of the test suites at each assertion coverage level respectively.
as the results show a slight increase in assertion coverage can lead to an obvious increase in the mutation score and explicit mutation score.
for instance for jfreechart id when assertion coverage increases by around the mutation score increases by around .
and explicit mutation score increases by around .
on the other hand a increase in the statement coverage does not always increase either mutation score or explicit mutation score.
this shows again that assertion coverage is a more sensitive indicator of test suite e ectiveness compared to statement coverage.
finding our results suggest that assertion coverage is capable of predicting both mutation score and explicit mutation score.
with assertion coverage controlled for there is only a moderate to strong correlation between statement coverage and mutation score and a low to moderate correlation between statement coverage and explicit mutation score.
test suite e ectiveness is more sensitive to assertion coverage than statement coverage.
.
effectiveness of assertion types to answer rq3 we examined the assertions of jfreechart.
assertion generation strategy.
figure 5a plots the e ectiveness of human written test suites and randoop generated test suites against assertion quantity.
as we can observe the e ectiveness of human written and generated test suitesboth increase as the assertion quantity increases.
however the e ectiveness of the generated test suites gets saturated much faster than human written test suites.
from our observations of the composed test suites the human written sample test suites are e ective in killing mutants while the generated test suites can hardly detect any mutant.
we increased the assertion quantity in the sample test suites to but still saw the same pattern.
finding our results indicate that human written test assertions are far more e ective than automatically generated test assertions.
assertion content type.
assertions are also classi ed based on the types of the content they assert on.
figure 5b box plots the e ectiveness of the sample test suites that exclusively contain assertions on object boolean number or string types.
tables and show the anova and the tukey s honest signi cance test respectively.
the f value is with a p value very close to thus we can con dently reject the null hypothesis of equal variances e ectiveness for the four assertion content types.
table shows the estimated di erence in mutation score in column and the con dence interval of the di erence in columns and .
the tukey s test indicates that there is a signi cant di erence between the e ectiveness of assertions that assert on boolean object string and number types.
assertions that assert on boolean types are as e ective as assertions that assert on objects.
finding our results suggest that there is a signi cant di erence between the e ectiveness of assertions that assert on di erent content types.
their e ectiveness can be ranked in increasing order string number boolean or object type.
assertion method type.
assertions can also be classi ed by their actual method types.
figure 5c plots the e ectiveness of the sample test suites that belong to the three assertion .
.
.
.
.
.
number of assertionsmutation scorehuman writtengenerated a objectbooleannumberstring0.
.
.
.
754208mutation scoreassertion content type b trueorfalsenullornotequalsornot0.
.
.
.
481mutation scoreassertion method type c figure plots of a assertion quantity versus effectiveness of human written and generated tests b assertion content types versus e ectiveness and c assertion method types versus e ectiveness.
in b and c each box represents the sample test suites generated for each type the total number of assertions of each type are indicated in red.
table one way anova on the e ectiveness of assertion content types and actual assertion types.
df sum sq mean sq f value pr f assertion content types type .
.
2e residuals .
.
assertion method types type .
.
.
2e residuals .
.
method types.
in this paper we did not study assertsame and assertnotsame because there were only of them in jfreechart which is a low number to be representative.
the bottom half of tables and present the anova and tukey s honest signi cance test respectively for assertion method types.
the f value is .
with a p value very close to thus we can reject the null hypothesis of equal variances e ectiveness for the three assertion method types.
the tukey s test shows that there exists a signi cant di erence between the e ectiveness of the three assertion method types.
finding our results indicate that there is a signi cant di erence between the e ectiveness of di erent assertion method types.
the e ectiveness of the method types can be ranked from low to high as assert not null assert not equals and asserttrue false .
.
discussiontable tukey s honest signi cance test on the effectiveness of assertion content types and assertion method types.
each of the sample test suites used for the comparison contains assertions of a target type.
types di lwr upr p adj assertion content types boolean vs. object .
.
.
.
number vs. boolean .
.
.
.
string vs. number .
.
.
.
assertion method types assertnull not .
.
.
1e 07vs.
asserttrue false assertequals not .
.
.
0e 00vs.
assertnull not .
test suite size vs. assertion quantity from the ndings and the number of assertions in a test suite is very strongly correlated with its e ectiveness with or without controlling for the in uence of test size.
however according to nding if we in turn control for the number of assertions a test suite s e ectiveness at a same test size level can be directly in uenced by the number of assertions it contains.
thus test suite size is not su cient in predicting the e ectiveness without considering the in uence of assertion quantity.
in addition assertion quantity provides extra indications about the suite s explicit mutation score which constitutes a large portion of the mutation score.
therefore test suite size can predict the e ectiveness only under the assumption that there is a linear relationship between the number of test methods and the number of assertions in the test suite.
we believe this is an interesting nding which explains why previous studies have found a strong correlation between suite size and e ectiveness.
.
implicit vs. explicit mutation score we noticed an interesting phenomenon namely that mutants that are implicitly detectable can also be detected by assertions if the mutated statement falls in the coverage of the assertion.
however mutants that are explicitly detectable by assertions can never be detected by non assertion statements of the tests.
this is because explicitly detectable mutants cannot be detected by simply executing the mutated part of a program i.e.
a speci c assertion statement is required to catch the program s unexpected behaviour.
this is due to the fact that explicitly detectable mutants inject logical faults into a program that lead to a contradiction with the programmers expectations.
from our observations more than half of all detectable mutants are explicitly detected by assertions in a test suite and therefore assertions strongly in uence test suite e ectiveness.
if we only focus on explicitly detectable mutants then test assertions are the only means to achieve suite e ectiveness.
this might also explain why statement coverage achieves a relatively low correlation with explicit mutation score.
.
statement vs. assertion coverage from ndings and assertion coverage is a good estimator of both mutation score and explicit mutation score.
if the in uence of assertion coverage is controlled there is a passable level of correlation between statement coverage and mutation score while only a weak correlation between statement coverage and explicit mutation score.
therefore 222statement coverage is a valid estimator of mutation score only under the assumption that not all of generated mutants are explicitly detectable mutants.
in other words statement coverage is not an adequate metric of logical fault detection ability.
statement coverage includes more statements than assertion coverage from source code without providing any extra insights for predicting test suite e ectiveness.
compared with statement coverage assertion coverage is very strongly correlated with the e ectiveness regardless of the distribution of implicitly or explicitly detectable mutants.
our results suggest that testers should aim at increasing the assertion coverage of their test suite instead of its statement coverage when trying to improve a test suite s e ectiveness.
.
utilizing assertion types our results also con rm that generated assertions are much less e ective than human written assertions and thus should only be used as a supplement of human written assertions instead of a replacement.
more interestingly findings and show us that assertion types can signi cantly in uence a test suite s e ectiveness.
therefore it is indispensable to consider the distribution of assertion types in a test suite when predicting its e ectiveness.
this is an interesting nding that merits more empirical investigation.
.
threats to validity internal validity to conduct the controlled experiments we made use of many existing tools such as pit clover and javaslicer .
we assumed these tools are able to produce valid results.
therefore any erroneous behaviours of these tools might introduce unknown factors to the validity of our results.
to mitigate such factors as much as possible we tested our own code that uses these external tools.
similar to previous studies we treated mutants that cannot be detected by the master test suites as equivalent mutants which might overestimate the number of equivalent mutants.
however since we are mainly concerned with the correlations between mutation explicit mutation score and the other metrics subtracting a constant value from the total number of mutants generated will not impact the correlations.
external validity we study the relationship between assertions and test suite e ectiveness using more than assertions collected from ve open source java programs.
however programs written in java may not be representative of the programs written in other languages.
thus our results might not extend to other languages.
moreover the assertions we examine in this paper are junit4 assertions and our results may not apply to assertions used in other testing frameworks.
we mainly looked at the assertions for jfreechart when comparing the e ectiveness of di erent assertion types.
although the set of assertions used is large and written by real developers our ndings may not generalize to other programs.
in addition there might be some interdependencies between assertion content types and assertion method types.
for instance it is di cult to control the confounding factor between assertions on the boolean content type and assertions that make use of asserttrue false method type as both will be present in each measurement we do not know if a particular e ectiveness correlation is due to the content type boolean or the assertion method type asserttrue false .
moreover we used pit to conduct mutation testing pit stops executing once a test assertion detects a mutant.
however it is helpful to know all the asser tions that would fail when studying assertion types.
we used randoop to generate test cases with assertions which were compared to human written assertions.
however there also exist other test oracle generation strategies than feedbackdirected random test generation and using a di erent test generation strategy might in uence the results.
we used randoop because of its relative ease of use.
our empirical data as well as the ve subject programs are all available online making our study repeatable.
.
conclusions in this paper we studied the relationship between test assertions and test suite e ectiveness.
first we examined the correlation between assertion quantity and the e ectiveness and further analyzed the in uence of assertion quantity on the correlation between test suite size and the e ectiveness.
second we investigated the relationship between assertion coverage and suite e ectiveness and explored the impact of assertion coverage on the relation between statement coverage and e ectiveness.
finally we compared the e ectiveness of di erent assertion characteristics.
based on an analysis of over assertions collected from ve cross domain realworld java programs we found that there is a very strong correlation between the number of assertions and test suite e ectiveness with or without controlling for the number of test methods in the test suite.
thus the number of assertions in a test suite can signi cantly in uence the prediction power of test suite size for the e ectiveness.
there is a very strong correlation between assertion coverage and test suite e ectiveness.
with assertion coverage controlled for there is a moderate to strong correlation between statement coverage and mutation score and only a weak to moderate correlation between statement coverage and explicit mutation score.
therefore statement coverage is an adequate metric of test suite e ectiveness only under the assumption that the faults to be detected are not only explicitly detectable while assertion coverage is a good estimator of test suite e ectiveness without such a constraint.
types of assertions can in uence the e ectiveness of their containing test suites human written assertions are more e ective than generated assertions assertions which assert on boolean object content types are more e ective than assertions that assert on string and number types and assertions with method type asserttrue false are more e ective than those with type assertequals not and assertnull not .
our results indicate that it might be su cient to use the assertion quantity and assertion coverage as criteria to measure a suite s adequacy since these two metrics are at least as good as suite size and statement coverage.
for future work we would like to conduct experiments on more programs to further validate our ndings.
moreover we will conduct a qualitative analysis of a set of assertions to understand the reasons behind the e ectiveness variations in di erent assertion types.
.