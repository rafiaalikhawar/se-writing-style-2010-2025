cognicrypt supporting developers in using cryptography stefan kr ger sarah nadi michael reif karim ali mira mezini eric bodden florian g pfert felix g nther christian weinert daniel demmler ram kamath paderborn university germany fistname.lastname uni paderborn.de university of alberta canada nadi karim.ali ualberta.ca technische universit t darmstadt germany reif mezini guenther weinert demmler cs.tu darmstadt.de fgoepfert cdc.informatik.tu darmstadt.de aramachandrakamath gmail.com abstract previous research suggests that developers often struggle using low level cryptographic apis and as a result produce insecure code.
when asked developers desire among other things more tool support to help them use such apis.
in this paper we present cognicrypt a tool that supportsdevelopers with the use of cryptographic apis.
cognicrypt assists the developer in two ways.
first for a number of common cryptographic tasks cognicrypt generates code that implementsthe respective task in a secure manner .
currently cognicrypt supports tasks such as data encryption communication over secure channels and long term archiving.
second cognicryptcontinuously runs static analyses in the background to ensure a secure integration of the generated code into the developer s workspace.
this video demo showcases the main features of cognicrypt youtube.com watch?v juq5mrhfa wy.
index t erms cryptography code generation variability modeling code analysis i. i ntroduction cryptography is the primary means of protecting sensitive data on digital devices from eavesdropping or forgery.
for this protection to be effective the used cryptographic algorithms must be conceptually secure implemented correctly and used securely in the respective application.
despite the availability of mature and still secure to use cryptographic algorithms several studies have indicated that application developersstruggle with using the application programming interfaces apis of libraries that implement these algorithms.
for example lazar et al.
investigated cryptographyrelated vulnerabilities and found that only are related to faulty implementations of algorithms while result from application developers misusing cryptographic apis.
other studies suggest that approximately of applications using cryptographic apis contain at least one misuse .
to investigate the reasons for this widespread misuse we previously triangulated the results of four empirical studies oneof which was a survey of java developers who previously used cryptographic apis .
our results show that the majority of participants found the respective apis hard to use.
when asked what would help them use these apis they suggested better documentation different api designs and additional toolsupport.
in terms of api design participants used terms like use cases task based and high level.
these suggestions indicate that developers struggle with the fact that cryptographic apisreside on the low level of cryptographic algorithms instead of being more functionality oriented apis that provide convenient methods such as encryptfile .
when it comes to tool support participants suggested tools like a cryptodebugger analysis tools that find misuses and provide code templates orgenerate code for common functionality.
these suggestions indicate that participants not only lack the domain knowledge but also struggle with apis themselves and how to use them.
in this paper we present cognicrypt an eclipse plugin that enables easier use of cryptographic apis.
in previous work we outlined an early vision for cognicrypt .
we have now implemented a prototype of the tool that currently supports developers in the following ways generate secure implementations for common programming tasks that involve cryptography e.g.
data encryption .
analyze developer code and generate alerts for misuses of cryptographic apis.
ii.
c ogni crypt in a nutshell we will use the cryptographic task encrypt data using a secret key enc as a running example throughout the paper.
when an application developer cognicrypt s user selects this task cognicrypt generates code that implements a simple encryption using java s cipher api.
figures and illustrate the steps that a user must follow in cognicrypt for enc.
first to trigger the code generation the user clicks on the cognicrypt button in eclipse s tool bar.
the dialog shown in figure then pops up and the user has to select both the target project for code generation and enc from the list of supported tasks.
the user then answers a few high level questions that do not require deep cryptography knowledge.
the answers to these questions help cognicrypt generate the appropriate source code.
one such question for enc is should your key be derived from a user specifiedpassword?
.
once the user has answered all questions for enc cognicrypt presents the user with a list of algorithms or combinations thereof in different configurations and autoselects the most secure one as shown in figure .
the user may change the selection through a drop down menu.
for the more keen user cognicrypt provides more detailed information about the selection in the same window.
after the user hits .
c circlecopyrt2017 ieeease urbana champaign il usa t ool demonstrations931 authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
.
dialog for task selection.
fig.
.
algorithm selection screen.
fig.
.
reporting misuses as eclipse error markers.
the finish button cognicrypt generates two code artefacts into the user s java project the code that implements enc into a package named crypto and a method that demonstrates how the user may use the generated code in their own project.
in addition to code generation cognicrypt notifies the user of misuses of cryptographic apis by running a static analysis suite automatically every time the code is compiled.
cognicrypt generates an eclipse error marker for each detected misuse of the supported cryptographic apis.
figure depicts a warning issued by cognicrypt when the user changes the generated code for enc to use the insecure encryption algorithm des.
iii.
g enera ting secure code cognicrypt s code generation component enables it to generate secure implementations for several cryptographic programming tasks.
each task in cognicrypt is specified using three artefacts a model describing the involved algorithms the task s implementation which cognicrypt may provide theuser with and a code snippet demonstrating its usage.
figure illustrates the general workflow and necessary artefacts.
we will refer to different parts of the elements in figure using the circled numbers shown in the figure e.g.
.
a. modelling cryptographic algorithms in clafer the cryptography domain comprises a wide range of algorithms each can be configured in multiple ways.
this variability becomes an issue for developers with little or no experience in cryptography because not all algorithms andconfigurations are secure to use in every context.
therefore developers have to figure out which algorithm may be usedin which situation.
to help developers close this knowledgegap we systematize the domain knowledge by means of a variability model 1using clafer a variability modelling language that facilitates a mix of class and feature modelling.
clafer supports two constraint solvers that can instantiate a model i.e.
generate instances of the model that satisfy all its constraints.
any element in clafer is called a clafer and can either be abstract or concrete.
the difference is that the instance generator does not create instances for abstract clafers.
in prior work we describe our modelling approach and discuss the trade offs of using other variability modelling languages.
figure shows a simplified version of the clafer model for enc in cognicrypt.
the model defines the abstract clafer algorithm in line .
lines define the attributes ofalgorithm name security and performance .
the model defines three abstract clafers that extend algorithm i.e.
inherit its attributes symmetricblockcipher line keyderivationalgorithm line and digest line .
each extension defines additional attributes.
moreover symmetricblockcipher defines two constraints lines .
the model then defines concrete clafers for all enc related cryptographic algorithms by extending the three algorithm type clafers lines .
finally the clafer definition forenc lines includes all its necessary cryptographic algorithms such as a symmetric block cipher line .
if the user decides to derive the key from a password the definition is updated to require a key derivation algorithm.
b. configuring a solution the generated code for each task is specified as an xslbased code template 5to enable code generation by an xsl transformation.
figure depicts an excerpt of the stylesheet for enc representing part of its implementation.
the code implements a simple encryption bootstrapped with an initialization vector.
since each task may be implemented in multiple ways the stylesheet may contain one or more variability points that is statements that depend on the configuration of task.
enc has one variability point the argument to the call cipher.getinstance lines .
the class cipher is used for encrypting data and the argument to getinstance specifies the encryption algorithm block mode and padding scheme of the encryption .
to generate valid code cognicrypt resolves this variability by asking the user questions to help it configure a solution .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
1abstract algorithm name string security integer performance integer 6abstract symmetricblockcipher algorithm keysize integer mode mode padding padding abstract keyderivationalgorithm algorithm iterations integer outputsize integer digest digest?
outputsize outputsize outputsize abstract digest algorithm outputsize integer aes symmetricblockcipher keysize keysize keysize keysize performance veryfast security medium keysize performance fast security strong des symmetricblockcipher sha 1 digest sha 256 digest pbkdf2 keyderivationalgorithm abstract task description string passwordbasedencryption task description encrypt data using a given password cipher symmetricblockcipher fig.
.
clafer model for the password based encryption enc programming task.
s lj d h yd y lj y d m nop qr s fig.
.
the workflow of code generation in cognicrypt.
for the supported currently tasks the authors have developed these questions.
the task selection determines the parts of the stylesheet that are relevant to the user and the questions that will be presented to the user.
for example for enc the user may choose to derive the key from a password.
if they do so cognicrypt automatically modifies the clafer model such that a key derivation algorithm is also required to implement the task not only a symmetric block cipher as shown in figure .
in general each answer either adds constraints to the clafer model e.g.
setting a security level of the cipher to high or very high or influences the generated code directly e.g.
by adding or removing a call or changing a parameter value .
after answering all questions cognicrypt runs the constraint solver choco on the clafer model to generate all its instances one of which is a version of the model with all variability resolved .
for the enc model in figure there are at least three distinct instances with different values for the keysize attribute of aes.
the result is a list of combinations of algorithms in different configurations that cognicrypt shows to the user in the final dialog sorted by security level in descending order.
cognicrypt automatically selects the first solution but the user can change the selection.c.
generating code cognicrypt stores the selected configuration in an xml file .
the code is then generated into the user s project under the package crypto by performing an xsl transformation using saxon bootstrapped with the stylesheet and the xml configuration file .
two code artefacts 7are generated the code implementing the task and a method that demonstrates how the developer can use the implementation.
this method is usually generated into an extra class in the same package as the generated implementation code.
in case a java file from the target project is currently opened in the editor cognicrypt generates the method into this file.
it also ensures the method is generated within the respective class but outsideexisting methods.
with the xsl stylesheet in figure and the configuration from figure as inputs cognicrypt generates the class enc in figure .
the developer may choose to keep the generated code as is or integrate it into their application code in a different way.
iv .
e nforcing secure implementa tions in addition to generating code cognicrypt continuously applies a suite of static analyses to the developer s projectin the background.
these analyses ensure that all usages ofcryptographic apis remain secure even when the developermodifies the generated code for better integration into their project or to add some functionality.
moreover if the developer uses the cryptographic apis directly i.e.
without using the code generation component running the analysis suite ensures secure usage of the apis.
to statically analyze the underlying eclipse project cognicrypt uses ts4j a fluent interface in java that defines and evaluates typestate analyses .
a typestate analysis helps cognicrypt determine the set of allowed operations in a specific context.
ts4j is implemented as an eclipse plugin on top of the static analysis framework soot .
cognicrypt reports misuses by generating error markers directly on the left gutter within the eclipse ide as shown in figure .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
xsl if test task algorithm type symmetricblockcipher xsl result document href enc.java package xsl value of select task package xsl apply templates select import public class enc public byte enc byte data secretkey key byte ivb new byte securerandom.getinstancestrong .nextbytes ivb ivparameterspec iv new ivparameterspec ivb cipher c cipher.getinstance xsl value of select task algorithm type symmetricblockcipher name xsl value of select task algorithm type symmetricblockcipher mode xsl value of select task algorithm type symmetricblockcipher padding c.init cipher.encrypt mode key iv byte res c.dofinal data byte ret new byte system.arraycopy ivb ret ivb.length system.arraycopy res ret ivb.length res.length return ret xsl result document xsl if fig.
.
xsl stylesheet for enc.
public class enc public byte enc byte data secretkey key byte ivb new byte securerandom.getinstancestrong .nextbytes ivb ivparameterspc iv new ivparameterspec ivb cipher c cipher.getinstance aes cbc pkcs5padding c.init cipher.encrypt mode key iv byte res c.dofinal data byte ret new byte system.arraycopy ivb ret ivb.length system.arraycopy res ret ivb.length res.length return ret fig.
.
generated code for enc.
figure depicts one of the ts4j rules used in cognicrypt to detect the usage of the outdated encryption algorithm des when instantiating a cipher object e.g.
line in figure .
the first part of the rule line tracks the parameter of calls to cipher.getinstance as defined in line and binds it to the temporary variable ciph .
the rule also stores the statement in variable getins for later reference.
after theorelse keyword line the rule checks whether the value bound to ciph equals des .
if that is the case cognicrypt reports the error des is used at the statement stored in getins as figure shows.
v. i ntegra ted components cognicrypt provides support for cryptographic apis in a task based manner.
in this section we discuss the tasks that cognicrypt currently supports providing short conceptual descriptions how they are implemented and the decisions users have to make in the tool.
we also discuss the cryptographic algorithms that cognicrypt supports.
string cipher call javax.crypto.cipher javax.crypto.cipher getinstance java.lang.string enum var ciph enum stmtid getins protected done var state stmtid atcalltoreturn atcalltoreturn var state stmtid d return d.atcallto cipher call .
always .trackparameter .as ciph .
and .storestmtas getins .
orelse .atassignto ciph .
ifvalueboundto ciph .startswith des .
reporterror des is used .atstmt getins fig.
.
ts4j rule to find usages of des.
a. supported tasks symmetric encryption a description encryption of data as a byte array.
b implementation implementations of symmetric block ciphers in sunjce provider such as aes triple des.
c user decisions cognicrypt asks the user whether the application encrypts large chunks of data.
if so encryption is performed iteratively on fractions of the plaintext instead.
subsequently it allows the user to decide whether the encryption key should be derived from a password or created by traditional means of a key generator.
password storage a description transformation of passwords such that they can be securely stored i.e.
hashing and salting .
b implementation implementations of key derivation functions in sunjce provider such as pbkdf2.
secure communication a description a cryptographic channel based on the transport layer security tls protocol for securely transporting data from one endpoint to another.
the channel ensures confidentiality and integrity of the communicated data as well as authenticity of the communication partners.
b implementation based on the java tls implementation in the java secure socket extension jsse .
c user decisions cognicrypt first asks the user whether they wish to implement the client or the server side of a connection requesting the corresponding internet address.
for client implementations if the server is already known cognicrypt offers to perform a trial connection to test connectivity andcryptographic parameters.
cognicrypt then allows the userto select the desired security level providing a safe defaultoption for optimal cryptographic protection.
in particular cognicrypt disables insecure cryptographic parameters i.e.
cipher suites .
this feature is crucial because tls has a vast number of parameter choices and in principle allows to configure insecure cipher suites that for example omit encryption or enable known attacks like rc4 weaknesses .
secure long term storage a description mops ensures the integrity and authenticity of documents over long periods of time sinceclassical protection schemes e.g.
digital signatures do not authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
provide everlasting security.
mops allows users to create customized long term protection schemes by combining reusable components extracted from other existing solutions improving performance and gaining flexibility.
b implementation the reference implementation of mops by weinert et al.
has a restful api for configuring and maintaining file collections on remote systems.
using the api without proper guidance the user may end up with a configuration that uses outdated cryptographic primitives e.g.
sha performs poorly due to improper component selection or relies on inappropriate trust assumptions.
c user decisions cognicrypt asks the user at most four high level questions e.g.
do you plan to add new files to your collection frequently?
.
these questions identify the required features and the trust assumptions the user is willing to make.
the clafer model then translates the user choices into the most suitable component selection based on the recommendations of weinert et al.
.
finally cognicrypt generates glue code to configure the mops system accordingly and provide methods for securely storing files in the system.
secure multi party computation a description aby is a framework for mixedprotocol secure two party computation stc .
it allows twoparties to apply a function to their private inputs and reveal nothing but the output of the computation.
aby enables developers to implement stc applications by offering abstractions from the underlying protocols.
furthermore aby can securely convert between different protocol types improving efficiency.
b implementation aby is written in c c to achieve high efficiency for the underlying primitives bit operations symmetric encryption and has been encapsulated in java native interface jni wrappers to be used by cognicrypt.
c user decisions cognicrypt offers the user several stc example applications e.g.
computing the euclidean distance between private coordinates.
the user can select different properties depending on the deployment scenario.
in the future we plan to integrate custom applications as well.
b. implementations of cryptographic algorithms cognicrypt mainly capitalizes on algorithm implementations from the java cryptography architecture jca .
for the first three tasks described above we have not implemented any cryptographic algorithms ourselves but merely accessed the existing ones through the jca apis.
in the future we would like cryptography experts to contribute new algorithm implementations to cognicrypt to extend support for even the most novel of cryptographic schemes.
the cryptography researchers among the authors have already started integrating an implementation of a novel public key cryptographic algorithm.
lindner and peikert present a new public key encryption algorithm lp11 based on the learning with errors problem.
as a lattice based primitive it is currently believed to withstand attacks on classical and quantum computers a property typically referred to as post quantum security.
for efficiency reasons we implemented lp11 in c and integrated it into cognicrypt using jni.
we made three methods of the c implementation available for java key generation encryption and decryption and implemented the necessary jca interfaces for encryption and key generation.
not only does this setup allow for an easy integration into cognicrypt but it also enables standalone usage of lp11.
unfortunately the interfaces provided by jca do not completely fit the properties of post quantum encryption schemes.
in particular the interface provides two methods for key pair generation one bootstrapped with a key size the otherone allowing for more parameters to be included in the keygeneration.
as one key size is not sufficient for lp11 our implementation only supports the other method.
calling the incorrect method causes cognicrypt to alert the developer and throws an unsupportedoperationexception at runtime.
vi.
r ela ted work we are not aware of any integrated tool that combines code generation and static analysis for misuses of java cryptographic apis.
however there has been a number of static analysis tools that detect misuses of cryptographic and other security apis in java .
unlike cognicrypt these tools do not provide any ide integration and have hard coded checks.
additionally cognicrypt enables cryptography experts who may not be experts in static analysis to define new rules more easily through ts4j.
cognicrypt generates task based usage examples for java crypto apis.
although similar tools exist they rely on the mining of syntactically correct usages ofthe respective apis which is not a viable approach for cryptographic apis for two reasons.
first many insecure usages of cryptographic apis may still result in syntactically correct programs.
second it appears that most usage examples of cryptographic apis in the wild are insecure causing the mining of such usages to be a difficult endeavour.
vii.
c onclusion cryptography can help secure sensitive data but only if applications use cryptographic components securely.
we have presented cognicrypt an eclipse plugin that enables developers to securely integrate such components into their java projects especially if they have little experience with cryptography.cognicrypt smoothly integrates into a developer s workflowto generate secure code for cryptographic tasks and detect misuses of cryptographic apis in their code.
for now all tasks have been integrated by the authors.
we plan to open source cognicrypt toward the end of and weencourage cryptography experts to integrate their own projectsinto it.
we also plan to conduct a user study to evaluate whethercognicrypt is capable of improving the security of the average developers code.