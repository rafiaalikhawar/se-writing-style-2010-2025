a programming model for sustainable software haitao steve zhu chaoren lin yu david liu ysuny binghamton binghamton ny usa email fhzhu1 clin18 davidl g binghamton.edu abstract this paper presents a novel energy aware and temperature aware programming model with first class support forsustainability .
a program written in the new language named eco may adaptively adjusts its own behaviors to stay on a given energy or temperature budget avoiding both deficit that would lead to battery drain or cpu overheating and surplus that could have been used to improve the quality of results.
sustainability management in eco is captured as a form of supply and demand matching and the language runtime consistently maintains the equilibrium between supply and demand.
among the efforts of energy adaptive and temperature adaptive systems eco is distinctive in its role in bridging the programmer and the underlying system and in particular bringing both programmer knowledge and application specific traits into energy optimization.
through a number of intuitive programming abstractions eco reduces challenging issues in this domain such as workload characterization and decision making in adaptation to simple programming tasks ultimately offering fine grained programmable and declarative sustainability to energy efficient computing.
eco is an minimal extension to java and has been implemented as an open source compiler.
we validate the usefulness of eco by upgrading real world java applications with energy awareness and temperature awareness.
i. i ntroduction two trajectories appear to shape up the evolution of modern computing platforms they become increasingly nimble or increasingly mighty.
nimble computers such as rfids wearable electronics smartphones tablets and laptops often operate on battery with a limited budget.
mighty computers represented by data centers cloud servers and many core clusters not only consume a large amount of energy but also face grave reliability concerns due to excessive heat dissipation with cooling taking up to of their operational costs .
effective energy and thermal management is a critical goal demanding solutions from all layers of the compute stack.
in recent years there is a growing interest in addressing these challenges from the perspective of application software e.g.
where energy and thermal efficiency is pursued and achieved throughout the software lifecycle.
in this paper we focus on an essential design goal in energy and thermal management sustainability .
a sustainable program is able to stay on budget neither yielding deficit nor surplus.
in the context where budget refers to available battery e..g. battery of a smartphone sustainability entails energy awareness the sustainable program makes the best effort to not exceed of battery usage no deficit the first and second authors have recently joined google inc. after completing the work at suny binghamton.
fig.
.
a sustainable program runtime while at the same time producing as high quality results as possible no surplus .
in the context where budget refers to the allowance of temperature increase e.g.
c sustainability entails temperature awareness avoiding overheating while producing the best results.
in essence sustainability captures a recurring theme in energy and thermal management balancing the trade off between energy thermal budget and the quality of computational results.
a.eco for sustainable programming our concrete proposal is eco a novel and simple programming model to help developers construct sustainable software by design.
as we look forward we believe programmers have a unique role in application level energy and thermal management and the future of software on nimble and mighty computing platforms belongs to applications that neither squander nor skimp on resources.
the key insight of the eco design is that sustainability can be achieved through the negotiation between supply and demand ultimately maintaining the equilibrium of the two in a fashion similar to market economics.
syntactically eco is a minimal extension to java with two important programming abstractions demand supply characterization aneco programmer may associate a fine grained program component of interest the demand with a budget the supply through a new construct called sustainable blocks adaptability support aneco programmer may define alternative application behaviors which may achieve the same application specific goal but with different quality levels through a principled and fine grained construct called first class mode cases throughout the execution of the code enclosed in the sustainable block the eco program runtime continuously monitors the change in demand and supply.
as demonstrated in figure the sustainable execution should have the remaining demand the solid line closely matches the remaining supply the dotted line .
if demand far exceeds supply at a snapshot ofthe execution the program adapts to program behaviors that may produce results in lower quality.
if supply far exceeds demand adaptation in the opposite fashion happens.
in a nutshell the design scope of eco subsumes programming abstractions to capture the essence of sustainable programming compiler inference algorithms to automatically identify program points for monitoring and adaptation and language runtime support to efficiently maintain the balance between demand and supply.
b. contributions to the best of our knowledge eco is the first programming model to provide first class support for characterizing negotiating and maintaining budget in energy aware and temperature aware applications.
this is also the first time fundamental concepts in market economics supply and demand are crystalized as programming abstractions.
in the context of existing energy thermal budget management systems most from vlsi architecture and os communities eco is distinctive in its attempt to bridge application software with underlying systems for at least three distinct reasons it elevates predominately system level concepts such as energy budgeting and temperature control to the forefront of application software development through supply characterization.
it taps the knowledge and insight of programmers to automate fine grained energy and thermal management through demand characterization.
it brings green conscious programmers into the equation of energy and thermal optimization through principled programmer defined adaptability support.
eco is a rigorously defined language but more importantly it is also a practical and expressive programming model for developing sustainable real world applications.
this paper places emphasis in highlighting eco s role in green software engineering how it empowers programmers with battery and temperature awareness how it helps balance the trade off between energy thermal efficiency and quality of service and what the recurring programming patterns in sustainable software are.
eco is developed as an open source compiler in summary this paper makes the following contributions it introduces a simple programming model to provide fine grained sustainability through supply demand characterization program transformations to automate and optimize sustainability management and a program runtime design to allow for supply demand negotiation.
it provides first class support to adaptive software.
the design considers the consistency in adaptation and seamlessly integrates adaptability and sustainability through compiler directed automatic calibration and adaptation.
it describes a set of common programming idioms which may serve as a first step toward understanding program 1modefl o midg 2modefmid h ig 4c l a s s r a y t r a c e rf mcase res r e s f l o new res mid new res h i new res 9g mcase i n t d e p t h f l o mid h i 15g ray getview camera camera res r e s f. .
.g image run camera camera model models f image images i n t num imax jmax imgs s u s t a i n a b l ef f o r num num imgs num f uniformf ray view getview camera r e s image image new image r e s imax r e s .
y jmax r e s .
x 29g f o r i n t i i imax i f f o r i n t j j jmax j f image .
s e t c o l o r i j view .
t r a c e models d e p t h 35g 36g images image 38g 39g bsupply .
b a t t e r y demand imgs imgs num return images 43g 44g 45c l a s s modelf.
.
.g model t o be r e n d e r e d 46c l a s s cameraf.
.
.g camera f o r r e n d e r i n g 47c l a s s imagef.
.
.g 2d a r r a y o f c o l o r p i x e l s 48c l a s s rayf.
.
.g ray 49c l a s s resf.
.
.g r e s o l u t i o n fig.
.
a battery aware raytracing application ming patterns in sustainable programming and constructing energy aware and temperature aware software.
it demonstrates the feasibility and effectiveness of sustainable programming through extending real world applications with the ability of battery awareness and temperature awareness enabled by an open source compiler.
ii.
s ustainable programming by example we use a simple raytracing example in figure to demonstrate the basic ideas of sustainable programming.
raytracing is a technique in rendering where an object in the form of a model is rendered into an image a 2d array of colored pixels based on the rays cast from the camera to the object.
eco is an extension to java with several notable features we highlight next.
a sustainable blocks an energy conscious programmer may declare the most expensive part of her program in sustainable blocks .
in this example the block encloses theray tracing for imgs number of images as shown between line and line .
the programmer can set a budget for executing this code fragment through supply characterization in line the budget also known as supply sum is set at of the remaining battery.
to help the language runtime correlate the change in battery over time and the progress of the program execution eco programmers are asked to provide a progress indicator through demand characterization .
in this simplified example the programmer just says that the demand sum i.e.
the overall number of units of work isimgs the number of images and at a given moment during the sustainable block execution the demand gauge the indicator for the remaining number of units of work is dependent on the loop index num i.e.
through expression imgs num .
based on supply characterization and demand characterization eco introspects the proportion of remaining demand i.e.
demand gauge relative to demand sum and the proportion of remaining supply i.e.
remaining battery supply relative to overall battery supply at various automatically determined checkpoints during the execution of the sustainable block and deem the execution i sustainable if the two are on similar levels ii deficit if the former significantly exceeds the latter iii surplus if the latter significantly exceeds the former.
b modes and first class mode cases whenever deficit or surplus happens the program adjusts itself guided by specifications of modes and first class mode cases.
borrowed from a previous work modes are a discrete characterization of energy adaptation states.
in line and line the program defines three modes lo mid and hi indicating the program may function under three different states of adaption.
in eco modes form a total order with lo mid hiin the example aligned with the intuition that the resulting code is likely to consume the least average most energy and produce results of the lowest average highest quality respectively.
modes matter in eco because they play a central role in the design of mode cases .
in a nutshell a mode case is a datacentric way to define alternative behaviors in the presence of energy adaption.
in the example two mode cases are defined as fields i the res field in line that says the raytracer may use the resolution of 480when program is executing thelomode in the mid mode and in the himode ii the depth field in line that says the depth of raytracer a key parameter to control the quality of raytracing may be either or depending on the mode of the executing program.
mode cases in eco arefirstclass values they can be assigned to variables passed around as method parameters or stored in fields.
to tie everything together the executing sustainable block downgrades the mode of its execution whenever deficit happens picking a precedent in the total order and the mode case used in that block can be intuitively viewed as automatically reduced to the value associated with the new mode a step we call mode case selection .
for example the fig.
.
potentially inconsistent results this image was produced by executing a variation of our sunflow benchmark a real world raytracing application detailed in section vi where the uniform block enclosing the image rendering is removed.
mode case of depth under the execution of mid mode would be selected into .
the scenario for surplus is similar except that the sustainable block upgrades its mode.
the described behavior here is aligned with our intuition of sustainability the program adapts to the less energy consuming behavior when it runs into a deficit and to the more energy consuming behavior when it runs into a surplus.
c uniform blocks coming with the flexibility of firstclass mode cases is a design challenge allowing for mode case selection at arbitrary time may yield results unacceptable to programmers.
for instance had we allowed the image resolution to change half way through raytracing an image the program may produce a picture such as figure whose uneven rendering may unsettle some programmers.
aneco programmer may choose to declare a block of code as uniform as in line to line .
this precludes mode change from happening during the execution of said block.
this consistency preserving construct is reminiscent of the property of atomicity .
d battery awareness and temperature awareness the example here is an instance of battery aware programming.
with minimal changes the same program can turn into a temperature aware one by simply changing line to tsupply the same sustainable block is to be executed with a temperature budget of c i.e.not raising cpu temperatures by more than c. the similarity and symmetry of battery aware programming and temperature aware programming in eco do not come as a surprise.
they are unified under the same philosophy just like the allowance of battery usage during a program execution can be viewed as a budget the allowance of temperature raise during a program execution can also be viewed as a budget.
as a consequence demand supply style characterization and programming are applicable to both goals and the unified programmer view is an attractive trait to improve programmer productivity.
indeed the unification of battery aware programming and temperature aware programming goes deeper than syntactical similarities.
as we shall see in the next section the bsupply andtsupply constructs are both syntactical sugars of a more general programming abstraction and the two hence share the same semantic definition.batterydef b getb sustainablefegbsupply e1 demand e2 e0 def num x b getb sustainablefegsupply e1 e1 x b getb demand e2 e0 temperaturedef t gett sustainablefegtsupply e1 demand e2 e0 def num x t gett sustainablefegsupply e1 e1 x t gett demand e2 e0 fig.
.
syntax desugaring for battery temperature aware sustainable programming let bandtvariables of batterymanager andtempmanager types respectively.
the batterymanager class encapsulates the program logic for interacting with battery hardware with one method getb to query the current battery level.
the tempmanager class encapsulates the program logic for interacting with temperature sensors with one method gett to query the current temperature iii.
t heecodesign syntax and runtime support a. syntax overview just like java an eco program consists of a sequence of classes with one containing the entry method main .
in addition an eco program allows for top level mode declarations in the form of mode m m. we require the relation defined through these declarations forms a total order.
we further call the least element and greatest element in the total order the least mode and greatest mode respectively.
implicitly parameterized by these top level mode declarations unary operators and are standard successive and precedent operators over total order.
furthermore we define masmif mis the greatest mode and masmifmis the least mode.
the core expressions of eco are defined as follows e uniformfeg expression j f m1 e1 mn eng jsustainablefeg c jselecte jcalibe jjava expressions c he e e ei characterizer numjxjmcaseh i type for simplicity we treat statements as expressions.
expression uniformfegdefines a uniform block whose body is e. we explain the rest of the syntax shortly.
a type in eco may take three forms a primitive type e.g.
integer float which is abstractly represented as num for simplicity here an object type x where xis the name of a class a type for the mode case value mcaseh i which says that the mode case has case members whose types are .
b. runtime behavior overview the unique runtime features of eco center around the execution of a sustainable block.
there the sum and remaining supply and the sum and remaining demand are monitored through checkpoints each of which we call a step ofsupply demand calibration or calibration for short.
this leads to four interconnected questions at the center of eco design q1 how to calibrate?
q2 how should the program adapt based on calibration through mode case selection ?
q3 when to calibrate?
q4 when to select mode cases?
we answer q1in section iii c3 and q2in section iii d. to decouple q3from q1 and q4from q2for presentation purposes we introduce two convenience expressions to make calibration point and mode case selection point explicit calibe and selecte.
the first expression says that calibration should be triggered after the evaluation of e and the second expression says that the mode case represented by eshould be selected.
in other words when we answer q1 and q2 we circumvent the when questions by assuming they are explicitly marked in the program.
in section iv we will introduce several program transformations to answer q3andq4 i.e.
automatically inserting calibeandselecte expressions to the eco source program.
c. syntactical and runtime support for sustainability syntax and encodings the general form of a sustainable block in eco is as follows s u s t a i n a b l ef code i n t h e s u s t a i n a b l e b l o c k g supply e1 e2 demand e3 e4 wheree1 e3 e4are the expressions for representing the supply sum demand sum demand gauge we informally introduced in sec.
ii respectively.
the additional expression e2is called the supply gauge an expression to indicate the remaining supply.
in this presentation we also abbreviate the sustainable block above as sustainablef g he1 e2 e3 e4i and further call he1 e2 e3 e4ithecharacterizer of the sustainable block.
indeed the sustainable blocks with bsupply and tsupply keywords introduced earlier are syntactic sugars which can be encoded as in fig.
.
as we shall see in sec.
v eco programmers can account for flexible forms of supply variability through supply gauge programming.
sustainable stack aeco program runtime maintains a key data structure called a sustainability stack represented by s or s stack for short.
the s stack maintains the contexts of sustainable uniform blocks at a runtime state each entry of this stack intuitively says that the current encountered program point is dynamically scoped in the sustainable uniform block represented by the entry with the top entry representing themost recently encountered scope.
there are two important features to highlight from this design eco supports sustainability management across lexical scopes.
eco supports nested sustainable blocks and nesting between sustainable blocks and uniform blocks.
the first support is a necessity for object oriented languages object