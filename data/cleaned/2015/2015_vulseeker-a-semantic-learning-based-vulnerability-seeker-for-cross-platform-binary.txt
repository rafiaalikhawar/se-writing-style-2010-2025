vulseeker a semantic learning based vulnerability seeker for cross platform binary jian gao school of software tsinghua university beijing china gaojian094 gmail.comxin yang school of software tsinghua university beijing china yangx16 mails.tsinghua.edu.cnying fu school of software tsinghua university beijing china fy17 mails.tsinghua.edu.cn yu jiang school of software tsinghua university beijing china jiangyu198964 .comjiaguang sun school of software tsinghua university beijing china abstract codereuseimprovessoftwaredevelopmentefficiency however vulnerabilities can be introduced inadvertently.
many existing works compute the code similarity based on cfgs to determine whether abinaryfunctioncontainsaknownvulnerability.unfortunately their performance in cross platform binary search is challenged.
this paper presents vulseeker a semantic learning based vulnerability seeker for cross platform binary.
given a target function and a vulnerable function vulseeker first constructs the labeled semanticflowgraphsandextractsbasicblockfeaturesasnumerical vectors for both of them.
then the embedding vector of the whole binaryfunctionis generated byfeedingthenumericalvectors of basicblockstothecustomizedsemanticsawarednnmodel.finally the similarity of the two binary functions is measured based on the cosine distance.
the experimental results show that vulseeker outperformsthestate of the artapproachesintermsofaccuracy.
forexample comparedtothemostrecentandrelatedworkgemini vulseeker finds50.
morevulnerabilitiesinthetop 10candidates and .
more in the top candidates and improves the values of auc and acc for .
and .
respectively.
the video is presented at ccs concepts security and privacy vulnerability scanners keywords semantic learning vulnerability search cross platform binary acm reference format jiangao xinyang yingfu yujiang andjiaguangsun.
.vulseeker a semanticlearningbasedvulnerabilityseekerforcross platformbinary.in proceedingsofthe201833rdacm ieeeinternationalconferenceonautomated software engineering ase september montpellier france.
acm newyork ny usa 4pages.
alsowith beijingnationalresearchcenterforinformationscienceandtechnology.
correspondence author permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
ase september montpellier france association for computing machinery.
acm isbn ... .
introduction inordertoimprovetheefficiencyofsoftwaredevelopment copypasteofcodeandreuseofthird partylibrariesarecommon.ifsuch adevelopmentprocessispoorlymanaged unpatchedvulnerable codecaneasilybepropagatedtodifferentsoftwareprograms.with thepopularityofterminaldevices softwareprogramsontraditional x86architecture aregraduallybeing compiledandported toother architectures e.g.
arm mips .
as a consequence more and more binary programs contain a large number of similar or identical vulnerable codes.
for example unpatched clone vulnerabilities are confirmed in the debian system .
manyworkshavebeenpresentedtoperformvulnerabilitysearch for cross platform binaries based on code clone techniques orfuzzytesting .mostoftheclone basedtechniques analyzethecontrolflowgraph cfg todeterminewhetherabinary containsvulnerabilitiesornot .theyperformwellon their settings but the accuracy and efficiency may lose coming across to large scale binaries.
in this paper we present vulseeker1 a semantic learning based vulnerabilityseekerforcross platformbinary.
vulseeker acquires a higher accuracy and efficiency through the labeled semantic flow graph lsfg construction and the semantics aware deep neuralnetwork dnn based function semantics generation.
the lsfg containsboththecfganddfg dataflowgraph somoresemantic information of a binary function is captured than using the cfg alone.
the semantics aware dnn model transforms numerical featuresofbasicblockswithinthefunctionintofunctionsemantics or embedding vector .
vulnerability is identified by measuring the similarity of two binary functions based onthe cosinedistance of their embedding vectors.
for evaluation we compare vulseeker with the state of the art cross platformbinaryclonevulnerabilitysearchapproachonsome widely used third party benchmarks consisting of real world applications.theexperimentalresultsshowthat vulseeker outperforms themostrecentandrelatedworkgemini .onaverage interms ofclonedetection theaucandacc of vulseeker are88.
and .
which are .
and .
higher than those of gemini.
furthermore weusethecve 1791vulnerabilitytoevaluate the vulnerability search capability in firmware images.
in the top and top most similar results vulseeker found .
and .
more real vulnerabilities than gemini.
1vulseeker is available at authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jian gao xin yang ying fu yu jiang and jiaguang sun 7dujhw elqdulhv 9xoqhudelolw gdwdedvh 9xoqhudelolw uhsruw frqvwuxfwlrq orfn ihdwxuh h wudfwlrq xqfwlrq vhpdqwlfv jhqhudwlrq edvhg rq pehgglqj yhfwru iru wdujhw pehgglqj yhfwru iru yxoqhudelolw 6lplodulw fdofxodwlrq a overall architecture and workflow of vulseeker .sxvk ues pry ues uvs vxe uvs k pry ues ydub hgl pry ues ydub pry ues ydub pry ues ydub fps ues ydub m vkruw orfb e dgg ues ydub pry hd ues ydub pry hd mps vkruw orfb orfb dgg ues ydub pry hd ues ydub pry hd pry ues ydub hd pry hd ohdyh uhwq b an example of the lsfg construction.
c an example of the block feature extraction.
figure1 vulseeker design.
a istheoverallarchitecture.
b c areexamplesforlsfgconstructionandblockfeatureextraction.
related work binary clone detection.
cop is a plagiarism detection tool that combines program semantics with longest common subsequencebasedfuzzymatching.
bingold extractsthesemantics of binary code in terms of both the dfg and the cfg and synthesizes them into a novel representation called the semantic flow graph.
however it does not support cross architecture clone detection.binsim calculatestheequivalencesofalignedsystem callstobetterhandlecodeobfuscation.itcombinesdynamicslicing with the weakest precondition calculation to identify fine grained semantic similarities between two execution traces.
vulnerability search.
bingo leverages selective inlining and length variant partial trace to compute function semantics whichconstitutefunctionmodelstoperformsimilaritycomparison and vulnerability search.
genius utilizes the spectral clustering to generate a codebook and calculates the similarity between a specificacfgandeachrepresentativeacfginthecodebookbased onthebipartitegraphmatchingalgorithm.
gemini extractsthe same lightweight features as geniusand only relies on the cfg to generate the embedding vector of the function.
then the similarity of two embedding vectors is measured to get a prediction result.
main difference.
differentfromtheabovework asfaraswe know vulseeker isthefirsttoolthatcombinescfganddfgtoform lsfg andappliesdeeplearningtoperformvulnerabilitysearchfor cross platform binary.
it extracts types of lightweight instruction features for each basic block in lsfg.
based on the graph topology and the revised semantics aware dnn model we apply layer iterations to the lsfg to obtain the semantic representation of the entire binary function and acquire higher accuracy.
3vulseeker design theoverallworkflowof vulseeker isshowninfigure a .itcontainsfourmajorcomponents lsfgconstruction blockfeatureextraction function semantics generation andsimilarity calculation.
the goal of vulseeker is to determine whether the target binary containsfunctions similartoknown vulnerabilitiesornot.
therefore itsinputistwobinaryfunctionsfromthetargetbinaryand the vulnerability database.
firstly vulseeker constructs the lsfgs forthetwobinaryfunctions.thenitextracts8typesoflightweight instruction features and encodes them as a numerical vector for eachbasicblockofthelsfg.functionsemanticsisgeneratedbyfeedingthenumericalvectorsofbasicblockswithinthelsfgto the semantics aware deep neural network dnn model.
finally vulseeker outputs whether the target binary function contains a knownvulnerabilityornotbasedonthesimilarityofembedding vectors of the two input functions.
.
lsfg construction labeledsemanticflowgraphcontainsboththecfgandthedata flow graph dfg and their edges are marked as and respectively.
its purpose is to improve the accuracy of function semantics generation because it considers both the control structure and the data transfer within a function which will effectively mitigate thestructuralinterferenceintroducedbythevaryingcfgunder different platforms.
figure b illustrates an example of the lsfg.
weuseidapython providedby idapro tocreatethecfg for the basic blocks of each binary function.
based on the cfg we infer whether there should be a data pointing edge between two basic blocks by leveraging the llvm ir plugin o nida pro.
for two instructions iandjfrom two different basic blocks which meet the cfg topology if the instruction iwrites a memory location and the instruction jreads the same memory address we createadatadependentedgeforthesetwoblocks.inaddition only the data dependencies between different blocks are preserved and thereisatmostonedatadependentedgebetweentwobasicblocks.
vulseeker stores the control edges and data edges of each function in two files.
.
block feature extraction byreferringtofeaturesusedinpreviousworks andexecuting a series of code clone experiments for different feature sets we havefinallydeterminedtouse8typesoffeaturesshownintable 1astheinitialsemanticrepresentationofeachbasicblock.these selectedfeaturesarelightweightandrobust whichcanbeeasily extractedandchangelittleundervariousimplementationplatforms withdifferentmicroprocessorarchitecturesandvariouscompilation optimization configurations.
we utilize the idapython to extract features for each basic block.
then we encode the features of each basic block as a numerical vector.
figure c is the numerical vectors of each basic block corresponding to the function in figure b .
for each binary function numerical vectors of all the basic blocks within the function are stored in a separate file.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
vulseeker a semantic learning based vulnerability seeker for cross platform binary ase september montpellier france table basic block level features used by vulseeker .
feature name example no.
of stack operation instructions push pop no.
of arithmetic instructions add sub no.
of logical instructions and or no.
of comparative instructions testno.
of library function calls call printf no.
of unconditional jump instructions jmp no.
of conditional jump instructions jne jb no.
of generic instructions mov lea .
function semantics generation the input of this component is the ddimensional initial numerical vectorsofallthebasicblockswithinthefunction andtheoutput isthepdimensionalembeddingvectorrepresentingthefunction semantics.topreciselycapturefunctionsemantics dataandcontrol dependencies between basic blocks along the lsfg topology need to be considered.
referring to the structure2vec neural network we propose a semantics aware dnn model shown in figure 2that specializes in processing structured lsfg representation.
figure the dnn model of vulseeker .
figure2 a is a lsfg denoted as angbracketleftv e angbracketright containing three vertices with initial numerical vectors x1 x2 x3 where vande representthevertexsetandedgeset respectively.edgesmarked and indicate data dependency and control dependency respectively.
the dnn model contains a total of tlayer iterations and each iteration transforms the initial numerical vector xiof each vertexiinto its embedding vector tildewide t i. after obtaining the embedding vectors of all the basic block vertices within the function we aggregatethemintothe pdimensionalembeddingvector tildewide ofthe function with the formula tildewide w2 i v tildewide t i where w2is ap p dimensional parameter matrix.
figure2 b illustrates the schematic diagram for generating the embeddingvector tildewide t iofeach vertex iduringthe t layeriteration.
the input of the transformation process consists of three different parts initial numerical vector xiof the corresponding vertex i the dotted arrow in figure a b the sum of previous embedding vectorsofverticespointingtovertex ithroughthecontroldependency denoted as c i and the sum of previous embedding vectors of vertices pointing to vertex ithrough the data dependency denoted asd i .theembeddingvectorofvertex iiscalculatedthroughthe formula tildewide t i tanh w1xi c j c i tildewide t j d j d i tildewide t j wherew1is ad pdimensional parameter matrix.
cand dare two nlayer fully connected networks responsible for calculating an embedding vector with more powerful representation capability they are represented as follows braceleftbigg c lc p1 relu p2 relu pn lc d ld q1 relu q2 relu qn ld wherenistheembeddingdepthofeachvertex piandqiarep p dimensionalparametermatrixes.through tlayeriterations the featureofeachvertexispropagatedtootherverticesastheiteration progresses along with the lsfg topology ensuring that each basic block of the function has corresponding context semantics.
.
similarity calculation once obtaining the embedding vector tildewide for target function and the embedding vector tildewide for vulnerable function vulseeker calculates their similarity with the cosinefunction hatwidey cos tildewide tildewide tildewide tildewide bardblex bardblex bardblex tildewide bardblex bardblex bardblex bardblex bardblex bardblex tildewide bardblex bardblex bardblex where hatwideyis the similarity score ranging from to .
if the similarity score hatwideyis larger than a pre defined threshold the target binaryfunctionisconsideredsimilartothevulnerability.weuse tensorflow to implement the semantics aware dnn model and apply the stochastic gradient descent algorithm to automatically learn model parameters such as w1 w2 p1andq1.
experimental results vulseeker mainlycontains3executablefilesthatcanbeusedbased on the following steps modify the config.py file to configure the targetprogramsforvulnerabilitysearch executethe command.py file to generate the lsfgs and extract initial numerical features forbasicblocks executethe search by list vulseeker.py fileto obtain the embedding vectors of functions and get the function list in descending order of similarity scores.
vulseeker isevaluatedontwodatasets.dataseticontains735 functionswith9 345k basicblocks.wecompile busybox v1.
.
openssl v1.
.1fandv1.
.1u and coreutils v6.5andv6.
in x86 x64 mips32 mips64 arm32 arm64 architectures using gcc v4.9andv5.
withoptimizationlevelso0 o3.datasetiiconsists of firmware images for various architectures from .
all experimentsareconductedondefaultconfigurationsofthednn modelasfollows theembeddingdepth nis2 theembeddingsize pis the number of iterations tfor each basic block is the training epoch is .
accuracy of code clone .we treat two different compiled versions of the same source function as a pair of similar functions and vice versa.
we randomly select pairs of similar functions and pairs of dissimilar functions from the dataset i to perform the comparative experiment with gemini configured with the optimal parameters .figure3istheirroc receiveroperatingcharacteristic curves of code clone.
we observe that the roc curve of vulseeker isabovegemini whichmeansthat vulseeker canachieve a higher true positive rate at the same false positive rate.
the auc value and acc value of vulseeker are .
and .
which are .
and .
higher than those of gemini.
in summary vulseeker outperforms gemini because in addition to the cfg we alsoconstructthedfgfortrackingtheusagesofvariablesbetweenbasicblocks.duringfunctionsemanticsgeneration weobtainmore robust semantic information with a revised dnn structure which is beneficial to the effective identification of clone functions.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jian gao xin yang ying fu yu jiang and jiaguang sun dovh 3rvlwlyh 5dwh 7uxh 3rvlwlyh 5dwh 9xo6hhnhu hplql figure roc curves of code clone.
furthermore the experimental result of gemini here is lower comparedwiththedescriptionoftheliterature .tworeasons lead to this situation.
one is that our dataset i contains programs but gemini onlycontains 2of them.the otheris thatwe compile theseprogramsintosixarchitectures includingthree64 bitones andgeminionlycompilesthemintothree32 bitones.thenumber of general purpose registers used in bit and bit architectures isdifferent whichaffectsthefeaturevectorsofbasicblocks and its results drop accordingly.
in their relatively simpler setting they couldacquiretheaucvalueof97 andwecouldimprovethevalue to almost .
we found that the more complex the dataset is the moreimprovements vulseeker wouldachieve andtheperformance of gemini drops faster than vulseeker for complex settings.
accuracy of vulnerability search .we employ dataset ii to evaluate the effectiveness of vulseeker and gemini in vulnerability search.wetake cve with48compiledversionsasthevulnerable function.
for each version of the vulnerability we employ the two tools to perform the search task from known vulnerable firmwareimages.foreachfirmwareimage wesortthefunctions indescendingorderoftheaveragesimilarityscoresfor48searches.
vulseeker ranksthevulnerabilityfunction8thonaverage whereas gemini ranks 99th on average.
if we take the highest rankings outof48searchesforeachfirmwareimage vulseeker hasa100 chanceoffindingthevulnerablefunctionintop 3candidateswhich is .
higher than gemini.
table the accuracy of vulnerability search top kgemini vulseeker num percent num percent forthesearchresultsofthe mips32versionvulnerability wesort thefunctionsinallfirmwareimagesindescendingorderofsimilarityscores.table 2showstheeffectivenessofvulnerabilitysearchon thetop kmostsimilarresultsamongallfunctions.column1isthe differentkvalue.
columns and are the number of real vulnerabilitiesinthetop kresults andcolumns3and5arethepercentage of corresponding real vulnerabilities.
we can see that vulseeker hasagreatimprovementonthesearchprecisionthangemini.intop results vulseeker finds more vulnerabilities than gemini.insummary vulseeker outperformsgeminiinthevulnerability search in terms of the cve .
we also do some evaluation on other cves and the performance improvements remain.
time cost .
vulseeker mainly consists of four components and for the size of the experimental database it can determine whether thegivenbinaryfunctioncontainsaknownvulnerabilitywithin an average of .
seconds while gemini takes about .
seconds.
function semantics generation takes up almost half of the time cost and its time cost grows linearly with the number of basic blocks within the function.
although the time cost of vulseeker is .
seconds more than gemini we can achieve a higher search accuracy in a reasonable time.
conclusion in this paper we present vulseeker a cross platform binary vulnerability seeker based on semantic learning.
with integrating the cfg and the dfg of the binary function we capture more function semantics.
experimental results show that vulseeker achieves .
auc value and .
acc value for code clone which improves8.
and12.
thangemini respectively.inthecase studyofcve 1791vulnerabilitysearch vulseeker finds50.
morevulnerabilitiesinthetop 10candidatesand13.
morein the top candidates.
for the time cost of vulnerability search vulseeker needs .
seconds to determine whether a function has aknownvulnerabilityornotintherelativelyhugedatabase.these demonstrate that vulseeker is suitable for vulnerabilitysearchof large scale code.