are code examples on an online q a forum reliable?
a study of api misuse on stack overflow tianyi zhang1ganesha upadhyaya2anastasia reinhardt3 hridesh rajan2miryung kim1 1university of california los angeles 2iowa state university 3george fox university tianyi.zhang miryung cs.ucla.edu ganeshau hridesh iastate.edu areinhardt14 georgefox.edu abstract programmers often consult an online q a forum such as stack overflowtolearnnewapis.thispaperpresentsanempiricalstudy on the prevalence and severity of api misuse on stack overflow.
to reduce manual assessment effort we design examplecheck a n apiusageminingframeworkthatextractspatternsfromover380k java repositories on github and subsequently reports potential apiusageviolationsinstackoverflowposts.weanalyze217 stack overflow posts using examplecheck and find that may have potential api usage violations that could produce unexpected behavior such as program crashes and resource leaks.
such api misuse is caused by three main reasons missing control constructs missingorincorrectorderofapicalls and incorrectguardconditions.
even the posts that are accepted as correct answers or upvoted by other programmers are not necessarily more reliable than other posts in terms of api misuse.
this study result calls for a newapproachtoaugmentstackoverflowwithalternativeapiusage details that are not typically shown in curated examples.
ccs concepts general and reference empirical studies software and its engineering softwarereliability collaborationinsoftware development keywords online q a forum api usage pattern code example assessment acm reference format tianyi zhang ganesha upadhyaya anastasia reinhardt hridesh rajan miryung kim.
.
are code examples on an online q a forum reliable?.inproceedingsoficse 40thinternationalconferenceonsoftware engineering gothenburg sweden may june icse pages.
anastasia reinhardt contributed to this work as a summer intern at ucla.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe firstpage.copyrights forcomponentsof thisworkowned byothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
icse may june gothenburg sweden copyright held by the owner author s .
publication rights licensed to association for computing machinery.
acm isbn ... .
introduction library apis are becoming the fundamental building blocks in modernsoftwaredevelopment.programmersreuseexistingfunctionalities in well tested libraries and frameworks by stitching api callstogether ratherthanbuildingeverythingfromscratch.online q a forums such as stack overflow have a large number of curatedcodeexamples .thoughsuchcuratedexamplescan serve as a good starting point they could potentially impact the quality of production code when integrated to a target application verbatim.recently fischeretal.findthat29 ofsecurity related snippetsinstackoverflowareinsecureandthesesnippetscould havebeenreusedbyover1millionandroidappsongoogleplay which raises a big security concern .
previous studies have also investigatedthequalityofonlinecodeexamplesintermsofcompilability uncheckedobsoleteusage andcomprehension issues .however noneofthesestudieshaveinvestigatedthereliability of online code examples in terms of api usage correctness.
there is also no tool support to help developers easily recognize unreliable code examples in online q a forums.
thispaperaimstoassessthereliabilityofcodeexamplesonstack overflow by contrasting them against desirable api usage patterns minedfromgithub.ourinsightisthatcommonlyrecurringapi usagefromalargecodecorpusmayrepresentadesirablepattern that a programmer can use to assess or enhance code examples on stack overflow.
the corpus should be large enough to provide sufficientapiusageexamplesandtominerepresentativeapiusage patterns.
we also believe that quantifying how many snippets are similar or related but not similar to a given example can improve developers confidence about whether to trust the example as is.
therefore we design an api usage mining technology examplecheck that scales to over 380k github repositories without sacrificing the fidelityandexpressiveness of the underlying api usagerepresentation.byleveraginganultra large scale software mininginfrastructure examplecheck efficientlysearches over github and retrieves an average of code snippets fora given api within minutes.
we perform program slicing toremove statements that are not related to the given api which improves accuracy in the mining process section .
we combine frequent subsequence mining and smt based guard condition mining to retain important api usage features including the temporal orderingofrelatedapicalls enclosingcontrolstructures andguard conditions that protect an api call.
in terms of our study scope we target java and android apis that are frequently discussed onstackoverflow.wetheninspectallpatternslearnedby examplecheck create a data set of desirable api usage patterns for the100apis andstudytheextentofapimisuseinstackoverflow.
acm ieee 40th international conference on software engineering authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhang upadhyaya reinhardt rajan kim a an example that does not close filechannel properly1 b an example that misses exception handling2 figure two code examples about how to write data to a file using filechannel on stack overflow outof217 818sopostsrelevanttoourapidataset contain potentialapimisusethatcouldproducesymptomssuchasprogram crashes resourceleaks andincompleteactions.suchapimisuseis causedbythreemainreasons missingcontrolconstructs missingor incorrect order of api calls and incorrect guard conditions.
database crypto and networking apis are often misused since they often require observing the ordering between multiple calls and complex exception handling logic.
though programmers often put more trustonhighlyvotedpostsinstackoverflow wedonotobserve a strong positive nor negative correlation between the numberof votes and the reliability of stack overflow posts in terms of api usage correctness.
this observation suggests that votes alone should not be used as the single indicator of the quality of stack overflow posts.
our study provides empirical evidence about the prevalence and severity of api misuse in online q a posts and indicates that stack overflow needs another mechanism that helps userstounderstandthelimitationofexistingcuratedexamples.we propose a chrome extension that suggests desirable or alternative api usage for a given stack overflow code example along with supporting concrete examples mined from github.
motivating examples supposealicewantstowritedatatoafileusing filechannel .alice searchesonstackoverflowandfindstwocodeexamples bothof whichareacceptedascorrectanswersandupvotedbyotherprogrammers asshowninfigure1.thoughsuchcuratedexamplescan serve as a good starting point for api investigation both examples have api usage violations that may induce unexpected behavior in realapplications.ifaliceputstoomuchtrustonthegivenexample as is she may inadvertently follow less ideal api usage.
the first post in figure 1a does not call filechannel.close to close the channel.
if alice copies this example to a program that not heavily access new file resources this example may behave properly because os will clean up unmanaged file resources eventually after the program exits.
however if alice reuses the example in a long running program with heavy io such lingering file resources may cause file handle leaks.
since most operating systems limit the number of opened files unclosed file streams caneventuallyrunoutoffilehandleresources .alicemayalsolose cacheddatainthefilestream ifsheuses filechannel towriteabig volume of data but forgots to flush or close the channel.
even though the second example in figure 1b calls filechannel .close it does not handle the potential exceptionsthrown by filechannel.write .calling writecouldthrow closedchannelexception if the channel is already closed.
if alice uses filechannel in a concurrent program where multiple threads attempt to access the samechannel asynchronouscloseexception willoccurifonethread closes the channel while another thread is still writing data.
as a novice programmer alice may not easily recognize the potential limitation of given stack overflow examples.
in this case our approach examplecheck scans over 380k github repositories and finds github snippets that also call filechannel.write .
examplecheck thenlearnstwocommonusagepatternsfromthese relevant github snippets.
the mostly frequent usage supportedby code snippets on github indicates that a method call to write must be contained inside a tryandcatchblock.
another frequentusagesupportedby1267githubsnippetsindicatesthat writemust be followed by close.
by comparing code snippets in figures 1a and 1b against these two api usage patterns alice may consider adding a missing call to closeand an exception handling block during the example integration and adaptation.
api usage mining and pattern set as it is difficult to know desirable or alternative api usage a priori wedesignanapiusageminingapproach called examplecheck thatscalestomassivecodecorporasuchasgithub.wetheninspecttheresultsmanuallyandconstructadatasetofdesirableapiusage to be used for the stack overflow study in section .
intermsofapiscope wetarget100popularjavaapis.fromthe stackoverflowdumptakeninoctober2016 3wescanandparse all java code snippets and extract api method calls.
we rank the apimethodsbasedonfrequencyandremovetrivialonessuchas system.out.println .asaresult weselect70frequentlyusedapi methodsonstackoverflow.theyareindiversedomains including android collection documentprocessing e.g.
string xml json graphical user interface e.g.
swing io cryptography security java runtime e.g.
thread process database networking date andtime.therest30apiscomefromanapimisusebenchmark mubench afterweexcludethosepatternswithoutcorrespondingsopostsandthosethatcannotbegeneralizedtootherprojects.
given an api method of interest examplecheck takes three phasestoinferapiusage.inphase1 givenanapimethodofinterest examplecheck searchesgithubsnippetsthatcallthegiven api method removes irrelevant statements via program slicing andextractsapicallsequences.inphase2 examplecheck finds commonsubsequencesfromindividualsequencesofapicalls.in phase3 toretainconditionsunderwhicheachapicanbeinvoked accessed on oct .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
are code examples on an online q a forum reliable?
icse may june gothenburg sweden sequence call sequence structure sequence sequence call name t1 ...tn condition structure if else loop try catch t finally condition boolean expression name method name t argument type exception type figure grammar of structured api call sequences examplecheck mines guard conditions associated with individual apicalls.inordertoaccuratelyestimatethefrequencyofunique guard conditions examplecheck uses a smt solver z3 to checkthesemanticequivalenceofguardconditions insteadofconsidering the syntactic similarity between them only.
we manually inspectallinferredpatternstoconstructthedatasetofdesirable apiusage.thisdatasetisusedtoreportpotentialapimisusein the stack overflow posts in our study discussed in section .
.
structured call sequence extraction and slicing on github given an api method of interest examplecheck searches individualcodesnippetsinvokingthesamemethodinthegithubcorpora.
examplecheck scans380 125javarepositoriesongithub collected onseptember2015.tofilteroutlow qualitygithubrepositories we only consider repositories with at least revisions and contributors.
to scale code search to massive corpora examplecheck leverages a distributed software mining infrastructure to traverse the abstract syntax trees asts of java files.
examplecheck visits every ast method and looks for a method invocation of the apiofinterest.figure3showsacodesnippetretrievedfromgithub forthefile.createnewfile api.thissnippetcreatesapropertyfile if it does not exist by calling createnewfile line .
toextracttheessenceofapiusage examplecheck modelseach codesnippetasastructuredcallsequence whichabstractsawaycertainsyntacticdetailssuchvariablenames butstillretainsthe temporal ordering control structures and guard conditions of api calls in a compact manner.
figure defines the grammar of our api usage representation.
a structured call sequence consists of relevantcontrolstructuresandapicalls separatedbythedelimiter .thisdelimiterisisaseparatorinourpatterngrammarin figure2 notasemi colonforendingeachstatementinjava.we resolve the argument types of each api call to distinguish method overloading.incertaincases theargumentconsistsofacomplex expression such as write e.getformat where the partial programanalysismaynotbeabletoresolvethecorrespondingtype.
inthatcase werepresentunresolvedtypeswith whichcanbe matchedwithanyothertypesinthefollowingminingphases.each api call is associated with a guard condition that protects its usage ortrue if it is not guarded by any condition.
catch blocks are also annotated with the corresponding exception types.
we nor malizeacatchblockwithmultipleexceptiontypessuchas catch ioexception sqlexception ... tomultiplecatchblockswith a single exception type such as catch ioexception ... catch sqlexception ... .1voidinitinterfaceproperties string temp file ddir 2if !temp.equals quotedblvarprops.txt quotedblvar 3log.error quotedblvarwrong template.
quotedblvar return load default properties 7fileinputstream in newfileinputstream temp 8properties prop newproperties 9prop.load in init properties 11prop.set quotedblvarinterface quotedblvar properties.interface 12prop.set quotedblvaruri quotedblvar properties.uri 13prop.set quotedblvarversion quotedblvar properties.version write to the property file 15string fpath ddir.getabosulatepath quotedblvar interface.prop quotedblvar 16file file new file fpath 17if !file.exists 18file.createnewfile 20fileoutputstream out new fileoutputstream file 21prop.store out null 22in.close figure this method is extracted as an example of file.createnewfile fromthegithubcopora.programslicing only retains the underlined statements when kbound is set to since they have direct control or data dependences onthe focal api call to createnewfile at line .
examplecheck builds the control flow graph of a github snippet and identifies related control structures .
a control structureisrelatedtothegivenapicall ifthereexistsapathbetween the two and the api call is not post dominated by the controlstructure.
for instance the api call to createnewfile line is control dependent on the ifstatements at lines and in figure .from eachcontrol structure we liftthe containedpredicate.
this process is a pre cursor for mining a common guard condition that protects each api method call in phase .
we use the conjunction of the lifted predicates in all relevant control structures.
if an api call is in the false branch of a control structure we negatethepredicatewhenconstructingtheguard.infigure3 since createnewfile is in the false branch of the ifstatement at line andthetrue branchofthe ifstatementatline17 itsguardcondition istemp.equals quotedblvarprops.txt quotedblvar !file.exists .
the process ofliftingcontrolpredicatescanbefurtherimprovedviasymbolic execution to account for the effect of program statement before an api call.
project specific predicates and variable names usedin the guard conditions are later generalized in phase to unify equivalent guards regardless of project specific details.
examplecheck performs intra procedural program slicing tofilteroutanystatementsnotrelatedtotheapimethodofinterest.
forexample properties apicallsinfigure3shouldberemoved since they are irrelevant to createnewfile .
during this process examplecheck usesbothbackwardandforwardslicingtoidentify data dependent statements up to khops.
setting kto retains onlyimmediatelydependentapicallsinthecallsequence while settingkto includes all transitively dependent api calls.
for instance the properties apissuchas load line9 and set lines1113 are transitively dependent on createnewfile through variables file out andprop.
table shows the call sequences extracted from figure with different kbounds.
by removing irrelevant statements program slicing significantly reduces the mining effort authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhang upadhyaya reinhardt rajan kim bound variables structured call sequence k file new file if createnewfile new fileoutputstream k 2file fpath outgetabsolutepath new file if createnewfile new fileoutputstream store k 3file fpath out prop new properties load set set set getabsolutepath new file if createnewfile new fileoutputstream store k file fpath out prop in tempnew fileinputstream new properties load set set set getabsolutepath new file if createnewfile new fileoutputstream store close no slicingfile fpath out prop in temp logif debug new fileinputstream new properties getabsolutepath load set set set new file if createnewfile new fileoutputstream store close table structured call sequences sliced using kbounds.
guard conditions and argument types are omitted for presentation purposes.
and also improves the mining precision.
setting kto leads to best performance empirically discussed in section .
.
frequent subsequence mining givenasetofstructuredcallsequencesfromphase1 examplecheck finds common subsequences using bide .
computing the common subsequence is widely practiced in the literature of api usage mining and has the benefit of filtering out api calls pertinent to only a few outlier examples.
in this phase examplecheck focuses on mining the temporal ordering of api calls only.
the task of mining a common guard condition is done in phase3instead.
bideminesfrequentclosedsequences aboveagiven minimum support threshold .
a sequence is a frequent closed sequence if it occurs frequently above the given threshold and there is no super sequence with the same support.
when matching api signature examplecheck matches with any other types in the same position in an api call.
for example write int can be matched with write int string but will not be matched withwrite string int .examplecheck ranks a list of sequence patterns based on the number of supporting github examples which we call support.
examplecheck filters invalid sequence patterns that do not follow the grammar in figure as frequentsub sequence mining can find invalid patterns with unbalanced brackets such as foo true .
.
guard condition mining givenacommonsubsequencefromphase2 examplecheck mines the common guard condition of each api call in the sequence.
the rationale is that each method call in the common subsequence may have a guard toensure that the constituent api call does not leadtoafailure.therefore examplecheck collectsallguardconditions from each call from phase and clusters them based on semanticequivalence.theguardconditionsextractedfromgithub often contain project specific predicates and variable names.
in figure3 theidentifiedguardconditionof createnewfile line18 istemp.equals quotedblvarprops.txt quotedblvar !file.exists .
its first predicate temp.equals quotedblvarprops.txt quotedblvar checks whether a string variable temp contains a specific content.
neither the variable tempnor the predicate are related to the usage of createnewfile .
therefore examplecheck first abstracts away such syntactic details before clustering guard conditions.
for each guard condition from phase api call guard generalized symbolized s.substring start start start s.length start start s.length arg0 arg0 rcv.length log.substring index index index log.length index index log.length arg0 arg0 rcv.length f.substring f.indexof dir!
null f.indexof f.indexof f.length true f.indexof f.indexof f.length true arg0 arg0 rcv.length table example guard conditions of string.substring .api callshows three example call sites.
guardshows the guard condition associated with each call site.
generalized shows theguardconditionsaftereliminatingproject specificpredicates.symbolized shows the guard conditions after symbolizing variable names.
examplecheck removesproject specificpredicates i.e.
predicates that do notmention the receiver object or inputarguments of the givenapicall bysubstitutingthemwith true.thisensuresthat thegeneralizedguardconditionisstillimpliedbytheoriginalguard afterremovingproject specificpredicates.inaddition sinceeach code snippet may use different variable names we normalize these namesintheguardconditions.
examplecheck usesrcvandargi as the symbolic names of the receiver and the i th input argument.
table illustrates how we canonicalize guard conditions of string.substring .thismethodtakesanintegerindexasinputand returnsasubstringthatbeginsfromthegivenindex.thethirdguard conditionincolumn guardcontainsaproject specificpredicate dir!
null .sincesuchpredicateisnotrelatedto string.substring s argumentsorreceiverobject examplecheck substitutes dir!
null withtrue as shown in column generalized.
all three examples name the receiver object differently s log andfrespectively.
examplecheck replacesthemwithauniquesymbol rcv.similarly examplecheck replacestheinputargumentwith arg0 asshown in column symbolized.
examplecheck initializes each cluster with each canonicalized guard.
in the following clustering process examplecheck checks theequivalenceofeverypairofclustersandmergesthemwithif theguardsarelogicallyequivalent untilnomoreclusterscanbe merged.attheend wecountthenumberofguardconditionsineach cluster as frequency.
in a large corpus the same logic pred icate can be expressed in multiple ways.
examplecheck checks thesemanticequivalenceofguard conditions insteadofsyntactic similarity only.
examplecheck formalizes the equivalence of two guard conditions as a satisfiability problem p qis valid iff.
p q p q is unsatisfiable.
examplecheck uses a smt solver z3 to check the logical equivalencebetweentwoguardsduringthemergingprocess.as z3onlysupportsprimitivetypes examplecheck declaresvariables of unsupported data types as integer variables and substitutes constants such as nullwith integers in z3 queries.
in addition examplecheck substitutes api calls in a predicate to symbolic variables basedontheirreturntypes.comparedwithpriorwork examplecheck iscapableofprovingthesemanticequivalenceofarbitrarypredicatesregardlessoftheirsyntacticsimilarity.forexample thesymbolizedguardsofthefirsttwoexamplesintable2areequivalent eventhoughtheyareexpressedindifferentways arg0 authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
are code examples on an online q a forum reliable?
icse may june gothenburg sweden arg0 rcv.length and arg0 arg0 rcv.length respectively.
prior work cannot reason about the equivalence between arg0and0 arg0.
however examplecheck groups these logically equivalent predicates into the same cluster using the integer theorem prover in z3.
ifexamplecheck identifies a sequence pattern containing multiple guard patterns for each api call examplecheck enumerates different guards for each api and ranks these patterns by the number of supporting code examples in the corpora.
similar to the subsequencemininginphase2 examplecheck usesaminimum support threshold to filter infrequent guard conditions.
we bootstrap examplecheck with both the sequence mining threshold andtheguardconditionmining threshold setto0.
whichmeans sequenceand guard conditionpatterns arereported only if more than half of relevant github snippets include them.
if examplecheck learnsnopatternswiththeseinitialthresholds we graduallydecreaseboththresholdsby0.1tillfindingpatterns.ifthe miningprocessdoesnotterminateafter2hoursduetotoomany candidatepatterns wekilltheprocessandincreaseboththresholds by0.1accordingly.thisthresholdadjustmentmethodisempirically effective to achieve a good precision .
.
manual inspection of mined api usage examplecheck scansover380kgithubprojectsandfindsanaverage of relevant code snippets for each api method ranging from to snippets.
this result indicates that massive corpora can provide sufficient code snippets to learn api usage patterns from.
examplecheck infers api usage patterns for the apis in our study scope.
this initial set of patterns mayinclude invalid or incorrect patterns.
therefore we manually inspectthe245inferredpatternscarefullyandexcludeincorrectones based on online documentation and pattern frequencies.
the overall precision is resulting in validated correct patternsthat we can use for the empirical study in section .
these validated patterns cover of the api methods.
the rest apimethodsdonotconvergetoanyapiusagepatternsthatcan be confirmed by online documentation since they are simple touse and do not require additional guard conditions or additional apicalls.forexample system.nanotime canbeusedstand aloneto obtain the current system time.
even though these api methods do not have any patterns we still include them in the scope ofstack overflow study since they represent a category of simple api methods that programmers are less likely to make mistakes.
duringtheinspectionprocess eachpatternisannotatedaseither alternative orrequired.acodesnippetshouldsatisfyoneofalternative patterns and must satisfy all required patterns.
for example examplecheck learnsfirstkey rcv.size andfirstkey !rcv.isempty forsortedmap.firstkey .
both patterns ensure that a sorted map is not empty before getting the first key to avoid nosuchelementexception .
they are considered alternative to each other.
as an example of required patterns programmers musthandle potential ioexception when reading from a stream e.g.
filechannel and close it to avoid resource leaks.
table3shows25samplesofvalidatedapipatternsin9domains.
alternative patterns are marked with .
column description describes each pattern.
for instance typedarray is allocated from astaticpooltostorethelayoutattributes wheneveranewapplication view is created in android.
it should be recycled immediately to avoid resource leaks and gc overhead as mentioned in the javadoc.4thispatternissupportedby2126of3348relatedsnippets in github and inferred by examplecheck ranked .
the entire data set of api usage patterns for all apis and the list of sopostswithpotentialapiusageviolationsarepubliclyavailable.
api misuse study on stack overflow we use the data set of validated desirable api usage patterns from section and study api misuse in stack overflow posts.
.
data collection we collectallstackoverflowpostsrelevanttothe100java apisin our study scope from the stack overflow data dump.
we extractcode examples in the markdown code from so posts with the javatagandconsidercodeexamplesintheanswerpostsonly since code appearing in the question posts is buggy and rarely usedas examples.
we gather additional information associated with eachpost includingviewcounts votescores i.e.
upvotesminus downvotes and whether a post is accepted as a correct answer.
previous studies have shown that online code snippets are often unparsable andcontainambiguousapielements due to the incompleteness of these snippets.
examplecheck leverages a state of the art partial program parsing and type resolution technique to handle these incomplete snippets whose accuracy of api resolution is reported to be .
code examples that call overridden apis or ambiguous apis i.e.
apis with the same name but fromdifferentjavaclasses arefilteredbycheckingtheargument andreceivertypesrespectively.intotal wefind217 818soposts with code examples for the apis in our study scope.
each post has view counts on average.
examplecheck checks whether the structured call sequence of astackoverflowcodeexampleis subsumed bythedesirableapi usageinthepatternset.astructuredcallsequence sissubsumedby a pattern p only ifpis a subsequence of sand the guard condition ofeachapicallin simpliestheguardofthecorrespondingapicall inp.duringthissubsumptioncheckingprocess theguardconditions in stack overflow code examples are generalized in the same mannerbeforecheckinglogicalimplicationusingz3.forasopost with multiple method level code snippets examplecheck inlines invoked methods before extracting the structured call sequence in order to emulate a lightweight inter procedural analysis.
.
manual inspection of stack overflow to check whether stack overflow posts with potential api misuse reported by examplecheck indeed suggest undesirable api usage thefirstandthethirdauthorsmanuallycheck400randomsamples ofsopostswithreportedapiusageviolations.wereadthetextdescriptions and comments of each post and check whether thesurrounding narrativediscusses howto prevent theviolatedpattern.
if there are multiple code snippets in a post we first combine themalltogetherandcheckthemasasinglecodeexample.wealso account for aliasing during code inspection.
we examine whether authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhang upadhyaya reinhardt rajan kim domain api pattern support description collectionarraylist.get loop get int arg0 rcv.size check if the index is out of bounds iterator.next iterator true loop next rcv.hasnext check if more elements exist to avoid nosuchelementexception iofile.createnewfile if createnewfile !rcv.exists check if the file exists before creating it file.mkdir mkdirs true callmkdirsinstead which also create non existent parent directories filechannel.write try write bytebuffer true close true catch ioexception close the filechannel after writing to avoid resource leak printwriter.write try write string true close true catch exception close the printwriter after writing to avoid resource leak stringstringtokenizer.nexttoken nexttoken rcv.hasmoretokens check if more tokens exist to avoid nosuchelementexception scanner.nextline loop nextline rcv.hasnextline check if more lines exist to avoid nosuchelementexception string.charat charat int arg0 rcv.length check if the index is out of bounds regexmatcher.find matcher string true find true callmatcherto create a matcherinstance first matcher.group if group int rcv.find check if there is a match first to avoid illegalstateexception databasesqlitedatabase.query query string string string string string string string true close true close the cursor returned by queryto avoid resource leak resultset.getstring try getstring string rcv.next catch exception check if more results exist to avoid sqlexception cursor.close finally close rcv!
null callclosein a finally block androidactivity.setcontentview oncreate bundle true setcontentview view true always call super.oncreate first to avoid exceptions typedarray.getstring getstring int true recycle true recycle the typedarray so it can be reused by a later call sharedpreferences.editor.edit edit true commit true commit the changes to sharedpreferences applicationinfo.loadicon getpackagemanager true loadicon packagemanager true get apackagemanager as the argument of load cryptomac.dofinaltry getinstance string true getbytes true dofinal byte true catch exception get amacinstance first and convert the input to bytes messagedigest.digest getinstance string true digest true get amessagedigest instance first networkjsoup.connect try connect string true get true catch ioexception callgetto fetch the web content url.openconnection try new url string true openconnection true catch exception create a urlobject first and handle potential exceptions httpclient.execute new httpget string true execute httpget true create a httpgetobject as the argument of execute swingswingutilities.invokelater new runnable true invokelater runnable true create a runnable object as the argument of invokelater jframe.setpreferredsize setpreferredsize dimension true pack true callpackto update the jframewith the preferred size table samples of manually validated api usage patterns after github code mining.
thereportedapiusageviolationcouldproduceanypotentialbehavioranomaly suchasprogramcrashesandresourceleaksona contrivedinputdataorprogramstateandwhethersuchanomaly could have been eliminated by following the desirable pattern.
for short posts this inspection takes about minutes each.
for longer posts with a big chunk of code or multiple code fragments it takes around to minutes.
to reduce subjectivity the two authors inspectthesepostsindependently.theinitialinter rateragreement is .
measured by cohen s kappa coefficient .
the two authors resolve disagreements on all but two posts and the kappacoefficient after the discussion is .
.
the two authors disagree how helpful reported violations are in two posts where api usage violations in these posts are either clarified in surrounding natural language explanations or mentioned in post comments.
true positive.
out of inspected stack overflow posts containrealapimisuse confirmedbybothauthors.forinstance thefollowingexampledemonstrateshowtoretrieverecordsfrom sqlitedatabase usingcursorbutforgetstoclosethedatabase connection at the end.6programmers should always close the connectiontoreleaseallitsresources.otherwise itmayquicklyrun out of memory when retrieving a large volume of data from the database frequently.
1publicarraylist userinfo get user by id string id 2arraylist userinfo listuserinfo newarraylist userinfo 3sqlitedatabase db this.getreadabledatabase 4cursor cursor db.query ... if cursor !
null while cursor.movetonext userinfo userinfo newuserinfo userinfo.setappid cursor.getstring cursor.getcolumnindex column app id here you can multiple record and add to list listuserinfo.add userinfo returnlistuserinfo in many cases a code example may function well with some crafted input data even though it does not follow desirable api usage.forexample programmersshouldcheckwhetherthereturn valueofstring.indexof isnegativetoavoid indexoutofboundsexception.
the example below does not follow this practice but still works well with a hard coded constant text.7one can argue that theinputdataishard codedforillustrationpurposesonly asthe role of stack overflow post is to provide a starting point rather than teachingcomplete detailsof correct apiusage.
however if a programmer reuses this code example and replaces the hard coded textwithafunctioncallreadingfroma htmlfile thereusedcode maycrashifthe htmldocumentdoesnothaveanexpectedelement.
therefore itisstillbeneficialtoinformtheusersaboutdesirable usage and potential pitfalls especially for a novice programmer who may not be familiar with the given api.
1string text quotedblvar img src quotedblvarmysrc quotedblvar width quotedblvar128 quotedblvar height quotedblvar92 quotedblvar border quotedblvar0 quotedblvar alt quotedblvaralt quotedblvar p strong quotedblvar 2text text.substring text.indexof quotedblvarsrc quotedblvar quotedblvar 3text text.substring quotedblvarsrc quotedblvar quotedblvar.length 4text text.substring text.indexof quotedblvar quotedblvar quotedblvar 5system.out.println text falsepositive.
examplecheck mistakenlydetectsapimisuse in posts.
the majority reason is that examplecheck checks for api misuse via a sequence comparison without deep knowledge of itsspecification whichisnotsufficientin56posts.forinstance the following so post calls substring line without explicitly checking whether the start index index is not a negative number and the end index strvalue.length is not greater than the length authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
are code examples on an online q a forum reliable?
icse may june gothenburg sweden ofthe string.8whileexamplecheck warnspotential apimisuse accordingtojdkspecifications indexofneverreturnsanegative integer .
thus the following code is still safe because index isguaranteedto benon negative.similarly strvalue.length returnsthestring slength whichcannotbeoutofbounds.suchcases requirehavingdetailedspecifications suchasthereturnvalueof indexof is always .
1publicstring getdecimalfractions bigdecimal value 2string strvalue value.toplainstring intindex strvalue.indexof quotedblvar.
quotedblvar if index !
returnstrvalue.substring index strvalue.length return quotedblvar0 quotedblvar second false positives are correct but infrequent alternatives.
examplecheck does not learn these alternative usage patterns because they do not commonly appear in github.
for example programmers should first call new simpledateformat to instantiate simpledateformat with a valid date pattern and then call format which is supported by related github snippets.
an alternative way is to instantiate simpledateformat by calling getinstance asshown inthe followingsopost.9thisalternative usageis supportedby360githubsnippetsandthereforenotinferredby examplecheck due to its low frequency.
... some other code... 2publicstring tostring 3calendar c newgregoriancalendar 4c.set calendar.day of week this.tocalendar 5simpledateformat sdf simpledateformat simpledateformat.getinstance 6sdf.applypattern quotedblvareeeeeeeeee quotedblvar returnsdf.format c.gettime insomesoposts usersexplicitlystateinsurroundingnatural languagetextthatthegivencodeexamplemustbeimprovedduring integration or adaptation.
the following example shows how to loadaclassinstancebynameandthencasttheclass.10theauthor of this post comments that be aware that this might throw several exceptions e.g.
if the class defined by the string does not exist or if anotherclass.classmethod doesn treturnaninstanceoftheclass youwanttocastto.
examplecheck stillflagsthepostbecauseof a missing exception handling since the desirable api usage is not reflected in the embedded code.
however it is certainly possible thatsouserswillreadboththecodeandsurroundingtextcarefully and investigate how to handle edge cases narrated in the text.
1class ?
myclass class.forname quotedblvarmyclass t quotedblvar 2myclass t myvar myclass t myclass.cast anotherclass.classmethod sometimes stackoverflowuserssplitasinglecodeexampleinto multiple fragments and provide step by step explanation which is consideredasabetterwayofansweringquestionsinstackoverflow .examplecheck mayreportapimisuseiftworelatedapi calls are split in different code fragments.11this can be addressed by stitching these snippets together during analysis.
is api misuse prevalent on stack overflow?
examplecheck detects potential api misuse in out of stack overflow posts in our study.
we manually label each api pattern with its corresponding domain as well as theconsequence of each possible violation.
then we write scripts to categorizereportedviolationsbasedontheirdomainsandbasedon theirconsequences.figure4showstheprevalenceofapimisuse from different domains.
database io and network apis are often misused sincetheyoftenrequiretohandlepotentialruntimeexceptionsandcloseunderlyingstreamstoreleaseresourcesproperly at the end.
similarly many cryptography related posts are flagged asunreliable duetounhandledexceptions.stackoverflowposts onstringandtextmanipulationoftenforgettocheckthevalidityofinputdata e.g.
whethertheinputstringisempty orreturnvalues e.g.
whether the returned character index is .
among posts with potential api misuse reported by examplecheck could potentially lead to program crashes e.g.
unhandled runtime exceptions.
could lead to incomplete action e.g.
notcompletingatransactionaftermodifyingresources in android or not calling setvisible after modifying the look and feelofaswingguiwidget.
couldleadtoresourceleaksinoperatingsystems e.g.
notclosingastream.wefullyacknowledge that not all detected violations could lead to bugs when ported to a targetapplication.toaccuratelyassesstheruntimeimpactofso codeexamples onemustsystematicallyintegratetheseexamples to real world target applications and run regression tests.
many so examples aim to answer a particular programming question.
therefore authors of these examples may assume sousers who posted these questions already know about the used apisand maynotinclude completedetailsof desirableapiusage.
however giventhateachposthas7 644viewcountsonaverage someusersmaynothavesimilarbackgroundknowledge.especially for novice programmers it may be useful to show extra tips about desirableapiusageevidencedbyalargenumberofgithubcode snippets.
we also find that so posts with api misuse are more frequently viewed than those posts without api misuse vs. on average.
therefore there is an opportunity to help users consider better or alternative api usage mined from massive corpora when they stumble upon so posts with potential api misuse.
.
are highly voted posts more reliable?
stackoverflowallowsuserstoupvoteanddownvoteaposttoindicatetheapplicabilityandusefulnessofthepost.therefore votes are often considered the main quality metric of stack overflowexamples .
however we find that highly voted posts are not necessarily more reliable in terms of correct api usage.
figure 5shows the percentage of so posts with different vote scores thatare detected with at least one api usage violation.
we perform a linearregressiononthevotescoreandthepercentageofunreliable examples as shown by the red line in figure .
we do not observe astrongpositiveornegativecorrelationbetweenthevoteofapost anditsreliabilityintermsofapimisuse.apreviousstudyshows that concise code examples and detailed step by step explanations are two key factors of highly voted stack overflow posts .
our manualinspectionconfirmsthatmanyunreliableexamplesaresim plifiedtooperateoncraftedinputdataforillustrationpurposesonly authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhang upadhyaya reinhardt rajan kim android collection crypto database io network regex runtime swing text time0 0percentage of code examples with api misuse per api figure api misuse comparison between different domains section4.
.suchcuratedexamplesarenotsufficientforvarious input data and usage scenarios in real software systems especially for handling corner cases.
therefore votes alone should not be used as a single indicator of the quality of online code examples.
to improve the quality of curated examples stack overflow needs anothermechanismthathelpsdevelopersunderstandthelimitationofexistingexamplesanddecidehowtointegratethegivenexample to production code section .
score i.e.
upvotes minus downvotes stack overflow posts with api misuses figure api misuse comparison between code examples with different vote scores on stack overflow .
what are the characteristics of api misuse?
we classify the detected api usage violations into three categories based on the required edits to correct the violations.missing control constructs.
many apis should be used in a specific control flow context to avoid unexpected behavior.
this type of api usage violations can be further split based on the type of missing control constructs.
missingexceptionhandling.
ifanapimaythrowanexception the thrownexceptionshouldeitherbecaughtandhandleda try catch block or be declared in the method header.
in total we find codeexamplesthatdonothandleexceptionsproperly.forexample integer.parseint may throw numberformatexception if the string does not contain a parsable integer.
the following example willcrash if a user enters an invalid integer.12a good practice is to surround parseint with a try catch block to handle the potential exception.
unlike checked exceptions such asioexception runtime exceptions such as numberformatexception will not be checked at compile time.
in such cases it would be helpful to inform users aboutwhichruntimeexceptionsmustbehandledbasedoncommon exception handling usage in github.
1scanner scanner newscanner system.in 2system.out.print quotedblvarenter number of students t quotedblvar 3intnumstudents integer.parseint scanner.nextline missing if checks.
some apis may return erroneous values such asnullpointers whichmustbecheckedproperlytoavoidcrashing the succeeding execution.
for example typedarray.getstring may returnnull ifthegivenattributeisnotdefinedinthestyleresource of an android application.
therefore the return value customfont mustbecheckedbeforepassingitasanargumentof setcustomfont line to avoid nullpointerexception which is violated by the following stack overflow example.
1public class textviewplus extends textview ... some other code ... private void setcustomfont context ctx attributeset attrs typedarray a ctx.obtainstyledattributes attrs r.styleable.
textviewplus string customfont a.getstring r.styleable.textviewplus customfont setcustomfont ctx customfont a.recycle missing finally.
clean up apis such as closeshould be invoked inafinallyblockincaseanexceptionoccursbeforeinvokingthose apis.
ofstackoverflowexamplesthatcall cursor.close does notcallitinafinallyblock showninthefollowing.14cursor.close may be skipped if getstring line throws an exception.
1cursor emails contentresolver.query email.content uri ... 2while emails.movetonext 3string email emails.getstring emails.getcolumnindex email.data break emails.close missing or incorrect order of api calls.
in certain cases multipleapisshouldbecalledtogetherinaspecificordertoachieve authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden zhang upadhyaya reinhardt rajan kim threats to validity.
our study is limited to java apis that frequently appearin stack overflowand thus maynot generalize tootherjavaapisordifferentlanguages.ourscopeislimitedto codesnippetsfoundonstackoverflow.othertypesofonlineresources such as programming blogs and other q a forums may have better curated examples.
according to the manual inspection of sampled so posts with detected api usage violations examplecheck detectsapimisusewith72 precision section4.
.
whiletheprecisionisratherlow examplecheck couldbestillusefulinthecaseoffalsepositives sincethegoalof examplecheck is not to discard so posts with potential api violations but rather to suggest desirable or alternative api usage details to the users.
related work quality assessment of online code examples.
prior work has investigated the quality of online code examples from different perspectives.
the majority of code examples on stack overflow arefree standingprogramstatementsthatcannotbeacceptedby compilers .duetotheincompletenessofcodesnippets of api names in code snippets from online forums are ambigu ous and cannot be easily resolved .
subramanian et al.
design apartialprogramparsingandtyperesolutiontechniqueforstack overflow code snippets which examplecheck uses to resolve api names .
zhou et al.
find that of accepted posts on stack overflowusedeprecatedapisbutonly3ofthemarereportedby otherprogrammers .fischer etal.
investigatesecurity related code on stack overflow and find that is insecure .
they further apply clone detection to check whether insecure code isreused from stack overflow to android applications on googleplay and find that insecure code may have been copied to over million android apps.
an et al.
investigate copyright issues betweenstackoverflowandgithub andfindalargenumberof potential license violations.
treude and robillard conduct a survey toinvestigatecomprehensiondifficultyofcodeexamplesinstack overflow .
the responses from github users indicate that less than half of the so examples are self explanatory.
while our study also indicates the limitation of code example qualityinstackoverflow ourstudyfocusesonapiusageviolationsthatmayleadtounexpectedbehaviorsuchasprogramcrashesand resourceleaksbycontrastingsocodeexamplesagainstdesirable apiusageminedfrommassivecorpora.ourresultsstronglymotivatetheneedofsystematicallyaugmentingstackoverflowand helping the user to implicitly assess the given so example with quantitative evidence about how many github snippets follow or do not follow related api usage patterns.api usage mining.
there is a large body of literature in mining implicit programming rules api usage and temporal properties ofapicalls.sinceapiusageminingisonlyapartofourdataset constructionprocess wearenotarguingthenoveltyofapiminingemployedin examplecheck.nevertheless webrieflydescribehow api usage mining in examplecheck is related to prior work.
gruska et al.
extract call sequences from programs and perform formal concept analysis to infer pairwise temporal properties ofapicalls .manyotherspecificationminingtechniquesare dedicated to inferring temporal properties of api calls .
up miner mines frequent sequence patterns but doesnot retain control constructs and guard conditions in api usagepatterns .
several techniques model programs as item sets and infer pairwise programming rules using frequent itemset mining which does not consider temporal ordering or guard conditions of api calls.
examplecheck mines from massivecorpora ofgithub projects several orders of magnitude larger than prior work .
examplecheck minesnotonlyapicallorderingbutalsoguardconditionsusingpredicatemining.toourbestknowledge ramanathan et al.
and nguyen et al.
are the only two predicate mining techniques.
ramanathan et al.
apply inter procedure data flow analysistocollectallpredicatesrelatedtoacallsiteandthenuse frequent itemset mining to find common predicates.
unlike examplecheck ramanathan et al.
only mine a single project and cannothandlesemanticallyequivalentpredicatesindifferentforms.nguyenetal.improveuponramanathanetal.bynormalizingpredicatesusingseveralrewritingheuristics.unlikethesetechniques examplecheck formalizes the predicate equivalence problem as a satisfiabilityproblemandleveragesasmtsolvertogrouplogically equivalent predicates during guard mining.
conclusion programmersoftenresorttocodeexamplesononlineq aforums such as stack overflow to learn about how to use apis correctly duringsoftwaredevelopment.however thereliabilityofcodeexamples in stack overflow posts is under investigated.
to demonstrate the prevalence and severity of api misuse in online code examples weminefrequentapiusagepatternsfrom380 125githubrepositories carefullychecktheresulting245minedpatternsmanually and contrast stack overflow posts with validated patterns.
our study provides empirical evidence that almost one third of stackoverflowpostsmaycontainpotentialapiusageviolations thatcouldproducesymptomssuchasprogramcrashesandresource leaks.
even highly voted posts are not necessarily more reliable than other posts in terms of api usage correctness.
certainly the purpose of stack overflow is to provide a starting point for investigation and its code examples do not necessarilyinclude all details of how to reuse the given code.
however for novice developers it may be useful to show extra tips about desirable api usage evidenced by a large number of github snippets.
our work provides a foundation for enriching and enhancing code snippetsinacollaborativeq aforumbycontrastingthemagainst frequentusagepatternslearnedfrommassivecodecorpora.such approach could help the user to implicitly assess the given code example and reduce the effort of integrating adapting and testing thecuratedexampleinatargetapplication.asafuturework we plantovalidate examplecheck withdevelopersandsolicittheir feedback on its chrome extension.