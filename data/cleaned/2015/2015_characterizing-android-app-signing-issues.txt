characterizing android app signing issues haoyu wang1 hongxuan liu2 xusheng xiao3 guozhu meng4 and y ao guo2 1beijing university of posts and telecommunications beijing china 2key lab of high confidence software technologies moe dept of computer science peking university china 3case western reserve university4sklois institute of information engineering chinese academy of sciences china 5school of cyber security university of chinese academy of sciences china abstract in the app releasing process android requires all apps to be digitally signed with a certificate before distribution.
android uses this certificate to identify the author and ensure the integrity of an app.
however a number of signature issues have been reported recently threatening the security and privacy of android apps.
in this paper we present the first large scale systematic measurement study on issues related to android app signatures.
we first create a taxonomy covering four types of app signing issues anti patterns in total including vulnerabilities potential attacks release bugs and compatibility issues.
then we developed an automated tool to characterize signature related issues in over million app items million distinct apks crawled from google play and alternative android app markets.
our empirical findings suggest that although google has introduced apk level signing schemes v2 and v3 to overcome some of the known security issues more than of the apps still use only the jar signing scheme v1 which poses great security threats.
besides we also revealed that to of the apps in the studied markets have been found containing at least one signing issue while a large number of apps have been exposed to security vulnerabilities attacks and compatibility issues.
among them a considerable number of apps we identified are popular apps with millions of downloads.
finally our evolution analysis suggested that most of the issues were not mitigated after a considerable amount of time across markets.
the results shed light on the emergency for detecting and repairing the app signing issues.
index terms signature vulnerability mobile app certificate i. i ntroduction mobile apps are distributed through app markets such as google play where users can search and download desired apps.
in the app releasing process android requires all apps cryptographically signed by developers which is known as package signatures .
app signing is the primary security mechanism that protects the integrity of an app after it is released by the developer for example ensuring that only the original developer can issue an update to an already installed app.
the android system uses this certificate to identify the author of an app.
the certificate does not need to be signed by a certificating authority.
however in recent years a number of vulnerabilities related to app signing have been disclosed from time to time posing great security risks to a significant number of android apps and mobile devices.
for example the janus vulnerability cve allows attackers to modify apks without breaking their original signatures which could affect almost all the apps signed with android s original jarbased signing scheme v1 signing scheme in mobile devicesrunning android systems between v5.
and v8.
.
the master key vulnerability cve was disclosed in .
it was reported that of android devices by the date of july were affected by this vulnerability which could also allow attackers to modify any legitimate signed apps without breaking their original signatures.
similarly two other android master key vulnerabilities were also discovered in android .
as malware were found using these vulnerabilities to inject malicious payload to legitimate apps.
in addition some attackers are selling legitimate android code signing certificates to evade malware detection .
as many anti virus engines use white lists to filter apps created by legitimated developers it is easy for malware to sneak into a mobile device if the malware is signed with the purchased certificates.
moreover many amateur app developers even the ones who created popular apps use the private keys wellknown in the community e.g.
publicly known private keys included within the android open source project to sign their apps which makes it easy for attackers to replace the vulnerable apps with malicious ones without users knowledge.
to address these issues the signing schemes in android have been evolving as well.
on one hand a number of bugs and vulnerabilities related to app signing are disclosed and then fixed during the evolution.
on the other hand due to numerous vulnerabilities found in the original v1 signing scheme which has been adopted since the first version of android android has introduced new signing schemes in its later versions.
for example android nougat v7.
introduced the apk signing scheme i.e.
v2 signing scheme to provide apk level signing.
an improved version of the apk signing scheme i.e.
v3 signing scheme was introduced in android pie v9.
.
however the app signing issues have not been systematically studied especially when considering that there are a variety of severe signing issues as well as millions of apps and developers in the ecosystem.
although google has introduced new signing schemes to enhance security it is still unclear how many apps have been suffering from known signing issues in the wild.
besides as a large portion of android devices are running legacy android system versions little is known on how many attackers have exploited the existing vulnerabilities to perform possible attacks in the wild.
contributions.
in this paper we perform the first largescale and systematic study of android app signing issues.
we first compile a taxonomy of anti patterns of app signing 34th ieee acm international conference on automated software engineering ase .
ieee authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
cf.section iii including app level vulnerabilities types of possible attacks of them are performed by exploiting system level vulnerabilities one compatibility issue and types of releasing bugs.
based on these anti patterns we developed a tool to automatically detect each type of the issues cf.section iv .
to measure the presence of signature related issues we crawled .
million app items from app markets including google play over .
million distinct apks in total due to the overlapping among markets and applied our tool to these apps to detect app signing issues cf.
section v .
we studied the results to analyze the distribution of apps with signing issues from various aspects including app markets app categories app popularity and release update time.
at last we studied the evolution of app signing issues cf.
section vi and performed a post analysis seven months later to measure how many apps with signing issues have been removed or mitigated.
among many interesting results and observations the following are the most prominent .
of the apps roughly .
million studied in this paper could be exploited on devices with android versions prior to .
as they only adopted the v1 signing scheme even though the v2 scheme had been introduced for over .
years by the date of our study.
app signing issues are prevalent in both google play and alternative markets.
roughly to of the apps in the studied markets have been found containing at least one issues which allow attackers to inject malicious payloads via bypassing verification and replacing unprotected files with malicious payloads in the signed apks.
such issues can even be found in many popular apps with millions of downloads.
a significant number of apps over 65k are found to be signed with publicly known keys which allow attackers to arbitrarily modify the apps without breaking its original signatures indicating that most of the developers paid little attention to app signing issues or simply were unaware of the potential risks.
these apps have aggregated over .
billion installs in total.
even some popular apps use publicly known private keys e.g.
com.shuqi.controller with over million downloads was found using the testkey to sign itself.
apps 435k installs in total were found exploiting the master key vulnerability to perform attacks and most of them were confirmed as malware by virustotal.
over 1k apps were found being compromised with over .
billion app downloads in total.
attackers try to remove ad libraries or resource files to create ad free apps or compromise the functionalities of the apps.
over 90k apps were found containing release bugs or compatibility issues that may lead to installation failures on certain android versions including some apps with billions of downloads e.g.
com.kugou.android .
most of the apps with signing issues have been released years ago e.g.
more than of the apps that exploit vulnerabilities were released before fig.
.
the protection chain of the v1 signing scheme.
which suggested that they may have impacted millions of users for years.
besides our post analysis suggested that most markets had not removed updated the apps with signing issues after months since our initial study .
such findings indicate that many app markets paid little attention to or were unaware of the security issues caused by app signing which could make these markets an easy target to disseminate malware.
to the best of our knowledge this is the first systematic study of app signing issues at scale longitudinally and across various dimensions.
our results motivate the need for more research efforts to disclose the widely unexplored app signing issues and further improve the app ecosystem.
ii.
b ackground a. app signing keys android enforces a self signed mechanism an app should be signed with its developer s certificate before it is installed so as to prevent the apps from being tampered.
the developer holds the private key with the extension .pk8 of the certificate and uses it to sign the apk.
the private key must be kept secret and protected by a password.
the public key is used to verify its signature which is visible to everyone.
b. app signing schemes in android there are three signing schemes used in android .
jar signing scheme v1 the v1 scheme introduced since android .
is based on jar signing .
it has been introduced since the first version of android.
apk signing scheme v2 the v2 scheme apk level signing was introduced in android .
.
the contents of an apk file are hashed and signed and then the resulting signing block is inserted into the apk.
apk signing scheme v3 this is an improved version of v2 introduced in android .
.
it contains additional information in the signing block.
for compatibility and security concerns it is recommended by google to sign apps with all the three schemes first with v1 then v2 and finally v3.
devices running out ofdate android systems typically ignore the v2 and the v3 signatures thus v1 signatures should always be included.
jar signing scheme v1 a jar signed apk must contain the exact files listed in met a inf manifest.mf and all the files must be signed by the same set of certificates.
all signature related files are stored in the met a info directory including manifest.mf cert.sf and cert.
rsa dsa ec note that the .sf authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
and .
rsa dsa ec can be any signer customized strings .
these files form the protection chain as shown in figure .
manifest.mf contains the hash results of all source files in the apk file to prevent them from being tampered.
cert.sf contains a file level hash value of the manifest.mf and hash values of each section of manifest.mf.
in the android system the framework first verifies the filelevel hash value of the manifest.mf.
if that fails the hash value of each manifest.mf section is verified instead.
cert.
rsa dsa ec android supports three signature algorithms rsa dsa and ecdsa introduced in android .
.
cert.
rsa dsa ec is used to verify the signature of cert.sf .
it includes the certificate meta info subject issuer series number etc.
the signature of cert.sf signed by developers private keys and the public key.
apk signing v2 v3 schemes v1 signatures does not protect some parts of the apk such as zip metadata and the files located in the met a inf directory.
only uncompressed file contents are verified in v1 not the whole apk which allows modifications to be made to the apk file after signing e.g.
janus and master key vulnerabilities .
to overcome the limitation of v1 the v2 and v3 schemes consider all the binary contents of the whole apk file.
v2 and v3 signing insert a signing block into the apk file immediately before the zip central directory section which is located at the end of the file.
any modifications to the apk including zip metadata modifications will invalidate the apk signature.
the new formats are backwards compatible so apks signed with the new signature schemes can be installed on legacy android devices which simply ignore the extra data added to the apk as long as these apks are also v1 signed.
iii.
a t axonomy of appsigning issues to the best of our knowledge no previous work has compiled a taxonomy of app signing issues because the relevant issues have not been studied systematically.
in order to provide an extensive taxonomy covering most of the signing issues we have investigated app signing issues in the following means.
first we resort to common vulnerabilities and exposures cve and android vulnerability for searching related vulnerabilities using keywords such as android and signature .
we have identified vulnerabilities cve android android fakeid cve related to the android app signing process.
all of them are system level vulnerabilities that could be exploited by attackers.
second we manually inspect the verification process in the android framework mainly for checking the release bugs and the compatibility issues related to app signing search signature related questions using keywords including apk signing signature etc.
from stackoverflow and summarize the issues found in technical reports.
as a result we compiled a taxonomy of antipatterns of app signing as shown in table i. we have classified them into categories based on the severity levels and impacts vulnerabilities.
apps have known signing vulnerabilities or they could be potentially exploited by attackers.
exploits.
apps are tampered or exploited by attackers using known vulnerabilities both system level and applevel .
note that all the cves we summarized are systemlevel vulnerabilities that could be exploited by attackers.
compatibility issues.
this type is usually introduced by using unsupported digest signature algorithms which could lead to installation failures in certain android versions based on its supported minimum sdk versions .
release bugs.
this type of issues are generally caused by the developers in the apps release process e.g.
use the packing tools or releasing tools improperly which could lead to app installation failures in most cases.
a.app vulnerabilities we have found two types of app level signature vulnerabilities including signing apps with a publicly known private key and unprotected contents in the met a inf folder.
vul signing apps with publicly known private keys in general private keys should be kept secret in order to prevent unauthorized modifications to the original app.
however many privacy keys are well known in the android development community.
the most famous set of keys are the publicly known private keys included in the aosp project.
the standard android build uses four known keys all of which can be found at build target product security .
for example testkey is the generic default key for packages that do not otherwise specify a key.
other publicly known keys include platform key shared key and media key .
for apps signed with the publicly known keys it is easy for attackers to replace this vulnerable app with another one possible with malicious payloads without user s knowledge.
vul unprotected contents in the meta inf the v1 scheme verifies the integrity of all files in the apk except those inside the met a info directory which could introduce security issues.
on one hand malicious payloads can be hidden in this directory and dynamically loaded at runtime e.g.
an app may implement the logic to iterate the met a info directory .
on the other hand for the legitimate apps that put unprotected contents in the directory attackers could easily modify the apk through simply replacing the files inside met a info with malicious payloads.
note that the security risks caused by this vulnerability usually depend on the type and the content of the unprotected files.
for example if developers put unprotected libraries under this directory it is easy for attackers to replace them with malicious ones.
b. security exploits attack exploiting master key vulnerability manifest.mf contains a digitally signed list of checksums for the rest of the archive.
before app installation the files in the apk are extracted and their digests are compared with the corresponding checksums in this list.
if there is a mismatch the verification will fail and the installation will be rejected.
however if the developer puts two files of the same name into the apk the verifying process will verify the first file but install and use the second file which is authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
t able i at axonomy of anti p a tterns rela ted to app signing .
issue type issue v1 v2 system versions impact vulnerabilitiessigning apps with publicly known private keys y y all v ersion modify app without breaking its signature unprotected contents in the met a inf y before v7.
replace the unprotected files exploitsexploiting master key vulnerability y before v4.
modify app without breaking its signature compromise the integrity of apk y before v6.
remove files without breaking its signature exploiting janus vulnerability y before v7.
modify app without breaking its signature exploiting unsigned shorts vulnerability y before v4.
modify app without breaking its signature exploiting unchecked name vulnerability y before v4.
modify app without breaking its signature exploiting the fake id vulnerability y before v4.
modify app without breaking its signature release bugsmismatch between signature and .sf y all version installation failure mismatch between .sf and .mf y all versions installation failure incomplete .sf y all versions installation failure incomplete .mf y all versions installation failure without .mf y all versions installation failure mismatch between .mf and jar entry y all versions installation failure cannot find any signature y y all versions installation failure signed by dif ferent signature groups y all versions installation failure rollback protection issue y after v7.
installation failure v2 related bug y after v7.
installation failure extra byte at the end of zip file y y all versions installation failure cannot extract files from zip y y all versions installation failure compatibility unsupported digest algorithm y specific v ersion installation failure the underlying reason leading to the master key vulnerability.
this vulnerability allows attackers to insert malicious payloads in the package.
the attacker can exploit the original apps by adding an additional malicious classes.dex file and also an additional android manifest file.
such exploits were found in many real attack cases .
it was patched by google in jelly bean and affects android systems between .
and .
.
attack compromise the integrity of apk files in general all the files should be protected by manifest.mf to prevent them from being tampered with.
if there are some missing files in manifest.mf it is possible that the apk has been modified by the attackers as the attackers could remove files from the zip file without breaking the signature protected by the jar signing scheme or it incurs certain bugs during the apk packing process.
thus we categorize this type of issues into the attack category since it indicates the integrity of the apk has been compromised.
android has fixed this attack surface by improving strictjarfile to better handle the issue of missing files and ensure that all manifest files are present in the jar since android v6.
.
thus this attack could only target android os versions prior to .
.
attack exploiting janus vulnerability apk files could contain arbitrary bytes also called padding at the start before its zip entries.
the v1 scheme only takes into account the zip entries and ignores any extra bytes when computing or verifying the app s signature.
thus a file can be both a valid apk file and a valid dex file.
as a result attackers can pretend a malicious dex file as an apk file without affecting its signature.
the android runtime then accepts the apk as a valid update of an earlier legitimate version of the app.
the janus vulnerability affects v1 signed apps running on android os .
to .
.
apps signed with the v2 and v3 schemes and running on the devices supporting the latest signature schemes are protected against this vulnerability.
attack exploiting unsigned shorts vulnerability discovered in it is also known as the second masterkey vulnerability .
the underlying reason is that the file offsets in zips are supposed to be unsigned but are interpreted as signed causing that the contents to be verified differ from the content to be executed .
several different techniques can exploit this vulnerability.
it is much more powerful than the masterkey vulnerability as masterkey only allows attackers to replace the file contents present in the original signed zip while this vulnerability could allow attackers to insert arbitrary new files that did not exist in the original zip previously.
it was patched in android jelly bean and thus affects android prior to .
.
attack exploiting unchecked name vulnerability the signature verification process in android prior to v4.
does not check the lengths of file names correctly .
it assumes that the lengths of the file names are the same in both the local file header section as well as the central directory section of the zip file header.
to exploit this vulnerability the attackers woould first generate a difference between how the zip files are verified compared with how they are extracted so that it allows files in an existing apk to be replaced with new ones.
for example one could set the length of the file name in the local file header section to a size large enough to skip the length of the real name which was defined in the central directory and the data that will be used and then insert the malicious code after the data that will be verified.
attack exploiting the fake id vulnerability the underlying reason of this vulnerability is that the android package installer e.g.
createchain and findcert methods of the android jarutils class does not properly validate an app s certificate chain .
a malicious app can claim to be issued by another identity and impersonates a privileged app to gain access to vendor specific privilege resources.
this attack could affect android os versions between .
and .
.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
c. release bugs we have summarized types of signing related release bugs which are classified into three categories.
v1 related bugs the verification process of the v1 scheme follows a protection chain cf.
fig.
.
manifest.mf contains the message digests of all source files in the apk to prevent their integrity from tampering.
there must be at least one sf file e.g.
cert.sf that stores the base64 encoded codes of the message digest of manifest.mf and the message digests of all the digests stored in manifest.mf.
for each sf file there must be a corresponding signature file e.g.
cert.rsa or cert.dsa or cert.ec that stores the digital signature of the sf file and its signing certificate.
thus any inconsistency in the protection chain will lead to bugs which will make the app installation process fail.
in general these bugs are introduced when developers pack the apps which should be avoided since apps with these bugs could not be installed successfully.
by analyzing the protection chain we have identified types of v1 related release bugs v erification failure between the signature file and the sf file v erification failure between the sf file and manifest.mf incomplete or missing sf files incomplete manifest.mf missing manifest.mf v erification failure between manifest.mf and jar entry no signature files the files signed by different signature groups and rollback protection issue .
for rollback protection android requires that the v2signed apks that are also v1 signed must contain an x android apk signed attribute in the main section of their sf files.
when verifying the v1 signature the apk verifier is required to reject apk files that do not have a signature for the apk signature scheme e.g.
v2 scheme .
apps with rollback protection issues cannot be installed on android .
and newer versions.
apps with other v1 related issues cannot be installed on all android versions.
v2 related bugs for apk level protection a v2 signed apk consists of four sections including contents of zip entries apk signing block zip central directory and zip end of central directory.
these sections form a protect chain .
any verification failures during the process would lead to v2 related bugs.
apps with such bugs cannot be installed on android .
and up.
zip related bugs we have identified two types of ziprelated bugs.
the first is extra bytes at the end of zip file .
as the legacy android systems enforce loose zip verification apps with this type of bug could be installed on android systems with versions prior to v5.
.
android introduces libziparchive to verify zip files since v5.
which is stricter than the original libdvm library used for extracting zip files.
the second type is failed to extract certain files from the zip file which occurs during the extraction process of the zip files.
apps with this bug cannot be installed on any android devices.
d. compatibility issues the supported digest signature algorithms are updated when android os evolves.
for example sha256withrsa is avail able for minimum sdk android v4.
and up while sha256withdsa could only be used for minimum sdk android v5.
and up and sha256withec for minimum sdk and up.
as a result jar signatures containing unsupported digest algorithms will lead to compatibility issues.
in this paper we resort to apksigner to get the jar signing digest algorithm used for signing an apk using the provided key and compare with the minsdkv ersion minimum api level of the platform on which the apk may be installed.
iv .
s tudy methodology we present the details of our characterization study on app signatures in this section.
we first describe the dataset used for our study.
then we present the study design and research questions we focus in this paper.
at last we present the tool we developed for conducting the study on the dataset.
a. dataset to measure the presence of signature related issues we first make efforts to implement different crawlers to harvest mobile apps from popular android app stores as listed in table ii.
note that besides google play we also crawled popular alternative markets in order to understand the distribution of apk signing issues globally.
as google play is restricted in some countries e.g.
china android users have to resort to various alternative app markets.
as shown in table ii we have crawled .
million app items with all the metadata and apks during december and january .
over 200k of them are crawled from google play while the remaining .
million apps are crawled from major chinese app markets.
since developers could release the same apps with the same package name and hashing value to multiple markets our dataset contains distinct apks with different hashing value in total.
we believe our dataset is large enough to study the presence of app signing issues and perform comparative studies across google play and alternative app markets.
post analysis.
after months august we launched a second two day crawling campaign for analyzing whether any of the studied apps with signing issues have been removed or updated from each individual market cf.
section vi .
b. study design in this paper we focus on the following research questions rq1 what is the distribution of v1 and v2 signatures in the wild1?by the date of our first crawling the apk signing scheme v2 had been released for .
years.
as the v1 signing scheme is known to be less secure it is interesting to study how the developers have adopted the more secure v2 signing scheme.
rq2 how many apps are exposed to the security risks introduced by apk signing issues?
are there any correlation between app popularity and app categories?
are there any differences across app markets?
1note that the v3 signing scheme was introduced with android pie v9.
in august thus our dataset contains no v3 signed apps.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
.
the workflow of our app signing analysis tool.
rq3 the evolution of app signing issues .
how long have these vulnerable apps been released to the markets?
have the apps with signing issues been removed or updated during the evolution?
c. methodology we have developed an automated tool to check the signature related issues in android apps.
as shown in figure our tool is comprised of the following five main parts.
zip analysis the main purpose of zip analysis is to check the integrity of a zip file and extract all the necessary files.
first we search the end of central directory eocd record from the tail of zip in order to verify whether it is a valid zip file.
based on the position of eocd we could analyze whether there are extra bytes at the end of zip file cf.
zip bug .
then we parse each item in the central directory and locate the corresponding local file header lfh .
we then check the consistence between the metadata of the files in cd an lfh to verify whether the zip file has exploited the unchecked name length vulnerability.
cf.
attack w e further analyze the file offset of cd and lfh to see whether they are exploited to perform attacks.
cf.
attack after this step we extract files from zip based on the information listed in cd and lfh and then verify them.
cf.
zip bug t o identify attacks that exploit the janus vulnerability we check the zip heading to see whether there exist dex file paddings cf.attack .
to identify the attacks that exploit master key vulnerability we iterate all the files and verify whether there are duplicate file names cf.
attack .
note that as the attacks could only be triggered at specific system versions cf.
table i we also combine the following manifest analysis results e.g.
minimum api level to measure whether such attacks could be successfully performed.
manifest analysis androidmanifest can be extracted during zip analysis.
by analyzing androidmanifest we could get the basic information of the app including its package name and the minimum supported api level.
the information of the minimum android api level could offer insights about whether app developers are trying to target top end users.
note that the detection of compatibility issues will use the information of the minimum android api level cf.
compatibility .
v erifying v2 signatures we first identify the apk signing block parse it and extract the apk signature scheme v2 block assb from it.
then we extract all the signers fromassb.
for each signer we parse it and get all the signed data the list of signatures and the corresponding public key.
for each signature we analyze its digest algorithm and pick the signature with the strongest algorithm out of sha sha384 sha sha .
then we use the public key and the selected signature to verity signed data and further extract certificates and digests from the signed data and verify the integrity of the apk file cf.
v2 bug .
v erifying v1 signatures we first identify and parse met a inf and manifest.mf cf.
vul .
we check if each of the hashing value listed in manifest.mf is consistent with the corresponding file cf.
v1 bug v1 bug attack and make sure that each item listed in manifest.mf exist in the apk cf.
v1 bug .
for each signature file i.e.
rsa dsa ec we first identify the corresponding sf file cf.
v1 bug v1 bug .
to identify attacks that exploit the fake id vulnerability we use the method patched by the android framework to check the certificate chain signatures cf.
attack .
for each signerinfo in the signature we check the corresponding sf file and verify whether the digest algorithm is supported in the corresponding api level cf.
compatibility .
if the sf file is protected by v2 but we cannot find the v2 signature we will report it as a releasing bug cf.
v1 bug .
we use the sf file to verify manifest.mf and analyze if manifest.mf is modified cf.v1 bug .
then we verify whether each file is signed by the same signature group cf.
v1 bug .
signature analysis at last we extract all the signature files both v1 and v2 compare them with publicly known signatures cf.
vul and further analyze the consistency between signatures e.g.
apps signed by multiple signatures .
implementation.
the implementation of verifying v2 v1 signatures of the tool is based on apksigner a widely used tool to sign apks and to confirm that an apk s signature will be verified successfully.
as apksigner is only able to identify the bugs that lead to unsuccessful app installation we have implemented our own code to identify the vulnerabilities and attacks as mentioned above.
v. r esul ts and analysis in this section we first provide some general statistics to understand the distribution of v1 and v2 signatures in the wild rq1 .
then we seek to investigate the detailed signing issues for the millions apps we collected rq2 .
a. rq1 the distribution of signing schemes.
v1 signing scheme vs. v2 signing scheme we have analyzed distinct apks in total.
although the v2 scheme has been introduced for .
years prior to our crawling process it is surprising to see that more than .
of apks still use only the v1 signing scheme while only .
of apks in total in our dataset have adopted the v2 signing scheme.
note that apps use both signing schemes which means apps use only the v2 signatures.
this result suggests that most of the apps in our dataset are exposed to the attack surfaces of v1 signatures e.g.
attackers authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
t able ii overall resul ts of our measurement study .
mark et appsvulnerability attack compat.
developing bug total percentage vul vul attack attack c1 zip bug v1 bug v2 bug google play .
tencent .
baidu .
.
huawei .
xiaomi .
wandoujia .
hiapk .
anzhi .
.
oppo .
25pp .
sougou .
gfan .
meizu .
dcn .
liq ucn .
appchina .
.
leno vo mm .
zol .
nduo .
cnmo .
pconline .
appcool .
total could exploit various v1 vulnerabilities to perform attacks on devices with android system versions prior to .
.
apps with multiple signatures.
another interesting observation is that some apps have been signed by multiple certificates.
for example apps in our dataset are signed by signatures apps are signed by signatures apps are signed by signatures and apps are signed by signatures.
note that google play does not accept apks with multiple signatures thus all these apps are found in alternative markets.
one possible reason is that they tried to use multiple signatures to distinguish app versions or app release channels.
b. rq2 app signing issues overall results we present our primary exploration results on the anti patterns in table ii.
around .
to .
of apps in each market have been found containing at least one issue.
even in google play roughly .
of our crawled apps have various signing issues.
for three alternative markets huawei xiaomi and zol over of the apps are exposed to signing risks.
this result suggests that the signing issues are prevalent across markets.
the two vulnerabilities are most popular across markets accounting for more than of the apps with signing issues.
to our surprise over 65k apps were found using public known keys which allow attackers to arbitrarily modify the apps without breaking its signatures.
more than 370k apps contain unprotected contents which offer opportunities for attackers to modify and replace them without developers knowledge.
apps were found exploiting the master key vulnerability to perform attacks and most of them weret able iii the top 5apps using testkey in our da t aset .
package name md5 app installs mark et com.shuqi.controller 04b8e1ed1f724e210bbbe6ebf75308a5 baidu com.kiloo.subw aysurf cfbae893e9b7b25928c62bdeed8b3cef baidu com.aiyou.mhsjuu ee345cb5a869d27471ed40f ae4ed5bdf tencent com.cheercode.phone game1 ae976aa9669fba6d42c8808d8b8f8456 tencent com.mango.sanguo15.ruan you 778a75df40ae339b0796b6597fbe3ba1 tencent confirmed as malicious apps.
over apps were found being compromised.
roughly 90k apps include release bugs or compatibility issues that may lead to unsuccessful installation.
c. detailed results vulnerabilities over 65k apps were found using the known keys to sign apps.
although the four keys provided by aosp media platform shared and testkey were released years ago all of them were found still being used in our dataset.
there are apps using the media key apps using the platform key apps using the shared key and apps using the testkey .
these apps have aggregated .
billion app installs in total.
to our surprise even some popular apps with millions of downloads use these publicly known keys which expose them to great security risks e.g.
attackers could arbitrarily modify the app without developers knowledge.
table iii lists the top authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
apps ordered by app installs that use testkey.
for example app com.shuqi.controller is a famous novel reading app and com.kiloo.subwaysurf is a popular game app.
but they were found using testkey to sign themselves.
more than 553k apps in our dataset include some kind of unprotected contents in the met a inf directory.
note that it does not mean that all of them could be seriously attacked by hackers as some of the unprotected contents are resource files that cannot incur serious security risks.
however it is still not recommended by android to list unprotected files in met ainf as attackers could easily tamper with the app and modify it to replace the unprotected files without breaking the v1 signature .
the severity of risks introduced by this vulnerability depends on the content of the unprotected files.
exploits although we have categorized kinds of exploits and developed a tool to detect them only two kinds of exploits have been found in our dataset.
apps 435k app installs in total exploit the master key vulnerability to perform possible attacks.
we further upload these apps to virustotal an online malware detection service that embed more than anti virus engines.
the result suggests that of them are labelled as virus android.masterkey or cve2013 .
table iv lists top such apps ordered by the number of flagged engines on virustotal.
the integrity of apps were found being compromised i.e.
missing files listed in the manifest.mf.
these apps have aggregated over .
billion downloads in total.
we further investigate this issue and found of them with removed code and the remaining ones with removed resource files.
for example the baidu ad library biduad plugin pasys remote banner.jar in app com.aew.vbsz has been removed.
one possible reason is that attackers try to remove ad libraries to create an adfree app or compromise the functionalities of the apps.
these attacks could be successfully performed on systems prior to .
cf.
section .
.
roughly of them have been flagged by at least one virustotal engine and over of them have been flagged by at least anti virus engines.
to identify attacks that exploit the janus vulnerability our tool automatically checks whether any of the apps add extra bytes to the start of zip file.
although such apps are found with this behavior none of them attach the dex file.
thus we did not find any cases that exploit the janus vulnerability.
besides we found apps with long extra field lengths and apps with inconsistent file name lengths between cd and lfh.
however all of them are breaking the resource files while none of them break the classes.dex files.
furthermore we did not identify apps that break the certificate chain.
compatibility issue we analyzed the distribution of the digest signature algorithms in our dataset as shown in figure .
most of the apps over use sha1withrsa and sha256withrsa algorithms.
we have identified apps with compatibility issues in our dataset and found that most of them are introduced by the sha256withrsa algorithm.
as sha256withrsa is supported on api levels higher than apps that declared minsdkversion lower than willt able iv apps tha t exploit the master key vulnerability .
package name md5 app installs vt engines flag air.com.baobaogame.mathbearandroid.en 53bd19eeed64f1182c993db01cb11000 masterkey air.com.shuchao.app.a36house e4359956968bd988478652eb63f6d6b8 cve air.greencloudsmasherfree 135ee5428ef595e8fb95581bc5f5f101 masterke y revmob .
.
.6percentage of apps the digest algorithms used in apps fig.
.
the distribution of used digest algorithms.
have compatibility issues leading to installation failures on devices with lower api levels.
we even found many popular apps with billions of downloads with compatibility issues.
for example com.autonavi.minimap is a popular app with over billion installs that were found with compatibility issues such that it cannot be installed on devices with earlier android versions although many old devices are still popular in countries such as china.
release bugs most of the apps with release bugs were found in alternative markets.
v2 related bugs and zip bugs were not found in google play.
apps in google play have v1 bugs and all of them belong to the rollback protection issue i.e.
the jar signature file indicates that the apk is supposed to be signed with the v2 signature scheme in addition to v1 but no v2 signature was found in the apk which will lead to installation failure in the systems supporting v2 signatures.
a large portion of apps with zip bugs were found in tencent myapp xiaomi and oppo markets which suggests that these markets do not enforce strict app regulation as these apps are definitely low quality apps that cannot be installed on any android devices.
apps in total have v1 bugs and most of them over belong to the issue that mismatch between .mf and jar entry which will lead to installation failure too.
v2 related bugs were found in apps as only over 185k apps have adopted v2 signatures over .
of them have release bugs which will lead to installation failures on devices with system versions higher than .
.
this result suggested that many lowquality developers have little experiences in releasing apps and they were not even aware that their apps cannot be installed on any devices successfully.
d. the distribution of app signing issues we then analyze the distribution of app signing issues according to app category and app popularity downloads .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
.
.
ls fig.
.
the distribution of app signing related issues across app categories.
each column adds up to .
fig.
.
the distribution of downloads for the apps with signing issues.
category note that each android market implements its own app taxonomy.
for example google play defines app categories excluding subcategories for game while huawei market only has categories.
in order to understand the general distribution of app signing issues across categories we manually developed a consolidated taxonomy containing app categories and map all the categories of app markets to this taxonomy as shown in figure .
as shown in figure most app signing issues were found in categories including game life personalization and education .
one possible reason is that these categories are most popular across markets.
for example roughly of the apps that exploit existing vulnerabilities to perform attacks were found in the game category while roughly of apps with publicly known signature were found in personaliza tion.
most of the v2 related bugs were found in educa tion life and finance while zip and v1 related bugs were found mostly in the game category.
app popularity we further investigate the correlation between signing issues and app popularity the number of app2008 release update time0.
.
.
.
.
.0percentage of apps cdf attack release bug compatibility issue vulnerability fig.
.
the distribution of release update time for all the identified apps.
downloads .
note that as the app downloads across different app markets vary greatly we perform per market analysis here.
figure listed the distribution of signing issues in each of the top app markets due to space limitation.
to our surprise although the apps with less popularity 10k account for a large portion of the issues a considerable number of them are popular apps with millions of downloads .
for example over of the apps with issues found in google play have downloads higher than million.
the result is more prevalent on popular apps of the alternative markets roughly apps with v1 bugs and v2 bugs in the baidu market have more than million app installs suggesting that these apps could introduce installation failure issues at least in some system versions which will greatly affect users experience and the market s reputation as well.
the apps with vulnerability and compatibility issues were distributed across different app download ranges.
in google play roughly of the apps with known signatures have installs higher than 100k and roughly of the apps with compatibility issues have installs higher than million.
the exploited apps attacks in general have fewer app downloads.
for example all of the apps utilize janus vulnerabilities have less than 1k installs in google play.
more than of apps with zip bugs have less than 1k app downloads in tencent and oppo markets while the numbers in baidu and wandoujia markets are outliers which are and respectively.
vi.
t he evolution of signing issues in this section we study the evolution of signing issues rq3 .
we first analyzed the release update time of these apps with signing issues.
as most of the issues would lead to great security risks or installation failures we want to examine how long they have been staying in the markets.
then we perform a post analysis seven months later to measure how many apps with signing issues have been removed or mitigated.
release update time as shown in figure we have investigated the distribution of release update time for all the issues we identified across four categories.
over half of the bugs and attacks were released before which means that they have affected millions of users for at least two years years prior to our first crawling process .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
.
the percentage of remaining removed apps with signing related issues across markets after months.
over of the vulnerabilities and compatibility issues were released during and .
this result suggested that on one hand the developers of these apps usually paid little attention to the signing issues and some of them are even unaware whether their apps couldbe successfully installed on users devices.
on the other hand although each app market claims to enforce app inspection on malicious code and app clones they do not enforcestrict any app inspection on signing issues especially foralternative markets e.g.
tencent baidu and xiaomi with alarge number of low quality apps with signing issues.
post analysis our results reveal that each market hosts a significant number of apps with signing issues.
we performeda second app crawling on each app store about months afterthe first one in order to quantify whether the app marketsmade any effort to remove those samples and whether theapp developers identified the issues and updated the apps.
for each market we crawled the apps with signing issues and labeled them as remaining unchanged identical apkmd5 hashing removed and updated to a newerversion .
note that we exclude hiapk from the analysis as ithas discontinued its services before our second crawling.
figure shows the percentage of the remaining and removed apps with signing issues.
to our surprise for outof markets more than of the apps with signingissues still remain in the market without any updates asshown in figure .
the situation is the worst for the gfan appchina and pc online markets almost all of theapps with signing issues remained in the markets without anyupdates.
anzhi huawei and google play addressed part of thevulnerable apps but more than of the apps with signing issues still remained in the markets.
by further analyzing the removed vulnerable apps cf.
figure it is interesting tosee that almost none of the apps with signing issues wereremoved in alternative markets e.g.
oppo 25pp .google play market wandoujia and anzhi have removedthe most number of the apps with signing issues.
on a per issue basis most of the apps that are vulnerable to attacks cf.section iii b have been removed in google play andanzhi.
however most of the apps with compatibility issues v1 bug issues and v2 bug issues did not get any updates.
this result suggests that the app regulation and app maintenance behaviors across markets differ significantly.most of the alternative markets do not even remove therisky apps which could lead to severe consequences suchas compromising app users security and privacy and havingnegatively impacts on the brands of the app markets.
vii.
d iscussions a. implication we believe that our efforts can positively contribute to different stakeholders in the mobile app ecosystem.
app markets.
we found most markets paid little attention to security issues introduced in the app signing process.these markets host a large number of low quality apps anddevelopers and are even exploited by malicious developers to disseminate malware.
thus app markets should improve their app regulation process to eliminate apps with signingissues before they enter the market and deploy automatedtools to identify remove apps with signing issues removelow quality developers identify signing related attacks andimprove the app ecosystem.
app developers.
experiment results suggested that many app developers are unaware of the signing issues.
v ery fewdevelopers have adopted the v2 signatures while many devel opers use publicly known private keys.
even some popular appdevelopers cannot deal with app signing correctly and manyof them suffer from compatibility issues.
our work could help authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
app developers identify and eliminate these signing issues thus helping improve app quality.
app users.
as most of the issues listed in this paper were focused on the v1 signing scheme a majority of them cannot cause serious security issues on android systems that support v2 and v3 signing schemes after .
.
our work could help app users be aware of the severity of signing issues and further eliminate the issues by updating their devices to up to date system versions and choose apps from high quality markets.
research community.
our work could help encourage more research on app signing issues such as additional app signing issues and advanced approach to identify them.
besides further studies could focus on the new signing mechanisms and third party signing frameworks e.g.
baidu oasp as well as automated exploitation of apps with signing issues and how to identify such attacks.
b. threats to v alidity to the best of our knowledge this work is the first attempt in the community towards characterizing app signing issues in large scale.
our study however carries several limitations.
first we focus on kinds of signing issues which were summarized from cve and existing technical reports.
this taxonomy might be incomplete and we did not identify new app signing vulnerabilities or anti patterns.
nevertheless it is surprising to see that a large number of apps have been exposed to security issues although these issues were known to the community for a long time.
besides our measurement study is limited by our dataset.
on one hand our dataset is a bit outdated and does not cover the v3 signing scheme.
on the other hand most of the apps in our dataset were crawled from chinese alternative app markets which is not representative enough to characterize the global app signing issues.
viii.
r ela ted work measurement study of app security issues.
a number of studies have measured the mobile app ecosystem in large scale from different angles including malware repackaged apps low quality apps permission issues third party tracking fraudulent behaviors and promotion attacks etc.
besides cryptography apis have been widely studied in the mobile app ecosystem .
for example egele et al.
empirically analyzed cryptographic misuses in android apps and found that over of apps make at least one mistake.
icryptotracer investigated the ios app s usage of cryptographic apis and observed that more than of ios apps contain various security flaws caused by cryptographic misuses.
backes et al.
observed the misuse of cryptographic apis in mobile ad libraries.
wang et al.
proposed a framework to investigate oauth implementation issues and found that .
of the apps incorporating oauth services are vulnerable.
many other studies are focused on analyzing vulnerabilities including the ssl tls issues the open port vulnerability and the icc issues etc.
app authorship developer analysis.
oltrogge et al.
have investigated online app generators and found that they are suffering from well known security issues while developers are unaware of these hidden problems.
credminer studied the prevalence of unsafe developer credentials and found that over half of them using free email services and amazon aws are vulnerable.
gonzalez et al.
proposed to analyze the authorship attribution of android apps based on a set of features extracted from the decompiled binary.
their results suggested that they could achieve .
accuracy on identifying developers.
wang et al.
performed the first large scale study of the mobile app ecosystem from the perspective of app developers.
the results suggested that over of the apps with severe privacy risks are created by developers.
the follow up work has analyzed over million android app developers across google play and popular alternative markets from different angles including developing releasing app maintenance and malicious behaviors.
app signing for securing app installation.
barrera et al.
conducted a detailed analysis of the app installation process to study the update integrity and uid assignment.
they found empirical evidence that android s current signing architecture does not encourage best security practices and the limitations of android s uid sharing method force developers to write custom code for secure data transfer.
baton provides a mechanism to enable transparent key updates or certificate renewals.
these work were focused on exposing the limitations of the signing architecture while our work conducted a systematic study to identify issues in existing apps and shed light on attacks on the apps.
ix.
c onclusion in this work we have conducted a large scale measurement study of android app signing issues in the wild.
we first created a taxonomy of anti patterns and then developed an automated tool for conducting the characterization study.
we have studied over million apps across markets and revealed that various signing issues are prevalent in google play and alternative markets.
furthermore evolution analysis suggested that most app markets have paid little attention to the security issues caused by app signing as almost all the apps with signing issues were not removed mitigated.
we believe that our research efforts can positively contribute to bring developer and mobile user awareness of signing issues attract the interests of the research community and regulators and promote best operational practices across market operators.
acknowledgment this work is supported in part by the national key research and development program 2017yfb1001904 the national natural science foundation of china grants no.
no.
and no.u1836211 nsf cns beijing natural science foundation no.jq18011 and a research grant from huawei.
y ao guo is the corresponding author.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.