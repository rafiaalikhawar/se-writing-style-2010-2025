how do developers document database usages in source code?
mario linares v asquez boyang li christopher vendome and denys poshyvanyk the college of william and mary email fmlinarev boyang cvendome denys g cs.wm.edu abstract database centric applications dcas usually contain a large number of tables attributes and constraints describing the underlying data model.
understanding how database tables and attributes are used in the source code along with the constraints related to these usages is an important component of dca maintenance.
however documenting database related operations and their constraints in the source code is neither easy nor common in practice.
in this paper we present a two fold empirical study aimed at identifying how developers document database usages at source code method level.
in particular i we surveyed open source developers to understand their practices on documenting database usages in source code and ii we mined a large set of open source projects to measure to what extent database related methods are commented and if these comments are updated during evolution.
although of the developers claimed to find value in method comments describing database usages our findings suggest that of 33k methods in .1k opensource java projects with database accesses were completely undocumented.
i. i ntroduction database centric applications dcas are software systems that rely on databases to persist records using database objects such as tables columns constraints among the others.
these database objects represent the underlying application model including business rules and terms.
also developers can create queries and views as a mechanism to traverse or search over the persisted data by following the semantics defined by the database objects.
dca architectures are commonly used for different types of systems ranging from large enterprise systems to small mobile applications.
it is not uncommon for many modern dcas to contain databases comprised of thousands of tables and attributes .
the source code and database schemas of dcas are constantly evolving oftentimes asynchronously .
this makes it particularly challenging for developers who need to understand both how the database is used in the source code and how the model is described by a schema .
in addition database administrators who are in charge of database schemas may not necessarily be in charge of related source code changes or be able to effectively communicate to developers the modifications to the database schemas.
therefore complete and up to date documentation of the database the schema and any constraints is an important artifact to support software evolution.
some existing artifacts designed to capture database schemas are data dictionaries describing all the database objects in a given schema or diagrams conceptual and physical depicting tables attributes and their relationships.
however navigating and understanding such artifacts can be tedious and time consuming tasks in particular for large databases.
source code comments are another source of documentation that can help developers understand nuances of the data model and database usages in the source code.
however recent studies on co evolution of comments and code showed that the comments are rarely maintained or updated when the respective source code is changed .
another study by kajko mattsson showed that none of the organizations for eighteen enterprise systems have fully matched all their documentation requirements .
to understand if and how database related statements are commented in source code we mined java applications in github that use jdbc for the data access layer and we found that of 33k source code methods do not have header comments in the case of existing comments they rarely got updated when related source code was modified.
to complement the miningbased analysis we conducted a survey with open source developers section iii .
as it turns out developers rarely write comments detailing database schema constraints e.g.
unique values non null keys varchar lengths to which developers should adhere in the source code nor document changes in source code dealing with databases.
however despite the preference of developers for using database documentation or schemas when understanding data models .
of the surveyed developers consider that tracing schema constraints along call chains in source code is not a very easy nor easy task.
therefore there is a clear opportunity for researchers to propose approaches that support automated documentation of source code involving database operations.
to the best of our knowledge no previous work has been done to understand database documentation practices at source code level.
therefore this paper has the following noteworthy contributions i results from a survey with open source developers to understand their practices on documenting database usages in source code ii a mining based analysis of a large set of open source projects to measure to what extent database related methods are commented and if these comments are updated during evolution.
ii.
s tate of the art related work despite recent studies showing that there is a strong evolutionary coupling between database schema and source code as of today no approach has been proposed to automatically document comment database usages in source code.
some approaches have been proposed to extract information directly from the schema but without considering thesource code .
there is also some previous work for automated comment generation of software artifacts however none of the existing approaches focus on generating database related documentation for supporting evolution and maintenance of source code.
a. studies on co evolution of schema and code maule et al.
use program slicing and dataflow based analysis to identify the impact of database schema changes.
qiu et al.
conducted an empirical study into co evolution between database schemas and source code and the authors demonstrated that database schemas frequently evolve with many different types of changes at play.
sj berg presents a technique for measuring the changes of database schemas and performed a study on health management systems over several years where additions and deletions are found to be the most frequent operations.
b. extracting database information several studies focus on extracting database related information .
the approach proposed by petit et al.
first extracts the database table names and attributes from the database schema .
then the approach builds semantic relations between the entities by investigating set operations and join operations.
alhajj et al.
presented an algorithm to identify candidate and foreign keys of all relations from an existing legacy database .
another group of studies focused on analyzing data in the database and extracting associative constraints .
the associative rule mining problem was first introduced by agrawal et al.
where the associative rule mining algorithm is able to generate a set of implications a!bbased on the given relational table.
au et al.
applied a fuzzy association rule mining technique to a bank database system and identified some hidden patterns in the data.
li et al.
use association rule mining technique to correct the semantic errors in generated data.
overall the associative rule mining algorithms rely on existent data records.
c. on documenting software artifacts buse and weimer present an approach for generating human readable documentation of exceptions in java.
more specifically they use a method call graph and symbolic execution techniques to extract the conditions of exceptions.
then they use a predefined template to generate natural language comments.
sridhara et al.
present an approach for automatically generating summary comments for java methods .
the authors demonstrate how to identify different kinds of important lines of code based on various characteristics of the code.
once these important lines are identified the technique converts them into natural language phrases within their method bodies.
moreno et al.
later extended the scope of the comment generation to class level granularity .
their description is based on superclass stereotypes of the class and behaviors of blocks.
mcburney and mcmillan uses contextual information i.e.
most important method in the context of a target method to generate method summaries that include natural language descriptions of how to use the method and the purpose of the method as a part of a codebase.differently from the previous work a number of papers focused on summarizing differences between program versions .
linares v asquez et al.
implemented a tool changescribe for automatically generating commit messages .
they extracted changes between two adjacent versions of a project and identified involved change types in addition to performing commit level stereotype analysis.
moreno et al.
introduced an approach arena for automatic generation of release notes of java systems.
jackson and ladd present a tool named sematicdiff which uses a program analysis technique to summarize the semantic differences between two versions of a project.
canfora et al.
present ldiff to find line based differences between two versions.
more specifically ldiff is able to track lines moved away from the original position by comparing all combinations of diff fragments.
buse and weimer present an approach for generating human readable documentation for program differences based on symbolic execution.
iii.
s tate of the practice anempirical study and a s urvey in order to understand developer practices regarding documenting database usages in source code we designed an empirical study composed of i an online survey with contributors of open source java projects at github and ii a mining based analysis of method comments in these projects.
in particular the goal of this study is to understand how developers document or comment methods in source code that invoke database queries or statements.
as for the context we analyzed open source java projects at github with jdbc api calls executing sql queries statements and the complete change history of of those projects we also surveyed developers contributing to these projects.
a. research questions commenting database related operations and schema constraints in source code is not a common practice because comments in source code are mostly promoted as a way to describe the purpose of a code entity e.g.
class method .
also there is the assumption of the existence of artifacts covering database documentation i.e.
external documentation .
however this is not always the case because i external documentation can be outdated and ii understanding large database schemas is a time consuming task.
also despite of the existence of database documentation it is possible that some database models are more clear for developers when the database objects are described in the context of features implemented in the source code.
one hypothesis that we started to explore in this paper is that inferring database schema constraints from the source code is not an easy task and less information about the database can be inferred from the source code methods at higher levels of the call chains.
therefore the source code methods that are closer to the user interaction i.e.
the gui layer are closer to high level actions and decoupled from the internal details about the database usages and schema constraints.
as an initial effort to explore our hypothesis in this paper we aimed at answering the following research questions rq 1do developers comment methods in source code that locally execute sql queries and statements?rq 2do developers update comments of database related methods during the evolution of a system?
rq 3how difficult is it for developers to understand propagated schema constraints along call chains?
rq 1examines the extent that methods in which sql queries statements occur are commented and developers motivation for commenting or not the methods.
we consider both responses by developers and a mining based analysis of source code.
rq 2investigates whether comments in headers of methods related to database accesses are likely to be outdated or are modified prior to new releases of the dca.
in rq similarly to rq we compare the responses from developers to an analysis of the source code at release granularity.
while the co evolution of comments and code have been studied before our study is the first one to investigate coevolution of database related source code and comments.
rq investigates whether tracing schema constraints in source code methods that are involved in database related call chains is a difficult task.
b. data collection in order to answer our research questions we identified a list of java projects on github.
we used github s public api to extract all java projects and locally clone them.
we then applied a keyword search to all of the files in each repository with the .java extension.
in order to identify the projects using sql queries we used the following keywords import java.sql jdbc mysql ordrivermanager.getconnection .
this resulted in java projects using jdbc.
we further refined this list by removing projects that were a fork and did not have at least one star or watcher this filtering aims to avoid projects that are duplicates or abandoned projects .
in the end we had projects in our dataset.
we extracted the developers of each project and filtered their emails down to by removing emails containing none and localhost as well as using a regular expression to enforce proper email formatting .
.
due to a limitation of the survey platform we invited developers to participate in our survey hosted on qualtrics .
the survey consisted of five questions q1 q to understand the extent to which developers document database interactions in source code and their experience with maintaining this documentation.
the questions are listed in table i. in the table we define top level method callers as methods in a public interface that start a call chain that trigger methods with sql queries statements.
concerning the mapping between the research questions and the survey questions q1andq2relate torq q3andq4relate to rq and q5relates to rq in addition to the survey for rq we counted the number of source code methods with header comments in the projects.
we analyzed the latest snapshot of each project by extracting the project s abstract syntax tree ast .
then we automatically detected the methods with database queries statements to extract the package class method name number of parameters and method comments when available.
we focused on jdbc api calls executing sql queries or statements.
we performed the same analysis at release level for of the projects and compared the comments for each release to understand whether developers update the comments during the project s evolution in part answering rq .table i. d eveloper survey questions and results .
question answer respondents q1.
do you add write documentation comments to methods in the source code?
i.e.
comments in the header of the method declaration yes .
no .
q2.
do you write source code comments detailing database schema constraints e.g.
unique values non null keys varchar lengths that should be adhered by the developers in the source code?
yes .
no .
q3.
how often do you find outdated comments in source code?
never .
rarely .
sometimes .
fairly often .
always .
q4.
when you make changes to database related methods how often do you comment the changes or update existing comment in the methods the callers and all the methods in the call chains that include the changed methods?
never .
rarely .
sometimes .
fairly often .
always .
q5.
how difficult is it to trace the schema constraints e.g.
foreign key violations from the methods with sql statements to top level method callers?
very easy .
easy .
moderate .
hard .
very hard .
c. results rq it is worth noting that for rq 1we were interested in answers concerning the general usage of documentation as a practice instead of the frequency.
therefore q1andq2are dichotomous questions and the participants had the chance of complementing the answer with a open field explaining their rationale.
regarding the results developers mostly recognize the importance of commenting source code methods as a way to increase program comprehension during evolution and maintenance.
for instance developers answered yes to q1and augmented the response with rationale like helps explain to others what the method is and how to use it as well as remind the original developer me what was the intention of the code comments make it easier to remember what things do.
they are super helpful when returning to old code and when sharing your code with others.
i ve programmed without comments in the past and learned the hard way that comments are more often then not indispensable from the .
of participants answering no to q1 we found typical rationale claiming that methods should be selfdocumented self explanatory.
despite the high rate of participants recognizing the practice of commenting source code methods the answers forq2predominantly indicate that the developers do not comment database schema constraints with .
of the respondents answering no to q2.
this contrast demonstrates that database related information is not likely contained in the method declarations because method comments are mostly for describing the purpose of the method instead of implementation details and the documentation of database objects is an obligation of an external document or the database schema.some responses from participants supporting the preference for external documentation are the following the database schema and documentation takes care of that.
i can always look at the table definition very easily.
i use and the constraints can be checked typing a sql consult or even using a tool.
although i strongly believe comments are important database comments are the gray area.
comments related to the database schema and its constraints i consider to be irrelevant to the code using it.
the schema its details and any quirks about it should be outlined in a separate document.
the comments should be stored in the database itself which is not supported by most databases i know.
writing in the source code means duplicate effort need to keep the source code synchronized with the schema.
also the database is sometimes accessed by programs written in different languages maintaining the comments up to date in all the source codes would be impossible.
another prominent reason for not documenting database usages and constraints in method headers is the usage of java annotations in orm frameworks which explicitly declare in the code the schema constraints this can be mostly handled through proper design.
if using an orm we can specify field lengths in attributes that can provide validation as well as documenting if for developers.
orm initialization makes it clear what the scheme constraints are the schema is already described in orm code.
results from the mining study confirm developers preferences.
in the analyzed source code i.e.
projects we identified a total of methods invoking sql queries statements.
of these methods did not have any comment while methods were commented.
these numbers reinforce the result of q2since of the methods with database access were documented and .
of developers indicated that they do in fact document such database interactions.
summary for rq .while developers indicated that they documented methods we found of methods with database access were completely undocumented.
in fact out of .
surveyed developers consider that documentation of schema constraints should not be included in the source code and it is a responsibility of the schema or external documentation.
rq in order to understand whether developers update comments relating to database queries statements we sought to understand the prevalence of outdated comments q3 .
combining never and rarely .
of developers suggest that comments are regularly updated in the systems that they implement or utilize.
the remaining .
of developers find outdated comments.
of those .
of developers .
501131421404256fig.
.
frequency of methods grouped by the ratio between the number of changes to the header comment and number of method changes in methods invoking sql queries statements.
indicated a relative high frequency of encountering outdated comments.
these results suggest that outdated comments are relatively prevalent i.e.
they are not a rare occurrence which confirms that the comments are rarely maintained or updated when the respective source code is change .
when we consider the prevalence of developers updating their own comments regarding changes to database related methods q4 we found .
of respondents rarely or never updated the comments.
only .
of respondents updated comments with a relatively high frequency i.e.
fairly often or always .
the remaining .
indicated it was neither a rare nor frequent occurrence.
therefore the survey results suggest that it would fairly probable for such comments to be outdated.
these results reinforce the problems that we observed with rq .
not only are methods with database queries undocumented but in the case of commented methods they are also likely to be outdated.
we also analyzed rq 2by relying on open source systems.
we mined projects that had explicit releases in github to identify whether methods invoking database queries statements updated their comments.
overall developers did not update the comments when the methods were changed.
we found methods that invoke sql queries statements in the projects.
of these methods methods were updated during the history of these projects and experienced a total of changes.
out of the methods that changed did not have changes to their comments.
the method experienced on average .
changes min q1 q2 q3 max during their entire history.
the rest of methods .
were changed times and experienced on average .
changes min q1 q2 q3 max .
in those methods we found out of method changes also experienced an update to the method comment.
finally we computed the ratio between changes to header comments and methods changes a ratio means that every time a method was changed the header comments was also changed.
figure depicts the ratio of changes between header comments and source code for the methods that experienced changes.
for instance we only found methods in which more than of the method changes were accompanied by a change to the header comment.summary for rq .while approximately half of the developers indicated that they rarely or never update method comments for database related methods we empirically observed that only .
of methods that were changed in open source projects also had their comments updated at least once between releases.
thus we empirically found database related methods are far less frequently commented during evolution.
rq answers to q5show a different perspective.
despite most of the developers thinking database documentation and schema are enough to understand schema constraints and they do not document database related methods answers to q5 show that only .
of respondents indicated that it was easy or very easy to trace database constraints along the call chain to the top level caller methods.
the remaining .
found it at least moderately difficult with .
indicating it was hard or very hard.
these responses indicate that tracing database constraints along call chains is a non trivial task.
a call chain represents the implementation of a feature in source code.
this suggest that even if external documentation or database schema is available maintaining or implementing a new feature of a system involving database operations may be a non trivial task because of the effort required to trace schema constraints across the call chains.
however more empirical validation is required to support this claim.
summary for rq .surveyed developers prefer to rely on external database documentation and two thirds of developers indicated tracing constraints along the call chain was a moderate challenge or a very hard challenge.
this opens the discussion about whether external database documentation is enough for supporting source code evolution and maintenance tasks.
d. discussion this preliminary study suggests that i documenting database usages and constraints is not a common practice in source code methods ii developers do not update comments when changes are done to database related methods and iii tracing schema constraints through call chains in the call graph is not an easy task in most of the cases.
while results for rq and rq 2describe developers rationale for not documenting database related operations in source code the findings in rq 3present a different perspective in terms of whether current practices for documenting databases are enough or useful for supporting developers.
schemas and database documentation have the purpose of describing the physical data model supporting a system.
however it is still unclear if this type of documentation is effective and efficient when maintaining software systems supported on large databases.
another aspect is the quality of the documentation when the schema is complicated or hard to access documentation is the last line of defense for understanding querying the schema.
however there is also always the problem of outdated documentation.
in addition understanding querying updated documentation can be a time consuming task when it is not designed to support easy browsing or a specific task.
for instance let s assume a scenario in which a maintainer wants to identify theschema constraints that are involved in a feature implemented in the source code.
a feature may involve different operations on several database objects and database documentation and schemas are not intended to describe constraints and relationships at the feature implementation level.
therefore the maintainer has to identify the constraints by exploring the code and understanding the available documentations.
moreover current approaches for automated documentation aim at describing the purpose of a code entity e.g.
class method but neither target specific evolution maintenance tasks nor describe the entity as part of an architecture i.e.
the description of a code entity in the gui layer should not follow the structure of a description for an entity in the data access layer .
in summary future work should be devoted to providing developers with tools for automatic documentation that support specific tasks in particular for evolution and maintenance of dcas.
our results suggest that automatic generation of database related documentation is required to support evolution maintenance tasks.
using the results in rq 1as a reference developers working on features involving the undocumented database related methods from the analyzed projects might find benefit in an automated approach that assures the methods are properly documented and updated.
also the automated approach might benefit the .
of the surveyed developers that did not consider tracing schema constraints along call chains as a very easy nor easy task.
e. threats to validity the construct threat to validity relates to the observations from the developer survey and results of mining the database usage.
in terms of our survey we did not infer behavior from the survey and only reported the experience as indicated by developers and we do no provide rationale for the observations.
since we relied on projects on github it is possible that project histories are incomplete due to the relative young age of the forge or that releases were not properly tagged.
in terms of internal threats to validity it is possible that the developers responding to the survey had more difficulty with database related documentation.
however the results of the survey suggest that participants had a range of experience and no single response was overly represented which would indicate a clear bias.
the external threats to validity relate to generalizing the results.
we do not assert that the results apply to all developers or developers using other database models e.g.
orm .
our results represent a subset of java projects on github and other languages or forges may produce a different findings.
however github is the most popular forge and our approach applies to java projects using jdbc only.
iv.
c onclusion and future work in this paper we presented a preliminary study aimed at identifying how developers document database usage at method level in source code .
the study was two fold i we surveyed open source developers about their practices for documenting database usages and constraints at source code level and ii we mined the source code of open source systems to measure the amount of database related methods with header comments and the coevolution of the comments with method changes.
our main findings suggestthat documenting methods with database accesses is not a common practice and the the surveyed developers consider that documentation of schema constraints should not be included in the source code and it is a responsibility of the schema or external documentation.
however the impact of using database documentation to support evolution and maintenance tasks needs to be evaluated and analyzed more carefully by the research and industry communities.
for instance despite the high confidence of surveyed developers on database documentation about of them answered that tracing schema constraints along call chains in the source code which is a common task for maintainers of dcas is a moderate very hard challenge.
therefore future efforts on automatic approaches for artifacts documentation should also consider information extracted from the database and should be tasks oriented instead of being general purpose.
by the time this paper was written and to the best of our knowledge no approach has been developed to generate documentation that takes into account the data model represented in database schemas and there is no approach available that supports database schema understanding during evolution and maintenance of dcas.