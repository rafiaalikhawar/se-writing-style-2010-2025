a tale of two cities how webview induces bugs to android applications jiajun hu the hong kong university of science and technology hong kong china jhuao cse.ust.hklili wei the hong kong university of science and technology hong kong china lweiae cse.ust.hkyepang liu southern university of science and technology shenzhen china liuyp1 sustc.edu.cn shing chi cheung the hong kong university of science and technology hong kong china scc cse.ust.hkhuaxun huang the hong kong university of science and technology hong kong china hhuangas cse.ust.hk abstract webview is a widely used android component that augments a native app with web browser capabilities.
it eases the interactions between an app s native code and web code.
however the interactionmechanismofwebviewinducesnewtypesofbugsinandroid apps.
understanding the characteristics and manifestation of these webview induced bugs bugs for short facilitates the correct usagesofwebviewsinandroidapps.thismotivatesustoconduct thefirstempiricalstudyon bugsbasedonthosefoundinpopular open source android apps.
our study identified the major root causesand consequencesof bugsand madeinteresting observations that can be leveraged for detecting and diagnosing bugs.
basedontheempiricalstudy wefurtherproposeanautomatedtest ingtechnique droidtoeffectivelyexpose bugsinandroidapps.
in our experiments droid successfully discovered unique and previously unknown bugs when applied to open source android apps.
we reported the bugs to the corresponding app developers.
out of these bugs were confirmed and of them were fixed.
this shows that droid can effectively detect bugs that are of the developers concern.
ccs concepts generalandreference empiricalstudies softwareand its engineering software testing and debugging keywords empirical study android system webview gui testing shing chicheungandyepangliuarethecorrespondingauthorsofthispaper.lili wei is also a visiting student at the southern university of science and technology.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
ase september montpellier france association for computing machinery.
acm isbn ... .
reference format jiajun hu lili wei yepang liu shing chi cheung and huaxun huang.
.ataleoftwocities howwebviewinducesbugstoandroidapplications.
inproceedings of the 33rd acm ieee international conference on automated software engineering ase september montpellier france.acm newyork ny usa 12pages.
introduction webview isawidelyusedandroidcomponentthatallowsandroid appsto displaywebpages without relyingon webbrowsers.
it enables bi directional interactions between the web end and the nativeendofanandroidapp.itisattractivetodevelopersandcompaniessinceexistingwebtechnologiesthatworkonotherplatforms canbereadilyintegratedintoanativeandroidappthroughwebview .earlierstudies haveshownthatwebviews are popularly used by apps in google play store .
despiteitsusefulness theinteractionmechanismofwebviewis complicatedandcausesvariousbugsinreal worldandroidapps.itis reported that apps containing webviews are suffering from poor performance andvulnerabletosecurityattacks .existing studiesfocusmainlyonthesecurityissuesinducedbywebview .
there is also an earlier study on detectingbugsinthewebviewbridgesbetweenjavaandjavascriptcode in android apps .
nonetheless these existing studies only explored a small fraction of webview induced bugs bugs for short from limited perspectives.
they did not aim to provide a systematic examination of such bugs.
in fact little is known about how webview induces bugs to real world android apps.
tobridgethegap weconductedthefirstsystematicempirical studyon124 bugscollectedfrompopularopen sourceandroid apps.inthestudy wefocusedonthebugsthatarerelatedtotheusages and runtime mechanisms of webview.
well studied bugs caused by common javascript errors are excluded from our scope.
our study aims to understand bugs from a wide range of perspectives by answering three research questions rq1 bugcause what are the common root causes of bugs in android apps?
can they be categorized?
rq2 bug consequence what are the common consequences of bugs in android apps?
how do bugs affect user experience?
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiajun hu lili wei yepang liu shing chi cheung and huaxun huang rq3 bug manifestation how do bugs manifest themselves?
can we propose testing techniques to effectively expose bugs in android apps?
answeringtheseresearchquestionsispracticallybeneficialto bothappdevelopersandresearchers.rq1characterizesthecommon root causes of bugs and can guide developers to avoid such bugs at an earlystage during an app s development.
rq2 investigate theconsequences and manifestationof bugs andcan guide test case generation to effectively detect bugs.
inourstudy wemadeseveralinterestingobservations.forexample wefoundthat bugsaremostlycausedby a misalignments betweenawebview slifecycleandanactivity sorafragment slifecycle and b the evolution of webview.
only a few of our studied real world bugsarecausedbytheerrorsstemmingfrombridge communications .
we also found that the bugs caused by webviewlifecyclemisalignmentsofteninduceresourceleakages and ui inconsistencies.
this inspired us to design test oracles to facilitate the testing of bugs.
basedonourempiricalfindings weproposeatechnique droid toeffectivelytestcommontypesof bugsinreal worldandroid apps.
droidfocusesontesting bugsinducedbywebviewlifecycle misalignments by injecting lifecycle events when exercising webview components.
droid is also equipped with effective test oraclesderivedfromourempiricalstudytoexposetriggered bugs.
we applied droid to real world android apps.
it successfully detected30uniqueandpreviously unknown bugs.wereported the30bugstothecorrespondingappdevelopers.sofar 14ofour reported bugs have been confirmed by the developers and seven of them have been fixed shortly afterwards.
these results confirm theusefulnessofourempiricalstudyandshowthat droidcan effectivelydetect bugsofdevelopers concern.tosummarize this paper makes the following major contributions we conducted the first comprehensive empirical study on bugs in real world android apps.
the study disclosed the characteristics of bugs and identified potential research directions for the detection and diagnosisof bugs.we releasedour dataset to facilitate future research .
driven by our empirical findings we designed an automatedtesting technique droid to effectively expose common types of bugs in real world android apps.
droid injects lifecycle eventsintowebviewtestcasesandexposes bugsbyleveraging effective test oracles.
weevaluated droidon146open sourceandroidapps.itsuccessfullyuncovered30 bugs.appdevelopersshowedinterest in our detected bugs with of them either confirmed or fixed.
background .
android system webview webview is an android component that allows android apps todisplaywebpages.itdiffersfromawebbrowserinthatitprovides a set of apis to facilitate bi directional interactions between the web end javascript and the native end java of an android app.
fromwebtonative awebviewcantransfercontrolfromthe webendtothenativeendintwoways.thefirstwayistouse bridge communication by creating a java object that serves as a bridge to figure1 activityandwebviewlifecycles.blackcolorrepresents activity.
grey color represents webview.
boxes repre sent states.
arrows represent state transitions.
the javascript environment.
this java object is called bridge object orjavascript interface .
developers can register a bridge object to thejavascriptenvironmentusingthe addjavascriptinterface api whichenablesjavascriptcodetoinvokethepublicmethods annotated by javascriptinterface in the bridge object.
the secondwayistoregistereventhandlersatawebviewtorespondtoevents e.g.
urlloading occurredatthewebend.forexample onecanoverride shouldoverrideurlloading methodtospecifythe task to be performed when a url is being loaded by a webview.
fromnativetoweb thenativeendcantransfercontroltothe webendusingwebviewapis.forexample evaluatejavascript asynchronously executes javascript code under the context of the current page displayed in a webview.
.
activity fragment and webview lifecycles awebviewisoftenenclosedbyanandroidactivityorfragment.
anactivityisafundamentalbuildingblockthatprovidesgraphical user interfaces guis to interact with an app while a fragment representsaportionofaguiandcanbereusedinmultipleactivities.
bothactivitiesandfragmentsaredrivenbyapredefinedlifecycle that specifies how they respond to events occurred at runtime.for example the outer cycle of figure 1represents the lifecyle ofanactivity whosestatesaretraversedviainvokingasetof callbackmethods.theruntimestateofanactivityismanagedby the android os according to the occurring events.
a webview s lifecycle differs from that of its enclosing activity fragment.
it only has three states resumed paused and destroyed asshowninthegreypartoffigure .awebviewbecomes focusableanddisplaysitscontentwhenitisinthe resumed state.
the resources loaded by a webview such as video audio animation geolocation are paused when webview enters the paused state.
a webview will be destroyed after entering the destroyed state.
unlike an activity fragment whose state transitions are managedbytheandroidos awebview sstatetransitionsshouldbe explicitly managed by appdevelopersvia invoking specific webviewapis.forexample awebviewentersthe pausedstateafter invoking onpause while it enters the destroyed state after invoking destroy .developersmayinvokemultipleapisinastate transition.
for instance developers who want to pausejavascript authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a tale of two cities how webview induces bugs to android applications ase september montpellier france !
figure statistics of apps used in our empirical study.
execution before a webview enters the pausedstate can invoke two webview apis pausetimers andonpause .
empirical study methodology wefollowedtheprocessadoptedbyexistingwork to preparethedatasetforourempiricalstudy.specifically weselected open sourceandroidappsasourstudysubjectsbecauseweneed to dig into the apps documented bugs and corresponding code revisions to answer rq1 .
we searched for suitable subjects by scanning all apps on f droid a popular open source android apphostingsitethatiswidelyusedbyearlierstudies .
we also included a set of open source android apps that were studied by previous work but not hosted on f droid.
we considered an app to be a suitable subject if its sourcecodecontainsatleastoneinstanceofthestatement import android.webkit.webview whichindicatestheuseofwebviews.
in total we obtained open source android apps for our study.
to locate bugs in the apps we searched for code revisions and closed bug reports that contain keywords webview or javascript case insensitive .
revisions and bug reportswerereturnedbysearchingthekeyword webview 257revi sions and bug reports were returned by searching the keyword javascript .thereturnedrevisionsandbugreportsmayoverlapas acoderevisionandabugreportmaycontainbothkeywords.we took the following steps to filter out noises from the search results we first excluded the code revisions and bug reports that are not related to valid bugs.
for example some bug reports may be featurerequestsfromusers.somecoderevisionsandbugreports may accidentally contain our search keywords.
for the bug reports that remained after the first step we tried to recoverthebug fixingrevision s .abugreportwaskeptinour dataset only if we successfully found the bug fixing revision s .
for the code revisions that remained after the first step we only keptthosethatsatisfythefollowingconstraints wefoundthebug report s for the issues addressed in the code revisions or the commit logs or comments in code diff explicitly indicate that the code revisions are bug fixing revisions.table1 bugsrootcausecategoriesandtheirdistributions.
root cause number misaligned webview lifecycles webview evolution device customization misconfiguration api misuse bridge communication webview limitation others total four of the co authors were involved in the process for data collection analysis andcross checking.asaresult weobtained124 bugs from open source android apps.
figure 2shows the statisticsoftheseapps.informationincludingthenumberofstars app size inkloc numberofrevisionsandissuesarecollectedfrom theapps projecthostingsitesuchasgithub .otherinformation including the app rating category and number of downloads are collected from google play store of the apps are not availableongoogleplaystore .suchdatashowthatoursubjectsare large in size around kloc on average well maintained containing thousandsof revisionsand hundredsof issueson average popular of them received over 10k downloads and diversified covering categories .
we carefully studiedthese bugs by analyzing their bug reports code revisions and relateddiscussionsfromonlineforumssuchasstackoverflow to answer rq1 .
this took many rounds of investigations and discussions.
in the end the four co authors reached consensus on the root cause consequence and manifestation for every bug in the dataset.
empirical study results .
rq1 bug cause we studied the patches and bug reports of the bugs in our dataset to understand their root causes.
we identified six major categoriesofrootcausesfromthese bugs.table 1liststhecategoriesandthenumberofbugsineachcategory.inthefollowing we discuss the common root causes with examples.
.
.
misaligned webview lifecycles.
of the bugs are causedbythemisalignmentbetweenawebview slifecyclestate and that of its enclosing activity fragment.
we call this phenomenonlifecyclemisalignment.whentheenclosingcomponentofa webview enters a certain lifecycle state it expects the enclosed webviewtoenteracorrespondinglifecyclestate.however since the lifecycle of a webview and that of its enclosing component are separatelymaintainedbyappdevelopersandandroidos lifecyclemisalignmentscaneasilyarise inducing bugs.forexample wordpress contained a bug issue that caused users to keep hearing video sounds after they left an activity enclosing a video playing webview.
the bug occurred because developers did not properly make the webview enter pausedstate when its enclosing activity is paused.
to fix this bug developers aligned thelifecycleofthewebviewwiththatofitsenclosingactivity as authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiajun hu lili wei yepang liu shing chi cheung and huaxun huang !
figure patch for wordpress issue simplified shown in figure by explicitly calling mwebview.onpause line in the onpause callback of webviewactivity.
.
.
webviewevolution devicecustomization.
bugscanexpose severe compatibility problems.
these bugs occurred because webviewisfastevolvingandnon uniformlysupportedondifferent device models causing a webview to behave inconsistently across webview versions and devices.
we identified such bugs .
in android ecosystem the webview package is maintained and upgraded separately from android os since android .
this aggravates the situation of compatibility problems because bugs can occur not only when the android os upgrades but also when webview itself is upgraded.
we observed such bugs in our dataset.for example gadgetbridge issue758 was caused byanupgradeofwebviewtoversion60thatstoppedsupporting top framenavigationstodataurlsbecausesuchnavigationswere widely used in spoofing and phishing attacks .
app developers have to modify their code to adapt to the change.
besides webviewisnotsupporteduniformlyacrossdevicemodels.asa result bugscanbedevice specific.
weobserved7such bugs in our dataset.
for example aard dictionary suffered from a bug issue that caused the page scrolling in a webview on e ink devices to create a lot of screen refreshing and annoyingflickers.thebugoccurredbecausethehighdisplaylatencyof e inkdevicesmakesithardtoguaranteethesmoothnessofpage scrolling .
.
.
misconfiguration.
manywebpagesrequirecustomizedwebview settings to function properly.
for example displaying a webpage with javascript content requires javascript to be enabled in webview settings.
misconfigured webview settings can prevent a webpage from being loaded and displayed correctly.
however properly configuring webviews is non trivial because there are over50configurableparametersin websettings andinmany casesthewebpagestobeloadedatruntimemaynotbeknownin advancewhenanappisdeveloped.21ofthe124 bugsoccurred duetothemisconfigurationofwebviewsettings.forinstance four bugreportsinnextcloudnewsreader mentionedthatarticles aredisplayedusingdesktopconfigurationwithlargescreenwidths figure6a .
this would significantly reduce the readability as users have to frequently scroll their screens from left to right to read an article.
the problem occurred because the webview in the app failedtoredirecttherequeststomobilesites.suchredirectionrelies on the web storage capability that needs to be explicitly enabled in webview settings.
the developers of the app fixed the bug byproperly configuring the webview i.e.
enabling web storage by invoking websettings.setdomstorageenabled true .
.
!
!
figure patch for wordpress issue .
.
api misuse.
of the bugs were caused by the misusesofwebviewapis.whilewebviewprovidespowerfulapisfor bi directional interactions between an app s web end and native end the protocols of these apis are complex.
without good understanding of the constraints imposed by these protocols developers can easily make mistakes when using webview apis.
an example of such constraints is that webview apis must be called on an app suithread.accordingtowebviewdocumentation ifyou call methodson webview from anythread other thanyour app s ui thread it can cause unexpected results .
however we observed cases where this protocol is violated.
for instance figure 4shows the patch for wordpress issue .
in the buggy version webviewapisweremistakenlycalledonanon uithread lines8 .
developersfixedthebugbyrelocatingtheapicallstotheuithread lines .
another example of the constraints is the timeliness of webview api invocation.
invocation of some webview apis is subjecttotimeconstraints.violationsoftheseconstraintscanresultinruntimeerrors.forinstance theapi geturl willreturn nullifwebpageloadinghasnotyetfinished.thiscaneasilylead tonullpointerexception .
slide suffered from app crashes issue due to the premature invocation of geturl .
.
.
bridge communication.
previous work has shown that the bridge communication between java and javascript is errorprone.
we observed four bugs related to bridge communications in our dataset.
for example two performance bugs in wikipedia occurredduetoheavytransactionsacrossthebridge.thisforced the system to allocate a huge amount of memory for data communicationsacrossthebridge therebyincreasingthechancesof stackoverflowandoutofmemoryerrors.theothertwobugsoccurredbecauseofobfuscation.whenthebridgeobjectmethodsare obfuscated they cannot be called by name from javascript.
.
.
webview limitation.
although webview is a powerful component it has limitations.
due to security concerns webview cannot support all web browsing features.
as a result developers may encounter problems when they implement features that webview cannotsupport.weobservedfivesuch bugs.forexample several bug reports in wordpress and redreader mentioned that webviews showed a blank page when opening file download links e.g.
pdf whichisnotsupportedbywebview.developersfixed these bugs by launching web browsers to handle the links.
finally thereareothertypesofbugsinourdataset.forexample ocreader issue9reportedabugthatawebviewdisplaysblank pageswhenitiswrappedbya nestedscrollview becauseithas authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a tale of two cities how webview induces bugs to android applications ase september montpellier france !
!
.
figure antennapod revision 77647cc simplified toloadthewholepageatonce thusexceedinggraphicsmemory limit.however suchbugsarerareandwedonotfurtherdiscuss them in this paper.
answer to rq1 we identified six categories of common root causes for bugs in android apps where misaligned webview lifecyclesand webviewevolution device customizationare twodominantones.onlyafewofourstudied bugsarecaused by bi directional interactions across webview bridge objects.
.
rq2 bug consequence tounderstandthecommon consequences of bugs we analyzed thebugreports follow updiscussions commitlogs andcorrelated codecommentsofthe bugsinourdataset.for bugsthatwecannot identify consequences from their textual descriptions we manually reproduced them in emulators to observe its consequences at runtime.intotal wesuccessfullyidentifiedtheconsequencesof114 bugs.wefailedtoreproducetheremaining10bugsduetolack ofconfigurationdetailsornecessaryenvironments.weobserved the following common types of consequences caused by bugs.
.
.
performance degradation.
of the bugs induced performance degradations.
these bugs demonstrate similar consequences of conventional performance bugs .
they can cause resource leakages battery drains app slowdowns etc.
for example antennapodrevision77647cc figure fixedawebviewinduced memory leakage.
the bug occurred due to the lifecycle misalignment problem section .
.
when destroying the enclosingactivityofawebview developersforgottodestroytheenclosed webview.thiswouldpreventtheruntimeinrecyclingtheresources usedbythewebviewanditsenclosingactivity causingmemory leakage.thebugwasfixedbyaddinganexplicitcalltothewebview s destroy api line in the ondestroy callback of the enclosing aboutactivity.
.
.
problematicuidisplay.
29ofthe124 bugsresultedinproblematicui displaysinwebviews.
sincewebviews areintensively used to display webpages in android apps such problems cansignificantly affect app usability such as the example figure 6a discussed in section .
.
.
webview may also display web content incorrectly.forexample figure 6bshowsawebviewdisplaying garbled characters pockethub issue which was induced by webview api evolution.
.
.
ui inconsistency.
another of the bugs exhibit ui inconsistencies after a restart of the webview s enclosing activ ity fragment.
for example in wikipedia bug report t63512 a nextcloundnewsreader b pockethub figure problematic ui displays of webview users complained about the inconsistent display of webpages if theenclosingactivityofawebviewisrestartedafterusersscroll downawebpage thewebpagewillbereloadedandtheusers scroll position will get lost.
such problems are common since events that inducerestartofactivity fragment e.g.
devicerotation exitingand re entering an app etc are commonly triggered by app users.
for the remaining bugs of them induce crashes e.g.
slide issue and the rest bugs are app specific functional issues.wecanobservefromtheabovediscussionsthatthemajority of our studied bugs cause performance or ui issues.
generally it is non trivial to define test oracles to detect performance and uibugsviatesting .however studyingtheconsequencesof bugsenablesustoproposemechanismstogeneratetestoracles for common bugs which will be elaborated in the next section.
answertorq2 majorconsequencescausedby bugsinclude performance degradation ui issues and app crashes.
these consequences can lead to poor user experience.
.
rq3 bug manifestation understanding the manifestation of bugs can help us design and select effective tests to detect bugs.
in rq3 we aim to investigate common inputs required to trigger bugs so as to design effective webview testing techniques.
we studied the bug reports code revisions and related discussions of the bugs in our dataset to learn how these bugs were triggered and noted by app developers.
similar to what we did when studying bugs consequences we manually reproduced the bugs for which we fail to learn the manifestationfromtextualdatasources.intotal wesuccessfully understoodthemanifestationof97ofthe127 bugs.theremaining bugscannotbereproducedduetoreasonssimilartothosediscussedinsection .
.inthestudy wemadefourmajorobservations which demonstrate common challenges in testing bugs.
.
.
manifestation of bugs can be content sensitive.
the manifestation of bugs requires webpages with specific content such as images e.g.
ankidroid issue animations e.g.
nextcloudnewsreaderissue331 video audio e.g.
wordpress issue484 seesection .
andvariouscharacterencodings e.g.
pockethub issue .
for example wordpress issue authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiajun hu lili wei yepang liu shing chi cheung and huaxun huang a save for offline b android default brower figure ui display differences between webviews and mobile web browsers figure3 can only be exposed by webpages with video audio content.however w ebpagecontentscanbehighlydiversifiedwhile an bugcanonlybetriggeredbyspecificcontents.therefore how toselectwebpageswiththespecificcontenttoeffectivelyexpose bugs is a critical challenge for webview testing.
.
.
lifecycleeventsarerequiredtotriggercommon bugs.in our dataset bugs require specific sequence of lifecycle events to trigger.
for example wordpress issue figure can only be triggered when the enclosing activity of the webview is cre ated and paused.
the bug in antennapod figure can only be triggeredwhentheenclosingactivityofthewebviewentersthe destroyedstate.thisobservationindicatesthatgeneratingsequence of lifecycle events is often needed when testing bugs.
.
.
effectiveoraclescanbeproposedforautomateddetectionof bugs.the bugs in our dataset were confirmed mainly based on developers manual judgement.
we carefully studied the measures developers took to determine the existence of these bugs and examined if the measures can be generalized as test oracles for bugs.
as a result we made two observations.
first of the bugs can be identified by comparing app ui displays or resource usages before and after triggering lifecycle events.asdiscussedinsection .
bugsarecommonlycausedby themisalignmentbetweenthelifecyclestateofawebviewandthat ofitsenclosingactivity fragment.weobservedthatthemajority ofsuchbugscanbeidentifiedbycomparingappuidisplays or resource usages before and after triggering lifecycle events.
for example wikipedia issue t63512 discussed in section .
.3can be detected via comparing the app ui displays before and after recreating the webview s enclosing activity no matter which part of a webpagewasoriginallydisplayedbythewebviewonthescreen thetopofthewedpagewouldbedisplayedafteractivityrecreation .
wordpress issue discussed in section .1is an another typical example that can be detected by comparing the video resource usagesbeforeandafterpausingthewebview senclosingactivity thevideowouldcontinuetoplayevenwhentheactivityispaused .this observation motivates us to leverage such comparisons as test oracles to detect bugs that are caused by misaligned webview lifecycles section .second another12ofthe124 bugscanbeidentifiedbycomparing the behaviors of webviews and web browsers.
some appdevelopers took web browsers behaviors e.g.
chrome and firefox as an oracle to identify abnormal webpage display issues.
for example an bug in save for offline that displays overlapped contentcanbeidentifiedby comparingthepagedisplayedbythe webview and that displayed by the android default browser as showninfigure .thissuggeststhepossibilityofleveragingdifferential testing to detect bugs.
.
.
conventional test coverage criteria may not apply to bug testing.unlike a native app the program logic of an app using webviews spans across its web code and native code.
for example a popular game only contains one activity and lines of java code.
its complex game functionalities are implemented in javascript.asaresult conventionaltestcoveragecriteria e.g.
code coverageoractivitycoverage leveragedbyexistingtestgenerationtechniques maynotbeeffectivefortesting bugs.in particular javascript code coverage may not be applicable because themanifestationofmany bugsdoesnotrequiretheexecution of javascript code and it is hard to measure the total number of javascript code since a webview can display an unlimited number of webpages.
to effectively test bugs new criteria measuring the coverage of different webview states and webview s interactions withappnativecomponentsaredesirable.futureresearchcanfocus on designing such coverage criteria to aid bugs testing.
answer to rq3 bugs s manifestation highly depends on the content of the loaded webpages and often requires the inter ventionoflifecycleevents.automatedoraclesandnewcoverage criteria are needed to effectively test apps using webviews.
testing bugs drivenbyourempiricalfindings weproposeanautomatedtesting technique droid to detect common types of bugs in real world androidapps.thetechniqueisdesignedbasedontwomajorobservations section .
lifecycleeventsarerequiredtotrigger common bugs and bugs can be identified by comparing ui displaysandresourceusagesbeforeandaftertriggeringlifecycle events.
inspired by the first observation droid generates test cases by injectingpredefined lifecycle event sequences on the fly when the execution of an app reaches a screen containing webview components.
droid then leverages the second observation to compare app ui displays and resource usages before and after the app handles the injected events to identify bugs.
figure8presentsahigh leveloverviewof droid whichconsists of three modules test event generator lifecycle event injector andlifecycle misalignment oracle.
test event generator explores thefunctionalityofanappundertest aut bydynamicallygeneratinguserandsystemevents.duringexploration itdetectsthe existence of webviews in the displayed components.
if a webview isdetected itanalyzestheuihierarchyandbuildsauimodelfor theloadedwebpageandinvokes lifecycleeventinjector.
lifecycle event injector then triggers predefined lifecycle events sequence andinvokes lifecyclemisalignmentoracle todetect bugs.wenow discuss the details of each module.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a tale of two cities how webview induces bugs to android applications ase september montpellier france figure overview of droid .
test event generator thetest eventgenerator module generatestest eventsfor agiven aut.
it exercises the aut using existing test generation techniques for android apps and builds ui models of webviews for furtheranalysis.weimplemented droidontopofmonkey while it can be adapted to work with other test generation approaches .
to detect the existence of webviews testeventgenerator analyzestheuihierarchyofthescreen right after the aut handles each triggered event.
if webviews exist in the current screen it builds a ui model for the loaded page.
the ui model will be used later by the lifecycle misalignment oraclemodule to detect bugs.
the ui model of a webpageis a dom tree illustrated in figure extracted using uiautomation .
in the ui model leaf nodes represent elements in the webpage that aredisplayedtouserandnon leafnodesindicatehowleafnodes are organized in the webview.
each node has a set of attributes classname contentdescription checkable checked clickable enabled focusable focused scrollable long clickable password and selected.
challenge a key challenge in test event generator is to determinethetimetobuildtheuimodelwhenawebpageisloaded.the model should be built after the page is fully rendered otherwise thebuiltmodelwouldbeincompleteandcauseimprecisioninlater steps.
however the loading time of a page is non deterministic depending on the page content and network speed.
solution weaddressedthechallengebyleveragingtwocommonscenariosinwhichapage sdomstructurechangeswhenit isbeingloaded.inthefirstscenario awebviewdisplayseithera blankpage ora simple loading message untilit hasfullyloaded the page.
in this case we have a trivial dom structure for a while inthebeginning followedbyasteadynon trivialdomstructure after the page has been loaded.
in the second scenario a webview rendersapageprogressivelywithlightcontent e.g.
text displayed beforeheavycontent e.g.imagesandvideos .inthiscase wehavean evolving dom structure that gradually becomes non trivial and steady after the page has been loaded.
with these observations droiddelaysthebuildingofauimodelforapageuntilitdetects the existence of a steady non trivial dom structure or timeout.if such dom structure is detected the current dom tree will be treatedastheuimodelfortheloadedpage.notethat droidmonitorsthechangesofdomstructureinsteadofthechangesofdom contents as the loaded contents may be dynamic e.g.
animations .
.
lifecycle event injector thelifecycle event injector module injects three kinds of lifecycle event sequences they often trigger bugs according to our empiricalstudy whenthe executionofthe autreachesa screen figure9 theuimodelofawebpageloadedbywebviewand the oracle to detect ui display inconsistence.
a and b represent the ui models of the webpage before and after activityrestart.thegreenboxrepresentsthepartofwebpagethatis visibletousers.thedashedlinesrepresentthatanodeina is also found in b. containingwebviews.theseeventsequencescancauseanactivity to go through the following state changes paused and then resumed stoppedandthenrestarted and destroyedandthen recreated.
by injecting such event sequences droid can explore all thelifecycle states ofa webview s enclosingactivity fragment and simulate common user interactions on the app such as turning screen off and on pressing home button and re entering the aut and rotating devices.
after the aut handles each injected lifecycle eventsequence droidrebuildsauimodelforthewebpagebeingdisplayedinthewebviewusingthemechanismdiscussedin section5.
.themodelisthenfedintothe lifecyclemisalignment oraclemodule to detect bugs.
.
lifecycle misalignment oracle thelifecycle misalignment oracle module relies on two rules to detect bugs.
the rule for detecting ui inconsistencies is based on acommon senseexpectation that thedisplayedcontent ofa webviewafteractivityrestartshouldbeconsistentwiththatbefore therestart.therulefordetectingunpausedresourcesisbasedonthe expectationthatwhentheenclosingactivityispaused resources loadedbywebviewsshouldbepausedaswell.thecurrentversion of droid only detects unpaused video resources.
we leave the detectionofotherkindsofresourcesasfuturework.
droidreports an bug if any of the two rules is violated.
challenge whilethedetectionofunpausedvideoresourcescan beimplemented bytestingsoundfrom videoafterthewebview s enclosingactivityispaused itisnon trivialtodefineanoracleto detect ui inconsistencies of webviews.
checking the differences of screenshots is inadequate.
as explained in section .
many webpages contain elements with dynamic effects such as animationsorvideos.suchelementscanresultindifferentscreenshots even when the webpage contents are the same.
furthermore some appsmayhandleactivityrestartsbysavingandrestoringthescroll positions ofthe displayed webpages.the restored scrollpositions can beslightly different fromthe original onesbefore the activity restarts.
such differences are usually tolerable by users but screenshotsaresensitivetosubtlechanges.asaresult simplycomparing screenshots may lead to false positives in bugs detection.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiajun hu lili wei yepang liu shing chi cheung and huaxun huang solution to precisely detect bugs lifecycle misalignment oraclemodule compares the webpages tree based ui models before and after the aut handles the injected lifecycle events.
such ui modelsignorethedynamiceffectsofwebpageelementsandthus helpreducefalsepositivesinbugdetection.thecomparisonoracle is designed based on the intuition that all the previously displayed contentinawebviewshouldbefoundinthepageafterthewebview s enclosingactivityrestarts andatleastpartofthepreviously displayed content should still be displayed after the activity restarts.
mapping ui nodes.
figure9illustrates how to compare the treebased ui models.
the models with label a and b represent the ui models ofthe webpages before and after theenclosing activity restarts.
to compare the ui models lifecycle misalignment oraclefirst maps the visible nodes in a with nodes in b. this is necessary because the elements in the displayed webpages do not have uniqueidentifiers.themappingisbasedonthetreestructureofthe uimodelsandtheattributescontainedineachnode.ifthestructure of a loaded webpage does not change a node nin a is first comparedwithanode n primeinbthatislocatedatthe corresponding position in the ui model.
node nis successfully mapped to node n prime onlyifn primesharesthesameattributevalueswith n.ifthestructure ofthewebpagechanges wecannotpairnodesaccordingtotheir positions because one node in a may be placed at another positioninb.insuchcases lifecyclemisalignmentoracle pairsthenodesin aandbaccordingtotheirattributes.anodeinaissuccessfully foundinbifthereexistsanodeinbwhoseattributevaluesarethe same with that of the node in a. reportinginconsistencies.
aftermappingthenodesbetweenui models lifecyclemisalignmentoracle willreportuiinconsistencies ifanyvisiblenodeinacannotbemappedtonodesinborallvisible nodes in a become invisible in b. evaluation in this section we evaluate the ability of droid in detecting real world bugs by answering two research questions rq4 effectivenessandpracticalityof droid can droid effectivelydetect bugsinreal worldandroidappsofconcern to app developers?
rq5 usefulnessoflifecycleeventsandtestoracles are the lifecycle events injected by droid and the test oracles adopted by droid useful to identify anomalous app behaviors induced by bugs?
.
experimental subjects and setup weconductedevaluationbasedonthe293appsselectedinsection .
amongthem weexcludedthe51appswhichwereusedtoformour empirical study dataset.
we further filtered out those apps that do not have any code revisions within the past six months for evaluation.
this is because we are only interested in actively maintained appssinceansweringrq4requiresdevelopers feedback.asaresult we obtained apps for the experiments.
we ran droid on the latest version of these apps to check if droid can detect new bugs in them.
we followed the practice adopted by an existing study to set up our experiments and ran droid for one hour to test each subject.
the tests were executed on android emulatorsrunning android .
marshmallow which wasthe most popular android system version at the time of our experiments.
to answer rq5 we built two baseline methods for comparisons baseline i test event generator this baseline leverages test event generator to trigger events and detect bugs based on software crashes a common test oracle used in existing studies .
baselineii testeventgenerator lifecycleeventinjector comparingtobaselinei baselineiiadditionallyleverages lifecycle event injector to inject lifecycle events when app subjects are being executed.
it alsodetects bugs based onsoftware crashes.
for these two baselines we reported the number of unique crashesfollowingtheapproachadoptedbysuetal.
.wedidnot prepareanadditionalbaselineinwhichonly lifecyclemisalignment oracleiskept becauseourproposed oracletargetsui inconsistenciesoccurredbetweenlifecycleevents thusitcannotworkwithout lifecycle event injector.
wemanuallyinspectedall bugsreportedby droidtocategorizethemastruepositivesorfalsepositives.foreachdetected bug droid outputs the screenshots the name of foreground activity when the bug is detected and an event trace to triggerthe bug.
with such information we reproduced each bug and categorized it as a true positive only if the oracle violation was inducedbytheinsertedlifecycleevents.assuch anoracleviolationonawebpagecontainingdynamicelementswillbetreateda false positive because the page content can become inconsistent evenwithouttriggeringlifecycleevents.wefurtherreportedthe bugs that are categorized as true positives to the app developers forconfirmation.theexperimentswereconductedonapcwith an intel core i5 cpu .
ghz and 8gb ram.
.
results for rq4 droidreported bugsin31ofthe146apps.table 2showsthe resultsforthese31apps includingappname kloc numberoftps numberoffps andtheidsofoursubmittedbugreports.notethat multiple failures can be induced by the same bug.
we consider two failures as duplicates caused by the same bug if they are manifested on the same webview of the same activity fragment withthesameconsequences.forexample droidreportedtwo failuresinthesamewebviewthatloadslog inpagesofdifferent socialnetworkwebsiteswhentestingtwidere .althoughthe loaded webpages are different when the two failures occurred the failureswereconsidered asduplicatessincetheydemonstratethe same consequences that the webpage reloads without restoring its previous states after recreating the enclosing activity.
in total droid reported unique bugs and of them are tps .
precision .allthethreetypesofeventsequencesthat canbeinjectedby lifecycleeventinjector exposed bugsthatwere categorizedastps.forexample forecastie usesawebview to load a weather map.
droid detected a bug issue that any navigations on the map will be lost after triggering lifecycle events that destroy and recreate the enclosing activity.
another example isinreddinator thevideoinawebviewdoesnotstopeven after the enclosing activity is sent to the background.
we inspected the six fps reported by droid and identified two major reasons for the imprecision.
four of the fps were due authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a tale of two cities how webview induces bugs to android applications ase september montpellier france table evaluation result of droid.
bug id with superscript f means that the bug has been fixed with superscript c means that the bug has been confirmed and with superscript n means that developers decided not to fix the bug .
id app name kloc tpfpbug id s id app name kloc tpfpbug id s serval mesh cherry .
7c arxiv mobile .
termux .
etesync .
28f19 kimai .
30c dandelion 20barcode scanner .
989n twidere .
forrunners .
budget watch .
159f22 sg .
64c rental calc .
40f23 shortyz .
vanilla music .
767n24 crossword .
2c forecastie 25gift card guard .
42f snapcast .
26openvpn for android .
864c vespucci .
691f27 web opac .
raspi check .
179c28 mtg familiar .
373n 13freifunk auto connect .
lincal .
14c padland .
diary .
47f 52n polar clock .
drinks .
sms backup .
878ftotal num of tps total num of fps tolongpageloadingtime whichcausedtimeoutintheuimodel generationprocessandthus droidbuiltincompleteuimodelsfor thewebpages.forexample thebuginpadland wasreported because droidcomparedtwoincompleteuimodelsbeforeand after injecting lifecycle events.
the other two fps were induced by dynamiccontentinwebpages.forexample polarclock uses awebviewtoloadawebpagecontainingatimer whichconstantly changes over time.
as a result the ui model of the webpage is simultaneously changing and induces fps.
to evaluate the practicality of droid we reported the tps found by droid to the app developers for their feedback.
in each bugreport weprovidedthereproductionsteps screenshots and possible solutions.
so far we have received developers replies for of the reported bugs.
developers confirmed of the bugs and quickly fixed seven of them.
they also provided positive feedbacktoourreportedbugs.forexample developersofkimai responded good catch!
having always rotation lock on so didn t quite get that yet.
happy about prs pull requests .
the comment shows the developers interest on the reported bug but they failed toidentifyitastheydidnotinjectlifecycleeventswhentestingthe app.
this shows that droid can detect unknown bugs that are ofdevelopers concern.fortheotherfourbugs threeofthemwere considered not harmful by the developers and therefore there is no needtofixthem.oneofthem mtgfamiliar wasacknowledgedbydevelopersbuttheywouldnotfixitbecausewebviews will be replaced in their app.
note that our oracle is based on common expectations of app responses to lifecycle events .
there may be exceptional cases that app developers consider violating such expectations is tolerable.
however this is not common in our evaluation as we only observed three cases.
answertorq4 droidcaneffectivelydetect bugsinandroid apps with highprecision.
droid is practically useful and can find bugs that are of developers concern.
.
results for rq5 to show the usefulness of the injected lifecycle events and our proposed oracles we compared the results of droid and the two baseline methods.
since crash is a general oracle that can help identifybugsbeyond bugs whenevaluatingthebaselinemethods we only counted the crashes related to webview.
we consider a crashrelatedtowebviewifthecrashnotificationmessagementions webview or there are webview apis in the crash stack.
weobservedthat droidoutperformedthebaselinemethods bydetectingsignificantlymore bugs.asdiscussedintheprevioussection droiddetected30truebugs.incontrast baselinei failed to detect any webview related crash while baseline ii only detected one webview related crash for the app shortyz .
the crashoccurredafterdestroyingandrecreatingactivities.itisworth mentioning that the crash can also be detected by droid since crashes also cause ui display inconsistencies.
such results indicate that injecting lifecycle events can help expose webview relatedcrashyetsuchcrashesarenotcommonasweonlyobservedonecase in our evaluation.
specific oracles are thus needed to detect commontypesof bugs.bycombining lifecycleeventinjector and lifecyclemisalignmentoracle droidcandetect bugseffectively.
answer to rq5 droid significantly outperformed the baseline methods which confirms that our proposed oracles areusefulinidentifyinganomalousappbehaviorsinducedby common bugs.
without effective oracles injecting lifecycle events alone has limited effect on exposing bugs.
discussions .
threads to validity empirical study subject selection.
our empirical findings are obtained by studying bugs in our selected android apps.
the findingsarethusaffectedbytherepresentativenessofthesesubjects.
tomitigatethisthreat wecollected124 bugsfrom51open source authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiajun hu lili wei yepang liu shing chi cheung and huaxun huang android apps that are popular large scale well maintained and diversified.basedontheempiricalstudy weproposedanautomated bugstestingtechnique droid whichsuccessfullydetected30 previously unknown bugs.thisshowsthatourempiricalfindings can be generalized to other apps.
keywords for bug collection.
when collecting code commitsandbugreportsrelatedto bugs weonlyusedgeneralkeywords webview and javascript while different projects may use different keywords to refer to webview components.
for example in wordpress webviews are often called posts since wordpress uses webviews to display blog posts.
however such app specific keywords are hard to collect.
using them as search keywordscanalsoleadtomanyirrelevantresults.therefore we only used two general keywords which already helped collect a considerable number of bugs.
errors in manual inspections.
our manual inspection may be subject to errors.
to reduce human mistakes four co authors independentlyperformedmanualinspectionsandcross checked each other s results for consistency.
.
limitations of droid limitation of test event generator.
droidleveragesexisting techniques to test apps containing webviews.
no existing work targets at generating test inputs toreachand thoroughly exercise allwebviewscontainedinanapp.asaresult thereisnoguarantee that thetest casesgeneratedby droidcan reachall webviews in an app and fully exercise their functionalities.
this may leave some bugsundetected.infuture weplantoimprovethetestcase generation module of droid to achieve more thorough testing.
limitationofwebviewuimodel.
droidbuildstheuimodel ofawebpagebasedontheinformationgivenbyuiautomation .
our ui models are thus subject to imprecisions caused by the limitationsofuiautomation e.g.
uiautomationmayfailtoprecisely model complicated webpages .
in future we also plan to explore alternativewaystodefinetheuimodelandimprovethe lifecycle misalignment oracle module in droid.
handling multiple webview instances.
if one screen containsmultiplewebviewinstances droidassumesthattheirorder remains unchanged during the testing process.
this may induce false positives if the order of the webview instances changes after droid injects lifecycle events.
however in our experiments we did not observe any false positives caused by this limitation.
related work .
webview security webviews have posed various threats to an app s security.
attacks on webviews in android system were first studied by luo etal.
.sincethen researchershavefoundmoreandmore typesofattacksonwebviewsandproposedvariousdefendingtechniques.forexample topreventuserprivatedatafrombeingleakedthroughjavascriptinterface manytechniqueshavebeenproposed to aid the detection and monitoring of cross language information flow.
typical ones are bavelview spartan jester and hybridroid .
existing work has also shown that malicious javascript code can invoke native methods and gain access to local resources such asfiles through javascript interface.
most recently liet al.
uncoveredcross app webview infection xawi a new attack that allows a remote adversary to spread malicious web content across different apps webview instances and acquire stealthy control of these apps.
our work differs from these exist ing studies since we do not limit our scope in security issues but conduct a more comprehensive study on real world bugs.
.
android lifecycle errors android app developers can easily make mistakes in managing appcomponentlifecycles.tohelpimproveappquality zaeemel al.
proposed a model based testing technique quantum to testuser interactionfeaturesofandroidapps.quantumgeneratestestoraclesbasedonthecommonsenseexpectationsofapp responsesagainstuserinteractions.quantumrequiresusersto manuallybuildanactivitytransitionmodelforanappundertest and it leverages trivial oracles such as screenshot differences for finding bugs.
our technique droid differs from quantum as it is fully automated and leverages the comparison of tree based uimodelsforbugdetection.adamsenetal.
proposedthor which injects neutral event sequences including lifecycle event sequences into existing test cases based on the intuition that neutral event sequences should not affect the outcome of a test case.
however thorreliesonmanually writtenassertionstoidentify bugs.
this is different from droid which is equipped with automatedoracles.shanetal.
proposedkrefindertostatically detect data lost when lifecycle events are triggered.
this approach may not be applicable to webview because the data of webview usually reside in the loaded webpages but their approach does not support across language data flow analysis.
conclusion and future work inthispaper weconductedanempiricalstudyon124 bugscollectedfrompopularopen sourceandroidapps.ourstudyidentified the common root causes and consequences of bugs and investigated different factors that are needed to manifest bugs.
our empirical study provides important insights that canguide future research on bug testing and diagnosis.
based on our empirical findings we proposed an automated testing technique droid to detect common types of bugs in android apps.
the evaluation of droidon146subjectsshowedthat droidcaneffectivelydetect previously unknown bugs in real world android apps that are of developers concern.
in future we plan to collect more bugs to perform a larger scale empirical study.
we also plan to study how to effectively generate user system events and appropriate webcontent to thoroughly exercise webview instances and leverage differential testing to expose more bugs.