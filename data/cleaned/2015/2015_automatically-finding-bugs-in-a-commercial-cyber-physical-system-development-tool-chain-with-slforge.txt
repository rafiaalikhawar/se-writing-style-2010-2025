automatically finding bugs in a commercial cyber physical system development tool chain with slforge shafiul azam chowdhury computer science eng.
dept.
university of texas at arlington arlington tx usasoumik mohian computer science eng.
dept.
university of texas at arlington arlington tx usasidharth mehra computer science eng.
dept.
university of texas at arlington arlington tx usa siddhant gawsane computer science eng.
dept.
university of texas at arlington arlington tx usataylor t. johnson eecs department vanderbilt university nashville tn usachristoph csallner computer science eng.
dept.
university of texas at arlington arlington tx usa abstract cyber physicalsystem cps developmenttoolchainsarewidely used in the design simulation and verification of cps data flow models.commercialcpstoolchainssuchasmathworks simulink generateartifactssuchascodebinariesthatarewidelydeployedin embeddedsystems.hardeningsuchtoolchainsbytestingiscrucial since formally verifying them is currently infeasible.
existing differential testing frameworks such as cyfuzz can not generate models richinlanguage features partly becausethese toolchains do not leverage the available informal simulink specifications.
furthermore no study of existing simulink models is available which could guide cyfuzz to generate realistic models.
to address these shortcomings we created the first large collectionofpublicsimulinkmodelsandusedthecollectedmodels properties to guide random model generation.
to further guide modelgenerationwesystematicallycollectedsemi formalsimulink specifications.
in our experiments on several hundred models the resultingslforgegeneratorwasmoreeffectiveandefficientthan the state of the art tool cyfuzz.
slforge also found new confirmed bugs in simulink.
ccs concepts softwareanditsengineering model drivensoftwareengineering software testing and debugging keywords cyber physical systems differential testing tool chain bugs acm reference format shafiulazamchowdhury soumikmohian sidharthmehra siddhantgawsane taylort.johnson andchristophcsallner.
.automaticallyfindingbugs in a commercial cyber physical system development tool chain withslforge.
in icse icse 40th international conference on software engineering may june gothenburg sweden.
acm new york ny usa pages.
permission to make digital or hard copies of part or all of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthefirstpage.copyrightsforthird partycomponentsofthisworkmustbehonored.
for all other uses contact the owner author s .
icse may june gothenburg sweden copyright held by the owner author s .
acm isbn .
introduction cyber physicalsystemdevelopersrelyheavilyoncomplexdevelopment environments or tool chains which they use to design graphical models i.e.
block diagrams ofcyber physicalsystems.
such models enable engineers to do rapid prototyping of theirsystems through simulation and code generation .
since automatically generated native code from these data flow models areoftendeployedinsafety criticalenvironments itiscrucialto eliminate bugs from cyber physical system tool chains .
ideally one should formally verify such tool chains since a tool chain bug may compromise the fidelity of simulation results or introducesubtlebugsingeneratedcode .however acommercialcyber physicalsystem cps developmenttoolchainconsists of millions of lines of code so formal verification does not yet scaletosuchtoolchains.whilecompilersandothercpstoolchain components remain mostly unverified we continue to observe frequent safety recalls in various industries .
the recalls are attributed to hidden bugs in the deployed cps artifacts themselves in spite of spending significant efforts in their design validation and verification .
testing ontheotherhand isaprovenapproachtoeffectively discover defects in complex software tool chains .
especially randomized differential testing has recently found over a thousand bugs in popular production grade compilers e.g.
gcc and llvm thatarepartofcpsdevelopmenttoolchains .the technique eliminates the need of a test oracle and can hammer the system under test in the absence of a complete formal specification of the system under test a phenomenon we commonly observe in commercialcpstoolchaintesting .differentialtesting seemssuitableforblack boxtestingoftheentirecpstoolchain and itsmostsusceptibleparts e.g.
codegenerators inparticular .
cyfuzzisthefirst andonly knownrandomizeddifferentialtesting tool for cps data flow languages .
while cyfuzz initiated the work for testing cps tool chains moreworkisnecessarytoevaluatethescheme scapabilities e.g.
forfindingbugsinsimulinkthatdeveloperscareabout.forinstance a random model generator should generate tests with properties similartothemodelspeopletypicallyuse sincetheyaremorelikely togetfixedbythesystemundertest sut developers.whilelarge repositoriesofpubliclyavailableprogramsofvariousprocedural andobject orientedprogramminglanguagesexist we acm ieee 40th international conference on software engineering authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chowdhury mohian mehra gawsane johnson csallner are not aware of such a collection of cps models.
the existing cps studiesrelyonahandfulofpublic orproprietary simulink models.
among other shortcomings the models cyfuzz generates are small and lack many syntactic constructs.
recent studies identified expressive test input generation as a success factor for compiler validation .perhapsduetoitsinabilitytogeneratelarge tests with rich language features cyfuzz has not found previously unknown bugs.
furthermore cyfuzz essentially generates invalid models and iteratively fixes them until the sut can compile and simulate them without error or exception.
however this heuristic approachrequiredseveraltime consumingiterationsanddidnot use simulink specifications which are available publicly in natural language.
toaddresstheseshortcomings wehaveconductedthefirststudy ofalargenumberofpublicsimulinkmodels.thesizeofmanyof these models is larger than the average size of models used in industry.fromthecollectedmodelsweobtainpropertiesthatare usefulfortargetingarandomsimulinkmodelgenerator.ourmodel collection is publicly available and may eliminate the nontrivial overhead of artifact collection in future studies.
next extendingcyfuzz wepresentslforge atoolforautomaticallygeneratingmodelswithadvancedsimulinklanguagefeatures.
the goal is that the slforge generated models are similar to the collectedpublicmodels.improvingoncyfuzz sundirectedrandom model generation approach slforge can generate models more efficiently by consulting available informal simulink specifications.
finally weprovidethefirstapproachto equivalentmoduloinput emi testing in cps development tool testing .
slforge creates emivariantsfromtherandommodelsitgeneratesandusestheminthedifferentialtestingsetup.duringanapproximatelyfivemonths long testing time we found and reported bugs overall mathworksconfirmed10ofthem ofwhich8werepreviouslyunknown.
to summarize the paper makes the following major contributions.
to better target a random cps model generator we conductthefirstlarge scalestudyofpubliclyavailablesimulinkmodels.asignificantportionofthesemodelsareofsizeand complexity that are comparable to models used in industry.
we identify problems in the existing cps random model generatorcyfuzzanddesignsolutionsthatdirectlyledto the discovery of new bugs in the simulink tool chain.
finally by comparing it with cyfuzz we evaluate slforge s efficiency and bug finding capability.
background thissectionprovidesnecessarybackgroundinformationoncps dataflowmodels themajorcommercialcpstool chainsimulink the state of the art differential cps tool chain testing tool cyfuzz and emi based differential testing.
.
cps data flow models and simulink whilein depthdescriptionsareavailableelsewhere thefollowingarethekeyconcepts.inacpsdevelopmenttool e.g.
simulink a user designs a cps as a set of dataflow models.
a model contains blocks.ablockacceptsdatathroughits inputports typicallyperforms on the data someoperation and may pass output through figure example hierarchical cps model rounded rectangle model shaded block oval i o solid ar row dataflow dashed arrow hierarchy.
itsoutput ports to other blocks along connection lines.
simulink specifies which port of a block supports which data types .
inaconnection wenametheblocksendingoutput sourceandthe blockreceivingdataa target.outputportsarenumberedstarting with1.inputportnumberingstartswith0 where0denotesaspecial port e.g.
the actionportofthe ifactionblock .inadditiontosuch explicitconnections using fromandgotoblocks onecandefine implicit hidden connections .
commercial cps tool chains offer many librariesof built in blocks.besidescreatingacpsfrombuilt inblocks onecanadd customblocks anddefinetheirfunctionalityviacustom native code e.g.
in matlab or c using simulink s s function feature .
most blocks have user configurable parameters .
more formally block b band connection c cmay be part of modelm m.thenaflat non hierarchical modelisatuple angbracketleftb c angbracketright wherem.bandm.cdenote the model s blocks and connections.
eachconnectionisatuple angbracketleftbs ps bt pt angbracketrightofsourceblock bs source output port ps target block bt and target input port pt.
while a simulinkconnectionmayhavemultipletargets webreaksucha multi target connection into multiple single target connection tuples without losing expressiveness.
forhierarchicalmodelswelistamodel miathierarchylevel i withitsndirectchildmodelsas mi mi k ... mi k n .thefigure1 examplem1 m2 m2 hasm1 1asitstop levelmodel.m2 2andm2 3are m1 schildmodelsathierarchylevel2.thedashedarrowstarting atb2indicatesthatinthe m1 1modelb2isaplaceholder forthem2 model.
block b1sends data to m2 whereb6receives it.
block b8 sends data back to b4inm1 .
example placeholders are the subsystem andmodel reference blocks.achildmodel m ssemanticsareinfluencedby m shierarchytypepropertyth whichdependson m sconfiguration thepresence of specific blocks in m and onm s placeholder block type.
afterdesigningamodelinsimulink userstypically compileand simulateit.
in simulation simulink numerically solves the model s mathematical relationships established by the blocks and their connections and calculates various non dead .
block s outputs according to user requested sample times and inferred context dependent time steps using built in solvers .
simulink offers differentsimulation modes .
while in normalmode simulink only simulates blocks it alsoemits some code for blocksin accelerator mode and a standalone executable in rapid accelerator mode.
aninputport pofblockbisdirectfeed through ifb soutputdependsonvaluesreceivedfrom p.theparenttochildmodelrelation authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automatically finding cps tool chain bugs with slforge icse may june gothenburg sweden is acyclic.
but within a model simulink permits feedback loops circular data flow .
during compilation simulink may reject a model ifitfailstonumericallysolvefeedbackloops aka algebraicloops .
simulink also supports explicit control flow e.g.
via ifblocks.
an if driver block connects to two if actionsubsystem blocks one for each branch via the if actionblock sactionport.
.
testing simulink with cyfuzz cyfuzzisthefirstknowndifferentialtestingframeworkforcps tool chains .
the framework has five phases.
the first three phases create a random model and the last two phases use the model to automatically test a sut.
specifically startingfrom an emptymodel the selectblocks phasechoosesrandomblocksandplacestheminthemodel.
the connectports phaseconnectstheblocks portsarbitrarily yieldinga modelthesutmayreject e.g.
duetoatypeerror.forexample an output port s data type may be incompatible with the data type of the input port it connects to.
cyfuzz iteratively fixes such bugs in thefix errors phase by responding to the sut s error messages with corresponding repair actions.
this feedback driven model generation approach despite being an imperfect heuristic can fix many such model errors.
once the sut can compile a randomly generated model cyfuzz slogsignals phasesimulatesthemodelundervaryingsut options.
the key idea of differential testing is that each such simulation isexpectedto producethe sameresults.
thisphase records the output data aka signals of each block at various time steps.
cyfuzzusesdifferentsimulinksimulationmodes partlytoexercise various code generators in the tool chain.
finally in addition to sut crashes the compare phase looks for signals that differ between two simulation setups which also indicate a bug.
cyfuzzcategorizesitsgeneratedmodelsintothreegroups success modelswithoutanycompile timeandruntimeerrors error models with such errors and timed out models whose simulationdidnotcompletewithinaconfiguredtime outvalue.although cyfuzz pioneered the differential testing of simulink using randomlygeneratedmodels itdidnotfindnewbugs perhapssince thegeneratedmodelsaresmallandsimple usingonlyfourbuilt in libraries and lacking advanced modeling features .
also cyfuzz doesnotusesimulinkspecificationsandsolelyreliesoniterative model correction.
.
emi based compiler testing equivalentmoduloinput emi testingisarecentadvancementin differentialtestingofcompilersforprocedurallanguages .complementing plain differential testing emi found over one hundred bugs in gcc and llvm .
the idea is to systematically mutate a sourceprogramaslongasitssemanticsremainequivalentunder the given input data.
engineering basic mutators is relatively easy andtheoverallschemecaneffectivelyfindbugs whencombined withapowerfulrandomgeneratorthatcancreateexpressivetest inputs e.g.
csmith .
in its original implementation emi mainly leverages csmith whichgeneratesrandomcprogramsthatdonottakeuserinputs.
a given compiler in a given configuration can then be expected to produce programs that yield the same result on all emi mutants ofa given source program.
the initial implementation proved very effective and found bugs in production grade c compilers such as gcc and llvm.
public simulink model collection to understand the properties of cps data flow models designed by both researchers and engineers we conducted the first large study ofsimulinkmodels.thelargestearliersimulinkmodelcollection we are aware of contains some 100k blocks .
however these modelsarecompany internalandthusnotavailableforthird party studies.
in contrast our collection consists of some 145k blocks which are all publicly available some require a standard simulink license as they are shipped with simulink .
for context earlier work reports that at delphi a large industrialsimulinkuser anaveragesimulinkmodelconsistsofseveral hundredblocks .ofthemodelswecollected 35consistofmore than blocks which is larger than an average model at delphi.
.
model collection and classification forthisstudy weusedthesimulinkconfigurationourorganization has licensed which includes the base simulink tool chain and a largesetoflibraries.thisconfigurationincludesthelatestsimulink version theprojectwebpageliststhedetailedconfiguration .
however withthisconfiguration wecoulddirectlycompileonly justoverhalfofthecollectedmodels astheremainingonesrequired additional libraries that were not part of our configuration .
.
.
tutorial.
this group consists of official simulink tutorial models from mathworks1.
we manually reviewed the models and theirdescriptionsintheautomotive aerospace industrialautomation generalapplications andmodelingfeaturescategoriesand excluded what we considered toy examples.
we also included here the simulink provided domain specific library we had access to i.e.
aerospace.
an example model from this group is nasa hl 665blocks whichmodels theairframeofanasahl 20lifting body a low cost complement to the space shuttle orbiter .
.
.
simple and advanced.
wecollectedmodelsfrombothmajor open source project hosting services for simulink github and matlabcentral.
weusedthegithubsearchpageforkeyword search simulink and file extension search simulink extensions .mdland.slx .
onmatlabcentral2wefilteredresultsby content type model and considered only thoserepositories with the highest average ratings projects or most downloads count in the last days projects .
to distinguish toy examples from more realistic models we labeledthegithubprojectsnouserhasforkedormarkedafavorite assimpleandtherestasadvanced.forthematlabcentralprojects we manually explored their descriptions and labeled those that demonstrate some blocks features or are academic assignments as simple and the rest as advanced.
asanexample amodelfromthe grid connectedpvarray project is adetailedmodelofa100 kwarrayconnectedtoa25 kvgridvia authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chowdhury mohian mehra gawsane johnson csallner table overview of collected public models total number of models m models we could readily compile with out extra effort c hierarchical models h total numberof blocks and connections.
group m c h blocks connect.
t tutorial s simple a advanced o other total adc dcboostconverter createdbyaseniorengineerathydroquebec research institute ireq .
it has blocks.
we classified it as advanced.
.
.
other.
thisgroupconsistsofmodelsweobtainedfrom academic papers models the academic research of colleagues models and google searches models .
an example is the benchmarks for model transformations and conformance checking releasedbyengineersattoyotatechnicalcentercalifornia .it has blocks.
.
model metrics in this study we focus on those model properties that are relevant for constraining a random model generator to models that are representativeofrealisticcpsmodels.ourmatlab basedtoolwe usedtocollectthefollowingmetricsisfreelyavailableontheproject site .
the collected metricvalues are shown as box plots with min max whiskers.
.
.
number of blocks and connections.
blocks and connections are the main elements of simulink models and are counted widely .wehaveincludedthecontentsofmaskedblocks in the parent model s count.
next we count the total number of blocks and connections at a particular hierarchy level up to hierarchy level .
ourconnection countmetricdoesnotincludehiddenconnections.
for connections with multiple target ports we count the connections target ports.
perhaps not surprisingly simple models aresmaller andadvancedmodelsarelarger thanmodelsofthe other groups figures 2a and 2b since we manually reviewed and classified them in this class.
.
.
hierarchy depth.
since industrial modelsare frequently organized as a hierarchy we measured how deep these hierarchies are.wetreatedboth subsystems andmodelreference blocksasadding ahierarchylevel.mostofthecollectedmodelsareindeedhierarchical i.e.
391models .butthemedianmaximumhierarchy depth did not extend five across all model groups.
moresurprisingwerethedistributionofblocksandconnections across hierarchy levels figures 3a and 3b .
these numbers were rathersimilaracrosshierarchylevels.overall thenumberofblocks and connections in each hierarchy level were small as denoted by the small median value.ts a o100101102103104blocks a ts a o100101102103104connections b ts a o24681012hierarchy depth c ts a o100105simulation duration sec d figure collected public models total blocks a connections b maximum hierarchy depth c and requested simulation duration d .
.
.
library participation.
this metric identifies the library each model block comes from.
for example do models mostly consist of built in blocks or do they instead contain mostly custom blocks?
if we cannot resolve a block s library i.e.
due to matlab api limitations we record the block s library as other.
figure suggests that only a small portion of the blocks are custom user defin .
across all four groups ports subsystems andmathoperations werethetwolibrariesusedmostfrequently.
slforgethussupportstheselibraries amongothers see .
.
and automatic custom block generation.
we also noted a high contribution from the signal routing library using fromandgotoblocks which enables establishing hidden data flow relationship .
.
.
.
requested simulation duration.
this metric captures the total simulation time requested by a given model not the actual cpu time spent in simulating it .
most of the models except those fromtheothergroup usedthedefaultsimulationdurationvalue of seconds figure 2d .
consequently we ran simulations using this default value in ourexperiments and have not experimented with other possible values yet.
slforge to address the shortcomings in the state of the art differential testingframeworkforcpstoolchains thissectiondescribesthe designofslforge.figure5givesanoverviewoftheslforge sseven main phases.
.
gathering semi formal specifications cyfuzz heavily relies on its fix errors phase to repeatedly com pile and simulate a model and iteratively repair errors based onthe content of simulink provided error messages.
instead of thistime consuming iterative process slforge aims at generating a validmodelinthefirstplace ifgiventhelanguagespecifications.
ofcourse thechallenge whichmotivatedcyfuzz siterativeprocess isthatthereexistsnocomplete uptodate formalsimulink specification.
.
.
design choice.
simulink specifications are available as informalandsemi formaldescriptionsofsimulinkbehavior mainly authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automatically finding cps tool chain bugs with slforge icse may june gothenburg sweden 1234567100102blocks a 1234567100102connections b figure collected public models blocks a and connections b by hierarchy level grouped by model group t s a and o .
fromthevarioussimulinkwebsites.fromourexperimentswith cyfuzz we hypothesized that many of the iterations in the fixerrors phasearedue to block data type inconsistency and fixing algebraic loops.
besides in our cyfuzz experiment .
the most frequenterrorwasblock sampletime inconsistency.wecollected specificationstobothaddresstheseissuesandtoenablecreating largehierarchicalmodels assimulinkuserspreferthismodeling choice .
sofar wehavecollecteddata typesupportandblock parameter specifications for all built in libraries.
other language specifications .
are often block and library specific.
since collecting theentiresimulinklanguagespecificationwouldbeoverwhelming we collected specifications for blocks from the most used libraries.
concretely slforge supports blocks from math operations ports andsubsystems discrete continuous logicandbitoperations sinks andsourceslibraries.
this list also covers the cyfuzz supported libraries and thus helps ease evaluating slforge.
.
.
collection process.
usinglittleengineeringeffort slforge s regular expression based parser parsed block data type and parameterspecificationsforallbuilt inblocks.however duetothelimitation of the parser and simulink s free form specification style slforge can only collect parts of some specification.
e.g.
for three different ports of the variable time delay discrete filter anddelayblocks the direct feed through property .
is described as yes ofthetimedelay second input onlywhentheleading numeratorcoefficientdoesnotequalzero and yes whenyouclear prevent direct feedthrough respectively .
.
use of semi formal specifications since complete and updated formal specifications for simulink are not publicly available existing work relies on a subset of simulink operationalspecifications whicharemanuallycraftedandpossibly outdated .unliketheseapproaches weexploredcollecting specifications directly from official simulink documentations automatically usingeasy to engineerparsers.suchparserscanautomatically update the collected specifications when new versions of thesutarereleased giventhestructureofthespecificationsgo underminorornochange.fromourexperiencewithrecentversionsofsimulinkspecifications r2015a r2017a thespecifications slforge collects indeed had minor structural changes.
although slforge parses specifications automatically and stores them using internal data structure for the aid of discussion we introduceafewnotionsinthissection.extendingthenotationof .
function tbreturnsablock ssimulink block type .forexample foreachsimulink ifblock tbreturnsif.next the validpredicate indicatesifthesimulinktypecheckerandruntimesystemaccept a given model as legitimate i.e.
when there are no compile or run time exceptions.
now we can express part of the simulink specificationasaformulaorspecification rule.givensucharule wedenotewith m satisfies thatmodel msatisfies i.e.
complies with therule.weobservethatavalidmodelsatisfiesall collected specification rules valid m m satisfies .
.
.
select blocks phase.
to support built in libraries slforge uses specifications in this phase.
specifically slforge generated models satisfy the following rules by construction.
for example using usual set cardinality notation eq.
ensures that for each if block themodelhastwo ifactionsubsystemblocks oneeachfor theifandelsebranch .
b1 m.b tb b1 if b2 m.b tb b2 ifa ction byparsingsimulinkdocumentation slforgeobtainsaset sof blocks from the sinksandsourcelibraries that are only valid in the top level model as enforced by eq.
.
similarly eq.
restricts using illegitimate blocks in non top level models depending onthe hierarchy type property of the model .
using predicate supports.
the predicate holds only when model mi s hierarchytype first argument allows block binmi based on b s block type second argument .
b mi.b i tb b nelements b mi.b i supports th mi tb b b m.b th m w stime b stime driver m th m nelementw st tb b b eq.
configureseachblock ssampletimeproperty stime.when used in hierarchical model mof aw listed hierarchy type block b ssampletimeshouldmatchthesampletimeofthemodel sdriver .
.inallothercases weusepredicate st whichholdsonlywhen the sample time property of block bis properly configured according to its block type.
to enforce such rules slforge propagates information from parent to child models.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chowdhury mohian mehra gawsane johnson csallner additio continu discont discret lo gican looku pt matho pe others ports s si gnala si gnalr sinks sources user de020406080100 blocks figure collected public models distribution of blocks across libraries shortened to the first letters each from left to right tutorial simple advanced and other.
figure5 overviewofslforge smainphases.forspace wemergedcyfuzz slasttwophasesintothesingle comparison phase.
.
.
pre connection and connect ports phases.
while cyfuzz uses a random search to connect unconnected ports and relies onlaterphasestorecoverfromillegalconnections slforgeadds connections correctly by construction by satisfying the following rules.
c m.c tb c.bt ifa ction c.pt tb c.bs if c m.c tb c.bs if tb c.bt ifa ction c.pt c2 m.c c2.bs c.bs c2.ps c.ps eq.
and eq.
together specify the control flow from an if block to its if actionblocks.
specifically each ifblock output port is connected to a single eq.
if actionblockactionport.
.
.
analyze model phase.
onthecurrentmodelstate slforge now removes algebraic loops and assigns data types.
instead of querying a disjoint set data structure every time slforge connects twoblockstodetectwhetherconnectingthemwillcreateacycle we detect them later in this phase using a single graph traversal remove algebraic loops listing1 oneachofthechildmodelsandon the top level model.
in contrast cyfuzz relies on simulink built in functionstofixalgebraicloops slforgediscoveredapreviouslyunknown simulink bug in these features .
.
.
specifically slforge identifies back edges andinterruptsthem with delayblocks .
since this process changes m slforge ensures that the model remains valid.
for example to ensure that the model satisfies the rulesineq.
andeq.
insteadofplacinga delayblockbetween anifand anif actionblock listing places it before the ifblock.
listing removing possible algebraic loops from a model.
color b denotes a block s visit status via do dfs method white unvisited gray and black visited.
method remove algebraic loops m f new set stores problematic blocks for each block b m.b set white as color b for each block b m.b ifcolor b white do dfs m b f for each block binf s get affected source block for b get and remove affected connection between sandb d prime add new delay block in m connect from stod primeand from d primetob method do dfs m b f set gray as color b for each connection c m.cwherec.bs b ifcolor c.bt white do dfs m c.bt f else ifcolor c.bt gray ifc.pt addbinfelse add c.btinf set black as color b after removing possible algebraic loops slforge propagates data typeinformation toeliminatedata typemismatches.while cyfuzzcompiledamodelwithsimulinkrepeatedlyinthefixerrorsphasetoidentifydata typeinconsistenciesbetweenconnected blocks slforgefixessucherrorsinlineartimeusingasinglegraph traversal.
specifically slforge places every block whose output data type isinitiallyknown non directfeed throughandblocksfrom source library inasetandstartingfromthem runsadepth firstsearch onthegraph representationofthemodel.data typeinformationis then propagated to other blocks along the connections from blocks with known output data types using forward propagation.
e.g.
considerconnection c m.candsaywearecurrentlyvisitingblock c.bsinthedepth firstsearch.ifthedata typeat c.psisnotsupported authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automatically finding cps tool chain bugs with slforge icse may june gothenburg sweden byc.ptasperspecification weadda data typeconversion block between the ports.
.
emi testing asrecentworksuggeststhatemi testingispromisingforcompiler testing weexploredthisdirectionforsimulink.emi testing forsimulinkcouldtakemanyforms.forexample onecouldextend amodelwithblocksandconnectionsthatremaindeadunderthe existinginputs.asanotherexample onecouldstaticallyremove some of the dead blocks.
in this work we infer an emi variant from a given randomly generated model by removing all blocks that are dead.
we approximatethesetofdeadblocksstatically usingsimulink s block reduction feature .
this approach differs from the original emi implementation inthesensethatwecollectthedead blockinformationstatically while dynamicallycollectedcodecoverage information.wechosethestaticapproachasitrequiredminimal engineering effort.
inourexperiments wenotedthatcyfuzzconnectsalloutput portstocertain sinkblocks.thegoalwastoguaranteeallblocks participationduringsimulation whichallowedtousesimulink s signal logging feature to record every block s outputs.
consequently cyfuzz generated models do not have many staticallydead blocks.
to let emi testing remove larger parts of the generated model slforge leaves random output ports unconnected.
.
classification of bugs slforge automatically detects simulink crash or unresponsiveness which we categorize as hang crash error and only reports if it is reproducibleusingthe samemodel.besidescrash wediscussthe types of bugs in following two directions .
.
compile time vs. runtime.
slforge discovers some bugs during orbefore compilingthemodel wecategorizetheseas compile time bugs.
in the event of compilation error slforge reports a bugiftheerrorisnotexpected.forexample slforgeexpectsno data typeinconsistencyerrorwhengeneratingtype safemodels.
slforgedetectssomespecification mismatchbugsevenbeforecompiling since we call various simulink apis to construct a model before compiling it.
during this process slforge reports a bug when simulink prevents it from setting a valid block parameter according to the specification .
lastly slforge detects bugs when simulating the model which we categorize as runtimebugs.
.
.
essential feature.
herewediscussbugsbasedonthe essentialgenerator differentialtestingfeaturethathelpeddiscovering them.
we attribute hierarchy to a bug if slforge can reproduce the bugonlybycreatinghierarchicalmodels.next intuitively slforge attributes specification toabugwhenitidentifiessimulinkspecificationmismatches.finally likecyfuzz slforgeidentifies comparison bugsbysimulatingamodelvaryingsutoptions .
.asaspecial case slforge attributes emito abug if someemi variant ofa successfullysimulatedmodeldoesnotcompile orresultsincomparison error when after simulation signal data of the emi variant is compared with the original model or with other emi variants.
100005001000runtime se c a 100001020num.
iter b figure runtime on valid models by model size given in blocks a average runtime of model generation b av erage number of required iterative fixes.
solid slforge dashed slforge without specification usage and analyses dotted cyfuzz.
evaluation in this section we pose and explore the following relevant research questions.
rq1can slforge generate models systematically and efficiently in contrast to cyfuzz?
rq2can slforge generate feature rich hierarchical models in contrast to cyfuzz?
rq3can slforge effectively test simulink to find bugs in the popular development tool chain?
toanswertheseresearchquestions weimplementedslforgeon topoftheopen sourcecyfuzzimplementation.intheevaluation weranslforgeon64 bitubuntu16.04virtualmachines vm of gb ram and processor cores each.
we have used two identical host machines intel i74790 cpu cores at .
ghz gb ram each .
when measuring runtime and other performance metrics rq1 we ran slforge on each of the otherwise idle host machines one vm per host .
to find bugs rq3 we ran up to five vms on each of these two hosts.
.
slforge generates models more systematically and efficiently rq1 tocompareslforge snewphaseswithcyfuzzintermsofefficiency andbug findingcapabilities weconductedthreeexperiments each generating models.
to compare with cyfuzz the experiments usedblocksfromfourofthecyfuzz supportedlibraries i.e.
sources sinks discrete andconstant .
in the first two experiments we used slforge enablingspecificationusageandanalysesin exp.s and disabling them in exp.s and in the third experiment exp.cf we used cyfuzz.
across these three experiments we kept the other generatorconfigurationparametersconstant.astime outwechose seconds.
we compared the average time taken to generate a valid model i.e.
fromselectblockstofixerrors inclusively .wealsomeasured thenumberofiterativemodel correctionsteps num.iter.
inthefix errorsphase.howeverthismetricwasnotavailableinexp.cf.in eachoftheseexperimentswestartedwithgenerating100blocks on average permodel andgraduallyincreasedtheaveragenumberof blocks by100ineachstep using20modelsineachstep upto800blocks modelonaverage.toapproximatethebug findingcapability of these three setups we counted the total number of unique bugs authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chowdhury mohian mehra gawsane johnson csallner found in each of these experiments.
data in both slforge versions had a lower average runtime than cyfuzz figure 6a .
as the number of blocks increases exp.s needs more time than exp.s togeneratesuccessmodels.whenweconfiguredcyfuzzto generatemodelshaving700 ormore blocksonaverage itfailed to generate any valid models.
similarly slforge needs fewer iterations in the fix errors phase figure6b inexp.s .moreover thisvalueremainsalmostconstant inexp.s .however perhapsnotsurprisingly thenumberincreases with the number of blocks in exp.s .
this result indicates that slforge generates models more systematically as it reduces the dynamic error correction steps significantly.
next weexaminehowthechangesinslforgeaffectthetool s bug finding capability.
the total number of unique bugs found in exp.s exp.s and exp.cf are and respectively.
exp.s foundthesamebugdiscoveredinexp.s andfound3morebugs.
whileinvestigating weobservedthathavingspecificationsenabled slforgefindingthosebugs sincewithoutthespecifications slforge could not determine whether it should report a bug given an error message returned by simulink.
as an example consider compiling amodelwithsimulink whichresultsinadata typeinconsistency errorbetweentwoblocksinthemodel.leveragingthedata type support specificationsof the two blocks slforge can report abug whenitdoesnotexpectanydata typeinconsistencybetweenthe blocks.
finally a crucial step to efficiently generate large hierarchical modelsistoeliminatethealgebraicloopsfromthem.simulinkalsorejectssimulatingsomemodelsinacceleratormodeinthepresence ofalgebraicloops whichpreventsdifferentialtestingusingthose model.
as discussed before cyfuzz depends on simulink s buggy apistoremovesuchloops whereasslforgeeliminatestheloops in the analyze model phase.
.
slforge generates large feature rich models rq2 inthisexperimentwecomparevariouspropertiesoftheslforgegenerated models to the models used in our study of public models excluding the simple models and to cyfuzz generated models.
first to compare slforge with cyfuzz we configured slforge and cyfuzz to generate models with hierarchy depth as this value is slightly larger than the median values for all model classes.
fortime outparameterwechose800secondsandgenerated100 models using each of the tools.
cyfuzz s success of generating validmodels ratedroppedto2 .wehypothesizethatcyfuzzisnot capable ofgenerating suchlarge hierarchicalmodels andreduced the maximum hierarchy depth to .
after generating models inthis configuration cyfuzz achieved a success rate.
in contrast slforge achieved a success rate with depth.
inthisexperiment slforgegeneratedmodelswithanaverage of blocks median an average of connections median and an average hierarchy depth of median .
both the averageand median values of these propertiesare larger than butstillwithinthesameorderofmagnitudeas thevalueswe observed in the collected public models.
slforge generated models are in this sense similar to the collected public models.
figure7 bugtsc the modelblock top refersto thechildmodel bottom .simulinkfailstohandleratetran sition automatically leading to a runtime failure.
figure bug tsc while specified to only acceptdoubleinputs simulink does not raise a type error for this pid controller 2dof accepting a uint16.
figure bug tsc in spite of supporting double data type in its dport block vid issued a data type consistency as it prefers integer type.
.
slforge found new bugs in simulink rq3 to answer rq3 slforge continuously generated models and tested simulink for approximately five months.
throughout the experiments configuration options for slforge varied and became applicableonceweimplementedaparticularfeature.inallofthese experimentsweusedthenormalandacceleratorsimulationmodes in the comparison framework.
we have reported almost all of the slforge suspected bugs to mathworksexcepttwocaseswherewehadassociatedthebugtoan implementation error.
for eachof the reported cases mathworks hasindicatedifitconsidersthecaseabug.forthisworkwemarkareportasa falsepositive ifmathworksconsidersthecaseanon bug.
our rate of false positive is low reports.
table 2summarizesall thebugs wehave reported.mathworks hasconfirmed10ofourreportedissuesasuniquebugs ofwhich are new bugs.
following are details of a representative subset of the confirmed bugs including slforge generated models we manuallyreducedtofitthespaceandaidbug reporting.automated test case reduction ispart offuture work.these modelsare freely available .
.
.
hang crash error bug.
when generating large hierarchicalmodels wenoticedthatmatlab s getalgebraicloops apihangs and makes the entire tool chain unresponsive tsc .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
automatically finding cps tool chain bugs with slforge icse may june gothenburg sweden table slforge discovered issues and confirmed simulink bugs tsc technical support case number from mathworks st statusofbugreport nb newbug kb knownbug fp falsepositive p discoverypoint c compiletime r runtime f bugtypebasedonessentialfeature a hang crasherror s specification c comparison h hierarchy e emi ?
not further investigated ver latest simulink version affected.
tsc summary st p f ver simulink block parameter specification mismatch constant nb c s 2015a internal rule cannot choose data type add fp c ?
2015a data type support specification mismatch pid controller 2dof nb c s 2015a automated rate transition failure first order hold nb r s h 2017a block reduction optimization does not work accelerator mode nb r e h 2017a02513701 simulink hangs for large models with hierarchy nb c a h 2015a02515280 inconsistent result and ambiguous specification subsystemcount metric nb c s h 2017a ambiguous results selecting connection with multiple destinations nb c s 2017a limited support in accelerator mode first order hold kb r c h 2015a timerdoes not execute callback as expected fp r ?
2015a undocumented specification variable integer delay kb c s 2017a incorrect data type inheritance multiple blocks nb c s 2017a figure bug tsc for the child model topright simulink s verification and validation toolbox api calculatesinconsistent subsystemcount values.mathworks ruledtheapispecificationambiguous asitdidnotproperlydefine the api s scope.
figure11 issuetsc whenusingthe internalrule to detect the addblock s output data type the rule fails to chooseacorrectdata typeforthesecondinputport e.g.
double and throws a compilation error.
.
.
specification bug.
after incorporating simulink specifications into variousslforge phases slforgestartedto identify bugs causedbyspecificationviolation.forexample bugtsc of figure manifests when simulink fails to handle blocks operating at different sample times leading to runtime failure whichis not expected as per specification.
the bug only occurs for thefirst order hold block and when slforge generates hierarchical models.
as another example figure depictssimulink s pid controller 2dof blockacceptingdataoftypeunsignedint whereas figure emi bug tsc the top model s in bottom right corner modelblock is a placeholder for the child model top and left where all blocks except bl11andbl12 are dead.
the specification states that the block only accepts data of type double tsc .
in another case we noted that in spite of supporting type doublein portd blockvariable integer delay blockvidin figure resulted intype mismatcherror.after reportingthe issue mathworks suggested that the port prefers integer types and thus issuedatypemismatcherrorwhenitwasgivenadoubletype.this specification is not publicly available.
lastly the figure issue tsc mathworks classified as expected behavior where simulink scountofthenumberof subsystems didnotmatchour count.
however part of simulink s results are inconsistent and the specification has been found ambiguous resulting in a new confirmed bug.
.
.
comparison bug.
in issue tsc one simulink instancecould simulatethe slforge generatedhierarchicalmodel in normal mode but returned an error in accelerator mode due to inconsistent block sample rates.
mathworks confirmed this as a known issue that does not have a public bug report.
.
.
emi bug.
figure12illustratessimulinkbugtsc .
notice how only block bl11 is connected to an outport block bl12 henceallremainingchildblocksaredeadandcanberemovedin emi testing.
while emi testing in normal mode removed all dead authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chowdhury mohian mehra gawsane johnson csallner childnodes emi testinginacceleratormodefailedtodoso which mathworks classified as a simulink bug.
discussion thispaperperformedthefirstlarge scalestudyonpubliclyavailable simulink models to collect and observe various properties fromthem whichcanbeutilizedtogeneraterandommodelsand serve as a collection of curated artifacts.
however some of the models are quite simple.
we endeavored to classify such modelsin the simple category manually however our approach may be imperfect and may suffer from human error.
opportunistically we found complex and large models in our study and consequently our collection of artifacts should be suitable for other empirical studies.
related work empirical studies of widely used programs date back at least to the 1970s and have gained increasing interest due to the wide availabilityofopensourceprograms .forexample earlierwork computed properties from java programs and used the properties to guide a random java program generator .
temperoetal.presentedthe qualitascorpus acuratedcollection of java programs .
although similar work has been performed in other domains we are not aware of related work in the cps domain which differs significantly from procedural or object oriented languages.
recent studies introduced measures for simulink model modularity and complexity but only evaluated them on a limitednumberofmodels.incontrastwecreatedalargercollection of391simulinkmodels.similarto ourmodelcollectionmay serve as a corpus for simulink model based empirical studies.
recentworkhasfoundmanycompilerbugsusingdifferential testing.
to generate programs that are syntactically correct many ofthetestgeneratorsharnessthelanguage scontext freegrammar andapre determinedprobabilitytablefromwhichthegenerator chooses grammar elements .
to generate programs that are also well typed mckeeman imposes the type information directly onto thestochastic grammar the generator uses .
csmith on the other hand uses various analysis and runtime checks to generate programs with no undefined behavior .
other techniques generate well typed programs using knowledge of the type system of the underlying language e.g.
jcrasher for java and using constraint logic programming such as the rust typechecker fuzzer .
whereasearlierapproachestargetcompilersoftextuallanguages includingprocedural object oriented andfunctionalones theydo not address the challenges inherent in testing cps tool chains .
cyfuzz pioneered differential testing of cps tool chains but the prototypeforsimulinkwasineffectiveinfindingnewbugs.this work addresses cyfuzz s limitations by incorporating informal simulink specifications in the random model generation process andgeneratinglargermodelswithrichlanguagefeatures which led to finding new bugs.
recent work complements randomized differential testing via emi testing.
for example le et al.
hammer c language compilers .weharnessthetechniquetocreateemi variantsofsimulinkmodels for the first time.
other work discusses the effectiveness ofrandomizeddifferentialtestingandemiforopenclcompilers and performs a comprehensiveempirical compilertesting evaluation .
amongotherworks nguyenetal.presentaruntimeverification framework for cps model analysis tools leveraging random hybrid automatageneration .incontrast ourgeneratordoesnot rely on model transformations which may limit the efficiency ofexistingwork .othertestingschemestargetpartsofthecps toolchainutilizinggraphgrammars .however complete and updated formal specifications for most commercial cps developmenttoolsareunavailableandsuchwhite boxtestinginparts was found undesirable .
sampath et al.
discuss testing cps model processing tools using semantic stateflow meta models .
unfortunately the approach does not scale and updated specifications are unavailable due to therapidreleasecyclesofcommercialcpstools .feh ret al.
model the data type inferencing logic of simulink blocks for reasoningandexperimentalpurposes .whiletheseworksfocus onasmallpartoftheentirecpstoolchain wedifferentially test the entire cps tool chain harnessing the available informal but updated specifications.
slforge is loosely related to test case generators for existing simulinkmodels andverificationandformal analysis of cps models .
but they do not aim at finding bugs in the simulink tool chain.
conclusions this paper described the first large collection of public simulink models and used the collected models properties to guide random model generation.
to further guide model generation we systematically collected semi formal simulink specifications.
in our experimentsonseveralhundredmodels theresultingrandomsimulink model generator slforge was more effective and efficient than the state of the arttoolcyfuzz.slforgealsofound8newconfirmed bugs in simulink.