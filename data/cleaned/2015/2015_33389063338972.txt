storm program reduction for testing and debugging probabilistic programming systems saikat dutta university of illinois usa saikatd2 illinois.eduwenxian zhang university of illinois usa wzhan103 illinois.eduzixin huang university of illinois usa zixinh2 illinois.edusasa misailovic university of illinois usa misailo illinois.edu abstract probabilistic programming languages offer an intuitive way to model uncertainty by representing complex probability models as simple probabilistic programs.
probabilistic programming systems pp systems hide the complexity of inference algorithms away from the program developer.
unfortunately if a failure occurs during the run of a pp system a developer typically has very little support in finding the part of the probabilistic program that causes the failure in the system.
this paper presents storm a novel general framework for reducing probabilistic programs.
given a probabilistic program with associated data and inference arguments that causes a failure in a pp system storm finds a smaller version of the program data and arguments that cause the same failure.
storm leverages both generic code and data transformations from compiler testing and domain specific probabilistic transformations.
the paper presents new transformations that reduce the complexity of statements and expressions reduce data size and simplify inference arguments e.g.
the number of iterations of the inference algorithm .
we evaluated storm on programs that caused failures in two popular probabilistic programming systems stan and pyro.
our experimental results show storm s effectiveness.
for stan our minimized programs have less code less data and fewer iterations.
for pyro our minimized programs have less code less data and fewer iterations.
we also show the benefits of storm when debugging probabilistic programs.
ccs concepts software and its engineering software testing and debugging .
keywords probabilistic programming languages software testing acm reference format saikat dutta wenxian zhang zixin huang and sasa misailovic.
.
storm program reduction for testing and debugging probabilistic programming systems.
in proceedings of the 27th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse august tallinn estonia.
acm new york ny usa pages.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than the author s must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse august tallinn estonia copyright held by the owner author s .
publication rights licensed to acm.
acm isbn .
.
.
.
introduction probabilistic programming languages offer an intuitive way to model uncertainty by representing complex probabilistic models as simple programs .
a key novelty of probabilistic programming is the separation between the probabilistic modeling andprobabilistic inference .
an endprogrammer expresses probabilistic models in a high level language with constructs for random choice e.g.
sampling from common distributions conditioning on data e.g.
observation statements and probabilistic queries e.g.
posterior distribution .
aprobabilistic programming system pp system automates many intricate details of probabilistic inference while executing one of the common inference algorithms such as monte carlo sampling or variational inference .
a pp system takes three inputs a probabilistic program a set of data points on which to perform inference and arguments of the inference algorithm.
typically pp systems compile the probabilistic program into an efficient low level inference procedure which includes initializing the underlying inference algorithm translating of probabilistic programs models to an intermediate representation simplifying the model compiling to low level api e.g.
tensorflow and many others.
the numerical and approximate nature of pp systems and implementation complexity make it hard to ensure their correctness and subtle bugs can easily remain unnoticed .
our recent study showed that over of all bugs in three popular systems are domain specific including algorithmic numerical boundary condition dimensional and accuracy bugs.
the bugs manifest as wrong results crashes infinite loops or numerical exceptions.
if a failure occurs during the execution of a pp system the developer typically has to figure out the source of the problem manually.
this is not an easy task while probabilistic programs are intuitive to write they can be notoriously hard to analyze .
probabilistic programs typically have a small number of lines of code but they exercise many functionalities of the underlying pp system.
for instance an execution of a simple line program in stan one of the most popular pp systems can execute over lines of code of stan implementation.
to be able to reproduce and analyze the failures in pp systems the developers of pp system suggest bug reports with self contained and minimalistic tests e.g.
in stan the key to a successful bug report is to provide as much context as possible ideally in the form of a small reproducible example .
this requirement is similar to the one from the standard compilers e.g.
.
minimized programs help with both debugging e.g.
calculating the reference result and speeding up regression testing by executing the programs faster .
however coming up with minimal programs requires significant manual effort through trial and error.
esec fse august tallinn estonia saikat dutta wenxian zhang zixin huang and sasa misailovic program reduction has been instrumental in the tasks of compiler testing and debugging.
for standard compilers researchers proposed various methods to reduce the size of bug revealing programs such that the reduced program still exposes the bug but helps the developer better understand and debug the program execution .
our insight is that the same conceptual approach can apply for debugging pp systems just like a compiler that translates an input program pp system translates and or executes a triple of probabilistic program data and inference arguments.
however the existing program reduction approaches for conventional languages either operate on textual representation potentially generating many illegal programs or use only syntactic information about the programs but do not leverage semantic information they are also oblivious to the inference arguments e.g.
the number of monte carlo samples .
our work.
we present storm a novel approach for automatically reducing probabilistic programs and show its utility in the scenarios of testing and debugging pp systems.
storm applies various transformations to reduce the probabilistic programs.
unlike existing approaches for conventional programs storm leverages program analysis and probabilistic reasoning to simplify bug revealing probabilistic programs.
we show the benefits of the domain specific and probabilistic information about the programs.
we formulate our problem in the spirit of given a probabilistic program p data d and inference arguments that have a property e.g.
a pp system execution fails with a particular error message the goal of probabilistic program reduction is to find a smaller p d that has the same property p d p d e.g.
the pp system execution fails with the same error message .
storm is a generic framework that uses both syntactic and domainspecific semantic information about probabilistic programs to generate only valid probabilistic programs.
we designed storm to be language agnostic it translates programs from the existing systems to a common intermediate representation storm ir.
we define all our analyses and transformations on storm ir and finally output the reduced program back to the source language.
we present the translation of two popular languages stan and pyro with significantly different syntax and language models.
storm is a transformation based framework .
it supports both conventional program transformations and novel probabilistic transformations.
novel transformations include data reducer which aims to keep specific bug revealing values in the data set distribution simplifier which replaces complex distributions or parameters with appropriate constants expressions or simpler distributions parameter remover which removes a parameter and replaces its