taming android fragmentation characterizing and detecting compatibility issues for android apps lili wei y epang liu shing chi cheung department of computer science and engineering the hong kong university of science and technology hong kong china lweiae andrewust scc cse.ust.hk abstract android ecosystem is heavily fragmented.
the numerous combinations of different device models and operating system versions make it impossible for android app developers to exhaustively test their apps.
as a result various compatibility issues arise causing poor user experience.
however little is known on the characteristics of such fragmentationinduced compatibility issues and no mature tools exist to help developers quickly diagnose and fix these issues.
to bridge the gap we conducted an empirical study on real world compatibility issues collected from popular opensource android apps.
our study characterized the symptoms and root causes of compatibility issues and disclosed that the patches of these issues exhibit common patterns.
withthesefindings weproposeatechniquenamedficfinder toautomaticallydetectcompatibilityissuesinandroidapp s. ficfinder performs static code analysis based on a model that captures android apis as well as their associated context by which compatibility issues are triggered.
ficfinder reportsactionabledebugginginformationtodeveloperswhen it detects potential issues.
we evaluated ficfinder with large scale open source android apps.
the results show that ficfinder can precisely detect compatibility issues in thes e apps and uncover previously unknown issues.
ccs concepts general and reference empirical studies software and its engineering software testing and debugging software reliability software performance humancentered computing smartphones keywords android fragmentation compatibility issues .
introduction androidisthemostpopularmobileoperatingsystemwith over market share .
due to its open nature a large number of manufacturers e.g.
samsung lg choose to develop their mobile devices by customizing the original android systems.
while this has led to the wide adoption ofandroid smartphones and tablets it has also induced the heavy fragmentation of the android ecosystem.
the fragmentation causes unprecedented challenges to app developers there are more than major versions of android os running on distinct device models and it is impractical for developers to fully test the compatibility of their apps on such devices .
in practice they often receive complaints from users reporting the poor compatibility of their apps on certain devices and have to deal with these issues frequently .
existing studies have investigated the android fragmentation problem from several aspects.
for example han et al.
were among the first who studied the compatibility issues in android ecosystem and provided evidence of hardware fragmentation by analyzing bug reports of htc and motorola devices .
linares v asquez et al.
and mcdonnell et al.
studied how android api evolutions can affect the quality e.g.
portability and compatibility and development efforts of android apps.
recently researchers also proposed techniques to help developers prioritize android devices for development and testing by mining user reviews and usage data .
although such pioneer work helpedunderstandandroidfragmentation littleisknownon the root cause of fragmentation induced compatibility issues and how developers fix such issues in reality.
in addition existing studies have not fully investigated these issues do wn to app source code level and hence cannot provide deeper insights e.g.
common issue patterns and fixing strategies to ease debugging and bug fixing tasks.
as a result there are no mature tools to help developers combat android fragmentation and improve their apps compatibility.
to better understand fragmentation induced compatibility issues in android apps we conducted an empirical study on real issues collected from popular open source android apps.
the study aims to explore the following three research questions.
for ease of presentation we will refer to fragmentation i nduced c ompatibility issues as fic issues.
rq1 issue type and root cause what are the common types of fic issues in android apps?
what are their root causes?
rq2 issue symptom what are the common symptoms of fic issues in android apps?
rq3 issue fixing how do android developers fix fic issues in practice?
are there any common patterns?
by investigating these research questions we made interesting findings.
for example we found that fic issues in android apps can cause both functional and non functional consequences and observed five major root causes of these issues.
among these root causes frequent android platform permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
ase september singapore singapore c acm.
... .
api evolution and problematic hardware driver implementation are two dominant ones.
such findings can provide developers with guidance to help avoid expose and diagnose fic issues.
besides we observed from the patches of the fic issues that they tend to demonstrate common patterns.
to fix fic issues developers often adopted similar workarounds under certain problematic software and hardware environments.
such patterns can be learned and leveraged to help automatically detect and fix fic issues.
based on our findings we designed a static analysis technique ficfinder to automatically detect fic issues in android apps.
ficfinder is driven by an api context pair model proposed by us.
the model captures android apis that suffer from fic issues and the issue triggering contexts.
the model can be learned from common issue fixing patterns.
we implemented ficfinder on soot and applied it to non trivial and popular android apps.
ficfinder successfully uncovered previously unknown fic issues in these apps.
we reported these issues to the original developers of the corresponding apps.
so far we have received acknowledgment from developers on eight reported issues.
five of them were considered critical and have been quickly fixed.
these results demonstrate the usefulness of our empirical findings and ficfinder.
to summarize we make the following major contributions in this paper to the best of our knowledge we conducted the first empirical study of fic issues in real world android apps at sourcecodelevel.
ourfindingscanhelpbetterunderstand and characterize fic issues while shedding lights on future studies related to this topic.
our dataset is publicly available to facilitate future research .
we proposed an api context pair model to capture the common patterns of fic issues in android apps.
with this model we can generalize developers knowledge and practice in handling fic issues and transfer such knowledge to aid many software engineering tasks such as automated issue detection and repair.
we designed and implemented a technique ficfinder to automatically detect fic issues in android apps.
the evaluation of ficfinder on real world subjects shows that it can effectively detect fic issues and provide useful information to facilitate issue diagnosis and fixing.
.
background while android provides vendors of mobile devices with an open and flexible software infrastructure to quickly launch their products it complicates the task of developing reliabl e android apps over these devices.
one of the known complications is induced by the infamous android fragmentation problem that arises from the need to support the proliferation of different android devices with diverse software and hardware environments .
two major causes account for the severity of fragmentation.
fast evolving android platforms.
androidplatformisevolving fast.
its api specifications and development guidelines constantly change.
as shown in table the android devices on market are running very different os versions from .
to .
with api levels from level to level .
myriad device models.
to meet market demands manufacturers e.g.
samsung keep releasing new android device models with diverse hardware e.g.
different screen sizes camera qualities and sensor compositions and customize their own android os variants by modifying thetable android os version distribution version codename api level distribution .
froyo .
.
.
.
.
gingerbread .
.
.
.
.
ice cream sandwich .
.
.x jelly bean16 .
.
.x .
.
.
.
kitkat .
.0lollipop21 .
.
.
.
marshmallow .
lower level systemandroid apps application framework inter process communication proxies android system services and managers hardware abstraction layer linux kernel with hardware drivers higher level system figure android system architecture original android software stack.
device manufacturers maketwotypicalcustomizations theyimplementlowerlevel system hardware abstraction layer and hardware drivers to allow the higher level system figure to be agnosticaboutthelower leveldriverimplementationsthat are specific to device models they modify the higher level system to meet device models special requirements e.g.
ui style .
such customizations induce variations across device models see examples in section .
.
android fragmentation creates burden to app developers who need to ensure the apps that they develop offer compatible behavior on diverse device models which support multiple os versions.
this requires tremendous coding and testing efforts.
in reality it is impractical for developers to exhaustively test their apps to cover all combinations of de vice models and os versions.
hence compatibility issues have been frequently reported by app users .
.
empirical study methodology this section presents our dataset and analysis method to answer the three research questions rq1 .
.
dataset collection step selecting app subjects.
to study the research questions rq1 we need to dig into the following data from real world android apps bug reports and discussions app source code and bug fixing patches and related code revisions.
to accomplish that we searched for suitable subjects on three major open source android app hosting sites f droid github google code .
we targeted subjects that have over downloads popular a public issue tracking system traceable over three years of development history with more than code revisions well maintained and over lines of code large scale .
we adopted these criteria because the fic issues in the subjects such selected are likely to affect a large user population using diverse device models.
we manually checked popular open source apps on the above mentioned three platforms and found candidates.
table lists some examples.
the table gives the demographics of each app including project start time category brief description of functionality user rating number of downloads on google play store lines 227table android apps used in our empirical study 1m app nameproject start timecategory description rating downloads kloc revisions issues fic issues csipsimple communication internet call client .
.
1m 5m .
ankidroid education flashcard app .
.
1m 5m .
k mail communication email client .
.
5m 10m .
vlc media video media player .
.
10m 50m .
anysoftkeyboard tools 3rd party keyboard .
.
1m 5m .
table keywords used in issue identification device compatible compatibility samsung lge sony moto lenovo asus zte google htc huawei xiaomi android.os.build of code number of code revisions number of issues documented in its issue tracking system.
the demographics show that the selected apps are popular e.g.
with millions of downloads and highly rated by users.
besides their projectsallhavealonghistoryandarewell maintained containing thousands of code revisions.
step identifying fic issues.
to locate fic issues that affected the candidate apps we searched their source code repositories for two types of code revisions the revisions whose change log contains fragmentation related keywords.
table lists these case non sensitive keywords including the name of top android device brands.
the revisions whose code diff contains the keyword android.os.build .
we selected this keyword because the android.os.build class encapsulates device information e.g.
os version manufacturer name device model and provides app developers with the interface to query such device information and adapt their code accordingly.
the keyword search returned many results suggesting that all of our candidate apps might have suffered from various fic issues.
we selected the five apps with the most number of code revisions and manually examined these revisions.
table shows the information of the five apps.
in total code revisions were found from the selected five apps.
we carefully checked these revisions and understood the code changes.
after such checking we collected a set of revisions concerning fic issues.
the number of revisions is larger than the number of issues because some issues were fixed by multiple revisions.
table last column reports the number of found issues for each app subject.
these issues form the dataset for our empirical study.
.
data analysis to understand fic issues and answer our research questions we conducted the followingtasks.
first foreachissue we identified the issue inducing apis recovered the links between issue fixing revisions and bug reports and collected and studied related discussions from online forums such as stack overflow .
second we followed the process of open coding a widely used approach for qualitative research to analyze our findings and classify each issue by its type root cause symptom and fixing pattern.
.
empirical study results .
rq1 issue type and root cause although android fragmentation is pervasive researchers and practitioners have different understanding of the problem .
so far there is no standard taxonomy to categorize fic issues.
yet such a taxonomy is crucial to un derstand how fic issues in each category are induced and thereby mechanically detected.
this motivates us to manually check the issues in our dataset and construct a taxonomy following an approach adopted by ham et al.
.
specifically we first categorized the issues into two general types device specific andnon device specific .
the former type of issues can only manifest on a certain device model while the latter type of issues can occur on most device modelswithaspecificapilevel.
thenwefurthercategorizedthe two types of issues into subtypes according to their respective root causes.
table presents our categorization results.
in total of the issues are device specific and the remaining are non device specific.
.
.
device specific fic issues device specific fic issues occur when invoking the same android api results in inconsistent behavior on different device models.
these issues can cause serious consequences such as crashes and lead to poor user ratings .
we found such issues in our dataset and identified three primary reasons for the prevalence of these issues in android apps.
problematic driver implementation.
out of the issues are caused by the problematic implementations of various hardware drivers.
the running of many android apps relies on low level hardware drivers.
different driver implementations can make an app behave differently across device models.
to ensure consistent app behavior over multiple device models app developers need to carefully adapt the code that invokes those android apis which directly or indirectly depend on low level hardware drivers.
however there are hundreds of such apis on android platform.
it is impractical for developers to conduct adequate compatibility test covering all device models whenever they use such an api in their apps.
compatibility issues can be easily left undetected before the release of their apps.
typical examples we observed are the issues caused by the proximity sensor apis.
according to the api guide proximity sensors can sense the distance between a device and its surrounding objects e.g.
users cheek and invoking getmaximumrange will return the maximum distance the sensor can detect .
in spite of such specified api guide fic issues often arise from the use of proximity sensors in reality.
for instance on devices such as samsung galaxy s5 mini or motorola defy the return value of getmaximumrange may not indicate the real maximum distance the sensor can detect.
as a result the proximity distance is incorrectly calculated leading to unexpected app behaviors .
csipsimple developers filed another example in its issue .
the issue occurred on samsung sph m900 whose proximity sensor api reports a value inversely proportional to the distance.
this causes the app to compute a distance in reverse to the actual distance.
the consequence is thatduringphonecalls withcsipsimple the screen would be touch sensitive when users hold their phones against their ears users may accidentally hang up the call in such cases 228table issue types and root causes for their occurrences type root cause issue example of fic issues device specificproblematic driver implementation csipsimple bug os customization android bug peculiar hardware composition vlc bug non device specificandroid platform api evolution ankidroid pull request original android system bugs android boolean proximitysensoractive getproximitysensorstate boolean invertproximitysensor android.os.build.
product.equalsignorecase sph m900 if invertproximitysensor proximitysensoractive !proximitysensoractive .
.
.
.
.
.
figure csipsimple issue simplified but would be touch insensitive when the users move their phones away from their ears.
csipsimple developers later tracked down the problem and fixed the issue by adapting their code to specially deal with the samsung sph m900 devices as shown in figure .
os customization.
of the device specific issues occurred due to non compliant os customizations made by android device manufacturers.
there are three basic types of customizations functionality modification functionality augmentation and functionality removal .
in our study we observed that all these three types of customizations can result in device specific issues.
functionality modifications.
android device manufacturers often modify the original implementations of android os to facilitate customization.
however their modified versions may contain bugs or do not fully comply with the original android platform specifications.
this can easily cause fic issues.
for example several issues in ankidroid anysoftkeyboard and vlc were caused by a bug in the menubuilder class of the appcompat v7 support library on certain samsung and wiko devices running android .
.
which was documented in android issue tracker issue .
the bug report contains intensive discussions among many android app developers whose apps suffered from crashes caused by this bug.
functionality augmentation.
android device manufacturers often add new features to the original android os to gain advantages in market competition.
such functionality augmentation brings burden to app developers who need to ensure that their apps correctly support the unique features on some devices and at the same time remain compatible on other devices.
unfortunately this is a non trivial task and can easily cause fic issues.
for example after samsung introduced the multi window feature on galaxy note ii in ankidroid and csipsimple developers attempted to revise their apps to support this feature.
however after several revisions the developers of csipsimple finally chose to disable the support in revision because this new feature was not fully supported by some old samsung devices and they failed to find a workaround to guarantee compatibility.
functionality removal.
some components in the original android os can be pruned by device manufacturers if they are considered useless on certain devices.
an app that invokes apis relying on the removed system components may crash causing bad user experience.
for example issue of anysoftkeyboard reported a crash on nook bnrv350.
on this device the input method settingfunctionalityisbydefaultunavailable henceinvoking the api to start input method setting activity crashed the app.
developers fixed this issue in revision b68951a intent startsettings new intent android.provider.settings.
action input method settings startsettings.setflags intent.
flag activity new task try mappcontext .startactivity startsettings catch activitynotfoundexception notfoundex showerrormessage does not support input method settings .
.
.
.
.
.
.
.
figure anysoftkeyboard issue simplified by swallowing the activitynotfoundexception and displaying a hint as shown in figure .
another example is vlc developers disabled the invocation of navigation bar hiding apis on htc one series running an android os prior to .
in revision 706530e because navigation bar was eliminated on these devices and invoking related apis would lead to the killing of the app by the os.
peculiar hardware composition.
the remaining device specific issues occurred due to the diverse hardware composition on different android device models.
it is common that different android device models may utilize different chipsets and hardware components with very different specifications .
such diversity of hardware composition can easily lead to fic issues if app developers do not carefully deal with the peculiarities of all hardware variants.
for example sd card has caused much trouble in real world apps.
android devices with no sd card one sd cardandmultiplesdcardsareallavailableonmarket.
even worse the mount points for large internal storage and external sd cards may vary across devices.
under such circumstances app developers have to spend tremendous effort to ensure correct storage management on different device models.
this is a tedious job and developers can often make mistakes.
for instance issue of vlc reported a situation where the removable sd card was invisible on asus tf700t because the sd card was mounted to a specific point on this device model.
besides asus devices vlc also suffered from similar issues on some samsung and sony devices e.g.
revisions 50c3e09 and 65e9881 whose sd card mount points were uncommon.
to fix these issues vlc developers hardcoded the directory path in order to correctly recognize and read data from sd cards on these devices.
besides sd cards different screen sizes frequently caused compatibility issues e.g.
revision b0c9ae0 of k mail revision 6b60085 of ankidroid .
.
.
non device specific fic issues we observed non device specific issues in our dataset.
their occurrences were mostly due to android platform evolution or bugs in the original systems.
these issues are independent from device models and can affect a wide range of device models running specific android os versions.
android platform api evolution.
android platform and its apis evolve fast.
on average there are api updates per month .
these updates may introduce new apis deprecate old ones or modify api behavior.
nondevice specific issues in our dataset were caused by such api evolutions.
for instance figure gives an example extracted from ankidroid revision 7a17d3c which fixed an issue caused by api evolution.
the issue occurred because 229if android.os.build.version.
sdk int sqlitedatabase.disablewriteaheadlogging .
.
.
figure ankidroid pull request simplified the app mistakenly invoked api sqlitedatabase.disablewriteaheadlogging which was not introduced until api level .
invoking this api on devices with api level lower than could crash the app.
to fix the issue developers put an api level check as a guarding condition to skip the api invocation on devices with lower level apis line .
original android system bugs.
the other nondevice specific issues were caused by bugs introduced in specific android platform versions.
as a complicated system android platform itself contains various bugs during development.
these bugs may get fixed in a new released version while still existing in older versions and hence leading to fic issues.
for instance k mail encountered a problem caused by android issue which only affects android .
.
.
on devices running android .
.
calling keychain.getprivatekey without holding a reference of the returned key would crash k mail with a fatal signal after garbage collection.
a member from the android project explained that the issue was caused by a severe bug introduced in android .
.
which was later fixed in android .
and provided a valid workaround for app developers.
answer to rq1 we observed five major root causes of fic issues in android apps of which the platform api evolution and problematic hardware drive implementation are most prominent.
it is challenging to ensure app compatibility on various device models with diverse software and hardware environments.
.
rq2 issue symptom fic issues can cause inconsistent app behavior across devices.
such behavioral inconsistency can be functional or non functional.
we discuss some common symptoms below.
of the fic issues are functional and performance issues.
their symptoms resemble those of conventional functional and performance bugs.
the vast majority of them are functional bugs.
performance issues account for a minority of the issues found.
as aforementioned section .
the functional issues can cause an app to crash e.g.
ankidroid issue in figure or not function as expected e.g.
csipsimple issue in figure .
the performanceissuescanslowdownanapp.
forinstance ankidroid developed a simple interface specifically for slow devices in revision 35d5275 .
they can also cause an app to consume excessive computational resources.
for example k mail fixed an issue in revision 1afff1e caused by an old apidelete ofsqlitedatabase which did not delete the journal file resulting in a waste of disk space.
the remaining issues affect user experience.
these issues are not bugs but require code enhancements for the diversified features of different devices.
some of these issues lead to ui variations on devices with different screen sizes.
for example anysoftkeyboard added scrollview to better viewtheapponsmall screendevicesinrevision8b911f2 .
other issues require support for device specific customizations.
for example in revision e3a0067 ankidroid developers revised the app to use amazon market instead of google play store on amazon devices .
these issues present a major challenge to android app developers .
earlier studies show that ui divergence on different sized screens isa primary reason for bad user reviews of an app .
app developers are often forced to fix these issues by enhancing or optimizing their code to provide better user experience.
from the above discussion we can also observe a key challenge in fic testing.
less than of the issues result in a crash.
to effectively detect the majority of issues we need app specific test oracles which are hard to define.
answer to rq2 fic issues can cause both functional and non functional consequences such as app crashing app not functioning performance and user experience degradation.
their symptoms can be app specific making it difficult to define oracles in compatibility testing.
.
rq3 issue fixing to better understand how developers deal with fic issues in practice we studied the patches applied to the issues in our dataset and also analyzed discussions in the related bug reports that we have successfully located.
more specifically we want to understand whether the patches exhibit common patterns how complicated the patches are and how app developers figured out these patches.
first developers tend to call the patches workarounds rather than fixes because the root causes of the issues usually reside at the system level instead of the app level see section .
.
developers mostly resolved the issues by finding a way to work around the problems making their apps compatible with problematic devices.
common patching patterns.
second although fic issues are often caused by device specific problems many patches share common patterns the most common pattern out of patches is to check device information e.g.
manufacturer sdk version before invoking the apis that can cause fic issues on certain devices.
one typical way to avoid the issues is to skip the api invocations see figure for an example or to replace them with an alternative implementation on problematic devices.
this can help fix issues caused by problematic driver implementations android platform api evolutions and android system bugs.
anothercommonstrategy 14outof191issues istocheck the availability of certain software or hardware components on devices before invoking related apis and methods.
this is a common patching strategy for fic issues caused by os customizations and peculiar hardware compositions on some device models.
the remaining patches are app specific workarounds and strongly related to the context of the fic issues.
patch complexity.
third although the concrete patching strategies vary across issues the patches themselves are usually simple and of small size several lines of code .
the most common pattern of patching only requires adding a condition which checks device information before the invocation of issue inducing apis.
similarly checking the availability of certain software hardware components usually only requires adding a try catch block or a null pointer checking statement.
for the issues in our dataset more than two thirds of the patches are such simple ones.
identifying valid patches.
albeit the patches are simple and of small size this does not imply that it is easy for developers to debug and fix fic issues.
in fact figuring out the root causes of the issues is a difficult task because it requires deep investigation of the software and hardware 230environments on android devices.
however many device firmwares and implementation details of hardware drivers are mostly inaccessible to developers.
without the required informationtolocatetherootcauses appdevelopersderived workarounds by trial and error.
in many cases they asked for volunteers to help test different workarounds or sought advice from other developers whose apps suffered from similarissues.
therearealsocasesinwhichappdeveloperscould not find a valid workaround and gave up on fixing the issues.
for example issue of csipsimple was caused by the buggy call log app on an htc device.
however since the implementation details are not accessible csipsimple developers failed to figure out the root cause of the issue and hence left the issue unfixed.
below is their comment after multiple users reported similar issues issue htc has closed source this contact call log app which makes things almost impossible to debug for me.
answer to rq3 locating the root cause of fic issues is difficult in practice.
whereas issue fixes are usually simple and demonstrate common patterns checking device information and availability of software hardware components before invoking issue inducing apis methods.
.
implications of our findings here we discussed how our findings in section .
to .
can help developers combat fic issues.
compatibility testing.
one critical challenge for compatibility testing of android apps is the huge search space caused by fragmentation.
due to limited time and budget it is impractical for developers to fully test all components of their apps on all device models running all supported os versions.
to address the challenge existing work proposed approaches to prioritize devices for compatibility testing .
however prioritizingdevicesaloneisnotsufficienttoeffectively reduce the search space.
the other two dimensions can still create a large number of combinations os versions andappcomponents.
thefindingsanddatasetofourempirical study further reduce the search space by providing extra clues about devices apis and os versions which are more likely to cause fic issues.
such information can guide developers to expose fic issues with less test effort.
for example we discussed earlier that due to the problematic driver implementation the proximity sensor apis caused many fic issues in popular apps.
app developers can first spend their limited resources on testing components that use these apis on the devices with problematic drivers.
automated detection and repair of fic issues.
by studying the root causes and patches of the fic issues we observedthatficissuesrecur e.g.
androidissue78377discussed in section .
.
in multiple apps and share similar fixes.
it suggests the possibility to generalize the observations made by studying the fic issues to automatically detect and repair fic issues in other apps.
as discussed in section .
some app developers fixed the fic issues in their apps by referencing the patches of similar issues in other apps.
this indicates the transferability of such knowledge.
to demonstrate the feasibility we manually extracted rules based on issues in our dataset and designed a static analysis tool to check for rule violations in android apps.
we will show by experiments that the tool can help detect real and unreported fic issues.
.
issue modeling and detection with our empirical findings we propose an automated technique named ficfinder to detect fic issues in android apps.
ficfinder is based on a model that captures issueinducing apis and the issue triggering context of each pattern of fic issues.
it takes an android app s java bytecode or.apkfileasinput performsstaticanalysis andoutputsits detected compatibility issues.
in the following we first explain our modeling of compatibility issue patterns and then elaborate on our detection algorithm.
.
api context pair model to automatically detect fic issues we need to find a formalism by which the issues can be adequately modeled.
by studying the root causes and fixes of fic issues we observed that many issues exhibit common patterns they are triggered by the improper use of an android api which we call issue inducing api in a problematic software hardware en vironment which we call issue triggering context .
this observation motivates us to model each pattern of compatibility issues as a pair of issue inducing api and issue triggerin g context or api context pair in short.
for apis we follow their standard definition.
for each issue trigger context we formulate it using the following context free grammar.
context condition context condition condition software env hardware env api usage as shown in the grammar an issue triggering context is defined as a conjunction of the following conditions of an issue inducing api s running environment software environment hardware environment or api usage.
more specifically software environment may consist of information related to api level software configurations and so on.
hardware environment may contain information about device brand model hardware composition and so on.
api usage describes how the concerned api is used comprising information about arguments calling context and so on.
according to this model invoking an issue inducing api will cause compatibility issues if the conditions in issue triggering c ontext are satisfied.
let us illustrate this using an example extracted from two issues that affected ankidroid discussed in pull request and .
bracketleftbigapi sqlitedatabase.disablewriteaheadlogging context apilevel devmodel !
nook hd bracketrightbig this simple example models the issue that invoking the apisqlitedatabase.disablewriteaheadlogging on devices other than nook hd running android systems with anapilevellowerthan16willleadtoappcrashing .
such api context pairs can be generated from fixed compatibility issues and used to detect unknown issues.
.
compatibility issue detection api context pair extraction.
of our studied fixed compatibility issues can be modeled as api context pairs to facilitate the detection of fic issues.
for designing and implementing ficfinder we selected api context pairs that are most likely to recur across apps and have the following properties they are statically checkable in the sense that checking the issue triggering context does not require information that can only be acquired at runtime and they can affect apps running on popular devices.
we included the latter requirement because some issues in our dataset can only affect apps running on very old device 231models which may only affect a tiny fraction of users and detecting them may not be very useful to developers.
ficfinder algorithm.
algorithm1describesficfinder s analysis process.
it takes two inputs an android app java bytecode or .apkfile and a list of api context pairs.
it outputs a set of detected fic issues and provides information to help developers debug and fix these issues.
the algorithm works as follows.
for each api context pair acpair it first searches for the call sites of the concerned api line .
for each call site callsite it then performs two checks line it checks whether the usage of api matches the problematic usage defined in acpairif there is a condition regarding api usage it checks whether the configuration of the app matches the problematic configuration defined in acpairif there is a condition regarding software configuration.
the checks for api usage and software configurations are specific to the issue triggering contextctxdefined in each acpair.
for instance for an api requiring a lowest sdk version the algorithm will check the minimum sdk version specified in the app s manifest file.
if it is newer than the required sdk version invocations of this api will not be regarded as issues.
if both checks pass the algorithm proceeds to check other software and hardware environment related conditions defined inacpair.
these checks require analyzing the statements that the issue inducing api invocation statement transitively depends on.
for this purpose the algorithm performs an inter procedural backward slicing on callsiteand obtains asliceof statements line .
more specifically the backward slicing is performed based on the program dependence graph and call graph.
initially only the api invocation statement is in the slice.
the algorithm then traverses the program dependence graph and call graph adding statements into the slice.
one statement will be added if there exists any statement in the slice that depends on it.
this process repeats until the size of the slice converges.
next the algorithm iterates over all statements in slice lines .
if any statement in slicechecks the software and hardware environment related conditions defined in acpair the algorithm conservatively considers that the app developers have already handled the potential compatibility issues lines .
otherwise the algorithm warns developers that their app may have a compatibility issue and outputs information to help them debug and fix the issues lines .
such information are actionable and include the call sites of issue inducing apis and issue triggering contexts.
implementation.
we implemented ficfinder on top of thesootanalysis framework .
ficfinder leveraged soot s program dependence graph and call graph apis to obtain the intra and inter procedural slices.
theoretically if the slicing results are sound i.e.
each obtained slice con tains all the statements that an issue inducing api invocation statement depends on our detector will not report false positives.
however in practice the soundness of slicing results highly hinges on the quality of the staticallyconstructed call graphs and program dependence graphs.
it is well known that statically constructing precise and sound call graphs and program dependence graphs for java programs android apps are mostly written in java is challenging due to the language features such as dynamic method dispatching and reflections .
for this reason ficfinder could report false warnings when analyzing some apps.
our evaluation results show that such false warnings are few.algorithm decting fic issues in an android app input an android app under analysis a list of api context pairs acpairs output detected compatibility issues 1foreach acpairinacpairs do 2callsites getcallsites acpair.api 3foreach callsiteincallsites do ifmatchapiusage callsite acpair.ctx and matchswconfig callsite acpair.ctx then slice backwardslicing callsite foreach stmtinslicedo issuehandled false ifstmtchecksacpair.ctx then issuehandled true ifissuehandled false then report a warning and debugging info .
ev aluation in this section we evaluate ficfinder with real world android apps.
our evaluation aims to answer the following two research questions rq4 issue detection effectiveness can ficfinder which is built with api context pairs extracted from our collected fic issues help detect unknown fic issues in real world android apps?
rq5 usefulness of ficfinder can ficfinder provide useful information for app developers to facilitate th e fic issue diagnosis and fixing process?
to answer the two research questions we conducted experiments on actively maintained open source android apps selected from f droid database .1table reports the basic information of these apps which include app name category the revision used in our experiments lines of code number of stars if the app is hosted on github and user rating and downloads if the app is available on google play store.
as we can see from the table these apps are diverse covering different app categories non trivial containing thousands of lines of code and popular on market achieved thousands to millions of downloads .
for the experiments we applied ficfinder to the latest version of these apps for the detection of fic issues.
we considered those apis found in the api context pairs asissue inducing .
the experiments were conducted on a macbook pro with an intel core i5 cpu .
ghz and gb ram.
we now report our experimental results.
.
rq4 issue detection effectiveness to evaluate ficfinder s performance we applied it to the latestversionof27appsubjects.
weconfiguredficfinderto report the call sites of the issue inducing apis that can cause compatibility issues warnings and the call sites of the issue inducing apis where developers have already providedworkaroundstoavoidpotentialcompatibilityissues good practices .
we manually checked all the warnings and the source code of the corresponding apps to categorize 1the experimental subjects are different from the subjec ts used in our empirical study section .
.
we did not use all o ur empirical study subjects for experiments because some of them are not actively maintained these days.
232table experimental subjects and checking results id app name categorylatest revision no.kloc starsrating downloadschecking resultsissue id s tpfpgp irssinotifier communication ad68bc3 .
.
5k 10k 1sheeld tools b49c98a .
.
10k 50k 4b connectbot communication 49712a1 .
.
1m 5m ankidroid education dd654b6 .
.
1m 5m antennapod media video 6f15660 .
.
100k 500k 1883b conversations communication 1a073ca .
.
5k 10k 1818c vlc media video .
.
10m 50m c geo entertainment 5f58482 .
.
1m 5m 5695c kore media video 0b73228 .
.
1m 5m 10anysoftkeyboard tools d0be248 .
.
1m 5m 639b transdroid tools 28786b0 .
.
100k 500k 295a k mail communication 74c6e76 .
.
5m 10m 1237c csipsimple communication fd1e332 .
.
1m 5m telegram communication a7513b3 .
.
50m 100m wordpress social efda4c9 .
.
5m 10m 16openvpn for android communication 9278fa4 .
.
1m 5m 17brave android browser personalization 65cd91d .
.
500k 1m 500754a pactrackdroid communication .
.
10k 50k 12b qksms communication 73b3ec4 .
.
100k 500k 474a 20open gps tracker travel local 763d1e2 .
.
100k 500k bankdroid finance f491574 .
.
100k 500k evercam tools c4476de .
.
10k 50k bitcoin wallet finance .
.
1m 5m chatsecure communication 30f54a4 .
.
500k 1m inaturalist education 1e837ca .
.
50k 100k owncloud productivity cfd3b94 .
.
100k 500k pockethub a6e9583 .
997b total means not applicable.
superscript a means the issues w ere acknowledged and developers agreed to fix in future.
b m eans the issues have already been fixed.
c means the issues do not seriously affect the app and develo per chose not to fix them.
bug reports of device specific issue s are underlined .
the warnings into true positives and false positives.
the results are reported as tp and fp in table .
for good practices we also report them as gp in the table.
table shows that ficfinder reported warnings and ofthemaretruepositives precisionis90.
.
thetruepositives were detected by five different api context pairs.
the number of distinct api context pairs is relatively small compared to the number of warnings detected by them.
this indicates that some commonly used issue inducing apis were not well handled by app developers.
in some apps used in our empirical study new warnings were reported.
it should be noted that the warnings were detected by rules derived from other studied subjects.
for example the warning in anysoftkeyboard is detected by a rule originally derived from k mail.
this provides evidence for transferability of the knowledge of fic issues across apps.
we manually inspected the remaining false positives and identified two major causes.
first some implicit calling contexts in the programs were missed by ficfinder and thus induced false warnings.
for example the issue inducing apis in connectbot are transitively called by a system event handler which was introduced together with the apis.
in such cases the apiswillneverbeinvokedonadevicewithanimproperapi level.
without identifying the event handler s specification ficfinder would report the call sites of the apis as warnings.
second other false positives were mostly caused by the incomplete call graphs and program dependence graphs constructed by soot which led to missing dependencies in the slices of issue inducing apis call sites.
despite ficfinder s high precision it may miss real fic issues because it was implemented based on a small number of api context pairs manually extracted from our empirical study.
this can be improved by automating the apicontext pair extraction process which we plan to explore in our future work.
in addition ficfinder adopts conservativestrategies to match issue triggering context.
such strategies may filter out possible call sites of issue inducing apis lea ding to false negatives.
however they ensure the high precision of analysis results which is important for automated bug detection tools .
besides warnings ficfinder also found good practices in out of the apps analyzed covering distinct apicontext pairs.
this confirms that fic issues are common in android apps and developers often fix such issues to improve the compatibility of their apps.
we further reported of our detected true issues to the corresponding app developers for confirmation.
there is no public issue tracking system for telegram so we did not report the issue detected in this app.
in total we submitted bug reports whose ids are provided in table .
each bug report includes all the true warnings related to each issueinducing api.
we also provided issue related discussions api guides and possible fixes in the bug reports to help developers diagnose the issues.
encouragingly eight of the reported issues have been acknowledged by developers.
among the eight acknowledged issues we observed that fiveissueswerequicklyfixedbyappdevelopers markedwith b in table and the remaining three will be fixed according to the developers feedback.
other than the eight acknowledged ones three of our submitted bug reports are still pending.
the bug reports for the remaining three issues were closed or labeled as won t fix by developers as the reported issues do not cause serious consequences to the apps marked with c in table .
we will further discuss them in section .
.
answer to rq4 the api context pairs extracted from existing fic issues can help ficfinder effectively detect unknown fic issues in real world android apps.
ficfinder s analysis precision is high.
.
rq5 usefulness of ficfinder as we mentioned earlier besides generating warnings our tool can also provide information including issue related discussions api guides and possible fixes to help developers diagnose and fix fic issues.
to study whether such information is helpful we included them in our submitted bug reports.
we learnt developers opinions on fic issues by communicating with them and made interesting findings.
first for four of the five fixed issues we observed that developersadoptedoursuggestedfixes.
fortheotherissue the developers adopted an alternative patch which was semantically equivalent to our suggested one.
this shows that the issue diagnosis information and fix suggestions provided by ficfinder are useful to developers.
it also indicates that the knowledge and developers practice learned from our studied fic issues can be transferable across apps.
second we observed one case where the app developers did not have the concerned device model to verify our suggested fix for a device specific issue brave android browser issue754 .
unlikenon device specificissues whichcanoft en bevalidatedbycheckingtheplatform sapiguides verifying device specific issues and their fixes requires developers to have access to the concerned device models running the affected android platform versions.
sometimes this task can be hard.
for example brave android browser developers replied to our bug report unfortunately i have no chance to test the fix.
could i maybe send you an apk with the fix and you can check it on your problem device?
or maybe you know how can i check it perhaps using an emulator ?
the developers replied that they did not have the affected device models to check our reported issue.
unfortunately neither did we succeed in finding the affected device models e.g.
samsung s4 mini with android .
.
in amazon device farm which is a widely used cloud based platform for testing apps on real phones.
this suggests the need for future work to validate detected fic issues and associated fixes by other means such as crowdsourcing.
for example developers may leverage our reported issue triggering contexts to identify the likely affected groups of users from user reviews and use the issue inducing apis provided by ficfinder to prepare test scenarios and seek these users further feedback and confirmation.
third while our bug reports facilitate developers to identify potential fic issues in their apps whether to fix such issues depends on the apps functionality and purpose.
for threeofourreportedissues developerschosenottofixthem.
forinstance wereportedtok 9maildevelopersthatthebehavior of alarmmanager.set has changed since api level using this api on devices with a higher api level does not guarantee the scheduled task to be executed exactly at the specified time.
however the developers considered that suchapibehaviorchangewouldnotsignificantlyaffecttheir app s main functionality i.e.
their scheduled tasks do not necessarily need to be executed at a specific time and did not proceed to fix the issues but linked our bug report to two existing unresolved bugs.
similarly developers of c geo and conversations issue closed our bug reports on issues of this api due to the same reason.
on the other hand there are also apps whose functionality could be affected by this issue.
the app 1sheeld is an example.
the developers confirmed and quickly fixed the reported issue.answer to rq5 ficfinder can provide useful information to help developers diagnose and fix fic issues.
future research efforts can be made on addressing the challenges of manifesting fic issues and verifying fixes on affected device models.
.
discussions .
threats to validity subject selection.
the validity of our empirical study results may be subject to the threat that we only selected five open source android apps as subjects.
however these five apps are selected from candidate apps as they contain most fic issues.
the apps are also diverse covering four different categories.
more importantly we observed that the findings obtained from studying the real fic issues in them are useful and helped locate previously unknown fic issues in many other apps.
fic issue selection.
our fic issue selection strategy may also pose threat to the validity of our empirical study results.
we understand that using the strategy we could miss some fic issues in dataset preparation.
for example our keywords do not contain less popular android device brands.
to reduce the threat we made effort to find the code revisions whose diff contains code that checks the device information encapsulated in the android.os.build class.
this indeed helped us find issues that happened to many small brand devices e.g.
wiko and nook .
on the other hand some existing empirical studies also selected is sues by keyword searching in the issue tracking system of open source apps .
however such strategies are not very suitable for our work due to two major reasons.
first fic issues usually do not have specific labels and thus are mixed with various other issues.
second as app developers often suggest users to provide device information when reporting bugs simply searching device related keywords will return too many results that are irrelevant to fic issues.
with our current strategy we already obtained real fic issues which are sufficient for our study.
restricted scope of studying fic issues induced by android apis.
another potential threat is that we only studied fic issues related to android apis.
while we indeed observed cases where compatibility issues are caused by using third party library apis and native libraries we restricted the scope of our current study to fic issues related to android apis.
we made this choice because fic issues induced by android apis likely have a broader impact than those arising from third party or native libraries.
evolving android device market.
as android device market evolves existing device models or os versions will be gradually phased out.
fic issues detected by apicontext pairs learned from existing issues may eventually get outdated and finally disappear from the market.
errors in manual checking.
the last threat is the errors in our manual checking of fic issues.
we understand that such a process is subject to mistakes.
to reduce the threat we followed the widely adopted open coding approach and cross validated all results for consistency.
.
automated api context pair extraction in this paper we manually inspected our collected fic issues and extracted api context pairs for issue detection.
234this is a labor intensive process.
in reality it is impractical to manually identify and extract such pairs from a large number of real fic issues.
it would be interesting to automate the process and learn these api context pairs from highly popular android apps which likely have addressed common fic issues.
as discussed earlier the most common pattern of fixing fic issues is to check device information before invoking certain apis.
therefore it is possible to extract api context pairs by correlating android apis with the code that checks device information.
the correlation can be established via static or dynamic code analysis.
we will explore this possibility in our future work.
.
related work androidfragmentationhasbeenamajorchallengeforandroid app developers .
recent studies have explored the problem from several aspects.
in this section we discuss some representative ones.
understanding android fragmentation.
severalstudies have been performed to understand problems of android fragmentation.
hanetal.
wereamongthefirstwhoexplored the android fragmentation problem .
they studied the bug reports related to htc and motorola in android issue tracking system and pointed out that android ecosystem was fragmented.
researchers have reported various findings related to android fragmentation.
for example li et al.
pointed out that app usage patterns are sensitive to device models .
pathak et al.
reported that frequent os updates represent the largest fraction of user complaints about energy bugs .
liu et al.
observed that a notable proportion of android performance bugs occur only on specific devices and platforms .
wu et al.
studied the effects of vendor customizations on security by analyzing android images from popular vendors .
later zhou et al.
proposed an approach to detecting security flaws caused by android devicedrivercustomizations .
thesestudiesdocumente d various functional and non functional issues caused by android fragmentation but did not aim to understand the root causes of such issues which are different from our study.
in addition the hci community also found that different resolutions of device displays have brought unique challenges in android app design and implementation .
holzinger et al.
reported their experience on building a business application for different devices considering divergent display sizes and resolutions .
in our dataset we also found that these issues were part of fic issues on android platforms and they can seriously affect user experience.
app testing for fragmented ecosystem.
androidfragmentation brought new challenges to app testing.
to addressthechallenges kaasilaetal.
designedanonlinesyste m to test android apps across devices in parallel .
halpern et al.
built a record and replay tool to test android apps across device models .
while these papers proposed general frameworks to test android apps across devices they did not address the problem of huge search space for fic issue testing section .
.
several recent studies aimed to reduce the search space in android app testing by prioritizing devices.
for example vilkomir et al.
proposed a device selection strategy based on combinatorial features of different devices .
khalid et al.
conducted a case study on android games to prioritize device models to test by mining user reviews on google play store .
the most recent work by lu et al.
proposedan automatic approach to prioritizing devices by analyzing user data .
it is true that by prioritizing devices testing resources can be focused on those devices with larger user impact.
however these studies alone are not sufficient to significantly reduce the search space when testing fic issues.
the reason is that the combinations of different platform versions and issue inducing apis are still too many to be fully explored.
in our work we addressed the challenge from a different angle by studying real world fic issues to gain insights at source code level e.g.
root causes and fixing patterns .
by this study we observed common issueinducing apis and the corresponding software and hardware environments that would trigger fic issues.
such findings can further help reduce the search space during app testing and facilitate automated issue detection and repair.
android api evolution.
constantly evolving android platforms cause android fragmentation.
existing work reported that the chosen sdk version and the quality of the used android apis are major factors that affect app user experience .
mcdonnell et al.
investigated how changing android apis affect api adoption in android apps .
linares v asquez et al.
studied the impact of evolving androidapisonuserratingsandstackoverflowdiscussions .
they have observed that apps using change prone and fault proneapistendtoreceiveloweruserratingsandchanges of android api have motivated app developers to open discussion threads on stackoverflow.
these studies focused on understanding the influence of using fast evolving android apis on the development procedure and app qualities but did not study the concrete symptoms or fixes of fic issues induced by such api changes.
our work not only covered fic issues with various root causes but also studied concrete fic issues so that we can provide new insights and facilitate fic issue detection and repair.
.
conclusion and future work in this paper we conducted an empirical study to understand and characterize fic issues in android apps at the source code level.
we investigated real fic issues collected from five popular open source android apps to understand their root causes symptoms and fixing strategies.
from the empirical study we obtained several important findings that can facilitate the diagnosis and fixing of fic issues and guide future studies on related topics.
based on our findings we proposed to use api context pairs that capture issue inducing apis and issue triggering contexts to model fic issues.
with this model we further designed and implemented a static analysis technique ficfinder to automatically detect fic issues in android apps.
our evaluation of ficfinder on large scale subjects showed that ficfinder can detect many unknown fic issues in the apps and provide useful information to developers.
in future we plan to explore the possibility of leveraging crowdsourcing to help developers verify certain devicespecific fic issues and validate possible fixes.
we also plan to enhance the detection capability of our technique by mining new fic issues in popular apps using the proposed apicontext framework.
.