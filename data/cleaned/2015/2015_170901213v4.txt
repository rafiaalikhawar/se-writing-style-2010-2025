frauddroid automated ad fraud detection for android apps feng dong1 haoyu wang1 li li2 yao guo3 tegawende f. bissyande4 tianming liu1 guoai xu1 jacques klein4 1beijing university of posts and telecommunications china2monash university australia3peking university china 4university of luxembourg luxembourg abstract although mobile ad frauds have been widespread state of the art approaches in the literature have mainly focused on detecting the so called static placement frauds where only a single ui state is involved and can be identified based on static information such as the size or location of ad views.
other types of fraud exist that involve multiple ui states and are performed dynamically while users interact with the app.
such dynamic interaction frauds although now widely spread in apps have not yet been explored nor addressed in the literature.
in this work we investigate a wide range of mobile ad frauds to provide a comprehensive taxonomy to the research community.
we then propose frauddroid a novel hybrid approach to detect ad frauds in mobile android apps.
frauddroid analyses apps dynamically to build ui state transition graphs and collects their associated runtime network traffics which are then leveraged to check against a set of heuristic based rules for identifying ad fraudulent behaviours.
we show empirically that frauddroid detects ad frauds with a high precision and recall .
experimental results further show that frauddroid is capable of detecting ad frauds across the spectrum of fraud types.
by analysing ad supported android apps frauddroid identified cases of fraud associated with ad networks that are further confirmed to be true positive results and are shared with our fellow researchers to promote advanced ad fraud detection.
introduction the majority of apps in android markets are made available to users for free .
this has been the case since the early days of the android platform when almost two thirds of all apps were free to download.
actually developers of third party free apps are compensated for their work by leveraging in app advertisements ads to collect revenues from ad networks .
the phenomenon has become common and is now part of the culture in the android ecosystem where advertisement libraries are used in most popular apps .
app developers get revenue from advertisers based either on the number of ads displayed also referred to as impressions or the number of ads clicked by users also referred to as clicks .
while mobile advertising has served its purpose of ensuring that developers interests are fairly met it has progressively become plagued by various types of frauds .
unscrupulous developers indeed often attempt to cheat both advertisers and users with fake or unintentional ad impressions and clicks.
these are known asad frauds .
for example mobile developers can typically employ individuals or bot networks to drive fake impressions and clicks corresponding author.
conference july washington dc usa .
acm isbn .
.
.
.
as to earn profit .
a recent report has estimated that mobile advertisers lost up to .
billion us dollars due to ad fraud in alone making research on ad fraud detection a critical endeavour for sanitizing app markets.
research on ad frauds has been extensively carried in the realm of web applications.
the relevant literature mostly focuses on click fraud which generally consists of leveraging a single computer or botnets to drive fake or undesirable impressions and clicks.
a number of research studies have extensively characterized click frauds and analysed its profit model .
approaches have also been proposed to detect click frauds by analysing network traffic or by mining search engine s query logs .
nevertheless despite the specificities of mobile development and usage models the literature on in app ad frauds is rather limited.
one example of work is the decaf approach for detecting placement frauds these consist in manipulating visual layouts of ad views also referred to as elements or controls to trigger undesirable impressions in windows phone apps.
decaf explores the ui states which refer to snapshots of the ui when the app is running in order to detect ad placement frauds implemented in the form of hidden ads the stacking of multiple ads per page etc.
madfraud on the other hand targets android apps to detect in app click frauds by analysing network traffic.
unfortunately while the community still struggles to properly address well known and often trivial cases of ad frauds deception techniques used by app developers are even getting more sophisticated as reported recently in news outlets .
indeed besides the aforementioned click and placement frauds many apps implement advanced procedures for tricking users into unintentionally clicking ad views while they are interacting with the app ui elements.
in this work we refer to this type of ad frauds as dynamic interaction frauds .
figure illustrates the case of the app taijiao music1where an ad view gets unexpectedly popped up on top of the exit button when the user wants to exit the app this usually leads to an unintentional ad click.
actually we performed a user study on this app and found that out of users were tricked into clicking the ad view.
to the best of our knowledge such frauds have not yet been explored in the literature of mobile ad frauds and are thus not addressed by the state of the art detection approaches.
this paper.
we perform an exploratory study of a wide range of new ad fraud types in android apps and propose an automated approach for detecting them in market apps.
to that end we first provide a taxonomy that characterizes a variety of mobile ad frauds including both static placement frauds anddynamic interaction frauds .
while detection of the former can be performed via analysing the 1an educational music player com.android.yatree.taijiaomusic targeting pregnant mothers for antenatal training.arxiv .01213v4 jun 2018conference july washington dc usa f. dong et al.
!
.
!
figure an example of interaction fraud.
a rapid user might accidentally click on the ad instead of the intended exit cancel .
static information of the layout in a single ui state detection of the latter presents several challenges notably for dynamically exercising ad views in a ui state achieving scalability and ensuring good coverage in transitions between ui states a ui state is a running page that contains several visual views elements also referred to as controls in android documentation.
because dynamic interaction frauds involve sequences of ui states a detection scheme must consider the transition between ui states as well as background resource consumption such as network traffic.
for example in order to detect the ad fraud case presented in figure one needs to analyse both current and next ui states to identify any ad view that is placed on top of buttons and which could thus entice users to click on ads unexpectedly.
exercising apps to uncover such behaviours can however be timeconsuming previous work has shown that it takes several hours to traverse the majority ui states of an app based on existing android automation frameworks .
automatically distinguishing ad views among other views in contrast with ui on the windows phone platform targeted by the state of the art e.g.
decaf android ui models are generic and thus it is challenging to identify ad views in a given ui state since no explicit labels are provided to distinguish them from other views e.g.
text views .
during app development a view can be added to the activity which represents a ui state implementation in android by either specifying it in the xml layout or embedding it in the source code.
in preliminary investigations we found that most ad views are actually directly embedded in the code thus preventing any identification via straightforward xml analysis.
towards building an approach that achieves accuracy and scalability in android ad fraud detection we propose two key techniques aimed at addressing the aforementioned challenges transition graph based ui exploration .
this technique builds a ui transition graph by simulating interaction events associated with user manipulation.
we first capture the relationship between ui states through building the transition graphs between them then identify ad views based on call stack traces and unique features gathered through comparing the ad views and other views in ui states.
the scalability of this step is boosted by our proposed ad first exploration strategy which leverages probability distributions of the presence of an ad view in a ui state.
heuristics supported ad fraud detection .
by manually investigating various real world cases of ad frauds we devise heuristicrules from the observed characteristics of fraudulent behaviour.
runtime analysis focusing on various behavioural aspects such as view size bounds displayed strings or network traffic is then mapped against the rules to detect ad frauds.
these techniques are leveraged to design and implement a prototype system called frauddroid for detecting ad frauds in android apps.
this paper makes the following main contributions we create a taxonomy of existing mobile ad frauds.
this taxonomy which consists of types of frauds includes not only previously studied static placement frauds but also a new category of frauds which we refer to as dynamic interaction frauds .
we propose frauddroid a new approach to detect mobile ad frauds based on ui transition graphs and network traffic analysis.
empirical validation on a labelled dataset of apps demonstrates that frauddroid achieves a detection precision of and recall of .
to the best of our knowledge frauddroid is the first approach that is able to detect the five types of dynamic interaction ad frauds presented in our taxonomy.
we have applied frauddroid in the wild on apps from major app markets to demonstrate that it can indeed scale to markets.
eventually we identified apps performing ad frauds some of them are popular apps with millions of downloads.
of such apps even come from the official google play store which indicates that measures are not yet in place to fight fraudulent behaviour.
we have released the benchmarks and experiment results to our research community at a taxonomy of mobile ad frauds before presenting the taxonomy of mobile ad frauds we briefly overview the mobile advertising ecosystem.
figure illustrates the workflow of interactions among different actors in the mobile advertising ecosystem.
app developerad networkadvertiser user1 put an ad 3publish an app4 ad feedback6 pay for ad7 pay for ad2 get ad sdk5 ad feedback apps with ad library figure an overview of the mobile advertising ecosystem.
.
mobile advertising the role of an advertiser is to design ads that will be distributed to user devices.
such ads are displayed through third party apps that are published by app developers .
the ad network thus plays the role of a trusted intermediary platform which connects advertisers to app developers by providing toolkits e.g.
in the form of ad libraries that fetch and display ads at runtime to be embedded in app code.
when a user views or clicks on an ad the ad network which is 2we have created a new github account and anonymized the author revealing information.frauddroid automated ad fraud detection for android apps conference july washington dc usa mobile ad fraudstatic placement frauddynamic interaction fraud hiddensizenumberoverlapinteractiondrive bydownloadoutsidefrequent non content figure a taxonomy of mobile ad frauds.
paid by advertisers receives a feedback based on which the app developer is remunerated.
because app developers earn revenues based on the number of ad impressions and clicks it is tempting to engage in fraudulent behaviour to the detriment of users or and advertisers.
to avoid app developers tricking users into clicking ad views and thus artificially increasing their revenues ad networks have put in place some strict policies and prohibition guidelines on how ad views should be placed or used in apps.
for example violations of any of the admob program policies is regarded as ad frauds by the google admob ad network.
besides popular app markets have released strict developer policies on how the ads should be used in apps.
nevertheless unscrupulous app developers resort to new tricks to commit ad frauds that market screeners fail to detect while ad networks are un noticeably cheated.
this is unfortunate as ad frauds have become a critical concern for the experience of users the reputation of ad networks and the investments of advertisers.
.
ad frauds while the literature contains a large body of work on placement frauds in web applications and the windows phone platform very little attention has been paid to such frauds on android.
furthermore dynamic interaction frauds have even not been explored to the best of our knowledge.
to build the taxonomy of android ad frauds we investigate in this work the usage policies provided by popular ad libraries the developer policies provided by official google play market and popular third party app markets including wandoujia alibaba app market huawei app market and tencent myapp market .
the guidelines on ad behaviour drafted by a communication standards association and some real world ad fraud cases.
figure presents our taxonomy which summarizes different types of ad frauds which represents by far the largest number of ad fraud types.
particularly the five types of dynamic interaction frauds have never been investigated in the literature.
.
.
static placement frauds.
many fraud cases are simply performed by manipulating the ad view form and position in a ui state.
static implies that the detection of these frauds could be determined by static information and occur in a single ui state.
placement implies that the fraudulent behaviour is exploiting placement aspects e.g.
size location and the number of ad views etc.
we have identified four specific types of behaviour related to static placement frauds thead hidden fraud .
app developers may hide ads e.g.
underneath buttons to give users the illusion of an ad free app which would ideally provide better user experience.
such ads however are not displayed in conformance with the contract with advertisers who pay for the promotional role of ads .
thead size fraud .
although advice on ad size that ad networks provide is not mandatory and there are no standards on ad size the size ratio between the ad and the screen is required to be reasonable allowing the ads to be viewed normally by users .
fraudulent behaviour can be implemented by stretching ad size to the limits with extremely small ad sizes app developers may provide the feeling of an ad free app however cheating advertisers similarly with abnormally large ad size there is a higher probability to attract users attention while affecting their visual experience or forcing them to click on the ad in an attempt to close it.
thead number fraud .
since ads must be viewed by users as mere extras alongside the main app content the number of ads must remain reasonable .
unfortunately developers often include a high number of ads to increase the probability of attracting user interests although degrading the usage experience of the app and even severely affecting the normal functionality when ad content exceeds legitimate app content.
thead overlap fraud .
to force users into triggering undesired impressions and clicks app developers may simply display ad views on top of actionable functionality relevant views .
by placing ads in positions that cover areas of interest for users in typical app interactions app developers create annoying situations where users must acknowledge the ad.
.
.
dynamic interaction frauds.
we have also identified cases of frauds that go beyond the placement of ad views on a single ui state but rather involve runtime behavior and may then occur in an unexpected app usage scenario.
dynamic implies that the detection of these frauds occur at runtime.
interaction implies that the fraudulent behavior is exploiting user interaction scenarios and may involve multiple ui states.
theinteraction ad fraud .
in web programming developers use interstitials i.e.
web pages displayed before or after an expected page content to display ads.
translated into mobile programming some ad views are placed when transitioning between ui states.
however frauds can be performed by placing interstitial ads early on app load or when exiting apps which could trick users into accidental clicks since interaction with the app device is highly probable at these times .
thedrive by download ad fraud .
ads are meant to provide a short promotional content designed by advertisers to attract user attention into visiting an external content page.
when app developers are remunerated not by the number of clicks but according to the number of users that are eventually transformed into actual consumers of the advertised product service there is a temptation of fraud.
a typical fraud example consists in triggering unintentional downloads e.g.
of advertised apks when the ad view is clicked on .
such behavior often heavily impacts user experience and in most cases drive by downloads cannot even be readily cancelled.conference july washington dc usa f. dong et al.
state astate bstate ctextviewlayoutimageviewadviewwebviewbuttonview tree networktrafficui state transition graph constructionad fraud detection ad load methodstring featuretype featureplacement featuread view detectorhiddensizenumberoverlapad fraud checkerdrive by downloadoutsidefrequentnon contentinteraction figure overview of frauddroid .
theoutside ad fraud .
ads are supposedly designed to appear on pages when users use the app.
fraudulent practices exist however for popping up ads while apps are running in the background or even outside the app environment e.g.
ad views placed on the home screen and covering app icons that users must reach to start new apps .
in some extreme cases the ads appear spuriously and the user must acknowledge them since such ads can only be closed when the user identifies and launches the app from which they come.
thefrequent ad fraud .
app developers try to maximize the probability of ad impressions and clicks to collect more revenue.
this probability is limited by the number of ui states in the app.
thus developers may implement fraudulent tactics by displaying interstitial ads every time the user performs a click on the app s core content e.g.
even when the click is to show a menu in the same page .
thenon content ad fraud .
to maximize the number of ad impressions and trick users into unintended clicks app developers can place ads on non content based pages such as thank you error login or exit screens.
ads on these types of ui states can confuse a user into thinking that the ads are real app content .
frauddroid to address ad frauds in the android ecosystem we design and implement frauddroid an approach that combines dynamic analysis on ui state as well as network traffic data to identify fraudulent behaviours.
figure illustrates the overall architecture of frauddroid .
the working process unfolds in two steps analysis and modelling of ui states and heuristics based detection of ad frauds .
to efficiently search for ad frauds one possible step before sending apps to frauddroid is to focus on such apps that have included ad libraries.
to this end frauddroid integrates a pre processing step which stops the analysis if the input app does not leverage any ad libraries i.e.
there will be no ad frauds in that app.
thus we first propose to filter apps that have no permissions associated with the functioning of ad libraries namely internet and access network state .
then we leverage libradar a state of the art obfuscation resilient tool to detect third party libraries including ad libraries in android apps.
.
analysis and modelling of ui states while an app is being manipulated by users several ui states are generated where ad views may appear.
ui states indeed represent the dynamic snapshots of pages i.e.
activity rendering displayedon the device.
one key hypothesis in frauddroid is that it is possible to automate the exercise of ad views by traversing all ui states.
to that end we propose to leverage automatic input generation techniques to collect ui information.
nevertheless since exhaustively exercising an app is time consuming the analysis cannot scale to market sizes.
for example in our preliminary experiments the analysis of a single app required several hours to complete.
empirical investigations of small datasets of ad supported apps have revealed however that over of the ui states do not include an ad view .
we thus develop in frauddroid a module hereafter referred to as fraudbot which implements an automated and scalable approach for triggering relevant ui states.
this module exploits a fine tuned exploration strategy to efficiently traverse ui states towards reaching most of those that contain ad views in a limited amount of time.
fraudbot thus focuses on modelling a ui state transition graph i.e.
a directed graph where a node represents a ui state and records information about the network traffic that this state is associated with the trace of method calls executed while in this state and the view tree of the ui layout in this state.
an edge between two nodes represents the test input e.g.
event view class source state that is associated with the transition between two states.
figure illustrates an example of ui state transition graphs which is constructed on the fly during app automation where input event triggering state changes as well as information on the new state are iteratively added to an initially empty graph.
before discussing how frauddroid exploits the ui state transition graph to unroll the app execution behaviour so as to detect ad frauds we provide more details on the exploration strategy of fraudbot as well as on the construction of view trees.
state b state c state aevent event 1view tree view temp id parent null resource id no id text null bounds class com.android.internal.policy.impl... children size view ... ... process info activity taijiaomusic services wappushmanagerstate b source state 08 160110 destination state 08 160128 event type touch class android.widget.button resource id id 0x8765405 ... event figure simplified illustrative example of a ui state transition graph.frauddroid automated ad fraud detection for android apps conference july washington dc usa .
.
ad first exploration strategy.
we developed a strategy that prioritizes the traversal of ui states which contain ads to account for coverage and time constraints.
to simulate the behaviour of real app users fraudbot generates test inputs corresponding to typical events e.g.
clicking pressing that are used to interact with common ui elements e.g.
button scroll .
inspired by previous findings that most ads are displayed in the main ui state and the exit ui state our exploration is biased towards focusing on these states.
to prioritize ad views in a state we resort to a breadth first search algorithm where all views in a state are reordered following ad load method traces and other ad related features which are further described in section .
.
.
considering that loading an ad from a remote server may take time we set the transition time in app automation to seconds a duration that was found sufficient in our network experimental settings.
by using an ad first exploration strategy we can reduce the app automation time from hour per app to minutes on average which is a significant gain towards ensuring scalability.
.
.
view tree construction.
for each state generated by fraudbot a view tree is constructed to represent the layout of the state aiming at providing a better means to pinpoint ad views.
the tree root represents the ground layout view on top of which upper views are placed.
by peeling the ui state we build a tree where each view is represented as a node parent nodes are containers to child nodes and users actually manipulate only leaf nodes.
each node is tagged with basic view information such as position size class name etc.
such attributes are used to identify which nodes among the leaf nodes are likely ad view nodes.
figure illustrates an example of a view tree where a leaf node representing a pop up view that is identified as an ad view.
the identification is based on the string feature representing the in app class name com.pop.is.ar a customized type the bound values of the view corresponding to the center position of the device screen as well as the size of view which is common to interstitial ads.
we describe in more detail in the next section the string and placement features that are used to detect ads.
!
!
!
.
!
!
!
.
!
!
!
.
!
!
!
.
!
!
!
!
!
!
!
!
!
!
?
.
a b!
!
!
!
!
!cd e fg hi !
!
!
j ki !
!
!
bi !
!l.
i !
!a m no p oi kq o oi hq o .
p oi o rbmh8 b4oq o m oi .99q o0 p oi o i !
!
!
q .
p i r bmh8 b4q s ih bth bq m iu oq o oi .
q o3 .
oi vv 47q bwq vk 7q 44bwwq o oi o !
!
!
oq ox .
oi x q o d oi vwq o s oi oh bth boyq ki !
!
!
figure an example of view tree for interactive fraud.
.
.
network traffic enhancement.
because some ad fraudulent behaviours such as drive by download cannot be detected solely based on view layout information we enhance the constructed viewtree with network traffic data by connecting each view node with its associated http request and the data e.g.
apk files transmitted.
the associated network data is helpful for frauddroid to detect silent downloading behaviours where certain files such as apks are downloaded without user s interaction after an ad is clicked.
.
heuristics based detection of ad frauds once a ui state transition graph is built frauddroid can find in it all necessary information for verifying whether an ad fraud is taking place in the app.
these information include for each relevant state the layout information the method call trace and the network traffic information.
we implement in frauddroid two modules to perform the ad fraud detection namely adviewdetector for identifying ad views in a state and fraudchecker for assessing whether the ad view is appearing in a fraudulent manner.
ad state state method call trace ...java util zip inflater endjava util zip inflater finalizecn waps appconnect acn waps appconnect showmorecn waps appconn ect getinstance ...ad view features string feature type feature placement featureview a view b view c view dad load method step finding the ad state by ad load method step finding the ad view by a d view features app utg state a state b state c ad view figure detection of ad views utg stands for ui state transition graph .
.
.
detection of ad views.
we recall that android views lack explicit labels that would allow to readily discriminate ad views from other views.
in a previous step of frauddroid the ad first exploration strategy was guided towards reaching ui states which are likely to include ads as recommended by suman nath .
for each of the reached ui state the adviewdetector module first checks if it has involved in ad loading methods as illustrated in figure .
after this step most ui states are excluded from consideration as they are not really ad contained states.
for the remaining ui states the adviewdetector module of frauddroid again excludes irrelevant states that are not ad contained ones where all the leaf nodes in the view tree associated to the ui states are checked against common ad features i.e.
string type and placement features .
we have identified relevant ad features after manually labelling a large amount of ad views and normal views that we have compared them from different aspects namely string type and placement features .
table presents some sample values for the ad detection features considered.
string .
manual investigations of our labelled datasets revealed that string attributes in view definitions such as associated class name can be indicative of whether it is an ad view.
most ad libraries indeed often implement specialized classes for ad views instead of directly using android system views android.widget.button android.widget.textview etc.
.
we noted however that these specialized classes names reflected their purpose with the keyword ad included e.g.
adwebview adlayout .
since simply matching the keyword ad in class names would lead to many false positives with common other words e.g.
shadow gadget load adapter adobe etc.
we rely on a whitelist of english words containing ad based on the spell checker oriented word lists scowl .
when a view is associated to a class name matches the string hint ad but is not part of the whitelist we take it as a potential ad view.conference july washington dc usa f. dong et al.
table ad features.
aspects attribute value string resource id adwebview adlayout ad container fullscreenadview fullscreenad adactivity appwallactivity etc.
type class imageview webview viewflipper placement size bounds etc.
type .
since some ad views may also be implemented based on android system views we investigate which system views are most leveraged.
all ad views in our labelled dataset are associated to three types imageview webview and viewflipper in contrast to normal views which use a more diverse set of views.
we therefore rely on the type of view used as an indicator of probable ad view implementation.
placement .
in general ad views have special size and location characteristics which we refer to as placement features.
indeed mobile ads are displayed in three common ways banner ad is located in the top or bottom of the screen interstitial ad is square and located in the centre of the screen full screen ad fills the whole screen.
furthermore ad networks actually hardcode in their libraries the size for the different types of views implemented which are also leveraged in frauddroid to identify possible ad views.
using the aforementioned features we propose a heuristic based approach to detect ad views from the view tree extracted from a ui state.
first string and type features help to identify respectively customised views that are good candidates for ad views.
subsequently placement features are used to decide whether a candidate ad view will be considered as such by frauddroid .
we have empirically confirmed that this process accurately identifies ad views implemented by more than popular ad libraries including google admob and waps.
.
.
identification of fraudulent behaviour.
once ad views are identified across all ui states in the ui state transition graph the fraudchecker module can assess their tag information to check whether a fraudulent behaviour can be spotted.
this module of frauddroid is designed to account for the whole spectrum of frauds enumerated in the taxonomy of android ad frauds cf.
section .
.
to that end fraudchecker implements heuristics rules for each specific ad fraud type ad hidden.
to detect such frauds fraudchecker iteratively checks whether any ad view has boundary coordinate information which would indicate that it is partially or totally covered by any other non ad views i.e.
it has a z coordinate below a non ad view and the d space layout occupied by both views intersect at some point.
ad size.
although the ad view size may vary on different devices our manual investigation has shown that the size ratio between ad view and the screen is relatively stable for legitimate ads.
we empirically define a ratio of for banner ads for interstitial ads and for full screen ads.
fraudchecker uses these values as thresholds combined with position information cf.
taxonomy in section .
to determine whether there is a fraudulent behaviour.
note that these values are configurable.
ad number.
in a straightforward manner fraudchecker verifies that a basic policy is respected the combined space occupied by all ads in a ui state must not exceed the space reserved to app content.when there are several ad views in a ui state along side app content i.e.
all as view tree leafs the size of ad views in total should not exceed of the screen size.
ad overlap.
similarly to the case of ad hidden fraudchecker checks whether the space occupied by an ad view on the screen intersects with the space of other normal views.
in contrast to ad hidden the overlapping views are on the same level in z coordinate.
interactive ad.
this fraud occurs with an interstitial ad.
fraudchecker first traverses the ui state transition graph to identify any ui state that contains interactive views e.g.
dialogue or button which are tempting for users to click.
then it checks the next ui state in the transition graph to inspect whether there is an ad view that is placed on top of the aforementioned interactive views i.e.
dialogue or button from the preceding ui state .
if so frauddroid flags this behaviour as an interactive fraud.
drive by download ad.
this fraud consists in triggering unwanted downloads of apps or other files without any confirmation by users after an ad is clicked on.
fraudchecker flags a given ui state as drive by download as long as the following conditions are met there are ad views in this state there is a downloading behaviour the next state in the transition graph is still associated with the same activity e.g.
it does not switch to other interfaces and the state is triggered by a touch event.
outside ad.
to detect such frauds fraudchecker keeps track of all activity names that are associated with the app.
by going through all ui states it checks whether a ui state contains an ad view that has its associated activity name different from any of the expected ones.
this indicates that the ad is shown outside the app environment.
frequent ad.
we consider an app is suspicious to frequent ad fraud as long as it has interstitial ads or full screen ads displayed more than three times3in the ui state transition graph where the three displays are triggered by different ui state transitions i.e.
several visits via the same transition path to the same ad contained ui state are considered as one visit .
non content ad.
fraudchecker flags such ui states as non content ad fraud when it identifies that interstitial ads or full screen ads exist before or after launch login exit states.
.
implementation we have implemented a lightweight ui guided test input generator to dynamically explore android apps with a special focus on ui states.
the ui guided events are generated according to the position and type of ui elements.
regarding network traffic we leverage tcpdump and the bro network security monitor respectively to harvest and analyse the network traffic.
3this number is configurable to frauddroid .frauddroid automated ad fraud detection for android apps conference july washington dc usa evaluation we evaluate the effectiveness of frauddroid with respect to its capability to accurately detect ad frauds cf.
section .
and its scalability performance cf.
section .
through measurements on runtime and memory cost of running frauddroid on a range of real world apps.
eventually we run frauddroid in the wild on a collected set of ad supported apps leveraging ad networks in order to characterize the spread of ad frauds in app markets cf.
section .
.
all experiments are performed on a real physical device namely a nexus smartphone.
we do not use emulators since ad libraries embed checking code to prevent ad networks from serving ads when the app is being experimented on emulator environments .
.
detection accuracy accuracy is assessed for both the detection of ad views by adviewdectector and the actual identification of frauds by fraudchecker .
in the absence of established benchmarks in this research direction we propose to manually collect and analyse apps towards building benchmarks that we make available to the community our first benchmark set adviewbench includes apps that were manually exercised to label views among which are ad views.
our second benchmark set adfraudbench includes adsupported apps of which exhibit fraudulent behaviours that are manually picked and confirmed.
to select the benchmark apps we have uploaded more than apps that use ad libraries to virustotal and manually checked the apps that are labelled as adware by at least two engines from virustotal.
we selected apps to cover all types of frauds from the static placement and dynamic interactive categories and ensure that each type of fraud has at least two samples.
figure illustrates the distribution of apps across the fraud types.
we have obtained an overall of ad fraud instances for apps some apps in the benchmark set indeed perform more than one types of ad frauds4.
figure distribution of the labelled apps via their ad fraud types.
.
.
accuracy in ad view identification.
we run the adviewdetector module on the ui states associated to the adviewbench of views.
the detector reports views as ad views of which are indeed ad views according to the benchmark labels.
the 4for example app az360.gba.jqrgsseed is found to implement both an interaction and a drive by download fraud.detector however misses to identify ad views in the benchmark.
table summarizes the results on precision and recall of adviewdetector .
with over of precision and recall frauddroid is accurate in detecting ad views an essential step towards efficiently detecting ad frauds.
table confusion matrix of adviewdetector on the adviewbench benchmark.
predicted views ad contained ad freelabelled viewsad contained true positives false negatives ad free false positives true negatives we further investigate the false positives and false negatives results by the adviewdetector module.
on the one hand we found by analysing the ui states collected during app automation that some ads are not successfully displayed the library fails to load ad content due to network connection failures or loading time outs.
nevertheless because of the calls to ad loading methods frauddroid will anyway flag those views without ads displayed as ad views which however are not considered as such during our manual benchmark building process resulting in false positive results.
on the other hand we have found that some ui states although they include ad views do not include calls to ad loading methods the ad views were inherited from prior states and some events e.g.
such as drag or scroll events that triggered the transition to new states do not cause a reloading of views.
such cases result in false negatives by adviewdetector which misses to report any ad view in the ui state.
.
.
accuracy in ad fraud detection.
to evaluate the accuracy of our approach in detecting ad fraud behaviours we run frauddroid on the adfraudbench benchmark apps.
table provides the confusion matrix obtained from our experiments in classifying whether an app is involved in any ad fraud.
among the apps in the benchmark frauddroid flags as performing ad frauds checking against the benchmarks these detection results include cases of false positives and false negatives leading to precision and recall metrics of .
and respectively.
table confusion matrix of fraud detection by frauddroid on the adfraudbench benchmark.
predicted frauds ad fraud w o ad fraudlabelled fraudsad fraud true positives false negatives w o ad fraud false positives true negatives we further investigate the false positive negative detection cases to understand the root causes of frauddroid s failures.
we find that all such cases are caused by misclassification results by the adviewdetector module.
frauddroid misses ad frauds because the ui state is not marked as relevant since no ad views were identified on it.
similarly when frauddroid falsely identified an ad fraud it was based on behaviours related to a view that was wrongly tagged as an ad view.conference july washington dc usa f. dong et al.
.
scalability assessment to assess the capability of frauddroid to scale to app markets we measure the runtime performance of the steps implementing the two key techniques in our approach the ui state transition graph construction and the heuristics based detection of ad frauds.
to comprehensively evaluate time and memory consumed byfrauddroid we consider apps from a wide size range.
we randomly select apps in each of the following five size scales5 100kb 1mb 10mb 50mb and 100mb.
overall the experiments are performed on apps for which we record the time spent to complete each step and the memory allocated.
the results are presented in figure .
the average time cost for constructing ui transition graphs .7seconds is significantly higher than that of detecting ad frauds .4seconds .
however we note that unlike for ui transition graphs time to detect ad frauds is not linearly correlated to the app size.
the ui transition graph is built by dynamically exploring the app where larger apps usually have more running states while detection solely relies on a pre constructed graph.
nevertheless thanks to the ad first exploration strategy frauddroid is able to analyse every apps in the dataset within .
minutes.
comparing with experiments performed in state of the art app automation works frauddroid provides substantial improvements to reach acceptable performance for scaling to app market sizes.
interestingly memory consumption is reasonable around 20mb and roughly the same for both steps.
050100150200250300times s 05101520253035memory mb .
.
.
.81times s 0510152025memory mb b performance evaluation of ad fraud detection a performance evaluation of ui transition graph construction figure performance evaluation of frauddroid .
.
detection in the wild we consider over million android apps crawled between april and august from eight app markets namely the official google play store and alternative markets by huawei xiaomi baidy tencent pp mgyapp and mobile.
using libradar we were able to identify ad libraries from ad networks represented each in at least apps.
for the experiments in the wild we randomly select apps per ad network except for admob for which we consider apps to reflect the substantially larger proportion of ad supported apps relying on admob.
eventually our dataset is formed by android apps as shown in table .
5e.g.
for the scale 100kb the apps must be of size between 80kb and 120kb.
.
.
overall results.
frauddroid identified .
apps among the dataset apps as implementing ad frauds.
we note that ad frauds occur on a wide range of app categories from games to tools.
some detected ad fraud apps are even popular among users with over million downloads.
for example the app ancient tomb run has received over million downloads although frauddroid has found that it contains a non content ad fraud.
.
.
ad fraud distribution by type.
figure shows the distribution of the apps based on the types of frauds.
static placement frauds only account for a small portion of the total detected ad fraud apps.
over of the fraud cases are dynamic interaction frauds which to the best of our knowledge we are the first to investigate with this work.
this is an expected result since dynamic interaction frauds are more difficult to detect and thus they can easily pass vetting schemes on app markets and they are most effective in misleading users into triggering ad impressions and clicks leading to more revenues.
figure ad fraud distribution by type.
.
.
ad fraud distribution by app markets.
table enumerates the distribution of detected ad fraud apps based on the markets where they were collected.
the pp assistant market includes the highest rate .
of ad frauds among its ad supported apps in our study.
huawei market includes the lowest rate .
of ad frauds.
finally the ad fraud rate in google play is slightly lower than the average across markets.
table dataset from eight major android app markets.
app market ad apps fraud percentage google play .
mobile assistant .
baidu mobile assistant .
huawei .
xiaomi .
tencent yingyongbao .
mgyapp .
pp assistant .
total .
these statistics show that no market is exempt from ad frauds suggesting that at the moment markets have not implemented proper measures to prevent penetration of fraudulent apps intofrauddroid automated ad fraud detection for android apps conference july washington dc usa their databases.
we also found that some markets do not even provide explicit policies to regulate the use of ads in apps.
.
.
ad fraud distribution by ad networks.
table presents the distribution of ad fraud apps by ad networks.
although most ad frauds target some popular ad networks no ad networks were exempt from fraudulent behaviours appbrain appears to be the most targeted with .
of its associated apps involved in ad frauds.
table distribution of ad fraud apps based on ad networks.
ad network ad fraud percent ad network ad fraud percent admob .
adwhirl .
appbrain .
dianjin .
waps .
vpon .
feiwo .
inmobi .
baiduad apperhand .
anzhi .
startapp youmi .
mobwin .
doodlemobile .
jumptap .
adsmogo fyber .
kugo .
domob .
interestingly although google admob has published strict policies on how ad views should be placed to avoid ad frauds we still found fraudulent apps associated to admob .
in some cases we have found that several popular apps using a specific ad network library can exhibit serious fraud behaviours.
for example app thermometer with million downloads in google play is flagged by frauddroid as implementing an interaction fraud.
we also investigate user reviews of some fraudulent apps and confirmed that users have submitted various complaints about their ad fraud behaviours .
this evidence suggests that ad networks should not only publish explicit policies to regulate the usage of their ad networks but also introduce reliable means to detect policy violated cases for mitigating the negative impact on users and advertisers.
.
.
detection results of virustotal.
we have uploaded all the detected fraudulent apps to virustotal to explore how many of them could be flagged by existing anti virus engines.
there are apps .
labelled as adware by at least one engine.
some apps are even flagged by more than engines.
for example app com.zlqgame.yywd was flagged by engines and app com.scanpictrue.main was flagged by engines .
however roughly half of these fraudulent apps are not flagged which suggests that ad fraud behaviours cannot be sufficiently identified by existing engines especially for dynamic interaction frauds as .
out of of these un flagged apps contain only such frauds.
.
.
case studies.
we now present real world case studies to highlight the capability of frauddroid for detecting a wide range of fraud types.
figure illustrates nine examples of ad fraud apps that are found by frauddroid from google play and third party markets.
aninteraction ad fraud was spotted in app com.android.yatree.
taijiaomusic where an ad view pops up spuriously above the exit dialogue.
adrive by download ad fraud is found in app com.hongap.slider where a download starts once the ad view is clicked.
app com.natsume.stone.android implements an outside ad fraud where the ad view is displayed on the home screen although the app was exited.
app com.funappdev.passionatelovers.frames includes a frequent ad fraud with an ad view popping up every time the main activity receives an event.
app cc.chess is identified as showing a non content ad since the ad view appears on the empty part of the screen this may confuse users into thinking that the ad is an actual content of the host app .
in app forest.best.livewallpaper anad hidden fraud has consisted in hiding an ad view behind the email button.
anad size fraud is found in app com.dodur.android.golf with the ad view on the right side of the screen made too small for users to read.
app com.maomao.androidcrack places three ad views on top of a page with little content implementing an ad number fraud.
appcom.sysapk.wifibooster implements an ad overlap fraud where an ad view is placed on top of four buttons of the host app.
discussion in this work we empirically observe that ad frauds have penetrated into official and alternative markets.
all ad networks are also impacted by these fraudulent practices exposing the mobile advertising ecosystem to various threats related to poor user experience and advertisers losses.
we argue that our community should invest more effort into the detection and mitigation of ad frauds towards building a trustworthy ecosystem for both advertisers and end users.
frauddroid contributes to such an effort by providing the building blocks in this research direction.
the implementation of frauddroid however carries several limitations.
ad state coverage.
our experiment reveals that over of ads are displayed in either the main ui state or the exit ui state which provide a means for frauddroid to optimize its ui exploration strategy in order to achieve a balance between time efficiency and ui coverage.
however this trade off may cause certain ad views to be missed during ui exploration.
fortunately frauddroid provides parameters to customize the coverage e.g.
via traversal depth and hence to improve the soundness of the approach to reach states where the ad fraud behaviour is implemented.
other types of ad frauds.
although we have considered nine types of ad frauds including five new types of dynamic interaction frauds which have not been explored before our taxonomy may still be incomplete since it was built based on current policies and samples available.
other emerging types of ad frauds may have been missed.
nevertheless the ui transition graph built by frauddroid is generic and can be reused to support the detection of potential new types of ad frauds.
related work this work is mainly related to two lines of research automated app testing and ad fraud detection.
.
automated app testing automated app testing has been widely adopted for exploring apps at runtime.
several android automation frameworks such as hierarchy viewer uiautomator and robotium have been developed to facilitate app testing.
one critical step to performconference july washington dc usa f. dong et al.
interaction overlap outside hidden size drive by download frequent non content number ad trigger ad trigger ads on exit screen figure case studies of ad fraud apps.
automated app testing is to generate reliable test inputs .
the most straightforward means to achieve that is to follow a random strategy i.e.
the so called random testing where the test inputs are generated randomly.
indeed various tools such as monkey dynodroid intent fuzzer and droidfuzzer have been introduced to our community following this strategy.
however random testing is likely to generate redundant events that may lead to wastes of resources.
it is also not guaranteed that random testing will reach a good coverage of the code explored making it not suitable for some scenarios such as ad fraud detection where certain parts of the app e.g.
ad views are expected to be covered.
because of the aforementioned reasons researchers have introduced a new type of strategy namely model based to generate test inputs for automatically exploring android apps.
indeed many research based tools such as guiripper mobiguitar a3e swifthand puma have been proposed to perform model based testing of android apps.
these tools usually leverage finite state machines e.g.
activities as states and events as transitions to model the app and subsequently implement a depth first search dfs or breadth first search bfs strategy to explore the states for generating more effective test inputs w.r.t.
code coverage.
more advanced tools such as evodroid and acteve use more sophisticated techniques such as symbolic execution and evolutionary algorithms to guide the generation of test inputs aiming at reaching specific points.
however most of them need to either instrument the system or the app making them hard to be directly used to detect ad frauds.
droidbot is a lightweight test input generator which is able to interact with android apps without instrumentation.
it allows users to integrate their own strategies for different scenarios.
compared with them we have implemented a more sophisticated ad view exploration strategy for automated scalable ad fraud detection in this work.
.
ad fraud detection ad fraud in general is the no.
cybercrime counted in terms of revenues generated ahead of tax refund fraud .
although adfraud has not been substantially explored in the context of mobile advertising it has been extensively studied in the context of web advertising.
many research work have been proposed to pinpoint ad frauds on the web e.g the detection of click frauds based on network traffic or search engine query logs characterizing click frauds and analysing profit models .
we believe that these approaches can provide useful hints for researchers and practitioners in the mobile community to invent promising approaches for identifying mobile ad frauds.
existing studies on mobile ad frauds have attempted to identify ad fraud apps where the fraudulent behaviours can be spotted statically the so called static placement frauds .
as examples liu et al.
have investigated static placement frauds on windows phone via analysing the layouts of apps.
crussell et al.
have developed an approach for automatically identifying click frauds.
their approach is implemented mainly in three steps building http request trees identifying ad request pages using machine learning and detecting clicks in http request trees using heuristic rules.
unfortunately with the evolution of ad frauds the aforementioned approaches are incapable of identifying the latest fraudulent behaviours e.g.
they cannot be used to identify dynamic interaction fraud .
in this work in addition to static placement frauds we have introduced five new types of such frauds that have not yet been explored by our community.
conclusion through an exploratory study we characterize ad frauds by investigating policies set up by ad networks.
we then build a taxonomy as a reference in the community to encourage the research line on ad fraud detections.
this taxonomy comprehensively includes four existing types of static placement frauds and five new types focusing on dynamic interaction frauds which have not been explored in the literature.
we subsequently devise and implement frauddroid a tool supported approach for accurate and scalable detection of ad frauds in android apps based on ui state transitionfrauddroid automated ad fraud detection for android apps conference july washington dc usa graph and network traffic data.
by applying frauddroid to realworld market apps we have identified ad fraud apps covering the all considered nine types of ad frauds.
our findings suggest that ad frauds are widespread across markets and impact various markets.
to the best of our knowledge frauddroid is the first attempt towards mitigating this threat to the equilibrium in the mobile ecosystem.