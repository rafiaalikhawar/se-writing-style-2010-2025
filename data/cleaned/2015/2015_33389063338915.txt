together strong cooperativeandroid appanalysis felix pauck paderbornuniversity paderborn germany fpauck mail.uni paderborn.deheikewehrheim paderbornuniversity paderborn germany wehrheim uni paderborn.de abstract recent years have seen the development of numerous tools for the analysis of taint flows in android apps.
taint analyses aim at detecting data leaks accidentally or by purpose programmed intoapps.often suchtoolsspecializeinthetreatmentofspecific featuresimpedingprecisetaintanalysis likereflectionorinter app communication .thismultitudeoftools theirspecificapplicability andtheirvariouscombinationoptionscomplicatetheselectionofa tool or multiple tools when faced with an analysis instance even forknowledgeableusers andhencehindersthesuccessfuladoption oftaint analyses.
inthiswork wethuspresent codidroid aframeworkfor cooperative android app analysis.
codidroid allows users to ask questionsaboutflowsinappsinvaryingdegreesofdetail automatically generates subtasks for answering such questions distributes tasks onto analysis tools currently droidra flowdroid horndroid ic3and two novel tools and at the end mergestoolanswersonsubtasksintoanoverallanswer.thereby usersarefreedfromhavingtolearnabouttheuseandfunctionality of all these tools while still being able to leverage their capabilities.
moreover we experimentallyshow that cooperation amongtools pays off withrespectto effectiveness precision andscalability.
ccs concepts software and its engineering software verification and validation domainspecificlanguages .
keywords android taint analysis tools cooperation precision.
acmreference format felix pauck and heike wehrheim.
.
together strong cooperative android app analysis.
in proceedings of the 27th acm joint european software engineeringconferenceandsymposiumonthefoundationsofsoftwareengineering esec fse august 26 30 tallinn estonia.
acm new york ny usa 11pages.
introduction inthefieldofsoftwareanalysis anongoingracebetweenattackers anddefendersistakingplace.thespeedofthisraceisconstantly permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthefirstpage.copyrights forcomponentsofthisworkownedbyothersthanthe author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
esec fse august 26 30 tallinn estonia copyright heldby the owner author s .
publicationrightslicensed to acm.
acm isbn ... .
on both sides.
attackers find new ways to hide their maliciousbehaviorwhiledefendersdevelopmoreandbetteranalyses to detect attacks.
however the user unwillingly being a third party in this race typically cannot sufficiently benefit from theadvancesofthedefendersandthuscannotcatchup.reasons for this are various including the missing knowledge about the existenceofup to datetools theirusageandwaysofcombining them the unavailability of toolsorof resourcesto run tools.
this exactly characterizes the present situation in the area of analyses for data leaks in android apps.
dataleaks permit the leakage of private data in smartphones like contact data or more critical banking or health data to the outside.
conceptually a data leak is a flow of data from a private sourceto a public sink.
dataleaksmightariseoutofaccidentalcodingmistakes butmight alsobeintentionallyplacedinappsbymaliciousattackers.inthe past researchershavecomeupwithvarioustechniquesandtools forleakdetection rangingfromstatic over dynamic and hybrid analyses to methods built onlogicalreasoning .toolsfurthermoreoften specializetocertainprogramming features in apps which complicatetheanalysis e.g.reflection inter appcommunication .moreover suchtoolsrequirevaryingamountsofresources computationtime powerandmemory oftenexceedinganormaluser scapacities different operating systems and or require specialized additional software or hardware.
hence it is only the absolute expert who can fully leveragethe plethoraof existing tools.
in this paper we thus propose codidroid a framework for automatic cooperative and distributed an droidapp analysis.
for agiven setof app s andagivenanalysisquestion codidroid automatically divides the analysis task into several subtasks distributessubtasksontotools dispatchesthemandattheendmerges toolanswersintoafinalanswertotheinitialquestion.aslanguage for formulating questions and for interfacing between different tools we employ the domain specific language aql android app analysis query language .
we extendthe aqlinseveral ways inparticulartoenablenovelcombinationsoftools.forthe unexperienceduser codidroid forinstanceoffersthiscooperative analysis on a website with a default analysis question for a user knowledgeable in aql codidroid allows to specify the selection oftoolsandsubtasksinvaryingdegrees of detail.
the power of codidroid lays in the principle of cooperation while previous approaches only use very limited hardcoded forms of tool combinations codidroid can in principle compose arbitrarytoolsextractinginformationaboutflowsinapps.thisflexibility in the combination allows for an easy integration of a new tool upgrade to new tool versions or exchange of tools.
cooperativeappanalysisfurthermorecannotonlybeemployedto solve an analysis question but also to crosscheck the correctness of an analysisanswer ofone toolbyanother.
esec fse august tallinn estonia f. pauckandh.wehrheim while a number of basic building blocks for a cooperative analysis already exist we also identified gaps where tools are either lacking donotexistasblackboxstandalonetoolsoronlycompute too imprecise information.
as a further contribution of this work we have closed two such gaps.
the first development concerns the implementation of a new tool for the inference of inter component communication links icc links calledpim.pimprecisely computes links between intent sinks and intent sources as collected by ic3 or epicc and thereby contributes to a rigorous analysisofinter componentcommunication.oursecondcontribution isnoahfor the analysis of calls to native libraries via the java nativeinterface inapps.currenttoolstypicallyignorenativecalls whilenoahalsoidentifies sourcesandsinks innative methods.
wehavecarriedoutanumberofexperimentsonthestandard benchmark droidbench plus additional inter app communication cases to test the feasibility precision and scalability of codidroid .
the experiments show that cooperative analysis is effective in that it can a increase the precision b have lower runtimes than other approaches c increase the scalability and d enable the detection ofpreviously undetectable data leaks.
tosummarize this paper makesthe following contributions weproposethenovelframework codidroid forcooperative android app analysis we develop and implement a technique for the automated distributionanddispatch ofanalysistasks we design and implementtwo new analysis tools pimand noah readilyusable within codidroid weprovideassociatednewbenchmarkcasesforinter app communicationscenarios and weshowtheeffectivenessandefficiencyof codidroid in large scale experiments.
thepaperisstructuredasfollows.thenextsectionintroducesfoundationsoftaintanalyses toolsandtheanalysisquerylanguage aql.
section3presentsthegeneralapproachofcooperativeandroidapp analysis.insections 4and5wepresentourexperimentalstudies anddiscusstheirresults.relatedworkispresentedinsection 6and section7finally concludes.
foundations in this section we start by explaining basic concepts present the toolswhicharecurrentlypartof codidroid anddiscussthedomainspecific query language aql.
.
taint analyses thedetectionofdataleaksinandroidappsispredominantlycarried out by taint analyses .
taint analyses track information from sources to sinks by tainting elements objects fields ... and tracking their flows through the program.
a source in this context is a statement extracting sensitive information e.g.
contact data location information device identifiers .
a sink in contrast is a statement that leaks data to the outside e.g.
via sms or the internet.
information flows between sources and sinks detected by taintanalysesarecalled taintflows .someofthesesourcesandsinks require a permission to be granted by the android system or the user.anypossiblyrequiredpermissionisspecifiedinaso called manifest.app b app b app a app a invoke ... s getdeviceid reflective call invoke ... s getdeviceid reflective call startactivity ... startactivity ... getstringextra getstringextra log.i .. s log.i .. s getintent getintent cfuncsms s native call cfuncsms s native call sendtextmessage .. s .. sendtextmessage .. s .. setresult ... setresult ... 1s1 5s2 s3 s4s5 s6 s7 s86native libraryoncreate .. onactivityresult .. oncreate .. figure runningexample flowsin2 apps inordertosuccessfullydetecttaintflows anumberofchallenges havetobemasteredbyananalysistool someofwhicharegiven below.
sensitivities a tainted element might be a whole object or justafield.anyflowaccessingataintedelementmightbe constrainedbyitsowncontextandorcertainconditions.ideally theseand similaraspectsshouldbe takeninto account.
precise taint analyses should at the best be flow context field object pathandthread sensitive.
native calls the apps might contain calls to native libraries viathejavanativeinterface jni .whentheanalysisdoes not inspectlibrary code itmightmiss flows.
inter componentcommunication androidemploysaspecific concept of inter component and inter app communication icc iac .thiscommunicationisrealizedthrough intents apps can send intents which are received by other appswhentheymatchthereceiver spredefinedintent filters.
a precise analysis has to track flows via intents and in particularneedstobeabletodetectmatchingpairsofintents andintent filters.
reflection attackersmightusethejavareflectionmechanism tohidee.g.accessestosources.theanalysishastobeable to resolve reflective calls.
a further challenge is efficiency.
to decrease runtime and memory consumption static analysis tools often compute over approximationsoftaintflows resultinginalargenumberoffalsepositives.
figure1introduces our running example of two apps exhibiting severaloftheabovelistedchallenges.thefiguredepictsthetaint flows an analysis tool should be able to detect.
app a in statement s1containsa use of reflection extracting data froma private source thedeviceid .thistaintedvalueisflowingtostatement s2 flow1 .
ins2 appasendsoutanintenttheresultofwhichiscollectedin s3.
thisresultflowsintothesinkintheloggingstatementin s4 flow .theintentmatchestheintent filterofappb flows2and6 in whichthedatatransferredviatheintentflowsintobothstatements s8ands6 flows and .
finally the library code for the native call in statement s6contains the sink sendtextmessage ... and hence introduces flow .
the two expected taint flows hidden in therunningexamplethusstartin getdeviceid s1 andendin sendtextmessage ... s7 andinlog.i ... s4 respectively.
375togetherstrong cooperative android app analysis esec fse august tallinn estonia currently no publicly available android app analysis tool alone is ableto detectboth flows.
.
analysis tools theobjectiveofourworkistoincreasetheeffectivenessofandroid app analysis by cooperation.
as we will see later a cooperative analysisoftheexampleinfigure 1candetectbothflows.tothis end our framework codidroid employs a number of existing tools which we briefly describe in the following.
the choice of tools isguided by our overall objective ofcooperation we require tools which provide basic building blocks of a complex analysis and which can be flexibly combined.
furthermore our choice is driven by recent studies e.g.
which give insight into a tool s performance.
droidra is a tool for resolving reflection.
to do so it identifies the signature of classes and methods that are instantiated or called through reflection via a static constant propagation analysis .
flowdroid isatoolforthedetectionofintra component taint flows1.
it considers real sources and sinks as well as intent sources and sinks.
the identification of sinks and sourcesisfollowedbya statictaint analysis.
horndroid is a static analyzer based on logical reasoning.ituseshornclausestodecidewhichsinksareable to leak sensitive data.
due to the use of logic it is able to distinguishdefinitefrom only potentialleaks.
ic3is a tool for detecting intent sinks and sources via a staticconstantpropagationanalysis .ithasbeendevelopedby octeauetal.
andupdatedbyusinordertoworkwith up to date android apis2.
it computes precise attribute sets containing informationabouttheaction categoryanddata of intents and intent filters and maps each of them to a statement.
toenableaflexiblecombinationoftoolsinataintanalysis we are lackinga standalonetoolfor a theidentification ofsinks and sources in native code and b the precise matching of intents withintent filters i.e.thecomparisonofattributesetsascomputed byic3.
our first contribution towards cooperative android app analysisisthus the developmentoftwonewtools.
noah native over approximation handler is a tool for thedetectionofandroidsourcesorsinkscalled internally i.e.
within code of a native library.
with this information inplaceitcandetectflowsendinginandstartingatnative methodcalls.
pim preciseintentmatcher isatoolcomputingconnections betweenintent sinksand sourcesbycomparingthemapped attribute setsasdeliveredby ic3.todoso itusesanandroid device or virtual device emulator and asks the android system installed if a certain pair of intent and intent filter fits.itthus performs a dynamicanalysis.
1theup to dateversion2.
.1of flowdroid alsoincoporatesinter appflows but for the purpose of cooperativeanalysis wepreferthe baseversion.
2additionally wereportedthisissueongithub .
.
android app analysis querylanguage to realize our codidroid framework we use the domain specific language android appanalysis query language aql developed andmaintainedbyus .thislanguageallowsustoformulate queries aql queries composed of questions aql questions .
results to such queries are given in the form of aql answers.aql isused inthecommunicationwith theuseraswell asforcommunicationbetween toolsandour framework codidroid .
anaql question mainly consists of two parts the property of interest poi and the target target .
with these two basic elementswecanformulatequeriestoaskfore.g.flows permissions intents or intent filters inside a whole app or parts of it such as a certain class method or statement.
an unknowledgeable user mightalwayswanttousestandardqueries liketheonebelowto getallflowsinside someapp astoredinfile a.apk poi in target ?
bracehtipdownleft bracehtipupright bracehtipupleft bracehtipdownright flowsin bracehtipdownleft bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehtipupright bracehtipupleft bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehext bracehtipdownright app a.apk ?
orto getallflowsfrom atob flowsfromapp a.apk toapp b.apk ?
a more knowledgeableusermightask for more details like permissions in method oncreate ... app a.apk ?
tofindallpermissionsrequiredbyastatementinside oncreate .. .
considering the running example this would return the permissionsread phone state required by getdeviceid inside the oncreate ... method.
theaqlalso allows to further process the answers given to certainquestions.
tothis end a number of operations onqueries or rather their answers are already available and can further be extended via configuration .
note that conceptually answersaresetsofdataaboutflows permissions intents intent filters intent sinksandintent sources.
theunify operator can be used to merge multiple answers intoasingleonebyapplyingaunionoperatorontheanswer sets.in so itimplicitly removes redundant elements.
thefilter operatorisusedtoextractspecificdatafroman answer set.
theconnect operatorfirstapplies unifyandthencomputes aclosureon the data i.e.
constructs the transitive closure of flows and connects intent sinks with sources using some simpleicclinkcomputation.
thematch operator is amore sophisticated version of connect currently implemented using pimfor accurate icc linkcomputation.
finally the check operatorcanbeusedtohaveanothertool crosscheckan answer to aquery.
inaddition the aqlembodiesfacilitiesfor specifyingthepreprocessing ofapp code flowsinapp a.apk deobfuscate ?
selecting certaintoolswhen specific features are given flowsinapp a.apk featuring native ?
or using particulartoolsto answer aquery flowsinapp a.apk using noah ?.
376esec fse august tallinn estonia f. pauckandh.wehrheim answer flows flow reference type from statement getdeviceid statement method oncreate ... method classname mainactivity classname app file ... appa.apk file hashes ... hashes app reference reference type to statement sendtextmessage ... statement app ... appb.apk app reference flow flow reference type from getdeviceid reference reference type to i ... reference flow flows intentsinks intentsink target action ...codidroid.codirunex.sms action target reference type from startactivityforresult ... reference intentsink intentsinks intentsources intentsource target action ...codidroid.codirunex.sms action category android.intent.category.default category target reference type to getintent reference intentsource intentsources answer listing shortened aql answerfortherunningexample technically aql answers are encoded inxml format.
the specificstructureisdeterminedbyanxmlschemadefinition xsd file .ananswercanholdinformationaboutalltypesofpropertiesofinterest.asanexample listing 1showsthetwotaint flows containedinsideourrunningexampleaswellastheintent sinkand intent source required to be able to find both flows.
the first reference to thereflectivelycalled getdeviceid statementisalmost fully given.
for all other