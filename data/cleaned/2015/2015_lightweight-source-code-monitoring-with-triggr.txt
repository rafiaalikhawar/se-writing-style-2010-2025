lightweight source code monitoring with triggr alim ozdemir faculty of computer and informatics engineering istanbul technical university istanbul turkey ozdemirali itu.edu.trayse tosun faculty of computer and informatics engineering istanbul technical university istanbul turkey tosunay itu.edu.tr hakan erdogmus carnegie mellon university silicon valley ca hakan.erdogmus sv.cmu.edurui abreu inesc id instituto superior tecnico university of lisbon lisbon portugal rui computer.org abstract existing tools for monitoring the quality of codebases modified by multiple developers tend to be centralized and inflexible.
these tools increase the visibility of quality by producing effective reports and visualizations when a change is made to the codebase and triggeringalerts whenundesirable situations occur.however their configuration is invariably both a centrally managed in that individual maintainers cannot define local rules to receivecustomized feedback when a change occurs in a specific part of thecodeinwhichtheyareparticularlyinterested and b coarsegrained in that analyses cannot be turned on and off below thefile level.
triggr the tool proposed in this paper addresses these limitationsbyallowingdistributed customized andfine grained monitoring.
it is a lightweight re implementation of our previ oustool codeaware whichadoptsthesameparadigm.thetool listens on a codebase s shared repository using an event based approach and can send alerts to subscribed developers based on rulesdefinedlocallybythem.triggrisopen sourceandavailable at a demonstration video can be found at ccs concepts software and its engineering maintaining software software evolution keywords softwarequalityassurance event basedmonitoring staticanalysis code evolution acm reference format alim ozdemir ayse tosun hakan erdogmus and ruiabreu.
.
lightweight source code monitoring with triggr.
in proceedings of the 33rd acm ieeeinternationalconferenceonautomatedsoftwareengineering ase permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
ase september montpellier france association for computing machinery.
acm isbn ... .
september montpellier france.
acm new york ny usa 4pages.
introduction existing tools for quality monitoring of shared codebases are invariably coupled to integrated development environments ide version control systems continuous integration ci servers or cloud basedqualityanalyzers.suchtoolsoffermanyadvantagesto developers such as automated code inspections extraction of metrics flagging potentially bug prone parts visualization of codeleveltimetrends andevencollaborationpatterns.asanubiquitous example some of these tools features are built into github .
other tools typically static analyzers and metrics extractors for various programming languages and frameworks function as local standalone systems e.g.
findbugs codelyzer and supportmultipleprogramminglanguages e.g.
pfff andoometer .however therealbenefitsmaterializewhentheyareprovided eitherasalibrary centrallyservedframework orasathird party service and orwhen they are connectedto another team leveltool e.g.
aciserveroracentralcoderepositoryrunning a modern source code management system scm e.g.
github .
the common feature of team based monitoring tools is their adoption of a central management approach.
typically the team must collectively decide what the analysis configuration should be and individual developers cannot override this configurations to meettheirspecificneeds e.g.
tomonitorcriticalchangestoapartof thecodebasethattheyareresponsibleformaintaining.twocasesinpointarewhenanindividualdevelopercannotspecify showmetheaverage cyclomatic complexity of the classes that i touched or letmeknowwhenthismethodhasbeenchangedbyanyone.
however just becauseanalyses are performedcentrally does notmean that management and configuration must also be central.
a tool thatcan be configured and managed in a distributed fashion permitslocal customization that caters to differing monitoring needs of individual developers.
another common limitation of team based monitoringtoolstheircoarsegranularity theyarenotconfigurable below the module or file level.
for instance a developer cannot specify let me know if anyone touches this methodin this file.
to overcome these limitations we had previously implemented a peripherally managed fine grained source code monitoring tool codeaware whosedistinguishingparadigmisdiscussedinthe authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france a. ozdemir et al.
nextsection.inthispaper wepresentaprototypicalspin off triggr thatfollowsthesameparadigm butadditionallyaddressessome of codeaware s own caveats complexity non portability extensibilitychallenges andlackofsupportformultipleprogramming languages.
comparison to related work relevant approaches for monitoring and visualizing process and code artifacts include process telemetry tools code inspectors and customized ides that facilitate developer collaboration and communication .
unlike triggr and codeaware these systems are monolithic and inflexible in that in a team environment theyhavetocatertoagreatestcentralcommoninterest andcannot be specialized to individual developers needs who may need to focus on different aspects and parts of a large codebase.
an early sensor based process and code monitoring system is hackystat which collects data locally from code artifacts e.g.
file basedmetrics anddeveloperactions e.g.
incrementalcompilationsandunit testruns throughsensorsaddedtoanide.the sensors are activated periodically and indiscriminately to collectspecific types of data to be sent to and processed by a central server later.
triggr s probes are analogous to hackystat s sensors but unlike hackystat they are added to code fragments locally not the ide and activated centrally.
a browser based ide called adinda likehackstat collectsrichdevelopmentdataincluding communication and collaboration activities of developers and aggregates and stores the collected data originating from different developersinacentralizeddatabaseforanalysis.triggrdoesnot collect any data locally.
modern cloud based code quality tools such as better code hub operate similarly but also rely on a central code repository such as github to pull the source code for analysis when a new commit happens.
the whole codebase is re cloned from therepository and analyzed centrally and the results are stored and madeavailabletoalldevelopers.thecommit triggered event based analysis is similar to the way triggr operates but unlike triggr theirconfigurationiscentralandlocalcustomizationisnotpossible.
also triggr does not store any analysis results permanently.
thepredecessoroftriggr codeaware wasinspiredby the sensor network metaphor.
codeaware s approach is simple user defined sensors called probesand locally attached to different codefragmentsarespreadtothecodebasewhentheyarepushed to the central code repository.
probes are passive until activated by codeaware sengineinstalledontheciserver sbuildpipelineas a plug in.
the push in turn triggers a build in the ci server.
theengine identifies the probes in the codebase and interprets them.user defined actions such as alerts to interested parties can be takenvia actuators whenaprobesisactivatedbytheengine.probes canbeattachedtoaspecificcodeabstraction e.g.
aclass afile oramethod.liketriggr codeaware sdesignisthusflexibleandprobes aredefinedinadistributedfashion.itsmajorlimitationisthatits engine runs on the build pipeline of a specific ci server jenkins as a specialized complex plug in.
this plug in is difficult to install extend maintain anddebug.alsocodeawaresupportsa single programming language java and it is challenging to add new kinds of probes or actuators.
supporting a new programminglanguage requires a nearly complete rewrite.
triggr provides asimplified and more extensible and portable solution using the same sensor network paradigm of codeaware.
architecture and concepts triggrisdesignedasalightweight robusttoolthatcaneasilybedeployedonacloud basedserver.amajormotivationwastominimizebothsystemrequirementsanduseofresources.triggrcontinuously monitorchangestothesharedcoderepository processesandactivates the probes and actuates desired actions.
the majority of theseoperationscaneasilyrunasbackgroundtasks whichtriggr s corecoordinates.toinitiatethemonitoring process triggrneeds toconnecttoasharedcoderepositorysuchasgithub.thecode base may contain components written in different programming languages.
when the repository changes triggr pulls the changes along with any existing modified or new probes and performs lexical analysis via language specific parsers to identify and isolate thehostcodefragmentstowhichtheprobesareattached.itthen performs change analysis metric extraction and static analysis on thesefragmentsviaexternaltoolsandlibrariesdependingonthe probetypeofthefragmentandtheprogramminglanguage.aprobe is activated if the conditions specified by the probe are satisfied andthecorrespondingactuatorisexecutedtotakesomepreventive or alerting action defined by the user.
figure 1illustrates the high levelarchitectureoftriggrwiththeactorsinvolved.triggrrelies on five main concepts explained next.
.
probes probes contain information about the type of analysis that a developer would like to perform on selected code fragments or abstractions andwhetheranactionshouldbeperformedwhentheresults are indicative of an issue that requires the developer s attention.
a probeisspecifiedasasimplejsonfilecomposedofmeta datawith theseattributes a thehostcodefragment e.g.
afileormethod via a source code path b the probe type from among a set of existing types b where applicable activation rules on the output of the probe e.g.
certain threshold metric values that warrant an action and d theactionsthemselvesintermsofatypeofactuator to execute depending on the probe s output.
currently triggrsupportstwotypesofprobes codechange and static analysis.
to execute a probe triggr uses a cached versionof the old code fragment next to last commit and compares it with its most recent commit.
the comparison is based on lexical analysis thesourcefilecontainingthespecifiedcodefragment object is first transformed into an abstract syntax tree ast and then the object of interest with its name and type is located on the ast usingalinear searchalgorithm.
ifthe searchfinds theobject itreturnstheobject stextualrepresentation otherwiseitreturns false.anobjectcanbeanytokendefinedinanast suchasaclass a function or an identifier.
the objects vary from programminglanguage to programming language.
for instance javascript hasafunctionobject which corresponds to a defobject in python.
triggrhandlesthesepre definedtypesofobjectsthroughlanguagespecific scripts.
there could be other methods to compare the code fragments e.g.
parsingthecodeintoapartialastuntilthecode fragmenthasbeenfound.unfortunately astlibrariesinpython authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
lightweight source code monitoring with triggr ase september montpellier france andjavascriptdoesnotallowapartialsearchofamethodduring the ast extraction.
therefore we had to extract the full ast first and find the related object later using textual comparison.
.
.
code change.
this probe type detects the changes betweentwocommitsofanobject.oncetheastscriptsareexecuted to extract the object of interest the probe s host code fragment from the last two commits triggr s scripts check for syntactic differences.
if a difference is found the probe has a positive signal and is activated.
an alert can then be transmitted to the developer usingthe channelspecifiedinthe actuators attributeof theprobe.
listing1shows an example of a code change probe for a copyfilesyncfunction in the utils.jsfile.
if this function is modified in a commit an email is sent to john.doe.
.
.
static analysis.
thisprobe type executesspecifiedstatic analysis tools on a given object.
in addition to those of a code changeprobe it has two extra attributes strategyandarguments.
thestrategyattribute defines under which condition the probe willbe executed.possible valuesare alwaysanddiff.the always strategy does not require a change between the old and current versionoftheobject italwaysrunsstaticanalysisscriptsonthe mostrecentversionoftheobject.the diffstrategy ontheother hand runsstaticanalysisscriptsifandonlyifasyntacticdifference is detected between the two versions of the object.
different static analysistoolsandstaticanalysistoolsfordifferentprogramming languages have different output formats this probe does not transform the output and instead forwards the results to the defined actuators.
static analysis tools can provide reports containing various metrics and code warnings.
the arguments attribute is used to specify optionalparametersforthetools e.g.
asubsetofmetricsextracted by the tool and activation rules associatedwith those metrics.
for example the argument complexity asks the probe to instructthestaticanalysistooltocalculatethemccabecomplexitymetric andactivate onlywhen thevalue ofthemetric exceeds the given thresholdvalue of .
this isan example of an argument filteringthe output of a probe.
id a unique id for probe probetype codechanges object name copyfilesync path packages rekit bin utils .js type function actuators type email emails modifiers null listing an example of a code change probe3.
actuators after a probe s execution if the probe is activated triggr executes theactuatorsdefinedforthatprobe.actuatorsarespecializedby thenotificationchannelused.thecurrentversiondefinestwotypes of channels emailandissue.
emailistheusualchannel whichwasalsosupportedincodeaware .
it simply forwards the probe results by email to the specified addresses whicharetypicallytheprobeownerswhohaddefined theprobes.the issuechannelautomaticallyopensanissueinan issue tracker using the output of the probe as the issue description.
currently only github s built in issue tracker is supported.
asanexample supposeitisproblematicforthecomplexityof an object to exceed a predefined threshold and a probed is defined to monitorthis condition.when thecondition happens using the issuechannel theprobe sactuatorcanautomaticallyopenanew code review issueingithub.orusingthe emailchannel itcan sendanemailtothedevelopersresponsibleforthelatestchangeto that object.
triggr s actuator definitions are flexible and new actuators and channels can easily be added.
.
event based monitoring with webhooks one approach for monitoring a shared code asset is to periodically polltheassettoseeifanyinterestingevents e.g.
commits haveoccurred.however thismethodiswasteful.amorenaturalapproachistoemployanevent drivenmodelsuchaswebhooks.thisallows thesystemtosubscribetospecificeventsonanasset suchasshared repository externalissuetracker orciserver.whenaneventof interestoccursintheasset therepositoryissuesanhttppost requesttothesubscribedurls notifyingthesubscribers.triggr uses this latter approach listen on a pushevent on the shared code repository signalinganewcommit.whenthiseventoccurs triggr pulls the changes from the repository including all the probes and actuators and processes them as described above.
figure high level architecture of triggr .
background jobs background processing is central to the function of triggr.
triggr delegatesoperationsthatcanbeexecutedasynchronouslyorconcurrently to a background job runner.
these operations include keyprocessingtasks suchasastextraction activationof probes authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france a. ozdemir et al.
and actuation when a probe is activated.
trigger pipelines such operations on a background job runner upon a push event.
its predecessor codeaware usedaconcurrencyframeworktoaccomplish the same but this proved complicated and hard to debug and test.
a good background job runner allows observing the progress of backgroundoperationsinreal timeandeasilydiagnoseproblems.
we discuss the specific choice of the background job runner under section4.
.
scripts triggr supports multiple programming languages by liberating its core fromlanguage specificdependencies andisolating languagespecific components as a set of shell scripts.
the scripts accomplish such tasks as parsing the source code and extracting the ast or running a static analyzer using language specific tools and libraries.
the scripts are simple and can be defined for andexecuted on both unix and windows based operating systems.supporting a new programming language involves adding new scripts tothe appropriate foldersin the followingfolder structure scripts task language run.
sh bat .
each leaf folder contains a main script file with an extension specific to the operating system .sh or .bat providing portability.
for example the static analysis probe uses the following script path for a python file if triggr is running on a linux server scripts staticanalysis python run.sh.
technologies and implementation to implement triggr we chose .net core which is opensource portable and compatible withcommon operating systems.
it uses the cross platform .net standard which also inherits .net framework .
.1features.
it supports amodular architecture with itsbuilt independencyinjectionpattern.anadministratorusesthe web interface of triggr to configure the tool for example to add newcoderepositories.thisinterfaceisimplementedwithasp.net core which comes with .net core.
as the background job runner we chose the open source tool hangfire a popular library for .net applications.
it has several benefits.
it provides a simpler morereliable andefficientmechanismforrunningserver sidebackground jobs compared to for instance .net s thread pool class.
it is robust permitting easy recovery from unexpected shutdowns.
it allows easy parallelization.
hangfire also has a web interface for monitoring scheduled and running jobs making what normally is hidden in many concurrency frameworks visible for easier debugging.
triggr has a small footprint with lines of c and .net code and half a dozen shell scripts.
it supports two interpreted programminglanguages javascriptandpython.forastextraction the recast library is used for javascript and the built in library astis used for python.
for static analysis triggr currently uses open source eslint for javascript and pylint for python.
bothstaticanalysistoolshaveacommand lineinterfacewitharich setofoptions andcaneasilybecalledandconfiguredfromtheir respective triggr scripts.
triggr currently supports git as the scm tool butaddinganotherprovideriseasilyaccomplishedthrough an interface.
discussion and future work triggr is more lightweight and extensible compared to its predecessor codeaware.
it can run on multiple server platforms and support multiple programming languages.
it is amenable to extensionthroughadditionofnewprobetypesthatrelyonnewexternalsource code analysis tools.
its granularity can easily be adjusted bydefiningnewobjecttypesasprobehosts forexample identifiersinadditiontofilesandfunctions.theimplementation byrelyingonatransparentopen sourcebackgroundjobrunner makesmonitoring and debugging triggr s operations much more convenient than codeaware.
triggr is still a proof of concept in its preliminary stages.
we plan to extend its functionality by plugging in new probe types e.g.
gzoltar s visualizations for automatic fault localization and adding new programming languages with the priority of supporting a compiled language such as java or c .
we also plan to benchmark the performance of the system for monitoring multiple repositorieswithmultipleprobesandusers.sofar wehaveonly benchmarkedthe lagbetween apush event ina monitored code base and the tool reporting the change to a developer via a code changeprobe observedtobelessthan3seconds .wedonotknow howthiswillscaleupwithincreasedusage.futureplansinclude replicationofcodeaware suserevaluation firstwithexperiencedstudents andthenonalargerscale.finally wewouldliketo evaluate its ease of installation on different platforms and with different configurations develop automated installation scripts write installationandusagemanuals andcreateadeveloperroadmapto encourage open source contributions.