do the dependency conflicts in myproject matter?
yingwang northeasternuniversity shenyang china wangying8052 .comming wen the hongkong university of science and technology hong kong china mwenaa cse.ust.hkzhenwei liu northeasternuniversity shenyang china lzwneu .com rongxinwu the hongkong universityof science and technology hong kong china wurongxin cse.ust.hkruiwang northeasternuniversity shenyang china jwm080795 .comboyang northeasternuniversity shenyang china yb9506 .com hai yu northeasternuniversity shenyang china yuhai mail.neu.edu.cnzhiliang zhu northeasternuniversity shenyang china zzl mail.neu.edu.cnshing chi cheung the hongkong universityof science and technology hong kong china scc cse.ust.hk abstract intensive dependencies of a java project on third party libraries can easily lead to the presence of multiple library or class versions onitsclasspath.whenthishappens jvmwillloadoneversionand shadowstheothers.dependencyconflict dc issuesoccurwhen theloadedversionfailstocoverarequiredfeature e.g.
method referenced by the project thus causing runtime exceptions.
however thewarningsofduplicateclassesorlibrariesdetectedbyexisting buildtoolssuchas mavencanbebenignsincenotallinstancesof duplication will induce runtime exceptions and hence are often ignored by developers.
in this paper we conducted an empirical study on real world dc issues collected from large open source projects.westudiedthemanifestationandfixingpatternsofdc issues.basedonourfindings wedesigned decca anautomated detectiontoolthatassessesdcissues severityandfiltersoutthe benignones.ourevaluationresultson30projectsshowthat decca achieves aprecisionof0 .923and recallof0.766indetectinghighseverity dc issues.
deccaalso detected new dc issues in these projects.
subsequently dc bug reports were filed and of them were confirmed by developers.
issues in reports were fixed withour suggestedpatches.
ccs concepts softwareanditsengineering softwarelibrariesandrepositories zhiliangzhuand shing chi cheung arethe corresponding authorsof thispaper acmacknowledgesthatthiscontributionwasauthoredorco authoredbyanemployee contractororaffiliateofanationalgovernment.assuch thegovernmentretainsa nonexclusive royalty free right to publish or reproduce this article or to allow others to do so for government purposes only.
esec fse november lake buenavista fl usa associationfor computing machinery.
acm isbn ... .
.org .
.3236056keywords empirical study thirdpartylibrary staticanalysis acmreference format ying wang ming wen zhenwei liu rongxin wu rui wang bo yang hai yu zhiliangzhu shing chicheung.
.dothedependencyconflictsin my project matter?.
in proceedings of the 26th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse november4 lakebuenavista fl usa.
acm newyork ny usa 12pages.
.org .
.
introduction thepopularityofthejavalanguageleadstothedevelopmentofnumerousjavathird partylibraries .
for example the maven repository has indexed over .
millions java libraries.
these libraries provide divergent functionalities and are frequently leveragedbydeveloperstoimplementnewprojects .specifically we investigated over popular i.e.
over stars or forks java projects that are randomly selected from github and found that a project directly depends on different libraries on average .
besides since adependedlibrary mightdepend onotherlibraries a host project would transitively depend on more libraries e.g.
libraries onaveragefor theseinvestigatedprojects .
suchintensivedependencies onthird partylibrariescan easily lead to dependency conflicts in practice.
that is multiple versions ofthesamelibraryorclassarepresentedontheclasspath.when multipleclasseswiththesamefully qualifiednameexistinaproject jvm will load one of them and shadow the others .
if these classes are not compatible the program can exhibit unexpected behaviorswhenitscomponentsrelyontheshadowedones .
consider the following example.
a dependency conflict issue i.e.
derby wasreportedtoproject apache derby .a derbydeveloper found that class jvminfo was included in both derbyclient.jar andderby.jar .however ifanolderversionof derbyclient.jar isspecifiedontheclasspathbefore derby.jar the following error shown in figure will occur when the method esec fse november4 lake buena vista fl usa wang wen liu wu wang yang yu zhu cheung javadump istriggered.thisindicatesthatdependencyconflict issuesmayleadto systemcrashesinpractice.
java.lang.nosuchmethoderror org apache derby iapi services info jvminfo.javadump v at org.apache.derby.iapi.services.context.contextmanage r.cleanuponerror unknown source at org.apache.derby.impl.jdbc.transactionresourceimpl.cl eanuponerror unknown source at org.apache.derby.impl.jdbc.embedconnection.
init unkn own source at org.apache.derby.jdbc.driver40.getnewembedconnection u nknown source at org.apache.derby.jdbc.internaldriver.connect unknown s ource figure1 arealissue derby causedby dependency conflict javaprojectbuildtoolssuchas maven and gradle can warndevelopersofduplicatejarsandclasses buttheycannotidentifywhethertheduplicationsarebenignorharmful e.g.
causing runtimeexceptions .iftheduplicateclassesareidenticalorcompatible theprojectrunsnormallyeventhoughithasuncleandesignor build.onthecontrary iftheduplicateclassesareincompatible the warningsneedtobecarefullyresolved.mostbuildingtoolsprovide theirowndependencymanagementstrategiestohelpdevelopers select one version of the duplicate classes during the packaging process .
however these tools do not guarantee loading the most appropriate class.
consequently runtime exceptions will occurifinappropriateclassesareloaded.whatisworse sinceexisting tools do not differentiate benign from harmful warnings developersmayoverlook theharmfulonesandtake noresolution actions whichmightleadto serious consequences.
adependencyconflictissueariseswhentheloadedclasses are nottheexpectedonesoftheproject i.e.
thereferencedfeaturesetof thetheprojectisnotfullycoveredbytheloadedclasses .inpractice the dependency conflict issues can be manifested in different ways dependingonclassloadingmechanisms.however nosystematic studies havebeenmade tounderstandthemanifestationpatterns ofdependencyconflictsandtheseverityoftheseconflicts.inthis paper we firstconductedan empirical study to bridgethisgap.in particular wecollected135real worlddependencyconflictissues from the java projects hosted on the apacheecosystem across categories e.g.
big data ftp library and testing and explored thefollowingtworesearchquestions.toeasepresentation werefer to the dependency c onflict issuesas dc issues.
rq1 issue manifestation patterns what are the common manifestationsofdcissues?aretherepatternsthatcanbeextractedto enable automateddetection oftheseproblems?
rq2 issue fixingpatterns how do developers fix dc issues inpractice?aretherefactorsthataffectdevelopers choicesof differentfixing solutions?
answers to the two research questions enable us to better understand the characteristics of dc issues between a host project anditsreferencedthird party libraries.specifically wefoundthat dcissuessharethreegeneralmanifestationpatterns conflictsin libraryversions conflictsinclassesamonglibraries andconflictsin classes between the host project and libraries see section .
the findings provide developers with guidance to help avoid detect anddiagnosedcissuesautomatically.besides byfurtheranalyzing thepatches of thefixed dcissues we observed that there are four common fixing solutions in practice.
in addition by analyzing the discussions of the corresponding issue reports we distilledthekeyinformationtodiagnosedcissuesaswellasthe factors affecting the effortsrequiredfor fixing the issues.basedonthecommonissuemanifestationsandthefixingpatternsrevealedbyourempiricalstudy wedesignedandimplemented a dc detection tool using static analysis decca dependency conflictsassessment tohelpavoiddependencyconflictfailures at runtime.
specifically deccacan assess the severity levels of dc issues based on their impacts on the project e.g.
whether it will cause runtime failures and maintenance costs e.g.
the required fixing efforts .
to evaluate the effectiveness and usefulness of ourapproach we first collect a high quality dataset of dcissues with high and low severity levels.
the evaluation results show that deccacan achieve a precision of .
and recall of .
.
more importantly weapplied deccatoanalyzethelatestversionof30 java projects which include .
million lines of codes to see if itcandetectunknowndcissuesinthefield.
deccasuccessfully detected dc issues of four different severity levels defined in section4.
from24projects.wefurtherfilteredout438benigndc issuesandreported20bugswhichcontains28harmfulissuestothe correspondingdevelopers and11reportedbugs havebeen confirmedasrealdcissues whichaffectstheprojects reliability and maintainability.
most of theconfirmed issues are identified in popular projects such as apache spark hadoop beam google closure compiler .moreexcitingly developershavequicklyfixed6 ofthembyfollowingoursuggestions.
theyalsoexpressedgreatinterestsinourtool decca.theseresults showtheusefulnessofourapproach.insummary thispapermakes the following contributions tothebestofourknowledge weconductedthefirstempirical studyondcissuesinopensourcejavaprojects.ourfindingshelp understandthecharacteristicsofdcissuesandprovideguidance torelatedresearches e.g.
compatibilityandmaintainability .the empiricalstudydatasetispubliclyavailableforresearchpurpose.
we proposed a dependency conflict detection approach based on the knowledge we learned from our empirical study.
it can automaticallydetectdcissues.moreimportantly itcanassess their severity levels and reduce developers efforts by filtering outthosebenign issues.
weimplementedourapproachasanopensourcetool decca1.
the evaluation results on real world projects confirmed the effectiveness andpractical usefulnessof our approach.
preliminaries .
motivation toinvestigatethepervasivenessofthedcproblem wecollected 289javaprojectsfromgithubandexaminedwhethertheycontain duplicate jars or classes using the maven dependency plugin .
the above projects were randomly selected based on two criteria first it should have achieved over stars or forks popularity second it is built on mavenplatform.
the results show that .
projects contain the same library of different versions .
projects contain duplicate classes in different libraries.
besides .
of projects are affected by both of theabovetwocases.theseresultsindicatethatdcproblemisvery common inpractice.
dependency conflicts can have serious consequences in practice.
for instance apache hadoop significantly suffers from the 1link 320do the dependency conflictsin myprojectmatter?
esec fse november4 lake buena vista fl usa dc issues as mentioned in its issue report hadoop .
according to the issue report hadoopexposes a variety of third partylibrariestoitsdownstreamclients i.e.
thoseprojectsdepend onhadoop .
this caused its downstream users suffering long from theproblemofdependencyconflicts.
hadoopdevelopershavebeen always searching for a good solution to resolve these conflicts.
for instance onedevelopercomplainedaboutthecurrentworkaround wehavetrieddependencyharmonizationinthepast.itdoesn t work becausedifferentprojectshavedifferentreleaseschedulesand differentneeds.nottomentiondifferentcommunities.also projects likehbasewant to support multiple versions of hadoop.
this means thattheyeitherhavetolivewithmixedversionsofthingslike guava jetty etc.
oragreeto never updatedependencies.
thisdcissuehaslastedfor879days frommar.
2015tosep.
beforeitwasresolvedbyshading i.e renaming allitsdependenciesintoa uberjar withthehelpof maven shade plugin .
however the workaround affected downstream client projectsandhas inducedvarioussoftware maintenanceproblems.
ourabovepreliminarystudyhasshownthepervasivenessand significanceofthedcproblem.whenconflictingjarsaredetected existing software build tools such as maven generally adopt an arbitration mechanism to load one of the jars.
however correctness is not guaranteed.
these tools will also give warnings of duplicate classes.
due to lack of further analysis many of these warnings are false positive results.
for example in our investigated projects weobservedthatonly23 .
ofthedcissuesreportedby maven attracted developers attention and were fixed within five subsequentreleases.besides thesetoolsdonotanalyzetheimpactsof the dc issues on the concerned project and maintenance costs.
consequently developersmightmistakenlyoverlookharmful dc issuesthat leadto systemcrashes.
.
challenges motivatedbytheaboveobservations weaimatdetectingthedc warningsandtheirseveritylevelsinthisstudy.animportantobjectiveinourstudyistoassesstheseveritylevelsforthesedetected dc warnings based on their impacts on the project and their maintenancecosts.
however effective detectionand assessmentof dc issuesneedtoaddressthefollowingtwochallenges.first themanifestationsofdcissuesinpracticearediverseandnon deterministic.
it is because that the manifestation of dc issues depends on the order in which the jars are present on the classpath while the classpathorderofdependenciesmightdifferacrossdifferentrunningenvironments .inaddition theorderisalsoaffectedbythe dependency management criteria of software building platforms e.g.
maven gradle .toaddressthischallenge weconductedan empiricalstudytocharacterizethecommonmanifestationpatterns ofdcissues seesection .second therearenoexistingempirical evidencesortoolsthatindicatewhichtypesofdependencyconflicts are more serious than the others.
therefore even if dependency conflicts have been manifested we still do not know how to assess theseveritylevelsforthem.toaddressthischallenge wefurther analyzed the diverse information of the dc issue reports and their patches tounderstandhowtoassesstheirimpactsontheproject at runtime and what information should be extracted to classify theirwarning severities see section .
empirical study this section aims at answering our proposed research questions rq1 .inthefollowing wefirstpresentthedatacollectionprocess andthen discuss our empirical findings.
.
data collectionprocess tounderstandthemanifestationandfixingpatternsofdcissues we selected java open source projects that are built by mavenfrom theapacheecosystemasthesubjectsforourempiricalstudydueto thefollowingreasons.first apacheisoneofthemostpopularopen source software ecosystem and includes different types of software.
the subjects thus selected are representative.
moreover the use ofapacheprojectsfor empiricalsoftwareengineeringresearchis common .second apacheprojectsare well maintained.specifically theyusethe bugzilla and jira systemstotrackissues.the apache software foundation provides official support of git mirrors for all projects.
the issuereportsandcoderepositoriesareopentothepublic which greatly facilitates usto study the target problem .
for the selected java projects we identified confirmed dc issues in the issue tracking systems.
first we used the keywords library dependency or compatibility etc.
to narrow the issues down to the compatibility problems between host projects and third party libraries.
then we used the keywords conflict or nosuchmethoderror etc.
to further locate the dc issues.
as such searches returned noisy results we refined these results by manual checking .
eventually we obtained dc issues and 128ofthemhave been fixed.
table1summarizes the demographics of those projects covered bythecollected135dcissues.theyarelarge upto2 218kloc popular upto16 398stars anddiverse 14differentcategories e.g.
bigdata buildmanagement http .inthe following weanalyze the135dcissuesfromtheapacheprojectsandreportourfindings.
.
rq1 issue manifestationpatterns dcissuesinjavaprojectscanbemanifestedindifferentways.this rqaimsatcategorizingtheirmanifestationpatterns.thecategorization enables us to understand how dc issues are triggered and howtheycanbedetected.toanswerrq1 wemanuallyinvestigated thecollected135bugreportsandrelateddiscussions e.g.
comments and patches .
specifically three postgraduates first classified them independently andthenreachedaconsensusbydiscussionifthe classification results are differentamong them.
we observed that dc issues can be manifested in three patterns conflictsinlibraryversions conflictsinclassesamonglibraries and conflictsinclassesbetweenthehostprojectandlibraries .these threepatternsdifferinhowadcissueistriggered.weusethree examples in figure 2to illustrate these three patterns respectively.
a.conflictsinlibraryversions 39outof135issues .suppose a host project directly uses lib1andlib2 v1 and lib1transitivelydependson lib2 v2 wherel vdenotesalibrary lofversion v.accordingto maven snearestwinsstrategy mavenchoosesthe version that appears at the nearest to the root host project of the dependencytree ifthereare multipleversionsofthesamelibrary.
asshowninfigure a theloginformationinthebottomisthe dependencyinformation printed by maven.
only lib2 v1 willbe packagedduringthebuildingprocess.then asystemfailurewilloccurif lib1invokesthefeatureswhicharenotincludedin lib2 v1.
321esec fse november4 lake buena vista fl usa wang wen liu wu wang yang yu zhu cheung table1 thestatistics of subjects coveredby collected135 dc issues software star size loc 1categories2issue trackingsystems severity3selected issues 71min.
max.
avg.
min.
max.
avg.
28jira bugzilla mcbnmi1351016398 .9k2218.4k .3k .locdenotes lines of codes k .thesoftwarecategoryrefersto apache officialdefinition .m major c critical b block n normal mi minor for instance in issue yarn two versions of guavaare introducedin yarn.
their introduceddependency pathsare yarn guava .
andyarn hadoop guava .
.
.
as a result guava .
.
is shadowed by guava .
as the latter is nearer to the host project yarn.
from developers discussions we found that hadoopreferenced to class limitinputstream which is defined in the shadowed version guava .
.
while not defined in the loaded version guava .
.
therefore the project crashedwith noclassdeffounderror .
b.conflictsinclassesamonglibraries 90outof135issues .
supposethatlibraries lib1andlib2arepresentinthedependency treeasshowninfigure b .lib1andlib2includethreeduplicate classes a bandc.
based on the maven sfirst declaration wins strategy the duplicate classes within the first declared jar lib2 willshadowtheonesincludedin lib1.then dcissuearises ifthe hostprojectreferencedtothefeaturesonlydefinedintheshadowed classes.
the scenario generally occurs in two cases a fat jar repackages alibrary that is already declared on the classpath and a library is renamed and unknowingly added to the classpath twice.
taking issue surefire as an example maven surefire directlydependsonlibraries jaxws rt andgf client .
however library gf client definedclass seimodel thatwasincompatible with class seimodel included in library jaxws rt .
maven surefire referencedto method seimodel.getjaxbcon text definedin gf client whilenotdefinedin jaxws rt .unfortunately class seimodel ingf client was shadowed as library jaxws rt declaredaheadofitonthe classpath.asaresult nosuchmethoderror occurredat runtime.
c. conflicts in classes between host project and libraries out of issues .
if the host project and lib1include duplicate classesa bandc then only those included in lib1will be included during the packaging process.
however if the features only defined in classes a bandcof the host project have been referenced systemmightthrowexceptionsorerrors.thedependency analysis scope of mavenplatform is limited to the libraries listed in its dependency configuration script pom.xml .
since pom.xml does not declare the host project mavendoes not even notice thedcissuesofsuchcase.forexample in storm host project stormanditsdependentlibrary log4jincludedincompatibleclasseswiththesamenames.inparticular as log4jisalogging framework several classes definedin log4jhave beenmovedinto stormforspecificpurposesduringtheevolutionprocess.then the classes included in library log4jshadowed those defined in the hostproject whichleadedto aruntimefailure.
these three manifestation patterns a bandcare all ascribed to the reason that the host project