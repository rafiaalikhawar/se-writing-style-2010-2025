rfc directed differential testing of certificate validation in ssl tls implementations chu chen ictt and isn laboratory xidian university xi an p.r.
chinacong tian ictt and isn laboratory xidian university xi an p.r.
china ctian mail.xidian.edu.cn zhenhua duan ictt and isn laboratory xidian university xi an p.r.
china zhhduan mail.xidian.edu.cnliang zhao ictt and isn laboratory xidian university xi an p.r.
china abstract certificate validation in secure socket layer or transport layer security protocol ssl tls is critical to internet security.
thus it issignificanttocheckwhethercertificatevalidationinssl tlsis correctlyimplemented.withthismotivation weproposeanovel differential testing approach which is directed by the standard request for comments rfc .
first rules of certificates are extracted automatically from rfcs.
second low level test cases are generated through dynamic symbolic execution.
third high level test cases i.e.
certificates are assembled automatically.
finally with the assembled certificates being test cases certificate validations in ssl tls implementations are tested to reveal latent vulnerabilities or bugs.
our approach named rfccert has the following advantages certificatesofrfccertarediscrepancy targetedsincethey are assembled according to standards instead of genetics with the obtained certificates rfccert not only reveals the invalidity of traditionaldifferentialtestingbutalsoisabletoconducttestingthat traditional differential testing cannot do and the supporting tool of rfccert has been implemented and extensive experiments show that the approach is effective in finding bugs of ssl tls implementations.
ccs concepts software and its engineering software testing and debugging security and privacy security protocols keywords differentialtesting certificatevalidation ssl tls dynamicsymbolic execution request for comments acm reference format chu chen cong tian zhenhua duan and liang zhao.
.
rfc directed differentialtestingofcertificatevalidationinssl tlsimplementations.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may june gothenburg sweden association for computing machinery.
acm isbn ... .
40th international conference on software engineering may june3 gothenburg sweden.
acm newyork ny usa 12pages.
introduction securityofinternetservicesisanimportantissuesinceamalicious attackcouldresultinunpredictableconsequences evendisasters.
to provide trustworthy authentication and secure communication hypertexttransferprotocolsecure https astheupgradeof http adopts secure socket layer or transport layer security protocol ssl tls toguaranteesecurity.ssl tlsauthenticatesaserverorclientby validatingitscertificateinthephaseofhandshake.asfortheauthenticationofaserver theserversendsitsx.509certificatetoa client and the client validates the received certificate to determine whetheritisthegenuinecommunicationserver.theauthenticationofaclientcanbeconductedsimilarly.onlyifaserver client isauthenticated cansubsequentcommunicationcontinue.however thecommunicationmaybedangerousiftheauthentication falselyacceptsaninvalidcertificateprovidedbyamaliciousserver client.
likewise a reasonable requirement for communication may be denied if the authentication falsely rejects a valid certificate whichisownedbyabenignserver client.therefore itiscriticalto implement certificate validation correctly.
x. certificatevalidation is described in several request for comments rfc including rfcs and .
developers misunderstanding of these rfcs may bring in bugs during the implementations of certificate validation and these bugs may further result in attacks e.g.theman in the middle mitm attack .so tosecuressl tls implementations it is necessary to detect bugs in certificate validation.
nevertheless this task is a great challenge due to the followingfacts anx.509certificatehasacomplexstructureand intricate semanticconstraints manyhash and encryption decryptionalgorithmsaswellasprivate publickeysareinvolvedin the processes of signature and validation and certificate chains which are common in ssl tls are more complicated than a single certificate.
researchers in the community have made great efforts to test certificatevalidationinssl tlsimplementations.brubakeretal.
putforwardthefirstmethodologynamedfrankencert which generates8 600newcertificatesbycombiningcomponentsof acm ieee 40th international conference on software engineering authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chu chen cong tian zhenhua duan and liang zhao 246certificatesselectedfromtheinternet.theirtestingof15 differentssl tlsimplementationsyields208discrepancies among which only are distinct discrepancies .
in order to improve the efficiency of differential testing chen et al.
propose a mutation approachnamedmucert whichisguidedbycodecoverageand adopts the markov chain monte carlo mcmc sampling method.
mucertemploys37mutatorstomutate1 005certificatesforacertain number of times.
after each round of mutation a mutated certificate selected bymcmc sampling isreserved.
with mutated certificates 27distinctdiscrepanciesarefoundwhentesting9ssl tls implementations.
although differential testing has been successfully applied to certificate validation of ssl tls implementations there are still problemswiththemethod.first adiscrepancyfoundindifferential testing shows neither why it occurs nor which implementations go wrong.
it is difficult for developers to fix bugs without such explicit information.
second some of the mutated certificates used indifferentialtestingcannotbeopenedbytheutilitiesavailable.so itisdifficulttoanalyzetheirstructuresor contents.third itisan open question whether differential testing of certificate validation in ssl tls implementations is always valid.
to solve the problems above we propose a novel differential testing approach namely rfccert to detect bugs in certificate validationofssl tlsimplementations.differentfromtraditional differential testing rfccert starts from extracting rules directly from rfcs.
then a symbolic c program related to the rules is generated and low level test cases each of which represents a few requirementsforcomponentsofacertificate areproducedthrough dynamic symbolic execution dse approach.
subsequently highleveltestcases i.e.certificates areassembledfromthelow leveltest casesautomatically.finally theassembledcertificatesareemployed to test certificate validation in ssl tls implementations.
the advantages of our approach are summarized as follows.
certificates of rfccert are assembled according to standards.
wheneveradiscrepancyisfound thecertificateshowswhich implementationsmakemistakesandwhichruleisviolated.this is helpful in fixing bugs of ssl tls implementations.
rfccert reveals the invalidity of certain discrepancies of traditionaldifferentialtesting.moreover whenasingleimplementation is tested traditional differential testing does not work butrfccertstillworks.thus rfccertsignificantlyimproves traditional differential testing in a sense.
thesupportingtool namelyrfccertdt hasbeenimplementedand certificates have been generated.
with these certificates 29bugsonaverageineachofthe14implementationshavebeen found.sofar 9reportedbugshavebeen confirmedbygoogle microsoft gnutls and wolfssl.
theremainderofthispaperisorganizedasfollows.thenextsection briefly introduces x. certificates and certificate validation.
section presents the rfc directed certificate generation process.
subsequently rfc directed differential testing of certificate validation in ssl tls implementations is conducted in section .
finally relatedworkisdiscussedinsection5andthepaperisconcluded in section .tbscertificate version serial number signature validity notbefore notafter issuer issuer unique identifier subject subject unique identifier subject public key info extensions signature algorithm signature value a general structurestandard extensions authority key identifier subject key identifier key usage certificate policies policy mappings subject alternative name issuer alternative name subject directory attributes basic constraints name constraints policy constraints extended key usage crl distribution points inhibit anypolicy freshest crl private internet extensions authority information access subject information access b extensions figure structure of an x. certificate preliminaries this section briefly introduces the structure of an x. certificate and how certificates are validated.
.
x. certificates anx.509certificateprovidesthecertificationofanentity sidentity andpublickey.thecertificationinformationisstoredinacomplex structure which is mainly defined in rfc .
asfigure1 a shows anx.509certificateconsistsofthreeparts tbscertificate signature algorithm and signature value.
the first part tbscertificate contains the following components a version e.g.
v3 b serialnumber e.g.
c signature includingidentifierofthedeclaredsignaturealgorithm e.g.
sha256withrsaencryption d validity specified by a notbefore requirement and a notafterrequirement e issuerwhich refers to the certification authority ca thatissuesthecertificate f issueruniqueidentifier g subjectwhich refers to a holder of the certificate h subject uniqueidentifier i subjectpublickeyinfo and j extensions.the second part signature algorithm presents the identifier of the signaturealgorithmthatisactuallyused e.g.
sha1withrsaencryption.
as the third part the signature value is recorded if tbscertificate is signed by the signature algorithm.
as figure b shows extensions oftbscertificate contains standardextensions and2privateinternetextensions.theseextensionsmainlyspecifysettingsofkeys alternativenames policies constraints the certificate revocation list crl and information access.the extensions componenthasanintricaterelationshipwith tbscertificate.moredetailsaboutthestructurecanbefoundinrfc .
.
certificate validation certificate validation is the key of authentication since it checks the genuineness and validity of certificates.
to determine whether the certification information in an x. certificate is falsified signature value is validated by a signature authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rfc directed differential testing of certificate validation in ssl tls impls icse may june gothenburg sweden tbscertificate version serial number signature validity notbefore notafter issuer intermediate issuer unique identifier subject end subject unique identifier subject public key info extensions signature algorithm signature value tbscertificate version serial number signature validity notbefore notafter issuer root issuer unique identifier subject intermediate subject unique identifier subject public key info extensions signature algorithm signature value tbscertificate version serial number signature validity notbefore notafter issuer root issuer unique identifier subject root subject unique identifier subject public key info extensions signature algorithm signature value an end entity certificate an intermediate certificate a root ca certificate figure a certificate chain algorithm such asdsaorsha1withrsaencryption.
for a trustworthycertificate thevalidationcheckstheconcreteconstraints suchasnotbeforesandnotafters.besides thevalidationalsochecks whetheracertificateisissuedbyavalidrootcathroughinspecting acertificatechain.figure2showsasimplecertificatechain.the validationcheckswhethereachissuerinthechainisavalidcaand whether the chain ends at a valid root ca.
if all these checks pass the current certificate is accepted otherwise it is rejected.
more informationaboutcertificatevalidationcanbefoundinrfc5246 and rfc .
rfc directed certificate generation as figure shows our approach rfccert consists of four steps.
at the first step rules are extracted from rfcs and then expressed inasymboliccprogram.atthesecondstep dynamicsymbolic execution dse technique is employed which produces low level testcases.
atthe thirdstep thelow level testcases areutilized to assemblehigh leveltest cases i.e.certificates.finally theassembled certificates are used to test certificate validation in ssl tls implementations.
this section presents the first three steps which constitute the rfc directed certificate generation.
the fourth step i.e.
differential testing of ssl tls implementations with the generated certificates will be presented in section .
.
extracting and expressing rules togeneratecertificates rulesareautomaticallyextractedfromrfcs and6818 accordingtothemodalkeywordsspecified by rfc .
.
.
rules in rfcs.
inrfcs5280and6818 rulesareexpressed in two ways.
specifically most rules are written in natural language nl while the rest are written in abstract syntax notation one asn.
.forinstance example1showsaruleinnlandexample illustrates a rule in asn.
.
example1.
nl conformingcas must not issuecertificates where policy constraints is an empty sequence.
that is either the inhibitpolicymapping field or the requireexplicitpolicy field must be present.
request for comments extract and express rules rules .c file dynamic symbolic execution low level test cases assemble high level test cases test ssl tls implementationsstep step step step bugs figure overview of rfccert example .
asn.
policyconstraints sequence requireexplicitpolicy skipcerts optional inhibitpolicymapping skipcerts optional inbothnlandasn.
rulesconformtothewritingstylespecified by rfc which remains unaltered for years since its release in .
in particular rules must use modal key words to indicate requirement levels.
the modal key words include absoluterequirementsorprohibitions ofspecifications must required shall must not and shall not requirements or prohibitions with flexibility should recommended shouldnot andnotrecommended and truly optional items may and optional.
theusageofuppercasekeywordsisemphasizedbyrfc8174 and it provides convenience for extracting rules from rfcs.
.
.
extracting rules from rfcs.
a sentence or a structure is a rule if and only if it includes at least one modal key word.
algorithm presents the method for extracting rules from rfc automatically.
in line the mark .
n means that a sentence ends at the end of a line and the mark .
indicates a sentence authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chu chen cong tian zhenhua duan and liang zhao ends in the middle of a line.
in line the three marks of asn.
represent defined data structures without bracket in the same line andindifferentlines respectively.inlines5 rulesareextracted and saved by sections which provides convenience for updating rules.
line requires that the content of a title should not include the content of its sub titles.
in line the title nearest to a rule is used to indicate what a pronoun e.g.
this field points to.
algorithm extracting rules from rfc input rfc5280.txt min s maxs mint maxt output text files of rules 1marknl .
n .
2markasn .
ln... ln ln... ln prime 3modalkeywordset must ... optional 4r the input txt file page break header footer blank line 5r is split into sections by level titles 6fortheith section i n mins i maxs do 7ruleset 8rulenum 9foreachcontent of level j title mint j maxt do nl sentences are extracted by mark nl asn.
structures are extracted by mark asn .
foreachs nl sentence asn.
structure do wordset s each word of s ifwordset s modalkeywordset nequal then rulenum s prime rulenum l e v e ljtitle s ruleset s prime end end 20end 21saverulesetas a text file named by the section number i 22end algorithm1canalsobeappliedinautomaticruleextractionfrom rfc6818bychangingtheinputas rfc6818.txt min s maxs mint maxt .
table shows the number of rules automatically extracted from each section of rfcs and .
table the number of extracted rules rfc sec.
sec.
sec.
sec.
sec.
sec.
sec.
.
.
updating rules.
as the update of rfc rfc cites the obsolete paragraphs and presents the updated paragraphs.
in order to adapt to this change algorithm is formalized for automaticallyupdatingrules.itwillupdatesections4 7and8of rfc5280withsections3 5and6ofrfc6818 respectively.inline the marks ...says ...replaced with and add ed ... indicate obsolete updated and additional paragraphs respectively.
in line3 obsolete rules are distinguished from updated rules according to theirpositionsrelativetothemarks.inlines4 thedifference betweenwordsetsofeachpairofrules iscalculatedandpresented in a matrix.
in line the updated rule if any which has the minimum difference from an obsolete rule is identified.
in lines the obsolete rule is discarded if no updated rule exists.
in lines15 iftheobsoleteandupdatedrulesaresame theobsolete rule is kept without any changes otherwise it is replaced with the updated rule.
algorithm updating rules input sections and of rfc rules of rfc output updated rules of rfc 1markpos ...says ...replaced with add ed ... 2foreachsection of the input do 3classify rules into obruleset andupruleset by mark pos 4foreachr1 obruleset upruleset do wordset r1 each word of r1 foreachr2 obruleset upruleset do wordset r2 each word of r2 matrix wordset r1 wordset r2 end 10end 11foreacho obruleset do updateo us.t.
u prime upruleset matrix min matrix if nexistsmatrix then updateo discarded else ifmatrix matrix then updateo unchanged else updateo u end updateoof rfc according to updateo 21end 22end table2showsthenumbersoftheupdatedanddiscardedrules in rfc .
table update in rfc rules sec.
sec.
sec.
sec.
sec.
updated discarded .
.
consumer and producer rules.
rules that cas should follow in issuing certificates are called producer rules while rules requiredtobeobeyedbycertificateusersduringthevalidationprocessareconsumerrules.note thatthere existrules whichare both producerandconsumerrules.theserulesarecalled sharedrules.
certificate validation in ssl tls implementations should conform to all the consumer related rules.
thus in our work consumer authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rfc directed differential testing of certificate validation in ssl tls impls icse may june gothenburg sweden and shared rules are considered.
example shows a consumer rule while example presents a shared rule.
example3.
inaddition applicationsconformingtothisprofile should recognize the authority and subject key identifier and policy mappings extensions.
example .
this field mustcontain the same algorithm identifier as the signature field in the sequence tbscertificate .
algorithm3classifiesupdatedrulesintoproducer consumerand sharedrules.inthisalgorithm lines2and3showexplicitpatterns of producer and consumer rules respectively.
lines add a rule tothecategoryofproducerrulesifitmatchesthecorresponding pattern.
similarly lines recognize a consumer rule.
rules matchingbothpatternsarerecordedassharedrulesasshownin line .
to prevent duplication shared rules are removed from the categories of consumer and producer rules as shown in lines and respectively.
line collects implicitly shared rules suchas the one in example as well as explicitly shared rules.
the classificationresultofalltherulesisshownintable3.notethat the sum in each column is the difference between the number in the first row of table and the number in the second row of table .
algorithm classifying rules into three categories input a set of updated rules updatedruleset output producer consumer and shared rules 1producerruleset consumerruleset sharedruleset 2markpr conforming cas ... issuing ca 3markcr implementations ... relying parties 4foreachr updatedruleset do 5foreachm markprdo ifr matches m then producerruleset r break end 10end 11foreachm markcrdo ifr matches m then consumerruleset r break end 16end 17end 18sharedruleset producerruleset consumerruleset 19consumerruleset sharedruleset 20producerruleset sharedruleset 21sharedruleset updatedruleset producerruleset consumerruleset .
.
breakable and unbreakable rules.
consumer and shared rulesarefurtherclassifiedintotwocategories breakableandunbreakablerules.asanexample example5indicatesthattheobject explicittext withmorethan200characters isusedtotestcertificate validation and we only observe the response from ssl tlstable classification result rules sec.
sec.
sec.
sec.
sec.
producer 9consumer 2shared implementations.sucharuleisunbreakable.incontrast therule showninexample4is breakable.toviolatetherule different signatureandsignature algorithm could be set in a certificate i.e.
the requirementcouldbebroken.withthissetting whetherssl tls implementationsconformtothisruleistested.also bugswhich violate the rule can be found in this way.
example .
therefore certificate users should gracefully handle explicittext with more than characters.
algorithm4isusedforclassifyingconsumerandsharedrules into breakable and unbreakable ones.
the classification result is given in table .
algorithm classifying consumer and shared rules input consumer and shared rules csrset output breakable and unbreakable rule sets 1breakableruleset unbreakableruleset patternset 2modalkeywordset must ... optional 3markub gracefully handle ... receive 4foreachm modalkeywordset do 5foreachu markubdo patternset m u 7end 8end 9foreachr csrsetdo 10foreachp patternset do ifr matches p then unbreakableruleset r break end 15end 16end 17breakableruleset csrset unbreakableruleset table the number of breakable unbreakable rules rules sec.
sec.
sec.
sec.
sec.
breakable 1unbreakable .
.
expressing rules as variables.
untilnow thebreakable unbreakablerulesareexpressedinnl asn.
.ontheonehand itis difficulttodirectlygeneratecertificatesautomaticallyfromthese authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chu chen cong tian zhenhua duan and liang zhao rules.
on the other hand it is error prone to manually obtain combinedrules.toimprovethissituation rfccertconductsdseatthe secondsteptoautomatethecertificategenerationprocess.todo so rules are expressed as variables.
generally breakable and unbreakable rules present two kinds of requirements constraints on what values should be set to components of certificates and specifications on how implementationsshouldrespondtothesettings.constraintsareimposed onconditionsandresultsofarule.inexample4 theconditional constraint is tbscertificate.signature presents while the resulting constraint is signaturealgorithm must contain the same algorithm identifier .
the rule in example specifies that applications should recognize the three identifiers under the conditional constraint presented in these identifiers.
according to the constraints and specifications these rules can be transformed into variables.
the transformation is fulfilled by algorithm which consists of three steps.
the first step as shown in lines gathers the reserved words which constitute the backboneofrules.then thesecondsteputilizesthereservedwords tosimplifyrulesaspresentedinlines13 .afterthat thethird step generates combined constraints for nl and asn.
rules as shown in lines and respectively.
the number of cases attained in line is determined by the syntax of a rule.
in line the embedded constraint tis usually indicated by if present ... in the original asn.
rules.
accordingtothealgorithm examples3 4and5areexpressedas variables authoritykeyidentifier present subjectkeyidentifier present policymappings present applications shouldrecognize tbscertsignature present signaturealgorithm mustsame and explicittext morethan200chars certusers shouldhandle respectively.
due to the difficulty in natural language processing human assistance is required to fulfill algorithms .
.
generating low level test cases dsefulfillson demandcombinationsofrulesbyexploringpathsofarule relatedprogramwhichisdesignedinagreementwithtesting goals.asthebasisofassemblingcertificates thecombinationsof rulesarelow leveltestcases.withrulesexpressedasvariables itispossibletoproducelow leveltestcasesthroughthedsetechnique.specifically wemakeuseofthedsetoolklee toexplorepaths ofasymbolicprogramandgeneratelow leveltestcases.algorithm is formalized to automatically generate a symbolic c program from a given set of rule variables.
thestructureofsymbolicprogramthatalgorithm6generatesis shown in figure .
the embedded if elsestatements avoid an exponentialexplosionsothatkleewillgenerateonly m 1low level test cases of which mare meaningful.
among the meaningful lowlevel test cases ilow level test cases conform to the iunbreakable rules lines8 andtheother m ilow leveltestcasesviolate them ibreakable rules lines .
for brevity suppose x1 x2 andx3represent variables of examples and and and represent the bounds and .
four low level test cases will be generated by klee x1 x2 andx3 x1 x2 andx3 x1 x2 andx3 and x1 x2 andx3 .
due to the assignment mechanism of kleeandthedefinitionof un breakablerules onlythevalues1algorithm expressing rules as variables input un breakable rules i.e.
ubrset and brset output variables 1responseset otherset varset 2modalkeywordset must ... optional 3sentencepatterns if ... when 4logicpatterns and ... or 5responsepatterns also ... be prepared to 6otherpatterns angbracketleft... angbracketright ... digits 7componentset components and their variants 8foreachr ubrset brset do 9responseset word after m rp m modalkeywordset and rp responsepatterns 10otherset word matching p otherpatterns 11end 12reservedset modalkeywordset sentencepatterns logicpatterns componentset responseset otherset 13replace pronouns with corresponding titles.
14foreachr ubrset brset do 15deletewfromr w nelementreservedset 16end 17foreachr ubrset brset primedo 18ifr is a rule expressed in nl then obtain cases according to syntactic patterns foreachcase of rdo condition c1 v1 ... ci vi i n ifr ubrsetthen response consumer actions if any varset condition else result c1 v1 ... cj vj j nif any varset condition end end 30else foreachoptional component c rdo ifa constraint t is embedded then constraints c c absent t else constraints c c absent c present end end foreachnon optional component c rdo constraints c c validvalue end varset combined constraints for r 42end 43end 44forvarset replace with respectively and are meaningful.
the first two low level test cases conform to the unbreakable rules in examples and respectively.
thethirdlow leveltestcaseviolatesthebreakableruleinexample4.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rfc directed differential testing of certificate validation in ssl tls impls icse may june gothenburg sweden algorithm generating a symbolic c program input a set of rule variables varset output a symbolic c program 1generate include ... and int main 2generate the variable declaration using varset 3partition varset into ubvarset and bvarset by un breakable rules 4makevsymbolic v ubvarset 5makevsymbolic v bvarset 6foreachv ubvarset do 7generate if v printf v else 8end 9foreachv bvarsetdo 10generate if v printf v else 11end 12delete the redundant else and add 13save as a .c file include stdio.h include klee klee.h 3intmain 4intx1 x2 ... x m 5klee make symbolic x1 sizeof x1 x1 ... 7klee make symbolic xm sizeof xm xm 8if x1 unbreakable rule printf x1 else ... if xi unbreakable rule printf xi else if xj breakable rule j i printf xj else ... if xm breakable rule printf xm figure structure of a symbolic program thefourthlow leveltestcaseismeaninglessandwillbeomitted.
from the first three low level test cases rfccert will assemble certificates at the next step.
the structure as shown in figure meets the requirement that each low level test case conforms to orviolatesonlyonerule.forcomplicatedtestinggoals thestructure of symbolic programs can be designed differently to realize complicatedcombinationsof rules.thus dsetechniqueprovides flexibility for generating low level test cases to achieve different testing goals.
.
assembling high level test cases algorithm uses low level test cases to assemble certificates i.e.
high leveltestcases.basiccomponentsandtheirvalidvaluesaresavedinline1.then lines3and4extractcomponentsandvalues from conditions and results of the low level test cases respectively.
for example angbracketlefttbscertsignature present angbracketrightand angbracketleftsignaturealgorithm mustsame angbracketrightcomefrom tbscertsignature present signaturealgorithm mustsame .inlines5 basiccomponentsaresettodefault values.
if a ca certificate is being assembled lines set values of corresponding components.
after that lines set values of components according to the conditions of low level test cases.
by contrast lines set values against the requirements which actuallyrealizesthebreakingofbreakablerules.
forexample signature algorithm is set tosha1withrsa whilesignature is set to sha256withrsa.i f signature algorithm is not involved in the rule it will be set the same as the signature as shown in lines .
finally the certificate is encoded and saved in line .
algorithm assembling certificates input low level test cases output high level test cases i.e.
certificates 1basicmap angbracketleftversion defaultvalue angbracketright ... 2foreachlow level test case do 3conditionmap angbracketleftcomponent i valuei angbracketright i n 4resultmap angbracketleftcomponent j valuej angbracketright j n 5foreachc basicmap.componentset do setc basicmap .value c 7end 8ifa ca certificate is being assembled then set validbasicconstraints andkeyusage 10end 11foreachc conditionmap.componentset do setc conditionmap .value c 13end 14foreachc resultmap.componentset do setcagainstresultmap .value c 16end 17ifsignaturealgorithm has not been set then signtbscertificate with thesaiinsignature 19end 20encode the certificate and save as a file 21end rfc directed differential testing inthissection anempiricalstudyontestingcertificatevalidationin ssl tls implementations is carried out.
in total consumer and sharedrulesareusedand89certificatesaregeneratedbyrfccertdt.
these certificates act as test cases of rfc directed differential testing.
.
setup .
.
configuration.
we employ popular ssl tls implementationsand3webbrowsersfortesting.somessl tlsimplementationshaveindependentversionserieswhicharestillmaintained bydevelopers.thus thefollowingindependentversionsaretested openssl v1.
.1u v1.
.2jandv1.
.0b armmbedtlsv2.
.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chu chen cong tian zhenhua duan and liang zhao gnutls v3.
.
v3.
.16andv3.
.
mozillanssv3.
wolfssl v3.
.
matrixssl v3.
.
mozilla firefox v49.
.
microsoft internet explorer v11.
.
.18449is and google chrome v54.
.
.
.
note that mbedtls and wolfssl are descendants of polarssl and cyassl respectively.
for brevity the version number of an implementation is omitted in the rest of the paper except as otherwise noted.
experiments are conducted on two kinds of virtual machines both of which are configured with one core of an intel core i74790cpu .60ghz and1.5gbram.one soperatingsystem os is canonical ubuntu x64 v16.
lts and the other s is microsoft windows7x64withservicepack1 v6.
.
.openssl mbedtls gnutls nss wolfssl matrixsslandchromearetestedinubuntu.
internet explorer is tested in windows .
mozilla firefox is tested in both of the two oss.
for accuracy each version of ssl tls implementations and web browsers is tested in a distinct virtual machine.
.
.
testing modes.
ssl tlsimplementationsandwebbrowsers provide different modes for certificate validation command line certificate manager and client server.
in our experiments eachmode is adopted to perform certificate validation of a few implementations and or browsers in the following way.
command line openssl mbedtls gnutls nss and matrixssl.
certificate manager firefox internet explorer and chrome.
client server wolfssl.
.
.
metrics.
certificatesthataredirectlyusedtotestcertificatevalidationarechiefcertificatesandcertificatesthatareneeded bychiefcertificatesinthevalidationareauxiliarycertificates.to analyze and evaluate testing results conveniently we define an m dimension vector rfccertfor each chief certificate rfccert angbracketleftsn rfcreason rfcresult resulti1 ... resultim angbracketright.
here snistheserialnumberofacertificate and rfcreason records a rule which is violated or obeyed.
if the rule is violated the value ofrfcresult is reject while if the rule is obeyed rfcresult is accept .
it is possible that both accept and reject are reasonable and in this case the value of rfcresult is .
besides resultii i m indicatesthecertificatevalidationresultofthe ithssl tls implementation.
these vectors are used as metrics in the following ways.
ifresultii nequalresultij i j m i nequalj a discrepancy is found.
for a vector angbracketleftresulti1 ... resultim angbracketrightx if it is not equivalent toany angbracketleftresulti1 ... resultim angbracketrightyamongkdiscrepancies x y k x nequaly a distinct discrepancy is found.
ifrfcresult the discrepancy if any is invalid.
rfcreason presents an explanation for a discrepancy.
ifresultii i m does not match rfcresult one bug is found and rfcreason provides the reason.
the total number of bugs found in the ithssl tls implementation is calculated by the following formula.
nb i summationdisplay.
rfccert s.t.rfcresult nequal2 rfcresult resultii we define the conformance ratio as a criterion for sorting ssl tls implementations cr i rfcresult matchesresultii certs where rfcresult matchesresultii isthenumberofexperimental results in accordance with rfcs and certs is the number of chief certificates.
.
comparing mucert with rfccert frankencert is the pioneering work in automated testing of certificatevalidationinssl tlsimplementations.asmentioned previously experiments in show that mucert is more efficient thanfrankencertinfindingdistinctdiscrepancies.therefore we compare rfccert with mucert.
table5andfigure7of showthat mucert withparameters .3andk 500findsmoredistinctdiscrepanciesthanothers.
thus the parameters are employed in the repetition of mucert and themutatedcertificatesareemployedinthecomparison.thereare twoschemesforcomparison.oneschemeistotestoldssl tlsimplementations adopted in .
however neither obsolete versions e.g.
matrixssl v3.
.
nor sha256 sha1 md5 values are publicly available andexperimentsonnon officialversionsarenotcredible.
theotherschemeistotestnewversionsaslistedinsection4.
.
.
for this scheme there exist two problems.
first new versions offirefox and chrome require certificates in the format of .p12 pfx but certificates of mucert cannot be converted to this format since they do not match the private key.
second the ca certificate of mucert cannot be loaded without modification of wolfssl s source code.
for the sake of fairness and usefulness in practice mucert andrfccertarecomparedonopenssl mbedtls gnutls nss matrixssl and internet explorer versions in total .
we have conductedexperimentswith89certificatesonthese10implementa tions.
the results show that rfccert finds distinct discrepancies while mucert finds with in common.
therefore rfccert is a significantsupplementtomucertinfiningdistinctdiscrepancies.
table shows the comparison in detail.
table a comparison of rfccert with mucert item mucert rfccert distinct discrepancies number of certificates nc 89time for certificate generation 15nc for one distinct discrepancy .
.
the following facts can be drawn from table .
a rfccert has found distinct discrepancies by using just 89certificates while mucert has found distinct discrepanciesby using certificates.
therefore for finding ratio fr rfccert is .
while mucert is .
.
it is clear that rfccert is more effective than mucert.
b rfccertspends15secondsingenerating89certificateswhile mucert spends seconds for generating certificates.
for the average speed of finding sf a distinct discrepancy authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
rfc directed differential testing of certificate validation in ssl tls impls icse may june gothenburg sweden rfccert is .
while mucert is .
.
therefore rfccert is more efficient than mucert.
.
invalidity of traditional differential testing of certificate validation neitherfrankencertnormucertshowsdirectlywhetheradiscrepancy is valid.
by contrast rfccert can determine whether a discrepancyisvalid.infact ifthevalueof rfcresult is2 thediscrepancy is invalid.
example presents a rule that this extension i.e.basicconstraints maybe criticalornon critical.onecertificate of rfccertis assembled for thisrule and basic constraints is setto critical.
our experiments find one discrepancy related to the certificate wolfssl and matrixssl reject it while other implementations accept it.
consequently non restricted may optional rules indicate that differential testing of certificate validation in ssl tls implementations may be invalid in some cases.
example .
this extension mayappear as a critical or noncritical extension in end entity certificates.
inaddition traditionaldifferentialtestingrequiresatleasttwo ssl tlsimplementations.otherwiseitcannotfindanydiscrepancy.
in contrast rfccert is able to test a single implementation by checking whether rfcresult xmatchesresultii xfor some i i m andforall x x certs .ifthematchfails rfcreason x indicates which rule is violated in the implementation.
.
finding and reporting bugs .
.
finding bugs and conformance ratios.
fourteen versions of implementations mentioned in section .
.
are tested individually by the certificates produced by rfccert and the numbers ofthedetectedbugsareshowninfigure5.itshowsthatrfccert finds bugs on average in each of the implementations.
number of bugs ssl tls implementations number of bugs found by rfccert figure number of bugs found by rfccert basedoncurrenttestcasesandformula wherethenumber ofchiefcertificatesis79 ssl tlsimplementationsaresortedby theconformanceratiosinfigure6.therankingis matrixssl wolfsslandmbedtls firefox inwindowsandubuntu nss opensslv1.
.0b gnutlsandie and chrome openssl v1.
.1uand1.
.2j.therankingprovidedbyrfccertishelpfulfor userstochooseappropriatessl tlsimplementationsintermsof adherence to rfcs.
.
.
.
.
.
.
.
.
.
conformance ratio ssl tls implementations conformance ratios of ssl tls implementations figure conformance ratios .
.
reporting bugs and feedback.
we have been reporting bugsfoundbyrfccerttothecorrespondingdevelopers.uptonow at least bugs have been confirmed or fixed.
googlehasconfirmedandfixedonereportedbug.wehavereported thesecuritybugtogooglethatchromeinubuntuacceptsacertificatewhose tbscertificate.signature andcertificate.signaturealgorithm are different.
if a strong hash algorithm e.g.
sha256 is declared in tbscertificate.signature whilea weakhashalgorithm e.g.
sha1 is actuallyusedin certificate.signaturealgorithm policychecksprohibiting weak signature will pass because they only care about tbscertificate.signature in the certificate.
if an attacker obtains such acertificatewhichhasaweaksignaturealgorithm hemaycrack it and generate a forged certificate at his will.
the forged certifi catewillbefalselyacceptedbyclients servers whichmayresultin security problems.
google security team has carried out experiments on eight permutations of certificate.signaturealgorithm certificate.signaturevalue andtbscertificate.signature andconfirmed that it is a security bug.
the team has fixed this security bug in chrome v58.
.
.
cve .
microsoft has confirmed one reported bug.
we have reported the similarsecuritybugfoundinmicrosoftinternetexplorer.microsoft edge team has confirmed and appreciated our report3.
although it has been fixed in the code of verifier of chrome v58.
.
.
this security bug still exists in the underlying platform verifier in ubuntu and windows.
that is other untested web browsers and ssl tls implementations depending on the os verifier may have similar security bugs and their users are vulnerable to attacks which exploit this bug.
gnutls has confirmed and fixed three bugs gnutls accepts a version certificate with issuer unique identifier4 gnutls acceptsaversion 1certificatewith subjectuniqueidentifier5 and gnutls accepts a certificate which has a fractional validity6.
wolfsslhasconfirmedandfixedfourbugs3 wolfsslaccepts a certificate with duplicate policy object identifier s wolfssl accepts a certificate with more than one instance of a particular 3reports are not public and screen shots are provided upon request.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden chu chen cong tian zhenhua duan and liang zhao extension wolfsslacceptsacertificatewitharelativeuriin subject alternative name and wolfssl accepts an end entity certificate with name constraints.
to sum up rfccert is more cost efficient than the state of theart approach mucert and traditional differential testing of certificate validation in ssl tls implementations is sometimes invalid.moreimportantly rfccertiscapableofidentifyingbugs inasinglessl tlsimplementationandprovidingrfc basedexplanations while traditional differential testing cannot fulfill these tasks.
related work several vulnerabilities in certificate validation of ssl tls implementations have been reported in .
kaminsky et al.
show a case of mitm attacks by exploiting a flaw in certificate validation .
georgiev et al.
study bugs of apis of ssl tls implementations andanalyze perilsand pitfalls ofcertificate validationbased on these apis .
these work shows that certificate validation inssl tlsimplementationsisinsecureanditis necessarytotest certificate validation.
due to the intricate syntactic and semantic constraints of certificates methodsthathavesucceededinotherfieldsaredifficultto be employed in certificate validation.
in daniel et al.
generate structurallycomplexjavaprogramsiterativelyandemploythemto testrefactoringengines.h owever this methodisnotsuitablefor testingcertificatevalidationduetotheillegalstructuresformostofthetestcases.fuzzing providesfewusefultestcases forcertificatevalidationeither sincemosttestcasesdonothavethe complexstructuresrequiredbycertificates.besides geneticalgorithmshavebeenadoptedtotestcertificatevalidation.frankencert isthefirstautomateddifferentialtestingofcertificatevalidation and it produces certificates by mutation.
it finds distinct discrepancies byusing randomlymutated certificates.
the aimlessmutationleadstofrankencert slowefficiencyinfinding discrepancies.
inspired by the idea of feedback directed test case generation mucertconsiderscodecoveragetoguidecertificate mutation.
thusthe mutated certificates arerelated to the code ofcertificatevalidationinopenssl.mucertalsoemploysmcmc samplingtodiversify themutatedcertificates.in mucertfinds distinct discrepancies by using mutated certificates.
there fore mucert significantly improves efficiency of differential testing of certificate validation in ssl tls implementations.
however there are limitations in genetic algorithm based approaches.
the choice of seed certificates and mutation operators hasagreateffectontheperformanceoffrankencertandmucert and it is time consuming to choose appropriate seed certificates and mutation operators.
for a mutated certificate which leads to a discrepancy itsstructureandcontentarenotclearuntiltheyare analyzed manually.
hence neither frankencert nor mucert can directly pointout whether orwhy a discrepancy is invalid or which implementations make mistakes.
moreover to solve a discrepancy manualwork isrequiredfor analyzing intricateconstraintsof the structureandcontentinamutatedcertificate.inparticular fora single implementation traditional differential testing using genetic approaches does not work.
although the state of the art approachmucertisguidedbythecodecoverageofopenssl differentimple mentationshavedifferentcodesandthecodecoverageofopenssl cannotrepresentthatofothers.itisstillanopenquestionhowto obtainanoverallcodecoveragetoguidecertificatemutation.therefore abetterwayistogeneratediscrepancy targetedcertificates directed by high level specifications instead of the code coverage.
specificationshavebeenusedforvariouspurposes.grammarbasedtestingtechniques generateprogramsbasedon grammars.
for example csmith employs generated programs to find bugs in open source c compilers.
korat employs the precondition ofa methodto generatetest casesand thenemploys thepostconditionasatestoracletocheckthecorrectnessofoutputs.
testera producesjavaprogramsascounterexamplestoviolated correctness criteria.
hierons et al.
have made a survey of using formal specification to assist testing .
inspired by the above specification based methods rfccert utilizes dse and assembling techniques toefficientlygeneratestandards basedcertificatestoovercome the disadvantages of traditional differential testing.
with the standards certificates produced by rfccert are more discrepancytargetedthanmutatedcertificatesgeneratedbygeneticapproaches suchasfrankencertandmucert.experimentalresultsshowthatrfccert significantly improves the differential testing of certificatevalidationinssl tlsimplementations.inaddition rfccert can be extended to specification based differentialtesting of other implementations.
sumanetal.employerrorspecificationstodetecterrorhandling bugs .
rfccert is different in that we employ standards to generatecertificateswithcomplexstructuresandthenemploythem to find bugs in certificate validation.
in the approach proposed by bauer et al.
is a model based run time verification technique whichcompletelydependsontheopen sourcecode.bycontrast our approach is an rfc directed testing technique where the code is not required.
conclusion and future work in this paper we propose rfccert an rfc directed approach to thetestingcertificatevalidationinssl tlsimplementations.with rfc based certificates rfccert reveals bugs identifies distinctdiscrepancies and determines the validity of differential testing.extensive experiments show that rfccert is effective in finding distinct discrepancies and bugs.
in the near future we are going to apply our approach to all the rules in rfcs and for detecting vulnerabilities orbugs.
in addition we plan to improve our tool rfccertdt so as to help developers enhance the security of certificate validation in ssl tls implementations.
we look forward to facilitating the standardization of certificate validation in ssl tls implementationsand making it convenient for users to choose suitable products according to the conformance ratios.