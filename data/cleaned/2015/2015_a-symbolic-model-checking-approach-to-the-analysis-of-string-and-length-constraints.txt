a symbolic model checking approach to the analysis of string and length constraints hung en wang graduate institute of electronics engineering national taiwan university taiwanshih yu chen graduate institute of electronics engineering national taiwan university taiwan fang yu department of management information systems national chengchi university taiwanjie hong r. jiang graduate institute of electronics engineering department of electrical engineering national taiwan university taiwan abstract strings with length constraints are prominent in software security analysis.recentendeavorshavemadesignificantprogressindeveloping constraint solversfor strings and integers.
most priormethodsarebasedondeductionwithinferencerulesoranalysisusing automata.theformermaybeinefficientwhentheconstraintsinvolve complex string manipulations such as language replacement thelatter maynotbe easilyextendedto handlelengthconstraints andmaybeinadequateforcounterexamplegenerationduetoapproximation.
inspired by recent work on string analysis with logic circuit representation we propose a new method for solving string withlengthconstraintsbyanimplicitrepresentationofautomata with length encoding.
the length encoded automata are of infinite states and can represent languages beyond regular expressions.
by converting stringand lengthconstraints into adependency graph of manipulations over length encoded automata a symbolic model checker for infinite state systems can be leveraged as an engine for theanalysisofstringandlengthconstraints.experimentsshowthat our method has its unique capability of handling complex string and length constraints not solvable by existing methods.
ccs concepts software and its engineering formal software verification security and privacy logic and verification keywords length constraint string analysis symbolic model checking acm reference format hung en wang shih yu chen fang yu and jie hong r. jiang.
.
a symbolicmodelcheckingapproachtotheanalysisofstringandlength constraints.
in proceedings of the 33rd acm ieee international conferenceonautomatedsoftwareengineering ase september3 permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
ase september montpellier france association for computing machinery.
acm isbn ... .
france.
acm new york ny usa 11pages.
.
introduction formal analysis of string manipulating programs are crucial to detect and rectify service applications.
many web service vulnerabilitiesareduetoimproperinputvalidationandsanitization.anyerror in validation and sanitization of user input can lead to a significant vulnerabilityforawebapplication andcanbeexploitedbymalicioususersall aroundtheworld.inputvalidation andsanitization inwebapplicationsiscrucialandchallengingsincecommunication betweenthedifferentlayersofawebapplicationoccursthrough directives commands that often embed user input and are writteninmanylanguages suchasxml sql andhtml.programs that propagate and use malicious user inputs without validation and sanitization or with improper validation and sanitization are vulnerable to attacks such as xss and sql injection.
in fact to datethesetwotypesofvulnerabilitiesinwebapplicationsarenotorious andtheyarewidelypublicized .thisfactindicatesthe intrinsicdifficultyofinputvalidationandsanitizationproblemsand demonstrates the need for automated tool support that can help programmersinpreventingvulnerabilitiesduetoerrorsinstring manipulating programs.
even though many string constraint solvingtechniques e.g.
havebeenproposed analyzing complex string manipulation programs remains challenging.
string constraint solving can be particularly hard when the constraints involve complex string operations and involve both string and integer variables .
specifically it has been shown that solving string constraints with replace all and length constraints is undecidable .
thereplace all operation is widely used in input sanitization functions in web applications.
it defines the replace of amatchpatternwithareplacementpatternforthesentencewithinagivensetoflanguage.suchanoperationcanbeimplementedwith finite state transducers or automata and hence can be leveragedtosolvestringconstraintswithreplacement .while anautomata basedstringconstraintsolvertakesadvantageofautomataconstructionforstringmanipulationsofunboundedstrings it often adopts regular abstraction to approximate solutions that cannotberepresentedwithfinite stateautomata.thisregularapproximation limits the ability of presentations on relations among string variables .
for example to deal with length constraints authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hung en wang shih yu chen fang yu and jie hong r. jiang one approach is to derive and refine arithmetic automata a.k.a.
lengthautomata in fromstringoperationstotracklength relations during the computation.
the constraint on length of each stringvariablecanthenbederivedfromthearithmeticautomata torefinethestringautomata.thismethodoverapproximatesthe relationoflengthsofstringvariablesinarithmeticautomata.on the other hand the smt based approaches e.g.
for string constraint solving are native to deal with length constraints.
while these dpll t based solvers handle a variety of string constraints including word equations regular expression membership length constraints and morerarely regular rationalrelations thesolvers can not handle some string manipulations such as replace all.
a recent work that extends s3 to s3p addresses this issue with recurrence to reason such operations.
later we show that the recursive operation may cause non termination and lead to non robust results of constraint solving.
trau integrates smt solvers with the cegar framework using flat automata to over and under approximation the solution set.
in this work we propose a new symbolic model checking approach to mixed string and integer constraint solving.
a class ofinfinite state automata is introduced to encode length informa tionwithinstringautomata.alength encodedautomatonkeepsthe length information of strings as integer values in its states.
through manipulations over length encoded automata we can not only model complex string operations but also deal with length constraints.theconstructedlength encodedautomatonatthesink node of a dependency graph precisely characterize the corresponding mixed string and integer constraints.
symbolic model checking algorithmsforinfinitestatesystems canthenbeexploitedforlan guage emptiness checking of the length encoded automata.
buildingupontheslogframework theproposedmethod is implemented as a tool named slent to handle both string and length constraints.
we extend the circuit representation of finite stateautomata to infinite stateautomatabyaddinginteger variables for tracking length information.
we exploit software modelcheckingalgorithms asthebackendcomputationengine.experimentsshowtheuniqueadvantagesof slentcompared to modernstring constraint solvers suchas s3p z3str3 cvc4 norn abc andtrau .ourmethoduniquely solves a number of complex benchmarks and can support counterexamplegenerationofinputstringsaswitnesswhenthesetof constraints under analysis is satisfiable.
overview to motivate consider the following example of constraints x1 a x2 b x3 x1.x2 x4 replace x3 a b ba len x1 len x2 len x1 len x4 where the replace operator y replace x r1 r2 is a languageto language replace all operation which can be alternatively defined by y x x nelement .r1.
x x1.x2.x3 x1 nelement .r1.
x2 r1 y x1.y1.y2 y1 r2 y2 replace x3 r1 r2 and the len operation constrains the length of a string variable.note that the above constraints x3 x1.x2 and len x1 len x2 ensurethat x3isinthelanguage anbn forn 0beingthe lengths of x1andx2.
thenx4is obtained by performing language to language replacement onx3.
forx4 replace x3 a b ba a substring of the form amb for some m n in the middle ofanbnwillbereplacedwith ba.inthiscase wehave len x4 2n m n len x1 whichcontradictsthelastconstraint len x1 len x4 .
hence the set of constraints is unsatisfiable.
forrule basedsolvers solvingconstraintsinvolvingbothreplaceall incontrastto replace first andlengthoperationsisdifficult for three reasons.
first the recursive definition of replace all operationmayinducenontermination .second intherecursive definition of replace all operation querying non membership of theform x nelement .r.
whererisaregularexpression isfundamentally difficult for rule based solvers.
in fact even the simpleexample x nelementa x a a can be difficult for solvers such ascvc4 z3str3 ands3p tosolve.third thelength relation between strings before and after several string operations is hard to be captured.
for instance let x1 aa x2 bb x3 aabb andx4 abab obtained by replacing the middle abinx3withba .thenthefirstsymbol a inx1isalsoremainedin x4 and contribute to both the lengths of x1andx4.
such relations on string lengths may be even more complicated and harder to capture when more operations are involved between two strings.
forautomata basedsolvers thereplacementoperationcanbe naturally achieved by automata based construction .
however the satisfying values of variables x1 x2 x3 x4in the above examplearenotregularduetotheconditionimposedbythelength constraints.
they cannot be represented precisely with finite state automata.
to cope with length constraints prior work constructed automata for string constraints and for length constraints separately.thearithmeticautomataderivedfromlengthconstraints were used to refine the string automata derived from string constraints.nevertheless therelationsamongvariablescannotbekept precisely.thisimprecisenessmayover approximatethesolutions to the above set of constraints and mistakenly conclude its satisfiability.inpriorwork acegar basedframeworkwasproposed usingflatautomataforconstraintrefinement.withoutcapturing the length relation between variables before and after replacement themethodmightnothaveproperrefinementtoguaranteetermination on the above example.
recent work exploited alternating automatatorepresentstringformulasconsistingofwordequations 1the recursive replace all operation defined in specifies each to be replaced substring being the leftmost possible candidate.
in contrast the replace all operation considered in this work follows .
it allows a to be replaced substring being at any position and thus may yield more replacement solutions than .
we refer to the two replace all definitions as replace all first of s3p and replace all any of slent.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a symbolic model checking approach to the analysis of ... ase september montpellier france regular constraints and rational constraints.
although it may handle length constraints and relation among variables its scope is limitedtosomedecidablefragmentofformulas.theaboveexample isunfortunatelybeyondthedecidablefragmentasvariable x4by the method would appear in two rational constraints.
figure dependency graph for constraint solving.
in this work we propose length encoded automata to characterize string and integer constraints.
we assume the string and length constraints can be represented with a dependency graph which isatreethatspecifieshowthelength encodedautomataareconstructedwithrespecttothegivenconstraints.figure 1showsthe dependency graph of automata construction corresponding to the above example of constraints.
in the graph each source node without incoming edges corresponds to a finite automaton accepting a pre specifiedregularlanguage andeachinternalnodecorresponds to an automata operation such as concatenation replacement etc.
for each internal node with operation op an automaton can be constructedbyperformingtheoperationoponitsimmediateupstream automata.
we introduce a new trklen operation to attach anintegervariablegloballyseenbyallstatesofanautomatonto track the length information.
a non epsilon transition of an automaton should incur a length increment by one and thus theinteger indicates the length of the string currently taken by theautomaton.
such automata with length encoded integers are referred to as length encoded automata.
by setting the initial value of anintegertozero aftertakinganinputsequence thefinalvalue of the integer will be the length of this sequence.
note that the length constraints and initialization of the length integers are only imposed on the automaton called sink automaton at the sink node without outgoing edges of the dependency graph before the final languageemptinesscheckingisemp.thesetoflengthconstraints isimposedaspartoftheacceptingconditionofthesinkautomaton.
inanautomataoperation anintegercarriedbyanautomaton ai which is involved in the operation increases its value only when a transition takes place among the states of ai and retains its value when a transition takes place among the states of other automaton ajforj nequali.thereby theproposedmethodcanpreciselycapturep a a q b b p q a b c figure length encoded automata for a a1 b a2 and c a3.
complex length relations among different strings with replacement involved.
toillustratehowintegersarecarriedthroughautomataoperations weconsiderinfigure 1theconstructionofautomaton a3for string variable x3 which is the result of concatenating string variablesx1andx2.
figure2 a and b show the two length encoded automata a1anda2for variables x1andx2 respectively.
automatona1has one state pand recognizes the language a anda2has one state qand recognizes the language b .
by length tracking a1 isattachedwithaninteger n1 whosevalueincrementswhenever anon transitiontakesplace amongstatessharing n1.itrecords thelengthoftheinputsequencetakenby a1sofar.similarly a2 is attached with an integer n2.
in general a state of an automaton can possibly be attached with one or multiple integers denoted through a sequence of automata operations.
in figure c automaton a3is constructed by concatenating a1anda2.ina3 therearetwostates state pattachedwith n1is froma1 and state qattached with n2is froma2.
the integer n1 respectively n2 increasesitsvalueonlywhentheself transitionon statep respectively q takesplace.essentially n1countsthenumber ofa stakensofaronstate p andn2countsthenumberof b staken authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hung en wang shih yu chen fang yu and jie hong r. jiang so far on state q.i fn1andn2are initialized to and the constraint n1 n2is added to the accepting condition then automaton a3 accepts exactly the context free language anbn n n .
in fact even the context sensitive language anbmcndm n m n can be represented with the length encoded automata.
preliminaries anautomaton is a tuple q i o t whereqis a set of states is a finiteset of input alphabet i qis the setof initial states o qis the set of accepting states and t q qis the transition relation.
in this work qcan be an infinite state set.
in the sequel we shall represent the initial states accepting states and transition relation by their characteristic functions i q b o q b andt q q b respectively for bbeing the boolean domain false true .
a characteristic function is a propositional function representing a set sby having e true if e sand e false if e nelements.
we refer vecx vecsand vecs prime tothe input current state andnext state variablesinthe boolean domain and relatethe valuations of variables vecx denoted and thevaluationsofvariables vecs denoted totheinputalphabetand state set respectively.
an automaton can be either deterministic ornondeterministic dependingonwhetherornotthereisauniquenextstate q prime qthat satisfiest q q prime for every input and current state q q. weassumeanautomatoncanbenondeterministicandmayhave transitions.forthesakeofconvenience wereserveasymbolnot in to represent i.e.
the empty input.
for a given transition relationt we write t to denote the transition relation derived fromtwith an additional self transition added to each state.
astring vec of length jover alphabet is a finite sequence 1 ... jofinputsymbols where i fori ... j.thelength of sequence vec is denoted as len vec .arunof an automaton is a state input alternating sequence q0 1 q1 2 ... j qj which satisfiest i qi qi truefori ... j. a string 1 ... j is accepted by an automaton if there exists a run q0 1 q1 2 ... j qjwithi q0 trueando qj true.
given an automaton a thelanguage ofa denote as l a is the set of strings accepted bya.
we define a length encoded automaton to be an infinite state automaton with its state set of the form q qs qn whereqs is a finite set and qn nkfor some non negative integer kandn beingthesetofnon negativeintegers.notethatwhen k the tuple degenerates to a finite automaton.
since both andqsare finite theirconstituentelementsarebooleanencodedinthesequel.
hence the characteristic functions i t ocan be represented with first order logic formulas over boolean and integer variables.
thestringandintegerconstraintsconsideredinthisworkcan beformallydefinedthroughthefollowingsyntacticconstruction rules.regular expression r.... r.r r r r r automata a.... reg2aut r trklen a int a a uni a a cat a a del a rep a ar ar rev a pfx a n sfx a n sub a n1 n2 trkidx a vec n length constraint c.... c1n1 ... cmnm c c1n1 ... cmnm c vecn getintvars a c c c c c language query p.... isemp a c in the above expressions rrepresents a regular expression a representsanautomaton possiblywithinfinitestates arrepresents a finite state automaton accepting some regular language r andcrepresents an boolean combination of linear arithmetic constraints.
moreover is an input symbol constant coefficientsareexpressedwithletter candci andvariableparameters are expressed with letter nandni.
the regular expressions are constructed with operators concatenation .
union kleene star andlanguagecomplement .theautomataoperationsinclude regular expression to automata conversion reg2aut length tracking trklen intersection int union uni concatenation cat deletion del replacementrep reverse rev prefixpfx suffixsfx substring sub and index tracking trkidx which are to be detailed insection .theautomataoperationtrklenintroducesanintegervariabletotrackthelengthofeachstringacceptedby a.the automata operation trkidx takes an automaton a a string vec and an integer parameter nas input and introduces an integer variable to track the position of the first occurrence of substring vec after the nthposition of each string accepted by a. the length constraint operationgetintvarsretrievestheintegervariablesintroduced byautomata operationstrklenandtrkidx.the languagequery operation isempty checks whether the language l a of the given automaton ais empty subject to the given length constraint c. given a set of string and integer constraints we construct a dependency graph whose sink length encoded automaton correspondstothesolutionsetoftheconstraints.inthiswork wefocus on the set of string and integer constraints whose dependency graph representation exists.
automata manipulation we extend the prior method using circuit representation for finite state automata manipulation to length encoded infinite state automata manipulation.
the new representation differs from i n that it includes the integer length variables in the inputs of the circuit whichisthereforenolongerboolean.weshowhowautomata operations including lengthtracking intersection union concatenation deletion replacement reversion prefix suffix substring and authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a symbolic model checking approach to the analysis of ... ase september montpellier france indextracking canbeachievedunderourrepresentationofinfinite state automata.
in the following discussions we shall assume an automaton a orai before length encoding is represented as a boolean circuitofitscharacteristicfunctions t vecx vecs vecn vecs prime vecn prime i vecs ando vecs orti vecx vecsi vecni vecs prime i vecn prime i ii vecsi an .
also without lossofgeneralityweassumethat vecs1 mand vecs2 lforautomata a1anda2 respectively with m lin our following discussions unless otherwise said.
.
length tracking given a finite state automaton awith its three characteristic functionst vecx vecs vecs prime i vecs ando vecs where vecx vecs and vecs primeare the input current state and next state variables respectively the length tracked version denoted alin the sequel of acan be constructed by operation trklen a which embeds an integer variable nto count the numberof transitions in t. so the stateset of alis augmentedto n andalbecomesaninfinitestateautomatondue to the unbounded length value of n. the characteristic functions of al trklen a can be obtained as follows.
tl vecx vecs n vecs prime n prime t vecx vecs vecs prime vecx nequal n prime n vecx n prime n il vecs i vecs ol vecs o vecs therefore aftertakinganon transitionfromacurrentstate vecs n toanextstate vecs prime n prime thevalueof n primeequalsn .otherwise under an transition the value of n primestays the same as n. notice that the length tracking does not affect characteristic functions iando.rather wewillonlyinitializethelengthtracking integer variables on the initial states and impose the length constraints over the length tracking integer variables on the accepting states of the sink automaton of a dependency graph for the final language emptiness checking to be detailed in section .
.
note also that during the iterative automata construction according toa dependencygraph anautomaton mayhave multiple lengthtrackingvariables vecninheritedfromitsupstreamautomatain thedependencygraph.ifthelengthoftheautomatonneedstobe considered then a new tracking variable needs to be introduced in additiontotheinheritedtrackingvariables.thatis ifanautomatonawith transition relation t vecx vecs vecn vecs prime vecn prime for vecn n1 ... ni and vecn prime n prime ... n prime i then the transition relation tl vecx vecs n1 ... ni vecs prime n prime ... n prime i ofalequalst vecx vecs vecn vecs prime vecn prime vecx nequal n prime i ni vecx n prime i ni .
.
intersection giventwoautomata a1anda2 thethreecharacteristicfunctions of automaton aint int a1 a2 that accepts language l a l a1 l a2 can be constructed as follows.
tint vecx vecs vecn vecs prime vecn prime t vecx vecs1 vecn1 vecs prime vecn prime t vecx vecs2 vecn2 vecs prime vecn prime iint vecs i1 vecs1 i2 vecs2 oint vecs o1 vecs1 o2 vecs2 figure circuit construction of int operation.
where vecs vecs1 vecs2 and vecn vecn1 vecn2 .
the corresponding circuit construction is shown in figure .
.
union giventwoautomata a1anda2 thethreecharacteristicfunctions of automaton auni uni a1 a2 that accepts language l a l a1 l a2 can be constructed by disjointly unioning the two withstatevariablesbeingmergedandstatesbeingdistinguishedby afreshnewauxiliarybooleanvariable similartothemultiplexed machine in as follows.
tuni vecx vecs vecn vecs prime vecn prime prime t1 vecx angbracketleft vecs2 angbracketrightm vecn1 angbracketleft vecs prime angbracketrightm vecn prime prime t2 vecx vecs2 vecn2 vecs prime vecn prime iuni vecs i1 angbracketleft vecs2 angbracketrightm i2 vecs2 ouni vecs o1 angbracketleft vecs2 angbracketrightm o2 vecs2 where vecs vecs2 vecn vecn1 vecn2 and the bracket angbracketleft vecs2 angbracketrightm indicates taking a subset of the first mvariables of vecs2.
essentially the state variables vecs1ofa1are merged into vecs2so that the first mvariables of vecs2are shared by both a1anda2.
recall the assumption that vecs1 vecs2 .
moreover the bitofthestatevariables vecsdistinguishes the states of a1by and the states of a2by .
that is a stateq belongs to a1if its variable valuates to and to a2 if valuates to .
the corresponding circuit construction is shown in figure .
.
concatenation giventwoautomata a1anda2 thethreecharacteristicfunctionsof theautomaton acat cat a1 a2 thatacceptstheconcatenated authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hung en wang shih yu chen fang yu and jie hong r. jiang figure circuit construction of uni operation.
figure circuit construction of cat operation.
language l a l a1 .l a2 can be constructed as follows.
tcat vecx vecs vecn vecs prime vecn prime prime t1 vecx angbracketleft vecs2 angbracketrightm vecn1 angbracketleft vecs prime angbracketrightm vecn prime vecn2 vecn prime prime t2 vecx vecs2 vecn2 vecs prime vecn prime vecn1 vecn prime vecx prime o1 angbracketleft vecs2 angbracketrightm i2 vecs prime vecn vecn prime icat vecs i1 angbracketleft vecs2 angbracketrightm ocat vecs o2 vecs2 where vecs vecs2 and vecn vecn1 vecn2 .
thecorresponding circuitconstruction is shown in figure .
.
deletion given an automaton aand a symbol the three characteristic functions of the automaton adel del a that accepts the strings in l a with each occurrence of being eliminated fromthem can be constructed as follows.
tdel vecx vecs vecn vecs prime vecn prime t vecx vecs vecn vecs prime vecn prime vecx t vecs vecn vecs prime vecn prime vecx nequal idel vecs i vecs odel vecs o vecs .
.
replacement given three automata a1 a2 anda3 fora2anda3being finite state automata without length tracking with nelementl a2 we construct the automaton arep rep a1 a2 a3 that accepts the language vec 1. vec 1. vec 2. vec 2... vec 1. vec 1. vec 2. vec 2... l a1 vec i nelement .l a2 .
vec i l a2 and vec i l a3 foralli thatis replacingl a2 withl a3 inl a1 .
we extend the construction in based on .
wefirstconstruct a triangleleft 1toacceptstringsin l a1 withanysubstring being flanked by two fresh new symbols triangleleftand as follows.
t triangleleft prime vecx nequal triangleleft vecx nequal t1 vecx vecs1 vecn1 vecs prime vecn prime vecs1 vecs prime vecn1 vecn prime prime vecx triangleleft prime vecx i triangleleft i1 vecs1 o triangleleft o1 vecs1 .
then we construct a4 a finite automaton without length tracking to accept the language vec 1 triangleleft vec 1 vec 2 triangleleft vec 2 ... vec lscript vec i l a2 vec i .l a2 .
.
t4 prime vecx nequal triangleleft vecx nequal th vecx vecsh vecs prime h prime vecx nequal triangleleft vecx nequal t2 vecx angbracketleft vecsh angbracketrightm angbracketleft vecs prime h angbracketrightm prime vecx triangleleft oh vecsh i2 angbracketleft vecs prime h angbracketrightm prime vecx o2 angbracketleft vecsh angbracketrightm ih vecs prime h i4 ih vecsh o4 oh vecsh whereahisanautomatonthatacceptsthelanguage .l a2 .
.
oftena2is known a priori and the complement of .l a2 .
can be done in a preprocessing step.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a symbolic model checking approach to the analysis of ... ase september montpellier france afterbuilding a5 int a triangleleft a4 wecanfinishtheconstruction of the replacement automaton arepas follows.
trep vecx vecs vecn vecs prime vecn prime prime t5 vecx vecs5 vecn5 vecs prime vecn prime prime i3 vecs3 i3 vecs prime prime vecx vecs5 vecs prime vecn5 vecn prime prime i3 vecs3 i3 vecs prime prime vecs5 vecs prime vecn5 vecn prime prime t3 vecx vecs3 vecs prime prime vecx t5 triangleleft vecs5 vecn5 vecs prime vecn prime prime i3 vecs prime o3 vecs3 prime vecx vecy.
t5 vecy vecs5 vecn5 vecs prime vecn prime prime i3 vecs3 i3 vecs prime prime vecx t5 vecs5 vecn5 vecs prime vecn prime prime i3 vecs3 i3 vecs prime irep vecs i5 vecs5 i3 vecs3 orep vecs o5 vecs5 i3 vecs3 where vecs vecs5 vecs3 and vecn vecn5 vecn1.
.
reverse given an automaton a the three characteristic functions of automatonarev rev a that accepts the set of reversed string of vec l a can be constructed as follows.
trev vecx vecs vecn vecs prime vecn prime t vecx vecs prime vecn vecs vecn prime irev vecs o vecs orev vecs i vecs .
.
prefix given an automaton a1 the three characteristic functions of automaton apfxk pfx a1 k that accepts the language l a vec vec .
len vec k can be constructed as follows.
tpfxk vecx vecs vecn vecs prime vecn prime prime t vecx vecs1 vecn1 vecs prime vecn prime vecx nequal k prime k vecx k prime k prime vecx vecs1 vecs prime vecn1 vecn prime k prime k prime vecx vecy.t1 vecy vecs1 vecn1 vecs prime vecn prime k prime k ipfxk vecs i1 vecs1 opfxk vecs o1 vecs1 where vecs vecs1 and vecn vecn1 k .herekisusedtotrack len vec .if thereisanyconstrainton k itshouldbeinthearithmeticconstraintcimposedonthelanguageemptinesscheckingforthesinknode of the dependency graph.
.
suffix given an automaton a1 the three characteristic functions of automaton asfxk sfx a1 k that accepts the language l a vec vec .
vec vec l a1 len vec k can be constructed as follows.
tsfxk vecx vecs vecn vecs prime vecn prime prime vecx vecy.
t vecy vecs1 vecn1 vecs prime vecn prime vecy nequal k prime k vecy k prime k prime vecx vecs1 vecs prime vecn1 vecn prime k prime k prime t1 vecx vecs1 vecn1 vecs prime vecn prime k prime k isfxk vecs i1 vecs1 osfxk vecs o1 vecs1 where vecs vecs1 and vecn vecn1 k .similartotheconstructionof pfx operation ifthereisanyconstrainton k itshouldbeinthearithmeticconstraint cimposedonthe languageemptinesschecking for the sink node of the dependency graph.
.
substring given an automaton a the automaton asubi k sub a i k for i kthat accepts the language containing the set of substrings vec 2 vec 1. vec 2. vec 3 l a vec 1 i and vec 2 k i can be derived by sfx pfx a k i .
.
index tracking givenanautomaton a anon emptystring vec andanintegerparametern1 letatrkidx vec n1 trkidx a vec n1 be an automaton that accepts the language l a .
vec .
with an integer being added to track the position of the first occurrence of substring vec after thekthpositionofeachstringacceptedby atrkidx vec n1.automaton atrkidx vec n1can be constructed as follows.
we first construct a1 cat trklen a a vec wherea and a vec are the automata accepting languages and vec respectively andlettheaddedintegerin trklen a ben2.next weconstruct a3 int a1 a2 wherea2acceptsthelanguage .
vec .
.
.
this construction ensures that no other vec pattern can appear before this vec pattern.
we then build a4 cat a3 a anda5 cat trklen a a4 where the integer added in trklen a isn1.tothisend weknowthat n1 n2 1istheaskedindex since n2counts the number of symbols between the nth 1position and the head of vec .
finally we have atrkidx vec x int a a5 .
.
language emptiness checking given an automaton aand a length constraint cover variables vecn the language emptiness checking procedure isemp a c verifies whether l a is empty subject to the length constraint c. essentially theprocedureperformsreachabilityanalysisoverthe authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hung en wang shih yu chen fang yu and jie hong r. jiang following infinite state transition system tisemp vecx vecs vecn vecs prime vecn prime t vecx vecs vecn vecs prime vecn prime iisemp vecs vecn i vecs vecn vec0 oisemp vecs vecn o vecs c vecn .
we exploit state of the art software model checking algorithms for the computation.
counterexample generation whentheanswertotheisempqueryatthesinknodeofadependencygraphisnegative itoftencorrespondstosomeprogramerror or vulnerability.
tracking the counterexample backward from the sink node to the input nodes of the dependency graph is crucial to validate the system property violation with concrete inputs.
apart from the length encoding our automata construction closelyfollows .thecounterexamplegenerationprocessisalmost the same as except that there are additional satisfying assignments to the length variables.
observe that once a length variable is added to an automaton by operation trklen or trkidx in the dependency graph it will be carried all the way through tothesinkautomaton.thistransparencymakescounterexample generationforthelengthvariablesimmediatefromthesatisfying solution to the final length constraint.
takingautomataconcatenationforexample let acat cat a1 a2 and q1 c1 u1 v1 1 q2 c2 u2 v2 2 ... q lscript c lscript u lscript v lscript be the counterexample run of automaton acat whereqi ci ui vi i and vecs2 vecn1 vecn2 being the state variables of acatas construction in section .
.
then the counterexample runs of a1anda2can be generated by the following rule.
a1 p1 1 ... p1 i a2 p2 i i ... p2 lscript catcexacat p1 1... pi i pi i ... p lscript where each pj qj uj vj for allj i pj qj uj vj for allj i p1 j qj uj andp2 j qj vj for allj and i .
similarly arunofanautomatonbuiltforsomeotheroperationcan bedecomposedintorunsofitsparentautomataforcounterexample backtracking.
experimental evaluation the proposed method was implemented as a tool called slent using ic3ia as the backend symbolic model checker for emptiness checking on string and integer constraints.
to evaluate the effectivenessofourtool slentiscomparedagainststate of the art mixed string and integer constraint solvers including abc cvc4 norn s3p trau and z3str3 .
notethatsincesloth doesnotsupportlengthconstraint solving in the current released version it is excluded from the comparison.ontheotherhand twosetsoftestcaseswereobtained for evaluation including those modified from the kaluza and stranger benchmarks.theexperimentswereconductedona linux machine with intel .
ghz cpu and gb ram.
2in the experiments abc was downloaded on jan cvc4 is version .
nornisversion1.
.
s3pwasdownloadedon09 aug trauwasdownloaded on dec and z3 is version .
.
for z3str3.table solver statistics on kaluza benchmarks.
solver time s sat unsat to abc .
cvc4 .
norn .
s3p .
slent .
trau .
z3str3 .
thefirstexperimentwasconductedon2000testcasesrandomly sampledfromthekaluzabenchmarks whichinvolvestringconcate nationoperationsandlengthconstraints.weexcludedbenchmarks thatcontainanycyclicdependencyamongstringvariablesasnot all solvers handle the cyclicity equally.
the test cases are modified andtranslatedtodependencygraphsasinputtoslent.weensured the solvers work on the same set of string and integer constraints.
a timeout limit of seconds was imposed on each test case.
table1summarizesthe solver performance on the first experiment.
columns solver time s sat unsat and to indicatethesolvername overallruntime excludingtimeoutcases number of reported sat instances number of reported unsat instances and number of timeout instances respectively.
the results suggest that smt based solvers including cvc4 s3p and z3str3 outperformothersolvers includingautomata basedsolversabc and slent and smt and automata mixed solvers norn and trau onthekaluzabenchmarks whichinvolveonlysimplestringmanipulations.slenttimedouton4casesduetotheexpensivereachability analysis on infinite state automata.
the second experiment was conducted on test cases from the stranger benchmarks that involve at least one replace all operation.thetimeoutlimitissetto600secondsforeachtestcase.
the benchmarks were obtained from real web applications such as moodle and php fusion each case originally corresponds to a dependencygraphforareportedvulnerabilitybystranger specifying the flow of string operations on user inputs to a sen sitive function.
among them cases involve string to string but no languageto language replacement and 101cases involve language to language replacement.
because the stranger benchmarks contain no integer constraints to evaluate mixed string and integer constraint solving we added length constraints of the form len x len y squarec where predicate square constant c ycorresponds to the sink automaton and xcorrespondstoanodeinthedependencygraphthatundergoes the largest number of replace all operations to reach the sink node.
the constraint solving hence involves relations between variables beforeandafterreplacementoperationsasspecifiedintheprevious motivatingexample.noticethattheoriginalwebapplicationsofstranger benchmarks may contain length constraints but the lengthconditionsarenotcapturedduetothestringonlycapability of stranger.
in this case adding length constraints back couldreflect even more the real constraint complexity.
we use the followingcodesnippet takenfromexample1of tojustifythe practicality of our manually created length constraints.
var y goog.string.escapestring x authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a symbolic model checking approach to the analysis of ... ase september montpellier france table solver statistics on stranger benchmarks with string to string replacement.
solver time s sat unsat to abort abc .
s3p .
slent26692.
trau .
table solver statistics on stranger benchmarks with language to language replacement.
solvertime s sat unsat to abort abc977.
slent4413.
catelem.innerhtml button onclick createcatlist y x button wherecatelem.innerhtml istheconcatenationofsomeconstants withtwostringvariables xandythathaveareplacerelation.to restrict the size of the hyperlink the length constraint in the form len x len y c as we created in experiments needs to be enforced besides string constraints.
in practice it is common to restrict the size of output string variables in web applications.
for the cases involving string to string but no language tolanguage replace all operations we compare slent against other solvers including abc s3p and trau capable of solving such constraints.
equivalent constraint formulas in the smt format are generatedfromdependencygraphsastestcases forthesesolvers.
as noted in section there is a difference of the replace all operationdefinitionamongthesolvers.boths3pandtraufollowthe replace all first definition whereas both abc and slent follow thereplace all anydefinition.thedifferenceoccurswhenthereplacement candidates overlap.
taking the string aaa for example supposethepattern aa istobereplacedwith b .therearetwo replacement candidates underlined in aaa and aaa which overlap in the second position.
as a result s3p and trau produce ba asasolution whereasabcandslentproduce ba and ab asa solution.nevertheless inthestrangerbenchmarks allthepatterns to be replaced are of the form such as and .gif thatexcludesoverlappedreplacementcandidates.undersuchcircumstances all the solvers should have the same interpretationof the replace all operation.
therefore the experiment is fair for comparison.
table2showsthestatisticsofsolverperformanceonthecases involving string to string replace all operation and length constraints.thenumbersoffalsealarmsofeachsolverareshownin theparenthesesintheentriesofcolumns sat and unsat.
theinconsistentanswersamongthesolverswerecarefullyexamined and verified.
solvers abc s3p and trau aborted on and38 cases produced and 2false positivesamongthe sat cases and produced and false negatives among the unsat cases respectively.incontrast slenttooklongertime butmanagedtosolvemoreinstancesthantheothersolversandraisedno falsealarms.theexperimentalresultssuggestthatslentisreliableandrobustinsolvingcomplexmixedstringandintegerconstraints.for the cases involving language to language replace all operations wecompareslentandabc theonlytwosolverscapable ofsolvingsuchconstraints.table 3showstheresultsoncasesinvolving language to language replacement with length constraints.
slent managed tosolve 82out of101 instances withoutany false alarms whereas abc aborted on cases and produced false positives.
among the timeout cases slent was able to solve of them under an extended time limit of seconds.
the experimental results reconfirm the reliability and robustness of slent in solving complex mixed string and integer constraints.
related work string analysis has been studied extensively in recent years dueto itsimportance to detect string manipulationerrorsin modern software such as sql xss vulnerabilities in web applications.
we review prior work that supports mixed string constraint solving with length constraints involved.
there have been significant efforts on developing inference rule basedsolvers suchasnorn cvc4 z3str3 ands3p .
these smt based solvers use predefined inference rules and search on the derivation tree for a solution.
cvc4 i sa ns m t solverthatsupportssolvingconstraintswithdifferenttheories.it is equipped with derivation rules that combine both string and integers to facilitate the ability of solving mixed string constraints.
norn solvesmixedstringconstraintsbyfirstbranchingsearch in the derivation tree and then solving related integer constraints beforeguessingstringsolutionsforeachbranch.z3str3 the successor of z3str and z3str2 solvesmixed stringconstraints by leveraging interactions of different theory solvers in z3 witheffectiveheuristics.onerestrictionoftheaboveinference rule based solvers is to reason theories of complex string manipulations such as the operation of replace all.
among these rule based solvers z3str3andcvc4supportonlythereplacementofthefirstoccurrence.norndoesnotsupportreplacement.s3p thesuccessor of s3 is currently the only one that supports all string replacement with recurrence of string operations.
it utilizes evaluation on node solution size in the derivation tree to find a minimal solution for a satisfiable formula which avoids unnecessary derivations on branches.
a recent work targets on extending existing rulebasedsolverstosupportmorecomplicatedstringconstraintsand avoidsthedifficultiesinmodifyingthesearchstrategytocopewith new rules.
the proposed search driven method first constructsautomata to restrict solution space of each variable by applying automata basedsolversonpartofthesupportedconstraints then searches for complete solutions with ant colony optimization.
different from rule based solvers automata based string constraintsolversuseautomatatocharacterizepossiblesolutionsof a string constraint.
string operations that can be handled with automata constructions such as replace all can be natively handledbyautomata basedstringconstraintsolvers.however using finite stateautomata thesolverssufferfromapproximation inexactnessinageneralsetting.sincethesolutionsetofasetofconstraints may not be a regular language under over approximations have tobe appliedto havethe solution setrepresented withfinite automata.
in the tool abc finite state automata are constructed to characterize the solution set of each string variable and authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hung en wang shih yu chen fang yu and jie hong r. jiang aniterativerefineprocessisappliedtostrengthenapproximation.
in the recent update of abc multi track automata are used to model relations among string variables.
in contrast we overcome the limitation of automata based string constraint solving using infinite state automata.
essentially we encode unbounded length within string automata and leverage symbolic model checking techniques to resolve emptiness checking of these infinite state automata.
our method can precisely represent a large variety of constraintsetsusinglength encodedautomata.forexample the context sensitive language anbmcndm can be represented under our framework.
in the work a new tool trau is introduced which is based on a counter example guided abstract refinement cegar framework andusingflatautomataforconstraintrefinement.theframeworkalternatesbetweensolvingunder andover approximation of constraints which are refined during the process in order tofind a non spurious solution.
since the framework adopts underand over approximations a wide variety of constraint set can be supportedincludingtransducersandconstraintsaboutmembership in context free grammar.
in recent work the tool sloth solves string constraints by constructing alternating finite automata afa and introduce synchronizeparameterstosplitautomatathroughconcatenation.
comparedtotheirwork ourlength encodedautomataprecisely representtheconstraintsetbeyondregularapproximationswith lengthinformationbeingwellkeptintheautomatastructure.for example a simple instancethat is solvableby slent but notsloth isx2 replace x1 r1 r2 len x2 len x1 for some regular expressions r1andr2.
we note that the supported string logic fragments of and slent are incomparable.
that is no one strictly contains the other.
for example our method supp orts the reverse operation which is clearlynot arationalrelation andhasnotbe discussedin .
moreover beyondthe sleclassof weallowastringvariableto appearonthelefthandsidesofstringequationsmultipletimes.on theotherhand welimitastringvariabletoappearontherighthand sides of string equations at most once.
although characterizing the string logic fragment that slent corresponds to is out of the main focus of this paper it is an interesting question we planned to address in the future.
there are different ways to count string lengths e.g.
in an explicit counter is used for proving complexity arguments.
in this work we implicitly represent a counter byembeddingit into a transition relation and utilize it for formula construction targeting practical applications.
for the replace all operation we adopt the notion in .
while and are similar in using markers for constructions the replace all definitions are different.
unlike the ones defined in requiring each match to be leftmost the one in does not have the restriction.
in emptinesscheckingofintersectionsoffiniteautomatais considered.
however it does not support string operations.
conclusions wepresentanoveltechniquebasedonlength encodedautomata for solving string and integer constraints.
our solver slent is particularlysuitableforsolvingcomplexstringandintegerconstraints.
as slent precisely maintains the relation among string and length variables noapproximationisrequiredforconstraintsolvingunlikeotherexistingautomata basedmethods.theexperimentshows theuniquebenefitoftheproposedmethodonsolvingconstraints withreplace alloperationoverstringvariablesandwithcomplex length relation.
as slent relies on off the shelf model checkers it benefitsfrommodelcheckeradvancements.itsperformanceand practicalitymaybeimprovedovertime.forfuturework weplan to extend the proposed method to solve more complex constraints involving cyclic dependencies among string variables.