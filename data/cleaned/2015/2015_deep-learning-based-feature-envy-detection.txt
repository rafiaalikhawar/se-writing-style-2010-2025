deep learning based feature envy detection hui liu school of computer science and technology beijing institute of technology beijing china liuhui08 bit.edu.cnzhifeng xu school of computer science and technology beijing institute of technology beijing china qq.comyanzhen zou key laboratory of high confidence software technologies peking university ministry of education beijing china zouyz pku.edu.cn abstract software refactoring is widely employe d to improve software quality.akeystepinsoftwarerefactoringistoidentifywhichpartof thesoftwareshouldberefactored.tofacilitatetheidentification a number of approaches have been proposed to identify certain structures in the code called code smells that suggest the possibility of refactoring.
most of such approaches rely on manually designedheuristicstomapmanuallyselectedsourcecodemetrics to predictions.
however it is challenging to manually select the best features especially textual features.
it is also difficult to manually construct the optimal heuristics.
to this end in this paper we propose a deep learning based novel approach to detecting feature envy one of the most common code smells.
the key insight is that deep neural networks and advanced deep learning techniques couldautomaticallyselectfeatures especiallytextualfeatures of source code for feature envy detection and could automatically build the complex mapping between such features and predictions.
wealsoproposeanautomaticapproachtogeneratinglabeledtraining data for the neural network based classifier which does not requireanyhumanintervention.evaluationresultsonopen source applicationssuggestthattheproposedapproachsignificantlyimproves the state of the art in both detecting feature envy smells and recommending destinations for identified smelly methods.
ccs concepts softwareanditsengineering softwaremaintenancetools object oriented development keywords feature envy deep learning software refactoring code smells acm reference format hui liu zhifeng xu and yanzhen zou.
.
deep learning based feature envy detection.
in proceedings of the 33rd acm ieee international corresponding author also with school of electronics engineering and computer science peking university.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe firstpage.copyrights forcomponentsof thisworkowned byothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
ase september montpellier france copyright held by the owner author s .
publication rights licensed to acm.
acm isbn ... .
on automated software engineering ase september montpellier france.
acm newyork ny usa 12pages.
org .
.
introduction software refactoring is widely employed t o improve software quality by restructuring its internal structures whereas its external behaviorsarekeptunchanged .mostofthemodernides provide tool support for software refactoring.
for example eclipse has a top level menu specially designed for software refactoring.
themenuprovidesentriestomostofthepopularsoftwarerefactorings investigated by the research community .
a key step in softwarerefactoring is to identify where refactorings should be applied .
to facilitate the identification beck andfowler proposetheconceptof codesmells thatare certain structures in the code that suggest sometimes they scream for the possibilityofrefactoring .theyintroduce22typesofcodesmells includingthewell known featureenvy andlargeclass.theyalsoanalyze their features as well as their impact and potential solutions refactorings .
however it is tedious and time consuming to manually identify codesmells especiallywhensuchcodesmellsinvolvemorethan one file or package .
consequently a large number of automatic or semi automatic approaches have been proposed to detect differentkindsofcodesmells .detailedliteraturereview and analysis on code smell detection have been made by zhang et al.
dallal andmorerecentlybysharmaandspinellis .
most of the existing code smell detection approaches rely on manually designed heuristics to map manually defined selected code metrics into binary predictions i.e.
smelly or non smelly .
however i t is challenging to manually select the best features especially textual features.
it is also difficult to manuallyconstructtheoptimalheuristics.analysisresultsonsuchapproaches alsosuggestthatdifferentpeoplemayselect different metrics and different heuristics for the same code smells which results in low agreement between different detectors .
to avoid manually designed heuristics statistical machine learning techniques like svm naive bayes and lda are employed to buildthecomplexmappingbetweencodemetrics aswellaslexical similarity andpredictions .however empiricalstudies suggestthatsuchstatisticalmachinelearningbasedsmelldetection approaches have critical limitations that deserve further research.
tothisend inthispaperweproposeadeeplearningbasedapproach to detecting feature envy one of the most common code smells.
the key insight is that deep neural networks and advanced deep learning techniques could automatically select useful features authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hui liu zhifeng xu and yanzhen zou from source code especially textual features for code smell detection and build the complex mapping between such features and the labels smelly or not .
deep neural networks and advanced deep learning techniques have been proved to be good at selecting usefulfeaturesandbuildingcomplexmappingfrominputtooutput automatically .
with significant advances in deep learning techniques they have been successfully used in different domains e.g.
natural language processing nlp video processing speech recognition and software engineering .
that is the reasonwhyweemploydeeplearningtechniquesinthispaperto build a neural network based classifier that classifies methods in subject applications into smelly and non smelly .
to train the neural network based classifier we also propose an automatic approach to generating labeled training data without any human intervention.
one of the biggest challenges for machinelearning especiallydeeplearning basedsmelldetectorsis to collect a large number of labeled samples to train the classifiers detectors .
to collect labeled training data existing approaches often rely heavily on manual checking of the initial detection results of similar smell detectors .
however manual checking is time consuming which significantly limits the size of labeled training data and thus prevents machine learning techniques from reaching their maximal potential.
to this end in this paper we generatelabeledsamplesautomaticallybasedonopen sourceapplications.
we generate negative samples by extracting methods and their context directly from high quality open source applications assuming that such methods are correctly placed in the originalprograms.togeneratepositivesamples wemovemethods randomlytootherclasseswhereitcouldbemovedbyrefactoring tools.
after the movement such methods together with their new context aretakenassmellymethods with featureenvy .wecan generate alarge number ofsuch labeled training databecause the generation is fully automatic.
the large data in turn serve as the basis of machine learning based smell detection.
the evaluation of the proposed approach is composed of two parts.
in the first part we evaluate it on well known open source applications with automatically injected feature envy smells.
evaluation results suggest that the proposed approach significantly outperforms existing approaches.
it improves f measure by .
.
in the second part we evaluate it on open source applications wherenosmellsareinjected.evaluationresultsalsosuggestthat the proposed approach significantly improves the state of the art.
the paper makes the following contributions a deep learning based approach to identifying feature envy.
to the best of our knowledge we are the first to apply deep learning techniques to feature envy detection.
anautomaticapproachtogeneratinglabeledtrainingdata for feature envy detection.
evaluation of the proposed approach whose results suggest that the proposed approach can significantly improve the state of the art.
therestofthepaperisstructuredasfollows.section 2introduces related research.
section 3proposes the approach.
section 4and section5presenttheevaluationoftheproposedapproach.section discusses related issues.
section 7makes conclusions.
related work .
feature envy beckandfowler proposetheconceptof featureenvy toindicate such methods that are more interested in a class other than the one it actually is in .
to improve software quality and to easy software maintenance such misplaced methods should be moved to classes by move method refactoring that they are really interested in.
a number of approaches have been proposed to identify feature envy or move method opportunities .
the first one was proposed by simon et al.
in .
they define a distance to measure how closely two entities are related distance e1 e2 p e1 p e2 p e1 p e2 wheree1ande2are two software entities and p e is the set of properties that are possessed by e.i feis a method p e includese itself allmethodsthataredirectlyinvokedby e andallattributes that are directly accessed by e.i feis an attribute p e includese itself andallmethodsthatdirectlyaccess e.baseonthedistance metrics simonetal.drawentitiesonagraph andthegeometric distances between entities correspond to the distance calculated by formula .
if a method is closer to entities of another class than those of its enclosing class it is associated with feature envy.
sengetal.
proposeasearchbasedapproachtoidentifymove method opportunities.
they define a fitness function fitness s n summationdisplay.
i 1wi mi s minit i s mmax i s minit i s wheresis the application to be refactored m s is a vector composed of seven metrics weighted method count response for class information flow basedcoupling tightclasscohesion informationflow base cohesion lack of cohesion and stability.
minit i s is the initial value of the metrics and mmax i s is the maximal values obtained by a calibration run optimizing each metric alone beforehand.theyemployasearchalgorithmtofindouttheoptimalclass structure aswellasasequenceofmovemethodrefactoringsthat turn the current system into the optimal one.
this approach is the firstsearch basedapproachtoidentifyingmovemethodrefactoring opportunities.
tsantalisandchatzigeorgiou proposeametricsbasedapproachtoidentifyfeatureenvyandmovemethodopportunities.for each entity e attribute or method they collect a set of the entities notedas se thatitaccesses ifitisamethod oritisaccessedfrom if it is an attribute .
they also define the distance between method mand class c.i fmdoes not belong to c the distance is computed as follows distance m c sm sc sm sc where sc uniondisplay.
ei c ei otherwise the distance is computed as follows distance m c sm s prime c sm s prime c where s prime c sc m basedonthisdistancemetrics theysuggesttomovemethod eto classctar etif ctar ethas the shortest distance to eand the movement satisfies some preconditions that ensure the movement will not change the external behaviors of the involved application.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
deep learning based feature envy detection ase september montpellier france thedistanceisdifferentfromthatdefinedbysimonetal.
.the lattermeasuresthedistancebetweentwomethods orattributes whereas theformer measuresthe distancebetween a methodand a class.
this approach has been implemented by jdeodorant a well known powerful andopen sourcecodesmelldetectiontool.
jdeodorant isthemostcommonlyusedbenchmarkincodesmell detection research community.
sales et al.
propose a dependency based approach called jmove toidentifyfeatureenvy.theydefineametricstomeasure the similarity of the dependencies established by a source method withthedependenciesestablishedbythemethodsinpossibletarget classes.basedonthismetrics theyrepresentthesimilaritybetween methodmand class cas the average similarity between mand methods in c. they suggest to move method mto classcifchas the greatest similarity with m. their evaluation results suggest thatjmoveishighlyaccurateanditoutperformsthewell known jdeodorant in identifying feature envy.
bavota et al.
exploit textual information in feature envy detection.theyrecommendmovemethodopportunitiesviarelational topic models rtm a statistical mode.
this model is employed to computetherelationshipamongmethodsaccordingtostructural similarity between methods as well as textual information e.g.
identifier names and comments extracted from the source code.
it isthe firstapproachtoidentify movemethodopportunitiesbased on textual information besides source code structures.
palomba et al.
also exploit textual information to detect code smells including feature envy.
if a method is lexically more similar to another class than its enclosing class they suggest that the method is associated with feature envy.
palomba et al.
propose a change based approach to identifyfeatureenvy.theyassumethatamethodaffectedbyfeature envy changes more often with the envied class than with the class whereitisdefined.consequently ifamethod misinvolvedincommits with methods of another class ctar et significantly more often than methods of its enclosing class they suggests to move mtoctar et.
they are the first to identify feature envy by mining version histories of source code.
liu et al.
propose a novel approach to recommend move method opportunities based on conducted refactorings.
once a methodmis moved from class csourceto another class ctar et theapproachchecksothermethodswithin csource andsuggests to move the method who has the greatest similarity and strongest relationship with m. the rational is that similar and closely related methodsshouldbemovedtogether.theyarethefirsttoidentify move method opportunities based on refactoring history.
the proposed approach differs from such approaches in that it exploits deep learning techniques and generates training dataautomatically.
the proposed approach is the first one to detect feature envy with deep learning techniques.
.
machine learning based smell detection withtheadvanceinmachinelearningtechniques anumberofmachine learning based smell detection approaches are proposed .
kreimer proposesadecisiontreebasedapproachtoidentify code smells e.g long method andlarge class.
vaucher et al.
apply bayesian beliefs networks to detect god class blob figure overview of the proposed approach class .maigaetal.
exploitsupportvectormachine svm in detection of blob class and the same technology is employed byamorimetal.
todetect blobclass longparameterlist long method and feature envy.
fontana et al.
compare different machine learning techniques including j48 jrip erandom forest baive bayes smo and libsvm in predicting the severity of code smells e.g.
god class data class long method and feature envy.
suchmachinelearningbasedapproacheshaveprovedtobeeffectiveandefficientalthoughsomeexperimentalevaluationalso revealstheirsignificantlimitations .theproposedapproachdiffersfromsuchapproachesintheflowingaspects.first theproposed approachexploitsdeeplearningwhereastheyexploittraditional statisticalmachinelearningtechniques.second theproposedapproach generates training data automatically whereas they collect training data manually with the help of smell detection tools.
approach in this section we propose a deep learning based approach to identify feature envy.
an overview of the proposed approach is presentedinsection .
anddetailsarepresentedintherestofthis section.
.
overview fig.1presents the overview of the proposed approach.
based on a large corpus of software applications it generates a huge number of training samples i.e.
methods with or without feature envy .
such training samples are employed to train a neural network based classifier whose output indicates whether the input methodmfromclass ecenviesanotherclass tc.atpredictionphase for a given method mwe select a set of potential target classes tc c1 c2... ck and predict with the resulting neural network whethermshouldbemovedtoanyofthem.detailsoftheproposed approach are presented in the following sections.
.
input to decide wether a given method mshould be moved from its enclosing class ecto another class tc we exploit both structural information codemetrics andtextualinformation.concerningthe structural information we reuse the distance metrics as presented informula 3andformula proposedbytsantalisandchatzigeorgiou .
we reuse such metrics because of the following reasons first they have been proved effective in feature envy detection .
second theopen sourceimplementationof jdeodorant makes it easy to extract such metrics.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hui liu zhifeng xu and yanzhen zou figure model of word2vector besides the metrics we also exploit textual information includingthenameofthemethodtobeinvestigated thenameofitsenclosing class and the name of its potential target class.
the essence of featureenvyisthat somemethods are misplaced.ideally a method should be declared within the class whose role should have the behavior of the method.
we may identify whether a given method should be declared within a given class by investigating the semantical relationship between their identifiers because meaningful identifierscanrevealtheroles behaviorsoftherelatedentities .
as a conclusion the input of the approach is a quintuple input name m name ec name tc dist m ec dist m tc wherename e is the identifier method name or class name of software entity e.mis the method under investigation ecis the enclosingclassof m andtcisthepotentialtargetclass.
dist m c is the distance between method mand class ccomputed according to formula 3or formula .
however it is challenging to recover automatically the semantical relationship embedded in method names and class names.
lexicalsimilarityaloneisofteninsufficientinmeasuringthesemantical relationshipbetweensoftwareentities.forexample lexicallydissimilar software entities e.g.
collectcandidates andrecommendersystem couldbecloselyrelatedinsemantics.consequently tofully exploitthesemanticsembeddedinnaturallanguages weshould employ some advanced technologies e.g.
deep learning to extract moreusefulfeaturesfromsuchtextualinput.besidesthat itisalso challengingtoquantitativelyrelatetextualfeaturestonumerical feature codemetrics withhandcraftedheuristics.theproposed approach handles these challenging issues in following sections.
.
representation of identifiers to feed the identifiers described in nature languages into neural networks we convert words in identifiers into fixed length numerical vectors.
the conversion is accomplished by the wellknownword2vector continuousskipgram proposedbymikolov et al.
.word2vector has been proved efficient for learning high qualitydistributedvectorrepresentationsthatcaptureprecise syntactic and semantic word relationships .word2vector is essentiallyaneuralnetworkthatpredictsnearbywords i.e.
words before and after it as shown in fig .
once the network is trained figure neural network based classifier we can exploit the hidden layer a byproduct of the training to convert words into numerical vectors.
for a given identifier method name or class name we partition it into a sequence of words according to capital letters and underscores and convert each word into a fixed length numerical vector name e w1 w2 ... wk v w1 v w2 ... v wk name e istheidentiferofsoftwareentity e and w1 w2... wk is a sequence of words.
v wi converts word wiinto a fixed length dimensions numerical vector with word2vector.
tofacilitatethedesignofneuralnetworks welimitthelength of word sequence for each identifier to five.
our analysis results on open source applications as introduced in table suggest that .
oftheinvolvedidentifierscontainnomore than five words.
if an identifier contains more than five words weextractthefirstfivewordsonly.incontrast ifitcontainsless thanfivewords weappendspecialcharacters whosevectorsare composed of zeros only to the sequence.
.
deep neural network based classifier the structure of the deep neural network based classifier is presentedinfig.
3andsourcecodeisavailableonline .itsinput is divided into two parts textual input and numerical input.
thetextual input is a word sequence by concatenating the name ofthe method the name of its enclosing class and the name of the potentialtargetclass.itisfedintoanembeddinglayerthatconvertstextdescriptionintonumericalvectorsasintroducedinsection .
.
such numerical vectorsare in turn fed into aconvolutional neural network cnn .
in total we have tree cnn layers whose setting is asfollows filters kernel size 1andactivation tanh.
we exploit cnn because of the following reasons.
first significantadvancesincnnhavebeenachievedrecently whichmakes cnn effective in increasing the capacity and flexibility of machine learning .
powerful cnn layers may learn the deep semantical relationship among the identifiers and thus may reveal where the methodshouldbeplaced.second cnniswell suitedforparallel computation on modern powerful gpu and thus can significantly reducetrainingtime .theoutputofcnnisforwardedtoa flattenlayer which turns its input into a one dimensional vector.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
deep learning based feature envy detection ase september montpellier france the numerical input i.e.
dist m ec anddist m tc is fed directly into another cnn whose output is forwarded to a flatten layer.
this cnn shares the same setting with the previous cnn introduced in the preceding paragraph.
notable we have experimentally tried to replace this cnn with other types of neural network layers e.g.
dense layer but we fail to improve the per formance with the replacement for space limitation details are presentedat .thetextualinputandthenumericalinputare finally merged by the mergelayer which simply concatenates alistofinputs i.e.
theaforementionedtextualandnumericalinputs .
the following denselayer neurons and outputlayer neurons mapthetextualinputandnumericalinputintoasingle output prediction thatindicateswhether mshouldbemovedto the target class tc.
the model employs binary crossentropy as the loss function.
.
generation of training data deep neural networks have a large number of parameters.
con sequently they often require a large number of training data toadjust such parameters.
to train the deep neural network proposed in section .
we generate training data as follows.
first we downloadwell knownandhighqualityopen sourceapplications.
second for each method mfrom such applications we generate alabeledtrainingsampleasfollows.
wetestwhether mcould be moved to other classes with move method refactoring.
the test is accomplished with the apis provided by eclipse jdt.
sup pose that method mcould be moved to a set of classes noted as ptc tc1 tc2 ... tck .ifptcisempty i.e.
themethodcouldnot be moved we discard it and turn to the next method.
otherwise we turn to the next step to generate a labeled training item.
we randomly fifty fifty chance decide to generate a positive trainingitem with feature envy or a negative item without feature envy .
wegenerateanegativeitemasfollows.first werandomly selectapotentialtargetclass tcifromptc.second wecomputethe distancedist m ec anddist m tci whereecistheenclosingclass ofm.
third we create a negative item n item and add it to the training data set n item input output input name m name ec name tci dist m ec dist m tci output we generate a positive item as follows.
first we randomly select a potential target class tcifromptc.
second we move m from its enclosing class ectotciby eclipse apis.
third we createapositiveitemwhoseinputis name m name tci name ec dist m tci dist m ec andoutputis1.notablythedistancesare computed after the method is moved.
the generation is based on the assumption that all involved methods are correctly placed in the original applications.
conse quently the original methods if not moved should be taken as non smelly withoutfeatureenvy .incontrast iftheyaremoved insomewaybymovemethodrefactorings theyshouldbetaken as smelly with feature envy after the movement.
however the assumption may not hold in some cases i.e.
some methods in the subject applications may have been placed improperly.
as a result thetrainingdatageneratedbasedonsuchmethodsmaybenoisy someofthemarelabeledincorrectly.theimpactofsuchnoisydata could be reduced in two ways.
first we only select high qualitysubject applications for data generation.
within such high quality applications it is likely that most of the methods are placed correctly.asaresult mostofthetrainingitemscouldbelabeled correctly.second advancedneuralnetworkslikecnnworkwell even if the training data contain a few mislabeled items .
.
feature envy detection .
.
binary classification.
foragivenmethod mtobeinvestigated we predictwhether it is smellyor non smelly as follows.first we collect all of its potential target classes noted as ptc tc1 tc2 ... tck witheclipsejdt.if ptcisempty i.e.
themethod couldnotbemoved misnotsmelly.otherwise wegenerateatestingitem asshowninformula foreachofthepotentialclasses notedastci inputi name m name ec name tci dist m ec dist m tci whereecistheenclosingclassofmethod m.w efeed such items into the trained deep neural network.
if all of such items are predicted as negative non smelly we say that the given methodmisnotassociatedwithfeatureenvy.otherwise wesay that it is smelly associated with feature envy .
.
.
recommendation of refactoring solutions.
for methods that are predicted as smelly with feature envy we should suggest wheresuchmethodsshouldbemovedviamovemethodrefactorings.ifonlyone notedas inputj ofthetestingitemsgeneratedfor mis predicted as positive we suggest to move mto the target class tcj that is associated with the positive testing item inputj.
if more than one testing items are predicted as positive we selecttheone notedas inputi withthegreatestoutput andsuggest to move method mto classtcithat is associated with inputi.
although the neural network proposed in section .4is trained as a binary classifier aiming to minimize the likelihood of mis classification instead of the mean squared error the output of the neural network is a decimal varying from zero to one.
the neuralnetworkinterpretsthepredictionaspositiveifandonlyif the output is greater than .
.
for the given input input name m name ec name tci dist m ec dist m tci thegreater the output is the more likely that the mshould be moved to the target class tci.
evaluation in this section we evaluate the proposed approach on seven opensource applications with injected feature envy smells.
.
research questions the evaluation investigates the following research questions rq1 does the proposed approach outperform the state ofthe art approaches in identifying feature envy?
rq2 istheproposedapproachaccurateinrecommending destinations target classes for methods associated with feature envy?
rq3 how efficient is the proposed approach?
how long does it take to train the neural network based classifier and how long does it take to make predictions?
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hui liu zhifeng xu and yanzhen zou research question rq1investigates the performance e.g.
precisionandrecall oftheproposedapproachinidentifyingfeatureenvy smellscomparedagainstthestate of the artapproaches.toanswer this question we compare the proposed approach against jdeodorant andjmove .
they are selected for comparison because ofthefollowingreasons.first theyrepresentthestate of the art.
jdeodorant has been widely employed as a benchmark whereasjmoveis one of the latest advances in this area.
second theyarepubliclyavailable.althoughsomerelatedapproacheshave been reported recently their implementations are not available which makes it difficult to compare the proposed approach against such approaches.
research question rq2concerns how accurate the proposed approach isin recommending where thesmelly methods should be moved.
the ultimate goal of code smell detection is not to find out code smells but to remove such smells by software refactoringsand thus to improve software quality.
consequently it is critical fortheproposedapproachtosuggestcorrectlytowhichclassesthe misplaced methods should be moved.
researchquestion q3concernsthetimecomplexity oftheproposed approach.
deep learning based approaches often take a long timetotraindeepneuralnetworks.however theyusuallyresponse instantly for a given input once the neural networks are trained in advance.
answering this question would reveal quantitatively the training and predicting time of the proposed approach.
.
subject applications we evaluate the proposed approach on seven open source applications as introduced in table .
although the proposed approach is generic and should be able to work for different object oriented programming languages its prototype implementation is confined tojavaonly.consequently weselectjavaapplicationsonly.the columns from left to right present the application name version num of classes noc number of methods nom and lines of source code loc respectively.
junit is a widely used testing framework.
during the last years ithasreleasedmorethan40versions.
pmd isanextensible cross languagestaticcodeanalyzerthatiswidelyusedtofindcommonprogrammingflaws.duringthelast14years ithasevolved extensivelyandreleasedmorethan100versions.
jexcelapi is anopen sourcejavaapithatfacilitatesdeveloperstoread writeor modifyexcelspreadsheets dynamically.
the evolution lasted more than years and versions have been released.
areca i sa n open source application for file backup supporting incremental backuponlocaldrivesorftpservers.theevolutionlastedmore than years and versions have been released.
freeplane i sa free mind mapping and knowledge management software.
during thelast18years ithasreleasedmorethan100versions.
jedit is a free text editor.
during the last years it has released versions.
weka isaset ofwell knownmachinelearningalgorithms developed by the machine learning group at the university ofwaikato.theevolutionlastedmorethan18years andmorethan versions have been released.
these subject applications are selected because of the following reasons.first allofthemareopen sourceapplicationswhosesource code is publicly available.
selecting such open source applicationstable subject applications applications domain version nocnom loc junit unit testing .
pmd static code analysis5.
.
jexcelapi excel api .
.
areca document backup7.
.
freeplane knowledge management1.
.
jedit text editor .
.
weka machine learning3.
.
facilitates other researchers to repeat the evaluation.
second all of themarewell known popularandofhighquality.allofthemhave involved successfully for a long time more than years which usually depends on high quality of the maintained projects.
we also manually checked candidate projects to make sure that the selectedprojectsareofhighquality.asintroducedinsection .
the generation of training data is based on the assumption that methodsin subjectapplicationsare correctlyplaced.consequently selecting such high quality applications may reduce the likelihood that methods in such applications are misplaced.
notable the average lcm lack of cohesion of methods of such projects is smaller than .
the average efferent coupling is smaller than and the averageafferentcouplingissmallerthan30.allofthesetogether may suggest that most methods have benn placed correctly.
third theseapplicationsweredevelopedbydifferentdevelopers which may reduce the bias introduced by specific developers.
.
process we carry out a k fold k cross validation on the seven subject applicationspresentedintable .oneachfold asingleapplication is used as the testing subject noted as testingapp whereas the othersareusedastrainingsubjects notedas trainingapps .each of the subject applications is used as the testing subject for once.
each fold of the evaluation follows the following process first we generate a training data set trainin data based on trainingapps as specified in section .
.
second we train the proposed approach with trainingdata .
third from the testing subject testingapp we identify all methods noted as ms that could be moved between classes viajdk move method api.
fourth from mswe randomly sample of the methods and note them as ms1.
the rest is noted as ms2 and thus we havems ms1 uniontext.1ms2.
fifth for each method minms1 we randomly move it to oneofitspotentialtargetclasses i.e.
injectingsmellsinto testingapp .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
deep learning based feature envy detection ase september montpellier france sixth after the movement we apply the proposed approach jdeodorant and jmoveto the testing subject independently.
a predicted positive is a true positive if and only if the reported method mhas been moved before i.e.
m ms1 .
methods may be unmovable because of differen reasons .
forexample movingoverridden overridingmethodsoftenleadsto syntaxerrors.anotherexampleisthatmovingmethod mtoanother class that is not related to its enclosing class in any way may break thelinks e.g.
methodinvocation between mandmembersofits enclosing class.
such unmovable methods could not serve as move method opportunities.
smell detection tools can also exclude such methods by static analysis or simply by existing jdt apis.
consequently duringtheevaluationwedonotgeneratetestingitems basedonsuchmethods.instead wegeneratetestingitemsbased onmovablemethodsonly althoughanalysisonthesubjectapplications introduced in table 1suggests that only of the methods could be moved.
wealsonoticethatexperimentalstudyconductedbypalomba et al.
suggest that around .
of methods are associated with feature envy and should be resolved by move method refactorings.
consequently from the movable methods we randomly select of them to construct positive testing items.
as a result the smelly methodsaccountforaround2.
ofallmethods includingunmovableones whichisconsistentwiththefindingreported by palomba et al.
.
after the evaluation we calculate the precision recall and f1of the proposed approach jdeodorant andjmoveas well in identifying feature envy smells as follows precision truepositives truepositives falsene atives recall truepositives ms1 f1 precision recall precision recall theaccuracyoftheapproachesinrecommendingdestinations for smelly methods is computed as follows ac correct recommendation for true positives truepositives the recommended destination for method mis correct if and only if it suggests to move mback to its enclosing class before it is moved.notably recommendeddestinationsforfalsepositivesare notcountedinwhilecomputingtheaccuracybecauseonlyifdevelopers confirm that the detected method should be moved i.e.
it is a true positive they should consider the destination problem.
.
rq1 detection of feature envy to answer research question rq1we compare the proposed approach against jdeodorant andjmovein detecting feature envy smells.
evaluation results are presented in table .
the first column presentsthe subjectapplications.
columns2 presents the precision recall and f measure of the proposed approach respectively.theperformanceof jdeodorant andjmoveispresentedin columns and columns respectively.
the last row of the tablepresentstheaverageperformanceoftheinvolvedapproaches.
from table 2we make the following observations first theproposedapproachsignificantlyoutperformsthe state of the art as f measure is concerned.
its average fmeasureis52.
whereastheaveragef measureof jdeodorantandjmoveis .
and .
respectively.
compared tojdeodorant andjmove the proposed approach improves f measure by .
.
.
and .
.
.
respectively.
second the proposed approach can identify most of the featureenvysmells.itsaveragerecallisupto79.
.compared tojdeodorant andjmove it improves recall dramatically by .
.
.
and .
.
.
respectively.
third the precision .
of the proposed approach isslightly greater than that .
of jdeodorant and it is significantly greater than that .
of jmove.
we evaluate how the textualinput and code metrics contribute tothe proposedmodelbyremovingthem respectively.evaluation resultssuggestthatremovingthetextualinputsignificantlyreduces recall of the approach from .
to .
and removing the code metrics reduces precision significantly from .
to .
.
weconcludefromtheseresultsintheprecedingparagraphsthat theproposedapproachoutperformsthestate of the artapproaches significantly in detecting feature envy smells.
.
rq2 recommendation of destinations methodsassociatedwithfeatureenvysmellsshouldberelocated.
however before such methods could be relocated we have tochoose their target classes destinations .
the accuracy of the involvedapproachesinrecommendingthetargetclassesispresented intable3.eachrowofthetablepresentstheiraccuracyonasubject application except the last row that presents the average accuracy on all subject applications.
from table we make the following observations first theproposedapproachisaccurateinrecommending destinations for smelly methods.
its accuracy varies from .
to80.
.onaverage itsaccuracyisupto74.
.inotherwords forthreeoutoffourtruepositives i.e.
methods that should be moved the proposed approach can predict correctly to which classes the methods should be moved.
second theproposedapproachismoreaccuratethan jdeodorantandjmovein recommending destinations for smelly methods.comparedto jdeodorant andjmove itimproves theaccuracyby27.
.
.
and46.
.
.
respectively.
we conclude from these results that the proposed approach is accuratein recommendingdestinations forfeature envymethods and it improves the state of the art significantly.
.
rq3 efficiency of the proposed approach to investigate the efficiency time complexity of the neural network based classifier we record the time spent on training and testingduringevaluation.toimprovetheefficiencyoftraining we conductthetrainingonaworkstationwithgpuwhosesettingis listed as follows 64gb ram intel xeon cpu e5 v4 .00ghz nvidia quadro m4000.
in contrast the testing is conducted on apersonalcomputerwithoutgpu 16gbram intelcorei7 authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hui liu zhifeng xu and yanzhen zou table evaluation results on feature envy detection applicationsproposed approach jdeodorant jmove precision recall f1precision recall f1precision recall f1 junit .
.
.
.
.
.
.
.
pmd .
.
.
.
.
.
.
jexcelapi .
.
.
.
.
.
.
.
areca .
.
.
.
.
.
.
.
.
freeplane .
.
.
.
.
.
.
.
.
jedit .
.
.
.
.
.
.
.
.
weka .
.
.
.
.
.
.
.
average .
.
.
.
.
.
.
.
.
table accuracy in recommending destinations applications proposed approach jdeodorant jmove junit .
pmd .
.
.
jexcelapi .
.
areca .
.
.
freeplane .
.
.
jedit .
.
weka .
.
.
average .
.
.
cpu3.40ghz.weconductthetestingonpersonalcomputerinstead of more powerful workstation because detection of feature envy testing is often conducted on personal computers by developers.
evaluationresultssuggestthattheproposedapproachisefficient.
onaverage thetrainingcouldbedonewithin10minutes.withthe trainedclassifier ittakes1.
.3minutes .43minutesonaverage todetectfeatureenvysmellsforonesubjectapplication.incontrast on average it takes jdeodorant andjmove1 minute and minutes respectively.furtheranalysisonthetestingtimesuggeststhatmost .
minutes .
minutes of the testing time is spent on information extraction i.e.
extracting method names class names and the distance between them.
in contrast the neural network alwaysmakespredictionsinstantly anditconsumeslessthan1 of the testing time less than seconds .
.
threats to validity the first threat to validity is that the feature envy smells involved in the evaluation are generated automatically.
it is likely that such automatically generated smells are different from those that are manuallyintroducedbydevelopersduringrealdevelopments.consequently conclusionsdrawnonsuchgenerateddatasetmaynot hold on real applications.
to reduce the threat we randomly select methodstomove andrandomlyselectthetargetclassesforsuchmethods.
besides that we also rigidly control the ratio of smellymethods to all methods to make sure that the ratio is close tothat .
in real applications .
finally we carry out a case study in section 5where no automatically generated smells are involved.
the results of the case study confirm the conclusion that the proposed approach improves the state of the art.
thesecondthreattovalidityisthattheevaluationisbasedon the assumption that all methods in the subject applications areproperly distributed i.e.
there is no feature envy in the original source code.
however the assumption may not hold and thus the calculation of performance e.g.
precision and recall based on this assumptionmaybeinaccurate.toreducethethreat weonlyselect well known high quality subject applications for the evaluation.
thethirdthreattovalidityisthatonlysevensubjectapplications areinvolvedintheevaluation.specialcharactersofsuchapplications may bias the conclusions and thus such conclusions may not hold on other applications.
to reduce the threat we select applicationsfromdifferentdomainsanddifferentdevelopers.wealsocarry out k fold cross validity on such applications to reduce the bias introduced by specific applications.
to facilitate further evaluation we publish the source code of the implementation as well as the evaluation data at case study in section we evaluate the proposed approach on applications withautomaticallyinjectedsmells.inthissection weevaluateit with real applications without any injection.
this case study investigates the same research questions as introduced in section .
but with real applications that have not be changed by us anyway.
.
subject applications we search for subject applications from sourceforge as follows.
first we search for java applications.
second we sort the resulting applications by popularity in ascending order assuming that theless popular applications may contain more code smells.
third weexcludesuchapplicationswhoseloc linesofsourcecode is smallerthantenthousandorgreaterthanthirtythousand.ifthe subjectapplicationistoolarge itmaytakealongtimetomanuallycheckthepotentialcodesmellsreportedbytheinvolvedapproaches.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
deep learning based feature envy detection ase september montpellier france table subject applications for case study applications domain version nocnom loc xmd download manager2.
jsmooth javawrapper0.
.
neuroph neural network2.
in contrast if the subject application is too small the number of codesmellsmaybesmall ornosmellsatall whichmayreduce the statistical significance of the evaluation results.
consequently welimit thesize ofthesubjectapplicationto agiven range.
fourth weexcludethoseapplicationsthatcannotbecompiledsuccessfully.
syntactical errors may prevent the proposed approach as well jdeodorant andjmove to extract necessary information correctly.
finally weselectthetopthreeoftheremainingsubjectapplications.
table4presents the information of such applications.
xdm xtremedownloadmanager isadownloadmanager tosavestreamingvideosfromwebsites resumebroken deaddownloads and schedule downloads.
jsmooth is a java executable wrapper that creates native windows launchers for given java applications.
neuroph is a lightweight neural network framework providing java neural network library and gui tool to facilitate creating training and saving of neural networks.
.
process for each of the subject applications we carry out the case study as follows.
first we train the proposed approach with data generated from the subject applications that are introduced in table .s ec ond weapply the proposedapproach trainedclassifier jdeodorant andjmovetotheselectedsubjectapplicationindependently and merge the detection results.
third we present the detection resultstothreedevelopersformanualchecking.fourth basedon themanualchecking wecomputetheperformanceoftheevaluated approaches.
the manual checking is accomplished by three postgraduate studentsinbeijinginstituteoftechnology.allofthemaremajored in computer science and have rich experience in java development.
they check the detection results independently.
after that they discusstogethertoremoveinconsistence.notable theevaluationis conducted in an anonymous manner and thus the students cannot identify the tool that performed the recommendation.
.
results results of the case study are presented in table .
the first column presents different metrics like precision and accuracy.
columns 4presentstheresultsoftheproposedapproachondifferentapplications andthefifthcolumnpresentsitsaverageperformance onallapplications.theperformanceof jdeodorant andjmoveis presented in columns and columns respectively.
the secondrowpresentsthenumberofpotentialfeatureenvyreportedbydifferent approaches and the third row presents the number of accepted correct feature envy.
the fourth row presents the number of correct recommendation of destinations for the accepted feature envy.thelasttworowspresenttheprecisionindetectingfeature envy and accuracy in recommending destinations respectively.
from table we make the following observations first theproposedapproachcanidentifyfeatureenvysmells in real applications and suggest the correct target classesfor smelly methods.
in total it successfully detect feature envy smells from the three subject applications among which are manually confirmed.
it also successfully recommends the correct destinations for .
of the confirmed smelly methods.
second the proposed approach significantly outperformsjdeodorant andjmovein detecting feature envy smells.
it improvestheprecisionfrom27.
jdeodorant and15.
jmove significantlyto41.
.italsoidentifymuchmore truepositivesthan jdeodorant andjmove whichsuggests that the proposed approach achieves greater recall than jdeodorant andjmove.
third theproposedapproachismoreaccuratethan jdeodorantandjmovein recommending destinations for feature envy methods.
compared to jdeodorant andjmove i ti m provestheaccuracyby41.
.
.
and48.
.
.
respectively.
we conclude from the preceding analysis that the proposed approach significantly outperform the state of the art in both detecting feature envy smells and recommending destinations for smelly methods.
.
threats to validity thefirstthreattovalidityisthatonlythreesubjectapplicationsare involved in the evaluation.
special characters of such applications may bias the conclusions and thus such conclusions may not hold onotherapplications.toreducethethreat weselectapplications from different domains and different developers.
although addi tional subject applications would significantly increase the cost manual checking it would be interesting in future to evaluate the approaches with more applications.
the second threatto validity is that manualchecking of the reported potentialfeatureenvy smellscouldbe inaccurate.
thethree participants are not theoriginal developers of the subject applications and they may not fully understand the design.
consequently they may make incorrect judgements on the potential smells.
to reduce the threat we select three participants who have rich experience in software refactoring and java development.
besides that wealsoaskthemtodiscusstogetherandreachanagreementonall smells.finally wealsoconductanevaluationinsection 4where manual checking is not required.
discussion .
evaluation with original developers thecasestudyinsection 5recruitsexternaldeveloperstomanually checkthepotentialcodesmellsreportedbysmelldetectiontools.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france hui liu zhifeng xu and yanzhen zou table results of case study metricsproposed approach jdeodorant jmove xmdjsmooth neuroph total xmdjsmooth neuroph total xmdjsmooth neuroph total reported accepted accepted targets12 precision .
.
.
.
.
.
.
.
.
.
.
.
accuracy destination .
.
.
.
.
.
.
such external developers are not familiar with the subjection applications and thus may make mistakes during the manual checking.
if the original developers of such applications could be recruited it would significantly improve the accuracy of the manual checking because they have much better understanding of the subject applications.however itischallengingtorecruittheoriginaldevelopers formanualchecking.oneofthereasonsisthatthecheckingistime consumingand tedious.another possiblereason isthat resolving code smells often have low priority in companies.
an alternativeway torecruit original developersin theevaluationistointegratetheimplementationoftheproposedapproach into ides and collect feedbacks i.e.
which reported items are con firmed or rejected automatically by such ides.
a similar approach has been proposed by liu et al.
to collect manual feedbacks in smell detection tools automatically.
they collect such feedbacks to optimize the setting of smell detection tools.
such feedbacks can alsobeemployedtoestimatetheperformance especiallyprecision of smell detection tools.
.
generality of the generated data theproposedapproachgenerateslabeledtrainingdataautomatically by randomly moving methods among classes.
such generated dataserveasthebasisofdeeplearningbasedfeatureenvydetection.
however they may be different from real feature envy smells introduced by developers.
as a result the classifier trained with such generated data may learn to distinguish the randomly moved methodsinsteadofthoseassociatedwithfeatureenvysmells.to reduce the threat weevaluate the proposed approach with acase study in section 5where the detected feature envy smells are manually confirmed.
the evaluation results suggest that the proposed approach can identify real feature envy smells accurately even if it istrainedwithgenerateddata.infuture wewouldinvestigatehow toimprovetheapproachbyaddingrealcodesmellstothegeneratedtrainingdata.besidesthat consideringmultiplerefactoring tools in future during the data generation may help to improve the generality as well.
.
misplaced fields in this paper we follow a rather narrow definition of feature envy and thus the proposed approach is designed to detect misplacedmethods only.
in a broad definition however feature envy alsocovers misplaced fields.
we follow the narrow definition because it iswellrecognized andmostoftheexistingcodesmelldetection tools follow this definition.
however it is interesting to extend the proposedapproachinfuturetodetectmisplacedfieldsaswellas misplaced methods.
.
extension to other code smells the proposed approach is currently confined to feature envy.
however theunderlingrationale i.e.
deeplearningtechniquescould learn useful featuresfor smell detection andthe required training datacouldbegeneratedautomatically maybeapplicabletoother code smells as well.
for example we may generate god classes positive samples by combining classes in the same project and take other classes as negative samples.
with such positive and negativesamples trainingdata wecantrainadeepneuralnetwork to determine whether a given class is a god class.
conclusions inthispaperweproposeadeeplearningbasedapproachtoidentify feature envy smells one of the most common code smells.
it automatically selectsuseful textual features andmaps such features to predictions automatically.
to train the deep neural network we also propose an approach to generate numerous labeled training dataautomatically.tothebestofourknowledge wearethefirst to exploit deep learning in feature envy detection.
we are also the first to automatically generate labeled training data for code smell detection.theevaluationoftheproposedapproachiscomposed oftwoparts.inthefistpart weevaluateitonopen sourceapplicationswithinjectedsmells.inthesecondpart weevaluateiton theoriginalsourcecodeofopen sourceapplicationswithoutany revision.evaluation results inboth parts suggestthat the proposedapproachsignificantlyimprovesthestate of the artinbothfeature envy detection and recommendation of refactoring solutions.