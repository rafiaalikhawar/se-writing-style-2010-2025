java reflection api revealing the dark side of the mirror felipe pontes rohit gheyi federal university of campina grande campina grande brazil felipepontes copin.ufcg.edu.br rohit dsc.ufcg.edu.brsabrina souto state university of paraiba campina grande brazil sabrinadfs gmail.com alessandro garcia puc rio rio de janeiro brazil afgarcia inf.puc rio.brm rcio ribeiro federal university of alagoas macei brazil marcio ic.ufal.br abstract developers of widely used java virtual machines jvms implement and test the java reflection api based on a javadoc which is specified using a natural language.
however there is limited knowledge on whether java reflection api developers are able to systematically reveal i underdetermined specifications and ii non conformances between their implementation and the javadoc.
moreover current automatic test suite generators cannot be used to detect them.
to better understand the problem we analyze test suites of two widely used jvms and we conduct a survey with developers who use the java reflection api to see whether the javadoc impacts on their understanding.
we also propose a technique to detect underdetermined specifications and non conformances between the javadoc and the implementations of the java reflection api.
it automatically creates test cases and executes them using different jvms.
then we manually execute some steps to identify underdetermined specifications and to confirm whether a non conformance candidate is indeed a bug.
we evaluate our technique in input programs.
our technique identifies underdetermined specification and nonconformance candidates in java reflection api public methods of classes.
we report underdetermined specification candidates in java reflection api methods.
java reflection api specifiers accept underdetermined specification candidates .
we also report non conformance candidates to eclipse openj9 jvm and to oracle jvm.
eclipse openj9 jvm developers accept and fix candidates .
and oracle jvm developers accept and fix non conformance candidates.
ccs concepts software and its engineering software testing and debugging .
keywords reflection api non conformance underdetermined specification permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse august tallinn estonia association for computing machinery.
acm isbn .
.
.
.
reference format felipe pontes rohit gheyi sabrina souto alessandro garcia and m rcio ribeiro.
.
java reflection api revealing the dark side of the mirror.
in proceedings of the 27th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse august tallinn estonia.
acm new york ny usa pages.
introduction reflection is the ability to examine a program and to change its structure and behavior at run time .
it is a feature present in python c and java.
in java of open source java projects use reflection such as jboss junit5 maven and spring boot.
these projects often depend on the java reflection api to implement critical tasks in a program such as handling dependencies dynamically inspecting program components manipulating fields and invoking methods at run time.
the reliable use of a reflection api largely depends on the systematic conformance testing of the api implementation.
otherwise two basic problems may occur.
first the implementation of each api method might not be in conformance with its specification.
second api developers may not be able to reveal issues in the api specification.
these two problems may induce misunderstandings of api methods even by experienced java programmers .
java virtual machine jvm developers implement and test the java reflection api based on a javadoc which is specified using a natural language.
in fact developers of widely used jvms e.g.
eclipse openj9 and openjdk implement test cases to verify whether their implementation is in conformance with the javadoc.
however there is limited knowledge on whether java reflection api developers systematically reveal underdetermined specifications and non conformances in their implementations.
following liskov we say that a specification is underdetermined if it allows multiple implementations to return different results for the same input.
in its turn a non conformance occurs when a java reflection api method does not follow its javadoc specification.
empirical studies tend to only investigate the frequency and the complexity on the use of the java reflection api .
they conclude that api users often have to invoke many api methods to implement recurring non trivial tasks in their programs which makes the use of reflection in java even harder.
however the scenario may be even more worrisome.
it may be the case that 636esec fse august tallinn estonia felipe pontes rohit gheyi sabrina souto alessandro garcia and m rcio ribeiro each reflection api method is poorly tested based on its specification.
the lack of proper conformance testing does not help api developers to either fix bugs or improve the specification.
the latter may in turn induce developers to misunderstand the behavior of api methods.
popular test cases generators such as randoop and evosuite heavily use and depend on the java reflection api in their implementations.
however these tools do not deal with complex objects in parameter objects such as class and method and do not focus on detecting non conformances in the java reflection api .
to better understand the problem we analyze test suites of two widely used jvms eclipse openj9 and openjdk.
their developers implement most test cases to check the conformance between the javadoc specification and the java reflection api implementation only after a bug has been reported.
moreover developers do not consider any strategies on choosing data to invoke methods in test cases.
second we conduct a survey with developers who use the java reflection api to see whether the javadoc specified in natural language impacts on their understanding.
we present some javadoc sentences and ask for the output of three apis methods used in of open source java projects.
although .
of developers have more than years of experience in java and .
have knowledge about the java reflection api there is no consensus in the responses.
some developers comments increase evidence that the javadoc specification is imprecise and incomplete.
also some developers face similar problems as we can see in some issues reported in randoop and evosuite bug trackers.
the results of both investigations reinforce the need for improving systematic conformance testing of the java reflection api.
moreover there is limited understanding of how often non conformances occur and how critical they are.
to improve this scenario we propose a technique to detect underdetermined specifications and non conformances between the specification and the implementations of the java reflection api section .
our technique automatically creates test cases for all possible combinations of parameter values received and executes them in different jvms to identify differences i.e.
underdetermined specification and non conformance candidates .
during the test cases execution objects and primitive values yielded by methods are saved to create more test cases.
the technique groups underdetermined specification and non conformance candidates into three groups different values difference between exception thrown and value and different exceptions.
then we execute some manual steps to confirm whether an underdetermined specification or nonconformance candidate is indeed a bug and submit to api specifiers or jvm developers.
we evaluate our technique using input programs from github and four jvms oracle openjdk eclipse openj9 and ibm j9 in section .
it identifies underdetermined specification and non conformance candidates in java reflection api public methods of classes.
twenty one .
candidates are detected due to test cases created using objects and primitive values saved during the test cases execution.
we report underdetermined specification candidates in java reflection api methods.
the java reflection api specifiers accept candidates .
we also report nonconformance candidates to eclipse openj9 and to oracle jvms.
eclipse openj9 developers accept and fix .
non conformancecandidates.
our technique identifies non conformance candidates in methods such as class.getmethods that is used in of java open source projects .
a number of non conformance candidates are related to class .
eighty percent of non conformances candidates in class are due to differences between exception and value.
a number of input programs used in our technique expose at least one non conformance candidate.
our technique helps jvm developers not only to improve the implementation but also to promote discussions about underdetermined specifications in the java reflection api specification.
in summary the main contributions of this work are we analyze the test suites of widely used jvms eclipse openj9 and openjdk section .
we conduct a survey to investigate whether the java reflection javadoc specified in natural language impacts on developers understanding section .
we propose a technique to detect underdetermined specifications and non conformances between the specification and the implementations of the java reflection api section we report underdetermined specification candidates to jvm specifiers detected by our technique.
they accept candidates.
we also report non conformance candidates to jvm developers detected by our technique.
they accept and fix of them.
twelve test cases are now part of the eclipse openj9 jvm test suite section .
problem next we characterize the problem from three perspectives.
.
motivating example we present an example of an underdetermined specification in the java reflection api javadoc.
jsprit is a java based toolkit for solving rich traveling salesman and vehicle routing problems.
listing presents the route enum declaring three options.
the constmanager class defines the private field array rtsto store supported routes.
listing code snippet of a project related to routes.
1public enum route inter route intra route no type 3c l a s s constmanager private route r t s consider a test case t1invoking the java reflection api class.getresource method to retrieve a resource related to route type listing .
suppose cis aclass object representing route type created to inspect the program of listing .
using oracle1.
.0 151 jvm t1yields a class folder url e.g.
file home classes .
however when using eclipse openj9 jvm .
.
t1yields null.
the java reflection api is specified in a javadoc using a natural language.
according to it class.getresource should return a resource with a given name.
javadoc presents some rules of a valid resource name but the specification does not explain the expected result when an empty name is passed as parameter.
listing class.getresource test case.
c .
g e t r e s o u r c e 637java reflection api revealing the dark side of the mirror esec fse august tallinn estonia according to landman et al.
of java open source projects use the class.getresource method such as junit5 hibernate orm and apache maven.
they use it mainly to retrieve files inside a jar file load files resources used in tests and build projects defined in a resource folder.
java applications that contain a code similar to listing may have different behaviors when running on the oracle and eclipse openj9 jvms.
we present examples of non conformances between the java reflection api implementations and the javadoc in section .
.
.
jvms test suites to better understand how api developers deal with the problem presented in section .
we analyze two eclipse openj9 and openjdk popular jvms test suites.
we investigate how developers reveal underdetermined specifications and how they check conformance between the specification and the implementation of the java reflection api.
this investigation enables us to identify gaps in the tests of the java reflection api implementations.
we consider the master branch commit 1d288ad of openjdk source code repository and the openj9 branch commit c2aa034 of eclipse openj9 source code repository.
as the jvms test suites present source files containing test cases related to java reflection api methods we analyze only the set of files related to popular methods .
we identify test cases invoking those popular java reflection api methods and containing