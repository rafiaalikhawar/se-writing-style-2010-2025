jens knoop uwe zdun hrsg.
software engineering lecture notes in informatics lni gesellschaft f ur informatik bonn morpheus variability awar erefactoring in the wild j orgliebig1 svenapel2 andreas janker3 florian garbe4 and sebastian oster5 abstract today manysoftware systems are configurable with conditional compilation.
just like anysoftware system configurable systems need to be refactored during their evolution.
the inherent variability of configurable systems induces an additional dimension of complexity that is not addressed properly by current academic and industrial refactoring engines.
even simple refactorings such as rename identifier are not handled well by existing refactoring engines and may introduce errors in some variants of the configurable system to be refactored.
toimpro vethe state of the art we propose avariability a ware refactoring approach that relies on a canonical variability representation andvariability awar eanalysis .the goal is to preserv ethe behavior of all variants of the configurable system without compromising general applicability and scalability .t od emonstrate practicality w e developed m orpheus asound variability a ware refactoring engine for ccode with preprocessor directi ves.weapplied m orpheus to three substantial real world systems busybox openssl and sqlite showing that variability a ware refactoring is practical i.e.
scalable sound and complete in the presence of conditional compilation.
keywords configurable systems refactoring preprocessor formore than years software de velopers implement configurable software systems in the programming language cusing conditional compilation with the cpreprocessor cpp.
using preprocessor directi ves such as ifdef s developers write optional and alternati ve code fragments which form the basis to tailor aconfigurable system to different application scenarios and use cases.
man ydevelopers are familiar with ifdef s and practically every software system written in ci sc onfigurable with conditional compilation .toevolve and maintain software systems software de velopers usually rely on refactoring engines as part of integrated de velopment environments such as e clipse .arefactoring engine isatool which semi automatically applies code restructings with the goal to impro vethe internal code structure while preserving the external program behavior .
howe ver evolving and maintaining configurable systems is challenging as the behavior not only of asingle system buto fm ultiple system variants ha veto be considered something which is not adressed properly in current refactoring engines.
toassess the state of the art of refactoring engines for configurable systems we conducted an empirical study to classify strategies of ho wexisting refactoring engines industrial open source and academic handle refactorings for configurable systems .
overall we found that there are fivedifferent strategies code restructurings using standard editor facilities find replace applying refactorings to single variants only single variant applying refactorings to multiple variants in isolation variant based support for source code with a 1method park joerg.liebig methodpark.de 2university of passau apel fim.uni passau.de 3university of passau janker fim.uni passau.de 4university of passau fgarbe fim.uni passau.de 5method park sebastian.oster methodpark.de98 j orgliebig et al.
limited set of ifdef usage patterns in configurable code limited patterns and in volving heuristics to reasons about code restructurings in the presence of preprocessor directi ves heuristics .
all strategies suffer from certain limitations that hinder their applicability in practice the yare error prone find replace are incomplete single variant andlimited patterns do not scale variant based or are unsound heuristics .forexample even a simple refactoring such as e xtract function does not work properly in the popular development environment e clipse in the presence of ifdef s. in e clipse which applies a single variant strategy w eo bserved adifferent program behavior after code restructurings.
asexisting strategies and refactoring engines ha veserious shortcommings which hinder their application in practice we de veloped our ownstrategy called variability awar erefactoring .
the idea is to use variability a ware data structures and algorithms wa14 li13 k a11 for this task i.e.
data structures and algorithms which incorporate variability in the form of ifdef sdirectly during code restructurings.
toassess the applicability of variability a ware refactoring we implemented variability a wareversions of three common refactorings rename identifier extract function and i nline function a s part of our ownrefactoring engine m orpheus .i ne xperiments with three real world case studies busybox openssl andsqlite we could sho wthatvariability a ware refactoring scales well to practical configurable systems while preserving the behavior of all variants.
theaverage time for applying asingle refactoring is in the order of milliseconds.
with variability a ware refactoring we close agap in tool support for configurable software systems and sho wthat for the first time ascalable sound and complete refactoring engine forc including preprocessor directi ves is possible.