relationship aware code search for javascript frameworks xuan li1 zerui wang1 qianxiang wang1 shoumeng yan2 tao xie3 hong mei1 1key laboratory of high confidence software technologies peking university ministry of education institute of software school of electronics engineering and computer science peking university beijing china 2intel china research center beijing china 3department of computer science universi ty of illinois at urbana champaign urbana il usa lixuan12 wangzr13 wqx meih sei.pku.edu.cn shoumeng.yan intel.com taoxie illinois.edu abstract javascript frameworks such as jquery are widely used for developing web applications.
to facilitat e using these javascript frameworks to implement a feature e.g.
functionality a large number of programmers often search for code snippets that implemen t the same or similar feature.
however existing code search approaches tend to be ineffective without taking into account the fact that javascript code snippets often implement a feature based on various relationships e.g.
sequencing condition and ca llback relationships among the invoked framework api methods.
to address this issue we present a novel relationship aware code search racs approach for finding code snippets that use javascript frameworks to implement a specific feature.
in advance ra cs collects a large number of code snippets that use some javascript frameworks mines api usage patterns from the collected code snippets and represents the mined patterns with method call relationship mcr graphs which capture framework api methods s ignatures and their relationships.
given a natural language nl search query issued by a programmer racs conducts nl processing to automatically extract an action relationship ar graph which consists of actions and their relationships inferred from th e query.
in this way racs reduces code search to the problem of graph search finding similar mcr graphs for a given ar graph.
we conduct evaluations against representative real world jquery questions posted on stack overflow based on code snippe ts collected from over files on the internet.
the evaluation results show the effectiveness of racs the top snippet produced by racs matches the target code snippet for questions compared to only achieved by a relationship oblivious appro ach.
ccs concep ts software and its engineering software creation and management information system information retrieval keywords code search javascript code mining natural language processing .
introduction javascript frameworks are widely used for developing web applications.
a recent survey has shown that .
of the top million websites use javascript frameworks such as jquery mootools prototype yui and extjs.
meanwhile among all these frameworks jquery has a share of .
.
w hen using these javascript frameworks a large number of programmers are often in great need of help.
for example .
of questions in stack overflow the most well known programming q a website are tagged with javascript which is the top tag.
when using these javascript frameworks to implement a feature e.g.
functionality programmers can benefit from existing code snippets that implement the same or similar feature .
to search for such code snippets the programmers can read application programming interface api documentation or tutorials post questions on q a websites use code search engines and so on.
however these existing approaches of code search face various limitations for javascript frameworks.
for example api documentation contains only a very limited number of hand crafted code snippets.
existing code search engines such as ohloh code and krugle mainly use text similarity to find code snippets in open source code repositories e.g.
github sourceforge an d tend to be inaccurate.
recent research contributes new approaches that leverage code analysis and code mining e.g.
parseweb mapo sniff they take into account code characteristics such as api usage patterns and encoded code patterns .
however none of these approaches considers the characteristics of javascript code snippets or search queries related to using a javascript framework api.
searching for code snippets using javascript frameworks has three main unique characteristics.
f irst in javascript relationships between method calls are complex beyond sequencing relationships e.g.
open should be invoked before read among method calls as commonly captured by existing approaches .
for example many api methods in javascript frameworks are asynchronous although the call sites of these asynchronous methods are sequentially listed in a code snippet there can be a large numbe r of concurrent executions of these methods at runtime.
in addition callback is often used in javascript code to enforce strict execution order of some method calls.
for example lines in the lower part of figure define an anonymous function in which api methods loader img jquery uses as a shortcut for jquery and hide are called line .
this anonymous function is passed as a callback parameter of the method load line .
the code s runtime behavior is that these two api methods are called only after the method load has completed.
second javascript is mainly used for client side scripting in web browsers.
many typical search queries for javascript framework api usage describe user interaction browser control asynchronous permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the fu ll citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific p ermission and or a fee.
request permissions from permissions acm.org .
fse november seattle wa usa acm.
isbn .
communication and altering of a displayed document content.
thus these queries usually consist of simple actions conjuncted with relationship describing words e.g.
when and after .
for example the underlined sentence in the upper part of figure illustrates such a query which includes multiple actions show a busy image image is downloaded and busy image is removed .
table in section .
provides more query examples from stack overflow.
many short descriptions for a simple action can be mapped to the corresponding action implementing methods in javascript frameworks by leveraging their api documentation.
in addition the conjunction words between short descriptions e.g.
when as shown in figure reflect the relationships of these actio ns.
these relationship describing words may also be mapped to aforementioned relationships among api method calls sequencing and callback respectively.
third javascript frameworks such as jquery are usually used to select and manipulate document ob ject model dom elements .
the types e.g.
img div and attributes of dom elements e.g.
class id are usually defined in html code.
api methods in javascript code use css selectors e.g.
.child option to select dom elements and are generally applicable to manipulate various types of dom elements without directly referring to these elements types.
therefore it is undesirable to directly use elements types that appear in an nl search query e.g.
div in the hide div query to search code snippets for the target code snippet.
special care needs to be taken to process these elements types in a search query before being used in code search.
based on the o bservations of these unique characteristics we propose a relationship aware code search racs approach for finding code snippets that use javascript frameworks to implement a specific feature being described in the given search query.
racs emphasizes th e utility of semantic information especially the relationships between api method calls in code snippets and relationships between actions in search queries.
racs abstracts a code snippet as an api method call relationship mcr graph which consists of t he signatures of the api methods invoked in the code snippet along with the relationships among these methods.
given a natural language nl search query racs conducts nl processing to automatically abstract the query to an action relationship ar graph.
in this way racs reduces code search to the problem of graph search finding similar mcr graphs for a given ar graph.
this paper makes the following main contributions the first approach for finding relevant javascript framework based code snippets giv en a search query in nl.
a technique for mining framework api usage patterns expressed formally as mcr graphs from large scale javascript code snippets.
a technique for abstracting an nl search query to an ar graph.
a technique for reducing the code search problem as a graph search problem.
evaluation s conducted against representative real world jquery questions posted on stack overflow based on code snippets collected from over files on the internet.
the evaluation results show the effect iveness of racs the top snippet produced by racs matches the target code snippet for questions compared to only achieved by a relationship oblivious approach existing state of the art code search approaches are relationship oblivious approaches .
the rest of the paper is organized as follows.
section explains our racs approach through an example.
section elaborates racs.
section discusses evaluation results.
section discusses the applicability and limitations of racs.
section presents related work.
finally section concludes this paper.
.
motivating example in this section using an example we elaborate characteristics of both javascript code snippets and search queries related to using a javascript framework api.
figure shows a real world question the upper part and one accepted answer the lower part from stack overflow.
this question describes a typical scenario in developing web applications.
the underlined sentence is an nl description for a feature implemented in javascript or jquery.
the accepted answer contains a code snippet implementing the fea ture with jquery.
from an earlier version of figure .
example from stack overflow the code snippet in the accepted answer shows a callback relationship in javascript code lines .
an anonymous callback function is defined and passed as a parameter of the jquery api method call load .
two other jquery api methods loader img and hide line are called inside the anonymous function.
existing approaches mainly extract method call sequences as the abstract representation of the code snippet and apply mining algorithms on the sequences.
in this code snippet line with the callback not only represents the occurrence order in the code snippet but also reflects t he strict execution order for asynchronous methods as explained by the comments in lines and .
racs analyzes the javascript code snippet extracts method signatures for the api methods invoked in the code snippet and identifies different relationship s between the method calls see section .
for details .
in this example show and load have a sequencing relationship while load and hide have a callback relationship enforcing a strict order.
we represent the signatures of the invoked methods and their relationships as an api method call relationship mcr graph the abstract representation of the code snippet.
in the upper part of figure the underlined sentence is an nl description of a feature.
the feature consists of multiple actions in each clause show a busy image image is downloaded and busy image is removed and there are structural relationships between clauses implied by relationship describing words when and after .
no existing approach considers such structural infor mation.
in some existing code search tools the users need to manually extract query terms based on the nl description.
for example in keivanloo et al.
s approach the users manually select candidate terms from koder s query log dataset.
then the users manually map the description successfully login and logout the latest version of the accepted answer includes the updated code being compatible with a more recent version of jquery.
stack overflow question and description how to display loading image while actual image is downloading some time images take some time to render in the browser.
i want show a busy image while the actual image is downloading and when image is downloaded the busy image is removed and actual image is be shown there .
how can i do this with jquery or any javascript?
accepted answer you can do something like this show loading image loader img .show main image loaded ?
main img .load function hide remove the loading image loader img .hide you assign load event to the image which fires when image has finished loading.
before that you can show your loader image.
to query term ftpclient .
programmers with little knowledge of the names of the target framework api methods can hardly write a query as specific terms.
some other approaches such as sniff directly take short descriptions as the query after preliminary preprocessing e.g.
stop word removal and stemming.
our racs approach uses nl processing to extract semantic descriptions for actions in each clause.
racs analyzes the sentence structure a nd identifies different relationships between actions see section .
for details .
in addition racs constructs a mapping between a method signature and its api documentation description and uses this mapping to connect a given action description to its corresponding api method .
for a given action description racs seeks to find a matching api documentation description and then the method signature.
the matching between an action description and api documentation description is based on text semantic sim ilarity instead of keyword matching to address nl complications .
.
approach given an nl search query for snippets using a javascript framework api racs returns multiple highly relevant code snippets.
as shown in figure racs is composed of three major components that conduct three steps mining api usage patterns.
th is component mines javascript code snippets for framework api usage patterns and represents the patterns as method call relationship mcr graphs.
this process is offline.
abstracting nl query.
th is component analyzes the given nl query s description and generates an action relationship ar graph to reflect the user s search intention.
searching snippets.
th is component searches all the mcr graphs for the top ones that match the ar graph produced by step .
th is component leverages the api documentation description to bridge the nl query and the api methods invoked in code snippets.
the component then presents to the user the ranked code snippets associated with the t op matched mcr graphs.
large scale js code snippetsmining api usage patterns js api usage patterns with mcr graphs searching snippets code snippets nl search queryabstracting nl queryar graph for query api documentation figure .
overview of racs racs emphasizes both relationships between statements in programs and relationships between sentences in an nl query.
based on the observations of the javascript language and se arch queries for javascript frameworks racs focuses on three main relationships sequencing callback and condition.
before presenting racs in detail we give major definitions of important concepts used in the rest of this paper.
definition .
method c all relationship mcr graph for a code snippet a method call relationship mcr graph for a code snippet is a directed acyclic graph dag as a tuple m r where m is a non empty vertex set represented as m1 m2 ... mx .
every element in m is a method signature including its name and parameter type list.
r is an edge set represented as r1 r2 ... ry .
every element in r is a triple mi mj t indcating that relationship t exists from vertex mi to vertex mj t is one of the three rel ationships sequencing callback and condition.
in particular the detailed meanings of mi mj sequencing mi mj callback mi mj condition for javascript are further elaborated in section .
.
.
an mcr graph is an abstract representation of a code snippet including one or more framework api method calls focusing on essential behaviors involving these framework api method calls.
definition .
action relationship ar graph for a query an action relationship a r graph for a query is a dag as a tuple a r where a is a non empty vertex set represented as a1 a2 ... an .
every element in a is an action that implement s a feature reflected by the query.
r is an edge set represented as r1 r2 ... rm .
every element in r is a triple ai aj t indicating that relationship t exists from vertex ai and vertex aj t is one of the three relationships sequencing callback and condition.
in particular the detailed meanings of ai aj sequencing ai aj callback ai aj condition for javascript are further elaborated in section .
.
.
an ar graph is an abstract representation of an nl search query including one or more actions focusing on essential be haviors involving these actions.
.
mining api usage patterns the component of mining api usage patterns consists of two sub processes.
first it analyzes large scale javascript code snippets and extracts an mcr graph as an abstract representation of each snippet.
second it analyzes each mcr graph and groups the code snippets with the same mcr graph as one api usage pattern.
.
.
abstracting code snippets racs constructs a snippet base from an initial javascript code base.
in particular from the javascript a nd html files collected in the initial javascript code base racs first extracts sequences of framework api methods being invoked in each javascript function in the files.
then each contiguous subsequence of such sequence forms a code snippet.
for a functi on consisting of n api method calls we obtain n n snippets n snippets each include api method call n snippets each include api method calls ... and snippet includes n api method calls.
for each code snippet in the snippet base racs analyzes its abstract syntax tree ast and constructs an mcr graph.
in our implementation we use the rhino javascript engine for javascript code analysis.
when visiting th e ast nodes racs identifies framework api method calls e.g.
according to the list of api methods documented in the jquery api documentation .
meanwhile racs identifies relationships among these api method calls according to relationships among ast nodes.
currently racs considers three common relationships in javascript sequencing callback and condition .
figure 3a shows a code snippet involving all three kinds of relationships .
figure 3b shows the correspondent ast simplified with leaf nodes and par t of other non critical nodes such as block statement being removed of the code snippet listed in figure 3a.
sequencing relationship.
if method b is called immediately after method a is called there is a sequencing relationship from a to b formally repr esented as a triple a b sequencing .
in the ast parent child method call nodes are method chains having a sequencing relationship.
for example in figure 3b there is a sequencing relationship from method call loader img node to method call show node in one statement and there is a sequencing relationsh ip from show node to main img in two statements.
callback relationship.
if method a is called via an anonymous function as its parameter and method b is a method called inside the anonymous function there is a callback relationship from a to b formally represented as a triple a b callback .
in figure 3b there is a callback relationship from method call load node to method call hide node .
condition relationship.
if method a appears in a predicate of a conditional statement such as ifstatement and method b is the first method called in one of the branch es then there is a condition relationship from a to b formally represented as a triple a b condition .
for a method c being called after b in the same conditional block we do not record a condition relationship between a and c but we do record a sequencing relationship between b and c. in figure 3b there is a condition relationship from method call width node to method call show node .
figure 3a.
code snippet extended from code in figure .
program expressionstatement ifstatement expressionstatement callexpression loader img .show callexpression loader img callexpression main img .load function loader img .hide callexpression main img arguments callexpression loader img .hide binaryexpression callexpression window callexpression window .width callexpression warning img .show callexpression warning img function callexpression loader img sequencing callback condition figure 3b.
simplified ast for code snippet in figure 3a.
in jquery method in nodes and is used for selecting elements by string selectors.
all method calls with signature string are considered to be semantically equivalent.
string often appears in code and provides limited semantics.
therefore racs ignores all method calls to simplify the mcr graph.
this process removes method calls with low degree of differentiation s haring similar ideas with stop word removal and tf idf.
the mcr graph for the snippet in figure 3a is shown in figure .
.
.
clustering code snippets many mcr graphs from different snippets are equivalent.
to avoid unnecessary duplicat ed graph matching in the next section and thus improve the query ing speed racs clusters code snippets in its base according to their mcr graphs .
to capture precise semantics of code snippets falling into the same cluster we use a relatively conservative way of clustering if two code snippets are abstracted to the same mcr graph they fall into one cluster represented by the mcr graph.
after this step we attain a large number of clusters represented as mcr graphs reflecting different usage patterns of a javascript framework api.
each mcr graph i.e.
each cluster is associated with one or more code snippets.
figure .
mcr graph for the example in figure .
.
abstracting nl query this section presents the techniques for extracting an ar graph that accurately captures essential semantics of the given nl query.
.
.
preprocessing the step of preprocessing accepts the given nl query s sentences and processes these sentences to get a more accurate result of nl analysis.
in particular this step performs two major tasks.
first the step transforms some special identifiers to plain english text.
identifiers in an nl query may pose complication in nl analysis.
for example the character period .
in identifiers e.g.
jquery.ajax may be recognized as the end of a sentence leading to wrong parsing see section .
.
for detail .
in addition some identifiers are the combination of multiple english words e.g.
toggleclass negatively influencing the calculation of sentence semantic similarity in a later process see section .
.
f or detail .
to deal with these complications we replace the period .
character with a space split identifiers concatenated with hyphen or underscore and split camelcase style identifiers following the javascript naming convention.
second the step transforms abbreviations into full terms e.g.
attr to attribute based on a domain specific dictionary.
the domain specific dictionary contains the top most frequent expansions in programs found in hill s et al.
s research .
besides a short list of abbreviations we automatically extract terms from dom javascript documentation using python scripts.
the domain specific dictionary includes a word list of dom elements e.g.
div marked by td title name in r rec html401 index elements.html and javascript events e.g.
mouseenter marked by a class eventtype in tr dom level events event types .
.
.
action identification the step of action identification uses nl processing techniques such as pos parts of speech tagging and parsing to attain the structure of a given nl query sentence and identifies the actions in the sentence.
pos tagging determines the part of speech e.g.
a singular or mass noun s pos tag i s nn for each word in the given sentence.
parsing determines the parse tree of the given sentence.
each word in the sentence is represented as a leaf node in the parse tree and each grammatical unit e.g.
verb phrase corresponds to a sub tree.
we use the stanford parser to generate the pos tags and parse tree.
racs traverses the parse tree and identifies the actions in the given nl query.
in the language structure the description of an action consists of verb phrase vp noun phrase np and opt ional prepositional phrase pp .
a sub tree with this structure can be identified as one action.
figure shows the parse tree of the nl query in figure .
racs identifies five actions in this example see the rectangle in figure .
note that these action s are not the final elements of the action set they may be modified or even discarded by the post processing step described in section .
.
.
.
.
relationship identification the step of relationship identification identifies potential relationships among the actions by mapping relationship describing loader img .show main img .load function loader img .hide if window .width warning img .show show load function width hide show sequencing callback conditionwords to the three aforementioned relationships.
these relationship describing words are the most commonly used in a lot of stack overflow questions descriptions.
for each adjacent action pair found in the given nl query s description we check whether it corresponds to one of the following three relationships.
figure .
parse tree of nl query in figure sequencing relationship.
a sequencing relationship from action ai to action aj exists when two actions descriptions are connected by a connecting word being a preposition before and after a conjunction and and then or a punctuation comma semicolon and period .
note that the direction of the sequencing relationship is properly determined based on the semantics of the connecting word.
only the action after connecting word after is the starting point of the sequencing relationship.
in other cases the later action is the end point.
an example of such relationship is in sentence add class checked to element and fade in the element.
condition relationship.
a condition relationship from action ai to action aj exists when two actions descriptions are connected by a connecting word being a preposition if indi cating that whether action aj will happen or not depends on the result of action ai.
the action after the connecting word is the starting point of the condition relationship.
an example of such relationship is in sentence show a warning image if scree n width is less than 960px.
callback relationship.
a callback relationship from action ai to action aj exists when not only two actions descriptions are connected by a connecting word being a conjunction or a preposition indicating point in time when after and if but also the action happening first i.e.
action ai should imply an event or describe a completion status in other words the description is supposed to contain a word from the word list for javascript events in the do main specific dictionary described in section .
.
or the pos of a verb in the description should be a gerund present participle vbg or a past participle vbn .
the action after the connecting word is the starting point of the callback relationship.
an example of such relationship is in sentence when image is downloaded the busy image is removed.
the arrowed lines in figure show three relationships between actions two being sequencing and one being callback .
.
.
post processing the step of post processing further processes the identified actions and forms an ar graph for the given nl query.
racs adds an inferred notional verb get to a description containing only the link verb be .
consider an example description screen width is less than 960px .
this description does not contain a notional verb.
adding get as get the screen width makes the description more precise.
this process is similar to hill et al.
s technique for inferring an action for a method name that does not begin with a ver b. show element element is downloaded element is be shownelement is removedsequencing callback condition figure .
ar graph for nl query in figure elements selected by the jquery selector are usually defined in html code and too little detailed information about the elements could be found only in the javascript code.
for example consider three code snippets where .child .hide and option .hide are used to hide a selected div element3 respectively in two javascript code snippets div .show is used to show the div element in the third code snippet .
if the given user query is hide div although the three code snippets would have the equal number of terms matched by the query the first two snippets should be returned but not the last one.
the reason is that in nl queries terms for describing the detailed types e.g.
div of dom elements are not as important as other terms e.g.
hide show for jquery api identification.
in addition code snippets with the same usage pattern but with different element types as the target code snippet are still often useful to the developers.
for example in figure if we change all the img element type in the accepted answer to the div element t ype the code snippet still gives valuable hints to complete the target task.
based on this insight our step of post processing replaces some specific nouns e.g.
image div indicating element types with more general ones e.g.
element based on the word list for dom elements in the domain specific dictionary described in section .
.
and removes determiners and adjectives.
for example racs transforms the busy image to element .
at the same time racs stores these changed words as keyword s which are used for later ranking code snippets as described in section .
.
.
the ar graph for the nl query in figure is shown in figure .
.
searching snippets given an ar graph generated from the nl query this step first derives multiple ar derived mcr a mcr graphs for the ar graph based on text semantic similarity.
then it uses the a mcr graphs as the graph query to search the set of mcr graphs produced by the technique described in section .
for the most relevant mcr graphs.
finally it select s top code snippets associated with the most relevant mcr graphs as the snippets returned to the user.
.
.
deriving a mcr graphs from the ar graph the names of actions nl by nature in an ar graph are often quite different from the names of framework api methods programming languages by nature in an mcr graph.
such differences pose barriers for searching mcr graphs with an ar graph as the graph query.
to address such challenge we refine the ar graph to in css .child selects all elements with class child and option selects all elements with id option .
an element s class and id attributes and their values are described in html code e.g.
div class child id option .
the div element indicated by a div tag defines a division or a section in an html document.
root s vp vb show np dt a jj busy nn image sbar in while s s s np dt the jj actual nn image vp vbz is vp vbg downloading cc and s sbar whadvp wrb when s np nn image vp vbz is vp vbn downloaded np dt the jj busy nn image vp vbz is vp vbn removed cc and s np jj actual nn image vp vbz is vp vb be vp vbn shown advp rb there sequencing sequencing callback multiple ar derived mcr a mcr graphs by replacing the actions in the ar graph with the actions corresponding framework api methods determined by our technique of text semantic similarity.
given an action racs searches for api methods whose descriptions in the api documentation share high text semantic similarity with the description of the action i.e.
the text description of the action in the nl query .
to match actions and api methods match ing based on text semantic similarity in racs has advantages over keyword lexical matching which has been widely used in existing approaches such as sniff .
keyword matching is fast and strict while ignoring semantic similarity but may miss t o match many cases e.g.
i own a dog and i have an animal .
on the other hand matching based on text semantic similarity is based on word toword similarity metrics addressing such issue and achieving a higher recall.
in particular matching based on text semantic similarity computes the similarity between two texts t and t using the following equation sim t1 t2 maxsim w t2 idf w w t1 idf w w t1 maxsim w t1 idf w w t2 idf w w t2 where maxsim w t computes the maximum word to word similarity between word w and any word with the same pos in text t idf w denotes the inverse document frequency of word w. the word to word similarity metrics can be either knowledge based e.g.
wordnet similarity or corpus based e.g.
latent semantic analysis .
in our implementation we use the knowledge based mcs technique implemented by the semilar toolkit .
for each action racs chooses the top k framework api methods as the candidate methods corresponding to the action.
thus for a given ar graph with n actions racs replaces each action of ar graph with multiple corresponding candidate methods and attain kn a mcr graphs.
.
.
searching mcr graphs wit h a mcr graphs this step uses the a mcr graphs as the graph query to search for the most relevant mcr graphs based on graph similarity.
we first define matched relationships i.e.
edges between two graphs.
given two graphs g1 an a mcr graph and g2 an mcr graph relationship mi mj t from g1 and relationship m k m l t from g2 are matched when mi m k mj m l t t .
two method signature s are equal when they have the same method name and parameter type list.
then we define the graph similarity score between a mcr graph g1 and mcr graph g2 as sim g1 g2 mrn g1 g2 rn g1 rn g2 mrn g1 g2 where mrn g1 g2 denotes the number of matched relationships between g1 and g2 rn gi denotes the total number of relationships i.e.
edges in gi.
this graph similarity score has a value between and with the score of indicating that two mcr graphs are identical and the score of indicating no matched relationship between the g raphs.
racs selects the top k mcr graphs ranked based on the graph similarity scores for further selection of snippets as described in the subsequent subsection .
.
.
selecting code snippets each mcr graph indicating a usage pattern may be associated with more than one code snippet and not all the associated code snippets are of the same importance to the user.
to help the user locate the desired code snippets more efficiently this step selects one code snippet for each of top k ranked mcr graphs based on two metrics the number of the keywords in the nl query matched by a code snippet and the length of the code snippet.
recall that the keywords in the nl query are those words changed by the technique described in section .
.
.
racs gives higher ranks to code snippets matching more keywords in the nl query.
this ranking heuristic gives preference to those code snippets more similar to the nl query.
if two code snippets have the same number of matched keywords racs ranks the shorter code snippet higher.
this ranking heuristic has been widely used in previous approaches such as prospector and parseweb making the returned code snippets concise.
after applying the two ranking heuristics racs finally returns the ranked co de snippets as the final search results for the given nl query.
.
evaluation s we conducted evaluation s to assess the effectiveness of racs.
in our evaluation s we implemented racs and addressed two main research questions rq1 how effectively can racs search javascript code snippets for a given nl search query?
rq2 how much can racs outperform a relationship oblivious code search approach?
.
evaluation setup we constructed a javascript snippet base consisting of snippets using the popular jquery framework.
the snippet base was constructed from ohloh currently openhub and amazon.com.
ohloh is a popular public directory of open source software projects.
we attained the code locations of jquery tagged projects from ohlo h and downloaded the source code of these open source projects.
amazon.com is one of the world s top ten web sites which uses jquery heavily.
we ran a web crawler on amazon to download jquery related files.
we constructed the code base in this way to ensure the diversity and quality of our snippet base.
the snippet base consists of javascript files from which we obtained code snippets.
table shows the details of the snippet base.
we mined api usage patterns from the snippet base according to jquery core api documentation which contains over method signatures within 115s.
table .
javascript snippet base source project date of files snippets ohloh amazon.com total we also constructed a benchmark which contains real world representative jquery related queries from stack overflow.
we manually checked the list of highest voted jquery tagged questions sequentially and unless a question satisfies any of the following exclusion conditions it was added to the benchmark.
the accepted answer of the question does not contain a javascript code snippet.
the code snippet in the accepted answer contains only javascr ipt built in method s without using jquery or other javascript frameworks.
the code snippet in the accepted answer is implemented by using only a jquery plugin or a non jquery javascript library.
the question is only about the setting of paramete rs such as the writing of selectors.
the description of the question is vague.
the questioner and the respondent discussed the details later in the comments.
the description of the question is at too high abstraction level.
for example for the qu estion get all descendant text nodes of an element the accepted answer mentions jquery does not have a convenient function for this.
you need to combine contents which will give just child nodes but includes text nodes with find which gives all descendant elements but no text nodes .
the question is not related to code search such as discussing programming experiences.
for example a search query cannot be extracted from a question with title .prop vs. attr .
the code snippet in the accepted answer contains only one jquery method instead of two or more jquery methods as focused by the work in this paper .
we manually checked the selected questions and further filtered out redundant questions some questions have similar descriptions and thus have the same or very similar code snippets in their accepted answers.
table shows these search queries.
we acquired a nl search query directly from the corresponding question s title and description.
all the questions corresponding to th ese search queries have accepted answers with code snippets.
for each question we used the code snippet in the accepted answer as the target snippet and checked whether a snippet returned by racs hits the target snippet i.e.
both snippets have the same jquery api method calls with the same relationships if so we consider such snippet as a hit snippet.
instead of user stud ies our evaluation s use rea l world snippets from answers accepted by developers to validate our results.
to good extent the accept reflects the real world developers feedback of usefulness.
our validation is conservative some failed case s could actually be reasonable snippets that help users for their tasks at hand .
in our evaluations parameters k and k introduced in section .
are set to and respectively by default.
in initial investigation of sample cases outside of the benchmark we evaluated different settings of k and found that when k is set as w e could achieve a good balance between acceptable query time and satisfactory recall.
note that when k is set higher the query time is longer and the recall is higher .
setting k to is to limit the total number of results needed to be checked.
all of our evaluations were conducted on a linux machine with an intel i7 .
ghz cpu and gb of ram.
the details of our evaluation subjects and results can be found on our project website .
table .
se lected stack overflow queries search results of racs and characteristic of accepted answers no.
question id nl search query query ar graph target snippet mcr graph t1 ms t2 ms top rank meth rela meth rela if a field is click into check if input is empty display a red background.
when the user clicks on that input subject the page should scroll to the last element of the page with a nice animation to scroll to bottom and not to top.
when someone clicks on an image change the image source.
get the value of the selected radio button when any of these three are clicked.
hide the container if focus is lost.
when i press enter on the form the form is submitted.
if the age checkbox is checked then i need to show a textbox to enter age else hide the textbox.
show html menus completely when a user clicks on the head of these menus.
hide these elements when the user clicks outside the menus area.
nf when i catch the submit form event with jquery get all the input fields of that form in an associative array.
when the text field is empty the submit button should be disabled .
when something is typed in the text field to remove the disabled attribute.
if the text field becomes empty again the submit button should be disabled again.
nf escaped an arbitrary string and display in an html page.
nf grab the height of the window and the scrolling offset in jquery.
nf make a div stick to the top of the screen once it s been scrolled enough to contact its top boundary nf change the background image of a div when it is clicked.
select all contents of textbox when it receives focus.
execute a callback when an iframe has finished loading.
nf loop though the table and get the value of the customer id column for each row.
nf before the ajax request if the previous request is not completed i ve to abort that request and make a new request.
nf load javascript file only if the user clicks on a certain button.
remove all the options of a select box then add one option.
nf hide the rollover image when the onmouseout event happen wait for all ajax requests to be done before i execute the next nf if a field is clicked display a background image determine the size of the browser viewport and to redetect this if the page is resized?
nf an event to fire client side when a checkbox is checked nf when you click inside a textarea its entire content gets selected check radio option whether no default is set and then set a default.
when element clicked toggle between checked and unchecked.
nf when someone clicks a link a word or two to be inserted where the cursor is.
when one of these links is clicked hide the links that are not clicked.
create a css class and add it to dom at runtime with jquery.
jquery smooth scrolling when clicking an anchor link.
nf remove the top and left attribute from the inline style on the div when clicked.
insert text into a text area using jquery upon the click of an anchor tag.
get the value selected from a dropdown menu and change the form action nf strip white space when grabbing text with jquery?
nf trigger an event after any other type of iterative callback has completed.
nf i want just the new blah div to fade in after the content gets appended.
get child elements and iterate through each of those elements.
nf get the selected option from a dropdown and populate another item with that text.
have an element fade in then in ms fade back out again nf if the check me checkbox is checked all the other checkboxes should be enabled.
get the position of layer1 and set the same position to layer2.
when the radio button is selected i enable an edit box.
nf get the index of the child li relative to it s parent when clicking that li disable inputs at first and then enable them when click a link nf get the value of the hidden field when the select is changed.
generate a new tag with class name test in h2 by clicking the button when the select dropdown is changed get the value before change.
capture the tab keypress cancel the default action.
.
metrics to assess the effectiveness of a code search approach with respect to a single query our evaluation s used the metric of the best hit rank i.e.
the highest rank of the hit snippets for the query.
a higher best hit rank implies lower user effort for inspe ction to find the hit snippet.
to assess the effectiveness of a code search approach with respect to a set of queries our evaluation s used the metric of success percentage at k i.e.
the success percentage among the set of queries considering only the top k results returned by a search approach.
in particular the success percentage at k pk in our evaluations is calculated using the following formula pk best hit ranks that are less than k total queries we investigated pk with k s respective values as and returned snippets reflecting the typical sizes of snippets that various users would invest to inspect.
such metric has been popularly used to assess the effectiveness of a code search approac h .
note that we do not use mrr mean reciprocal rank which is popular for assessing navigational search and question answering but is not appropriate for assessing code search.
.
effectiveness of racs rq1 we first evaluate d the effectiveness of r acs.
table also shows the results of racs and some characteristics of a question s accepted answer including its sample code snippet .
columns meth and rela under target snippet mcr graph show the number of the jquery api method calls and relati onships in the accepted answer respectively.
columns act and rela under query ar graph show for each nl search query the total number of actions and relationships that are identified respectively.
columns t1 and t2 represent the time in mi llisecond for deriving a mcr graphs section .
.
and searching mcr graphs section .
.
respectively.
the last column shows the best hit rank i.e.
the highest rank of hit snippets that answered the question.
nf denotes not found .
for of the queries of top of the snippet list returned by racs is a hit snippet i.e.
one that matches the target code snippet.
for queries of top of the snippet list returned by racs include at least one hit snippet.
once racs constr ucted a very precise mcr graph which is the same as the mcr graph of the accepted answer s code racs returns the right snippet in the top rank.
as shown in figure racs accurately returned code snippets for queries and in table .
the jquery api method calls marked with a rectangle box meet the semantics of each action and the code structures meet the relationships implied in the nl query.
racs did not return good results for some queries as shown in table .
there are three main reasons .
first our current snippet base is not sufficiently large to contain their required sample snippets queries and .
when we added to our current snippet base the code snippet from the accepted answer for each query all of the se queries got the target snippet in top results.
second the ar graph generated from a query may not exactly reflect the semantics queries and .
queries and miss one relationship and query includes an incorrectly identified callback relationship.
third an nl search query is not similar to the required method s api documentation description queries and .
thus given limited api documentation description relying on semantic similarity based method searching racs cannot identify the candidate methods for these nine queries unless these queries are rewritten.
we also investigated the influence of replacing some specific nouns with more general ones as done in post processing in section .
.
.
the d etailed results can be found on our project website .
query when i press enter on the form the form is submitted query if the age checkbox is checked then i need to show a textbox to enter age else hide the textbox.
figure .
top ranked code snippet for queries and .
.
comparison with relationship oblivious approach rq2 we next present the evaluation results of comparing racs with a relationship oblivious approach.
we implemented a relationship oblivious code search approach rocs that uses keyword matching between the given query text and the api documentation text rela ted with a particular code snippet.
this implemented relationship oblivious approach shares key ideas with two existing state of the art code search approaches sniff and exemplar .
similar to sniff this relationship oblivious approach applies stop word removal and stemming to a user query and retrieves usage patterns in the form of mcr graphs for direct comparison with racs from the snippet base based on keyword matching while taking no account of the order of keywords .
the existing relation ship oblivious approaches typically use support for ranking each usage pattern along with a sample code snippet that matches the pattern based on the number of code snippets that match the pattern.
such ranking is based on the premise that more popularly implemented patterns tend to be more relevant for a query among all the patterns that match the query i.e.
matching the keywords in the query .
by contrast racs uses two different search techniques as presented in section .
.
in particular racs uses semantic similarity instead of keyword matching for matching a query text against text in api documentation see section .
.
for detail .
racs uses relationship aware ranking instead of pattern support which ranks the mcr graphs by the graph simila rity of a mcr graphs derived from the query and mcr graphs see section .
.
for detail .
to evaluate how these two key techniques in racs contribute to the overall effectiveness of racs we also implemented two variant approaches that each replace one technique in racs with the corresponding technique in the baseline approach rocs.
then we compared the effectiveness of the four approaches racs semantic similarity relationship aware ranking rocs keyword matching relationship oblivious i.e.
supp ortbased ranking rocs semantic similarity relationship oblivious ranking racs keyword matching relationship aware ranking we investigated the success percentage at k with k s respective values as and snippets.
the results are shown in table .
the table shows that racs could answer more questions with higher rank than rocs.
racs could hit the target code snippet with the top snippet for queries compared to only achieve d by rocs.
rocs found the desired code snippet for only query and query in top .
keypress function a if a.which i .val this.value calculate .
submit .hide postbox tog .bind click.postboxes function var box this .val if this .
prop checked box .
show if .isfunction postboxes.pbshow self.pbshow box else box .
hide if .isfunction postboxes.pbhide self.pbhide box self.save state page self.
mark area snippet.
in top snippets the success percentage of racs is while the success percentage of rocs is only .
with top snippets racs could answer questions for the entire questions while rocs could answer only questions.
we did t test on the value of the best hit rank.
racs significantly outperform ed the other three approach es.
the detailed results can be found on our project website .
table .
comparison results metrics pattern searching method searching relationship oblivious relationship aware typeless relationship aware p1 keyword matching p5 p10 p1 semantic similarity p5 p10 racs rocs rocs racs in table the success percentage results in column relationship aware are always higher than the results in column relationship oblivious indicating that relationship aware ranking performs better than relationship oblivious support based ranking.
the results show that relationship among api method calls is very valua ble when conducting code search for javascript frameworks.
sometimes code snippets with the highest support may not be the target snippets.
for example for query get the value of the selected radio button when any of these three are clicked the best hit rank of racs is .
the top code snippet contains a callback relationship of .click function and .val .
in contrast the best hit rank of rocs for query is .
the rocs approach ranks the sequencing of .children string and .find string first with the highest support.
racs s awareness of the method call relationship improves the effectiveness of searching.
table also shows that the approaches based on semantic similarity achieve higher success percentage than the approaches based on keyword matching.
the approaches based on keyword matching are effective only if the words in an nl search query exactly match the words in api documentation.
racs uses text semantic similarity which can overcome such shortcomings.
for example for query when someone clicks on an image change the image source racs found a code snippet in top similar to the accepted answer s code snippet while racs failed to answer this query.
racs analyzed the sentence in the nl search qu ery and generated the mcr graph with method signature set .click funct ion .attr string string and callback relationship between them.
racs failed in searching for a relevant method using keyword matching because the query and api documentation descri ption use semantic similar words change and set rather than exactly the same word .
we also investigated the significance of identifying different types of relationships.
in the processes of mining api usage patterns and abstracting an nl query we t reated all the three kinds of relationships as one type sequencing relationship leading to more ar graphs that have the same similarity with the a mcr graph.
we used support to re rank patterns with the same similarity.
as shown in the last column of ta ble not differentiating relationship types leads to reducing the effectiveness especially for p1.
in addition we found that the number of the relationships does not affect the effectiveness of racs when the code corpus includes the target code snippe t. for queries with or relationships racs gets better results than being relationship obvious.
actually relationship queries are rare in stack overflow and their target code snippets are also rare in the snippet base.
after we add ed in the snippet base the target code snippets from the accepted answers for each query all of these relationship queries got their target snippets in top results.
we compared racs with ohloh code which is a publicly avai lable industrial internet scale code search engine.
all our projects for building the snippet base except amazon are included in the underlying repositories used by ohloh code.
we removed the amazon snippets from the snippet base of racs mined usage pattern s and searched on the smaller snippet base.
for ohloh code we added jquery to each benchmark query and filtered out non javascript code snippets.
if there was no hit in top search results we directly used the api names in the accepted answe r as query keywords in place of the nl query.
for the top search results racs could hit the target code snippet for queries while oholh code could hit for racs substantially outperformed ohloh code.
.
threats to validity the threats to external validity primarily include the degree to which selected javascript frameworks and search queries are representative of true practice .
there are many kinds of javascript frameworks for different purposes.
in our evaluations we selected only the mo st commonly used web application related framework jquery.
there are other frameworks with different qualities of documentation which may influence the results.
the qualities of search queries also affect the query results.
to make queries used in our e valuations to reflect real world queries we selected representative questions from stack overflow based on the vote number and directly used the question title and description as search queries.
queries written by different users have different qualities .
these threats could be reduced by more experiments on more frameworks and more search queries in the future.
in addition the r elationship oblivious approach was implemented by us .
to alleviate this threat we already took great care to accomplish fair comparison and evaluation .
for example the only two modifications from racs to produce rocs are from semantic similarity to keyword matching and from relationship aware ranking to support ranking where the keyword matching and support ranking are common typical techniques adopted by existing approaches.
moreover we implement ed two variant approaches rocs and racs to represent broad comparison bas es.
.
discussion in this section we discuss the applicability and limitations of our current implementation of the racs approach.
given free form nl descriptions racs can effectively search snippets javascript framework client code for relevant code snippets.
racs is very useful for beginner programmers of using a framework.
the programmers do not need to know details about the framework such as the method name and type information in the target framework api method.
our implemented tool can be integrated in programmi ng q a sites and development environments for the jquery framework.
with some modifications our racs approach can be applied to a wider scope.
for example when used for another javascript framework racs needs to use only the framework s corresponding a pi documentation.
racs focuses on a javascript framework and introduces three common relationships in javascri pt code.
c onsidering only sequencing and condition relationships racs could be applied to other languages.
we can also define more relationships that best show these languages features.
our racs approach attains the nl description for an api method directly from the api documentation s short description which may not comprehensively capture the api method s semantics.
the user may use a high level description where one action maps to multiple api methods.
automatic techniques of comment generation and nl relation classification techniques based on model neural networks may alleviate this problem.
we can also attain more knowledge by crowdsourcing beyond api documentation.
automatically identifying actions and relationships from an nl search query may not work well for some search queries due to the arbitrariness of nl especially for sentences with ambiguous meanings or grammatical mistakes.
cooperation between the user and the tool can be used to address such issues.
another extension is to incorporate deep learning based approaches to automatically characterize code features .
.
related work in this section we discuss r elated work to our code search approach along with our approach s technique of mining framework api usage patterns and technique of abstracting the ar graph from an nl query.
.
source code search there have been various code search approaches for different forms of queries.
the most common form is an nl query which is the same form as the one in general search engines.
mica augments google web api s search results to help programmers find the target api classes and methods given a description of desire d functionality.
mica can return some web pages containing code snippets that show basic usage of api methods.
racs directly searches code snippets in a large scale code base and can find complex usage of api methods.
keivanloo et al.
use code clone de tection to spot out working code snippets with a time complexity as low as the complexity of existing code search engines.
portfolio uses the pagerank and spreading activation networks to help programmers navigate and understand usages of the given m ethods.
these approaches require users to provide good query terms and require that keywords extracted from the query terms appear in the code base.
sniff searches api document description of api methods invoked in the code base to support a query in p lain english.
codehow recognizes potential apis with the help of api documentation and applies the extend boolean model instead of a svm model to retrieve code snippets that match queries.
racs supports a free form nl query and uses a metric to refle ct semantic text similarity instead of keyword matching as used by previous related approaches.
prospector accepts a query in the form of source and target objects types.
it synthesizes code fragments using both api method signatures and type cast i nformation mined from a code base.
parseweb interacts with the google code search engine and suggests relevant method invocation sequences.
semantics based code search lets users specify what they are looking for as precisely as possible using keywords method signatures test cases etc.
the query forms required by these preceding approaches may not be easy to formulate if the programmers are unfamiliar with the framework to be reused.
racs accepts a plain nl query and extracts specifications fro m the nl query instead of requiring users to formulate a detailed query using programming keywords.
there are other code search approaches whose input query form is close to actual code.
strathcona locates relevant code in a code base based on heurist ically matching the structure of the code under development.
xsnippet makes use of the context information similar to strathcona but it offers improvements on reducing irrelevant code examples being matched along with using only relevant contexts.
mapo mines patterns that describe a certain usage scenario and further recommends mined api usage patterns and their associated code snippets upon users requests.
prime can answer queries focused on api usage with code showing how an api method sho uld be used.
prime searches code over partial programs using a relaxed inclusion matching technique.
racs can answer similar questions without requiring users to write a detailed query such as source code.
chan et al.
s approach constructs an api grap h from an api library s implementation code.
such api graph connects classes and methods with relationships i.e.
inheritance class member methods input parameter and output parameter and then their approach selects nodes i.e.
classes and methods with high textual similarity on node names only.
subgraphs with higher accumulated node textual similarity are ranked higher.
racs constructs an mcr graph from an api library s client code and uses graph similarity to search mcr graphs with a mcr graphs by consider ing both node types and relationship types i.e.
sequencing callback and condition .
.
javascript code analysis and usage pattern mining code analysis and code mining are basic components of various software engineering tasks.
dealing with javascript code needs more specific techniques due to its language features.
our technique of mining api usage patterns for javascript frameworks handles javascript language features similar to tajs and jsminer .
tajs is a whole program dataflow analyzer for javascript including the ecmascript standard library and large parts of the w3c browser api and html dom functionality.
jsminer uses a graph based representation jsmodel for javascript usage and mines inter procedural data oriented javascript usage patterns.
jsmodel contains non essential information such as data flow dependencies that contributes little to producing query results but reduces the search efficiency.
racs uses mcr graphs to abstractly represent javascript code using a certain framework.
an mcr graph is more concise and contains essential information that may be reflected in a user query.
.
nlp based specification extr action and program synthesis there exist various approaches that extract specifications automatically from nl.
zhong et al.
infer resource specifications from api documentation and detect code bugs.
xiao et al.
develop a template based approach to extract security policies from nl software documentation and resource access information from nl scenario based functional requirements.
pandita et al.
infer formal method specifications from nl text of api documentation.
these approaches apply nlp techniques to analyze software documents.
other approaches analyze an nl search query from the users and synthesize programs meeting the requirements of the users.
smartsynth is an end to end programming system for synthesizing smartphone automation scripts from nl descriptions.
nlyze is an excel add in that supports a rich user interaction model including annotating the users nl specification and explaining the synthesized programs written in a domain specific language by paraphrasing them in to structured english.
racs searches for relevant code snippets from a code base based on analyzing an nl search query.
.
conclusion existing code search approaches are not effective in finding code snippets that use javascript frameworks to implement a spec ific feature reflected by the given nl search query.
in this paper we have presented a novel relationship aware code search racs approach.
racs first collects a large number of code snippets that use some javascript frameworks mines api usage patterns from the collected code snippets and represents the mined patterns with mcr graphs.
given an nl search query racs conducts nl processing to automatically transform the query to an ar graph.
in this way racs reduces code search to the problem of graph se arch searching the mcr graphs for a graph similar to the given ar graph.
during the graph search racs includes a technique based on text semantic similarity to bridge the gap between nl actions in an ar graph and framework api methods in an mcr graph.
w e have conducted evaluations against popular real world jquery questions posted on stack overflow based on code snippets collected from over files on the internet.
the evaluation results show the effectiveness of racs the top snippet p roduced by racs matches the target code snippet for questions compared to only achieved by a relationship oblivious approach.
.