combining spectrum based fault localization and statistical debugging an empirical study jiajun jiang ran wang yingfei xiong xiangping chen lu zhang key laboratory of high confidence software technologies ministry of education pku department of computer science and technology eecs peking university beijing china guangdong key laboratory for big data analysis and simulation of public opinion the school of communication and design sun yat sen university guangzhou china jiajun.jiang wangrancs xiongyf zhanglucs pku.edu.cn chenxp8 mail.sysu.edu.cn abstract program debugging is a time consuming task and researchers have proposed different kinds of automatic fault localization techniques to mitigate the burden of manual debugging.
among these techniques two popular families are spectrumbased fault localization sbfl and statistical debugging sd both localizing faults by collecting statistical information at runtime.
though the ideas are similar the two families have been developed independently and their combinations have not been systematically explored.
in this paper we perform a systematical empirical study on the combination of sbfl and sd.
we first build a unified model of the two techniques and systematically explore four types of variations different predicates different risk evaluation formulas different granularities of data collection and different methods of combining suspicious scores.
our study leads to several findings.
first most of the effectiveness of the combined approach contributed by a simple type of predicates branch conditions.
second the risk evaluation formulas of sbfl significantly outperform that of sd.
third finegrained data collection significantly outperforms coarse grained data collection with a little extra execution overhead.
fourth a linear combination of sbfl and sd predicates outperforms both individual approaches.
according to our empirical study we propose a new fault localization approach p red fl predicate based fault localization with the best configuration for each dimension under the unified model.
then we explore its complementarity to existing techniques by integrating p red fl with a state of the art fault localization framework.
the experimental results show that pred fl can further improve the effectiveness of state of theart fault localization techniques.
more concretely integrating pred fl results in an up to .
improvement w.r.t the faults successfully located at top which reveals that p red fl complements existing techniques.
index t erms software engineering fault localization program debugging i. i ntroduction given the cost of manual debugging a large number of fault localization approaches have been proposed in the past two decades.
among all these approaches two families of approaches have received significant attentions spectrum based fault localization sbfl and statistical debugging sd .
spectrum based fault localization collects coverage information over different elements during test execution and calculates the suspiciousness of each element using a risk yingfei xiong is the corresponding author.evaluation formula.
on the other hand statistical debugging seeds a set of predicates into the programs collects whether they are covered and whether they are evaluated to true during test executions and calculates the suspiciousness of each predicate using a risk evaluation formula.
though being similar in the sense of using runtime coverage information to find the suspicious elements the two families have been developed mostly independently and researchers in each community explored different aspects of the approaches.
in the domain of sbfl different risk evaluation formulas have been proposed and compared both theoretically and empirically .
in the domain of sd different classes of predicates have been designed and studied .
since the basic ideas behind the two families are similar a question naturally raises whether is it possible to combine the strength of the two families and how would the combination perform?
to answer this question we build a unified model that captures the commonalities of the two approaches.
in this model sbfl is treated as a kind of predicate in sd sbfl risk evaluation formulas are mapped to sd risk evaluation formulas and the suspicious scores of predicates are mapped back to program elements.
in this way we can combine the two approaches as a unified one and explore different variation points.
based on this model we perform a systematic study to empirically explore four variation points.
predicates in sd a large number of predicates have been proposed.
we explore the performance of different predicate groups including three groups from sd and one group from sbfl.
we also explore the performance of combinations of the groups.
risk evaluation formulas particularly in sbfl a large number of risk evaluation formulas have been proposed.
in this paper we evaluate how the different formulas perform over sd predicates.
granularity of data collection existing studies have seeded predicates at different granularities e.g.
at the method level or at the statement level.
in this paper we explore the effect of seeding different predicates on the localization performance and the execution time.
methods for combining suspicious scores when mapping the suspicious scores from predicates to elements we 34th ieee acm international conference on automated software engineering ase .
ieee authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
need to combine the suspicious scores of different elements into one.
here we consider two ways of combining the scores the maximum of different predicates and the weighted sum of different predicates.
our empirical study is carried out over defects4j a collection of real world faults that are widely used in recent studies .
the empirical study leads to several findings as listed below.
among all predicates the predicates from branch conditions contribute most to the top recall of fault localization accuracy.
using sbfl formulas for sd predicates significantly increases the localization accuracy a .
increase in top compared with using original sd formula and a .
increase compared with a revised sd formula.
collecting information at the statement level leads to .
increase in localization accuracy with respect to top and .
increase in execution time compared to the method level.
however the overall localization time is still small i.e less than three minutes.
a linear combination of the suspicious scores from sbfl and sd predicates leads to the best results.
inspired by the above findings we proposed a new fault localization technique p red fl that combines the predicates of sbfl and sd under our unified model.
the evaluation results show that p red fl could improve the state of the art when further combined with other techniques.
in summary we make the following contributions in this paper.
a unified model for combining two popular families of fault localization techniques i.e.
spectrum based fault localization and statistical debugging.
a systematic analysis to explore different combinations between sbfl and sd under the framework with respect to four variation points which provides insights for future fault localization research.
a new fault localization technique coming from the systematic analysis p red fl was evaluated via a contrast experiment on a state of the art fault localization framework.
the results show that p red fl complements existing techniques and could further improve their effectiveness.
especially it achieved an up to .
improvement w.r.t top .
ii.
b ackground a. spectrum based fault localization spectrum based fault localization sbfl technique is one of the most popular approaches used in recent studies because of its simplicity and efficiency.
more concretely when given a faulty program and a set of test cases in which at least one test failed a typical spectrum based fault localization approach collects coverage information for each program element while running test cases and then employs a predefined risk evaluation formula to compute suspicious scores for program elements which represent how likely the elements are fautly.
the granularity of elements varies on demand andcommon granularities include statement and method.
different spectrum based fault localization approaches follow the same paradigm but use different formulas to compute the suspicious scores.
to make it more rigorous we next give the general form of spectrum based fault localization approaches formally.
a program eis a set of elements.
given a program element e e we define the following notations failed e denotes the number of failed test cases that cover program element e. passed e denotes the number of passed test cases that cover program element e. totalfailed denotes the number of all failed test cases.
totalpassed denotes the number of all passed test cases.
a risk evaluation formula is a function mapping each element to a suspicious score based on the above four values.
for instance a popular formula in sbfl technique is ochiai which is defined as below.
ochiai e failed e radicalbig totalfailed failed e passed e this formula reveals the basic idea of spectrum based fault localization approaches the more frequently executed by failed test cases the bigger the suspicious score of an element the more frequently executed by passed test cases the smaller the suspicious score and thus demonstrates the relationship between test cases and program elements.
an sbfl approach assigns suspicious scores to elements based on a risk evaluation formula.
given a risk evaluation formularand a program e a simple sbfl approach directly returns the suspicious score from rfor each element as follows.
sbflr simple e e r e e e .
recent approaches also consider collecting information at a granularity finer than the granularity of the target elements.
for example for method level fault localization several recent approaches first calculate the suspicious scores at the statement level and then take the highest suspicious score of the inner statements as the suspicious score of the method.
to model this behavior we introduce a granularity function g e 2ethat maps an element to a set of sub elements and then compute the suspicious score for each of them.
if we do not calculate suspicious scores at the sub element level g just map an element to itself.
given a risk evaluation formula r a granularity function g and a program e an sbfl approach is defined as follows.
sbflr g e e max ei g e r ei e e b. statistical debugging statistical debugging sd was originally proposed for remote debugging by liblit.
et al.
.
given a faulty program sd dynamically instruments the program with a set of predefined predicates.
then the program is deployed for execution where the values of predicates during executions authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
are collected.
based on the information collected from many executions sd identifies the important predicates that are related to the root cause of the failure.
more formally given a program we use a set pto denote the instances of predicates seeded into the program.
given a predicate instance p p we use the following notations to denote the information related to the predicate instance.
f p denotes the number of failed executions where pis evaluated to true at least once.
s p denotes the number of successful executions where pis evaluated to true at least once.
f0 p denotes the number of failed executions where p is covered.
s0 p denotes the number of successful executions where pis covered.
similar to sbfl sd uses a formula to determine the suspiciousness of a predicate known as the importance score in the sd context.
an importance formula ifor sd is a function that maps an element to an importance score based on the above values.
a standard importance formula is defined as follows.
importance p increase p sensitive p where increase p f p s p f p fo p so p fo p sensitive p log f p log totalfailed in equation the importance formula is the harmonic mean of two compositions increase p and sensitive p where increase p distinguishes the value distributions of predicate pfor failed executions among all executions that cover p while sensitive p captures how often failed test cases evaluate predicate pto true.
the more frequently being true of predicate pin failed executions the bigger the importance score of p. the less frequently being true of pin failed executions the smaller the importance score of p. hence the importance formula reflects the relationship between test cases and the value of predicates.
in the rest of the paper we shall refer the above importance formula as the sd formula.
particularly when totalfailed the score of predicate is to avoid divide by zero error according to the definition in the paper .
a typical sd approach uses three groups of predefined predicates branches returns and scalar pairs .
the branches group includes all conditional expressions and their negations in the program such as the expression in an ifstatement.
the returns group compares the method return value if exists with constant with respect to a set of comparators i.e.
and negationslash .
the scalar pairs denotes comparing the left value of an assignment with all in scope variables or constants with the same type.the three groups of predicates are inserted into different locations of the program.
as described by the predicate definitions the branches predicates are instrumented into the locations of conditional expressions the returns predicates are instrumented into the locations of return statements while the scalar pairs predicates are instrumented into the locations of assignments or variable declarations.
to model the seeding of predicates we define the concept of seeding function.
a seeding function smaps a program element to a set of predicate instances.
by using different seeding functions we get different sets of predicate instances.
given an importance formula i a seeding function s a ns d approach is a function mapping a program a set of elements to a set of predicate instances with their importance scores.
sdi s e p i p p s e e e iii.
t heunified model as we can see from the previous section there are many commonalities between the two families of approaches e.g.
both approaches use a formula to score elements.
therefore it is possible to build a model that combines the two approaches.
the basic idea of our model is to treat sbfl as a kind of predicate in sd.
since sbfl concerns about the coverage of an element its behavior can be captured by a predicate true which evaluates to true whenever the element is covered.
formally given an instance of predicate true at element e truee we define its runtime information as follows.
f truee f0 truee failed e s truee s0 truee passed e also we would like to use the sbfl formulas for sd predicates.
since sbfl relies on function failed and passed we need to make these functions work for predicate instances.
given a predicate instance p we define the following.
failed p f p passed p s p please note here we use f p ands p instead of f0 p ands0 p because choosing the latter two would lead to the same suspicious score for all predicates inserted at the same elements.
in other words we view each predicate as a sub element that captures a subset of states at a specific program point.
based on this unification we shall not distinguish risk evaluation formulas and importance formulas and address them uniformly as risk evaluation formulas.
furthermore sbfl and sd have different results while sbfl gives a list of suspicious program elements sd gives a list of important predicates.
to unify the results we return a list of suspicious elements in the unified model.
we assume the existence of a high order function that aggregates the importance scores of each predicate instance to produce the suspicious score of the program element called combining method.
a combining method cis a function that takes a seeding function s a risk evaluation formula rand an element e and produces the suspicious score of e. a basic combining authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
method is to take the maximum importance score of all predicates.
c s e r max p s e r p putting everything together we can define the unified approach of sbfl and sd.
given a seeding function s a risk evaluation formula r a granularity function g and a combining methodc a unified approach is defined as follows.
unis r g c e e max ei g e c s e i r e e as we can see from equation the unified approach is parameterized on four components s r g andc.i n the following sections we shall systematically explore the variations of the four components.
iv .
e mpirical study setup in this section we systematically explore the variations of the four components in the unified model.
we first explain the research questions then introduce the experiment setup including the subjects used in the experiment and the variations for each component.
finally we present the evaluation metrics and experiment implementation.
a. research questions which kinds of predicates are most important?
after treating sbfl as a predicate in the unified model we have an even richer set of predicates than sd approaches.
in this question we explore the effectiveness of different predicate groups and understand which kinds of predicates contributed the effectiveness most.
how does the risk evaluation formula impact the effectiveness of fault localization?
existing researches have both theoretically and empirically studied different risk evaluation formulas in the sbfl scenario .
in this research question we also selected a set of representative formulas to explore the effects of different ones under our unified model.
how does the granularity of data collection impact the fault localization result?
recently proposed method level fault localization approaches collect program coverage data from two different granularities which are statement level and method level .
intuitively the finer the granularity the better localization accuracy and the longer execution time.
however this intuitive proposition has not been evaluated in existing studies nor it is clear how much the increases at localization accuracy and execution time will be.
therefore in this question we aim to explore the impact of different granularity functions to the effectiveness and efficiency of fault localization approach via a contrast experiment.
how does combining method among different predicates impact the effectiveness of fault localization?
in the unified model we need to combine the suspicious scores of the predicates to form the scores of the program elements.
in this research question we explore two basicways of combination the maximum suspicious score of all predicates and the linear combination of all suspicious scores details in section iv c4 .
b. subject projects we conducted the experiments on the defects4j v1.
.
benchmark which is a commonly used dataset in automatic fault localization and program repair studies .
it contains real world faults from five large open source projects in java language.
jfree chart is a framework to create chart google closure is a javascript compiler for optimization apache commonslang and commons math are two libraries complementing the existings in jdk while joda time is a standard time library.
the subjects involve diversity applications with different scales from 22k to 96k loc of source code which is listed in table i. table i details of the experiment benchmark.
project bugs kloc tests jfree chart apache commons math apache commons lang joda time closure compiler total in the table column bugs denotes the total number of faults in the benchmark column kloc denotes the average number of thousands of lines of code in a faulty program and column tests denotes the total number of test cases for each project.
c. experiment configuration to answer the research questions above we first define a set of variations for each component of our model and together these variations form a four dimensional design space of the combined approach.
since the whole space is large and not feasible to fully traverse we first choose a default configuration which was selected by a pilot study on bugs randomly sampled.
to ensure the representativeness of the selected bugs we evenly and randomly sampled bugs from each project in defects4j benchmark shown in table i. then each time we change one component over the default configuration in the evaluation.
in the following we introduce the variations we considered for the four components as well as the default variation we choose for each component.
in our study we focus on method level fault localization.
that is the fault localization method assigns a suspicious value for each method.
as argued by several existing studies method level is more suitable for developers than other granularities such as file level and statement level.
predicates to explore the performance of different predicates we follow the original classification of statistical debugging that divides the predicates into three groups i.e.
branches returns and scalar pairs .
additionally we consider authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
the predicates of sbfl as a separate group.
therefore in total there are four groups of predicates.
especially when we study a specific group of predicates the scores of predicates in other groups will be always since they are not seeded.
however for other explorations we use all the predicates i.e.
all four groups of predicates by default.
risk evaluation f ormulas to compare the difference of effectiveness among risk evaluation formulas we selected seven formulas in total five from spectrum based fault localization and two from statistical debugging.
according to the definition in section ii b when totalfailed a prevalent case in defects4j benchmark the score of predicate will be .
to mitigate this influence besides the original sd formula we additionally employed a formula derived from it with minor changes called newsd.
table ii presents the definitions of all formulas used in our evaluation except sd which is defined by equation .
particularly we use the ochiai commonly used in recent studies on fault localization and program repair as the default risk evaluation formula in our experiments.
table ii formulas employed in the experiment.
name formula ochiai r p failed p totalfailed failed p passed p tarantula r p failed p totalfailed failed p totalfailed passed p totalpassed barinel r p passed p passed p failed p dstar r p failed p passed p totalfailed failed p op2 r p failed p passed p totalpassed newsd r p increase p log totalfailed log f p the variable in the formula is greater than .
here we set its value as which is also employed by previous study .
function increase p in newsd is the same as it is in equation .
granularity of data collection to localize faults in methods we explore two granularity functions that respectively collect predicate coverage data at method level and statement level.
the granularity function at statement level maps each method to the set of statements inside the method while the granularity function at method level maps each method to a set containing itself.
the default variation for the granularity function is the one at statement level.
methods for combining suspicious scores in this paper we use max or linear functions to combine all predicates.
however when using linear combination the number of components should be fixed so we linearly combine sbfl predicates with all the rest under our unified model.
we call these two combining methods as m axpred i.e.
m ax score of p red icates and l inpred i.e.
l inear score combination of p red icates respectively.
more formally when given a seeding function sand a risk evaluation function r we define the combining methods as follows.maxpred given a program element e we compute its suspicious score as the maximum score of all predicates related to it i.e.
c s e r max p s e r p .
linpred given a program element e we partition the predicates related to it into two standalone sets p1andp2 wherep1 p2 s e andp1contains one predicate from sbfl while the others constitute p2.
then the combining method is defined as c s e r max p p1r p max p p2r p where .
particularly we set the default variation for the combining method in the experiments as l inpred and the default coefficient is .
.
d. evaluation metrics to evaluate the effectiveness of fault localization techniques we employed two metrics that are usually employed by existing studies.
recall of top k .
this metric is used to measure how many faults can be located within top k program elements among all candidates.
in a survey conducted by kochhar et al.
practitioners think that inspecting program elements is acceptable and almost all practitioners agree that elements are the upper bound for inspection within their acceptability level.
therefore in this paper we consider ranks within top k locations where k .
moreover we take the mean rank of a program element to break the tie when multiple elements have the same suspicious scores like exiting approaches .
specifically we use ceiling function to normalize ranks to integers.
exam score .
this metric is used to measure the percentage of program elements that need to be inspected by developers among all candidates before reaching the first desired faulty element reflecting the relative ranks of faulty elements among all candidates and the overall effectiveness of a fault localization approach.
as a result many previous studies employed this metric as well.
the smaller the exam score is the better the result is.
e. implementation to collect coverage information for program element at runtime we implemented a program instrument framework that can statically instrument programs at both statement and method level in the source code.
this framework is built atop the eclipse java development tool jdt library1 which is a java source code manipulation framework that provides plentiful operations to java code such as source code deletion insertion and replacement.
besides it also provides the ability to parse types of variables or complex expressions which is helpful for generating predicates of statistical debugging since those predefined predicates depend on the types of variables or expressions.
moreover the instrumented program can preserve the semantics of the original progam and is free from side effects.
our implementation is publicly available at authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
v. r esult and analysis in this section we present our experimental results in detail with respect to the research questions introduced in section iv a. a. effectiveness of individual predicates in this section we explore the effectiveness of four different groups of predicates explained in section iv c1 and their results are shown in figure where x axis denotes different groups of predicates while y axis denotes the percentages of faults that successfully located within the corresponding topk recall.
additionally we present the corresponding exam score beneath the group names of predicates.
for all following figures we employ the same notations consistently for all figures and will not introduce them redundantly later.
!
!
!
!
!
!
!
fig.
fault localization results when only employing individual group of predicates.
from the figure we can see that the predicates from branches achieved the best result with respect to top against any other group of predicates but the predicates from sbfl are also effective since it achieved the best result on top and obtained the best exam score.
compared with the other two groups of predicates i.e.
returns and scalar pairs the results show that the predicates of branches perform significantly better with about .
.
times improvements in terms of top1.
besides the exam scores of both sbfl and branches are merit against the others.
then we further analyzed the reason for this and found that a majority of faults are related to existing conditional expressions included by both sbfl and branches which was also observed by previous studies .
furthermore to investigate whether different groups of predicates complement each other we analyzed the fault localization results of several sampled combinations of different group predicates and present their results in figure .
from the figure we can find that the combination of predicates from sbfl and branches achieves almost the same result with the approach using all the predicates the first column in the figure and outperforms the other combinations where the improvements are from .
to .
on top1.
moreover by comparing figure and the combined approaches are superior to those with standalone group of predicates in terms of either top or exam score which denotes that different groups of predicates complement each !
!
!
!
!
!
!
!
!
fig.
fault localization results when considering the combination among different groups of predicates.
other to some extent.
furthermore the most contributors of the combined approach are predicates from sbfl and branches of sd.
the figure also presents that the combination of these two groups of predicates performs as good as that using all predicates and better than others.
finding .
among all predicates those from existing branch conditions and the sbfl predicates are two most important groups that contribute to the accurate fault localization result in our experiment.
moreover existing conditions contribute most to our combined approaches with respect to top .
b. different risk evaluation formulas figure presents the fault localization results of l inpred when employing different risk evaluation formulas.
this figure shows the top k recall and exam score for each formula.
in the figure sd denotes the risk evaluation formula of original statistical debugging defined by equation .
the other formulas are defined in table ii.
as shown in the figure there is no significant difference for both top k and exam score among the results except for those of sd and newsd which is consistent with the previous studies that different risk evaluation formulas do not produce significant difference on fault localization results.
however we can notice the difference between two different kinds of formulas i.e.
formulas of sbfl and statistical debugging where the former significantly outperform the latter in our experiment with an up to .
increase at top against the original sd formula.
as explained in section ii b the sd formula was originally designed for remote sampling where usually more than one failed test case exist.
however in our evaluation scenario usually a bug is triggered by only one test case.
the result comparison shows that this has a great impact on the effectiveness of sd formula since newsd successfully located double number .
vs .
of faults at top compared with the sd formula.
however it is still lower than the results of sbfl formulas which located on average .
faults at top .
it reveals that the formulas from sbfl are better at authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
!
fig.
fault localization results when using different risk evaluation formulas.
distinguishing the difference of predicates among failed and passed executions in our experiment.
finding .
the risk evaluation formulas of sbfl significantly outperform the original sd formula in the experiment with an up to .
improvements in terms of fault numbers located at top .
c. different granularity of data collection in this section we explore the effectiveness of fault localization appoaches under different granularity functions of data collection.
figure presents the statistical results of our experiment where the x axis denotes the granularity of data collection i.e.
statement and method level in our evaluation.
fig.
comparison of fault localization results under statement and method level data collection.
based on the figure the fault localization result when collecting predicate data at statement level is much better than that at method level with respect to both the recall of topk k and the exam score.
more specifically the former increased up to .
with respect to top against the latter.
this result reflects the fine grained data collection has a more powerful capability to distinguish fault related program elements which is consistent with our intuition.finding .
fine grained data collection statement level contributes .
better fault localization result than the coarse grained data collection method level .
however scalability is also essential to fault localization approaches to make it practical.
in the study conducted by kochhar et al.
the satisfaction rate of practitioners increases along with the scalability of fault localization approaches.
it is intuitive to us that finer granularity tend to cause larger overhead to data collection since more predicates will be considered and gathered thus we analyzed the execution overhead under different data collection functions as well.
we found that on average the predicates collected at statement level is much more than those collected at method level about .
times while the test execution time is only .
times.
moreover the execution time of either statement or method level data collection is still less than three minutes on average usually hours for mutation based fault localization which is relatively small and denotes the increase of predicates does not heavily damage the efficiency of fault localization approaches.
finding .
statement level data collection results in .
times as many predicates as method level while uses .
times as much as execution time.
the overall execution time is still less than minutes.
d. different combining methods in this section we compare the effectiveness of fault localization approaches using different combining methods under our unified model which are m axpred using max function and l inpred using linear function as introduced in section iv c4.
we present our experimental results in figure .
in order to understand the improvement on effectiveness of the combined approaches against individuals we also redundantly show the results of traditional sbfl and sd approaches in the figure.
!
!
fig.
result comparison among traditional sbfl and sd approaches with the combined methods.
from the figure the combined approaches can improve both the original sd and sbfl techniques with respect to top1.
however we can notice that the improvements are quite different where the result of m axpred is almost the same authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
with sbfl while the result of l inpred is much better than all the others with respectively .
and .
improvements against traditional sd and sbfl.
in fact the reason is simple on the one hand both groups of predicates from sbfl and sd contain existing conditions which contribute the most to top1 as concluded in the previous evaluation.
on the other hand both predicates from these two groups potentially contain predicates that will damage the fault localization accuracy i.e.
predicates with high suspicious scores at non faulty locations we call these predicates noises.
take the fault math as an example when only employing individual predicates either from sbfl or sd two candidate faulty methods m1andm2for sbfl m1andm3for sd share the highest rank with the same suspicious score as .
respectively resulting in the faulty method ranked 2nd.
therefore after taking the linear combination l inpred successfully ranked the faulty method m1at top with mitigating the noises from individual sources which cannot be overcome by m axpred .
as a result the improvement of l inpred is significant but not that of m axpred .
moreover the result indicates that these two sources of predicates predicates from sbfl and sd complement each other only if we take the proper combination of them.
as a matter of fact in theory see section ii a and section ii b both sbfl and sd predicates have limitations.
for sbfl since all the predicates related to different program elements are constant true they cannot distinguish program elements in the same execution path though the program states at these program elements can be different.
on the other hand for sd since the predicates only exist at some selective locations e.g.
the location of conditional expression they will fail to identify those faulty elements that do not contain them.
however by combining the predicates from these two source the predicates from sbfl can alleviate the predicate absence of sd in some program elements while the more concrete predicates from sd can assist sbfl in better distinguishing program elements in a same path.
for example the following code snippet comes from the math project.
1public double getsumsquarederrors return sumyy sumxy sumxy sumxx return math.max 0d sumyy sumxy sumxy sumxx listing faulty code snippet of math in defects4j.
in the code snippet the return statement in line is faulty whose repair code is shown in line .
individually based on the predicates from sbfl the faulty location was ranked 8th among all the candidate locations.
however after involving the sd predicates the ranking of the faulty location ranked 1st.
the key contributor is the predicate of sumyy sumxy sumxy sumxx defined by returns in sd which exactly captures the root cause of the fault.
similarly as another example for the fault math the faulty method does not contain any predicates of sd causing it ranked relativelylow rank 6th .
however the combined approach successfully ranked the faulty method at top .
fig.
the result comparison of l inpred with different coefficients.
from the above explanation both the complementarity and the individual limitations should be deliberated to design a relatively good combining method.
therefore we further explored different coefficient values of the linear combination and presented the results in figure .
from this figure l inpred is always superior to the original sbfl approach when with respect to the recall of top1 though the improvements varies along with the value of .
particularly when falls into the interval of linpred performs best.
all in all the combining approaches are relatively merit.
however we only explored several simple combinations in this paper i.e.
m axpred and l inpred more thorough investigations of potential combinations will be studied in future work.
finding .
the linear combination of sbfl and sd predicates linpred performs .
better w.r .t top compared to the combination with max function maxpred .
especially when the coefficient falls into linpred achieves the best result.
vi.
p red fl and its performance according to the previous analysis we could find that the combined approach under the unified model is effective and better than each standalone technique.
additionally from the experimental results we can conclude that the combined approach with the default configurations for all variations is relatively merit in contrast with others.
therefore we propose a new fault localization approach via instantiating the unified model with all default configurations i.e.
collecting all groups of predicates at statement level and linearly combining predicate scores computed with ochiai formula.
for convenient reference we call this approach as p red fl.
although standalone fault localization approaches have gained a big success in the last decade recently researchers have noticed the benefit of combining different data sources or existing fault localization techniques to improve state of the art techniques.
based on the previous investigation each standalone approach has advantages and authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
limitations.
therefore by combining different kinds of techniques it potentially could exert their strength while mitigating limitations.
as a result such combining techniques already benefit state of the art fault localization approaches .
since different information have been utilized by these combining techniques hence a question naturally raises whether our approach p red fl is already implicitly covered by existing techniques.
in other words is p red fl complementary to existing techniques?
therefore in this section we explore the potential of pred fl to improve state of the art fault localization techniques for which we integrated p red fl with a state ofthe art fault localization framework developed by zou et al.
c ombine fl for short.
it has achieved better fault localization results compared with other state of the art approaches including multric savant trapt and fluccs .
as a result to check whether our approach is complementary to existing approaches we combine our approach with this framework and check whether the combination brings any improvements.
more concretely the current implementation of combine fl consists of spectrum mutation history and ir based fault localization techniques stacktrace analysis dynamic slicing and predicate switching technique .
different techniques can be freely assembled.
especially based on the time used to perform fault localization including data collection of different techniques they are further classified into four levels and listed in table iii.
for example if we would like to locate the faulty elements within minutes we can use all the techniques in level and level together.
according to our empirical study results in section v the execution time of p red fl is less than three minutes.
therefore in this contrast experiment we also selected the same execution time configuration i.e.
integrating pred fl with those techniques in level techniques in level were included .
additionally we employed level as well since it contains almost all existing techniques where we fed the results of p red fl together with those of other techniques into the framework.
also we performed method level fault localization on defects4j benchmark.
table iii different integration levels of c ombine fl framework according to execution time.
time level family technique level seconds history based bugspots stack trace stack trace ir based buglocator level minutes slicingunion intersection and frequency spectrum based ochiai and dstar level ten minutes predicate switching predicate switching level hours mutation based metallaxis and muse table iv presents the results in detail.
from the table we can see that after integrating our approach all the results areimproved from .
.
vs .
to .
.
vs .
.
furthermore p red fl even improves the fault localization effectiveness on each individual project w.r.t top1.
especially after integrating p red fl the fault localization results at level are even better than those at level without pred fl.
please note since the current implementation of combine fl is already superior to all existing techniques as evaluated in their paper we do not redundantly compare those techniques here because the integrated approach is already more effective than the original one.
finding .
our combined approach pred fl that linearly combines predicates from sbfl and sd can further improve existing techniques and the improvement can be up to .
in terms of top which denotes our approach complements existing techniques.
vii.
i mplica tions for future study a. predicate selection from the experimental results we can see that the selection of predicates play an important role in the performance of the fault localization.
on the one hand not all predicates play an equal role in identifying the faulty locations.
as our experiment results predicate group branches contributes most to the accuracy of fault localization while some predicates may even play negative roles the performance of all predicates is sometimes lower than using the predicates from one group.
on the other hand the performance of a predicate group may vary depending on where the predicates are seeded.
for example the following code snippet in listing shows a patch for bug chart in defects4j benchmark.
1if start null throw new illegalargumentexception ... if endindex if endindex endindex startindex listing patch of chart in defects4j benchmark.
from the patch we can see that the root cause is the condition of the second ifstatement in line where an additional condition expression endindex startindex should be inserted as shown in line .
however after calculating the suspiciousness scores of predicates from the branches group we will notice that the predicate !
start null taken from line has higher suspiciousness than the predicate endindex from line leading to an incorrect localization of line .
that is while generally the branches group plays positive role it may also lead to negative effects.
based on the observation one potential direction to improve this kind of situation is developing a more effective approach for selecting predicates.
since the performance of predicates vary from location to location the selection should also be conditional over the context of the predicates.
techniques such as machine learning or invariant generation may be used.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table iv integration fault localization results with existing techniques on defects4j benchmark.
level level top top top top top top top top chart math lang time closure total percent .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
in the table the columns leading by denote the original result of the fault localization framework c ombine fl while the columns leading by denote the result after integrating p red fl.
b. better f ormulas in our study we found that applying sbfl formulas to sd predicates could achieve significantly better performance.
however sbfl formulas are designed for program elements and thus may not be the best choice for sd predicates.
for instance sbfl formulas do not utilize the two values f0 ands0.
future studies could explore the design space of risk evaluation formulas and check if better formulas could be discovered.
viii.
d iscussion threats to internal validity is related to errors and selection bias in the experiment.
to mitigate this risk two authors of the paper with at least five year developing experience carefully checked the implementation of our experiment with code review.
moreover we have also run our approach multiple times to further guarantee the correctness of implementation.
besides the selection of metrics in our experiment may also affect the evaluation results and corresponding conclusions.
to tackle this problem we selected two distinct metrics in our study i.e.
top k recall and exam score both of which are prevalently employed by previous research.
threats to external validity is related to the generalizability of our approach.
in our experiment we selected a commonly used benchmark defects4j as our experimental dataset which contains faults from real world projects related to diverse software projects.
moreover we presented and discussed the final results against existing approaches to show the effectiveness of our combined approach.
as studied by just et al.
that developer provided triggering test cases could potentially overestimate the performance of fault localization techniques.
this paper inherits this threat from the dataset as well.
however the results of our study are still informative with multiple dimension comparisons.
moreover the unified model and the implications learned from the study are free from this threat.
ix.
r ela ted work in this section we discuss related work with respect to four aspects.
first we explain spectrum based fault localization and statistical debugging techniques explored in this paper.
then we discuss recent fault localization approaches that combinedifferent techniques to improve state of the art.
finally we discuss existing empirical analysis on fault localization.
spectrum based fault localization is one of the most prevalent fault localization techniques which is broadly utilized in program debugging such as automatic program repair .
in the past decade many sbfl approaches have been proposed.
for example tarantula is a representative approach early proposed by jones and harrold then abreu and colleagues did a more thorough study on it and proposed a superior formula ochiai which is often used to measure similarity in the molecular biology domain.
recently some other formulas were proposed .
though many approaches exist as introduced in section ii a different sbfl approaches follow the same paradigm that leverages program syntax coverage to compute suspicious scores for candidate program elements with a predefined formula.
recently sbfl has been employed in different domains such as in sql predicates model transformations logicbased reasoning compiler bug isolation and software product line where it performs effective.
besides existing studies try to improve sbfl technique with other optimized information such as suspicious variables and reduced test cases by delta debugging or incorporating techniques like data augmented diagnosis and feedback based goodness estimate .
in contrast in this paper we further explore the effectiveness of sbfl predicates and formulas by combining statistical debugging under a unified model.
like existing studies we selected a set of representative formulas in our evaluation to mitigate the selection bias.
we leave a more thorough comparison among different formulas to future work.
statistical debugging was proposed for remote program sampling by liblit et al.
.
in the past years many approaches have been proposed devoting to improving statistical debugging.
arumuga nainar et al.
proposed to combine simple predicates to complex ones in order to improve the distinguishing ability of them.
zheng et al.
proposed to use a machine learning model to isolate predicates to clusters each of which ideally can capture one single fault in a program that contains multiple faults.
similarly jiang and su proposed to cluster selected predicates to reconstruct candidate paths that are most likely to be faulty.
liu et al.
proposed a new formula to compute the scores of predi511 authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
cates which distinguishes the predicate coverage distributions among failed and passed tests.
arumuga nainar and liblit proposed to reduce the performance overhead of statistical debugging with adaptive binary instrumentation along a set of heuristics and zuo et.
al improved the performance of statistical debugging with abstraction refinement.
recently chilimbi and colleagues proposed to improve traditional statistical debugging with path profiling while y u et al.
utilize predicates to reduce test cases.
in this paper we further explore the effectiveness of different predicates of sbfl and statistical debugging and investigate their different combinations aiming to boost current fault localization techniques which is orthogonal to existing studies.
fault localization combination denotes exploring different combination methods among fault localization techniques.
recently many approaches have been proposed and improved the state of the art.
santelices et al.
explored three kinds of coverage information statement branch and define use pair coverage where they found that the combination of three kinds of coverage can improve individual techniques.
recently tu et al.
proposed to combine sbfl with slicing hitting setcomputation which improves the effectiveness of sbfl.
xuan and monperrus proposed to leverage a learning to rank method to combine dozens of sbfl formulas which obtained significant improvement against single formula.
similarly lucia et al.
proposed to fuse the diversity of existing spectrum based fault localization techniques with considering dozens of variants of their combinations.
wang et al.
proposed to employ genetic algorithm and simulated annealing to look for optimal solutions for the combination of different spectrum based fault localization techniques.
both of them were evaluated to outperform individual approaches.
recently several approaches have been proposed to leverage a learningto rank model to combine sbfl and supplementary information such as invariants mined from executions bug reports code changes and mutant coverage and improved existing techniques.
additionally li et al.
leveraged deep learning models to combine various features from the fault localization defect prediction and information retrieval areas to further improve the state of theart techniques.
in this paper we proposed a unified model of sbfl and statistical debugging based on which we first systematically explored four different variations under the model.
as a result we found the effective configuration for each individual variation and proposed a simple combining method that incorporates their merits which is evaluated to be effective and efficient.
moreover our approach is orthogonal to existing techniques and evaluated to have the potential to further improve the state of the art.
empirical analysis on the performance of fault localization mainly focuses on analyzing existing fault localization techniques and investigating the essence of effectiveness.
harrold et al.
studied the relationships between program spectra and faults which established the foundation of sbfl.
recently.
xie et al.
and chen et al.
have theoretically revisited different formulas of sbfl approaches and foundthat there dose not exist the best formula that significantly outperforms the others.
pearson et al.
systematically explored the effectiveness of sbfl approaches and mutation based fault localization on both real word faults and artificial faults where they found the artificial faults are not significantly useful for predicting which fault localization techniques perform best on real faults.
in this paper we explored four variations that contributed to the improvement of combining different predicates based on which we proposed a simple and effective fault localization approach.
moreover our analysis provide several implications for future fault localization studies.
empirical analysis on the usefulness of fault localization investigates the usability of automated fault localization techniques in practice.
recently parnin and orso and xie et al.
studied the usefulness of automated fault localization techniques and observed that improvements in fault localization accuracy may not translate to improved manual debugging directly and even weaken programmers abilities in fault detection.
however a more rigorous study on larger scale real world bugs performed by xia et al.
reported that automated fault localization can positively impact debugging success and efficiency.
moreover they found that the more accurate the fault localization results are the more efficient the debugging process will be demonstrating the practicability of automated fault localization techniques in practice.
similarly debroy and wong empirically evaluated that better fault localization can potentially improve the effectiveness of faultfixing processes as well.
as a consequence in this paper we target to improve the accuracy of current fault localization techniques and explore the combination of spectrum based fault localization and statistical debugging.
x. c onclusion in this paper we empirically investigated different combinations of spectrum based fault localization and statistical debugging techniques for which we proposed a unified model.
in addition we systematically explored four variations under the model which leads to several findings among all predicates those from existing conditions contribute most to the top fault localization accuracy fine grained data collection contributes more effective fault localization with little more execution overhead a linear combination of suspicious scores from sbfl and sd predicates leads to the best result.
based on our findings we proposed a new fault localization technique p red fl which is evaluated to be complementary to existing techniques as it could further improve state of the art by combining with existing techniques.
acknowledgment this work was partially supported by the national key research and development program of china under grant no.2017yfb1001803 and national natural science foundation of china under grant nos.
and .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.