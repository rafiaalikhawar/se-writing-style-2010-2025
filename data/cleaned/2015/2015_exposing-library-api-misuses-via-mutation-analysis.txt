exposing library api misuses via mutation analysis ming wen yepang liuyk rongxin wu xuan xiez shing chi cheung and zhendong sux department of computer science and engineering the hong kong university of science and technology hong kong china email fmwenaa wurongxin scc g cse.ust.hk yshenzhen key laboratory of computational intelligence southern university of science and technology shenzhen china.
email liuyp1 sustc.edu.cn zsun yat sen university china.
email xiex27 mail2.sysu.edu.cn xeth zurich switzerland.
email zhendong.su inf.ethz.ch uc davis usa abstract misuses of library apis are pervasive and often lead to software crashes and vulnerability issues.
various static analysis tools have been proposed to detect library api misuses.
they often involve mining frequent patterns from a large number of correct api usage examples which can be hard to obtain in practice.
they also suffer from low precision due to an over simplified assumption that a deviation from frequent usage patterns indicates a misuse.
we make two observations on the discovery of api misuse patterns.
first api misuses can be represented as mutants of the corresponding correct usages.
second whether a mutant will introduce a misuse can be validated via executing it against a test suite and analyzing the execution information.
based on these observations we propose m utapi the first approach to discovering api misuse patterns via mutation analysis.
to effectively mimic api misuses based on correct usages we first design eight effective mutation operators inspired by the common characteristics of api misuses.
m utapigenerates mutants by applying these mutation operators on a set of client projects and collects mutant killing tests as well as the associated stack traces.
misuse patterns are discovered from the killed mutants that are prioritized according to their likelihood of causing api misuses based on the collected information.
we applied m utapion client projects with respect to popular java apis.
the results show that m utapiis able to discover substantial api misuse patterns with a high precision of .
it also achieves a recall of0 49on the m ubench benchmark which outperforms the state of the art techniques.
index terms mutation analysis library api misuses i. i ntroduction the use of third party libraries in java projects is common.
according to a recent study a java project directly depends on different libraries on average.
the maven repository has indexed over .
millions third party libraries.
however correct usages of application programming interfaces apis provided by many third party libraries are loosely documented or left unrevised after api updates .
as a result api misuses are pervasive and account for a major cause of software bugs e.g.
performance issues software crashes and vulnerability issues .
to detect api misuses various static analysis tools have been proposed .
these tools commonly mine api usage patterns from software codebases.
those frequent patterns are deemed as correct api usages whereas deviations from such patterns are regarded as misuses.
kyepang liu is the corresponding authora recent study reported that existing static analysis based api misuse detectors suffer from low recall and precision in practical settings .
the study also made suggestions to address the two limitations.
first to improve recall existing detectors need to mine frequent patterns from more correct api usage examples .
however it is difficult to obtain sufficient correct api usage examples in practice especially for newly released libraries.
second to improve precision the detectors need to go beyond the oversimplified assumption that a deviation from frequent usage patterns is a misuse .
an uncommon usage of an api is not necessarily an incorrect usage.
in this study we propose to approach the problem of api misuse patterns discovery from a new perspective through mutation analysis .
mutation analysis has been widely used in software debugging and testing .
it mainly contains two steps.
first it creates substantial mutants by making small modifications to a program with a set of well defined mutation operators that mimic different kinds of programming mistakes.
second it runs a given test suite on the mutants and collects execution information for various quality analyses .
our solution is inspired by two observations.
first various misuses of an api can be viewed as the mutants of this api s correct usages.
therefore api misuses can be created via applying specifically designed mutation operators on correct api usages.
the design of these mutation operators can be guided by the characteristics of common api misuse patterns which have been well investigated by existing studies .
for instance one misuse pattern is missing exception handling .
many apis could throw exceptions and the correct usages of these apis require appropriate exception handling.
given one correct usage of such apis we can actively violate the correct usage e.g.
by deleting the exception handlers to create an api misuse.
other patterns of api misuses e.g.
missing method call can be similarly created via applying certain mutation operators e.g.
deleting method call .
in this way we can obtain substantial mutants based on an api s correct usages.
unlike existing work our solution does not require pattern mining from a large number of correct api usages.
instead it actively creates substantial mutants mimicking api misuses of different patterns.
however deciding if a mutant such created introduces an api misuse is challenging since the manifestation patterns of different api ieee acm 41st international conference on software engineering icse .
ieee authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
misuses are divergent.
our intuition to address this challenge is that we can validate whether a mutant introduces an api misuse via executing it against the correct usages test suites and analyzing the execution information.
this intuition is inspired by the observation that substantial tests of well maintained projects would trigger library usages during execution section ii c .
therefore we conjecture that library api misuses can be exposed and validated via running the test suites of client projects confirmed in section v a .
in this way our solution does not make the assumption that a deviation from frequent api usage patterns is a misuse.
in this paper we propose m utapi an automatic approach that leverages mutation analysis to discover apimisuse patterns.
to effectively discover api misuse patterns m utapiaddresses the following three challenges.
first discovering api misuse patterns requires m utapito generate mutants that violate existing correct usages and thus how to effectively generate mutants that mimic api misuses is the key.
conventional mutation operators such as those defined by p it are less likely to achieve such a goal section v c .
to address the challenge we first investigate how to model correct api usages and then break the modelled usages systematically.
inspired by a recent study m utapimodels correct api usages as structured call sequences based on a predefined grammar.
we then designed eight types of novel mutation operators with the aim to actively violate such modeled usages in a systematic way section iii a .
with these mutation operators m utapigenerates substantial mutants by applying them on certain client projects that use a target api.
mutapithen runs those mutants against the test suites of the client projects and collects killing relations which includes the killed mutants and the corresponding killing tests .
a mutant is killed if its test output differs from that of the original program.
second how to validate whether a mutant indeed introduces an api misuse is another challenge.
one possible way is to check whether a mutant has been killed by the test suite.
however a mutant can be killed due to multiple reasons e.g.
a logic bug unrelated to any api misuses .
how to precisely identify those killing relations arising from api misuses is a key challenging.
m utapiaddresses this challenging via analyzing the failing stack traces of the killing tests denoted as killing stack trace .
specifically it leverages the killing stack traces to prioritize killing relations based on the following observations.
first given a killing stack trace the failure s root cause appears closer to the failure point .
therefore if the top frames of a killing stack trace are library functions it is more likely to be caused by api misuses i.e.
the root cause resides in the api calls .
second killing stack traces of a target api should be specific to this api.
if a killing stack trace is also observed in the mutation analysis of other apis it is less likely to be caused by the target api s misuses.
third killing stack traces of a target api should not be specific to a certain usage.
if a killing stack trace is only observed in the mutation analysis of a specific project it is more likely to be caused by the bugs specific to this project instead of a general misuse of the target api.
m utapileverages thesethree observations to prioritize observed killing realtions and assumes those top ranked ones to be caused by the misuses of the target api.
third how to effectively distill api misuse patterns after identifying a set of killing relations arising from api misuses is also a challenge.
to address this challenge m utapidistills api misuses from substantial killed mutants of the identified killing relations.
specifically it first models an api misuse as a pair of a violation type and an api usage element following the findings of recent studies .
it then selects those most frequently observed violation pairs as api misuse patterns.
to evaluate m utapi we selected popular java apis collected by recent studies and client projects collected from popular repositories on github.
the evaluation results show that m utapiis able to achieve a high precision of0 78in discovering real misuse patterns of popular apis.
it also achieves a higher recall on the benchmark dataset mubench compared with the state of the art techniques.
in summary this paper makes the following contributions.
originality to the best of our knowledge this is the first study that applies mutation analysis to discover api misuse patterns and empirical evidences have shown that it is effective in exposing and discovering api misuse patterns.
implementation we implemented our approach m utapi as a tool that can detect api misuse patterns of java libraries.
it employs a set of new mutation operators which have shown to be effective in dicovering different api misuse patterns.
evaluation our evaluation results show that m utapican discover real misuse patterns of popular java apis with high precisions.
it also detects more misuse instances on the benchmark dataset m ubench compared with existing approaches.
ii.
r elated work and preliminaries in this section we first introduce related work on mutation analysis and api misuse detection.
we then introduce the motivation of this study together with its challenges.
a. mutation analysis given a program pand a set of mutation operators o the key idea of mutation analysis is to generate substantial mutants m in which each mutant mis a variant of p. the generated mutants are then executed against p s test suitet.
a mutant miskilled if there exists a test t2 t whose execution on pand that on mresult in different observable final states.
mutation analysis has many applications e.g.
such as evaluating the quality of a test suite e.g.
test suite reduction e.g.
improving fault localization e.g.
security analysis e.g.
program repair e.g.
and so on.
for instance to evaluate the quality of a test suite t mutation score the proportion of killed mutants in m is computed.
the higher the mutation score the more likely that tcan detect real bugs and thus the higher quality of the test suite.
to the best of our knowledge we are the first to apply mutation analysis in discovering api misuse patterns.
in this study we usekto denote a killing relation that a mutant mis killed by a test t. by executing a test suite ton all mutantsm we obtain a set of killing relations k. authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table i the ratio of test classes triggering target apis project apache bcel apache lang apache text httpclient lucene core ratio .
.
.
.
.
b. library api misuse detection uses of library apis are often subject to constraints such as call orders and call conditions .
unfortunately many of such constraints are insufficiently specified by apis documentations .
as a result developers also refer to informal