adjust runtime mitigation of resource abusing third party online ads weihang wang university at buffalo buffalo new y ork usa weihangw buffalo.edui luk kim purdue university west lafayette indiana usa kim1634 purdue.eduy unhui zheng ibm t.j. watson research center y orktown height new y ork usa zhengyu us.ibm.com abstract online advertising is the most critical revenue stream for many internet companies.
however showing ads on websites comes with a price tag.
since website contents and thirdparty ads are blended together third party ads may compete with the publisher contents delaying or even breaking the rendering of first party contents.
in addition dynamically including scripts from ad networks all over the world may introduce buggy scripts that slow down page loads and even freeze the browser.
the resulting poor usability problems lead to bad user experience and lower profits.
the problems caused by such resource abusing ads are originated from two root causes first content publishers have no control over third party ads.
second publishers cannot differentiate resource consumed by ads from that consumed by their own contents.
to address these challenges we propose an effective technique adjust that allows publishers to specify constraints on events associated with third party ads e.g.
url requests html element creations and timers so that they can mitigate user experience degradations and enforce consistent ads experience to all users.
we report on a series of experiments over the alexa top news websites.
the results point to the efficacy of our proposed techniques adjust effectively mitigated degradations that freeze web browsers on websites reduced the load time of publisher contents on websites prioritized publisher contents on websites and ensured consistent rendering orders among top ads on websites .
index t erms online ads defective ads resource abusing performance degradation mitigation i. i ntroduction modern websites deliver sophisticated contents and provide full fledged functionalities thanks to the recent advance of web technologies such as html5 and javascript.
similar to the common practice in traditional software development web developers make use of third party utilities that offer dedicated and professional services.
they can add various services into their websites by incorporating a few bootstrap snippets provided by the third party service providers without worrying about the complexity and scalability issues in the development and maintenance of the underlying services.
among such third party services online ads are the most ubiquitous mashups nowadays.
today over .
million websites use google s online advertising networks google adsense and over .
million websites participate amazon s affiliation marketing program amazon associates to make money by displaying ads on their web pages.
in fact online advertising has become the most critical revenue stream for many internet companies.
website owners sell adspace through advertising platforms to monetize their websites and get potential leads.
for example google provides an ad serving services platform called doubleclick which is widely deployed on many popular websites due to its ease of use and broad coverage.
to make use of the services website developers only need to include div elements to specify ad space and a few javascript snippets provided by doubleclick in their websites.
the additional contents loaded by the scripts will take care of the rest ad delegations on the fly.
despite the benefits there is a price to pay if advertisements take excessive resource to display.
since website contents and third party ads are blended together in browsers third party ads may compete with the contents owned by content publishers delaying the rendering of first party contents.
additionally in the current ad networks an ad slot may go through an intricate chain of delegations until the final ad is delivered.
dynamically including scripts from ad networks all over the world may introduce buggy ad scripts that slow down the page rendering and even freeze the browser.
cybercriminals even target ad networks to inject cpu draining cryptocurrency mining scripts which exacerbates the resource abusing problems.
the resulting poor usability leads to bad user experiences and lower profits for an e commerce site making .1m per day a second page delay can potentially cost .5m in lost sales each year .
we have observed a number of such resource abusing problems on real world websites.
to name a few a news article page on takes around seconds to render the contents including ads while the article without ads loads within just seconds.
the overwhelming majority of the time are spent on ad trackers and advertising networks.
a defective video ad on makes tens of thousands of url requests within seconds and eventually freezes the entire browser.
the problems caused by resource abusing ads are originated from two root causes first content publishers have no control over third party advertisements.
second publishers cannot differentiate resource consumption of ads from their own contents.
in many cases content publishers even do not have a reliable way to detect such client side violations.
despite recent advances in improving web page performance and increasing ad bidding efficiency there is a lack of practical yet systematic techniques to enable content publishers to control ieee acm 41st international conference on software engineering icse .
ieee authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
resource consumptions by ads or establish performance related agreements.
thus in this paper we present adjust as the first step in tackling these challenges.
we focus on a content publisher oriented approach with the goal of effectively mitigating resource abusing ads and consistently delivering better user experiences.
in particular our contributions are as follows we propose a system that allows website developers to specify constraints on resource consumption for third party ads.
we develop a novel technique adjust to monitor and regulate resource abusing ads on the fly.
we propose a measurement system to quantify resource abusing problems in particular performance degradation and priority inversions caused by ads.
our evaluation on alexa top news websites shows that adjust is highly effective in mitigating resource abusing ads that freeze browsers and degrade user experiences.
ii.
m otiv a tion we use two real world examples to show a how ads delay publisher contents and b how defective ads degrade performance.
a. ads delay first party contents figure shows the screenshots of loading a baseball video on .
the web page contains a handful of media contents.
since the page starts to load the page header and a video player render at .
second and .
second respectively.
the visitor assumes the baseball video will start to play soon.
however about one second later two google ads appear first.
after another three seconds an interactive animated ad displays delaying the video player from playing the video.
eventually the baseball video starts to play after .
seconds.
in this case the third party ads compete with first party contents on computing resources.
in reality many visitors would have already gotten frustrated and left the website to visit alternative sites.
our solution prioritizing first party content.
to mitigate this problem we propose to prioritize first party content by instrumenting the web page.
specifically we delay all ads by intercepting events that send ad requests only proceeding to request ads once the baseball video has been loaded.
as shown in figure after intentional delays were introduced for low priority ads the baseball video starts to play at .
second much earlier than before.
moreover although all ads were delayed they were still able to show up in a timely manner each wit h a .
seconds delay .
b. defective ads freeze the browser by including third party ads publishers are exposed to potential risks of delivering defective ads to their customers.
figure shows a defective video ad on that makes tens of thousands of url requests quickly freezing the browser.
initially the video player sends requests to a predefined list of partner servers to request advertisements.
each partnerserver either responds with an actual ad or redirects the video player to the next downstream ad server s .
this procedure continues until a valid ad is delivered or a predetermined timer expires.
on this website we observed a buggy ad script intensively issued a large number of requests.
particularly we visited this website on a modern laptop with .
ghz cpu processor and stable mbps network speed.
the defective ad has sent tens of thousands of url requests within seconds which made the cpu usage quickly jump to and the browser freeze within a minute.
as shown in figure the video ad loads in the following steps steps the video player sent ad requests to layer1 servers one at a time.
it first requested ads from server sx.streamrail.net .
this server did not have a suitable ad so it replied with an empty ad .
the player proceeded to other servers until it reached vid.springserve.com which replied with a wrapper script vd0.
.
.
.js as well as a list of downstream ad servers.
this wrapper script is used to handle the messages between the video player and the layer2 servers.
steps the player then requested ads from layer2 servers .
the 10thserver ads.adaptv.advertising.com instructed the player to load script jsvpaid.js which was supposed to be the wrapper script for another layer of servers .
however in this message no additional servers were provided.
steps because the player cannot fetch ads along the chain introduced by ad server it moved on to ad server .
recall that in step vd0.
.
.
.js invokes functions in jsvpaid.js via indirect function calls in an attempt to request ads from additional servers.
however due to a buggy implementation in vd0.
.
.
.js the call targets were not properly reset.
as a result starting from ad server all delegations still went through jsvpaid.js which kept triggering exception events .
as such the browser was busy with handling exceptions and eventually froze within a minute when the cpu usage reached .
our solution regulating offensive url requests.
in this example a layer1 ad server redirected the video player to hundreds of additional servers.
such many redirections introduced a large number of network requests and intensive javascript executions which eventually halted the entire browser.
to mitigate the resource abusing issue we limit the requests sent by this ad.
in particular given that ads are usually loaded via ajax requests we instrument the open method of xmlhttprequest objects.
if too many ajax requests were sent in a short time period additional requests will be delayed.
by limiting the number of url requests we were able to browse the website without noticeable delays.
c. our approach as shown in previous examples resource abusing ads substantially delay first party contents and significantly degrade user experience.
to solve these problems we propose authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
.0s .5s .5s .0s .5s .5s fig.
.
the timeline of loading a baseball video on .
two google ads appeared at .0s and an animated ad was displayed at .5s.
finally the baseball video was loaded and started to play at .5s.
.0s .5s .0s .0s .5s .5s fig.
.
the timeline of loading a baseball video on with intentional delays.
the baseball video started at .0s.
then two google ads appeared at .
.
finally the animated ad was displayed at .5s.
first party contents were rendered faster and loaded before third party ads.
fig.
.
a defective video ad on .
ad video playerad server sx.streamrail.netad server ioms.bfmio.comad server vid.springserver.com video ad script vd0.
.
.
.js ad server ad server ads.adaptv.advertising.com video ad script jsvpaid.jsad server 6ad server 12layer1 ad servers layer2 ad servers fig.
.
video ad loading on .
a novel runtime technique that allows publishers to specify regulation policies on each third party ad to control resource consumption.
policies can be load the top ad earlier than the bottom ad constraints for priorities between ads and the number of url requests an ad can send per second should be no more than x constraints for resource consumption .
once publishers have created regulation policies they only need to add a tiny javascript snippet and transform the web page.
the rest of the regulation is handled by the adjust runtime.
on the client side adjust runtime enforces the rules on resource consumption and the loading orders of ads.
adjust is persistent and robust in enforcing the rules during the entire life cycle of third party ads including layers of nested frames and dynamically generated contents which are common practices in advertising services.with adjust publishers can define constraints on priorities and execution of resource consuming events e.g.
http requests html element creations exceptions caused by third party ads etc.
and persistently regulate resource consumption caused by ads to mitigate user experience degradations and enforce consistent ads experience to all users.
iii.
d esign a. overview figure shows the overview of adjust.
it has two phases offline web page transformation figure a and runtime regulation figure b .
offline web page transformation.
for each ad content publishers define the expected service quality by specifying resource constraints .
for instance a publisher can specify the maximum ajax request rate allowed by annotating resource constraints within an ad slot normally embedded in iframe .
the resource constraints are then translated to javascript code by the source code transformer .
the source code transformer inserts the compiled constraints into the publisher s web pages as well as including the adjust runtime to enforce runtime regulation.
runtime regulation.
adjust runtime interposes javascript apis that generate resource consuming events.
when such events are invoked they are not executed immediately.
instead they are enqueued into the event queue which maintains multiple queues for events with different priorities.
resource regulator is the core component of adjust runtime.
it repeatedly fetches events from the event queue and ensures that each fetched event does not violate the resource constraints specified by the publisher.
if no violation is observed the regulator allows the fetched event to be executed .
otherwise the event will be delayed until the constraints are satisfied .
b. resource constraints to specify resource constraints for ads content publishers leverage three types of constraint primitives table i .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
publisher contentresource constraints adjust runtime source code transformertransformed source code content publisher websiteevent queue resource regulator1 3delay execute a offline web page transformation b runtime regulation fig.
.
system overview.
priority primitives specify the priority level numbers with smaller number denoting higher priority of an ad.
ads with higher priority will get loaded first.
total quota primitives are designed to regulate resource consumption during the entire ad life cycle.
for example a publisher can refuse to load an ad with more than layers of delegations with the primitive delegations .
time slot quota primitives focus on resource consumption in a short period of time.
for example publishers can use them to regulate the behavior of aggressively sending requests within one second.
table i primitives for resource constraints .
type primitive description example priority pripriority of an ad slot e.g.
pri set priority to totalt imecumulative time spent e.g.
totalt ime t should be loaded within tseconds repeatrequest of repetitive requests on the same uri e.g.
repeatrequests r no more than rrequests with the same uri delegations of delegations total e.g.
delegations d quota should be loaded before ddelegations ajaxrequests of ajax requests e.g.
ajaxrequests a at most aajax requests can be sent urirequests of uri requests e.g.
urirequests u at most uuri requests can be sent elements of elements created e.g.
elements e at most ehtml elements can be created delegationst s of delegations per second e.g.
delegationst s dr at most drdelegations per second ajaxrequestst s of ajax requests per second e.g.
ajaxrequestst s ar time slot at most ar ajax requests per second quota urirequestst s of network requests per second e.g.
urirequestst s ur at most ur uri requests per second elementst s of html elements created per second e.g.
elementst s er at most erelements can be created per sec.
c. source code transformer once content publishers annotate resource constraints on their web pages source code transformer will compile the resource constraints into javascript snippets and inject them into the web pages.
specifically it first parses the web page toa dom tree using htmlparser .
then it traverses the tree to encode resource constraints on the node that encloses ads e.g.
iframe .
along with the encoded resource constraints it also inserts adjust runtime support into the web page.
the transformed source code will be executed in web browsers to regulate resource consuming events at runtime.
d. adjust runtime adjust s runtime support has two components persistent runtime installer pri and resource event shim res .
persistent runtime installer pri .
to mitigate resource abusing ads throughout the entire ad delivery process adjust s runtime support must be persistently active along the delegation chain.
during each ad delegation third party ads create new inner iframe elements that create a completely new and isolated execution context from their parents.
thus adjust must install itself into the newly created iframe elements so that it can be persistently monitoring and regulating resource consumptions in the new inner elements.
otherwise adjust loses control over the iframe elements.
to do so persistent runtime installer pri ensures the entire system including itself is persistently installed throughout the entire ad delivery process by intercepting javascript apis that can be used to dynamically create iframe .
for example document.write anddocument.createelement are the most common ways to create a dom element dynamically.
adjust intercepts such apis and injects javascript code snippets that can install adjust in the newly created iframe .
resource event shim res .
resource event shim instruments javascript apis that create resource consuming events to transparently intercept their invocations at runtime.
these events include sending http requests loading images dom creations etc.
we categorize resource consuming events associated with ads into two event types events causing http requests et1 and events causing new html elements inserted into a web page et2 .
without loss of generality there are four ways to dynamically generate resource consuming events a writing html source into a web page b creating html elements via the createelements api c modifying the src property of html elements and d creating ajax requests.
note that all four ways may initiate http requests.
a and b will also insert new html elements.
next we discuss each type of the interfaces in detail and explain how adjust intercepts these interfaces.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a writing html source into a web page.
developers may call the document.write or set the html content of an element by assigning its innerhtml property.
these interfaces may insert new elements et2 and generate http requests et1 if a newly inserted element supports url attributes.
adjust intercepts the interfaces and puts a resource consuming event with its event type e.g.
et1 or et2 into the event queue.
in particular if a newly created element supports a url value the event is annotated with et1 type and then enqueued.
otherwise it is annotated with et2 and then enqueued.
b creating html elements.
the most common way to inject elements into a web page is calling createelement function to create an element followed by appendchild orinsertbefore .
adjust instruments functions appendchild and insertbefore to intercept their invocations.
when invoked adjust checks whether a src url href property is supported.
if so the event with et1 event type is enqueued to the event queue.
otherwise the event is treated as et2 events and gets queued.
c modifying the src property of html elements.
modifying an existing element s src property by calling setatrribute or directly assigning a new value may generate a url request.
for instance changing thesrc property of an image element img t o the link of an image file results in downloading a new image file.
to intercept such events adjust overrides setattribute and the setter of src property.
when they are called adjust enqueues the event with et1 event type to the event queue.
d sending ajax requests.
ajax requests are commonly used to refresh contents without reloading the entire page.
ajax requests can be initiated by calling the send method of an xmlhttprequest object.
adjust overrides the send method so that adjust enqueues the event with et1 event type onto the event queue.
at runtime depending on the event type the resource regulator will check different constraints to determine if the event should be executed immediately or delayed.
for example et1 type events are checked against network related resource constraints while et2 type events are checked against dom resource constraints e.g.
of dom element creations .
e. resource event queue resource event queue is a multi level queue where each queue contains resource consuming events with the same priority.
specifically we maintain internal queues with a smaller number denoting higher priority.
incoming resource events are enqueued accordingly.
if no priority is specified an event will be equeued to the queue with least priority priority .
when adjust dequeues an event it first checks the priority queue with highest priority.
if no event is available to schedule it dequeues an event from the next priority queue.f .
resource regulator resource regulator repeatedly dequeues events from the resource event queue and decides whether each event should be executed right away or delayed.
specifically given an event it checks the event against the resource constraints to see if any of the constraints are violated.
if any are violated the regulator puts the event back into the queue and delays its execution.
otherwise the event will be dispatched and executed immediately.
resource constraint checking.
before dispatching an event the resource regulator checks relevant resource constraints.
depending on the type of resource constraints the resource regulator handles the event accordingly for priority resource constraints the resource regulator dequeues events in their priority orders.
in particular it first checks the priority queue with the highest priority.
if no event is available to schedule in this queue the resource regulator dequeues an event from the next priority queue and so on.
for total quota resource constraints once an ad exceeds the quota no further event will be allowed because the constraint is enforced for the entire life cycle of an ad.
for instance suppose a developer specifies the resource constraint elements to only allow ads that inject less than html elements into the web page.
based on the value of runtime counter once elements have already been inserted adjust will discard additional element creation event.
for time slot quota primitives resource constraints are temporary.
if an event violates time slot quote constraints the resource regulator will put this event back to the event queue and retry this event at a later time.
consider a resource constraint elementst s and assume that there were already 10elements injected during the last second.
if there is a new element creation event the resource constraint is violated.
however since elementst s represents the allowed number of elements injected within a second a new element can be inserted after the counter is reset.
runtime counters.
runtime counters maintain the current state of resource consumption.
at runtime the resource regulator compares the runtime counter values with resource constraints to decide whether an event should be executed or delayed.
maintaining the runtime counters is straightforward adjust updates the associated runtime counters whenever a resource event is processed and dispatched.
for instance when an html creation event is executed the counter for of elements created is increased by .
the runtime counters for each primitive are maintained as follows.
totaltime when an event is executed adjust records timestamps when it starts and ends to obtain an elapsed time for the event and accumulates the time to totaltime .
repeatrequest for each url if there are multiple requests on the same url adjust counts the number of repeated requests including ajax requests.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
delegations we consider creating an inner iframe as a delegation.
when an inner iframe is created delegations are increased by .
ajaxrequests urlrequests elements they are increased by on every ajax request url request e.g.
loading an image in img and html element creation respectively.
delegationsts ajaxrequeststs urlrequeststs elementsts these are time slot quota primitives.
adjust counts the number of events that occurred during the last second.
iv .
e mpirical studies to better understand how resource abusing problems affect user experience in practice we have conducted a one month empirical study on alexa top news websites that contain third party ads.
in total websites contain at least one ad.
we quantify these problems and classify resource abusing ads based on their effects.
a. experimental methodology we conduct the data collection in three steps.
step collecting website speed metrics.
we collect the following data from the alexa top news websites to measure the page load time the visually complete time speed index and time to interactive the cpu time spent on each individual html element javascript iframe the network time spent on url requests.
also for each element and network request we identify the ad generated that element or request.
to achieve that we leverage website testing service webpagetest to measure page level metrics.
the service can work with chrome devtool to provide an indepth view of the cpu and network requests at the element level.
the results are collected from page tests at dulles v a by following the guidelines of empirical studies presented in .
we chose mbps as the connection rate because this is the rate half of internet users in united states use as of q1 .
of the news websites websites contained at least one third party ad.
step .
annotating third party ad scripts.
to study the cpu and network time on individual ads we separate the result for third party ad scripts from publisher content.
as most thirdparty ads are enclosed within an frame iframe and can be identified effectively by ad blockers we use an ad blocker adblock plus chrome extension to locate iframe with ads.
in particular we visit a website twice using chrome browser with and without the adblock plus extension.
we saved the web page code for both visits and leveraged an html parser to compare the dom structures.
step data analysis.
to measure the time spent on each ad we identify the top level iframe for an ad from the profiler in chrome devtool based on the dom tree comparison result.
then starting from the top level iframe w e check whether nested inner frames are enclosed by examining the referrer field of entries that request new pages.
in this way we can discover a chain of delegations and record each nested inner iframe that belongs to an ad.
finally we add upthe time for url requests within all of the recorded frames to obtain the network time for this ad.
similarly we sum up the time of the html parsing the script evaluation and the layout update that belong to the ad as its cpu time.
b. resource abusing ads we have observed two common resource abusing problems performance degradation and priority inversions .
performance degradation website performance degradation can be the result of bad programming practices or defects that consume excessive computation resources.
they drag down the browser performance and introduce unnecessary delays in user perceived page load time.
we define the following indices to measure the performance degradation.
slow response time srt .
we are interested in the response time that javascript code takes to react to user actions as it is one of the most critical factors affecting user perceptions.
slow responses are usually caused by long running javascript that blocks the main thread from serving user events.
as suggested .1seconds is the limit for having users feel the system is reacting without delays .
therefore we say a page is unresponsive when the browser main thread is blocked for more than .1seconds and collect such unresponsive windows .
intuitively we define third party ads cause slow response time problem if they introduce more unresponsive windows than publisher contents.
formally if we use w primeandwto denote unresponsive windows caused by ads and publisher contents a page suffers from the srt issue when summationtextw prime i summationtextwi.
result.
of the websites contained ads websites suffered from slow response time issue.
figure shows a partial result on websites.
the red bars are the accumulated unresponsive time caused by ads and the blue bars are the accumulated unresponsive time caused by publisher contents.
on aver age ads contribute .
seconds to the unresponsive time which is .
times of publisher contents.
load time bloating ltb .
the requests initiated by thirdparty ads and publisher contents are dispatched in a first comefirst serve manner as browsers only allow a limited number of concurrent requests.
however third party ads usually make a substantial number of http requests to load resources at runtime which may delay or block the delivery of publisher contents.
it is well known that slow website load time costs money as it makes visitors switch to competitor websites.
moreover search engines recently incorporate page load time into its ranking algorithm to downgrade websites with slow loading time .
to this end we define load time bloating to measure the delay introduced by ads.
suppose we use t andt primeto represent the page load time with and without ads a website suffers from the ltb issue if t t prime.
result.
we have found websites experienced load time bloating problem .
figure shows the partial result on websites.
the red bars are the time to load ads and the blue bars are load time of publisher contents.
the average time to fully load the publish contents is .
seconds where ads contribute .
seconds.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
.
news websites show srt browser experience more unresponsive periods due to ads.
fig.
.
news websites experience lbt web page load time dramatically increased due to ads.
priority inversions in general publisher contents are expected to be delivered with higher priority than ads.
however we observe that on many websites ads are loaded before publisher contents.
moreover off screen ads may delay contents or ads displayed in the current screen.
as we can generally infer developer s preference from the order suggested by html tags we define two types of priority inversions to capture unintended load sequences.
content priority inversion cpi .
website developers usually optimize the critical rendering path to promptly deliver their contents.
however ads may compete for the resources and get rendered first.
we say content priority inversion happens if a higher priority publisher content loads after an ad or formally i s.t.
t t i where tandtidenote when publisher contents and ad iare loaded.
result.
websites exhibited content priority inversion issue at least once during our one month test .
these websites either have many ads or contain complex ads that needs a long time a few seconds to finish.
ad order inversion aoi .
publisher developers may want to specify the loading order between two ads.
although most ad serving platforms allow them to do so the actual execution order may be different.
we use ad order inversion to denote the scenario when two ads are loaded in a different order comparing to the order specified in the html source code.
formally r1 r2and t t where the request r1 initiated by ad1is sent out before the one r2byad2butad1 loaded at t1is rendered after ad2loaded at t2.
result.
we identified websites experienced ad order inversion issue by preloading off screen ads prior on screen ads.
preloading off screen ads prior on screen ads contradicts the order defined by developers.
it is more likely developers prefer to prioritize the ads in the current view over the ads off the screen.
v. e v alua tion we evaluate how adjust mitigate the resource abusing ads particularly focusing on the following five research questions.
rq1 can adjust mitigate the srt problem and improve web page response time?
rq2 can adjust mitigate the ltb problem and reduce the time to load publisher contents?
rq3 by prioritizing publisher contents does adjust help on loading publisher contents faster?
rq4 can adjust ensure advertisements are rendered in the consistent order as developers expected?
rq5 how much performance overhead does adjust introduce?
a. experimental results rq1 can adjust mitigate the srt problem and improve web page response time?
as we have shown in section iv out of the alexa top news websites news websites suffer from the srt problem.
to mitigate the srt problem we set the maximum speed of url requests initiated by ads to be less than per second by using the resource constraint urlrequests .
to ease the comparison we show the unresponsive time before and after adjust side by side in figure .
in particular the first bar represents the unresponsive time before adjust red denotes ads blue denotes publisher contents while the second bar represents the unresponsive time after adjust dark blue denotes ads grey denotes publisher contents .
findings.
after the mitigation with adjust on average the total unresponsive time drops to .
seconds where ads contribute .
seconds.
by setting a frequency cap for the url requests initiated by ads the main thread is blocked by ads less frequently.
as the main thread is less busy with third party ads it will be able to process publisher contents and user interactions more smoothly.
rq2 can adjust mitigate the ltb problem and reduce the time to load publisher contents?
we have identified sites on which publisher contents substantially delayed due to third party ads.
by setting the maximum number of elements can be created by ads to per second the average time to load publisher contents is decreased from .9seconds to .3seconds.
figure shows authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
.
mitigation of slow response time.
the result of representative sites.
for each site the first bar and second bar denote the duration to load publisher contents before and after adjust.
after the mitigation we are interested in if the webiste with adjust takes longer time to load ads and if so how much additional time adjust introduced on ads.
table ii shows the load time of the top two ads above the fold on the sites.
specifically the second column shows the number of html elements associated with publisher contents.
the third column shows publisher contents load time before and after the mitigation.
similarly the number of html elements and load time are given for the first ad columns and the second ad columns .
findings.
the average html elements created by the top two ads are and if exists .
by regulating html creations speed it takes slightly longer to load the first ad .91s .02s and the second ad .87s .63s .
however the improvement on publisher contents is significant publisher contents are able to be loaded .2x faster .9s .3s .
rq3 by prioritizing publisher contents does adjust help on loading publisher contents faster?
to prioritize publisher contents over third party ads in a web page we assign higher priority to publisher contents and the same lower priority to all ads.
out of the top news websites sites contain at least one ad tag.
by prioritizing publisher contents on average the load time of publisher contents is significantly improved .25s .09s .
to measure the performance overhead on third party ads we measure the slowdowns for the top two ads in the current view.
findings.
as shown in figure a and figure b the load time of the top two ads are slightly increased on out of sites the first ad is slowed down less than seconds for the second ad out of sites are slowed down less than seconds.
rq4 can adjust ensure advertisements are rendered in the consistent order as developers expected?
to evaluate the effectiveness of adjust in regulating ad loading orders we test news websites that preload the ads below the current view.
preloading ads off the screen is not an optimized strategy because it competes network and cpu resources and delays the contents in the current view.
hence web developers may wish to prioritize the ads in the current view over the ads off the screen.
findings.
we assign higher priority to ads above the fold and lower priority to remaining ads.
as shown in figure with adjust the ads in the current view on all websites are loaded faster.
some of the ads are even delivered 10s earlier.
in the meanwhile by deprioritizing off screen ads they are loaded slower on all tested websites.
rq5 how much performance overhead does adjust introduce?
when reducing the html creation rate we observed a slight increase in time to load the top two ads .
and .
respectively .
however the publisher content loaded significantly faster .
similarly by limiting the ad requests speed the top two ads were slowed down for less than five seconds.
findings.
in summary the only runtime overhead is maintaining resource usage counters per ad iframe to delay ad executions.
no overhead is added to the publisher content.
b. case study in this section we discuss how a defective video ad on .com caused the web page respond slowly and demonstrate the mitigation.
the simplified code of loading the video ad is shown in figure .
specifically the website used google doubleclick to sell the ad space line which further resold this ad space to another advertising platform pubmatic line .pubmatic instructed doubleclick to load a video player ovamediaplayer.js to request ads line .
the div element with class cm video ad was created to hold the video ad line .
during ad delegations several ad files were considered insecure and thus blocked by the browser.
in particular the ad files used self signed ssl certificates which were not verified by a trusted certificate authority.
due to this error each ad request further incurred additional url requests on average.
as a result the website experienced slow response time for user events.
figure a shows the page responsiveness for the first seconds.
for simplicity we omit unresponsive windows shorter than .
seconds.
the red windows represent the unresponsive windows longer than .
seconds but shorter than second while the dark red windows are unresponsive time longer authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
.
mitigation of load time bloating.
table ii effect on the first two ads above the fold .
websitepublisher content first ad second ad elements load time before after adjust s elements load time before after adjust s elements load time before after adjust s abcne ws.go.com .
.
.
.
accuweather .com .
.
.
.
.
.
bloomberg.com .
.
.
.
chicagotribune.com .
.
.
.
.
.
cnbc.com .
.
.
.
forbes.com .
.
.
.
hindustantimes.com .
.
.
.
.
.
huffingtonpost.com .
.
.
.
indiane xpress.com .
.
.
.
.
.
latimes.com .
.
.
.
.
.
news.com.au .
.
.
.
.
.
newsweek.com .
.
.
.
nypost.com .
.
.
.
nytimes.com .
.
.
.
reddit.com .
.
.
.
.
.
sfgate.com .
.
.
.
.
.
thedailybeast.com .
.
.
.
usatoday .com .
.
.
.
variety .com .
.
.
.
wsj.com .
.
.
.
a ad fully loaded sites b ad fully loaded sites fig.
.
load time differences of top two ads after mitigation with adjust.g.
.loadtime diff erences o ftop two a dsafter m itigation w ith adj a on screen ads fully loaded faster b off screen ads fully loaded slower fig.
.
load time differences of on off screen ads.
than second.
initially the web page requested ad from doubleclick at7.82second.
after two layers of delegations the video player was requested at .
second.
then the player executed javascript to initialize and set up event handlers for playing pausing actions.
after .03seconds the video player started to request video ads every 5seconds with a second timeout.
since then unresponsive windows longer than .
seconds were observed every 5seconds.
the !
!
!
!
!
!
!
fig.
.
code snippet of a defective video ad on .com.
publisher contents loaded at around 10second.
mitigation.
we deployed adjust on this web page by setting the maximum url requests rate to requests per second.
the result is shown in figure b .
because adjust hadconstrained the frequency of url requests the video playerwas requested with slight delays .
seconds .
seconds .
after .
seconds the video player finished the initialization and started to request ads.
as can be seen theweb page was rarely blocked by requesting ads and would beable to quickly respond to user events.
in addition publishercontents loaded faster due to less competitions from ads .
seconds .71seconds .
vi.
l imita tion and future work adjust presents an effective approach for publishers to regulate resource abusing ads.
despite its efficacy there isroom for improvement.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
a unresponsive windows before adjust b unresponsive windows after adjust fig.
.
website .com unresponsive windows.
adjust requires publishers to specify resource constraints manually.
while developers are able to do so without much difficulty in practice adjust can be extended to provide a more user friendly experience such as automated resource consumption monitorings and recommendations.
in fact our empirical studies provide a guideline for automated measurements.
measuring client side machine capacities to automatically set resource constraints is our ongoing work.
another current limitation which we leave for future work is conducting user evaluations on adjust.
by deploying adjust on websites with resource abusing ads and collecting user evaluations we will be able to measure how effective adjust is in improving user experience and may discover other measures that can lead to further improvements.
to reduce the threats to validity we have carefully included and measured the most critical factors we believe truly affect user experience.
we have also made efforts to maintain consistency and avoid bias.
however non deterministic and uncontrollable factors such as the accuracy of the measurement tool being used and the time of the day measurements were performed may affect the validity of our empirical study.
conducting measurements under various settings to handle inaccuracy and avoid bias is an intriguing direction for our future research.
vii.
r ela ted work the line of work most closely related to ours are the solutions to speed up web page loads.
wprof is proposed to produce a dependency graph for page load activities.
shandian restructures the page load process based on dependencies and optimizes what portion of the page should be loaded first.
webgaze prioritizes loading objects that exhibit collective fixation to improve user experience.
it leverages eye gaze to identify most attractive portions for users and optimize theloading procedure correspondingly.
klotski prioritizes the content delivery based on high utility contents or invariant dependency structures.
our work also restructures the load procedure.
however we leverage a set of orthogonal features i.e.
the source of the contents.
so the optimizations based on dependencies among page load activities most attractive page portions or high utility content may not directly apply to the performance issues caused by third party ads.
lahaie et al.
proposed an expressive auction design including a language for the bidding process in order to enable flexible controls over advertisements.
similarly lang et al.
propose an algorithm to improve the effectiveness of an auction process.
adjust allows publishers to control over the ads at runtime to solve resource related issues and provide better user experiences to publishers and website visitors.
our work is also related to user experience measurements.
there are large scale user studies that measure performance of real world web pages.
bocchi et al.
surveyed state of the art metrics for web user experience quality measurements and proposed metrics relevant and practical.
google ad experience report helps developers locate annoying ads e.g.
popups .
however google ad experience does not address the performance issues caused by thirdparty ads.
besides google ad experience report is an offline tool and does not fix problematic ads.
developers have to manually fix violating ads by changing or removing ads once observed.
adjust regulates resource abusing ads and prevents over consumption at runtime.
researchers studied the impact of budget management strategies and pricing as well as the impact of adblocking software and restrictions on third party tracking .
goldstein et al.
studied relationship between ad exposure time and the effectiveness of ad.
however they do not focus on resource related issues hence are not applicable to quantify the user experience degradation cause by ads.
viii.
c onclusion in this paper we present adjust a system that allows publisher developers to specify resource constraints for third party ads.
adjust is able to monitor and regulate resource abusing ads by transparently intercepting key javascript apis.
adjust features a runtime scheduler which can regulate resource consuming events based on the resource constraints specified by publisher developers.
we also propose a system of measurement that can be used to quantify the performance degradation and priority inversion issues caused by ads.
adjust s runtime support persistently enforces the regulations by propagating through the delegations along the entire ad delivery chain.
our evaluation of alexa top news websites shows that adjust is highly effective in mitigating resource abusing ads.
ix.
a cknowledgements we would like to thank the anonymous reviewers for their valuable inputs and constructive comments.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.