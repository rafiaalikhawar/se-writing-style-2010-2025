automatic generation of inter component communication exploits for android applications joshua garcia mahmoud hammad negar ghorbani and sam malek department of informatics university of california irvine irvine california usa joshug4 hammadm negargh malek uci.edu abstract although a wide variety of approaches identify vulnerabilities in android apps none attempt to determine exploitability of those vulnerabilities.
exploitability can aid in reducing false positives of vulnerability analysis and can help engineers triage bugs.
specifically one of the main attack vectors of android apps is their inter component communication interface where apps may receive messages called intents.
in this paper we provide the first approach for automatically generating exploits for android apps called letterbomb relying on a combined path sensitive symbolic execution based static analysis and the use of software instrumentation and test oracles.
we run letterbomb on android apps from google play where we identify exploits from vulnerable apps.
compared to a state of the art detection approach for three icc based vulnerabilities letterbomb obtains more vulnerabilities at a .
to times faster speed.
ccs concepts security and privacy software security engineering software and its engineering software testing and debugging keywords android exploit vulnerability test generation test oracle acm reference format joshua garcia mahmoud hammad negar ghorbani and sam malek.
.
automatic generation of inter component communication exploits for android applications.
in proceedings of esec fse paderborn germany september pages.
introduction mobile devices are ubiquitous with billions of smartphones and tablets used worldwide .
among these popular mobile devices android has emerged as the dominant platform .
fueling the popularity of such devices is the abundance of applications apps available on a variety of app markets e.g.
google play .
this abundance of apps arises in large part due to the android platform s low barrier to entry for amateur and professional developers alike where a re usable infrastructure enables relatively quick production of apps.
however this low barrier to entry is associated with an increased risk of apps with defects particularly in the form of permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse september paderborn germany association for computing machinery.
acm isbn .
.
.
.
vulnerabilities .
consequently developers and designers of such apps need to utilize appropriate approaches tools and frameworks that aid them in producing secure apps.
to identify security vulnerabilities in android apps a plethora of approaches have been constructed .
most of these approaches rely upon static analysis of android apps to identify such vulnerabilities .
several approaches utilize dynamic analysis for identifying vulnerabilities in android apps .
other approaches use a combination of static and dynamic analysis to identify vulnerabilities .
although these approaches and techniques have provided useful means for identifying vulnerabilities the exploitability of those vulnerabilities often must be determined manually by security analysts.
such a manual task is cumbersome time consuming and error prone.
furthermore vulnerabilities that are identified by existing techniques that are not actually exploitable do not pose a true security problem.
the time an analyst spends on such non exploitable vulnerabilities should be minimized.
ideally an approach is capable of both identifying vulnerabilities within an android app and determining if such vulnerabilities areexploitable in an automated fashion.
achieving the latter goal reduces the false positives produced by a security analysis and the time a human analyst must spend examining a vulnerability.
furthermore identifying vulnerabilities that can be automatically exploited aids software engineers in determining which bugs they should prioritize first provides an input to help fix the security bug and keeps engineers ahead of malicious actors that may create zero day exploits of vulnerabilities.
to enable automatic exploit generation aeg for android apps two challenges must be overcome.
first specific android constructs must be taken into account including the distributed event based or message based framework that serves as an app s attack surface.
in particular inter component communication icc both within and across android apps relies primarily on the exchange of asynchronous messages called intents in android.
furthermore the android framework provides a set of pre defined components that react differently to intents they receive.
another challenge of applying aeg to android is providing a means of automatically assessing whether a vulnerability has been exploited.
to address these challenges and apply aeg for android we present an approach called letterbomb that models the android framework especially the icc interface of android apps provides test input generation whose goal is to construct an icc input that actually exploits a vulnerability and includes software test oracles that determine if a test input successfully exploits a particular vulnerability type.
specifically we focus on three types of vulnerabilities inter process denial of service cross application scripting and fragment injection where each vulnerability corresponds to a single oracle type.
each oracle is realized as esec fse september paderborn germany joshua garcia mahmoud hammad negar ghorbani and sam malek a combination of instrumentation at either the app or framework level and the check of a property to determine if exploitation was successful.
as a result even though each vulnerability requires an oracle designed specifically for it construction of each oracle only needs to be performed once either as an algorithm that automatically instruments an app or a one time modification to the android framework.
thereafter the oracle may be continually reused.
given that test input generation is critical for aeg at the icc interface of android apps and their constituent components letterbomb relies upon a path sensitive analysis of android apps along the message based android icc interface i.e.
intents.
determining exploitability of a vulnerability at a particular statement is dependent on assessing the different program paths that may reach a statement.
certain paths may reach a statement without exploiting the vulnerability residing at that statement or there may be more than one path in a program that may exploit a vulnerable program statement.
as a result it is important for our analysis to be path sensitive to minimize the possibility of missing exploitable vulnerabilities.
at the same time path sensitive analyses face the problem of path explosion as the program grows due to the potentially exponential number of program paths to be analyzed.
to address this problem our approach analyzes program paths beginning from the points in the program that may be vulnerable and utilizes information about the android framework to reduce the information that needs to be considered for the analysis.
the main contributions of our work are as follows we present letterbomb the first approach for automatically generating exploits of android apps at their icc interface.
we perform an evaluation of letterbomb on android apps in terms of its ability to generate icc exploits reduce the false positives of a conservative path sensitive static analysis and the efficiency of the different parts of our approach.
we have identified exploits from apps and have informed the authors about the exploits and associated vulnerabilities.
we further compare letterbomb to a state of the art detection approach for three icc based vulnerabilities and find that letterbomb obtains more vulnerabilities at a .
to times faster speed.
we describe letterbomb s implementation and make it available online .
background and running example to aid in understanding letterbomb we first cover the necessary background regarding the android platform and describe a running example of an android app we will reuse throughout the paper.
finally we cover the foundational aspects of aeg.
android background.
the android development framework adf supplies developers with a set of customizable components and communication mechanisms that allow construction of mobile apps.
in particular android includes four pre defined components activities services broadcast receivers and content providers.
anactivity represents a gui screen that an app displays to a user and allows her to interact with the app.
a service runs operations in the background of an app.
a content provider represents persistent data storage of an app.
a broadcast receiver receives intents that are as its name implies broadcasted by other apps or the android framework itself e.g.
indicating that the battery is low or that the device has finished booting .
activities services and broadcast receivers can exchange intents.
activities may consist of fragment s where each fragment may represent a partial or whole screen viewable by a user.
for example one fragment of an email app may contain the list of messages to be displayed while another fragment may contain the body of an individual message.
as an event based system android components i.e.
activities and services may have multiple entry points corresponding to their lifecycle.
for example an activity has separate entry points for initial creation and being sent to the background to pause the activity.
broadcast receivers have a single entry point but may be registered dynamically.
from our studies of android apps there are mainly three types of attributes of an intent that an app uses to determine the manner in which it will utilize the intent and perform operations based on it theaction of an intent its categories and its extra data .
the action of an intent is an attribute that indicates the general operation to be performed in response to an intent e.g.
display data to the user or deliver data to some person or agent .
categories of an intent provide additional information as to the manner in which the intent s action should be performed e.g.
whether the intent will allow launching of an application as referenced by a link in a browser .
extra data also called bundles are a collection of keyvalue pairs in an intent allowing storage of additional attributes.
running example.
by supplying actions categories or extra data with malicious payloads or excluding these attributes an attacker can exploit an icc based vulnerability in an android app.
figure illustrates two activities adsactivity which shows ads to a user and fragmentactivity which utilizes fragments as part of the ui of the activity.
both of these activities contain exploitable vulnerabilities that are reachable from the app s icc interface.
adsactivity shows a banner ad if it receives an intent whose action contains the string banner line or an interstitial ad i.e.
an ad that fills the entire screen if the intent s action contains the string appwall line .
for the interstitial ad to display the intent must have an integer extra data containing the key expirytime and value greater than and must not include the default intent category line .
to display the interstitial ad the adsactivity relies upon a webview which is a class that displays a web page from within an activity.
the contents of the web page depend on a boolean extra data supplied by the activities incoming intent with a key cached lines .
if the value of this extra data is set to true the web page is loaded from a cached url line otherwise the url used as part of the displayed web page depends on a string extra data with key url supplied by the incoming intent line .
two vulnerabilities exist within the adsactivity .
first by sending an intent with no action to this activity a null pointer exception will be thrown when the activity checks the intent for a banner action.
specifically invoking the equals method on the action string is an invocation of a null object line which results in the app crashing as the thrown exception is not caught.
this vulnerability can be leveraged by a malicious app to perform an inter process denial of service idos attack on the adsactivity by periodically sending an intent with no action.
the second vulnerability occurs when the incoming intent of theadsactivity loads a web page supplied by an intent.
a malicious app can send an intent to the adsactivity and attempt to perform a spoofing attack by redirecting the user to a web page requesting sensitive personal information.
alternatively the webview may be redirected to a page with malicious javascript code.
this vulnerability is similar to cross site scripting vulnerabilities in web 662automatic generation of inter component communication exploits for android applications esec fse september paderborn germany public class adsactivity extends activity public void oncreate bundle savedinstancestate intent intent getintent string action intent .
getaction if action .
equals banner dobannerad intent else if appwall .
equals action if intent .
getintextra expirytime !
intent .
hascategory android .
intent .
category .
default doappwallad intent private void doappwallad intent intent bundle data intent .
getextras webview webview webview findviewbyid r.id.
webview1 string url null boolean cached data .
getbooleanextra cached true if cached url getcachedurl else url data .
getstringextra url webview .
loadurl url public class fragmentactivity extends activity protected void oncreate bundle savedinstancestate ... string fragmentname getintent .
getstringextra frag name fragment f fragment .
instantiate this fragmentname args fragmenttransaction transaction getfragmentmanager .
begintransaction transaction .
replace r.id.
fragment container f transaction .
commit figure an example app with icc vulnerabilities applications and is referred to as cross application scripting xas vulnerabilities for android apps .
fragmentactivity in addition to using fragments as part of its ui contains a fragment injection fi vulnerability which occurs when a fragment loaded by an app is controllable by an intent received from outside of it.
for fragmentactivity an incoming intent with a string extra data containing the key frag name can be exploited by supplying as its value the name of a fragment that resides in the corresponding app.
this fragment is then instantiated and loaded into the fragmentactivity lines .
to better understand how such a vulnerability can be exploited consider an app with a fragment called mainfragment which contains the app s main screen.
to reach this main screen a user must first be authenticated through a login screen by entering her username and password.
if the app is vulnerable to fi a malicious attacker can pass the login screen by exploiting the fi and loading mainfragment directly from a vulnerable activity.
automatic exploit generation.
the goal of aeg is to generate and identify an input that satisfies the following boolean equation bu exploit .
bu is an unsafe path predicate .
such a path predicate may be one identified using symbolic execution and the conditions needed to execute that path.
for example to move the adsactivity to a state in which it is vulnerable to an xas bu would be satisfied by an incoming intent containing an integer extra data with key value pair expirytime no default category and the boolean extra data key value pair cached false .
exploit is an exploit predicate that represents an attacker s logic and successful exploitation of a vulnerability.
to exploit the xas vulnerability of adsactivity exploit would be represented by an intent with a string extra data containing the key url and the value equal to a malicious url and the webview s private url member string set to that malicious url.
letterbomb overview figure depicts a high level overview of letterbomb .vulnerability identifier vi conservatively analyzes the inputted app to identifystatements where exploitable vulnerabilities may exist and passes those vulnerable statements to attack intent generator aig and exploit oracle instrumenter eoi .
aig performs a backwards static symbolic execution sse starting from the vulnerable statements identified by vito determine the payload of intents that when sent to the vulnerable component are likely to execute each vulnerable statement.
by performing sse from the vulnerable statements the sse reduces the possibility of path explosion faced by performing a symbolic execution.
based on the type of vulnerability identified aigdetermines the appropriate modification to the intent needed to potentially exploit the vulnerability e.g.
supply a value to an extra data or leave out an extra data .
each generated intent is an attack on the app whose goal is to exploit a particular vulnerable statement and a security test case.
viandaig together aim to satisfy bu of the aeg equation in section and the attacker s logic of exploit .
letterbombexploit oracle instrumenterattack intent generatorvulnerability identifierinstrumented applicationappandroid frameworkattack intentsinstrumentedframework vulnerable statements intent modifications figure overview of letterbomb eoitakes three inputs vulnerable statements from vi the application and the android framework.
based on the vulnerability types letterbomb intends to exploit i.e.
idos xas and fi in this paper eoiinstruments either the application or the android framework to insert oracles in the form of probes that can determine at runtime if an attack intent successfully exploits a vulnerable statement.
essentially eoi aims to satisfy the successful exploit portion of exploit .
in the following sections we discuss each of the three major components of letterbomb vi aig and eoi.
vulnerability identification vi s main goal is to conservatively identify potentially vulnerable statements.
by performing vulnerability analysis conservatively the output of vimay be less precise but such an analysis ensures the vulnerabilities are well covered during sse and security testing.
in the remainder of this section we will discuss the static analyses we perform to identify statements vulnerable to the three types of vulnerabilities that we focus on in this paper.
inter process denial of service .
to identify potential idos attacks vichecks for uses of an intent s payload that may cause an unhandled null pointer exception.
to that end viexamines each use of an intent attribute i.e.
an intent action extra data or category and performs a backwards data flow analysis along the use def chain of the corresponding attribute to determine if there is anull check of the attribute .
a null check is a conditional comparison of an object against null.
if action !
null if action .
equals banner dobannerad intent figure modified example from lines of figure 663esec fse september paderborn germany joshua garcia mahmoud hammad negar ghorbani and sam malek to illustrate consider figure which contains a modified code snippet from lines of figure .
line of figure contains a null check of the intent action.
if vi s backwards data flow analysis along the use def chain of an intent attribute does not include a null check vimarks the use as vulnerable to an idos attack and adds that statement as a vulnerable statement to be outputted.
cross application scripting .viidentifies statements vulnerable to xas attacks by first identifying invocations of webview.loadurl ... in an application.
starting from such a statement viperforms a backwards data flow analysis along the use def chain of arguments passed to the invocation webview.loadurl ... at that statement.
if any of those arguments are uses of a definition statement whose right hand side involves the extraction of an intent attribute viconsiders the statement vulnerable to an xas vulnerability.
as an example consider the statement at line of figure that is vulnerable to xas.
vifollows the urlstring argument at that invocation along the argument s use def chain.
at line the definition of urldoes not involve data extracted from an intent recall that the url is extracted from a cache.
a summary of the getcachedurl may be used to make this determination or this information may be determined during runtime when generated intent attacks are executed.
on the other hand at line urlis assigned its value from a string extra data attribute.
as a result vi marks line as vulnerable to xas.
fragment injection .
to determine if a statement is vulnerable to fi vichecks if the statement invokes fragment.instantiate ... and if the second positional argument of that method i.e.
the name of the fragment to load is controllable using an intent attribute by following the use def chain of that argument.
for example consider the invocation of fragment.instantiate ... at line of figure .
fragmentname is the second positional argument of that invocation indicating the name of the fragment to be loaded from within the app under analysis.
by following the use def chain of this object backwards we find its sole definition at line of figure .
at that statement fragmentname is assigned the value of the extra data corresponding to the key frag name of fragmentactivity s incoming intent.
as a result an intent can control the fragment loaded at line making that statement vulnerable to a fi.
attack intent generation aig performs two key functionalities to exploit an icc based vulnerability computes intents that can execute a vulnerable statement along all possible intent controlled paths and modifies intent attributes to supply vulnerability specific logic of an attack.
.
reaching intent generation to perform aig relies on an algorithm we refer to as reaching intents which is a flow sensitive context sensitive object sensitive and path sensitive backwards sse and a backwards data flow analysis over the app s use def chains beginning at each vulnerable statement supplied to it by vi.
by starting the sse from vulnerable statements the sse prunes the space from which paths must be computed as opposed to a forward symbolic execution starting from the icc based entry points of the app to all statements reachable from those entry points.
this pruning significantly reduces aig s computation time.
each backwards sse can be computed independently per vulnerable statement allowing the backwards ssealgorithm intentcontrolanalysis input set of methods min reverse topological order from the app targetstmts a set of vulnerable statements output a map m targetexprs which describe the intents and path conditions of methods m 1 2foreach method m mdo usedefs m constructusedefchains m foreach statement st m.statements do ifst tar etstmts then reachpaths constructbackreachpaths m.cfg st intrapathexprs foreach pathp reachpaths do foreach sp pdo ifspis an invocation of the form m a andais a set of arguments passed to m then ifargument ais an intent and a athen if m has an intent referencing the parameter matching argument athen intrapathexprs usesummary m a st intrapathexprs p else intrapathexprs generateexprsforstmt sp p usedefs m intrapathexprs st intrapathexprs p to be parallelized further improving scalability of aig s analyses of intents needed to execute a vulnerable statement.
to obtain a call graph suitable for analysis of android apps the call graph must account for the multiple entry points of an android app and its lifecycle.
to achieve this reaching intents incorporates incremental callback analysis to construct a call graph as described in previous work where the call graph is continuously updated with identified callback registrations until a fixed point is reached.
the main algorithm driving reaching intents s analysis intentcontrolanalysis is depicted in algorithm .
similar to previous analyses intentcontrolanalysis is a summary based analysis that processes methods in the app s call graph in reverse topological order and takes as input targetstmts i.e.
the vulnerable statements identified by vi.
by analyzing methods in that order intentcontrolanalysis ensures that a callee method s summary is constructed and available before a caller method is analyzed preventing the need to analyze a method more than once and improving intentcontrolanalysis s efficiency.
intentcontrolanalysis returns a map m targetexprs summarizing the analysis results for each method m m. essentially this map contains the expressions describing the intent including its attributes to be generated that may reach vulnerable statements in the app.
each e targetexprs is a pair s exprsp .exprspis a sequence of expressions describing intents and path conditions in a program path p and s is avulnerable statement where backward symbolic execution initiates from which is further elaborated in the next section.
algorithm analyzes each method mby first constructing m s use def chains line of algorithm .
for each vulnerable statement stof a method m line of algorithm constructs all the relevant program paths from the entry point of the program to the vulnerable statements by invoking constructbackreachpaths .
to avoid analyzing paths that may not actually reach these vulnerable statements and thus improving analysis efficiency constructbackreachpaths builds these relevant program paths through a backward traversal algorithm over a method s control flow graph.
intentcontrolanalysis determines whether to utilize for an invoked method in spof path p or construct entirely new intent 664automatic generation of inter component communication exploits for android applications esec fse september paderborn germany algorithm generateexprsforstmt input a statement spof method m path pinmcontaining sp use def chain usedefs mof method m output expressions newexprs describing intent and path condition information at statement sp 1newexprs 2ifspextracts extra data from an intent iof the form re i.get extra rk then newexprs enextradataexprs sp p usedefs m newexprs 4else if spextracts an action from an intent iof the form ra i.getaction then newexprs gengetactionexprs sp p usedefs m newexprs 6else if spis of the form if i.hascategory rc where iis an intent then newexprs gencategoryexprs sp p usedefs m newexprs 8else if spis a conditional statement of the form if r1.equals r2 then ifr1is a string obtained from an intent s extra data then newexprs genstringattrexprs sp p usedefs m newexprs else if r1is an arbitrary object obtained from an intent s extra data then newexprs genobjequalityexprs sp p usedefs m newexprs 13else if spis a conditional statement of the form if l op r then newexprs genconditionalexprs sp p newexprs expressions for sp.
for invoked methods lines of algorithm utilize method summaries to determine context sensitive intent information at a call site by enumerating path expressions from and updating based on the current method munder analysis.
for other types of statements lines of algorithm utilize generateexprsforstmt to construct new intent expressions.
in that block of code intentcontrolanalysis stores intent information i.e.
expressions describing the intent s attributes in .
at this point the computed path conditions and expressions describing intents may be sent to a solver to check for feasibility and to generate intents that can execute specific program paths.
.
.
generating intent expressions.
the production of expressions describing message controlling intents occurs during the first phase on lines of algorithm .
for each statement spin a path pthat reaches vulnerable statement st algorithm at line generates a set of expressions describing the intent or the path conditions atspby invoking generateexprsforstmt shown in algorithm .
generateexprsforstmt generates each expression in a language suitable for supplying to an smt solver i.e.
the smt lib language allowing our analysis to use the smt solver to determine feasibility of paths and also the validity of the expressions describing intents their attributes i.e.
actions categories and extra data and their relations to programming language level constructs e.g.
object