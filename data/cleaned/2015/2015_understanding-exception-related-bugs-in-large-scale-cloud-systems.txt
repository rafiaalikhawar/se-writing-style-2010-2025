understanding exception related bugs in large scale cloud systems haicheng chen wensheng dou yanyan jiang feng qin department of computer science and engineering the ohio state university united states state key lab of computer science institute of software chinese academy of sciences china state key lab for novel software technology nanjing university china chen.
qin.
osu.edu wsdou otcaix.iscas.ac.cn jyy nju.edu.cn abstract exception mechanism is widely used in cloud systems.
this is mainly because it separates the error handling codefrom main business logic.
however the huge space of potentialerror conditions and the sophisticated logic of cloud systems present a big hurdle to the correct use of exception mechanism.
as a result mistakes in the exception use may lead to severeconsequences such as system downtime and data loss.
to addressthis issue the communities direly need a better understanding ofthe exception related bugs i.e.
ebugs which are caused by the incorrect use of exception mechanism in cloud systems.
in this paper we present a comprehensive study on ebugs from six widely deployed cloud systems including cassandra hbase hdfs hadoop mapreduce y arn and zookeeper.
for all the studied ebugs we analyze their triggering conditions root causes bug impacts and their relations.
to the best of ourknowledge this is the first study on ebugs in cloud systems andthe first one that focuses on triggering conditions.
we find thatebugs are severe in cloud systems of our studied ebugsaffect system availability or integrity.
luckily exposing ebugs through testing is possible of the ebugs are triggered by non semantic conditions such as network errors of theebugs can be triggered by simulating the triggering conditionsat simple system states.
furthermore we find that the triggeringconditions are useful for detecting ebugs.
based on such relevantfindings we build a static analysis tool called diet and apply it to the latest versions of the studied systems.
our results show that diet reports bugs and bad practices and of themare confirmed by the developers as previously unknown ones.
i. i ntroduction exception mechanism is widely used to handle errors in cloud systems.
at the time of this writing about of the source code in twelve popular open source distributed systems involves exception mechanism figure i.e.
throwing exceptions or being enclosed in try catch o r finally code blocks.
such a widespread use of exception mechanismis mainly due to its advantages over the traditional checkingreturn value mechanism .
first it separates the error handling code from main business logic making programs easierto reason about.
second the runtime system automaticallypropagates exceptions up along the call stacks until they arecaught so that error conditions will not remain unnoticed.third it allows developers to combine multiple exceptions by using their common superclass exception providing greater flexibility to write the error handling code.
unfortunately highly diverse environments and system complexity make exception handling in cloud systems prone g10 g8 g7 g12 g16 g12 g16 g16 g16 g9 g15 g7 g15 g11 g15 g11 g9 g8 g7 g15 g16 g15 g16 g15 g7 g16 g11 g15 g7 g15 g14 g15 g14 g15 g7 g11 g12 g15 g7 g8 g16 g8 g16 g14 g7 g16 g17 g14 g7 g15 g13 g15 g13 g12 g7 g8 g16 g11 g7 g17 g10 g11 g7 g9 g11 g11 g15 g7 g10 g11 g8 g9 g8 g10 g8 g20 g35 g46 g37 g48 g28 g27 g41 g41 g22 g32 g32 g42 g32 g43 g24 g36 g34 g21 g28 g31 g41 g41 g42 g5 g21 g19 g28 g44 g32 g26 g32 g50 g21 g36 g47 g32 g20 g28 g44 g44 g28 g40 g31 g43 g28 g18 g39 g29 g28 g43 g36 g23 g28 g35 g41 g46 g45 g18 g47 g43 g41 g25 g42 g28 g43 g37 g18 g47 g32 g43 g28 g34 g32 g24 g43 g41 g42 g41 g43 g45 g36 g41 g40 g1 g41 g33 g1 g32 g49 g30 g32 g42 g45 g36 g41 g40 g6 g43 g32 g38 g28 g45 g32 g31 g1 g30 g41 g31 g32 g1 g3 g2 g4 fig.
.
statistics of source code excluding empty lines that involves exception mechanism in twelve cloud systems.
the hadoop project includes hadoop common hadoop mapreduce hdfs and yarn.
to errors which can severely hurt system reliability .
when implementing a cloud system developers need to constantly anticipate various conditions that may causeexceptions.
such conditions can either come from the externalenvironment e.g.
a remote node is unreachable or be causedby internal program states e.g.
a variable is set to a wrongvalue .
furthermore the sheer scale of cloud systems bothhardware size and software complexity dramatically increasesthe hurdle of correct exception handling.
in this paper we referto the mistakes in using exception mechanism as exception related bugs or ebugs .
existing studies on ebugs mainly investigate the root causes based on source code patterns the relation between ebugs and certain language features e.g.
aspect oriented programming and android abstractions and developers perception on ebugs .
while having discovered useful characteristics of ebugs none of these studies considerthe exception triggering conditions and their relations withebugs.
these relations are essential for understanding the rootcauses and facilitating exposure and detection of ebugs.
cloud systems often encounter complicated external and internal triggering conditions for exceptions.
this unique characteristicmotivates us to investigate the root causes of ebugs throughunderstanding their exception triggering conditions.
in this paper we perform a comprehensive study on ebugs in cloud systems from the perspective of triggering conditions.
in particular this study covers well documented ebugs selected from about exception related jira issues across six popular open source cloud systems includingcassandra hbase hdfs hadoop mapreduce yarn and zookeeper .
we thoroughly analyze both their bug reports and fixing patches to answer ui .
oufsobujpobm pogfsfodf po vupnbufe 4pguxb sf ohjoffsjoh authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
the following key research questions rq1 how are ebugs triggered in cloud systems?
it helps us understand the conditions that trigger ebug bound ex ceptions.
our findings can benefit developers to effectivelyexpose ebugs in cloud systems.
rq2 what is the relation between the triggering conditions and the root causes of ebugs?
our in depth analysis on the root causes and their relations with the triggering conditionscan facilitate ebug detection in cloud systems.
rq3 what are the impacts of ebugs on cloud systems?
by analyzing their impacts we can understand the severity ofebugs in cloud systems.
to the best of our knowledge this is the first comprehensive study on ebugs in real world cloud systems and the firstone from the perspective of triggering conditions.
throughthis study we have obtained many interesting findings thatopen up new research opportunities to combat ebugs in the cloud.
the main findings are more than half of the studied ebugs are exposed by non semantic triggeringconditions most of which are network errors and filesystem errors finding .
most of the ebugs do not have strong timing requirements on their triggering conditions finding .
of the ebugs are caused by handling an exception in an overly general thus incorrect way.
among them many are caused by incorrectly applying thesame handling operations to the exceptions that have differenttriggering condition types finding .
of the ebugs are caused by creating exception objects that do not describe their triggering conditions accurately findings and .
most of the ebugs affect the dependability of cloudsystems e.g.
by crashing nodes or losing data and developersconsider most of them severe finding .
these findings show the severity of ebugs in cloud systems while revealing many new opportunities to combat them.
first we can expose ebugs by simulating non semantic triggeringconditions at simple system states e.g.
consistent globalstates.
second we can detect ebugs by analyzing exception triggering conditions.
for instance we can detect inaccurate exceptions by checking whether the exceptions accuratelydescribe their triggering conditions.
as another example wecan detect overly general handlers by examining if the samehandling code is applied to exceptions with different triggering condition types.
based on these findings we build a static analysis tool called diet to detect inaccurate exceptions by analyzing their exception classes and error messages.
byapplying diet to the latest versions of the studied systems we find new bugs and bad practices.
at the time of this writing developers have confirmed of them.
note that an inaccurate exception can be an ebug if it affects the correctness or performance of a checked system or a bad practice if it may introduce a potential ebug in future system versions.
in summary we make the following key contributions we present the first comprehensive study on ebugs from the perspective of triggering conditions in six widely deployedcloud systems.table i investigated bugreports in the studied systems system ca hb hf mr yn zk total retrieved studied we unveil many interesting findings and explain their implications for combating ebugs in cloud systems.
for example we find that triggering conditions and their relations withroot causes provide valuable information for the developersof cloud systems.
based on our findings we build a static analysis tool called diet and evaluate it using the latest versions of the studied systems.
we have exposed many new bugs and bad practicesthat have been confirmed by the developers of these systems.
we provide a large benchmark of ebugs in cloud systems which can be used to evaluate the effectiveness of the toolsthat expose and detect ebugs in cloud systems.
our ebugdatabase is available at .
ii.
m ethodology a. target systems to understand the characteristics of ebugs in real world cloud systems we select the target systems based on threecriteria i the systems must be diverse for an unbiased dataset.
ii the systems should be mature and popular so that we can understand the real problems faced by developers.
iii the systems should be open source and have public issuetracking systems.
with these requirements in mind we identify the following six cloud systems i cassandra a highly available peer to peer nosql database ii hbase a masterslave nosql database iii hdfs a distributed file system iv hadoop mapreduce a distributed data processing framework v yarn a distributed resource management system and vi zookeeper a distributed coordination service.
b. ebug collection all the target systems use jira to manage their issues.
over a time span of more than ten years from to more than issues were submitted for these systems.it is time consuming and impractical to manually inspect allthese issues and identify ebugs from them.
we therefore applya few filtering rules to identify the relevant issues.
first we use the following jql jira query language statement to retrieve potentially relevant issues issuetype bug andstatusin resolved closed andresolution fixed andtext exception with this jql statement we narrow down all the issues to only fully resolved resolved orclosed instatus and fixed bugs authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
that contain the keyword exception orexceptions .
this jql returns us with issues row retrieved in table i1 .
we further narrow down the retrieved issues by requiring each selected bug report to include a full exception stack traceand a fixing commit.
the exception stack trace and the fixingcommit are critical for us to fully understand an ebug becausethey contain information like what exception is thrown andhow the ebug occurs.
we further remove the ones whose bugsare located in test files or non java files because they are notrelated to the core functionality of the target systems.
thisleaves us with reports.
finally we manually inspect the remaining reports and keep the ones that are related to exception mechanism as discussed in iii.
this leaves us with issues for further analysis row studied in table i .
in this paper we denote an ebug using its bug id in jira i.e.
sys wheresys is the system name and is the ebug s issue id.
c. ebug analysis to answer our three research questions we perform an indepth analysis on each ebug based on the bug description including the exception stack trace the discussion amongdevelopers in the report and the source code of the targetsystem including the fix .
we also refer to online resources e.g.
documentation to facilitate our understanding on ebugs.through this process we recover the full picture of how each ebug is triggered rq1 how the target system incorrectlyuses exception mechanism rq2 and how each ebug affectsthe system rq3 .
then we classify ebugs according to their triggering conditions root causes and bug impacts.
d. threats to v alidity to maintain the accuracy of our study we employ different measures to improve our understanding.
for example we usethe final fixing commit and sometimes reproduce an ebug toconfirm its triggering condition and root cause.
even though we try to be unbiased readers need to understand the following limitations of our study.
first all ofour subject systems are open source cloud systems.
ebugs incommercial cloud systems or other types of software systemsmay have different characteristics.
additionally we may misssome ebugs due to our selection process.
for example we may exclude ebugs that do not have full exception stack traces in their bug reports.
finally we only study ebugs in java.
whilethe exception mechanism in java is generally similar to theones in other languages e.g.
c c and python java hasa few unique features which may affect developers practicein using exceptions.
therefore readers need to be cautiouswhen extending our findings to other scenarios.
iii.
e xception mechanism figure 2shows the model of exception mechanism.
during program execution an unexpected error referred to as atriggering condition occurs.
based on the error type java 1for simplicity we use ca hb hf mr yn and zk to represent cassandra hbase hdfs mapreduce yarn and zookeeper respectively.
g5 g24 g12 g14 g21 g23 g17 g20 g19 g3 g22 g14 g11 g23 g17 g20 g19 g5 g24 g12 g14 g21 g23 g17 g20 g19 g8 g22 g20 g21 g11 g15 g11 g23 g17 g20 g19 g9 g14 g11 g12 g23 g14 g13 g7 g14 g23 g16 g20 g13 g5 g24 g12 g14 g21 g23 g17 g20 g19 g6 g11 g19 g13 g18 g17 g19 g15 g10 g22 g17 g15 g15 g14 g22 g17 g19 g15 g3 g20 g19 g13 g17 g23 g17 g20 g19 g3 g1 g2 g4 g1 g2 g4 1void b ... throws otherexception try a ... catch someexception e somehandling ... throw new otherexception e fig.
.
the model of exception mechanism and the code snippet of method b that handles the exception thrown from method a .
runtime creates and propagates an exception.
the propagation starts from a throw statement and ends at a catch statement along the call stack in the reverse call order.
after a methodcatches the exception and performs exception handling boxesa b and d it can optionally re throw the caught exception box a or wrap the caught exception in a new exceptionbefore re throwing it box b .
either way the re thrown exception starts a new propagation.
along the propagation path some methods including the one where the throw statement locates may not catch the exception.
instead these methodscan specify the exception class in the method signatures usingthe throws keyword.
in this way a method notifies its callers that it can propagate the specified exception so that the callers can implement proper exception handling as needed.
box c represents the scenario where a method does not catch theexception but specifies it in the signature.
we consider bothcatching an exception and specifying an exception in thesignature as a method reacting to the exception.
the lower half in figure 2shows the code snippet of b .
whena throws asomeexception b catches and handles it lines .
b then wraps the someexception in a newly created otherexception which it throws at line .
b also specifies the re thrown otherexception line so that its callers can react to the exception accordingly.
we further define the following terms used in our study root exception the initially created exception due to the triggering condition e.g.
the left diamond shape in figure .
cause exception if an exception eais wrapped by another exception eb eais the cause exception ofeb.
in the example above the someexception is the cause exception of the otherexception .
ebug a bug that occurs in creating throwing catching or handling an exception.
iv .
t riggering conditions the triggering condition is the key to trigger an ebug.
in this section we study both the types of triggering conditions iv a and their timing requirements iv b .
a. triggering condition types we first examine whether the triggering conditions are related to program semantics.
semantic conditions are specific toeach individual target system while findings on non semantic authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table ii triggering conditions of the studied e bugs and their typical scenarios in each system triggering condition ebugs scenario ebugs ca hb hf mr yn zk non semantic condition network error premature disconnection local timeout connection refused other network errors file system error file corrupted file not found other file system errors out of resource out of memory out of disk space port conflicted out of other resources untimely interrupt thread interrupted when invoking a210360blocking method semantic condition total conditions are general to a broader class of cloud systems.
we notice that the majority of the studied ebugs outof are triggered by non semantic conditions such as anode being unreachable.
the remaining ebugs out of are triggered by semantic conditions such as a variable beingassigned with an incorrect value.
to better understand non semantic conditions we further classify them into the following four categories based onthe error types i network error the system encounters a failed network connection.
ii file system error the system encounters a failed file system operation e.g.
opening a non existent file.
iii out of resource system resource such as memory space is used up.
iv untimely interrupt a system interrupt occurs when a thread is sleeping or waiting e.g.
aftercalling thread.sleep .
table iishows the typical scenarios of each condition type and their distribution.
finding most of the non semantic conditions are either network errors or file system errors.
network error cloud systems are deployed on network and thereby strive to handle network errors in both designand implementation phases.
however network error is stillthe most common type of non semantic condition in the studied ebugs.
with further investigation we find that most of the network errors occur in the followingthree scenarios i premature disconnection .
for example in hdfs a datanode throws an eofexception when a namenode terminates the connection after sending par tial data to the datanode.
ii local timeout .
for instance in hbase an hmaster throws a sockettimeoutexception if it times out before receiving a response from a regionserver.
iii connection refused .i nyarn a nodemagager tries to connect to a resourcemanager thathas not started.
as a result the remote operating systemrejects the connection causing the nodemanager to throw a connectexception .
the remaining network errors are caused by various reasons such as failed routing andunsuccessful host name resolution.
file system error cloud systems store critical user and system data on file systems.
since file systems are never perfect cloud systems are expected to correctly react to file system errors.
for example when failing to read a datachunk a distributed file system e.g.
hdfs may start thedata recovery process using a remote data replica.
however we find that a significant number of ebugs are triggered byfile system errors.
among these errors the most frequentscenarios are files being corrupted and files not found i file corrupted .
for example in cassandra a cassandra server throws an eofexception when it unexpectedly reads the end of a truncated hint file.
ii file not found .
for instance in hbase a restarted hmaster throws a filenotfoundexception when it fails to find a znode file to read.
other file system errors include access mode violation file path resolution failure and disk failure.
out of resource cloud systems interact with system resources extensively.
however the desired resource may notbe always available.
of the non semantic ebugs aretriggered when certain resource is exhausted.
among the 16out of resource ebugs are triggered due to running outof i memory space ii disk space or iii host ports .f o r example in cassandra a cassandra server throws a bindexception when it tries to bind an occupied port.
other resources include opened file handlers and disk quotas.
untimely interrupt cloud systems are highly concurrent.
they may try to perform two conflicting operations atthe same time.
when this happens one operation may stop theother via interrupt.
we find that a considerable amount of non semantic ebugs are triggered by untimely interrupts.
for example yarn is triggered when one thread of a authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table iii timing requirements on e bugtriggering conditions condition typetiming requirement weak moderate strong network error file system error 3out of resource untimely interrupt semantic condition total nodemanager process is checking the status of a container while another thread is shutting down the whole process.
semantic condition about half of the root exceptions are triggered by semantic conditions .
semantic conditions are closely related to program logic and thereby can be specific to each individual system.
for example in cassandra a cassandra server throws an unknowncolumnfamilyexception when it tries to access a nonexistent column family.
from this example we can see that triggering this type of ebugs needs domain knowledge about the target systems e.g.
column family is a data structureused in cassandra to organize both user data and system data.however other systems e.g.
hdfs do not have this concept.since of the conditions are relevant to semantics theycall for more attention from our communities.
b. timing requirements on triggering conditions finding most of the ebugs do not have strong timing requirements on their triggering conditions.
ebugs can be triggered only when triggering conditions occur at certain system states.
to understand the difficulty of triggering ebugs in cloud systems we further analyze eachebug s timing requirement on its triggering condition.
weuse a similar measurement as a previous bug study in cloudsystems and classify the timing requirements into three categories as shown in table iii.
weak ebugs .
to trigger this type of ebugs the triggering condition can occur at any consistent global state orbefore the system starts.
for example zookeeper can be triggered whenever a user issues a delete commandwith an invalid pathname.
moderate ebugs .
the triggering condition needs to occur on a node when it is in certain states.
to trigger theseebugs we only need to consider the runtime state of onenode.
for example mapreduce can be triggered by simulating out of disk space when a reduce task tries towrite a map output to disk.
there is no need to check the states of other nodes in the system.
strong ebugs .
the triggering condition needs to occur on a node when both the current node and other nodes are incertain states.
to trigger these ebugs we need to consider g6 g20 g11 g12 g12 g26 g23 g11 g25 g14 g1 g5 g29 g12 g14 g22 g25 g17 g21 g20 g8 g17 g24 g24 g17 g20 g15 g1 g10 g14 g11 g12 g25 g17 g21 g20 g9 g27 g14 g23 g18 g30 g2 g15 g14 g20 g14 g23 g11 g18 g1 g10 g14 g11 g12 g25 g17 g21 g20 g4 g1 g19 g14 g25 g16 g21 g13 g1 g25 g16 g11 g25 g1 g23 g14 g11 g12 g25 g24 g1 g25 g21 g1 g21 g20 g18 g30 g1 g24 g21 g19 g14 g1 g14 g29 g12 g14 g22 g25 g17 g21 g20 g24 g3 g6 g20 g12 g21 g23 g23 g14 g12 g25 g1 g10 g14 g11 g12 g25 g17 g21 g20 g1 g7 g21 g15 g17 g12 g1 g2 g1 g2 g4 g1 g19 g14 g25 g16 g21 g13 g1 g28 g17 g25 g16 g1 g11 g20 g30 g1 g23 g14 g11 g12 g25 g17 g21 g20 g3 g4 g1 g19 g14 g25 g16 g21 g13 g1 g28 g17 g25 g16 g1 g20 g21 g1 g23 g14 g11 g12 g25 g17 g21 g20 g3 fig.
.
four different types of ebug root causes.
for each type we show the correct version on the left green and the buggy version on the right red .
table iv statistics of e bugroot causes root cause ebug ca hb hf mr yn zk inaccurate exception missing reaction overly general reaction incorrect reaction logic total the states of multiple nodes.
for example yarn can only be triggered when a mapreduce applicationmasterasks a nodemanager to start a container while the node manager is still in the initialization phase.
v. r oot causes based on the exception mechanism shown in figure ebugs can be classified into three categories inaccurate exception if the ebug is caused by creating an inaccurate exception missing reaction if the ebug is caused by neither catching nor specifying an exception in the method signature and incorrect reaction if the ebug incorrectly reacts to an exception.
incorrect reaction can be further broken downinto overly general reaction where different exceptions are incorrectly handled in the same way and incorrect reaction logic where the reaction logic is incorrect for all exceptions.
figure 3illustrates these four types of ebugs and table iv shows their distribution.
note that previous studies have also classified ebugs based on their root causes .
unlike them the focus of our classification is on the relation betweenthe triggering conditions and the root causes rq2 .
a. inaccurate exception a newly created exception is expected to accurately represent the triggering condition so that the system can correctlyreact to the error.
this requires the exception to instantiate thecorrect class and contain correct information such as an error message and a cause exception .
table vshows the number of ebugs where the exception instantiates a wrong class has awrong error message or misses a cause exception.
wrong exception class exception class is the primary source to indicate the triggering condition.
an exception instance with a wrong class will not be handled correctly.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table v thetype distribution of inaccurate exception e bugs type wrong class wrong message lacking cause total ebug void updatemetalocation throws ioexception if waitforrootserverconnection null throw new nullpointerexception ... throw new ioexception ... void process try updatemetalocation catch ioexception e cleanup fig.
.
ebug hbase .anullpointerexception is thrown when a remote node is unreachable.
we find two ways of creating incorrect exceptions i in five ebugs the incorrect exception class is the superclass ofthe intended one.
ii in the other eight ebugs the incorrectexception class has no relation with i.e.
neither a superclassnor a subclass of the intended one.
finding using a superclass of the intended exception makes it difficult to perform correct exception handling.
we find that ioexception is the only culprit class in all the five ebugs that use a superclass of the intended exception.
forexample in hdfs a datanode throws an ioexception when it tries to read the checksum granularity from a corruptedfile.
since other disk failures e.g.
out of disk space alsotrigger ioexception the datanode cannot differentiate the exceptions to perform data recovery only for file corruption.to fix this bug a dedicated subclass exception invalidchecksumsizeexception is used to denote the case where the file storing the checksum granularity is corrupted.
finding in half of the ebugs that create a totally misleading exception the exception class is inconsistent with its triggering condition.
when the newly created class is neither a superclass nor a subclass of the intended one the exception cannot be correctly caught by its intended catch block.
take ebug hbase in figure 4as an example.
when a regionserver opens a meta region it needs to report the update to the rootserver.
if the rootserver is currently un reachable waitforrootserverconnection will return anull line .
instead of throwing an ioexception that semantically matches the triggering condition i.e.
network error the buggy code throws a nullpointerexception line .
we actually throw the npe it s not an actualnpe a developer also points out.
as a result even thougha proper catch block exists line it will not catch the exception leaving the meta region inaccessible.table vi thetriggering conditions and exception classes of four ebugs with totally misleading exception classes bug id triggering cond.
exception class cassandra out of resource runtimeexception hbase network error nullpointerexception hdfs file system error leaseexpiredexception yarn untimely interrupt ioexception table vii exception classes that are triggered more than once by non semantic triggering conditions triggering cond.
n p top exception class network error connectexception ioexception sockettimeoutexception eofexception file system error eofexception filenotfoundexception ioexception illegalargumentexception out of resource outofmemoryerror ioexception bindexception untimely interrupt interruptedexception n is the number of exception classes.
p is the percentage of ebugs the classes cover the triggering condition.
due to space limit we only show the top four exception classes for network errors.
among the eight ebugs in this category four of them are triggered by non semantic conditions.
we find that all the incorrect classes are inconsistent with their conditions table vi .
this makes us wonder does each type of non semantic condition have a set of frequently triggered exception classes?if so the inconsistency between the common classes and thetriggered ones may help detect inaccurate exception ebugs.
we analyze all the ebugs with non semantic triggering conditions.
for each ebug we use the root exception class because it is directly related to the triggering condition.to prevent using the wrong exception classes in inaccurateexception ebugs we employ their fixing patches to retrievethe correct exception classes.
finding f or non semantic triggering conditions a few exception classes can cover most ebugs .
as table vii shows each condition type triggers only a few exception classes more than once and these classes cover a majority of ebugs with the corresponding conditiontype.
for example three exception classes cover of theebugs that are exposed by the triggering condition of outof resource .
we also notice that these frequently triggeredclasses do not include the misleading ones shown in table vi.
for example the runtimeexception incassanra is not a frequently triggered class for the out of resource authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
g2 g4 g3 g3 g2 g2 g1 g5 g2 g1 g2 g5 g2 g3 g4 g5 g6 g6 g19 g14 g9 g11 g17 g1 g16 g12 g1 g5 g13 g8 g18 g18 g11 g18nullpointerexceptionillegalargumentexception g7 g10 g10 g19 g17 g17 g11 g15 g10 g11 fig.
.
exception classes that occur in missing reaction ebugs.
void call try reacquirecontainer ... catch interruptedioexception e log.warn ... catch ioexception e filenotfoundexception can reach here.
deactivatecontainer ... int reacquirecontainer ... throws ioexception ... fig.
.
ebug yarn .
handling ioexception and its subclasses in the same way stops a running yarn container prematurely.
triggering condition.
wrong error message or lacking cause exception when an exception carries a wrong error message or anexception does not wrap a cause exception developers may lack critical information about the triggering condition for diagnosing the failure.
for example in hdfs i fa datanode disconnects with an hdfs client the client willthrow an eofexception with a message stating premature eof no length prefix available .
as the bug reporter pointsout this error message is not very clear to a user because it does not indicate that the datanode is unreachable.
b. missing reaction once an exception is thrown some methods in the call stack need to react to it.
if these methods neither catch the exception nor specify it in their signatures we refer to this type of mistake as a missing reaction ebug.
we examine the fixing patch of an ebug to identify which methods should reactto an exception.
to gain more insights we also analyze theexception classes that are missed.
finding illegalargumentexception and nullpointerexception are the dominant exception classes thatcause missing reactions.
as shown in figure we find that many exception classes can be missed by developers.
among them twoclasses are more frequent than others illegalargumentexception andnullpointerexception .
for example in cassandra a cassandra server throws an illegalargumentexception when a client queries a nonexistent column family from it.
since none of the methods in the callstack handles this exception the java thread crashes and theclient gets disconnected abruptly.table viii therelation between the triggering conditions of the incorrectly reacted exception and the correctly reacted ones in overly general reaction e bugs relation same type different types unknown total ebug c. overly general reaction if a method can throw multiple exception classes it is a norm for developers to specify only their com mon parent class in the method signature.
for exam ple method reacquirecontainer in figure 6specifies only an ioexception line but it can throw subclasses like interruptedioexception andfilenotfoundexception .
however this common practice poses a big challenge for accurate exception handling because developers need to beaware of all the potential exceptions a method can throw.
asa result developers can make overly general reaction ebugs i.e.
incorrectly handling multiple exceptions in the same waywhile they should be treated differently.
we find that overlygeneral reaction causes many ebugs.
for example ebug yarn in figure 6incorrectly applies the same handling to ioexception and its subclasses such asinterruptedioexception andfilenotfoundexception .
when a nodemanager restarts it will invoke reacquirecontainer to reload the information of a running container and wait for its completion line .
ifthe nodemanager interrupts the waiting thread because itneeds to restart again reacquirecontainer will throw aninterruptedioexception .
the method call incorrectly catches and handles this exception in the same wayas other ioexception s lines .
therefore the running container stops prematurely for a benign interrupt line .instead the method call should catch the interruptedioexception separately and let the container continue running lines .
finding in many overly general reaction ebugs the incorrectly reacted exception and the correctly reacted ones are caused by different types of tiggering conditions.
although multiple exceptions can be combined and handled in the same way exceptions with different triggering conditiontypes i.e.
network error file system error out of resource untimely interrupt and semantic condition in iv a usually represent different errors and may require different handling.
we analyze the relation between the correctly reacted exceptions whose reaction is not changed in the fixing patch andthe incorrectly reacted one as specified in the ebug report ineach ebug to see if they are triggered by different triggeringcondition types table viii .
if the incorrectly reacted exception and the correctly reacted ones are caused by different triggering condition types we label the ebug as different type .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
list servername fetchserveraddresses try return listservernames catch keeperexception e return null return new arraylist servername fig.
.
ebug hbase .
instead of a null the handler should return an emptyarraylist when server names cannot be retrieved.
table ix ebugfailure symptoms symptom ebug node downtime incorrect error message data loss or potential data loss hang or performance downgrading resource leak exhaustion operation failure total we only consider an ebug as causing operation failure if it does not have any other symptom.
if their triggering condition types overlap we label the ebug assame type .
we cannot infer the triggering conditions of the correctly handled exceptions in nine ebugs due to insufficientinformation around the throw statements.
so we label them asunknown .
we observe that in many overly general reaction ebugs the exceptions are triggered by differentcondition types.
for example in yarn figure the interruptedioexception is triggered by an untimely interrupt while other ioexception s are triggered by different condition types like a filenotfoundexception triggered by a file system error.
d. incorrect reaction logic if a handler is incorrect for all the exceptions it handles we say that it has incorrect reaction logic .
takehbase in figure 7as an example.
in hbase when a regionserver tries to replicate its data to a different cluster it needs tofetch the destination server names from zookeeper line .if zookeeper is unreachable an exception will be thrown.
the handler catches it line and returns a null line .
the caller of fetchserveraddresses does not expect the return value to be null and dereferences it not shown in the figure which crashes the thread.
instead the handler should return an empty arraylist which the caller can handle properly.
detecting this type of ebugs requires understandingthe system logic which remains a challenge for future work.
vi.
b ugimpacts we study the ebug impacts from two perspectives.
first we analyze their failure symptoms to understand how they affectthe systems table ix .
then we use the issue priority to infer if developers consider an ebug as a severe defect table x .table x jira i ssue priority of e bugs priority blocker critical major minor trivial total ebug finding of the ebugs affect the availability e.g.
node downtime and integrity e.g.
data loss of cloudsystems.
moreover developers consider most of themas severe defects i.e.
priority not lower than major .
overall we find that ebugs have various failure symptoms.
many of them affect the system availability e.g.
node down time and integrity e.g.
data loss .
sometimes ebugs can turna transient and benign error i.e.
an exception into a severefailure.
for example in yarn a nodemanager aborts only because it fails to register itself with the resourceman ager due to a transient network partitioning.
a simple retryfixes the ebug and allows the nodemanger to start.
we also find that developers consider most of the ebugs as severe defects i.e.
having a priority of blocker critical o r major .
even the seemingly most benign type of symptoms i.e.
incorrect error message can cause much trouble for end users of cloud systems two thirds of these cases are marked as major or a higher priority in jira.
vii.
l essons learned and applications our study shows that ebugs seriously affect the dependability of cloud systems finding .
in this section we discuss implications for existing approaches and opportunitiesfor new research to combat ebugs in cloud systems vii a vii b and vii c .
additionally we discuss our experiences in applying the findings to detect new inaccurate exceptionsin the studied cloud systems vii d .
a. testing cloud systems under adversarial conditions software testing is critical in exposing bugs before software release.
many testing techniques have been proposed forexposing or detecting software bugs but few are designed for cloud systems .
cloud systems usually run in complex cluster environments and may encounter different kinds of adversarial conditions e.g.
network errors and file system errors.
improperly han dling these conditions can lead to severe consequences.
asfigure 1shows cloud systems often use exception mechanism to handle adversarial conditions.
however finding 1indicates that there are issues in handling some conditions.
existing testing techniques on cloud systems have tried to inject adver sarial conditions such as network partitioning file corruption and out of disk space .
however other adversarial conditions in table ii such as connection refused file not found port conflict and untimely interrupt have not been attempted in cloud systems.
moreover researchers and developers can use the triggering conditions summarized in ivas a checklist to test cloud systems.
for example by authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
limiting the available memory and disk space during normal testing ebugs that are triggered by either out of memory or out of disk space become more likely to be exposed.
to trigger an ebug testing tools need to simulate the triggering condition at proper system states.
luckily finding shows that most ebugs e.g.
zookeeper and mapreduce have weak or moderate requirements on system states.
this finding indicates that simple simulation oftriggering conditions can expose most ebugs in cloud systems.
b. avoiding ebugs in cloud systems our findings imply that enhancing exception flow analysis can help avoid ebugs.
exception flow analysis helps developers better understand the exception propagation in thesystem and thereby better react to exceptions.
throughoutour study we consistently observe that the root causes ofmany ebugs are related to their exception triggering conditions findings and .
therefore by combining exception flow analysis with the related triggering conditions developerscan obtain deeper understanding about what error triggers anexception and thus handle it correctly.
for example hbasedefines exception subclasses that extend ioexception .f o r a method handling ioexception it will be greatly helpful to avoid overly general reactions if developers can know eachconcrete exception and its triggering condition.
c. detecting ebugs in cloud systems unlike existing ebug detection tools that focus on empty or incomplete exception handlers overly general handlers that stop the system missing recovery operations or violations of predefined exception propagation rules our findings findings and reveal the important correlation between the root causes and triggering conditions which suggests new opportunities for detecting ebugs.
findings 5indicate that inaccurate exceptions do not accurately describe their triggering conditions.
therefore it ispossible to detect these ebugs by checking if the exceptionsare consistent with their triggering conditions.
in this way wecan detect ebugs like hbase where hbase incorrectly throws anullpointerexception for a network error.
table viialso provides the commonly triggered exceptions for each non semantic condition type.
detection tools can use it as achecklist to detect inaccurate exceptions.
similarly finding 7shows that some overly general reactions incorrectly apply the same handling code to the excep tions that are caused by different triggering condition types.this suggests a new way to detect overly general reactions i.e.
by checking if the handled exceptions are triggered by different condition types.
therefore we can detect ebugslike yarn where two exceptions interruptedioexception andfilenotfoundexception are triggered by different condition types untimely interrupt and file systemerror respectively but are handled in the same way.d.
diet d etecting i naccurate e xceptions using triggering condition t ypes findings 3and4in v a show that inaccurate exceptions cannot describe the triggering conditions precisely and may mislead developers to handle them incorrectly.
we also obtaintwo interesting observations from our study there existstrong relations among exception classes and their triggeringcondition types finding .
an exception s error message usually convey information about its triggering condition type.
ideally an exception s class and error message should conveythe consistent information about its triggering condition type.if an exception s class and its error message imply differenttypes of triggering conditions the exception is likely to beinaccurate.
inspired by these observations we build a static analysis tool diet to automatically detect inaccurate exceptions by inspecting the inconsistency between an exception sclass and its error message.
diet s approach diet works in two phases a learning phase and a detection phase.
in the learning phase given a set of e t pairs where edenotes a root exception and tdenotes e s triggering condition type diet learns two probabilities i p c t the probability that the triggering condition of an exception with class cis of type t and ii pw t the probability that the triggering condition of an exception containing keyword win its error message is of type t. in the detection phase for a given root exception diet employs the aboveprobabilities to examine whether its exception class and errormessage imply different triggering condition types.
note that diet focuses on root exceptions because they usually describethe triggering conditions more accurately than their wrapperexceptions.
diet identifies root exceptions by finding the onesthat have no cause exceptions.
in the diet design and experiment we use the five triggering condition types summarized in iv a i.e.
network error file system error out of resource untimely interrupt and semantic condition.
we further use all the ebugs inour empirical study to learn p c tandpw t. learn pc t we first extract the root exception s class ci and its corresponding triggering condition type tifrom each studied ebug ei.
this step generates pairs of ci ti .f o r each exception class cin these pairs the probability that c s triggering condition is of type tis computed using the following equation pc t number of ci tj where ci c ti t number of ci ti where ci c learn pw t we first extract the root exception s error message miand its triggering condition type tifrom each studied ebug ei.
since the root exceptions in ebugs do not have error messages this step generates pairs of mi ti .
next diet extracts the unique keywords from each error message.
note that diet does not consider numbers conjunctions determiners and adverbs as keywords becausethey do not reflect the essence of triggering conditions.
for each m i ti pair diet can generates multiple wi j ti pairs authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
g1 g2 g1 g3 g1 g4 g1 g9 g19 g30 g32 g26 g28 g22 g6 g28 g28 g26 g28 g7 g21 g23 g19 g1 g13 g33 g29 g30 g19 g24 g6 g28 g28 g26 g28 g10 g31 g30 g1 g26 g20 g12 g19 g29 g26 g31 g28 g17 g19 g14 g25 g30 g21 g24 g19 g23 g33 g8 g25 g30 g19 g28 g28 g31 g27 g30 g13 g19 g24 g15 g25 g30 g21 g17 g5 g26 g25 g18 g21 g30 g21 g26 g25 g11 g28 g26 g16 g15 g16 g21 g23 g21 g30 g33 g1 g3 g2 g4 g2 g3 g1 g5 g2 g4 g1 g5 g30 fig.
.
the pc tandpm tof an exception.
for example when tis network error pc tis and pm t is .
the overlapping areas are highlighted with the dashed boxes.
the total overlap is .
where wi jdenotes the jthunique keyword extracted from message mi.
for each keyword win all these wi j ti pairs the probability that the triggering condition of keyword wis of type tis computed using the following equation pw t number of wi j ti where wi j w t i t number of wi j ti where wi j w detect inaccurate exceptions given a target system diet extracts all its root exceptions which have no cause excep tions.
diet then analyzes each root exception as follows.
first diet extracts the root exception s class c and looks up the learned probability p c tfor each triggering condition type tsummarized in iv a which indicates how likely the triggering condition of the exception is of type t. second diet extracts the exception error message m and unique keywords w1 ... w n from the error message m.f o r each keyword wi diet looks up the learned probability pwi t for each triggering condition type t which indicates how likely the triggering condition of keyword wiis of type t. diet computes the probability that the triggering conditionof exception eis of type tby averaging p wi tfor all unique keywords in the error message m. pm t summationtext wi mpwi t n finally diet uses the following equation to compute the probability that the root exception s class and error messageimply the same triggering condition type p same type summationdisplay t five typesmin pc t pm t intuitively psame type is the minimal common probability for all five triggering condition types.
as shown in figure psame type can be represented as the overlapping area when plotting the pc tand the pm tfor all five condition types in the same histogram.
the smaller psame type is the more likely the root exception s class and error message imply differenttypes of triggering conditions and the more likely the rootexception is inaccurate.
experiments on cloud systems we evaluate diet using the latest versions of the studied systems table xi .
for these cloud systems diet extracts exceptions in total row throw and of them are considered as root exceptions row root ex.
.
for each root exception diettable xi applying diet onreal world cloud systems system cassandra hadoop hbase zookeepertotal version .
.
.
.
.
.
.
throw root ex.
calculated reported candidate hadoop includes hadoop common hdfs mapreduce and yarn.
table xii bugs and badpractices detected by diet systembug bad practice confirmed confirmed pending rejected cassandra hadoop 1fi x e d fixed hbase zookeeper total fixed fixed cassandra developers will fix six out of eight confirmed bad practices in the next major update.
calculates its psame type using equation row calculated .
if its psame type .
a configurable threshold diet will report it as an inaccurate exception.
finally diet reports 314inaccurate exceptions row reported .
we manually inspected all the reports and identified candidates for real inaccurateexceptions row candidate .
note that diet fails to calculate p same type for half of the root exceptions row calculated and diet s false positive rate is high out of reported exceptions .
this is mainly because we use only a small dataset the studied ebugs to train diet and many exceptionclasses and keywords of error messages in our experimentalsubjects are not contained in these ebugs.
this can be improved by training diet with a larger dataset of ebugs.
among the candidates we found two ebugs in which the inaccurate exceptions can cause failure symptoms.
the remaining candidates are bad practices in which theirexception classes and error messages are indeed misleading.although a bad practice has not caused failure symptoms it may introduce ebugs in the future because it is difficult to correctly handle an inaccurate exception.
for example since the inaccurate exceptions in ebugs hdfs and hbase discussed in v a1 are misleading when developers implemented the corresponding exception handlerslater the exceptions were not handled properly.
we report all these bugs and bad practices to developers of these cloud systems.
so far developers have confirmed thetwo bugs and bad practices table xii .
more importantly all of these confirmed issues are previously unknown .
atthe time of writing developers have fixed issues and willfix another six issues in next major updates.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
bugs diet detected two bugs which are confirmed by the developers.
both ebugs are caused by using incorrect classes.for example in one of them hadoop a datanode throws an ioexception when it is interrupted during file renaming.
this leads to a checking of disk health which isnecessary only when the ioexception is triggered by a file system error e.g.
when the renaming actually fails.
these bugs highlight the importance of throwing exceptions with accurate classes.
when the exception class does not match its triggering condition the system may misbehavein two ways.
first the unintended handling operations maybe executed such as both bugs found by diet.
second theintended handling operations may be skipped.
although diethas not found any new bugs with this symptom they do exist in our ebugs dataset e.g.
cassandra .
bad practices diet detected bad practices where have been confirmed by developers.
although these badpractices have not caused any failure symptoms developers act proactively to these reported bad practices.
for example hadoop developers have fixed nine out of thirteen confirmedbad practices and cassandra developers will fix six out of eight confirmed bad practices in their next major update .
developers rejected five bad practices because they believed that these reported candidates work as intended.
for example in hbase a runtimeexception is used to represent a file system error.
developers thought it is a norm in hbaseto use runtimeexception for a fatal file system error .
as a preliminary attempt to detect ebugs in cloud systems diet has found many unknown issues in popular and maturecloud systems.
we believe that by integrating other findings in our study diet can be further extended to detect more ebugs and bad practices.
for instance by integrating finding and exception flow analysis diet can help detect exception handlers that apply the same handling to exceptionstriggered by different condition types which is an indicator for overly general reaction ebugs finding .
viii.
r elated work in this section we discuss related work that are not discussed in previous sections.
ebug studies in other systems prior studies have examined the root causes of ebugs in general systems and android applications from source code patterns .
these studies provide valuable insights on developers common mistakeswhen handling exceptions in their target systems.
however due to the inherent system differences their findings may notbe applicable to cloud systems.
some studies have analyzed the relation between ebugs and certain language features e.g.
aspect oriented programming and android abstractions .
other studies try to understand developers perception onebugs and the common exception handling practices .
complementary to these studies our ebug study focuses on analyzing the relations between triggering conditions and the root causes in cloud systems which are critical in ebug exposure and detection.ebug detection a few tools have been designed to detect ebugs.
aspirator detects empty or incomplete e.g.
contain ing todo exception handlers as well as overly generalhandlers that abort the whole system .
car miner detects missing recovery operations by inferring methods that should have executed together when exceptions occur .
epe detects incorrect exception propagation by finding exceptionsthat are thrown or caught in unintended methods .
unlike these tools diet detects inaccurate exceptions by analyzingthe inconsistency between the triggering conditions inferred from exception classes and error messages.
other bug studies in cloud systems prior works have focused on other types of bugs including general bugs concurrency bugs crash recovery bugs timeout related bugs and system failures .
they have identified invaluable observations on different types of bugs helping im prove cloud system reliability in many ways.
complementary to these studies our work examines a different and important threat in cloud systems i.e.
ebugs.
we hope the combinedefforts can greatly help developers improve the reliability ofcloud systems.
previous works have also studied other types of bugs in general systems .
these studies have inspired lots of research that combat bugs in various ways .
we believe our study can help better understand ebugs in cloud systems and reveal opportunities to alleviate them.
ix.
c onclusion in this paper we present a comprehensive analysis of ebugs in six popular cloud systems from the perspectiveof triggering conditions.
most of these ebugs affect theavailability or integrity of the cloud systems.
through this study we have made many interesting findings which revealimportant opportunities for combating ebugs in cloud systems.
based on our findings we develop diet to detect inaccurateexceptions in cloud systems.
diet has detected ebugs andbad practices and developers have confirmed of them.
a cknowledgment we would like to thank the anonymous reviewers for their thorough and insightful comments.
we are grateful to dejunteng for helping us calculate the proportion of exception related code in popular cloud systems.
in this work haichengchen and feng qin were partially supported by national science foundation grants cns and ccf career award .
wensheng dou and yanyan jiang werepartially supported by national key r d program of china 2017yfb1001800 national natural science foundation ofchina youth innova tion promotion association at chinese academy of sciences alibaba innovative research program and the collaborativeinnovation center of novel software technology and industri alization jiangsu china.
both haicheng chen and wenshengdou are the corresponding authors of this paper.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.