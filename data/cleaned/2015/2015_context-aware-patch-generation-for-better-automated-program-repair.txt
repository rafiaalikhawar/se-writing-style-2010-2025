context aware patch generation for better automated program repair mingwen1 junjiechen2 rongxinwu1 danhao2 shing chicheung1 1departmentofcomputerscienceandengineering thehongkonguniversityofscienceandtechnology hongkong china mwenaa wurongxin scc cse.ust.hk 2keylaboratoryofhighconfidencesoftwaretechnologies pekinguniversity moe 3instituteofsoftware eecs pekinguniversity beijing china chenjunjie haodan pku.edu.cn abstract the effectiveness of search based automated program repair is limitedinthenumberofcorrectpatchesthatcanbesuccessfully generated.therearetwocausesofsuchlimitation.first thesearch spacedoesnotcontainthecorrectpatch.second thesearchspace ishugeandthereforethecorrectpatchcannotbegenerated i.e.
correctpatchesareeithergeneratedafterincorrectplausibleones ornotgeneratedwithinthetimebudget .
toincreasethelikelihoodofincludingthecorrectpatchesinthe searchspace weproposetoworkatafinegranularityintermsof astnodes.this however willfurtherenlargethesearchspace increasingthechallengetofindthecorrectpatches.weaddressthe challengebydevisingastrategytoprioritizethecandidatepatches basedontheirlikelihoodofbeingcorrect.specifically westudythe useofastnodes contextinformationtoestimatethelikelihood.
inthispaper weproposecapgen acontext awarepatchgenerationtechnique.thenoveltywhichallowscapgentoproduce morecorrectpatchesliesinthreeaspects thefine granularity designenablesittofindmorecorrectfixingingredients the context awareprioritizationofmutationoperatorsenablesitto constrainthesearchspace threecontext awaremodelsenable ittorankcorrectpatchesathighpositionsbeforeincorrectplausible ones.weevaluatecapgenondefects4jandcompareitwiththe state of the artprogramrepairtechniques.ourevaluationshows thatcapgenoutperformsandcomplementsexistingtechniques.
capgenachievesahighprecisionof84 .
andcanprioritizethe correctpatchesbefore98 .
oftheincorrectplausibleones.
ccs concepts software and its engineering error handling and recovery software testing and debugging keywords context aware automatedprogramrepair patchprioritization permissiontomakedigitalorhardcopiesofallorpartofthisworkforpersonalor classroomuseisgrantedwithoutfeeprovidedthatcopiesarenotmadeordistributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthefirstpage.copyrightsforcomponentsofthisworkownedbyothersthanacmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.requestpermissionsfrompermissions acm.org.
icse may june gothenburg sweden 2018associationforcomputingmachinery.
acmisbn978 ... .
reference format mingwen junjiechen rongxinwu danhao shing chicheung.
.
context awarepatchgenerationforbetterautomatedprogramrepair.in icse icse 40th international conference on software engineering may june gothenburg sweden.
acm new york ny usa 11pages.
introduction arecentstudyshowsthattheglobalcostofgeneraldebuggingis 312billiondollarsannuallyandsoftwaredevelopersspend50 of theirtimeonfixingbugs .theexcessivelyhighcostinfixingbugs motivatestheresearchesonrepairingprogramsautomatically.over theyears variousautomatedprogramrepair apr techniques havebeenproposed .
manyofthem areknownassearch based apr whichmayalsobereferredtoasgenerate and validate apr orheuristic basedapr .theygeneratepatch candidatesbyfirstapplyingapredefinedsetofmutationoperators onthefaultspacedeterminedbyfaultlocalization fl techniques .theythendeploysomeheuristics tosearch amongthesecandidatesforacorrectpatchthatpassesallgiventest cases .search basedaprtechniques haveshowntobeabletofixawiderangeofbugsandbescalable tolargeprogramswithoutrequiringextraspecifications .
despitetheireffectiveness therearetwomajorlimitationsinexistingsearch basedaprtechniques .first thecorrect patchesarenotalwaysinthesearchspace makingitimpossible forthemtorepairbugssuccessfully.thesecondlimitationarises fromthe search space explosion problem .toenhancethe chancesofincludingthecorrectpatchesinthesearchspace increasinglylargesearchspaces e.g.
byusingmoremutationoperators arebeingdesigned.
however thespaceenlargement greatlyincreasesthesearcheffortsandcanresultinsharpreduction inrepaireffectiveness.forexample thelargesearchspaceresults ingeneratingfewercorrectpatchesduetoproducingplausible i.e.
patchesthatpassalltestcases butincorrectpatchesbeforethe correctonesorbudgettimeout .
findinggoodfixingingredientsisvitaltoresolvethefirstlimitation .fixingingredientsarethoseexistingcodeelementsreusedtogeneratefixingpatches .existingapproaches workonstatementlevel whicharetoo coarse grainedtofindthecorrectfixingingredientssinceprevious studieshaveshownthatgoodfixingingredientsexistmoreoftenat afinergranularitythanthatofstatements .thismotivates ustoleveragefine granularityfixingingredients e.g.
expressions acm ieee 40th international conference on software engineering authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden m. wen j. chen r. wu d. hao and s. cheung togeneratepatches.however searchspaceandhenceaggravatethesecondlimitation.thisissue wasalsoobservedbybarr et al.
whofoundthatthegenetic programmingsearchalgorithmisalwaysboggeddownwithina fewgenerationsduetothesearchspaceexplosionwhentrying outgenprog withfixingingredientsattheexpressionlevel.
therefore betterstrategiesarerequiredtoprioritizethesearch spacederivedfromfinefixingingredients.
inpursuitofanefficientsearchstrategy weanalyzethepatch generationprocessofsearch basedaprandidentifythemajor factorscontributingtothesearch spaceexplosionproblem .
anaprprocesstypicallyinvolvesgeneratingthreespaces.first itselectsabuggylocationgeneratedbyfltechniques i.e.
faultspace .second itselectsamutationoperatorfromapredefined setofoperations i.e.
operationspace thatcanbeappliedtothe selectedbuggylocation.third itselectsafixingingredient i.e.
ingredientspace ifitisrequiredbythemutationoperator.theingredientspacecanbeasetofcodefragmentsextractedfromthesameapplication oracrossmultipleapplications .therefore thefault space operation space andingredient space jointlyattributetothesearchspaceexplosionproblem .amongthethree spaces thefaultspaceisasetofsuspiciouscodeelements whicharepotentiallybuggy derivedfromagivensetoftestresults.itdepends largelyontheadequacyofthesetests .followingexisting practices wedirectlyleveragethesuspiciousvaluesreturnedbyfl techniquestoprioritizethefaultspace .
inthispaper weapproachthesearchspaceexplosionproblem bystudyingtheothertwospaces i.e.
operationspaceandingredientspace whichcollectivelyreferredtoasthe fix space .
specifically westudyhowtoefficientlysearchforacorrectpatch ifany inthefixspaceofaselectedsuspiciouscodeelement.existingstrategiesofsearch basedaprrandomlychooseoperators andingredientsfromthefixspace .however thisrandomstrategyisinefficientandsubjecttohighpossibilities ofproducingplausiblepatches .therefore wepropose toprioritizethesearchforcorrectpatchesoverplausiblebutincorrectonesbasedonmutationoperators andfixingingredients likelihoodtocorrectlyrepairtheselectedsuspiciouscodeelement.
wefindthatthecontextinformationofthesuspiciouscodeand theingredientscanproviderichinformationabouttheirlikelihood tocorrectlyrepairthebug.ourfindingissupportedbyourempiricalstudyshowingthatthecorrectfixingingredientsandthebuggy codeelementssharehighsimilarityintermsoftheircontexts.leveragingthefindings wedevelopanapproachcalledcapgen which standsfor context aware patchgeneration.capgenworksona fine granularityattheastnodelevel.itiscontext awareintwo aspects.first themutationoperatorsareprioritizedconcerningthe contextinformation.specifically capgenconsiderstheastnode typesoftherequiredingredientandthesuspiciouscodeelement whenselectingmutationoperators.however whetherbugscanbe fixedmoreoftenundercertaincontextsthantheothersremains unknown.toaddressthischallenge capgenleveragessubstantial realbugfixesinopensourceprojectstoguidethediscoveryofsuchcontexts.second thefixingingredientsareextractedtogetherwith theircontextinformation.specifically weproposedthreemodels tocapturethecontextinformationintermsoftheingredients syntacticsandsemantics.capgenleveragesthesemodelstoguidetheapplicationoftheingredientstothecorrectlocations.thisis basedonourintuitionthatafixingingredientshouldbeapplied tothelocationswithsimilarcontextscomparedwiththelocation whereitisextracted.tothebestofourknowledge incorporating thecontextinformationwhenselectingmutationoperatorsand prioritizingfixingingredientsisnewtoprogramrepair.
weevaluatecapgenonthedefects4j benchmark.the evaluationresultsshowthatcapgenmakestwomajoraccomplishments.first capgengeneratesplausiblepatchesfor25bugsand 21ofthemarecorrect thusachievingahighprecisionof84 .
.it outperformsthecurrentstate of the artapproachesintermsofthe numberofbugsrepairedcorrectlyandtheprecision.morespecifically usingthecontextmodels theranksofcorrectpatcheshas beenimprovedfor85 .
andthenumberoftiesoftherankings hasbeenreducedby97 .
onaverage.thissignificantlyalleviatesthesearch spaceexplosionproblem.second itgeneratesno incorrectplausiblepatchesfor60 .
ofthebugs.forthose withincorrectplausiblepatchesgenerated thecorrectpatchescan berankedinpriorto98 .
oftheincorrectones.itisbecause thatourcontext awaremodelscanpreciselyidentifythecorrectfixingingredientsandthusreducethepossibilityofgeneratingincorrectplausiblepatches.thisalsosignificantlyalleviatesthe overfittingproblem .amongthese21bugscorrectlyrepaired 15ofthemhaveneverbeenrepairedbyexistingaprapproaches showingthatcapgenwellcomplementsexistingapproaches.we alsoevaluatedcapgenontheintroclassjava benchmark theresultsofwhichshowthegeneralityofcapgen.
insummary ourpapermakesthefollowingnovelcontributions weproposecapgen whichisacontext awarepatchgenerationtechnique.tothebestofourknowledge capgenisthefirst approachtoincorporatingthecontextinformationtoprioritize mutationoperatorsandapplyfixingingredients.
wedesignthreenovelmodelstocapturethecontextinformationoffixingingredients.wealsopresentempiricalevidences supportingthatthecorrectfixingingredientsshouldsharehigh similaritieswiththebuggyelementintermsoftheircontexts.
weevaluatecapgenonthebenchmarkdefects4j.theresultsshowthatcapgencangeneratecorrectpatcheswithahigh precisionof84 .
.moreover itoutperformsandcomplements existingstate of the artapproaches.
background and motivation toaddressthetwoaforementionedlimitationsofsearch basedapr westudytherealbugfixesandmakesomeinterestingobservations onpatchgranularities theoperationspaceandtheingredientspace.
patch granularities wefoundthatoneimportantreason whichhindersexistingapproaches togeneratethecorrectpatchesinthesearchspaceisthatthedesignedmutationoperatorsworkatthestatementlevel whicharetoocoarse grained.
martinez etal.reportedthatcoderedundancyissignificantlyhigher atafinergranularitythanstatementlevel .thissuggeststhatit ismorelikelytofindgoodfixingingredientsatafinergranularity.
figure1showsanexample whichisabugcausedbyawrong expressioninthereturnstatementatline417.tofixit developers changedtheoriginalexpressionto equals x y .thefixing ingredient equals x y existsattwootherplaces line422and line442 inthesameprogram.ifweapplymutationoperatorsatthe authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
context aware patch generation for better automated program repair icse may june gothenburg sweden statementlevel e.g.
replacingthereturnstatementwithanother asexistingapproaches wecannotfixthebugby replacingline417withline422norline442.anotherexampleis showninfigure2 wherethefixingingredient next pos also existsatagranularityfinerthanstatements.thesemotivateusto extractfixingingredientsandapplymutationoperatorsatafiner granularity suchastheexpressionlevel.
.
.
.
.
.h h h figure buggy statement fixed statement and the fixingingredients of bug math in defects4j.
applyingmutationoperatorswithingredientsatafinergranularityincreasesthelikelihoodtoincludethecorrectpatchesinthesearchspace .however aseriousside effectisthatit willincreasethefixspace i.e.
operationandingredientspace significantly exacerbatingthesearchspaceexplosionproblem .a recommendedwaytoaddressthisistoprioritizethepatchesbased ontheirlikelihoodtorepairabugcorrectlyasadoptedbyrecent approaches .wemaketwokeyobservationsonthefix spacefromexistingliteratureandthemotivatingexamples which shedlightsonhowtoprioritizethesearchofcorrectpatches.
?
.
h h .
figure buggy statement fixed statement and the fixingingredients of bug lang in defects4j.
observations on the operation space insertion deletion andreplacementaremutationoperatorscommonlyusedtogen eratepatches .asrevealedbyexistingstudies thelikelihoodofrepairingabugiscorrelatedwiththe concernedoperatorandthetype1oftheinvolvedcodeelements.
forinstance insertioncancorrectlyrepairabugmorefrequently withacodeelementofexpressionstatement2thanothertypes ofcodeelements .intheexampleinfigure2 thebugisfixed byinserting next pos asanexpressionstatementatline422.
wefurtherobservethatthelikelihoodofcorrectbugrepairing iscorrelatedwiththecontextoftheinvolvedcodeelements.our observationisinlinewitharecentfindingthatthesyntacticusage ofcodeelementsishighlycontextual .forinstance a switch statementusuallyoccursmuchmoreoftenundera whilestatementthana forstatement .supposewewanttoreplacethe buggyexpressionatline417infigure1withanothercompatible expression i.e.
expressionsevaluatedas booleanvalues .there aremanytypesofingredients e.g.
methodinvocation infixexpression thatcanbeevaluatedas boolean.however under thecontextofareturnstatement methodinvocationhasa 1typereferstotheastnodetypeinthisstudy suchasinfixexpression .
tobeselectedasaningredient forthereturningvalueandismorethansixtimeshigherthanthat oftypebooleanorinfixexpression .therefore expressions oftypemethodinvocationshouldbepreferentiallyselectedas ingredientstofixthisbuginareturnstatement.
thesemotivateustoprioritizethemutationoperatorsusing thecontextinformationderivedfromtheastnodetypeofthe involvedfixingingredientandthatoftheenclosingcodeelement where this ingredient is going to be applied.
however how to selectthosecontextsthatcancoverasmanybugsaspossiblewhilekeepingatractableoperationspaceisachallenge.inthisstudy we leveragesubstantialopensourceprojectstolearnthosecontexts underwhichrealbugsarefrequentlyfixed andusesuchknowledge toprioritizemutationoperators seesection3.
.
observations on the ingredient space weobservethatthe contextinformationofthefixingingredientscanguideustoselect thecorrectingredienttothesuspiciousbuggylocation.consider thereturnexpressionatline417oftheexampleinfigure1.evenwe havedecidedtopatchtheexpressionusingmethodinvocationsas aforementioned westillneedtoselectoneofthemanymethodinvocationsintheprogramtogenerateapatch.arandomselectionis lesslikelytogenerateacorrectpatch.thecorrectfixingingredientexistsattwootherplacesintheprogram.iflookingattheircontexts e.g.
theenclosingstatementswheretheyareextracted wecan findthatbothofthemareusedin returnstatements andthereare nootherusagesof equals x y inthisprogram.therefore this fixingingredientshouldbepreferentiallyselectedovertheothers topatchthebuggy returnstatementatline417.asimilarcaseis foundfortheexampleinfigure2.theingredient next pos is extractedfromastatementenclosedbyan ifstatement andthus itshouldbepreferentiallyselectedandinsertedunderthebuggy ifstatementatline421.
thismotivatesustoconsiderthesimilaritybetweenthecontextwhereaningredientisextractedandthecontextwherethe buggycoderesideswhengeneratingpatches.aningredientwitha highercontextsimilarityshouldberankedhigher.insection3.
.
weproposethreemodelstomeasurethecontextsimilaritiesin termsofaningredient sandabuggycode sgenealogicalstructures accessedvariablesandsemanticdependencies.tovalidateif suchmeasurementcanreliablyindicatethelikelihoodofgeneratingcorrectpatches weconductanempiricalstudytocollectthe supportingevidenceinsection3.
.
.
approach we propose a context awarepatchgeneration capgen approach whichworksontheabstractsyntaxtree ast ofaprogram.specifically alltheastnodesinthecategoryoftype expressionandstatement areextractedasfixingingredients.
thissectionfirstintroducesthecontext awareprioritizationof operationsandthefixingingredients.afterthat itintroduceshow capgenintegratesthefaultspace operationspaceandingredient spacetogethertoprioritizethegeneratedpatches.
.
context aware operators selection motivatedbyourobservations weconsiderthethreebasicast mutationoperators whichtakeafixingingredientasasourcenodeandtheplace i.e.
thebuggycodeelement wheretheingredientis tobeappliedasatargetnode.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden m. wen j. chen r. wu d. hao and s. cheung if statement infix expression 3 block 4return statement expression statement if statement infix expression 3 block 4return statement figure the ast differences of the example in figure replacement replace target node n t withsource node n s insertion insert source node n s under target node n t deletion delete source node n s under target node n t theoperationspaceinducedbytheseoperatorsislarge .
reductionofthespaceisacriticalissueinapr andwe proposetoleveragecontextinformationtoachievethis.basedon ourobservationsinsection2 weexplicitlyaugmentamutation operatorwiththecontextinformationofthesourcenode stypeand thetargetnode stype.examplesofaugmentedoperatorsare insertsimplenameundermethodinvocation and deleteexpression statementundermethoddeclaration .moreexamplesofaugmentedmutationoperatorscanbefoundintable1.toreducethe operationspace weidentifytheprobabilitytocorrectlyfixbugsforeachaugmentedoperatorandconsideronlythoseoperators thatofferarelativelyhighprobability.wederivetheprobabilities fromthedatasetofpatchessystematicallycollectedbylegoues et al.
.thedatasetcontainsover3 000realfixingpatchesfrom over700opensourceprojectsandispublicavailable .forease ofpresentation werefertothedatasetasbugfixsetinthispaper.
foreachpatchinbugfixset wecomparethedifferencesbetween thebuggyandthefixedversionattheastnodelevel.forexample figure3givestheastdifferencesforthebugfix line421to423 ofourmotivatingexampleinfigure2.anodewithtypeexpressionstatement i.e.
node5 isinsertedunderthetargetnodeof ifstatement i.e.
node1 .thenodewithtypeblockisnot consideredsinceitprovideslittlecontextinformationformutation operation.notethatnode5isasubtreecomposedofothernodes suchasmethodinvocation i.e.
next andsimplename i.e.
pos .weregardtheoperationperformedonthissubtreeasone repairaction sincethetransformationcanbecompletedin onesingleoperation insertingthewholesubtree .therefore the augmentedmutationoperatorextractedfromthispatchis insert anexpressionstatementunderanifstatement .
bugfixsetprovidesalargeandrepresentativerepositoryofreal patches andthisenablesustoobtaintheknowledgeofthose augmentedmutationoperatorsthatarefrequentlyusedinrealbug fixes.wecountthefrequencyofeachaugmentedmutationoperatorsparticipatinginthepatchesofbugfixsettoapproximateits probabilitytofixbugs.thehigherthefrequency thehigherthe probabilityoffixingrealbugs.table1showsthetop10augmented mutationoperatorswiththehighestfrequenciesforreplacement insertionanddeletion respectively.weselectonlythese30aug mentedoperatorsforcapgentoprioritizetheoperationspace.
theycover69 .
oftherepairactionsparticipatinginthepatches ofbugfixsetaltogether.weuse mandfreq m todenoteaselectedaugmentedmutationoperatoranditsfrequency respectively.forreplacement weutilizethedatatype e.g.
int boolean ofa node ratherthanitsnodetype toinfercontextinformation.itis becausethatifthedatatypeofafixingingredientdoesnotmatch thatofthetargetnode themutatedprogramwillnotbecompiledcorrectly.forexample boththedatatypesofthefixingingredi ent i.e.
equals x y andthetargetnode i.e.
thereturning expression infigure1are boolean.
.
context aware ingredients prioritization existingstudieshavereportedthatasignificantportionofthefixing ingredientscanbefoundinthesamefileofthebuggycode .
therefore weextracttheingredientsfromthefilewherethetarget node i.e.
thebuggycodeelement resides.unlikeexistingstudies wealsoextractthecontextinformationfor eachingredient.ourhypothesisisthatthecorrectfixingingredientsshouldsharehighsimilaritywiththetargetnodesintermsoftheircontexts.wedenotethesimilarityas simi ns nt .inthefollowing wefirstintroducethreeaspectsofcontextinformationembedded inanastnodeanditssurroundingcodes andthenexplainhowto measurethecontextsimilaritybetweentwonodesforeachaspect.
afterthat wevalidateourhypothesisviaanempiricalstudyonthe bugfixset.finally weintroducehowtoprioritizetheingredients forthethreetypesofaugmentedmutationoperators.
.
.
extracting context information.
we model the context information of an ast node from three differentaspects genealogy variableanddependency.
first anode sgenealogicalstructurecanprovideusefulcontext.forinstance theinfixexpression equals x y infigure 1isfrequentlyusedasthereturningvaluein returnstatements.
therefore thisinfixexpressionshouldhavehigherprobabilitytobe usedastheingredientformutatingthereturningvaluesinreturnstatementthantheconditionsofifstatement.thisinformation ofwhereaningredientisfrequentlyusedcanbeextractedfromits genealogicalstructures e.g.
the ancestor nodes ofthenode.
second variableusagesinaningredientcanprovideusefulcontextinformationsincevariablesareprimarycomponentsofan ingredient .theexampleinfigure1showsthatthefixingingredientusesthesamevariables e.g.
x y asthetargetexpression tobereplaced.moreover plausiblepatchescanbegeneratedby simplyremovingfunctionalitiesviareplacingcomplexexpressions withconstantvalues i.e.
novariableusages .patchesthusgeneratedmightpassaproject stestsuiteduetotheweaktestproblem .thesemotivateustorankthoseingredientswithmoresimilar variableusagescomparedwiththetargetnodeathigherpositions.
third thevariablesusedordefinedinagivennodeareaffected byorcanaffectothernodes.suchsemanticcontextsintermsof thenodes dependenciesarereportedtobehelpfulincapturingthe characteristicsofcorrectpatches .therefore capgenextractsthisdependencyinformationasanaspectofanode scontext toprioritizefixingingredients.
modeling genealogy contexts capgenextractsthegenealogycontextsofanastnode nvia checkingits ancestor nodes toseenisusedunderwhattypes ofcodeelements andcheckingits siblingnodes toseenisused togetherwithwhattypesofcodeelements.forancestornodes wetraversefrom ntoitsancestorsuntilwereachamethoddeclaration.
for sibling nodes we extract those nodes of category statementandexpressionwithinthesameblockof n.westore thegenealogicalinformationin whichcountsthenumberof occurrencesofdifferentnodetypesamongalltheancestorand siblingnodes.algorithm1showsthedetailsofthisprocess.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
context aware patch generation for better automated program repair icse may june gothenburg sweden table top replacement insertion and deletion operators augmented with target and source nodes types replacement insertion deletion targetnode freq sourcenode targetnode freq sourcenode targetnode freq simple name .
expression statement method declaration .
simple name method invocation .
string literal .
simple name method invocation .
expression statement method declaration .
infix expression .
expression statement if statement .
infix expression if statement .
qualified name .
method invocation method invocation .
method invocation method invocation .
conditional expression .
if statement if statement .
expression statement if statement .
simple type .
infix expression method invocation .
infix expression method invocation .
boolean literal .
qualified name method invocation .
prefix expression infix expression .
parameterized type .
expression statement try statement .
boolean literal method invocation .
primitive type .
if statement method declaration .
expression statement catch clause .
assignment .
boolean literal method invocation .
method invocation infix expression .
.
.
.
algorithm modelinggenealogycontext input n agivennode output map nodetype mapsto integer theextractedcontextinformation encoding ancestor nodes 2parent n while parent nequalnull parent nequalmethoddeclaration do 4i f parent nequalblockthen getnodetype parent end 7parent getparentnode parent end encoding sibling nodes 10parent getparentnode n while parent nequalblockdo 12parent getparentnode parent end 14children parent.filterchildrenoftype statement expression foreach node childrendo 16 getnodetype parent end whenapplyingasourcenode nswithcontext sunderatarget nodewithcontext t wecomputeitsfeasibilityviacomparingthe similarities f s t betweenthesetwocontexts f s t summationtext.
t kmin t t s t summationtext.
t k t t wherekdenotesasetofalldistinctastnodetypescapturedby t.here equation1measurestheproportionofthecontextsin tthatcanbecoveredbythecontextsofthesourcenode ns.
modeling variable contexts givenanastnode n capgenextractsasetofvariables includinglocalvariablesandfields thatareaccessed i.e.
read write inthisnode whichisdenotedas .eachoftheelementsinset is denotedas whichisatuple angbracketlefttype name angbracketrightrecordingthedatatype andthenameofthevariable.weusethejaccarddistancetomeasurethesimilaritybetweenthevariablecontextsoftwonodes t and s.besides toavoidplausiblepatchesgeneratedbyinvolving trivialingredients wegivemoreweightstothosecomplexingredients.therefore weusethenumberofvariablesinvolvedin nsto representtheweightoftheingredient.
s t s s intersectiontext.1 t s uniontext.1 t .
twoelementsarethesameonlyifboththetypeandthename arematched.however fornodeslikesimplename i.e.
variables whenwereplaceitwithanother theirnamesmustbedifferent.
therefore weonlyrequirethedatatypeisthesameforsuchcases.
modeling dependency contexts givenanastnode n capgenextractsitsdependencycontextsviainvestigatingthosenodesaffecting nandthosenodes affectedby n.specifically weconductintra procedurebackward slicingandforwardslicingbasedonthe definition and use also knownas def use ofvariablesextractedfromagivennode .
lines2to11inalgorithm2describethedetailsofextractingthe contextinformationbyleveragingbackwardslicing.foreachofthe variablesusedinthenode capgenslicesasetofstatementswhichaffectthevaluesofthevariable.wethenextracttheastnodesin thesestatementthatareinstancesof expressionorstatement andstoresuchinformationinamap tocountthenumberofoccurrencesofeachnodetypeintheslicedstatements.suchcontext informationisalsoextractedbyleveragingforwardslicing.
algorithm modelingdependencycontext input n agivennode output map nodetype mapsto integer theextractedcontextinformation context information extracted from backward slicing 2variableset getusevariable n foreach variable variableset do 4contextstatements backwardslicing variable foreach stmt contextstatements do chs stmt.filterchildrenoftype statement expression foreach node chsdo getnodetype node end end end context information extracted from forward slicing 13variableset getdeforsetvariable n forward slicing is conducted the same on variableset thefeasibilityofapplyingasourcenode nswithdependency context sunderatargetnodewithcontext tissimilartohowwe measurethefeasibilityintermsofthegenealogycontexts.specifically wemeasuretheproportionofthetargetnode contextsthat canbecoveredbythecontextsofthesourcenode.
f s t summationtext.
t kmin t t s t summationtext.
t k t t wherekdenotesasetofallastnodetypescapturedby t. .
.
empirical evidences.
wedesignedthreedifferentmodelstocapturethecontextsimilaritiesbetweenthefixingingredients nsandthetargetnode nt.
ourintuitionisthattherequiredfixingingredientsaresupposed tosharehighsimilaritieswiththetargetnodetobemutatedin termsoftheircontexts.tovalidatetheintuition wecollectedempiricalevidencesfromthebugfixsetdataset.among12 .
of thebugfixesinbugfixset fixingingredientsexistintheirassociatedbuggyprogram.thisproportionisconsistentwithexisting empiricalstudies .foreachofthesebugfixes wefirstextractthecorrectfixingingredientas nstogetherwithitscontext informationfromtheassociatedbuggyprogram.wethencompare itwiththetargetnode ntatthebuggylocationforeachofthe threeaforementionedcontextmodelsanddenotethesimilarityas ss.forcomparison wealso randomlyselectanotheringredient nr whosetypeisthesameas nsandcanalsobeappliedtothetarget location.forexample if nsisanodeof infixexpressionwith type boolean wealsorandomlyselectanotherinfixexpression withtype booleanwhosevariablescanberesolvedatthetarget location.thisprocessissimilartotheprocessofselectingingredientsrandomlybyexistingapproaches .wedenote thecontextsimilaritybetween nrandntassr.foreachbug we authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden m. wen j. chen r. wu d. hao and s. cheung p value .67e .
.
.
.
.
.
.
correct random6lplodulw a genealogyp value .44e .
.
.
.
.
.
.
correct random6lplodulw b variablep value .31e .
.
.
.
.
.
.
correct random6lplodulw c dependency figure comparisons of the contexts similarities between the correct fixing ingredients and the fixing ingredients withthesametypeasthecorrectonebutrandomlyselected repeattherandomprocess50times and sristheaveragedcontext similarityvalueoverthe50runs.wethencompare ssandsrto seeifssisgreaterthan srsignificantly.
figure4showstheresultsintermsofthegenealogy variable anddependencycontextmodels.here forthevariablecontext model weonlykeepthejaccardterm whichmeasuressimilarity.
thesimilaritiesofallmodelsarenormalizedtoarangefrom0to .theresultsshowthatforallthethreemodels thesimilarity between ntandnsissignificantlyhigherthanthatbetween nt andnr p .
usingtheone sidedmann whitneyu test .
theseresultsempiricallysupportourintuitionthatcorrectfixing ingredientsshouldsharehighsimilaritieswiththetargetnodein termsoftheircontextinformation.
actually existingstudieshavealsoinvestigatedwheretofind fixingingredients .however theirinvestigationsfocus onfindingingredientsatthefilelevel i.e.
inthesamefileorin differentfiles oratthecommitlevel i.e.
inthecurrentversion orinthepreviousversions .forexample barr etal.
found thatasignificantportionoffixingingredientsexistinthesamefile.
ourempiricalstudytakesafurtherstepandsearchesthefixingingredientsatafinergranularitywithinthesamefile i.e.
those codeelementswithhighercontextsimilarities .inparticular our findingsarealsousefulforfuturesearch basedaswellassemantics basedapr bothofwhichneedtosearchfixingingredientsintheir patchgenerationprocess.
.
.
ingredients prioritization.
weintegratethethreemodelstoprioritizetheextractedingredients.thoseingredientswithhighercontextsimilarities i.e.
withalargervalueof simi ns nt arerankedhigher.however wehave differenttreatmentstothethreedifferentmutationoperators.for replacement wecombineallthethreecontextmodels andthusthe simi ns nt isspecificallydefinedas simir ns nt f s t f s t s t however for insertion the ntistheparentnodeof nsafterinsertingnsundernt andthusitmakesnosensetoincludethevariable modelinthiscasesince ntandnsservedifferentfunctionalities.
thesamecasefor deletion.therefore for insertion simii ns nt f s t f s t fordeletion thecaseismorecomplicatedsincewearegoing todelete nsfromnt.inthiscase wefirstlocatethenodesin theotherplaces nowhichareidenticalto ns.wecomputethe contextsimilaritybetween noandnt.ifthereisahighcontext similaritybetween noandnt whichmeansthesourcenode nsis usedinsimilarcontextsattheotherplaces.inthiscase wegivelowerprobabilitytodelete nsundernt.therefore for deletion simi ns nt isdefinedasfollowingsspecially simid ns nt f o t f o t whereno ns.ifthereisnoothernodeswhichareidenticalto nt thensimi ns nt wouldsimplybe1.
.
patch prioritization insummary togeneratecandidatepatches capgenfirstselectsabuggynode nt prioritizedbyitssuspiciousvalue fl nt generatedbyfltechniques.notethatexistingfltechniquesassign suspiciousvaluesatthelinelevel capgenappliesthesefltechniquesbyassigningaline ssuspiciousvaluetoeachofitsastnodesinthesameline.thesuspiciousvalueofthoseastnodes e.g.
ifstatement thatspanacrossmultiplelinesareaveraged overtheselines.then fortheselected nt capgenselectsasetof mutationoperatorsthatcanbeappliedto nt andeachmutation operators mhasthecorrespondingoperationprobability freq m by considering the contexts of nt.
afterwards capgen prioritizesallcompatiblesourcenodes ns whichareusedasingredients requiredby m basedontheircontextsimilarity simi ns nt comparedwiththetargetnode nt.finally patchesaregenerated and eachofthemisdenotedas p angbracketleftnt m ns angbracketright.capgenprioritizes thosepatchesbyintegratingthefaultspace theoperationspace andtheingredientspacetogether.thefinalscoreof pisdenotedas score angbracketleftnt m ns angbracketright whichiscalculatedasshowninequation7.
score angbracketleftnt m ns angbracketright fl nt freq m simi ns nt currently weusemultiplicationtocombineallthemodelstofilter outthosepatchesgeneratedwithingredientssharingnocontext similarities.designingdifferentwaystocombinethosecomponents togetherisleftforfutureworkasdiscussedinsection5.
.
evaluation .
research questions weimplementedcapgeninjavabasedonacodetransformation libraryspoon andthefaultlocalizationtoolgzoltar .specifically capgenleveragesgzoltarwiththealgorithmochiai to retrievethefaultspaceandthesuspiciousvalues.weusetheprogramanalysistoolunderstand forcodeslicing.ourexperiments arerunonacentosserverwith2xintelxeone5 2450corecpu .1ghzand192gbphysicalmemory.wesetthetimebudgetfor eachbugas90minutesfollowingexistingpractices .our evaluationaimstoanswerthefollowingresearchquestions rq1 howeffectivelydoescapgenfixrealworldbugs?
rq2 cancapgenoutperformexistingapproaches?
rq3 howisthecontributionofeachmodelusedbycapgen?
theimplementationofcapgenandthedetailsofourevaluation resultsarepubliclyavailableat .
the subject programs toanswerthethreerqs weruncapgenonthebenchmarkdatasets forprogramrepair defects4j .thebenchmarkwasbuiltto facilitatecontrolledexperimentsinsoftwaredebuggingandtesting researches whichhasbeenwidelyadoptedbyrecentstudies onapr .followingexistingpractices weusedefects4jof version1.
.1andexcludetheclosurecompiler authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
context aware patch generation for better automated program repair icse may june gothenburg sweden table subjects for evaluation subject bugs kloc testkloc testcases commonslang jfreechart commonsmath joda time total projectbecauseitusesacustomizedtestingformatinsteadofjunit test .asaresult fourprojectswithatotalof224realbugs areusedassubjectsforexperiment.theirdemographyisgiven intable2.evaluationsonanotherbenchmarkintroclassjava arealsoconducted seediscussioninsection5.
.
.
rq1 performanceof capgenonrealbugs toanswerrq1 weapplycapgentothedefects4jbenchmark.
foreachbug wevalidatethegeneratedpatchesprioritizedbytheir score angbracketleftnt m ns angbracketright onebyone.wefirstrunthefailingtestcases toseeiftheypassonthegeneratedpatch.ifso wethenrunthe regressiontestcasestoseewhetherthispatchintroducesnewbugs.
weskiptovalidatethenextpatchotherwise.capgenkeepsgeneratingandvalidatingthecandidatepatcheswithinthetimebudget.
afterallthepatcheshavebeenvalidatedorthebudgettimeout wecollectthe plausiblepatcheswhichpassboththefailingtest casesandtheregressiontestcases.wethenmanuallyanalyzethese patchestoseeiftheyaresemanticallyequivalenttothepatches submittedbydevelopers.wemarkthemas correctpatchesifthey are andincorrect plausible patchesotherwise.
capgengeneratesplausiblepatchesfor25bugsintotalamong allthe224bugs.weidentifythecorrectpatchesfor22ofthese25bugssuccessfully.table3showsthedetailsofthese22bugs.columntotshows the number of the patches generated while crtshowsthenumberofthecorrectonesamongthem.thetotal numberofpatchesgeneratedisaffectedbythesizeofthefaultspaceandthesizeofbuggysourcefile sincemorefixingingredientswill beextractedifthebuggysourcefileislargerandcontainsmore statements .therearecasesthatcapgengeneratesmorethanone correctpatch.forexample capgengenerates2correctpatchesformath53 whichrequiresinsertingastatementtofixthebug.
wefindthatboththetwopatchesareequivalenttothedevelopers patchsincetherequiredstatementcanbeinsertedattwoadjacent places.columns rankandtieintable3showtherankofthefirst correctpatchandthenumberofpatches includingwrongpatches i.e.
thosedidnotpassthetestsuite andplausiblepatches thatare rankedintiewiththefirstcorrectpatchrespectively.thevalueof rankistherankofthefirstpositionifthereareties.column time showsthatthetimerequiredforcapgentogeneratethecorrect patchesrangesfrom0.18to50.32minutes.columns p b p tand p ashowthenumberofincorrectplausiblepatchesgroupedby theirrelativeranks i.e.
before intiewithandafter comparedwith thecorrectpatches.wecanseethatcapgengeneratesincorrect plausiblepatchesfor40 .
ofthebugs.however even thoughcapgenmightgenerateincorrectplausiblepatches itranks themmostlyafterthecorrectones.table3showsthat21outof the22bugs capgenranksnoincorrectplausiblepatchesbefore orintiewiththefirstcorrectpatches.theonlyexceptionismath forwhichcapgengeneratestwoincorrectplausiblepatches thatarerankedbeforethefirstcorrectpatch.table performance of capgen on defects4j projectbugidcrttotranktiep bp tp atime chart .
chart .
chart .
chart .
lang .
lang .
lang .
lang .
lang .
math .
math .
math .
math .
math .
math .
math .
math .
math .
math .
math .
math .
math .
crtdenotesthenumberofcorrectpatches.
totdenotesthetotalnumberof patchesgenerated.
rankistherankofthefirstcorrectpatch.
p b p tandp a denotesthenumberoftheplausiblepatchesthatareranked before in tie with andafterthefirstcorrectpatchrespectively.
timestandsforthetimerequiredto findthefirstcorrectpatchin minutes.
forthe21correctlyrepairedbugs .
ofthemrequireafixing granularityfinerthanthestatementlevel.examplesaregiveninfigures1and5.someofthecasesrequiringfixingingredients withfinergranularitiescanbehandledbyspecificallydesigned mutationoperators.forexample forbugchart1 byreplacingthe infixexpression dataset!
null withanother dataset null capgencanrepairit.hdrepairalsorepaireditbyincludinga mutationoperatorthatnegatesbooleanexpressions .currently capgenincludes30augmentedmutationoperators andsevenof themcanrepairatleastonebugcorrectly.
theseresultsshowtheeffectivenessofcapgen.specifically it repairs21bugssuccessfully i.e.
thefirstpatchpassingalltests iscorrect andachievesahighprecisionof84 .
which outperformstheexistingstate of the artapproachacs witha precisionof78 .
.precisionisvitalforaprtechniquesbecause muchdebuggingeffortwouldbewastediftheprovidedpatches areplausiblebutincorrect .thishighprecisionisachievedvia patchprioritizationguidedbyourcontext awaremodels.specifically .
oftheincorrectplausiblepatchesareranked afterthecorrectones seesection4.5fordetailedanalysis .
.
rq2 comparison with existing approaches wecomparecapgenwithfiveaprapproaches acs hdrepair jgenprog nopol andpar whichhavebeen evaluated on the defects4j benchmark within our knowledge.
amongthem acs andhdrepair arethestate of theartapproaches.similartocapgen hdrepair andpar setthetimebudgetas90minutes.nopol andjgenprog setthesearchingtimeas3hours.acs setsthebudgetas30 minutessinceitonlytargetsatconditionsynthesisandthusthecorrespondingsearchspaceismuchsmaller.table4showsthecomparisonresults.thebaselines resultsaredirectlyextracted fromexistingliterature .comparedwiththesetechniques capgenoutperformsallofthemintermsofthenumber authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden m. wen j. chen r. wu d. hao and s. cheung table comparisons with existing tools on defects4j projectcapgenhdrepairjgenprogparacsnopol chart lang53 math124 time01 total2110 precision84.
.
.
.
.
x y xisthenumberofbugsrepairedbytheapproach yisthenumberofbugs thatrepairedbycapgenandalsobytheapproach.
meanstheresultsarenotavailableduetothepardidnotpresenttheidoftherepairedbugs.
ofcorrectlyrepairedbugsandprecision.byanalyzingtheoverlap ofrepairedbugsbetweencapgenandthecomparedtechniques capgenactuallycomplementsthe state of arttechniques.15ofthe 21bugsrepairedbycapgenhaveneverbeenrepairedbyexisting approaches .
sixofthe21bugsrepairedbycapgencanberepairedbythe state of the artsearch basedapproachhdrepair .thishappenswhentherequiredfixingingredientisatthestatementlevel e.g.
math53 orcanbehandledbyspecificdesignedmutation operations e.g.
chart1 .thedominantreasonwhycapgencan repair15newbugsisthatcapgenworksatafinergranularity e.g.
figure2 .forthe4bugsthatcanbefixedbyhdrepair but notcapgen themajorreasonisthatthefixingingredientsdonot existinoursearchingscope.forexample formath34 thecorrect fixistoreplacethemethodinvokingexpression chromosimes in chromosomes.iterator with getchromosomes .however the fixing ingredient getchromosomes does not exist in the buggyprogram andthuscapgenfailedtorepairthebug.tohandlethiscase hdrepair designedamutationoperatorthat replacesthenameofamethodcall oramethodinvokingexpression byanothermethodname orexpression withcompatible types.
by including more mutation operators or increasing the scopetoextractfixingingredients capgencanhandlemorecases seesection5.1formorediscussions .
.
h h figure buggy statement fixed statement and the fixingingredients of bug math in defects4j.
comparingwithacs capgencanrepair19differentbugs.
thisisbecauseacsonlytargetsatsynthesizingpredicateconditions andthusotherbugsingeneralareoutoftherepairing capabilitiesofacs.forinstance ourmotivatingexampleshown infigure1whichreplacesthereturnvalueofanotherexpression.
anothermotivatingexampleinfigure2cannotberepairedbyacs neither whichisanomissionbugandrequiresinsertingamethod invocation to repair it.
actually these kind of bugs can hardly beenrepairedsuccessfullybyacs aswellassemantics basedapr sincetheymainlyfocusonsynthesizingconditions orright handsideofassignments.thisembodiestheindispensabilityofsearch basedaprinprogramrepairwhichtargetsatfixing bugsingeneral.wealsonoticethatcapgensuccessfullyrepaired twobugsthatcanberepairedbyacswhicharecausedbywrong conditions.forexample byreplacingtheconditionin if fa fb .
with f a f b .
capgencanrepairmath85.
fl fl mo gc dc vc gc dc gc vc dc vc context rank tie67.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
h h h h gc dc vc figure the average rank of first correct patch.
thesamecaseforchart1.however capgenrequirestheexistence ofthefixingingredientsintheprogram.thosecaseswhosefixing ingredientsdonotexistintheprogrammightbehandledbyacs.
.
rq3 contributions of each model weusetheaverageresultsofthe22bugsshownintable3to answerthisquestion.specifically weconductednineexperiments toexaminethecontributionofeachcomponentofcapgen.figure shows the results.
each bar has two heights.
the white part indicatesthefirstcorrectpatch saveragerank andtheirheight difference graycolored givesthenumberofotherpatchesthatare rankedintiewiththecorrectone.inthefirstsetup weuseonly thesuspiciousvalueofthefaultspace i.e.
fl nt torankallthe patchesgenerated.allmutationoperators whicharedenotedas mo bearthesameweights andnocontextmodelsareconsidered.
inthesecondsetup westudytheprioritizationperformancewith themutationoperators weightscombined i.e.
fl nt freq m .
intheremainingsevensetups weevaluatethecontributionofeachofourcontextmodelsandtheircombinationsonebyone.
specifically weintegrateasinglecontextmodeltothefinalranking i.e.
gcforgenealogycontext dcfordependencycontextand vcforvariablecontext andthearbitrarycombinationsofthem.in figure6 barsfromposition3to9showtheresultsbycombiningthecontextmodelswithflandmo e.g.
vcmeanscapgenleverages fl moandthevcmodeltoproducethefinalranking .
asshowninfigure6 eachindividualmodelcontributestoimprovetherankofcorrectpatches.ifweuseonlytheflmodel the patchesaresimplyrankedbythesuspiciousvaluesofthebuggylo cationsreturnbygzoltar.duetoinadequacyoftestcases the rankingofthecorrectbuggylocationislowandcontainsmanyties.
besides manypossiblepatchescanbegeneratedforeachlocation.
thesetworeasonsaccountforthepoorranks e.g.
thelowrank andmanyties ofthecorrectpatches.bycombiningtheweights ofthemutationoperators capgencansignificantlybreaktheties andreducethenumberoftiesby67 .
.theperformanceofthe firstrankhasalsobe enimprovedby4 .
.byfurtherintroducing allthecontextmodelsoffixingingredients therankisfurtherimprovedby84 .
andthenumberoftiesarefurtherreduced by97.
withrespecttotherankingofusing fl nt freq m .
letusillustratethisusingthebugshowninfigure5.thebuggy expressionisinanassignmentunderanifstatement line1133 .
thecorrectfixingingredientalsoexistsinanassignmentanda conditionexpressioninanifstatement.bycapturingsuchcontextinformation wecanprioritizethecorrectfixingingredientsat highpositions.specifically thecorrectpatchisrankedat6758with 3767tiesifonlytheflmodelisused.byincludingthemomodel itcanberankedat5807with1002ties.byincludingallthethree authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
context aware patch generation for better automated program repair icse may june gothenburg sweden fl fl mo gc dc vc gc dc gc vc dc vc context before tieafter gc dc vc figure total number of plausible patches contextmodels itcanberankedat221with35ties whichcanbe searchedwithin30minutes.fortherankingsofeachindividual modelandthecombinationsofthem theimprovementiscomputed againsttherankingofusing fl nt freq m .theresultsshow thatthethreemodelscollectivelyachievethebestperformance followedbythecombinationofthetwomodelsofdcandvc.
anothercrucialfunctionofourcontext waremodelsisthatthey canprioritizethecorrectpatchesbeforetheincorrectplausible ones.themajorityofthepatchesgeneratedwhichpassalltestcasesareplausiblebutincorrectduetotheweaktestsprovided .previoustechniques userandom techniquestosearchamongthesegeneratedpatches andtherefore theyaremorelikelytoproducetheincorrectplausiblepatches .thisproblemcanbesignificantlyalleviatedbyprioritizingthe patchesusingourcontextmodels.figure7showsthedistributions ofthetotalnumberofincorrectplausiblepatchesranked before in tie withandafterthecorrectpatchesunderthenineanalyses.
theuseofflmodelaloneinthefirstanalysisleadsto80 .
of theincorrectplausiblepatchesgeneratedbeingrankedintiewith orbeforethefirstcorrectone.thenumberhasbeenreducedby .
byintroducingthemomodel and98 .
inafurtherstep bycombiningourcontextmodels.finally only2plausiblepatches arerankedbeforeorintiewiththecorrectones.wealsopresent theresultsindetailforeachofourcontextmodel.forexample byintegratingthegc dcandvcmodelalonecanreducethe numberby82 .
.
and34 .
respectivelycomparingwith theresultsgeneratedbyleveragingflandmo.
letusfurtherillustratetheeffectivenessofourcontextmodels bycaseanalysis.forourmotivatingexampleshowninfigure1 capgencanrankthecorrectpatchatposition4beforeallother8 plausiblebugs.replacingthevariable xinthefunction isnan x withfield mathutils.two pi isoneexampleofincorrectplausiblepatches.however duetothelowcontextsimilaritysharedby xand mathutils.two pi thefinalprobabilityofthispatch isonly4 .
e4 andthusrankedafterthecorrectpatch.replacing double.isnan x double.
isnan y withexpression x canalsopassthetestsuite.however ourvariablecontextmodel favorsthoseingredientswhichinvolvemoresimilarvariableswiththetargetnode.therefore thispatchisalsorankedafterthecorrect one.similarcasesfortheotherbugs.
capgenfailstorankthecorrectpatchbeforeallincorrectplausibleonesformath80showninfigure5.duetoweaktestcases provided 81incorrectplausiblepatcheshavebeengeneratedand78 ofthemarerankedafterthecorrectoneusingourcontextmodels.
however therearestill2exceptions.forexample replacingthe variable natline1135withanothervariable pingpongcanpassall thetestcases andcapgenfailstorankthisoneafterthecorrect patch.itisbecausethesetwovariablesareusedtogetheralotintheprogramandthussharingahighcontextsimilarity.besides our variablecontextmodelcannotfilterouttherankofthispatchsince itonlyrequirestheirtypestobethesameifboththeingredient andthetargetnodearesimplenameasdescribedinsection3.
.
.
theseresultsshowthateachofourproposedmodelcanhelp rankthecorrectpatchesattoppositionsand moreimportantly beforetheincorrectplausibleones.
discussions .
on the extensions of capgen capgenperformsasinglemutationtogeneratepatches which indicatescapgencanonlytargetatfixingthosebugsrequiringa singlerepairactioncurrently.however thistypeofbugsiscommon inpractice .forexample aexistingstudyfoundthataround ofthebugscanbefixedbyasinglerepairaction .inthe defects4jbenchmark .
ofthebugs canberepaired byasinglerepairaction.notethat patchesgeneratedviaasimple repairactionmightalsobecomplex.forexample capgeninserts awholeifstatement whichacrossthreelines tofixbugmath .inthefuture wewillincludeperformingmutationsatmultiple placesincapgen.atthesametime wewillalsotrytoreducetheincreaseofthesearchspacethatitincurs.onepossibledirectionistoperformthesameoperationatmultiplebuggytargetnodessimultaneouslyinthefaultspaceiftheyareidenticaltoeachother.for example anbuggyexpression return iszero?nan inf existsat multipleplacesformath46 repairingthisbugrequireschanging allthesebuggyexpressionstothecorrectones.
inthefuture wealsoplantoincludemoremutationoperatorsto increasethechancesofrepairingmorebugs whichcouldbeeasily integrated by design.
furthermore capgen currently searches onlyinthesameprogramfilewherethetargetnoderesidestofindfixingingredients.amongthe71bugswhichrequireonlyonerepair action only27ofthemwhoseallrequiredfixingingredientscan befoundinthesameprogram.therefore extendingthesearching scopeisapromisingextensionforcapgen whichcanincreasethe chancestofindthecorrectfixingingredientsformorebugs .
forexample ifwesearchamongthewholeapplication wecanfind theingredientsfortwomorebugsamongthe71bugs.however including more mutation operators and enlarging the scope to searchtheingredientswillinevitablyincreasethesearchspaceandthusmakeitmorechallengetoidentifythecorrectpatch.therefore bettersearchingstrategiesaredesired.currently capgencombinesfl moandthethreecontextmodelsbymultiplicationtoprioritize thesearchspace.inthefuture capgenwilltrybetterstrategies suchaslearning to ranktechniquestointegratethesemodels.
.
threats to validity onepotentialthreattovalidityisthegeneralityofthebenchmark defects4j whichmeansthatourevaluationresultsmaynotbe generalizedtootherdataset.weplanedtousebugfixsetforcross validation.however itonlyprovidesthepatchforeachbugwithoutthecorrespondingtestcases.therefore itmakesitimpossible tovalidatethecorrectnessofthepatchesgeneratedbycapgen automatically.theotherbenchmarkinjavabesidesdefects4jis introclassjava withinourknowledge.toalleviatethe threatofgenerality wealsoevaluatedcapgenonthisbenchmark.
introclassjavaisthejavaversionoftheintroclassbenchmark authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden m. wen j. chen r. wu d. hao and s. cheung originallyproposedbylegoues etal.
.thisbenchmarkcontains297bugsfromstudent writtenhomeworkassignments.these bugsfeaturecomplicatedfixesalthoughtheyaresmallprograms .wefollowexitingtechniques tocheckwhetherageneratedpatchiscorrect.weruncapgenonthisbenchmarkand foundthatitcansuccessfullyrepair25bugsintotal.thestate ofthe artsemantics basedaprtechniques jfix andangelix whichworkontheintroclassjavabenchmark areabletorepair 19and7bugsrespectively .specifically capgencanrepair14 newbugs.itisbecauseneitherangelixnorjfixcanhandlefloating pointorstringsrelatedbugs limitedbythecapabilityofthe constraintsolvingtechniques.therefore theyhaveonlyevaluated onasubsetoftheintroclassjavabenchmarkwhichonlyincludes integerandboolean relatedfixes.capgenhasnosuchlimitations andareevaluatedonthewholedataset.thisresultalsoshowsthat capgencomplementswelltoexistingapproaches.
besides capgenisdesignedindependentofthedatasetusedfor evaluation.specifically themutationoperatorsareprioritizedbased onsubstantialrealbugfixesextractedfromopensourceprojects.
forthethreecontextmodelsproposedtoprioritizetheingredients weconductanempiricalstudyandtheresultsshowsthatthecorrect fixingingredientsindeedsharehighcontextsimilaritywiththe targetnodesmeasuredbyourmodels.thisfindingisgeneral and canfacilitatethedesignofselectingfixingingredientsforboth search basedandsemantics basedaprtechniquesinthefuture.
related work automatedprogramrepairtechniquescanbebroadlyclassified intotwocategories.thefirstcategoryissearch basedapr .themostrepresentativeofthiscategoryis genprog whichsearchesforcorrectpatchesviagenetic programmingalgorithm.rsrepair adoptsthesamefaultspace andoperationspaceasgenprog.itdiffersfromgenproginthat itsearchesamongallthecandidatesrandomlyinsteadofusing geneticprogramming.reducingthenumberofcandidatepatches andreducingthetestcasesrequiredforvalidatingapatcharetwo importantaspectstoboosttheefficiencyofsearch basedaprtechniques .motivatedbythis ae isproposedtoreducethe totalcostrequiredtofindacorrectpatch.inordertogeneratecandi datesthataremorelikelytobethecorrectpatch par proposes toleveragefixingtemplateslearnedfromhumanpatchestogen eratepossiblecandidates.eachtemplateisabletofixacommon typeofbugs.thedesignofmutationoperatorsofcapgenisalso guidedbysubstantialrealbugfixes.however capgenonlyleveragesthesyntacticinformationtodesignthemutationoperators i.e.
insertingatypeofcodeelementunderanothertypeofcode element .pardesignsmutationoperatorsconsideringthesemanticinformationsuchasaddinganullpointerchecker.designing withsuchspecificinformationmakesparlessgeneralizablethan capgen.themostrecentworkishdrepair whichleverages historicaldatatosearchforcorrectpatches.
thesecondcategoryissemantics basedapr whichsynthesizesarepairpatchdirectlyusingsemanticinformationviasym bolicexecutionandconstraintsolving .
stagedprogramrepair spr isahybridofsearch basedand semantics basedautomatedprogramrepairtechnique.itleverages traditionalmutationoperatorstogeneratecandidatepatches anditisalsocapableofsynthesizingconditionsviasymbolicexecution.prophet wasproposedbasedonspr whichiscapable ofprioritizingcandidatepatchesvialearningfromcorrectpatches automaticallyusingmachinelearningtechniques.sprandprophet onlysynthesizeprogramelementsinvolvingconditions.nopolis alsocapableofsynthesizingconditions .semfix iscapable ofsynthesizingrighthandsideofassignmentsbesidesconditions.
angelix wasproposedtoaddressthescalabilityissueconcerningsemantics basedtechniquesusinganovellightweightrepairconstraint angelic forest.s3wasrecentlyproposedtosynthesize patchesleveragingprogram by examplestechniques .
bothsearch basedaprandsemantics basedaprtechniques havetheiradvantagesanddisadvantages.search basedaprissimple intuitiveandgeneralizabletofixalltypesofbugs whichmake themmoreeffective.however theefficiencyisgreatlycompro misedbythesearchspaceexplosionproblem .ontheother hand semantics basedaprismoreeffectivesincethesearchspaceismoretractablebyusingprogramsynthesiswithrestrictedcompo nents.however theeffectivenesscouldbelimitedbythecapability ofconstraintsolvingandprogramsynthesis.besides bothofthese twocategoriessufferfromtheoverfittingproblem .
in order to generate high quality patches many approaches proposetorankthepatchesbasedontheirlikelihoodtobecorrect recently .hdrepairprioritizespatchesbased ontheirsimilaritieswithpreviousfixpatternsthatareminedfrom softwarehistories .prophet alsocomparesthegenerated patchwithexistinghumanpatchestoinvestigateitsprobability ofbeingcorrectbutleveragesdifferentfeaturesashdrepair .
acsleveragestheinformationminedfromotherprojectsandjava documentationstoprioritizethevariablesandpredicatesusedin thesynthesizedconditions .s3prioritizesthegeneratedpatches bycomparingtheirsimilaritieswiththeoriginalbuggyprogramin termsasetoffeatures .differentfromthem capgendirectly leveragesthecontextinformationextractedfromthebuggycode elements and the fixing ingredients to prioritize the generated patches.tothebestofourknowledge incorporatingthecontext informationoffixingingredientsisnewtoprogramrepair.
conclusion wepresentanovelsearch basedaprtechnique capgen which worksontheastnodeleveltoincreasethechancesofincluding thecorrectpatchesinthesearchspace.thekeynoveltyof cap genwhichallowsittogenerateandsearchthecorrectpatchesefficientlyisthatthepatchgenerationprocessiscontext aware specifically inthefollowingtwoaspects .themutationoperatorsareprioritizedconsideringthecontextinformationguidedbylarge historicaldata.
.fixingingredientsareextractedtogetherwith theircontextinformation andsuchinformationisleveragedtoprioritizethegeneratedpatches.weevaluatecapgenondefects4j andtheresultsshowthatcapgenoutperformsandcomplements existingstate of the arttechniques.moreimportantly capgencanachieveaprecisionof84 .
andcanprioritizethecorrectpatches inpriorto98 .
oftheplausiblebutincorrectones.