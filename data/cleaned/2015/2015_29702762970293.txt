verifying simulink stateflow model timed automata approach yixiao y ang1 yu jiang1 ming gu1 jiaguang sun1 school of software tsinghua university tnlist kliss beijing china1 department of computer science university of illinois at urbana champaign usa2 abstract simulink state ow is widely used for the model driven development of software.
however the increasing demand of rigorous veri cation for safety critical applications brings new challenge to the simulink state ow because of the lack of formal semantics.
in this paper we present stu a selfcontained toolkit to bridge the simulink state ow and a well de ned rigorous veri cation.
the tool translates the simulink state ow into the uppaal timed automata for veri cation.
compared to existing work more advanced and complex modeling features in state ow such as the event stack conditional action and timer are supported.
then with the strong veri cation power of uppaal we can not only nd design defects that are missed by the simulink design veri er but also check more important temporal properties.
the evaluation on arti cial examples and real industrial applications demonstrates the e ectiveness.
the abstract demo video address is the tool and code can be downloaded ccs concepts software and its engineering !model driven software engineering keywords simulink state ow uppaal timed automaton veri cation .
introduction simulink state ow is widely used for the model driven design of software systems which provides well support for the graphical state ow model construction interactive graphical model simulation some basic design validation and the c c and vhdl code generations .
it has been suc cessfully applied to various industry and livelihood areas where simulink design veri er are taking the responsibility to uncover design defects of the state ow model.
motivation however for those safety critical applications such as medical devices and avionics the model validation technique used in simulink design veri er is still insu cient to ensure the correctness.
speci cally the veri cation capability of simulink design veri er is limited to basic properties.
it detects errors in the model that result in the integer over ow array access violations division by zero and violation of requirement assertions described by simulink verication block.
handling complex temporal properties e.g.
something has to hold at the next state of those applications is currently infeasible because of the limited descriptive ability of simulink veri cation block.
more rigorous formal techniques such as model checking should be applied to check the correctness of the state ow model.
challenge the major challenge for applying those formal veri cation techniques to support a wider range of properties is that the execution semantics of state ow is too complex which is described in a pages user guide informally .
advanced modeling feature such as event stack event interruption complex state activating and deactivating mechanism boundary transition and transitional action etc.
are non straightforward to formalize for veri cation.
although there are some existing works on translation based veri cation of state ow model most are e cient and work well covering the most related modeling features within their own domains and few address the temporal part and complex event interrupt mechanism which are hard to formalize but really important in real model of applications.
approach we present stu to automatically translate the simulink state ow model into the uppaal timed automata for a more comprehensive formal analysis.
timed automata is chosen because it can be used to model and analyze the timing behavior of systems and methods for checking both safety and liveness properties of timed automata have been well developed and intensively studied in uppaal.
the advanced state ow modeling features composite state boundary transition junction event conditional action transitional action timer and implicit event stack are addressed in the tool.
with a wider coverage of state ow modeling features captured in stu and the strong veri cation capability of uppaal more comprehensive validation can be accomplished.
potential errors contained in the state ow that are missed in simulation or simulink design veri er veri cation will be detected through uppaal veri cation.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
ase september singapore singapore c acm.
... .
.
background .
simulink stateflow the model in fig.
is an example of a simulink stateow diagram which covers most advanced modeling features.
the model realizes a counter task that for every seconds state adispatches a switch on event and for every switch on event state bwill increase the variable xby .
the statementx x is a conditional action so it will be executed immediately when the event switch on is dispatched.
on the other hand the statement y y is a transitional action which can only be executed when a valid path between two states is detected.
so at the end of execution the value of yis only increased for one time to and the value of xis .
at the same time the boolean variable result is set to be true because the activation of state b2will trigger the activation of parent state count rst.
during the activation of state count the entry action result true is executed.
switch on switch on x x y y count entry result truecontainer entry x int32 y int32 clk int32 result false during clk clk a ca1 a2 c1 c2b b1 b3 b2 figure a state ow example for counter task which covers most advanced modeling features.
more speci cally state ow model is an extended hierarchical state machine which contains sequential decision logic and synchronization events to represent system behaviors.
there are mainly six frequently used modeling elements state transition junction event action and timer.
state it represents operating mode of the system.
the occurrence of an event will trigger the execution of stateow model by making states active or inactive depending on conditions during simulation.
the state can be de ned hierarchically and may contain two types of decomposition which are connected in parallel or serial.
the serial decomposing state must have at least one default transition with only one sub state activated while the parallel decomposing state does not have any default transition with all sub states activated at one time.
that is speaking within a composite state or a chart no two exclusive serial sub states can be active at the same time while any number of parallel sub states can be simultaneously activated.
transition it is the edge between two states or junctions representing the mode change from the source state to the destination state.
each transition is attached with four characterizations where event speci es explicit or implicit signal that triggers execution of transition condition is a boolean expression that allows the transition to be taken with value true theconditional action is the operation that is immediately executed when the condition is met and common action is the operation that will be executed when the condition is met and there is a non interrupted valid path between source state and target state.
each transition also has animplicit priority of execution determined by the information such as hierarchy level of destination state and position of transition source etc.
event there are two types of event used to trigger execution of a state ow diagram.
an explicit event is de ned by users and it can be an input from simulink an output to simulink or local within a diagram.
an implicit event is a built in event that broadcasts automatically during diagram execution.
three commonly used implicit events are system tick enter state name and exit state name tick indicates the moment when a state ow diagram awakens and the other two occur when the speci ed state of state name is entered or exited respectively.
event broadcasting is a common communication technique in state ow.
action it contains two kinds of operation attached on transition conditional action and common action and three kinds of operations attached on state entry action during action and exit action .entry action is executed when the state is activated during action is executed when the state is already active and stays in and exit action is executed when the state changes from active to inactive.
junction it contains two types connective junction and history junction where the former enables the representation of di erent possible transition paths for a single transition and the later represents historical decision points based on historical data relative to state activity.
timer it is used to specify time related behaviors of system which is characterized as where tmop contains three types of time related operation before after and at num is the number used to quantify the length of time period and event consists of three system reserved keywords sec msec and usec which represents second millisecond and microseconds respectively.
.
uppaal timed automata the model in fig.
is an example of a network of timed automata which covers most advanced modelling features.
the model consists of three parallel automata a b and c. a channel switch onis declared for synchronisation among di erent automata and a clock variable tis declared in timed automaton afor time modelling.
every two time units the action switch on!is synchronized with the action switch on?
and the variable x will increase by in automatonb.
if the value of x and y is smaller than automaton b will return to state b1immediately for next synchronization from automaton a. after six time units the transition from stateb4tob2in automaton bwould be triggered and the value of variable result should be set to be true which would immediately trigger the transition from c1toc2contained in automaton c. note that the state with the double cycle is the initial state.
formally a timed automaton is a nite state machine extended with clock variables.
it uses a dense time model switch on?
x x y y y 1a a1 a2b b1 b3 b2t switch on!
t t x y y result true x y result true c c1 c2b4timed automata figure constructed timed automata for counter.
853where clock variables evaluate to real numbers and all clocks progress synchronously.
it can be de ned as a tuple consists of six elements l l0 c a i e where l is a set of locations l0is the initial location cis a set of clocks ais a set of actions b c is a set of conjunctions over simple conditions of the form x .
c orx y .
c x y2c and .
2f g iis a set of invariants on the location ande l a b c 2c ldenotes a set of transition edges.
the edge connects two locations with an action a guard and a set of clocks formalized as l !g a r l0 when l a g r l0 2e.
the transition represented by an edge can be triggered when the clock value satis es the guard labeled on the edge.
the clocks may reset when a transition is taken.
a system can be modeled as a network of timed automata in parallel with synchronous actions de ned on channel ch.
the input action ch?
represents receiving an event from the channelch while the output action ch!
stands for sending an event on the channel ch.
automata in the network execute concurrently.
they can communicate via shared variables as well as via events over those synchronous channels.
in the general case an edge from location l1to location l2can be described in a form l1 !g r l0 if there is no synchronization over channels denotes an empty action or l1 !g ch r l0 .
here ch denotes a synchronization label over channel chwith 2f !
?g g represents a guard for the edge and r denotes the reset operations performed when the transition occurs.
.
model transformation the key challenges ot the semantics gap between simulink state ow and uppaal timed automata are simulink state ow transition is driven by event and the execution order of every step of event is in deterministic sequential manner interruptible and recursive with stack.
while the uppaal timed automata is executed in parallel and driven by the channel synchronization without the support of stack.
simulink state ow supports hierarchy structure which is combined with recursive activation deactivation mechanism the transitional and conditional actions very closely.
while the uppaal timed automata supports single state and non interrupt transition and action.
since the semantics of timed automata is simpler than that of state ow we need to deal with the priority event stack transitional action etc.
with some simple constructs in uppaal timed automata which is highly challenging than the reverse translation from timed automata to state ow .
to simulate the complex model and execution semantics of simulink state ow an array based data structure for event and an entirely new cooperative mechanism are designed and introduced.
.
dynamic event stack construction in state ow the event dispatching and processing mechanism is interruptible.
however in timed automata there is only synchronous channel among parallel automata and no stack at all.
the key idea to simulate state ow event stack mechanism is to build a virtual stack in uppaal.
we use a structured array in uppaal to build the event virtual stack.
the element of the array is a data structure de ned in the listing below which records all information related to an event in state ow.
each element in the structure node is described as listing the de nition of the event structure structure event f int event int dest int destcrossposition int automatontype bool valid g .event is the variable used to label and distinguish different events in state ow.
we assign a unique integer number to this variable for each state ow event.
.dest is the variable used to map a state ow event to a corresponding uppaal controller automata originated from a state ow state with decomposition or attached actions.
this kind of state will be translated into four cooperative automata controller action condition and common automata .
.destcrossposition is the variable used to imply the corresponding uppaal controller automata state originated from state ow cross boundary transition.
.automatontype is the variable used to map the event to the four types of corresponding uppaal automata.
.valid is the variable used to denote whether this event is valid or not at present.
if the event is on the top of the stack and is invalid the event will be deleted by the extra daemon automata which is responsible for deleting invalid event on the top of the stack and dispatching the system event when the stack is empty.
the virtual stack is the basic element to simulate simulink state ow semantics.
it is initialized as empty in the translated uppaal timed automata and is dynamically pushed and popped during runtime simulation.
when simulink state ow generates an event within a transition or a state operation the translated uppaal timed automata will take a corresponding transition with an attached action to dispatch and push an event element into the stack dynamically.
each transition starting from an active state of controller automata will check whether the dest of the top element of event stack equals to the label of automata or not.
if yes the transition will be triggered and the event element will also be popped corresponding to the end of a simulation cycle of simulink state ow.
the procedures are mainly accomplished through ve encoded functions dispatchevent pushevent popevent eventsenttome and stacktopevent of timed automata.
.
state transformation for a regular simple state without decomposition or attached actions the transformation is straightforward.
we just directly map simple state ow state sfto uppaal timed automata state su.
but for those complex state ow state with decomposition or attached actions we need to translate it to four cooperative parallel automata .controller automata is used to simulate the event processing mechanism within this complex state ow state.
it controls how to dispatch the hierarchical active and deactive related event by initializing popping and pushing elements of the virtual stack.
.action automata is responsible for handling the three kinds of attached actions entry during exit .
for the composite state without attached actions this automata will not be generated.
.condition automata is used to execute the conditional action handle the junction test the guard and priority on each transition contained in this composite state and store the boolean results.
.common automata is used to execute the transitional action and read the guard related array initialized by condition automata to execute the satis ed transition contained in this composite state.
controller automata for the activation of state sfin state ow it should estimate whether its upper level state slfis activated or not.
if not slfshould be activated rst this is especially true for cross boundary transitions.
in order to simulate this semantics the corresponding controller automata should push an activation event corresponding to statesfitself onto the stack rst and recursively pushe the activation event associated with the automata originated fromslfonto the stack until the top composite state arrives.
the deactivation of state ow state is a reversal of activation procedure.
in controller automata these two tasks are translated to two self cycle transitions attached with actions stateactivationlogic andstatedeactivationlogic of timed automata.
action automata for detail execution of entry during and exitaction attached on state ow state it will be captured by the translated action automata with three self cycle transitions.
after the execution of controller automata on the logic of state active or deactivate action automata will continually read the stack top event for the test of the guard.
the guard on the three transitions are stacktop .event activationevent stacktop .event duringevent and stacktop .event deactivationevent.
then the transition with satis ed guard will take and corresponding action statements in state ow are translated to action statements attached on the three transitions.
an example for the translated controller automata andaction automata for a composite state ais presented in figure .
for condition automata and common automata they are mainly used for state ow transitions contained in composite state and will be described in the following paragraph.
.
transition transformation within state ow each transition is attached with four characterizations event condition conditional action and condition automaton for a common automaton for a controller automatonfor a action automaton for a figure the controller and action automata for a composite state transformation capturing activation and deactivation.transitional action .
we incorporate them into the condition and common automata of the high level composite state that contains this transition as below.
.event is transformed into a unique integer as described in the event stack transformation.
.condition is transformed into the guard of transition in the corresponding condition automata .
.conditional action is transformed into the action of transition in the corresponding condition automata .
.transitional action is transformed into the action of transition in the corresponding common automata .
when there are multiple transitions starting from a stateow state we should maintain the determinism execution sequence of state ow in timed automata.
first we initialize an int array pathselect to store the priority of transition where the array index represents the depth of source state or junction node of transition.
as presented in figure the depth of state or junction is de ned as the minimum transition number to a pre state.
besides a boolean array pathguard is initialized to store the condition test result of every transition where the array index is the idof stateow transition.
condition automaton common automaton figure the common and condition automata for a composite state transformation capturing internal transition.
condition automata for a state ow transition tf sf !
sf 2with conditional action af cand conditiongf we build condition automata as below.
an intermediate state su iis added between the corresponding timed automata state su andsu .
based on which three automata transitions are de ned tu su !su i tu su i!su 2andtu su i!su .
the guard on transition tu 1ispathselect priority which ensures that the transition is executed by its priority order.
the guard on transition tu 2is the conditiongf from state ow transition tf .
the action on transition tu is from conditional action af cof the state ow transition tf and an additional assignment of the boolean array element pathjudge with value true.
in this way conditional action can be executed immediately whether there is a legal transition path between two state ow states or not.
transitiontu 3is used to roll back to the source state for further test of transitions with lower property and pathguard is set as false to show that this transition could not be taken incommon automata .
also ifsf 2is a state ow junction node a transition is added tu su !su 1for roll back of noncomplete path.
this roll back transition is controlled by the guard pathselect n where i is the depth of the junction node n is the number of outgoing transitions from the 855junction and each negative test of the guard on outgoing transition will increase the value of pathselect by .
the timer of state ow is also captured in condition automata .
time operation is based on event and is usually used as a time related condition on transition.
common automata for a state ow transition tf sf !
sf we build common automata to capture its transitional actionaf t based on the array pathguard initialized in condition automata .
state ow transition tf 1is directly mapped to an automata transition tu su !su .
the guard and action on automata transition tu 1are from the expression pathguard true andtransitional action af trespectively.
it is almost the same as the graphical structure of state ow model with abbreviated guard and transitional action.
an example for the translated common automata andcondition automata of the composite state ais presented in figure .
.
tool implementation based on above transition rules we implement a tool for automatically translation from state ow to uppaal timed automata.
the tool stu consists of a parser translator and storer and is implemented in lines of java code with two supporting libraries jdom used for read and write xml le and antlr used for abstract syntax tree construction and update as presented in figure .
the parser extracts state ow model from simulink project le into memory.
the translator transfers state ow model and reconstructs the abstract syntax tree in memory according to transition rules.
the storer outputs the updated abstract syntax tree to uppaal model le.
the three parts are seamlessly integrated in stu to support the formal analysis of state ow model based on uppaal and can be downloaded in the website presented in abstract.
simulink filejdom stateflow modeltransfer logicuppaal file uppaal modelpaser translatorstorer jdom antrl antrl ast figure translation tool design and integration.
.
tool ev aluation in order to evaluate the tool we apply it to some articial and real industrial state ow models.
the presented stete ow models translated timed automata and properties speci cations could be downloaded in web site presented in footnote .
some implicit bugs in state ow model that can not be detected in design veri er are detected in uppaal veri cation based on the translated timed automata.
the rst arti cial example is the switch on counter example designed to count how many times the event switch on happens.
as presented in figure when the state ow model enters the composite state b there is a potential error of division by contained in the transitional action z x y. so we may verify the property non division by zero in design veri er and the model passes the veri cation.
but according to manual analysis the value of ywould be zeroafter seconds.
design veri er failed to detect this implicit but general bug contained in the model.
potential division by zero figure manual model for validation testing then we translate the state ow model to timed automata through the developed tool stu.
the translation is accomplished within .
seconds.
in the translated timed automata the integer variable yin state ow is mapped to an integer variable chart y and the junction node in state ow is mapped to a state with the name process chart container b.ssid49 .
then property about error of division by within this model can be described as in table .
table property list formula time e process chart container b.ssid49 and chart y and chart x .43s where e is a temporal keyword which means eventually process chart container b.ssid49 is automata state name corresponding to the state ow junction node chart x is automata value test corresponding to the guard x of state ow transition from junction node to state b2 and chart y is also automata value test corresponding to the state ow action z x yattached on the transition from junction node to state b2.
the property consists of a serial combination of previous predicates and means that ymay be set to be when the transition is enabled which will cause the error of division by .
verication result shows that the property is satis ed and the error can be triggered within .
second.
then we apply stu to a real industrial state ow model of the train communication control system and do some veri cation.
the system consists of many multifunction vehicle bus mvb controllers which interconnect devices within a vehicle and the rotated mvb master controller broadcasts a master frame .
given master rotation as an example the master transfer logic described in page and figure of iec are modeled as state ow model.
after preliminary state ow validation on two mvb controller instances we translate the main logic and some accompanied state ow models into corresponding parallel timed automata within .
seconds and verify the property described in table within seconds.
this property is derived from real potential hazards of system failure.
for example in the mvb master and slave rotation process there may be inconsistence such that two masters appear at the same time.
the property is violated during veri cation which means that there exists a path that two mvb controllers may simultaneously reach regular master state or simultaneously reach standby master state.
the rst situation will lead to master collision and the second will lead to no master 856table property list formula time a process chart onemvb1 logic .chart onemvb1 logic rrgular master and process chart onemvb2 logic .chart onemvb2 logic standby master2.349s throughout train communication network.
through manual analysis of counter examples demonstrated in uppaal we trace back to the design defects of state ow model which can be further traced back to the bugs in the standard.
currently any models that consist of the advanced modeling features mentioned in the introduction can be translated by our tool.
because execution semantics of state ow is described in informal natural languages based on examples it is not possible to formally prove the equivalence and correctness of the transformation.
we acquire correctness by carefully compare simulation results of the translated model including the value and state sequence step by step in the same way as previous works.
.
related work because state ow has no formal semantics for rigours formal veri cation plenty of attempts have touched the topic to assist simulink design veri er in acquiring correctness of state ow model which can be classi ed into two categories simulation based techniques and veri cation based techniques.
many researchers have developed simulation based tools for simulink designs including beacon tester and automotgen etc.
for veri cation based techniques the main challenge is that simulink state ow lacks a formal and rigorous de nition of its semantics.
many researchers have de ned several types of formal semantics for state ow and developed many specialized tools for translating subsets of model to pushdown automata smv pat hybrid automata hoare logic and sal which can be veri ed through the corresponding supporting tools.
most of them performs well within their own domain while abstracting some domain unrelated modeling features.
for example in smv based translation they focus and provide a well de ned framework to ensure the function correctness while the hierarchical states and events are out of their considerations.
.
conclusion in this paper we present a tool for the translation of stateow model to timed automata which covers many advanced features such as conditional action activation of composite state and timer etc.
the translated timed automata model can be input to uppaal for simulation and veri cation directly.
then many safety and liveness properties of the original state ow model can be veri ed by the uppaal to acquire higher reliability.
the ongoing work mainly focus on strengthening the useability of stu in the following two aspects the conversion of randomized function in stateow is not supported yet.
the layout of the translated uppaal timed automata needs to be improved.
the automatic trace back tool should be developed.
.
acknowledgmentthis research is sponsored in part by nsfc program no.
no.
national science and technology major project no.
2016zx01038101 tsinghua university initiative scienti c research program miit it funds research and application of tcn key technologies of china and the national key technology r d program no.
2015bag14b01 austrian science fund fwf under grants s11402 n23 rise shine and z211 n23.
.