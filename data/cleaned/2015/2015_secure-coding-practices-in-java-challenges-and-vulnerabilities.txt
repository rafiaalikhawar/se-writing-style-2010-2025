secure coding practices in java challenges and vulnerabilities na meng stefan nagy danfeng daphne yao wenjie zhuang gustavo arango argoty department of computer science virginia tech blacksburg virginia nm8247 snagy2 danfeng kaito gustavo1 vt.edu abstract thejavaplatformanditsthird partylibrariesprovideusefulfeatures to facilitate secure coding.
however misusing them can cost developerstimeandeffort aswellasintroducesecurityvulnerabilitiesinsoftware.weconductedanempiricalstudyonstackoverflow posts aimingtounderstanddevelopers concernsonjavasecure coding theirprogrammingobstacles andinsecurecodingpractices.
weobservedawideadoptionoftheauthenticationandauthorization features provided by spring security a third party framework designed to secure enterprise applications.
we found that programming challenges are usually related to apis or libraries includingthecomplicatedcross languagedatahandlingofcryptog raphy apis and the complex java based or xml based approaches toconfigurespringsecurity.inaddition wereportedmultiplesecurity vulnerabilities in the suggested code of accepted answers on the stackoverflow forum.
the vulnerabilities included disabling thedefaultprotectionagainstcross siterequestforgery csrf attacks breakingssl tlssecuritythroughbypassingcertificate validation andusinginsecurecryptographichashfunctions.our findings reveal the insufficiency of secure coding assistance anddocumentation as well as the huge gap between security theory and coding practices.
ccs concepts general and reference empirical studies keywords securecoding springsecurity csrf ssl tls certificatevalidation cryptographichashfunctions authentication authorization stackoverflow cryptography acm reference format na meng stefan nagy danfeng daphne yao wenjie zhuang gustavo arango argoty.
.
secure coding practices in java challengesandvulnerabilities.in icse icse 40thinternationalconference onsoftwareengineering may27 june3 gothenburg sweden.
acm new york ny usa pages.
thisworkwassupportedbynsfgrantccf 1565827andonrgrantn00014 .
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation on the first page.
copyrights for components of this work owned by others than acmmustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
icse may june gothenburg sweden association for computing machinery.
acm isbn ... .
introduction the java platform and third party libraries e.g.
bouncycastle provideusefulfeaturestosupportsecurecoding.misusingthese libraries and frameworks not only slows down code development but also leads to security vulnerabilities in software .
priorresearchhasmostlyfocusedonthespecifictopicsofmisusing cryptography and secure socket layer ssl apis .
for example nadi et al.
investigated the obstacles introduced by java cryptography apis developers usage of the apis anddesiredtoolsupport .lazaretal.manuallyexamined269 publishedcryptographicvulnerabilitiesinthecvedatabase and found that of them were resulted from cryptography api misuse .fahletal.
andgeorgievetal.
separatelyreported vulnerable android applications and software libraries that misuse ssl apis and demonstrated how these vulnerabilities cause man in the middle attacks.
rahaman and yao recently introduced cryptographicprogram analysis cpa which detectscryptographic coding errors in c c programs with static taint analysis.
all these studies on improving cryptography and ssl coding security are timely and important.
in this work we conducted an in depth investigation on java securecodingproblems.ouranalysisisnotlimitedtocryptography orsslapis.weinspected503stackoverflow so poststhatare relatedtojavasecurity.themajority ofthepostsareabout non cryptolibraries.foreachpost wethoroughlyexaminedthe entire thread including the question and all the responses.
wechose stackoverflow because it is an extremely popular online platform for developers to share and discuss programming issuesandsolutions and soplaysanimportantroleineducating developers and shaping their daily coding practices.
ouranalysiswasconductedatthecodelevel ascode levelinvestigationhasthepotentialtobringdeeperinsights.thetechnical challenge is how to interpret the short and brief posts within the appropriate programming context in order to understand the security impact.tocomprehendeachpost s programcontext westudiedthe contextrelatedtothesourcecode configurationfiles andexecution environments.weaimed toidentifythe rootcauses andsolutions ofeachproblem.tocomprehendeachpost s securitycontext we inferred developers implementation intents from their problem descriptions and the involved security libraries.
we also leveraged our security expertise to assess whether the accepted solutions fulfilledtheiroriginal intents.theseanalysisand reasoningtasks require expertise in both software engineering and cyber security.
in our analysis of the stackoverflow posts we investigated the following three research questions rqs rq1what are the common concerns in java secure coding?
we aimed to identify the libraries and functionalities e.g.
acm ieee 40th international conference on software engineering authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden n. meng et al.
that were most frequently asked about by developers.
our scope covers all topics related to java security not limited to cryptography and ssl.
rq2what are the common programming challenges?
weaimed to identify the common obstacles that hinder secure coding.
suchinformation canprovide softwareengineering researchers actionable insights for designing tools and help close the gap between correct api usage and the practice.
rq3whatarethecommonsecurityvulnerabilities?
thehighpopularityofstackoverflowmaycauseinsecurecodetobeshared and used in real world implementations.
this effort helps raise the security awareness among software developers.
our work provides empirical evidences for many significant securecodingissuesthathavenotbeenpreviouslyreported.the major findings are summarized as follows.
thereweresecurityvulnerabilitiesintherecommendedcode ofsomeacceptedanswers.forexample whenencountering errors during implementing spring security authentication developers were suggested a workaround to disable the default security protection against cross site request forgery csrf attacks.
also for example some posts advised developerstotrustallincomingssl tlscertificatesasafixtocertificate verification errors.
such a setup completely destroys the security guarantees of ssl tls.
although this insecure practicewasreportedbysecurityresearchersin2012 somesousersstillviewthisoptionasacceptable.inaddition md5 or sha algorithms was repeatedly suggested even though these cryptographic hashing algorithms are weakandshouldnotbeusedforhashingpasswords.forthe problematic posts on csrf on ssl tls and on password hashing the total view count is .
various programming challenges were related to security li brary usage.
for instance developers became stuck with using cryptography apis due to clueless error messages complex cross language data handling e.g.
encryption inpython and decryption in java and delicate implicit api usageconstraints.whenusingspringsecurity developers struggledwiththetwoalternativewaysofconfiguringsecurity java based or xml based.
since2012 developershaveincreasinglyreliedonthespring securityforsecurecoding.
267ofthe503examinedposts are about the spring security specifically on the authentication and authorization operations in enterprise applications.
however securityandusabilitystudiesaboutspringsecurity have not been reported in the literature.
developershavepragmaticgoals i.e.
gettingthecodetorun andsecuritygoals.someofthechoicesmadebydevelopersindi cate that the pragmatic goals can take priority over security if a developercannotsatisfybothofthem.inaddition cybersecurity decisionsmaybeinfluencedbythesocialfactors suchasreputation scores votes andaccept labels onthe stackoverflowforum.
wealsofoundoneinstanceofcyberbullying wherecondescending comments were directed at a security conscious user .
we briefly report the social behavioral findings in section .
.
.
our data set is available at 1as of august background theexaminedpostscoverthreetopicsonjavasecurity javaplatformsecurity javaeesecurity andthird partyframeworks.this sectionintroducesthekeyterminologiesusedthroughoutthepaper.
.
java platform security theplatformdefinesapisspanningmajorsecurityareas including cryptography access control and secure communication .
the java cryptography architecture jca contains apis for cryptographic hashes keys and certificates digital signatures and encryption .
nine cryptographic engines are defined to provideeithercryptographicoperations encryption digitalsignatures hashes generatorsorconverters ofcryptographicmaterial keys andalgorithmparameters orobjects keystoresorcertificates that encapsulate the cryptographic data.
the access control architecture protectstheaccesstosensitiveresources e.g.
localfiles orsensitive application code e.g.
methods in a class .
all access controldecisions are mediated by a security manager .
by default the securitymanagerusesthe accesscontroller classforaccesscontrol operations and decisions.
secure communication ensures that the data traveling across a network is sent to the appropriate party withoutbeingmodifiedduringthetransmission.thejavaplatform providesapisupportforstandardsecurecommunicationprotocols likessl tls.
https or http secure is an application specific implementation that is a combination of http and ssl tls.
.
java ee security javaeeisastandardspecificationforenterprisejavaextensions .
variousapplicationserversarebuilttoimplementthisspecification such as jboss or wildfly glassfish websphere andweblogic .ajavaeeapplicationconsistsofcomponents deployedintovariouscontainers.containerssecurecomponents by supporting features like authentication and authorization.
specifically authentication defineshowcommunicatingentities i.e.
aclientandaserver provetoeachothertheiridentities.
anauthenticateduserisissueda credential whichincludesinformation like usernames passwords or tokens.
authorization ensures thatusershavepermissionstoperformoperationsoraccessdata.
whenaccessingacertainresource auserisauthorizediftheserver canmapthisusertoasecurityrolepermittedfortheresource.java ee applications security can be implemented in two ways declarativesecurity expressesanapplicationcomponent s security requirements using either deployment descriptorsorannotations .
a deployment descriptor is an xml fileexternaltotheapplication.thisxmlfileexpressesan application s security structure including security roles access control and authentication requirements.
annotations are used to specify security information in a class file.
they can be either used or overridden by deployment descriptors.
programmaticsecurity isembeddedinanapplicationand isusedtomakesecuritydecisions whendeclarativesecurity alone is not sufficient to express the security model.
.
third party security frameworks severalframeworkswerebuilttoprovideauthentication authoriza tion andothersecurityfeaturesforenterpriseapplications suchas authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
secure coding practices in java challenges and vulnerabilities icse may june gothenburg sweden springsecurity ss .differentfromthejavaeesecurityapis these frameworks are container independent meaning that they donotrequirecontainerstoimplementsecurity.forexample ss handlesrequestsasa single filterinsideacontainer sfilter chain.
there can be multiple security filters inside the ss filter.
developers can choose between xml based andjava based security configurations orahybridofthetwo.similartojavaeesecurity the xml based configuration implements security requirements withdeploymentdescriptorsandsourcecode whilethejava based approach expresses security with annotations and code.
methodology we used the open source python library scrapy to crawl posts from the stackoverflow so website.
figure presents the format of a typical so post.
each post mainly contains two regions the question and answers.
circlecopyrtquestionregion containsthequestiondescriptionandsome metadata.themetadataincludesa voteforthequestion e.g.
indicatingwhetherthequestioniswell definedorwell representative and afavorite count e.g.
showing how many people liked the question.
circlecopyrtanswer region containsallanswer s provided.whenone or more answersare provided the asker decides which answerto accept and marks it with .
java class to trust all for sending file to https web service ... ... figure a highly viewed post viewed times as of jan uary asking about https workarounds to bypass key checking and allow all host names weobtained22 195postscontainingkeywords java and security .afterextractingthequestion answers andrelevantmetadata for each post we refined the data in three ways.
filtering less useful posts.
we automatically refined posts by removing duplicated posts posts without accepted answers and postswhosequestionsreceivednegativevotes usuallybecausethe questions were ill formed or confusing .
removingpostswithoutcodesnippets.
tobetterunderstandthe questions within the program context we only focused on posts containingcodesnippets.sinceourcrawleddatadidnotincludeany metadata describing the existence of code snippets we developed an intuitive filter to search for keywords public and class in each post.
based on our observation a post usually contains these two keywords when it includes a code snippet.
discardingirrelevantposts.
afterapplyingtheabovetwofilters we manually examined the remaining posts and decided whether theywererelevanttojavasecurecoding orsimplycontainedthe checked keywords accidentally.
with the above three filters we finally included posts in ourdatasetaskedbetween2008 .wemanuallycharacterized relevant posts according to their security concerns programming challenges and securityvulnerabilities.basedonthischaracterization we classified the posts.
we aim to answer the following three research questions rqs rq1 what are the common security concerns of developers?we aimed to investigate what are the popular security libraries or functionalities that developers frequently asked about and how have developers security concerns shifted over the years?
because we had no prior knowledge of developers security concerns we adopted an open coding approach to classify posts.
specifically author initially categorized posts based on the software libraries and security concepts discussed.
author an se professor theniterativelyreviewedpoststocreateandadjustthe identified securityconcerns.
next author examinedaround postssuggestedbyauthor1toidentifysecurityvulnerabilitiesin theiranswers.toensurehighqualityofthefindings thetwoauthorscrosscheckedresults andresolveddisagreementwithauthor a cybersecurity professor .
wealsoclassifiedpostsintothreecategoriesbasedonthenumber ofpositivevotesand favoritecountsthattheirquestionsreceived neutral a question does not have any positive vote or favorite count.
positive aquestionreceivesatleastonepositivevotebut zero favorite count.
favorite a question obtains at least one favorite vote.
thus thepostinfigure1isclassifiedas favorite becauseitsfavoritecountis1.bycombiningthiscategorizationwiththesecurity concerns weinferreddevelopers attitudestowardsthesecoding issues.questionsthatareproject specificorseeminglycomplicated mayreceivelowfavoritecounts asotherdevelopersmaynotlearn or benefit from them.
rq2 what are the common programming challenges?
for eachidentifiedsecurityconcern wefurthercharacterizedeachpost based on its problem buggy source code wrongly implemented configuration files improperly configured execution environment the problem s root cause and the accepted solution.
we then clusteredpoststhathavesimilarcharacteristics.forthepostinfigure1 weidentifiedits problemassslverificationworkaround.thedeveloper seemed unaware that ssl should not be bypassed.
the recommended solution was to first create a keystore that contains the certificates of all trusted ssl servers and then use this keystoretoinstantiatea trustmanagerfactory forestablishing unverified connections.
rq3 what are the common security vulnerabilities?
toanalyzeeachpost ssecurityimpact weinspectedtheentirethread including unaccepted answers and conversational comments be tween the question asker and others.
based on recommended securecodingpracticesandthepost ssecuritycontext wedecided whether the accepted solution was vulnerable.
the post shown in authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden n. meng et al.
!
!
!
.
!
!
.
.
.
figure taxonomy of stackoverflow posts figure1hasasecureacceptedanswer althoughtheaskeroriginally asked for a vulnerable solution as an easy fix.
major findings we present our investigation results for the research questions separately in section .
.
.
.
common concerns in security coding figure presents our classification hierarchy among the posts.
at the highest level we created two categories implementation questions vs.comprehensionquestions .themajority 478posts were about implementing security functionalities or resolving program errors.
only questions were asked to understand why specific features were designed in certain ways e.g.
how does java string being immutable increase security?
.
because our focus is on secure coding practices our further classification expands on the implementation relevant posts.
at the second level of the hierarchy we clustered posts based on themajor security platforms or frameworks involved in each post.
corresponding to section we identified posts relevant to javaplatformsecurity javaeesecurity springsecurity and otherthird party security libraries or frameworks.
at the third level we classified the posts belonging to either javaplatformsecurity orspringsecurity because bothcategories contained many posts.
among the java platform security posts in addition to cryptography andsecurecommunication we identifiedathirdmajorconcern access control .amongthespring security posts the majority are related to authentication with the rest on authorization andconfiguration.
finding and of the implementationrelevant posts are on spring security java platform security andjavaeesecurity respectively.thisfindingindicatesthat developers need more help with java spring security.
basedonthesecond andthird levelclassifications weidentified sevenmajorsecuritytopics cryptography accesscontrol secure communication java ee security authentication authorization and configuration.
the first three topics correspond to java plat form security while the last three correspond to spring security.
to reveal trends in developers security concerns over time we clustered posts based on the year each question was asked.
figure presents the post distribution among .
the totalnumberofpostsincreasedovertheyears indicatingthatmore !
!
!
!
!
!
!
!
!
!
!
!
figure the post distribution during developersbecameinvolvedinsecurecodingandencounteredproblems.specifically therewasonly1postcreatedin2008 whereas posts were created in .
during most posts were about java platform security.
however since the major security concern has shifted to securing java enterprise applications including bothjava ee securityand spring security .specifically springsecurityhas takenupover ofthepostspublishedevery year since .
figure4 thepostdistributionamongdevelopers attitudes neutral positive and favorite as shown in figure we also clustered posts based on developers attitudes towards the questions for each security concern.
theconfiguration posts received the highest percentage of neutral opinions .onepossiblereasonisthatthesepostsmainlyfocused on problems caused by incorrect library versions and library dependencyconflicts.sincesuchproblemsareusuallyspecificto softwaredevelopmentenvironments theyarenotrepresentativeor relevant to many developers security interests.
in comparison securecommunication postsreceivedthelowestpercentageofneutral authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
secure coding practices in java challenges and vulnerabilities icse may june gothenburg sweden opinions butthehighestpercentageoffavorite indicating that the questions were more representative focusing more on security implementation instead of environment configuration.
finding over time developers major security concern has shifted from securing java platform to enterprise applications especially the spring security framework.
secure communicationpostsreceivedthehighestpercentage of favorite votes indicating that these questions are both important and representative.
.
common programming challenges to understand the common challenges developers faced we examinedthepostsfromthetopfivemostpopularcategories namely authentication cryptography javaeesecurity access control and secure communication .
we identified posts with similar questions and related answers and further investigated why developers asked these common questions.
this section presents our key findings for each category.
.
.
authentication.
most posts were related to integrating spring security with different application servers e.g.
jboss orframeworks e.g.
springmvc 35posts configuring security in an xml based or java based method posts or convertingxml basedconfigurationstojava based ones posts .
specifically we observed three challenges.
challenge there is much variation in integrating spring security ss with different types of applications.
although ss can be used to secure enterprise applications no matter whether theapplications are spring based or not the usage varies with the applicationsettings .what sworseisthatsomess relevantimplementationsmayexhibitdifferentdynamicbehaviorsindifferentapplicationcontexts.asshowninlisting1 byfollowingastandard tutorial example a developer defined two custom authentication filters apiauthenticationfilter andwebauthenticationfilter to secure two sets of urls of his her spring boot web application.
listing an example of code working unexpectedly in spring boot applications enablewebsecurity public class securityconfiguration configuration order public static class apiconfigurationadapter extends websecurityconfigureradapter bean define the 1st authentication filter public genericfilterbean apiauthenticationfilter ... override protected void confi gure httpsec urity http throws exception http.antmatcher api url pattern match .addfilterafter apiauthenticationfilter ... .sessionmanagement ... configuration order public static class we bsecurityconfiguration extends websecurityconfigureradapter bean define the 2nd authentication filter public genericfilterbean20 webauthenticationfilter ... override protected void configure httpsec urity http throws exception http.antmatcher url pattern match .addfilterafter webauthenticationfilter ... .authorizerequests ... in listing lines correspond to apiconfigurationadapter a security configuration class that specifies apiauthenticationfilter to authenticateurlsmatchingthepattern api .lines15 26correspondto websecurityconfiguration whichconfigures webauthenticationfiltertoauthenticatetheotherurls.ideally onlyonefilterisinvokedgivenoneurl howeverinreality bothfilterswereinvoked.
the root cause is that each filter is a bean annotated with bean on lines and .
spring boot detects the filters and adds them to a regular filter chain while ss also adds them to its own filterchain.
consequently both filters are registered twice and can beinvoked twice.
to solve the problem developers need to enforce each bean to be registered only once by adding specialized code.
unfortunately this issue is not documented in the tutorial.
challenge2 thetwosecurityconfigurations java basedandxmlbased are difficult to implement correctly.
take the java based configurationforexample.therearelotsofannotationsandapisof classes methods andfieldsavailabletospecifydifferentconfiguration options.
for example httpsecurity has methods each of whichcanbeinvokedonan httpsecurity instanceandthenproduces another httpsecurity object.
if developers are not careful about the invocation order between these methods they may get errors .
as shown in listing the method antmatcher api must be invokedbeforeaddfilterafter ... lines so that the filter is only applied to urls matching the pattern api .
unfortunately such implicit constraints and subtle requirements are not well documented.
challenge3 convertingfromxml basedtojava basedconfigurationsistediousanderror prone.
thesemanticconflictsbetween annotations deployment descriptors and code implementations aredifficulttolocateandresolve.suchproblemsbecomemoreseriouswhendevelopersexpresssecurityinajava xmlhybridform.
since spring security .
developers can configure ss in a pure java based approach.
there is documentation describing how to migratefromxml basedtojava basedconfigurations .however manually applying migration rules is still time consuming and error prone.
finding3 springsecurityauthenticationpostsweremainly aboutconfiguringsecurityforvariousenterpriseapplications in different approaches namely java based or xml based and converting between them.
the challenges were due to incompletedocumentation aswellasmissingtoolsupport for automatic configuration checking and converting.
.
.
cryptography.
45of the64posts wereaboutkey generationandusage.forinstance somepostsdiscussedhowtocreate a key from scratch and how to generate or retrieve a key fromarandomnumber abytearray astring acertificate bigintegers a keystore or a file .
other authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden n. meng et al.
posts are on how to compare keys print key information or initialize a cipher for encryption and decryption .
specifically we observed three common challenges of correctly using the cryptography apis.
challenge1 theerrormessagesdidnotprovidesufficientuseful hints about fixes.
we found five posts on the same problem get invalidkeyexception illegalkeysize whilethesolutionswerealmost identical download the java cryptography extension jce unlimited strength jurisdiction policy files local policy.jar and us export policy.jar and place the policy files in proper folders .developersgotthesameexceptionbecauseofmissingeither ofthetwosteps.providingachecklistofthesenecessarystepsin the error message would help developers quickly resolve the problem.
however the existing error messages did not provide any constructive suggestion.
challenge it is difficult to implement security with multiple programminglanguages.
threepostswereaboutencryptingdata withonelanguage e.g.phporpython anddecryptingdatawith another language e.g.
java .
such cross language data encryption decryptionischallenging becausetheformatofthegenerated databyonelanguagerequiresspecialhandlinginanotherlanguage.
listing is an example to generate an rsa key pair and encrypt data in php and to decrypt data in java .
listing encryption in php and decryption in java keypair.php if file exists private.key echo file get contents private.key 4e l s e include crypt rsa.php rsa new crypt rsa res rsa createkey privatekey res publickey res file put contents public.key publickey file put contents private.key privatekey encrypt.php include crypt rsa.php rsa new crypt rsa rsa setencryptionmode crypt rsa encryption oaep rsa loadkey file get contents pu blic.key mainclass.java base64decoder decoder new base64decoder string b64privatekey getcontents http localhost api keypair.php .trim byte decodedkey de coder.dec odebuffer b 64privatekey bufferedreader br new bufferedreader new stringreader new st ring de codedkey pemreader pr new pemreader br keypair kp keypair pr.rea dobject pr.close privatekey privatekey kp.getprivate cipher cipher cipher.getinstance rsa none oaepwithsha1andmgf1padding bc cipher.init cipher.decrypt mode privatekey byte plaintext cipher.dofinal cipher inthisexample whenakeypairisgeneratedinphp lines2 the public key is easy to retrieve in php lines .
however retrieving the private key in java is more complicated lines .after reading in the private key string lines the java implementation first uses base64decoder to decode the string into a byte array line which corresponds to an openssl pem encoded stream line22 .becauseopensslpemisnotastandarddata format the java code further uses a pemreader to convert the streamtoaprivatekeyinstance lines24 beforeusingthekey toinitializeacipher lines28 .existingdocumentationseldom describes how the security data format e.g.
key defined in one language corresponds to that of another language.
unless devel opersareexpertsinbothlanguages itischallengingforthemto figure out the security data processing across languages.
challenge3 implicitconstraintsonapiusagecauseconfusion.
two posts were about getting invalidkeyspecexception algid parse error notasequence whenobtainingaprivatekeyfromafile .
theproblemisthatthekeyshouldbeinpkcs 8formatwhenused to create a pkcs8encodedkeyspec instance as shown below listing3 consistencybetweenthekeyformatandspec privkey should be in pkcs format byte privkey ... pkcs8encodedkeyspec keyspec new pkcs8encodedkeyspec pri vkey the tricky part is that a private key retrieved from a file always has the data type byte even if it is not in pkcs format.
if developers invoke the api pkcs8encodedkeyspec ... with a non pkcs formatted key they would be stuck with the clueless exception.
three solutions were suggested to get a pkcs format key to implementcodetoconvertthebytearray touseanopenssl commandtoconvertthefileformat or tousethe pemreader class of bouncycastle to generate a key from the file.
such implicit constraints between an api and its input format are delicate.
finding4 thecryptographypostsweremostlyaboutkey generation and usage.
developers asked these questions mainlyduetocluelesserrormessages cross languagedata handling and implicit api usage constraints.
.
.
java ee security.
33ofthe58postswereonauthentication and authorization.
the apis of these two security features were defined differently on different application servers e.g.
wildfly and glassfish .
developers might use these servers in combination withdiversethird partylibraries .asaresult thesepostsrarely shared solutions or code implementation.
one common challenge we identified is the usage of declarative securityandprogrammaticsecurity.whendevelopersmisunderstoodannotations theycoulduseincorrectannotationsthatconflict with other annotations deployment descriptors code implementation or file paths .
nevertheless existing error reporting systems only throw exceptions.
there is no tool helping developers identify or resolve conflicting configurations.
finding java ee security posts were mainly about authenticationandauthorization.onechallengeisthecomplexusageofdeclarativesecurityandprogrammaticsecurity and the complicated interactions between the two.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
secure coding practices in java challenges and vulnerabilities icse may june gothenburg sweden .
.
access control.
posts mainly discussed how to restrict orrelaxtheaccesspermission s ofasoftwareapplicationforcertain resource s .
specifically questions asked about restricting untrusted code fromaccessingcertainpackages classes orclassmembers i.e.
methods and fields .
two alternative solutions were commonly suggested for these questions to override the checkxxx methods of securitymanager to disallow invalid accesses or to defineacustompolicyfiletograntlimitedpermissions.another nine posts were on how to allow applets to perform privileged operations .
applets are executed in a security sandbox by default and can only perform a set of safe operations.
one commonly recommendedsolutionwastodigitallysigntheapplet.although it seems that there exist common solutions to the most frequently askedquestions theaccesscontrolimplementationisnotalways intuitive.
we identified two common challenges associated with correctly implementing access control.
challenge1 theeffectofaccesscontrolvarieswiththeprogram context.we identified two issues that were frequently asked about.
first the rmi tutorial suggested that a security manager is needed onlywhen rmi downloads code from a remote machine.
for the rmi program that does not download any code including a securitymanager instance causes an accesscontrolexception .second althoughasignedappletisallowedtoperform sensitive operations it loses its privileges when being invoked fromjavascript .asaresult theinvocationtothesignedapplet shouldbewrappedwithaninvocationof accesscontroller.doprivileged ... .
challenge the effect of access control varies with the execution environment.
securitymanager can disallow illegal accesses via reflection only when the program is executed in a controlled environment i.e.
onatrustedserver .nevertheless iftheprogram isexecutedinanuncontrolledenvironment e.g.onanuntrusted clientmachine wherehackerscancontrolhowtoruntheprogram or manipulate the jar file the security mechanisms become voided.
finding the access control posts were mainly about securitymanager accesscontroller and the policy file.
configuringandcustomizingaccesscontrolpoliciesarechallenging.
.
.
secure communication.
among the examined posts posts were about ssl tls related issues discussing how to create install find orvalidateansslcertificate how to establish a secure connection and how to use ssl together with other libraries such as jndi and powermock .
in particular six posts focused on the problem of unable to find a valid server certificate to establish an ssl connection with a server .insteadofadvisingtoinstalltherequiredcertificates two accepted answers suggested a highly insecure workaround to disablethesslverificationprocess sothat anyincomingcertificate canpassthevalidation .althoughsuchworkaroundseffectively remove the error they fail to secure the communications.
in section4.
wefurtherexplainthesecurityvulnerabilityduetosuch workarounds.developerslikelyacceptedthevulnerableanswers because they found it challenging to implement the entire process of creating installing finding and validating an ssl certificate.finding security communication posts mainly discussed the process of establishing ssl tls connections.
this process containssomanystepsthatdevelopersweretemptedtoaccept abroken solutiontosimply bypassthesecurity verification.
.
common security vulnerabilities amongthefivecategorieslistedinsection4.
weidentifiedsecurity vulnerabilitiesintheacceptedanswersofthreefrequentlydiscussed topics spring security s csrf ssl tls and password hashing.
.
.
spring security s csrf .cross siterequestforgery csrf is a serious attack that tricks a web browser into executing privileged actions e.g.
transferring victim s money to attacker s ac count in a web application e.g.
a bank website without the victim sawareness .therootcauseisthatthebrowserdoes notattempttodistinguishtheattacker sforgedrequestsfromlegitimateones.itautomaticallyappendsthevictim scredential e.g.
session id stored in a cookie toall these outgoing requests.
thus forged requests can pass the authentication.
by default spring security provides the csrf protection by definingafunction csrf andimplicitlyenablingthefunctioninvocation.correspondingly developersshouldincludethecsrftoken in all patch post put and delete methods to leverage the protection .
however among the examined posts on csrf posts discussed program failures while all the accepted answers suggestedaninsecuresolution disablingthecsrfprotectionby invoking http.csrf .disable .
in one instance afteraccepting the vulnerable solution an asker commented adding csrf .disable solved the issue!!!
i have no idea why it was enabled by default .
unfortunately the developer happily disabled the security protection without realizing that such workaround would expose the resulting software to exploits.
finding in of the csrf relevant posts developers took the suggestion to irresponsibly disable the default csrf protection.developerswereunawareofthethreatsassociated with disabling csrf tokens.
.
.
ssl tls.
we examined the posts on ssl tls and observed two important security issues.
problem many developers opted to trust all ssl certificates and permit all hostnames with the intent of quickly building a prototypeinthedevelopmentenvironment.
sslisthestandardsecurity technology for establishing an encrypted connection between a web server andbrowser.
there are mainlyfour steps involved to securelyenablesslconnections .first awebservice sdevelopers request for an ssl certificate for their website by providing the website sidentityinformation e.g.
itspublickeyandhostname to a certification authority ca .
second the ca validates the website sinformation andissuesadigitallysignedsslcertificate.
third whenaclientorbrowserattemptstoconnectthewebsite the server sends over its certificate.
fourth the client conducts several checks including whether thecertificateis issuedby acathe browser trusts whether the requested hostname matches the authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden n. meng et al.
hostnameassociatedwiththecertificate and whethertheserver hastheknowledgeoftheprivatekeycorrespondingtothecertified publickey.ifallthesechecksarepassed thesslconnectioncan be established successfully.
the safest practice is to enable ssl after obtaining a signed certificatefromacertificateauthority ca .however manydevelopersimplementandtestcertificateverificationcodebeforeobtainingthe certificate.
a common workaround without ca signed certificates is to create a local self signed certificate for use in implementing certificate verification .
however of the examined posts accepted an insecure solution to bypass security checks entirely by trustingallcertificatesand orallowing allhostnames asdemonstrated by listing .
listing4 atypicalimplementationtodisablesslcertificate validation create a trust manager that does not validate certificate chains trustmanager t rustallcerts new t rustmanager new x509trustmanager public java.security.cert.x509certificate getacceptedissuers return null public void checkclienttrusted ... public void checkservertrusted ... install the all trusting trust manager 9t r y sslcontext sc sslcontext.
getinstance ssl sc.init null trustallcerts new java.security.
securerandom httpsurlconnection.
setdefaultsslsocketfactory sc.getsocketfactory catch exception e access an https url without any certificate try url url new url https hostname index.html catch malformedurlexception e disablingthesslcertificatevalidationprocesscompletelydestroys the secure communication protocol leaving clients susceptibletoman in the middle mitm attacks .inthemitmattack bysecretlyrelayingandpossiblyalteringcommunication e.g.
throughdnspoisoning betweenclientandserver anattackercan fool the ssl client to connect to an attacker controlled server .
although the insecurity of this coding practice was highlighted in threeexaminedpoststhatwerecreatedsincethenstill discussed this dangerous workaround .
this observationindicatesasignificantgapbetweensecuritytheoryandcoding practices.adeveloperjustifiedtheverification bypassingchoice by stating i want my client to accept any certificate because i m onlyeverpointingtooneserver .2thisstatementindicatesthe lackofunderstandingabouttheman in the middleattack.another developer stated because i needed a quick solution for debugging purposesonly.iwouldnotusethisinproductionduetothesecurity concerns... .however aspointedbyanothersouser and demonstrated by prior research many of these implementationsfindtheirwayintoproductionsoftware andhaveyielded radically insecure systems as a result.
2that is in this developer s application a client only needs to communicate to one server.problem developers were unaware of the best usage of ssl tls.
tls is ssl s successor.
tls is so different from ssl that the two protocols do not interoperate.
to maintain the backward compati bilitywithssl3.
mostssl tlsimplementationsallowprotocol versionnegotiation ifaclientandaservercannotconnectviatls theywillfallbacktousingtheolderprotocolssl3.
.in2014 m ler etal.reportedthepoodleattackwhichexploitsthessl3.0fallback .specifically thereisadesignvulnerabilityinthewayssl .
handles block cipher mode padding which can be exploited by attackers to decrypt ciphertext.
with the poodle attack a hacker can intentionally trigger a tls connection failure and force to use ssl .
.
since2014 researchershaverecommendeddeveloperstodisable ssl3.0supportandconfiguresystemstopreventthessl3.0fallback .
the us government nist mandates ceasing ssl usage in the protection of federal information .
none of the posts mentionedthissecurityissue.themostrecentpost created in still discussed about the use of the obsolete ssl.
finding9 9of10ssl tls relevantpostsdiscussedinsecure codetobypasssecuritychecks.weobservedtwoimportant security threats stackoverflow contains a lot of obsolete andinsecurecodingpractices and developersareunaware of the state of the art security knowledge.
.
.
password hashing.
we found posts on hashing passwords with md5 or sha to store user credentials in databases.
however thesecryptographic hashing functions werefound insecure .theyarevulnerabletooffline dictionaryattacks afterobtainingapasswordhash hfromacompromiseddatabase a hackercanusebrute forcemethodstoenumeratealistofpasswordguesses untilfindingthepassword pwhosehashvaluematches h. impersonatingavaliduseratloginallowsanattackertoconduct malicious behavior.
researchers recommended key stretchingalgorithms e.g.
pbkdf2 bcrypt andscrypt asthebestpracticefor secure password hashing as these algorithms are specially crafted to slow down hash computation by orders of magnitude which substantially increases the difficulty of dictionary attacks.
unfortunately only of the posts mentioned the best practice in their accepted answers.
one post asked about usingmd5 hashing in android .
although subsequent discussion betweendevelopersrevealedrecommendationsofavoidingmd5 the asker kept justifying his her choice of using md5.
the asker even shared a completely wrong understanding of secure hashing the security of hash algorithms really is md5 strongest sha sha sha weakest although theopposite istrue which is md5 sha sha sha .
among these posts some developers misunderstood security apis and ignored the potential consequences of their api choices.
such posts conveying incorrectinformationonsuchapopularplatformcanhaveaprofound negative impact on software security.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
secure coding practices in java challenges and vulnerabilities icse may june gothenburg sweden finding10 of hashing relevant posts accepted vulnerablesolutionsascorrectanswers indicatingthatdevelopers wereunawareofbestsecureprogrammingpractices.incorrect securityinformation maypropagateamong stackoverflow users and negatively influence software development.
.
.
social aspects of stackoverflow.
amongthe17soposts that either discussed or recommended insecure coding practices relevant to csrf posts described in section .
.
ssl tls 9posts described in section .
.
or password hashing posts described in section .
.
we observed a few interesting facts.
the total view count of these posts is .
such a large viewcount means that many developers have read these posts.
it is conceivable that some developers may have heeded the erroneous advice and incorporated the vulnerable code in their projects.
influentialanswersarenotnecessarilysecure.inonepost theinsecuresuggestionbyauserwithahigherreputation .6k reputation score was selected as the accepted answer as opposed to the correct fix by a user with a lower reputation 29k reputationscore .inanotherpost oneinsecure quickfix answerreceived 5votes probablybecause itindeedeliminatedtheerrormessages.
the positive indicators for insecure solutions e.g.
high reputation and positive votes on stackoverflow can mislead developers to implement insecure practices.
also for example a user with zero reputation score pointed out that trusting all certificates is very dangerous.
another user with a higher reputation score .3k made condescending and discouraging remarks such as once you have sufficient reputation you will be able to comment .
finding11 highlyviewedpostsmayinadvertentlypromote insecurecodingpractices.thisproblemmaybefurtheraggravated by misleading indicators such as accepted answers answers positive votes and responders high reputation.
related work wedescribethreecategoriesofrelatedworkonanalyzing detecting and preventing security vulnerabilities due to library api misuse.
.
analyzing security vulnerabilities prior studies showed api misuse caused many security vulnerabilities .forinstance longidentifiedseveraljava features e.g.
the reflection api whose misuse or improper implementationcancompromisesecurity .lazaretal.manually examined269publishedcryptographicvulnerabilitiesinthecve database and observed of them were caused by the misuseof cryptographic libraries .
veracode reported that of all applications used broken or risky cryptographic algorithms .
barua et al.
automatically extracted latent topics in so posts .
these topics are not specific to security.
nadi et al.
reported the obstaclesofusingcryptographyapisbyexamining100soposts and developers survey inputs .
acar et al.
focused on the 3as of august 2017vulnerabilitiesinandroidcode .thestudies byyang etal.
and rahman are the most relevant to our research.
they automaticallyextractedsecurity relevanttopicsfromsoquestions andidentifiedhigh frequencykeywordslike password and hash for post categorization.
our work belongs to this category of analyzing security vulnerabilities.compared withthe priorresearch ourselection ofposts covers java security not limited to cryptography ssl or android.
this broad coverage enables us to obtain new insights on secure codingpractices includingcomplexsecurityconfigurationsinjava spring security and cross language data handling e.g.
encryption in python and decryption in java .
.
detecting security vulnerabilities researchershaveproposedtoolstodetectsecurityvulnerabilities causedbyapimisuse .forinstance egeleetal.implementedastaticcheckerforsixwell definedandroidcryptographicapiusagerules e.g.
donotuseecbmode for encryption .
they analyzed android applications for anyruleviolation .theyfound88 oftheapplicationsviolated at least one checked rule.
fischer et al.
extracted android securityrelatedcodesnippetsfromso andmanuallylabeledasubsetofthedataas secure or insecure .thelabeleddataisusedtotrain a classifier that determines whether or not a code snippet is secure.
the authors then searched for code clones of the snippets in .
million android apps and found many clones of the insecure code.
in fahl et al.
and georgiev et al.
separately reported vulnerable android applications and software libraries that misuse sslapisanddemonstratedhowthesevulnerabilitiescausemanin the middle attacks.
we found three posts created after that stilldiscussedthehighlyinsecurepracticeoftrustingallcertificates insection4.
.
.heetal.developedsslint anautomaticstatic analysis tool to identify the misuse of ssl tls apis in client side applications .rahamanandyaopresentedastatictaintanalysis approach to enforce a wide range of cryptographic properties in c c code .
.
preventing security vulnerabilities researchersproposedapproachestopreventdevelopersfromimplementing vulnerable code and misusing apis .
for example mettler et al.
designed joe e a securityoriented subset of java to support secure coding by removing anyencapsulation breakingfeaturesfromjava e.g.
reflection and by enforcing theleast privilege principle .
keyczar is alibrary designedto simplifythe cryptographyusage andthus toprevent api misuse .
below shows how to decrypt data with keyczar listing simple decryption with keyczar apis crypter crypter new crypter rsakeys string plaintext crypter.de crypt ci phertext comparedwiththedecryptioncodeshowninlisting2 lines18 thisimplementationismuchsimplerandmoreintuitive.alldetails aboutdataformatconversionandcipherinitializationarehidden whileadefaultstrongblockcipherisusedtoproperlydecryptdata.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
icse may june gothenburg sweden n. meng et al.
formal verification techniques can analyze the security properties of cryptographic protocol specifications and cryptographic api implementations .
for instance protocol composition logic pcl is a logic for proving security properties e.g.
on network protocols that use public and symmetric key cryptography .
the logic is designed around a process calculus with actions for possible protocol steps including generating new randomnumbersandsendingandreceivingmessages.theproof system consists of axioms about individual protocol actions and inferencerulesthatyieldassertionsaboutprotocolscomposedof multiple steps.
our recommendations our work reveals the gap between the intended use and the actual useofjavasecurityapis.thisgapmayresultinserioussoftware vulnerabilities.inaddition italsoimpactstheproductivity.some developersreportedspendingsubstantialeffortonlearningabout thecorrectapiusage e.g.
twoweeksasmentionedin .these findings lead us to give the following recommendations.
for developers .conduct security testing to check whether the implemented features work as expected.
do not disable security checks e.g.
csrfcheck toimplementatemporaryfixinthetesting or development environment.
be cautious when following so s accepted or reputable answers to implement secure code because some of these solutions may be insecure and outdated.
for so administrators they may consider adding warnings to the posts withknownvulnerablecode asthesepostsmaymisleaddevelopers.
for library designers .deprecatetheapiswhosesecurityguaranteesarebroken e.g.
md5 .designcleanandhelpfulerrorreport inginterfaceswhichshownotonlytheerror butalsopossibleroot causesandsolutions.designsimplifiedapiswithstrongsecurity defenses implemented by default.
for tool builders .developautomatictoolstodiagnosesecurity errors locatebuggycode andsuggestsecuritypatchesorsolutions.
build vulnerability prevention te chniques which compare peer applications that use the same set of apis to infer and warn potential misuses.
explore approaches that check and enforce the semanticconsistencybetweensecurity relevantannotations code and configurations.buildnewapproachestotransformbetweentheimplementations of declarative security and programmatic security.
threats to validity thisstudyisbasedonourmanualinspectionofjavasecurityposts so the observations may be subject to human bias.
to alleviate the problem thefirstauthorofthepaperconductedmultiplerounds of careful inspection of all the posts relevant to implementationquestions and the second author examined the posts related to security vulnerabilities mentioned in section .
multiple times.
to remove the posts without any code snippets we defined a filter to search for keywords public and class .
if a post does notcontainbothwords thefilterautomaticallyremovesthepost from our dataset.
this filter may incorrectly remove some relevant posts that contain code.
one may improve the crawling technique to keep the code tags around code snippets in the raw data andthen use these tags to filter posts.
one can also leverage cerulo et al.
s approach to automatically extract source code from text.
we chose to report the posts whose accepted answers willcause security vulnerabilities.
there exist other posts whose accepted answerscouldpotentiallybeinsecureandmightleadtovulnerabilities.however duetothelimitedprogramandenvironmentinformation in these posts it is difficult for us to confirm the vulnerabilities.
therefore we decided not to report them.
conclusion ourworkaimedatassessingthecurrentsecurecodingpractices andidentifyingthepotentialgapsbetweensecuritytheoryandprac tice andbetweenspecificationandimplementation.ouranalysisofhundreds of posts on the popular developer forum stackoverflow revealed a worrisome reality in the software development industry.
a substantial number of developers do not appear to understand the security implications of coding options showing a lack of cybersecurity training.
this situation creates frustrationindevelopers whosometimesendupchoosing insecure but easy fixes.
examples of such easy fixes include i disabling csrf protection ii trusting all certificates to enable ssl tls iii using obsolete cryptographic hash functions oriv using obsolete communication protocols.
these insecure coding practices if used in production code will seriously compromise the security of software products.
we provided empirical evidence showing that spring security usage is overly complicated and poorly documented theerrorreportingsystemsofjavaplatformsecurityapis causeconfusion and themulti languagesupportforsecuring data is rather weak.
these issues seriously hinder developers productivity resulting in frustration and confusion.
interestingly we found that the social dynamics among askers and responders may impact people s security choices.
highly viewed posts may wrongly promote vulnerable code.
metadatalikeacceptedanswers responders reputationscores and answers positive vote counts can further mislead developers to take insecure advices.
we also found an instance where cyberbullying comments were directed at a person who pointed out the danger of trusting all certificates.
developers security concerns have shifted from cryptographyapistospringsecurityovertime.however researchers have not provided solutions to resolve the programming challenges in this new framework.
wedescribedseveralpossiblesolutionstoimprovesecurecoding practices in the paper.
efforts e.g.
workforce retraining to correct these alarming security issues may take a while to take effect.
our future work is on building automatic or semi automatic security bug detection and repair tools.