characterizing and identifying misexposed activities in android applications jiwei yan tech.
center of softw.
eng.
institute of software cas china beijing china yanjw ios.ac.cnxi deng state key lab.
of computer science institute of software cas china univ.
of chinese academy of sciences beijing chinaping wang state key lab.
of computer science institute of software cas china univ.
of chinese academy of sciences beijing china tianyong wu state key lab.
of computer science institute of software cas china beijing chinajun yan state key lab.
of computer science institute of software cas china univ.
of chinese academy of sciences beijing chinajian zhang state key lab.
of computer science institute of software cas china univ.
of chinese academy of sciences beijing china abstract exportedactivity ea akindofactivitiesinandroidappsthatcan be launched by external components is one of the most important inter component communication icc mechanisms to realize the interactionandcooperationamongmultipleapps.existingworks have pointed out that once exposed an activity will be vulnerable to malicious icc attacks such as permission leakage attack.
unfortunately itisobservedthataconsiderablenumberofactivitiesin commercial apps are exposed inadvertently while few works have studiedthenecessityandreasonabilityofsuchexposure.thiswork takesthefirststeptosystematicallystudytheexposingbehavior ofeasthroughanalyzing13 873androidapps.itutilizestheea associatedcallrelationshipsextractedfrombyte codeviadata flow analysis as well as the launch conditions obtained from the manifest files to guide the study on the usage and misexposure of eas.
theempiricalfindingsarethattheeamechanismiswidelyadopted indevelopmentandtheactivitiesareliabletobemisexposeddueto thedevelopers misunderstandingorcarelessness.furtherstudyonsubsetsofappsselectedaccordingtodifferentcriteriaindicatesthat the misexposed eas have specific characteristics which are manuallysummarizedintosixtypicalmisusepatterns.asaconsequence ten heuristics are designed to decide whether an activity should be exposed or not and are implemented into an automatic tool called mist.experimentsonthecollectedappsshowthataroundonefifth easare unnecessarilyexposedandthereare morethanonethird eas whose exposure may not be suggested.
this work is supported by national natural science foundation of china grant no.
the national key basic research program of china grant no.
2014cb340701 and key research program of frontier sciences cas grant no.
qyzdj ssw jsc036.
corresponding authors.
email yanjun ios.ac.cn zj ios.ac.cn permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitationon the first page.
copyrights for components of this work owned by others than acm mustbehonored.abstractingwithcreditispermitted.tocopyotherwise orrepublish topostonserversortoredistributetolists requirespriorspecificpermissionand ora fee.
request permissions from permissions acm.org.
ase september montpellier france association for computing machinery.
acm isbn ... .
concepts generalandreference empiricalstudies softwareand its engineering software testing and debugging keywords android apps exported activity program analysis acm reference format jiweiyan xideng pingwang tianyongwu junyan andjianzhang.
.
characterizingandidentifyingmisexposedactivitiesinandroidapplications.
in proceedings of the 33rd acm ieee international conference on automated software engineering ase september montpellier france.acm newyork ny usa 11pages.
introduction withthegrowingmomentumoftheandroidosanditsappmarket thefunctionalitiesofappsbecomerichandspecialized.itisatrend thatmoreandmoreappsshareinformationandcollaboratewith each other to complete a complex task.
for instance an electronicpaymentappcan be invokedbymultiplethird partye commerce appstoperformthepaymentprocess.anotherexampleisthatmany appsareembeddedwithsocialcontactfunctionalitybyinvoking some mature social contact apps e.g.
facebook andwechat.
by default an activity in an app is invisible to the external apps i.e.
theycannotbeactivatedbyactivitiesinotherapps.theandroid system provides the exported activity ea forshort mechanismbywhichanappcansharespecificactivitieswithotherapps.
eas can be regarded as the interfaces of apps which usually carry the key functionalities that the developers want to promote and willberepeatedlyinvokedbyotherapps.besides theinvocation toeasmaybeindeterministicduetotheandroidspecificmapping mechanism e.g.
implicit invocation see section .
which brings flexibility and uncontrollability to their usage.
many activities are made to be exposed i.e.
ea in practice.
accordingtoourstatistics aroundtwothirdsofappshaveatleastoneea andthepercentageofeainallactivitiesisabout8.
seesec tion4.
.existingworks haveshownthevulnerabilityofeas.
for example the arbitrary data received from external apps may disturbtheapps regularwork floworevencausecodeinjection authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiwei yan xi deng ping wang tianyong wu jun yan and jian zhang and the invoking of sensitive apis in ea without the protection of permissionsmaycausepermissionleakage.arecentresearch alsoshowsthatinter componentcommunication icc methodsare significantlyusedbymalwaretoleakprivatedata.thus wehave the following hypothesis exposed activities might bring the potential vulnerabilities to the entire application .
although theeasimplifiesinter appinteraction newpotentialsecurityrisks andfunctionalitybugsthatitmightbringforcedeveloperstothink carefully before using it.
recent works have provided a series of effective defect detection approaches that involve ea however little is known aboutwhethertheexposingbehaviorofanactivityisproperornot.
thewideadoptionofsuchaflexibleanderror proneeamechanism drivesustore examinetheactivitiesthataredeclaredtobeexposed.
thus we make a large scale empirical study on commercial appsand1200open sourceonesinordertoanswerthefollowing three research questions rq1 usageofea towhatextentareeasusedbydevelopers?
which functionalities are eas mostly used to perform?
rq2 comparative analysis are there any differences between the well exposed activities and those should not necessarily be exposed?
rq3 characteristics of misexposed ea are there any common patterns of unnecessarily exposed activities?
can these misexposed eas be identified automatically?
toanswerthesequestions wefirstobtainthelaunchconditions ofeasandextractintentsthatcanstartcertaineasviadata flow analysis on apks.
then we match intents to activities according to theandroidmechanismandconstructthecaller calleepairswithin the app set.
we further employ a comparative analysis on twosets of selected apps to investigate the misexposure of activities.
the comparison results indicate that the misexposed eas have specific characteristics which are manually summarized into six typicalmisusepatterns.furthermore wesumuptenheuristicrules based on these patterns to categorize the eas into four classes and implement these ten rules into a tool called mistfor automatic misexposed ea identification.
the experiments on the collectedappsshowthatabout19.
easareunnecessarilyexposedand there are .
eas whose exposure may not be appropriate.
to sum up the contributions of this work lie in three fold weconductanempiricalstudyonthreedatasetstounderstandthe usageand misexposureof easin practice.to the best of our knowledge this is the first research that systematically studies the behavior of activity exposure.
we make use of static analysis techniques to extract earelated information from tens of thousands of real world apps to aid the misexposure identification.
wesummarizesixkindsofmisusepatternsandextractten rules basedonwhichatoolcalled mistisdesignedandimplemented for ea misexposure identification.
the experiments show that our tool can effectively help to find the misex posed eas.
both our tool and the related data are publicly available on github background this section provides the background knowledge about android system and exported activity.
.
android activity androidisanopen sourceandlinux basedoperatingsystemdeveloped by google for portable devices.
except for some native libraries android apps are mainly written in java and compiledinto dalvik byte code while they also have some configuration files e.g.
manifest file to declare the components and layouts.
androidappsarecomposedoffourkindsofcomponents including activity service content provider and broadcast receiver.among them activityisthemostfrequentlyusedcomponentthatprovides an interface for the users interaction.
a research shows that around .
of the total icc method calls are related to the activitycomponent.theactivitycanbecategorizedintotwokinds including the internal activity ia andexported activity ea .
the formeronecanonlybelaunchedbythecomponentsinthesame app while the latter one allows other android apps to launch it.
theeaprovidesaneffectivewayfortheiccamongmultipleapps which is the major component discussed in this paper.
.
activity attribute and intent filter androidsystemprovidesanumberofattributesfortheactivity whichcanbemainlysetinthemanifestfilebydevelopers.weonly list the relevant ones here.
android exported bydefault thisattributeissetas false i.e.
theactivityisania.developerscanchangeittoexported by setting its value as true.
android permission this attribute defines the permission whichisrequiredforexternalappstoactivatethisactivity.
if the caller app does not declare this permission it is not allowed to call this activity.
theintent filter is an element of ea that is also set in the manifestfile whileaneacanhavemultipleintentfilters.itdecides whatkindsofimplicitintentstheearespondsto.anintentfilter contains several sub elements including action category and data.theresolutionfromintenttointentfiltersisperformedon theseelementsbasedonspecificrules .ifmultipleintentfilters arecompatible thesystemdisplaysadialogshowingoptionsfor userstopickupwhichapptostart.theintentfilterhasanattribute android priority thatprovidesinformationabouthowablean activity is to respond to the intent that matches the filter.
android will consider only those with higher priority values as potential targets for the intent.
.
activity exposing and launching there are two rules to expose an activity according to the android reference .
first if the attribute android exported is set as true this activity will be an ea.
besides for an activity whose attribute android exported is not set it will also be an ea if it contains at least one intent filter .
note that only effective intent filters are considered e.g.
intent filters with no action are ignored because they can not be invoked.
the rest activities are internal ones ias .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizing and identifying misexposed activities in android applications ase september montpellier france botheaandiacanbelaunchedbythemechanismofintent whichcanbecategorizedintotwotypes explicit intent andimplicit intent.theexplicitintentsspecifyitstarget bygivingtheactivity name thefully qualifiedclassname whiletheimplicitintentsonly declare a seriesof features e.g.
action andcategory which makes invokingcomponentsofotherappspossiblewithouttheknowledge of the concrete component name .
android system provides asetofapistoassigntheseattributesthatarerelatedtoactivitylaunching some of which are listed in table .
the combination of these attributes determines the type of invocation explicit or implicit and which activity to be launched.
table some attribute assignment apis of intent intent attribute api componentsetclass setclassname setcomponent intent context class action setaction intent string category addcategory data setdata action data intent string uri action data component intent string uri context class when receiving an explicit intent the activity with the same component name will be directly picked up for reaction.
for implicit intents the system needs to find appropriate activities to start by comparing descriptions of the intent and the intent fil ters of other activities.
it first compares the action informationbetween the intent and all intent filters of eas.
the action spec ified in the intent must match one of the actions listed in thefilter.
for category matching every category in the intent mustmatch a category in the filter.
for intent without category thecategory android.intent.category.default will be added by default.
thus each intent should declare the default category or else it will not be launched by any implicit intent.
for the data element eachpartofitisaseparateattributeintheintentfilter which canbecomposedasauri scheme host port path and then be used for data matching.
.
an example of ea in this subsection we illustrate the ea and intent mechanism by a simple example.
figure 1shows a portion of manifest file of an ea fooactivity .thiseadeclares exported true explicitlyaswell asapermissionnamed com.intent.permission.foo .inaddition it has an intent filter for implicit intent calls.
this intent filter willrespondtointentsthatsatisfythefollowingthreeconditions containingaction com.intent.action.foo havingnocategoryor onlythedefaultone containingdataelementwhosecorresponding uri matches figure2shows an activity that can launch this ea.
it creates an intent instance with a string as the parameter which denotes that the action is com.intent.action.foo .
then it sets the category and data attributes where the value of category is obtained by invoking the method getcategorystr and the value of data is obtained from the parameter uridata.
note that if the default categoryattributeisnotsetinthecode theandroidsystemwilladd it to the intent by default.
then the data items are attached in which bundleis a mapping from stringkeys to various values.
activity android name fooactivity android exported true android permission com.intent.permission.foo intent filter action android name com.intent.action.foo category android name android.intent.category.default dataandroid scheme http android host foo intent filter activity figure manifest file of fooactivity public class foolaunchactivity extends activity public void startwithdata string uridata intentintent new intent com.intent.action.foo stringmycategory getcategorystr intent.addcategory mycategory intent.setdata uri.parse uridata intent.putextra key1 abcdefg intent.putextra key2 new bundle bundle.putint key3 this.startactivity intent figure activity for launching fooactivity finally this intent will be performed with the api startactivity and be resolved to the intent filter of the activity fooactivity which will be launched by the android system after resolving.
empirical study methodology to the best of our knowledge there are no systematic empirical researches thatinvestigate the usageand exposingcharacteristics of ea mechanism in android apps.
thus we conduct an empirical study to investigate how eas are used in real world androidapps.
in this section we introduce the experimental dataset and the method of the empirical study.
.
analysis method tosystematicallystudytheusageofea weperformastatisticanalysistoobtaintheeadeclarationinformationinmanifest including themostcommonlyusedactionsandtheexposingmodesofeas etc.
and to make clear how eas are invoked in the program we analyzetheintentrelatedapisbyapplyingalight weightdata flow analysis on bytecode of the app.
then we construct two databases based ontheanalyzing results i.e.
the ea declaration database and ea invocation database.
the first one stores the ea declaration information including activity attributes as well as intent filters and the second one stores all possible invocations used in the program.
finally theinformationinthetwodatasetsismatchedaccording totheandroidmappingmechanismtoconstructthecaller callee pairswithintheappset whichcanguidethestudyontheusage andmisexposureofeas.theoverallanalysisprocessisshownin figure3.
.
dataset collection therearethreedatasetsinourempiricalstudy inwhichdatasetal contains all the apps we collected from app markets and the other two are selected from dataset al according to different criteria.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiwei yan xi deng ping wang tianyong wu jun yan and jian zhang manifest analysis intent analysisea declaration database ea invocation databasedecompilecall relationship extractionstatistic figure overall analysis process datasetal 873androidappsfromthreemarkets .they arecollectedfromthreeappmarkets includinganopen sourceapp repositoryf droid .
googleplay .
and a chinese app market wandoujia .
.
for f droid we downloadalltheavailableappsinjune2017usingawebcrawler.
considering the scale of google play and wandoujia obtaining alltheirappsisnotpossible.sincegoogleplayhas32categories and wandoujia has ones we download the first apps of each category by the display order.
for google play direct app downloadingisnotallowed thuswegetappsfromathird party websiteapkleecher andmisssomeapps.besides appsthat can not be decompiled are excluded from the dataset.
figure displays the downloads and size distributions of the collected apps usingbox plots.aswecansee theseandroidappsarewidelyused.
amongthem halfhavetheirdownloadcountsintherangefrom onehundred thousandtoonemillion asdemonstratedby thesolid medianline.andthesizeof theappsrangingfromhundredsofkb tohundredsofmb isattheaverageof15mbingoogleplayand 18mb in wandoujia as shown by the x mark symbol.
google wandoujia google wandoujiaf droid figure downloads and file size distribution.
datasetar appscontainingeasthatmightnotnecessarily serveas externalinterfaces.
we focus on the apps that have different characteristics with most others and suppose that easin them might not necessarily be exposed to external apps.
eas are specially designed for external interaction rather than internal main functionality.
according to our statistic most apps exposeonly a small part of activities for external invocation however the percentage of ea in some apps are abnormally high.
to get knowledgeaboutthegenerationofthisdataset wemakeasmall empirical study.
and in this study we take the ratio of ea against the number of activities as the indicator for abnormal app identification.first wepickthetop5appswiththemostabnormalratioof easfromdatasetalandextract327easfromthem.bylaunching each ea and inspect its bytecode to judge the reasonableness of theexposure thetesterreportthat234eas .
aresuspected to be misexposed.
thus in our experiments we distinguish theoutlierappsthathavetheabnormalratioofeasinsection .1as dataset ar based on the following assumption the apps with an abnormal ratio of eas compared with most of the apps aremore likely poorly programmed.
dataset md apps containing eas that are more likely well declared.
to make a comparative analysis between normal appsandoutlierappsindatasetar wewanttoextracteasthat haveahigherpossibilityofbeingwelldeclared.consideringthat widely used apps are more likely to be developed under strict code regulationsbyskilledprogrammersandmighthavebeenwelltested theeascorrespondingtosuchapps aremorelikelytobewelldeclaredandsuitableforcomparison.wealsomakeasmallempirical study for the generation of this dataset.
we pick apps with themost downloads from dataset al and extract eas from them.
by launching each ea and inspect its bytecode to judge the reasonableness of the exposure we find that only eas .
arelabeled as misexposed activities.
and most of these widely used apps provide specific sdks e.g.
wechat s open sdk for external invoking so that have only a small percentage ea for wechat .
therefore we pick up apps that have the most downloads in dataset al to generate dataset md.
.
manifest analysis according to the android reference any activity must be declared inthemanifestfile whichiswritteninxmllanguage.therefore the complete ea declaration report can be obtained by parsingand analyzing manifest files.
we first decompile an apk file intotwo parts the manifest file and the dalvik byte code.
then weidentify all the angbracketleftactivity angbracketrighttags and collect the activity attribute e.g.
android exported aswellastheintentfilter e.g.
android action information.
.
intent analysis to have insights into the activity invocation we make a static analysis of icc messages on the program byte code.
in this step wemakeuseofajavabytecodeanalysisframework soot for data flow analysis.
considering that existing intent analysis toolis inefficient e.g.
seconds per app using ic3 in analyzing our large scale datasets we adopt a light weight intent analysis method in this paper.
our method is mainly based on the reaching definition technique which focuses on statically determining which definitions may reach a given point in the code.
as shown in algorithm we perform a variable assignment analysis on icc messages.
for each method under analysis in line we first construct use define chains to capture the data propagation.
in line we recognize all the invocation units by locating instructions that invoke api startactivityforresult orstartactivity and add them into set invs.
then in line we makeuseoftheuse defchaintoobtainthecorrespondingintent objectintentfor each unit in invs.
next we collect all the units thatarerelatedtoobject intentandformaset usesinline6.in line7 weiterateoveralltheunitsinset usesaimingtofindout all the assignments of each intent related attribute.
consideringthateachapilistedintable 1canbeused wefirstgetthename of attribute e.g.
attr name action usinggetattrname use .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizing and identifying misexposed activities in android applications ase september montpellier france for this attribute we get a mapping of attribute variable by invokingmethod getattrvar udc use andthengettheassignmentsofeachvariable i.e.
a variable assignments mapping by invoking getvarassign method var .
finally the obtained information will be added to the output set by invoking method storeintentinfo in line .
to get the corresponding assignment of a variable one difficulty is that not all assignments of it can be directly obtained.
for a variable assigned as the return value of a function call we search the callee method by its methodsignature and get the last assignmentofthereturnvalue.andforavariableassignedinthe caller method that is passed as a parameter we search the callermethod by its name through call graph.
because there may be severalcallermethods welocateallthecallpointsandaddthese correspondingassignmentsintoacandidateset.besides wetake careofbranchstatementsandgetallthepossibleassignmentsaccording to theuse def chain.
the assignmentobtaining algorithmof method etvarassi n method var is shown in algorithm .
.
call relationship extraction android system has a mechanism for mapping an intent invocation to activities.
when an intent is invoked for activity launching explicitly theandroidsystemwillwakeupthetargetactivitybyitscomponentname.however fortheimplicitlyinvokedintents theandroidsystemneedstosearchallappsforintentfiltersthat match the given intent.
we simulate the matching process refer to section2.
between the caller and callee to extract call relationships for the apps we collected.
then we can obtain the matching resultsonaspecificdataset e.g.
thecallersetofgiveneaorthe callee set of an intent object.
observations from empirical study in this section we discuss our major findings by previous analyses.allofouranalysisprocessesareperformedonanintelxeon cpu .40ghzmachine with64gbmemoryandubuntu16.
operating system.
it takes about hours to decompile all the apk files 8secondsperapp 34minutesformanifestfileanalysisand around hours for intent analysis seconds per app .
algorithm activity invocation analysis input method name method output intent info res list udc etusedefinechains method invs etallunitsinvokin api startactivity foreach unitinvin setinvsdo intent etintentvariable udc inv uses etuseunitset udc intent foreach unitusein setusesdo ifunituseassigns attribute attrthen attr name etattrname use attr var etattrvar udc use attr assi n etvarassi n method attr var storeintentinfo intent attr name attr assi n end if end for end foralgorithm etvarassi n method var input method var output assignment udc etusedefinechains method unit etdefunit var ifunitis caller method then callee etcalleemethod unit var etretvar callee assi nment etvarassi n callee var else ifunitis callee method then callers etcallermethods unit etcallgraph foreach method callerincallers do var etparametervar caller method para index assi nment etvarassi n caller var end for else assi nment etunitassi n unit end if return assignment .
ea usage in this part we discuss the usage and functionality of ea.
percentageofea.
tofigureoutwhethereaisfrequentlyused in real world apps or not we count the number of activities and eas declared in each app.
the detailed results of the apps collectedfrom different app markets are shown in table where the second to fourth columns show the number of apps n activities a and eas ea and the fifth column shows the number of apps that have at least one ea aea .
note that a special kind of ea mainactivity whose action is android.intent.action.main andcategoryis android.intent.category.launcher isexcluded intheprocessofcounting sinceeach mainactivity istheentry of its app and is ea by default.
totally we get activities amongwhich55 075activitiesareeas .
.andthereare9 .
apps that have at least one ea aea which indicates thatthe ea mechanism is widely adopted in the real world android applications.
table number of activities and eas app market n a ea aea f droid google play wandoujia total app market avg a avg ea ea a aea n f droid .
.
.
.
google play .
.
.
.
wandoujia .
.
.
.
average .
.
.
.
we calculatethe ratio ofeas ea a of allthe collected apps anddisplaytheresultsinfigure .theappscollectedfromdifferent marketsarelabeledwithdifferentcolorsandshapes.theseapps alsohavedifferentcharacteristics e.g.
open sourceappsinf droid always contain fewer activities than commercial ones.
for commercial apps the apps in wandoujia are with a higher ratio of eas andaremoredispersedthantheseingoogleplay.wehavetwoobservationsfromfigure someapps haveextremely higher percentageofeasthanothers whenthenumberofactivities increases the ratio of eas decreases in most cases.
thelocal outlier factor lof algorithm isusedtoidentify outliersbasedonthedensity.althoughappswithmanyactivities authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiwei yan xi deng ping wang tianyong wu jun yan and jian zhang 3bujp pg vncfs pg dujwjuz8boepvkjb pphmf spje figure distribution of the ratio of eas number of activityratio of ea figure outlier app detection result and few eas might also be taken as outliers by the lof algorithm theyaremorelikelytobewell programmedappsindeed.therefore we filter out the apps whose ratio of eas is less than .
.
the final results are displayed in figure in which the background color denotes the contour plot based on density.
the lighter the color the higher the density.
to maintain the number consistency of two datasets the top outliers red points are labeled as outlier apps and added into dataset ar.
functionality of ea.
as introduced in section .
a ne am a y containseveralintentfilterstodeclarewhatkindsofimplicitintent theearespondsto.theactionattributeintheintentfilterindicates which kindof operationsthe eawill perform aswell asshows its main functionality.
so we extract all the intent filters from the manifestfileandget63 758actionsthatarein10 010types.among theseactions .
actionsaresystemonesthataredefined in theintent.java file of android source code.
table most frequently used actions actions declared in manifestsystemandroid.intent.action.view .
android.intent.action.send .
android.intent.action.search .
android.appwidget.action.appwidget configure .
android.intent.action.create shortcut .
non systemcom.sina.weibo.sdk.action.action sdk req activity .
com.google.android.gms.appinvite.action preview .
cn.jpush.android.ui.pushactivity .
com taobao tae sdk trade web view action .
com.google.android.gms.actions.search action .
display .
send .
other .
sdk .
search .
setting .
debugging .
figure functionality of actions.
table3showsthemostfrequentlyusedactionsinoureadeclarationdatabase.themostfrequentlyusedsystemactionis android.in tent.action.view .
which is used to display the data to users e.g.
textorwebpagebrowsing.andthemostfrequentlyused non system action is com.sina.weibo.sdk.action.action sdk req activity .
whichisusedtocallbackthecallerappwho invokes sina weibo asocialnetworkingapplication withasharing operation.
we also find that the frequently used non system actions are always provided by giant companies.
to make clear which functionalities are mostly used by developers wepickthe 300mostusedtypesofactions morethan80 of count declaredinthemanifestandmanuallyanalyzetheirfunctionalities.weget21categoriesintotalandtheresultsareshowninfigure7.thecategoriesnotshownareshortcut pick stub camera nfc push communication media launch hardware auth create shareandinstall.aswecansee ea can support various functionalities in which display .
is the most commonlyusedfunctionality.
oneinterestingfindingisthatactionsrelated to sdk account for .
which are provided by big companieslikesina taobao and etc.
by providing sdk to developers these companiescanprotectandmanagetheinvocationoftheireaseasily.anotherobservationisthatthedebuggingandtestingrelated eas still exist in some released apps which may bring potential security issues and should not be exposed in the published version.
.
comparative analysis wenowgettwosmalldatasetsusingdifferentpickingcriteria in whichdatasetmdcontainseasthatbelongtowidelyusedapps and datasetar contains easthat come fromapps with abnormal ratio of eas.
each dataset contains apps and we find that these two datasets are disjoint.
table general information of datasets app num app size ea num ea ratio dataset md 332mb .
dataset ar 522mb .
table4lists the general information about the two datasets.
as wecansee thefirstdifferencebetweenthesetwosetsisthenumber of eas.
while the size is similar apps in dataset ar have much moreeasthanthoseindatasetmd.thelastcolumngivestheratio of eas which shows eas in dataset ar have a larger proportion.
wefurtherinvestigatehowdevelopersexposeaneawithdifferentexposuremodesandshowtheresultsinfigure .theexposure mode extrue indicates the eas whose attribute exported true areexplicitlydeclared and noex indicatestheeaswithoutthatat tribute.
the ratio of activities declared with exported true varies alotinthesetwodatasets whichis50 ondatasetmdbutonly on dataset ar.
it shows that the attribute exported which demonstratestheintentionofdevelopersexplicitly ismore authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizing and identifying misexposed activities in android applications ase september montpellier france sysactdata .
noex .
extrue .
nonsysact .
sysactnodata .
dataset md most downloads sysactdata .
noex .
nonsysact .
extrue .
sysactnodata .
dataset ar abnormal ratio figure exposure mode comparison oftenusedinwellprogrammedapps.
foreasinmode noex we further separate them into three types sysactdata sysactnodata and nonsysact accordingtowhethertheycontainany dataandnon systemactionornot.theresultsshowthat themode sysactnodata israrelyusedinbothdatasets whichmight be an abnormal exposure mode.
.
misexposure patterns of ea the results of the comparative analysis guide the misexposure patternextraction.besides manualinspectiononthe100appsfrom dataset md and ar as well as the android reference also helps.
wefindsixmisexposurepatternsandseparatethemaccordingto whether developers know the exposing characteristic or not.
.
.
developer unanticipated exposure.
as the activity exposing mode is flexible the developers might not know that their activities are exposed.
p1 abnormallyhighpercentageofea.
how to extract thecomparativeresultsintable 4showthatpoorlyprogrammed appsmayhavehighereapercentage i.e.
declaremoremisexposed eas.
by comparing the ratio of eas in each app we find that some apps have extremely high ea numbers and ratios whose functionalities are usually not designed for external invocation.
case study the app mobile collaboration which exceeds millions of downloads in the market contains activities and of them areeas.itsratioofeasreaches98.
whiletheaveragevalueis .
.thisappisdesignedformobileteamworkcooperation and all functions must be accessed by users who have logged in.
however we observe that these eas can be easily accessed through the directexternalinvocationswithoutlogin thatmayviolatetheintentionofdevelopers.anotherexampleisthewell knownapp bing dictionary whichhastotally63activitiesand38ofthemareeas.
however according to the name of these eas and the judgment by manual invocation most of them seem to be part of the internal functionalitiesinsteadofbeingspeciallydesignedforexternalinvocations.
how we identify this pattern can be identified by ea ratio statistic.
p2 copy pastedeadeclaration.
how to extract when developers want to declare an activity correctly the most convenient way is to imitate the last declared one i.e.
declare by copy and paste.
by manual inspection on the manifest files of the selectedappsinbothdatasets wefindthatcopy pastedeadeclarationswidely exist.
case study we findanapp called toolwiz photos which has totally activities and of them are eas.
surprisingly up to eas in this app are declared using mode activity android exported true android name com.toolwiz.
photo.community.userinfoactivity activity android exported true android name com.btows.
photo.editor.ui.selectivecoloractivity figure copy pasted ea declaration extrue .
in figure we show some of them and get rid of all the expose irrelevantattributes.ifwestartactivity userinfoactivity usingadb command1 the appwillcrash andthrowan exception which means that the developers do not expose it deliberately.
andselectivecoloractivity isusedforadjustingthetonefora photo.
external invocation is allowed to directly start it without a targetimage whichleadsthisactivitytobeinvalidandevencauses a crash.
how we identify misexposures in this pattern can be found out by calculating the ratio of each mode see section .
i n one app.
p3 inappropriate action and data.
how to extract accordingtotheandroidreferenceandmanualinspection wefind thatthe officiallyprovided systemactions orcategories arecommonlyused whicharedifficulttobetakenastheidentifierofan ea.developersalwaysadddata auriobjectthatassignsthedatato be acted on to limit the range of resolved activities.
therefore the eadeclarationthatcontainsonlysystemactionswithoutdataitem required is likely to be misused.
case study to ease understanding wediscussarealcasein ucmobile.asshowninfigure it declares an ea with the most frequently used system action android.intent.action.view only.
when an implicit call that onlycontainsthissystemactionissent dozensofeasarematched as candidates to be launched.
how we identify this pattern can be identified by analyzing the intent filers of each ea.
activity android name com.ucweb.activity.lifeassistantactivity intent filter action android name android.intent.action.view category android name android.intent.category.default intent filter activity figure inappropriate action and data p4 incorrectcategorysetting.
how to extract according to the official reference android system will automatically applythecategory android.intent.category.default toallthe implicit intents so that an ea must include such category in its intent filters.
otherwise no implicit intents will resolve to this ea with incomplete intent filters.
however they are still exposed in force and can be invoked by explicit intents.
case study as shown in figure app mozilla browser declares such an ea that contains an action only.
this activity fails to be invoked implicitly however itisexposedbydeclaringintent filterandcanbeinvoked explicitly.
when this ea is invoked explicitly a blank window will show up and then disappear.
then the logcat will give the error logandroid.view.windowleaked whichmeanstheactivityhasa leakedwindow.obviously thisactivityisnotreadytobeexposedasan ea.
how we identify we identify this pattern by detecting the existence of the default category.
1considering that the lack of extra data will also cause app crash all eas we listed in this section do not need to receive any extra data.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiwei yan xi deng ping wang tianyong wu jun yan and jian zhang activity android name org.mozilla.gecko.sync.config.activities.
selectenginesactivity intent filter action android name android.intent.action.main intent filter activity figure incorrect category setting p5 implicit internal invocation .
how to extract in the light of the android reference activities declared with intentfilterswillexposeanactivity.developersshouldpreventotherapps fromcallingoneactivitybynotsettingintentfiltersforit.however by our investigation intent filters are often used for implicit intrainvocation due to its convenience rather than external invocation.
the comparative results in the previous section also show that widely used apps declare ea in extrue more frequently.
case study the app dianping contains eas and of them are in the mode noex .
some of them are used for implicit invocation inferredbythenameoftheseactivities e.g.
mycardactivity and atfriendactivity .
how we identify we identify this pattern bycomparingtheratioofeachexposuremodeandprovidewarning information to developers.
.
.
developer anticipated exposure.
there are also some eas thatareexposedfortheconvenienceofdevelopmentandshould be removed before application being released otherwise they may bring unpredictable threats.
p6 debuggingfunctionality.
how to extract inourmanual inspection we find that some activities are designed and exposed to ease the debugging mainly according to their names.
these exposed debugging activities help to test the target activity directly andtheymaymanipulatethedatabaseandlacksecurity protection forgettingtoremovetheminthereleaseversionsmight beanissue.
case study forinstance theinvokingoftheea debugdomainselectactivity in figure 12launches an activity that is used for domain testing.
how we identify by keyword retrieving we totally find debugging activities in this app.
activity android name com.dianping.debug.debugdomainselectactivity intent filter action android name com.dianping.action.view category android name android.intent.category.default intent filter activity figure debugging functionality misexposure characterization and identification through the investigation of collected datasets we summarize a seriesofrulestoidentifywhetheraneaismisexposedornot.first wegiveseveralfeaturesofactivityintable includinginformationabout eadeclarationandinvocation aswellas theattributes usedintheidentificationofthemisexposurepatterns.eachfeature correspondstoabooleanvariableandthesecondcolumndescribes the condition to make it true.
then we summarize the characteristics of misexposed activities according to the patterns in section .
and give out the classificationrulesintable .asshowninthefirstcolumn eascanbetable features of ea feature description extrue declaresexported true iftrue containsintent filter nodefault omits the default category sysactnodata declare only system action without data priority contains priority setting of intent filter permission contains permission setting of activity clsdeclarewith classname that has been declared more than three times in manifest clsinvoke with classname that has been externally invoked actinvokewith non system action that has been externallyinvoked similarbelongs to an app that declared ea with the similar exposure mode shown in figure including extrue sysactdata sysactnodata and nonsysact.
debug contains keywords test debug etc.
highratio belongs to an app that has high value of ea a table the classification conditions of ea class prcondition mustea4clsinvoke oractinvoke 5clsdeclare 6priority orpermission mayea 9extrue mayia7similar p2 8highratio p1 10iftrueand notextrue p5 mustia1sysactnodata andiftrueand notextrue p3 2nodefault andiftrueand notextrue p4 3debug p6 classifiedintofourclassesaccordingtothenecessityandreasonability of the exposure.
all the rules can be categorized into two types i.e.
must and may in which the type may containssome coarse grained rules that can not tell which specific ea ismisexposed.
for example the rule similarcan only figure out a seriesofsimilareastobesuspicious.thesecondcolumnshows thepriority pr ofrules whichissetaccordingtoourexperience.
the last column describes the judgment conditions which uses single or the combination of features listed in table .
because one eamaysatisfyseveralconditionsatthesametime whenconditioncollisionoccurs thefinalclassificationisdeterminedbythepriority value.
for example the rule debugthat maps to class mustia has high priority while another rule extrue mayea is more undetermined.
when both these conditions are satisfied by one ea it will be classified as mustia at last.
then we use a logic programming language prologto automaticallyidentifythemisexposures inwhichtheprogramlogicisexpressedintermsofrelations representedas factsandrules .
a fact is composed of an attribute and its value and a rule is in the formofhead body.
inwhichthe headistheconclusionandthe bodycontainsseveralfacts.ifthefactsinbodyaretrue thehead is true.
figure13shows part of our implementation using prolog i n which the declaring order of rules decides the priority of matching.
we use features listed in table 5as attributes of fact whose values canbeextractedthrougheadeclarationandinvocationanalysis.
foreachea wecangettotallytenfactstohelptheclassification.
andwemakeuseofconditionsandtheirclassesintable 6todefine authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizing and identifying misexposed activities in android applications ase september montpellier france ten rules in which the ia classification conditions are linked to misexposure patterns.
for example line in figure 13represent a rule which means if the fact clsdeclare true is satisfied the class of corresponding activity is mustea .
for other rules that containseveralfacts thesefactsarecombined wherethecomma indicates and and the semicolon indicates or .
for instance the lines mean that if an ea satisfies nodefault true and not iftrue true and not extrue true or debug true i t belongs to class mustia .
evaluation we describe some experiments in this section.
a tool called mist misexposure identification for android is designed and implemented based on the extracted rules.
for the coarse grained rule highratio wefindouttheappsthathavemorethan50easanda ratio of eas larger than .
.
for rule similar we only detect apps thathavemorethan30easandusethresholdsthatvaryfrom0.5to .
for different exposure modes.
then we perform experiments on a large scale dataset and two small ones which aims at answering the following two research questions rq4 usefulness towhatextentareourmisexposureidentification results consistent with manual checking?
does the identification help developers to reduce icc attack threats?
rq5 result distribution what is the distribution of eas misexposed inreal world androidapps?
do theresults vary in different datasets?
.
rq4 usefulness we randomly select apps and launch their eas to verify the identification consistency between mistand manual checking.
besidesmainactivity easthatneedtoreceive extra data arealso excluded sincetheuncertainlaunchingresultsinducedbydifferent inputswillobstructthemanualjudgment.totally weobtain519 eas from the selected apps.
asweknow therearenocommoncriteriatodeterminewhether an activity should be exposed or not and no existing benchmark is provided for this task.
therefore to get the correct classification results for tool evaluation we design the following regulations for manual identification according to the launching result theactivityisaniaifithasdatadependencieswithother unexecuted internal activities and thus provides incomplete functionalities showsabnormaldisplay e.g.
blankwindow throws exceptions or provides obviously internal functionalities e.g.
debugging .
the activity is anea if it provides complete functionalities for external apps.
foreachoftheeas weautomaticallygeneratean adblaunching command suchas adb shell am start n package activity activity mustia nodefault true not iftrue true not extrue true debug true activity mustea clsdeclare true .
figure part of the implementation using prolog d data accordingtotheeadeclaration.theoptions a foraction and c forcategory arenotadoptedtoensureonlyonetargetwill respond.whenthetargeteaislaunched theguiinterfacesand the exception information from logcat are considered in manual annotation but the code information is not provided.
allthe519easarelabeledbythreeannotatorsaseaoriain aboutfivehours whiletheautomaticidentificationby mistonly takes several seconds.
we compare the results committed by all annotators and find that they annotate same labels on eas.i.e.
all of them label an activity as ea ia and the disagreementamong annotators is .
.
it is hard for annotators to infer the intention of developers from the decompiled byte code thus annotatorsmayhavedisagreementonthesameactivity.forexample some eas receive uri as the data item which can be composed as scheme host port path .itiseasytogeneratea legal input but it may not make sense which may cause invalidinvocation or blank window.
the launching of these eas is difficult to judge by annotators who are not the developers of the app under test.
therefore we perform a strict selection i.e.
we justconsidertheactivitiesthatareclassifiedintothesameclassesby all annotators as the test oracle and drop the rest.
the final results showthat263 .
easaresuccessfullyidentifiedasthesame typebytheannotatorsandourtool.theprecisionandrecallofthemisexposureidentificationare0.87and0.
respectively.forthoseinconsistent ones the rules extrueandsimilar hit the most ones over in total which should be further studied and refined.
we also collect some apps that have been reported as victims of icc attacks.
for example covert is a popular permission leakage detection tool whose results are publicly available on web site .therearetotallytenactivitiesthatarereportedasvictims of the permission leakage by covert in which seven of them are mainactivity .
we identify the rest three activities using mistand findouttwoofthemseemtobemisexposed.bymanualinspection these two activities from two apps are inferred to be misexposed ones sincetheyaredesignedforimplicitinvocationratherthanexternal invocation which indicates that the vulnerabilities of these apps can be fixed by unexposing their activities.
.
rq5 result distribution we extract and collect features for all eas in apps of the three datasets and make use of the rules written in prologto classify these eas.
then we obtain the classification results and show their statistics in figure .
aswecansee indatasetal thereare19.
ofeasthatare classified as mustia with high certainty.
overall more than half .
ofeasaresuspectedtobeias whoseexposuremaynotbe suggested.
our further analysis shows that in the apps which mustea .
mayea .
mayia .
mustia .
dataset al mustea .
mayea .
mayia .
mustia .
dataset md mustea .
mayea .
mayia .
mustia .
dataset ar figure identification results on three datasets authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france jiwei yan xi deng ping wang tianyong wu jun yan and jian zhang .
.
.
.
.
.
.
.
.
.
debug qsjpsjuz l8 highratio2 nodefault dmt owplf l7 similar tzt du p bub l5 clsdeclare9 extrue jg5svf boe l figure statistic results of each rule have at least one ea .
of them are detected to have at leastonemisexposedea.theseresultsindicatethat themisexposureofeawidelyexistsinreal worldapps .
for the other two datasets thereare55.
ofeasseemtobecorrectlyexposedin datasetmd.andforthedatasetar only20.
ofeasseemto be rightly exposed which is consistent with our assumption.
tohavesomeintuitiveunderstandingofourrules wecountthe hitting number of each rule on dataset al.
as we can see from figure15 the rule iftrue and not extrue hits the most eas.
these eas are suspected to be ias and should be checked by their developers.rule extruealsoholdsforalargeproportion which shows that a number of developers show their exposing intention explicitly.
and about .
of eas satisfy the rule clsdeclare which may be public activities provided as the sdk interfaces.
for otherrules theyhitfewereasevensomeofthemhavehighpriority indicating that they are discriminative for identification.
threats to validity as with any system misthas its limitations including the scale of benchmarks thesetting andtheresearchscope.first theidentification results are limited by the scale of our dataset especially when the rules that involve the number of invocations are used.
besides boththethresholdineachruleandthepriorityvalueto combinetheserulesaresetmanually whichmaylimittheaccuracy of identification.
these settings can be obtained by a combined techniqueofprogramanalysisandmachinelearning.finally android apps are composed of four kinds of components and onlythe most commonly used component activity is studied in this paper.webelievethatthemisexposureofothercomponentshas similar characteristics with activity and will investigate them in our following studies.
related work iccattacksdetection.
currently mostoftheexistingworkson testingandanalysisofandroidapps targetattheintra app analysis.however thedesignoficchasitslimitations whichmay causebugsorsecurityflaws.arecentstudybyahmadetal.
discussed the challenges it brings to android development.
chin et al.
provide tool comdroid to describe application communicationvulnerabilitiescausedbythemisunderstandingoftheintent passing system e.g.
unauthorized intent receipt and intent spoofing.theresearch proposesaniterativetestgenerationapproach todetecttheiccvulnerabilities e.g.
xss sqlinjection etc.
of androidapps.ineachiteration theyrecoveredthecustomfields variables ofintentbyinstrumentingtheapisthatareusedtoread such fields and monitoring the app execution.
bagheri et al.
implement a tool covert that can detect the permission leakagecaused by the lack of permission requirements of exposed components.theyfirstperformthestaticanalysistechniquestoobtain the model of program behavior and then use the alloy language an object modeling notation to model the combination of apps and finally perform the formal analysis technique to verify themodel.inadditiontoawidevarietyofapproachestoidentifying vulnerabilities anexploitgenerationtoolletterbom basedona combinedpath sensitivesymbolicexecution basedstaticanalysisisprovided whichcanbeusedtoreducethenumberoffalsepositives invulnerabilitydetection.inourwork wepaymoreattentionto another aspect i.e.
detect whether activities should be exposed or not instead of detecting its vulnerabilities.
intent analysis.
theimplicitcontrolflowintroducedbyicc mechanism makes the generation of precise call graph and control flow graph which are the essential parts of program analysis very difficult.
in recent years several researchers aim to expose suchimplicit transitions by intent analysis in which the tool epicc isprovidedbyocteauetal.forobtainingtheiccmethods and their parameters.
they also provided a tool ic3 epicc has now been replaced with ic3 which modeled the icc messages with proposed coal language and implemented the associatedsolverthatperformsastringanalysistofigureoutthe icc specification in android apps.
based on epicc and ic3 li etal.
developed iccta a static analysis tool for detecting intercomponentprivacyleaksinandroidapps.thelinksbetweenthe components are detected by the code instrumentation and static analysis techniques.
besides the activity zhang et al.
focus on servicetestingbyextractingservicerelatedintentsusingavariable assignment analysis.
conclusion inthispaper weinvestigatetheexposingbehaviorofeas whichisrarelydiscussedinexistingworks.sinceeasusuallycarrythefunctionalities that are eagerly promoted by developers and vulnerable to malicious icc attacks eliminating the unnecessarily exposed easisasimplebuteffectivewaytoimprovethequalityofandroid apps.therefore thekeychallengeliesintheidentificationofthe misexposure.
with the help of the static analysis we derive typical misexposed activities from tens of thousands of real world apps.
byinvestigatingtheseactivities wesummarizethespecificcharacteristicsofmisexposed easintotypicalmisuse patterns which in general are related to the misunderstanding and carelessness of developers.
we also design several heuristics for misexposed eaidentificationandimplementatoolcalled mist.theexperiments on real worldapps showthat itcan effectivelyhelp tolocate the misexposed eas and the problem of the misexposure of activitiesis widespread and noteworthy.
our tool can improve the quality and robustness of android applications by detecting misexposures of activities.
in the future we will improve the accuracy of our tool by using more concise static analysis and employing machine learning techniques to obtain the weights including the thresholds and the priority from a training set with sufficiently labeled samples.
we will also make further studiesontheexploitationofthemisexposedactivitiesaswellas howtore implement theeadeclarationsautomaticallytofixthe misexposures .
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
characterizing and identifying misexposed activities in android applications ase september montpellier france