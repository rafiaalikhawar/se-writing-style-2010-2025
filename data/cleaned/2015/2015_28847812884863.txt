reference hijacking patching protecting and analyzing on unmodified and non rooted android devices wei you1 bin liang1 wenchang shi1 shuyang zhu1 peng wang1 sikefu xie1 xiangyu zhang3 1key laboratory of data engineering and knowledge engineering renmin university of china moe beijing china 2school of information renmin university of china beijing china youwei liangb wenchang zhushuyang pengwang decadall ruc.edu.cn 3department of computer science purdue university indiana usa xyzhang cs.purdue.edu abstract many efforts have been paid to enhance the security of android.
however less attention has been given to how to practically adopt the enhancements on off the shelf devices.
in particular securing android devices often requires modifying their write pr otected underlying system component files especially the system libraries by flashing or rooting devices which is unacceptable in many realistic cases.
in this paper a novel technique called reference hijacking is presented to address the problem.
by introducing a specially designed reset procedure a new execution environment is constructed for the target application in which the reference to the underlying system libraries will be redirected to the securityenhanced alternatives.
the technique can be applicable to both the dalvik and android runtime art environments and to almost all mainstream android versions .x to .x .
to demonstrate the capability of reference hijacking we develop three prototype sy stems patchman controlman and taintman to enforce specific security enhancements involving patching vulnerabilities pr otecting inter component communications and performing dyna mic taint analysis for the target application.
the se three prototypes have been successfully deployed on a number of popular android devices from different manufacturers without modifying the u nderlying system.
the evaluation results show that they are effe ctive and do not introduce noticeable overhead.
they strongly su pport that reference hijacking can substantially improve the pract icability of many security enhancement efforts for android.
ccs concepts systems security operating systems security mobile platform security.
keywords android security enhancement practicability .
introduction android has become the most widely used mobile operating sy stem.
it dominated the global smartphone market with an share in q2 of and continues to grow steadily .
at the same time people become increasingly dependent on handheld devices for processing personal information and handling business affairs.
to guarantee the security of devices is of great importance for end users.
over the past few years many studies have been proposed to i mprove the security of android such as patching security vulner abilities extending the standard security model and analyzing malicious applications .
these studies have brought great improvement to the security of android.
however less attention has been given to the deployability of these security enhancements which has a significant impact on their adoptio n. in fact deploying security enhancements on off the shelf devices is not a trivial task.
it is inevitable to modify the system comp onent files of the android os.
in practice when patching a vulne rable system library we need to replace it with a fixed alternative or rewrite it with patch code .
similarly to enforce a cu stomized security policy the additional security module often needs to be introduced into the system libraries of the android framework .
for analyzing malware the analyst also needs to effectively inspect the execution of the system l ibraries in addition to the target applications themselves .
however android has more stringent security restrictions than desktop platforms.
the underlying system libraries are stored in special folders which are only writable for the root user.
in android root privilege is not granted to end users to avoid priv ilege abuse.
this poses an obstacle for deploying security e nhancements.
without root privilege it is impossible to rewrite or replace the original system libraries.
to deploy security enhancements most exiting studies employ the following two ways.
the first way employed by is to integrate the android source tree with security enforcement code and compile the modified source code to a new system image for flashing into devices.
it involves a complex series of steps and is at the risk of bricking devices.
the second way employed by is to root devices and inject security enforcement code into the target application process.
it compromises system integrity and may cause severe hazard if the root privilege is abused .
in practice these two ways are not acceptable for normal users.
this substantially hinders the widespread adoption of many sec urity enhancements.
it should be noted that a few attempts have been made to enforce application wide security features without flashing or rooting devices.
aurasium enforces a fine grained permission policy.
the global offset table got of the target application process is rewritten such that calls to critical libc functions can be intercep ted and validated.
boxify proposes a novel technique to e n corresponding author permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this w ork owned by others than acm must be ho nored.
abstracting with credit is permitted.
to copy otherwise or repu blish to post on servers or to redistribute to lists requires prior sp ecific permission and or a fee.
request permissions from permissions acm.o rg.
icse may austin tx usa acm.
isbn ... .
ieee acm 38th ieee international conference on software engineering force privilege separation policies.
untrusted applications are securely encapsulated in an isolated sandbox such that interprocess communications and system calls of the untrusted applic ations can be mediated.
although the se two approaches do not require modification of the underlying system their capabilities are limited to enforcing function call level protection policies.
it is very difficult if not impossible to enforce an in depth security enhancement only by intercepting calls such as completely r epairing a vulnerable system library or tracking the execution of an underlying function.
based on the above discussion we can see that how to practically enforce in depth security enhancements in the underlying system libraries without flashing or rooting devices remains an important open challenge.
our approach.
in this paper we propose a novel technique called reference hijacking to conveniently introduce additional in depth security features into underlying system libraries.
refe rence hijacking is mainly archived by a specially designed env ironment reset procedure triggered when the target application is launched .
the reset procedure reconstructs a new execution environment for the target application such that the system libraries can be loaded from a configurable location instead of the default folders.
as a result the reference of the target application to the underlying system libraries can be redirected to the securityenhanced alternatives.
in theory the technique can be regarded as an inline reference monitoring irm based approach.
co mpared with the existing irm based approaches our tec hnique enables us to take full control over the reference of the ta rget application to the underlying system libraries rather than merely intercepting certain api calls.
we evaluate the technique on prevalent off the shelf devices involving almost all mai nstream android versions from .x to .x and covering both the dalvik and android runtime art environments.
the evalu ation results show that the technique works well on all tested d evices and only introduces small launch time delay detailed in section .
to further demonstrate the capability of reference hijacking we design and implement three prototype systems based on it for enforcing specific security enhancements to address three hot and important security issues of android.
the experiment results show that all of the se three prototypes are effective and efficient and can be directly deployed on the off the shelf android devices.
the first prototype patchman is to patch vulnerable underlying system libraries.
vulnerabilities pose serious security threats and should be patched as timely as possible.
unfortunately google adopts a controversial patch policy.
patches are provided prefe rentially to the latest versions while back porting to the legacy versions is not promised and even refused .
besides many device manufactures only provide a limited support time window.
beyond the window no further update will be provided even though those old devices are still widely used .
as a result a large portion of devices in use contain critical vulnerabilities .
patchman provides a third party patch mechanism for poorlysupported devices.
it allows organizations or end users to proactively fix vulnerable devices by themselves.
by leveraging refe rence hijacking the target application can conveniently use the patched system libraries as the substitute of the vulnerable ones detailed in section .
the second prototype controlman is to enforce a flexible access control policy on inter component communications iccs .
by default android enforces a permission based security model to protect the icc interfaces.
however this generic model is not completely suitable for some particular requirements.
for example a user may want to restrict iccs of a target application only a llowing the applications in the white list to send receive messages to from the target application.
this requirement is reasonable but beyond the capability of the standard android security model.
controlman provides a more flexible access control model which enables end users to regulate the incoming and outgoing icc b ehaviors of a target application by specifying customized security policies.
the access control model is implemented in the e nhanced system libraries which will be used to replace the original libraries for the target application via reference hijacking detailed in section .
the third prototype taintman is to perform dynamic taint anal ysis dta for malware detection.
due to the openness of application markets and the lack of effective vetting process a ndroid accounts for of all mobile malware .
even in the official market there still exist a considerable number of malware .
moreover sophisticated adversaries have begun to e mploy anti analysis technique to evade detection.
especially some malware will deactivate their malicious logic if they perceive that they are executed in a monitored environment such as an instr umented emulator .
taintman enables analysts to analyze malware directly on a real device instead of an emulator for ca pturing the hidden malicious behaviors.
in taintman taint tracking code is instrumented into both the target application and the u nderlying system libraries.
with the help of reference hijacking sensitive information flow involving the system libraries can also be effectively tracked and analyzed detailed in section .
these three prototypes have successfully demonstrated that refe rence hijacking does provide a totally effective solution to enfor cing in depth security enhancements for applications of interest on off the shelf devices.
we believe that this study has made an i mportant step to improve the practicability of a large body of secur ity enhancement efforts for android.
in summary our two main contributions are the following.
we present reference hijacking a practicable technique for introducing in depth security enhancements without flashing or rooting android devices.
it has been shown to work well on both the dalvik and art runtime environments and on almost all mainstream android versions .x to .x .
we develop three prototype systems to enforce specific security enhancements based on reference hijacking invol ving patching vulnerabilities enforcing icc access control and performing dta analysis for the target application.
these systems have been successfully deployed on popular devices from different manufacturers.
the evaluation results show that they are effective and do not introduce noticeable system overhead.
.
reference hijacking .
approach overview an android application needs to reference the underlying system components to perform its logic by invoking their provided inte rface methods.
in general the implementations of the underlying system components are stored in system library files including system class libraries and native libraries .
the execution env ironment of an application determines the location from which it seeks and loads the system library files.
in android all applic ation processes are forked from a special process called zygote.
it sets up an initialized execution environment for its child processes in which the system library files will be loaded from designated system folders.
960the goal of reference hijacking is to take control over the reference of an application to the underlying system libraries so that it can be redirected to the security enhanced alternatives.
as illu strated in fig.
by default the target application runs in the ini tialized execution environment in which the target application