learning guided network fuzzing for testing cyber physical system defences y uqi chen christopher m. poskitt jun sun sridhar adepu and fan zhang singapore university of technology and design singapore singapore management university singapore zhejiang university zhejiang lab and alibaba zhejiang university joint institute of frontier technologies china abstract the threat of attack faced by cyber physical systems cpss especially when they play a critical role in automating public infrastructure has motivated research into a wide variety of attack defence mechanisms.
assessing their effectiveness is challenging however as realistic sets of attacks to test them against are not always available.
in this paper we propose smart fuzzing an automated machine learning guided technique for systematically finding test suites of cps network attacks without requiring any knowledge of the system s control programs or physical processes.
our approach uses predictive machine learning models and metaheuristic search algorithms to guide the fuzzing of actuators so as to drive the cps into different unsafe physical states.
we demonstrate the efficacy of smart fuzzing by implementing it for two real world cps testbeds a water purification plant and a water distribution system finding attacks that drive them into different unsafe states involving water flow pressure and tank levels including six that were not covered by an established attack benchmark.
finally we use our approach to test the effectiveness of an invariant based defence system for the water treatment plant finding two attacks that were not detected by its physical invariant checks highlighting a potential weakness that could be exploited in certain conditions.
index t erms cyber physical systems fuzzing testing benchmark generation machine learning metaheuristic optimisation.
i. i ntroduction cyber physical systems cpss are characterised by computational elements and physical processes that are deeply intertwined each potentially involving different spatial and temporal scales modalities and interactions .
these complex systems are now ubiquitous in modern life with examples found in fields as diverse as aerospace autonomous vehicles and medical monitoring.
cpss are also commonly used to automate aspects of critical civil infrastructure such as water treatment or the management of electricity demand .
given the potential to cause massive disruption such systems have become prime targets for cyber attackers with a number of successful cases reported in recent years .
this pervasive threat faced by cpss has motivated research and development into a wide variety of attack defence mechanisms including techniques based on anomaly detection fingerprinting and monitoring conditions or physical invariants .
the practical utility of these different countermeasures ultimatelydepends on how effective they are at their principal goal detecting and or preventing attacks .
unfortunately assessing this experimentally is not always straightforward even with access to an actual cps because of the need for realistic attacks to evaluate them against.
herein lies the problem where exactly should such a set of attacks come from?
one possible solution is to use existing attack benchmarks and datasets as have been made available by researchers for different cps testbeds and as have been used in the evaluation of different countermeasures e.g.
.
across these examples attackers are typically assumed to have compromised the communication links to some extent and thus can manipulate the sensor readings and actuator commands exchanged across the network.
the attacks within these benchmarks however are manually constructed whether by engineers with sufficient expertise in the cps or through invited hackathons to discover new attacks from those without insider bias .
both methods are inherently time consuming and difficult to generalise constructing a similar benchmark for a new cps essentially requires starting from scratch.
in this paper we propose smart fuzzing an automated machine learning ml guided approach for constructing test suites or benchmarks of cps network attacks without requiring any specific system expertise other than knowing the normal operational ranges of sensors.
our technique uses predictive machine learning models and metaheuristic search to intelligently fuzz actuator commands and systematically drive the system into different categories of unsafe physical states.
smart fuzzing consists of two broad steps.
first we learn a model of the cps by training ml algorithms on physical data logs that characterise its normal behaviour.
the learnt model can be used to predict how the current physical state will evolve with respect to different actuator configurations.
second we fuzz the actuators over the network to find attack sequences that drive the system into a targeted unsafe state.
this fuzzing is guided by the learnt model potential manipulations of the actuators are searched for e.g.
with a genetic algorithm and then the model predicts which of them would drive the cps closest to the unsafe state.
our design for smart fuzzing was driven by four key requirements.
first that it should be general in the sense that it can be implemented for different cpss and a variety of sensors and actuators.
second that the approach should 34th ieee acm international conference on automated software engineering ase .
ieee authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
becomprehensive in that the suites of attacks it constructs should systematically cover different categories of sensed physical properties rather than just a select few.
third that it should be efficient with each attack achieving its goal quickly posing additional challenge for countermeasures.
finally that it should be practically useful in that it is straightforward to implement for real cpss without any formal specification or specific technical expertise and that the test suites of attacks are of comparable quality to expert crafted benchmarks thus a reasonable basis for assessing attack defence mechanisms.
to evaluate our approach against these requirements we implemented it for two cps testbeds.
first the secure water treatment swat testbed a fully operational water treatment plant consisting of sensors and actuators able to produce five gallons of drinking water per minute.
second the water distribution w adi testbed a scaled down version of a typical water distribution network for a city built for investigating attacks on consumer water supplies with respect to patterns of peak and off peak demand.
the designs of these testbeds were based on real world industrial purification plants and distribution networks and thus reflect many of their complexities.
we found that smart fuzzing could automatically identify suites of attacks that drove these cpss into different unsafe states involving water flow pressure tank levels and consumer supply.
furthermore it covered six unsafe states beyond those in an established expert crafted benchmark .
finally we evaluated the utility of smart fuzzing for testing attack defence mechanisms by launching it with swat s invariant based monitoring system enabled .
our approach was able to identify two attacks that evaded detection by its physical invariant checks highlighting a potential weakness that could be exploited by attackers with the capabilities to bypass its other conditions.
summary of contributions.
we propose smart fuzzing which to the best of our knowledge is the first general blackbox technique for automatically constructing test suites or benchmarks of network attacks for different cpss.
while fuzzing itself is not a new idea our work differs in its focus on cps actuators and the use of ml models to guide the process and find attacks covering multiple different goals.
we implemented smart fuzzing for two real world cps testbeds identifying attacks that drive them into different unsafe states including six that were not present in an expert crafted benchmark.
using the approach we discovered two potential exploits in an established invariant based monitoring system suggesting the potential utility of smart fuzzing for testing cps attack defence mechanisms.
for researchers our work provides a general way of constructing attack benchmarks for cpss which in turn could be used in the experimental evaluation of novel attack defence mechanisms.
for plant engineers it provides a practical means of assessing a system s robustness against a variety of network attacks spanning several different goals.
for the ml and search communities it demonstrates that existing techniques can be used together to overcome the complexities of real cpss.ii.
b ackground and motiv a tional example here we clarify our assumptions of cpss and fuzzing before introducing our real world cps case studies swat and w adi.
we discuss an example of smart fuzzing on swat.
cpss and fuzzing.
we define cpss as systems in which algorithmic control and physical processes are tightly integrated.
concretely we assume that they consist of computational elements the cyber part such as programmable logic controllers plcs distributed over a network and interacting with their processes via sensors and actuators the physical part .
the operation of a cps is controlled by its plcs which receive readings from sensors that observe the physical state and then compute appropriate commands to send along the network to the relevant actuators.
we assume that the sensors read continuous data e.g.
temperature pressure flow and that the states of the actuators are discrete.
these characteristics together make cpss very difficult to reason about while individual control components e.g.
plc programs may be simple in isolation reasoning about the behaviour of the whole system can only be done with consideration of how its physical processes evolve and interact.
this often requires considerable domain specific expertise beyond the knowledge of a typical computer scientist which is one of our principal motivations for achieving full automation.
fuzzing which plays a key role in our solution is in general an automated testing technique that attempts to identify potential crashes or assertion violations by generating diverse and unexpected inputs for a given system .
many of the most well known tools perform fuzzing on programs e.g.
but in the context of cpss we consider fuzzing at the network level.
in particular we consider the fuzzing of their actuators with commands that did not originate from the plcs and in fact override any valid commands that they are trying to send .
furthermore the goal of our fuzzing differs in that we are trying to drive physical sensors out of their safe ranges using an underlying method that is ml guided.
swat and w adi testbeds.
two cpss that satisfy the aforementioned assumptions and thus will form the case studies of this paper are secure water treatment swat and water distribution w adi testbeds built for cybersecurity research.
swat figure is a fully operational water treatment plant with the capability of producing five gallons of safe drinking water per minute whereas w adi is a water distribution network that supplies consumers with gallons of drinking water per minute.
the testbeds are scaled down versions of actual water treatment and distribution plants in a city and exhibit many of their complexities.
swat treats water across six distinct but co operating stages involving a variety of complex chemical processes such as de chlorination reverse osmosis and ultrafiltration.
each stage is controlled by a dedicated allen bradley controllogix plc which communicates with the sensors and actuators relevant to that stage over a ring network and authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
.
the secure water treatment swat testbed with other plcs over a star network using an ethernet ip protocol specific to the manufacturer.
each plc cycles throughits program computing the appropriate commands to sendto actuators based on the latest sensor readings received asinput.
the system consists of sensors and actuators intotal with sensors monitoring physical properties such as tanklevels flow pressure and ph values and actuators includingmotorised valves for opening an inflow pipe and pumps foremptying a tank .
a historian regularly records the sensorreadings and actuator commands during swat s operation facilitating data logs for offline analyses and machine learning.scada software and tools developed by rockwell automa tion are available to support analysis and experimentation.
w adi consists of three distinct processes each controlled by a national instruments plc.
the first stage consists oftwo litre water tanks which receive water from externalsources.
water from these tanks feed through to two elevatedreservoirs in the second stage which then supply six consumertanks based on a pre set pattern of demand e.g.
peak and off peak usage .
after meeting each consumer s demand water isdrained to the return water tank in the third stage.
this watercan then be pumped back to stage one for re use.
the sensors in both testbeds are associated with manufacturer defined ranges of safe values which in normal operation they are expected to remain within.
if a sensorreports a true reading outside of this range we say thephysical state of the cps has become unsafe.i fal e v e l indicator transmitter for example reports that the tank in stageone has become more than a certain percentage full or empty then the physical state has become unsafe due to the risk ofan overflow resp.
underflow .
unsafe pressure states indicatethe risk of a pipe bursting and unsafe levels of water flowindicate the risk of possible cascading effects in other parts ofthe system.
in w adi unsafe flow levels may also indicate thata particular consumer s water supply has been compromised.
a number of countermeasures have been developed to prevent swat or w adi from entering unsafe states.
ghaeiniand tippenhauer for example monitor the network trafficwith a hierarchical intrusion detection system and ahmedet al.
detect attacks by fingerprinting sensor andmv101 fit101 lit101 p101fit201mv201 lit301 fig.
.
some interconnected components of swat s first three stages process noise.
other approaches learn models from physicaldata logs and use them to evaluate whether or not the currentstate represents normal behaviour or not most e.g.
use unsupervised learning to construct these models although chen et al.
use supervised learning byautomatically seeding faults in the control programs of ahigh fidelity simulator .
adepu and mathur systematically and manually derive a comprehensive set ofphysics based invariants and other conditions that relate thestates of actuators and sensors with any violations of themduring operation reported.
this attack defence mechanism hasbeen successfully deployed in professional swat hackathons detecting out of the physical process attacks devisedby experienced practitioners from academia and industry .feng et al.
also generate invariants but use an approachbased on learning and data mining that can capture noise insensor measurements more easily than manual approaches.
smart fuzzing example.
to illustrate how our approach works in practice we informally describe how it is able to automatically find an attack for overflowing a tank in thefirst stage of swat.
figure depicts the relationship betweensome interconnected components across the first three stages.it includes some sensors level indicator transmitters lits for reporting the levels of different tanks and flow indi cator transmitters fits for reporting the flow of waterin some pipes.
it also includes some actuators motorisedv alves mvs which if open allow water to pass through anda pump p101 which if on pumps water out of the precedingtank.
the physical flow of water throughout this subpart ofthe system is controlled by some inter communicating plcs.if the value of lit301 becomes too low for example the plccontrolling valve mv201 will open it.
furthermore the plccontrolling pump p101 will switch it on to pump additionalwater through causing the value of lit301 to rise.
before launching our smart fuzzer two choices must be made first what is the attack goal characterised as a fitness function and second which search algorithm should be usedto identify actuator configurations that achieve it?
as our goalis to overflow the tank monitored by lit101 we must definea fitness function on the sensor readings that is maximisedas we get closer to overflowing the tank.
a simple functionachieving this takes as input a vector of predicted sensorstates angbracketleftlit101 lit301 ... fit101 fit201 ... angbracketrightand returns simply the value of lit101.
as our search strategy wechoose to randomly search over the space of actuator config urations.
at this point the user has nothing more to set up.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
modelcurrent sensor values s0 s1 s2 ... proposed actuator con fig a0 a1 a2 ... predicted sensor values s0 s1 s2 ... fig.
.
inputs outputs of a learnt model search for actuator configuration maximising fitness functionapply actuator configuration by fuzzing networkunsafe state?noafter fixed time interval yes generate actuator configurationsuse model to predict their effects on the stateapply fitness function on predicted states select fittest con figuration or continue searchingattack found!some search algorithm e.g.
ga random fig.
.
overview of our ml guided actuator fuzzing details of any particular search algorithm are omitted here upon launching the fuzzer several different configurations of the system s actuators are randomly generated.
for each set of configurations a model is used to predict the future sensor readings that they would lead to.
our fitness function is maximised by future states with the highest lit101 readings which in figure would result from a configuration where mv101 is open p101 is off p102 is off and p601 is on as water will be flowing into the tank but the pumps will not be removing it .
note that p102 and p601 are not pictured the former is a backup pump redundancy for p101 the latter is a pump for driving in water from stage .
with suitable actuator configurations identified the relevant commands to apply them are spoofed over the network open mv101 off p101 off p102 and on p601 .
eventually lit101 will enter its upper unsafe range risk of overflow i.e.
the attack goal.
iii.
h ow smart fuzzing works our approach for automatically finding network attacks on cpss consists of two broad steps in turn learning and fuzzing .
in the first step we learn a model of the cps that can predict the effects of actuator configurations on the physical state as summarised in figure .
the model takes as input the current readings of all sensors and a proposed configuration of the actuators returning as output a prediction of the sensor readings that would result from adopting that configuration for a fixed time interval.
the idea is that this model can later be used to analyse different potential actuator configurations and help inform which of them is likely to drive the system closer to a targeted unsafe state.
to learn this model we extract a time series of sensor and actuator data from the system logs and train a suitable machine learning algorithm.
the second step of our approach searches for commands to fuzz the actuators with that will drive the cps into an unsafephysical state.
the sub steps of this part are summarised in figure .
to find the right commands our approach applies a search algorithm over the space of actuator configurations returning the configuration that is predicted by the model of the first step to drive the cps the closest to an unsafe state.
we explore different search algorithms for this task including random but also metaheuristic e.g.
genetic algorithms given that the state space of actuators can grow quite large e.g.
possible configurations in swat .
we use fitness functions to evaluate predicted sensor states with respect to the attack goal.
assumptions.
given that smart fuzzing ultimately is intended to generate attacks for evaluating cps defence solutions it is important to detail our assumptions about systems and attackers thus characterising the kinds of attacks that will be found and just as importantly those that will not be .
in the learning phase of our approach we assume the total integrity of the data that the machine learning models are trained on i.e.
an attacker has not manipulated the learning of the model .
in the fuzzing phase we search for network attacks that could be executed by attackers that are able to compromise the communication links between plcs and actuators.
in particular we assume that attackers can monitor all genuine sensor readings and actuator commands and can also inject arbitrary actuator commands at will controlling their operation independently of any plc.
furthermore we assume that genuine commands originating from plcs can be intercepted and blocked from ever reaching the actuators.
note that while in general we assume a rather powerful attacker it is possible to use our technique with more restricted capabilities too e.g.
particular actuators or stages only in order to test defence mechanisms in a more realistic context see e.g.
section iv b rq5 .
attacks of this kind have been reported in practice e.g.
the discovery that infiltrators had manipulated the valves controlling the flow of chemicals in an industrial water treatment plant .
furthermore our focus on compromised actuators can lead to classes of attacks difficult for control theoretic defences to detect e.g.
.
while our approach searches for attacks based on manipulating actuators it is possible to implement identified attacks in more indirect ways too.
for example instead of spoofing actuator commands over the network one could spoof a sensor reading so that the system will issue the desired command to the actuator itself.
one could also modify some plc code to cause it to issue the same commands thus testing any code attestation mechanisms or could have a user physically interfering with the plant equipment i.e.
testing for insider threats .
a. step one learning a prediction model data collection.
our method requires a dataset from which the relationship between actuators and the evolution of the physical state can be learnt.
a suitable raw format for such data is a time series of sensor readings and actuator configurations recorded at regular intervals during the regular operation of the cps.
the required size of the time series depends upon authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
how many modes of behaviour the system exhibits and how quickly the effects of actuator commands are propagated through the physical state.
in general logs from several days of operation may be sufficient to span enough of the system s normal operational behaviour.
since our method is aimed at engineers or researchers who are seeking to assess the defences of a cps i.e.
not an external attacker we assume that such data is readily available e.g.
from the system s historian.
but in principle it could also be collected by monitoring the network traffic.
the data could also be augmented by injecting manipulations at this stage so their effects can be incorporated into the learning.
we choose not to do this however so as to avoid biasing our approach towards pre determined attacks.
for swat and w adi time series datasets are already available online and were obtained by running the testbeds non stop for seven resp.
days without any interruption from attacks or faults.
the datasets include the states of all sensors and actuators as recorded by the historians every 1s.
training a model.
our method requires a model with the input output relation of figure .
as long as the predictions have a high degree of accuracy however the particular choice of algorithm for learning that model is immaterial.
in this paper we consider two different ml algorithms that are popular and well suited for the particular form of training data a time series of actuator states and continuous sensor values.
first we consider a long short term memory lstm network a deep learning model with an architecture that supports the learning of longer term dependencies in the data.
second we consider a support v ector regression svr model an extension of support vector machines for handling continuous values instead of classification .
to apply these ml algorithms to a dataset the sensor and actuator values must be extracted from the raw logs into a fixed vector format.
as we want to learn the relation between actuator states and the evolution of sensor values a possible form of the vector is angbracketleft angbracketlefts0 s1 s2 ... a a1 a2 ... angbracketright angbracketlefts prime s prime s prime ... angbracketright angbracketright where the sis and ais are the readings states of sensors and actuators at time point t and the s prime is are the readings of the same sensors but at time point t ifor some fixed time interval i. depending on the particular algorithm the sensor values may also need to be normalised.
after extracting as many vectors as possible from the raw data as is typical in learning the algorithm should only be trained on a fixed portion of them e.g.
leaving the remainder as test data for assessing the accuracy of the learnt model s predictions.
for swat and w adi we trained two sets of lstm and svr models using standard python library implementations the keras neural networks api and scikit learn respectively.
we extracted vectors for training from days of the swat dataset and from days of w adi s with vectors from the remaining days reserved for testing the learnt models.
our two lstm models used a traditional architecture consisting of an lstm layer followed by a dense fullyconnected layer and took approximately two days of trainingon a gtx ti gpu for each testbed.
the accuracy of both models was measured as with a tolerance between the actual and predicted values of .
our two svr models took approximately half a day each to train and upon testing their accuracy was measured as for swat and for w adi again with a tolerance of .
we remark that in our swat w adi implementations in addition to learning models able to predict allthe sensor values angbracketlefts prime s prime s prime ... angbracketright we also learnt a series of simpler models that predict only angbracketlefts prime angbracketright o r angbracketlefts prime angbracketright o r angbracketlefts prime angbracketright o r .... these models are useful in later experiments section iv when the fuzzer is attempting to drive one sensor in particular to an unsafe state since they can provide the necessary predictions more efficiently and are also faster to learn minutes on an offthe shelf laptop .
furthermore for svr it allowed us to vary the time interval in predictions for different sensors.
while most were set at 1s as for lstm we found that we needed a larger interval of 100s in svr for the water tank level sensors due to the fact that tank levels change more slowly.
this is only an issue for svr since the architecture of lstm is specially designed to handle long lags between events.
b. step two fuzzing to find attacks fitness functions.
our approach uses fitness functions to quantify how close some predicted sensor readings are to an unsafe state we wish to reach.
intuitively a fitness function takes a vector of sensor values as input and returns a number that is larger the closer the input is to an unsafe state.
the goal of a search algorithm is then to find actuator configurations that are predicted by the lstm svr models to bring about sensor states that maximise the fitness function.
fitness functions are manually defined for the cps under consideration and should characterise precisely what an unsafe state is.
there is a great deal of flexibility in how they are defined it is possible to define them in terms of the unsafe ranges of individual sensors of groups of related sensors or of different combinations therein.
in this paper we perform smart fuzzing using fitness functions for the individual sensors in turn to ensure a suitable variety of attacks and to avoid the problem of a single sensor always dominating e.g.
because it is easier to attack .
defining a fitness function for a single sensor sis straightforward.
if its unsafe range consists of all the values above a certain threshold then a suitable fitness function would be the sensor reading sitself since maximising it brings it closer to or beyond that threshold.
if its unsafe range consists of values below a certain threshold then a suitable fitness function would be the negation of the sensor reading s. a general fitness function can be defined for any group of the system s sensors.
let vsdenote the current value of sensor s lsdenote its lower safety threshold hsdenote its upper safety threshold and rs hs lsdenote its range of safe values.
let ds braceleftbigg min vs ls vs hs ls vs hs otherwise authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
algorithm ga for actuator configurations input v ector of sensor readings s prediction model m fitness function f population size n no.
of parents k mutation probability pm output v ector of actuator configurations 1randomly generate population pofnactuator configurations 2compute fitness of each candidate c pwith f m s c 3repeat select kparents from pusing roulette wheel selection generate new candidates from parents using crossover generate new candidates from parents using bit flip mutation with probability pm compute fitness of new candidates cwith f m s c replace pwith the nfittest of the new and old candidates 9until timeout 10return candidate c pthat maximises f m s c i.e.
the absolute distance of the sensor reading from the nearest safety threshold.
then the fitness function for a set sof the cps s sensors is summationtext s s1 ds rs.
this function tends to infinity as individual sensor readings get closer to either their lower or upper safety thresholds.
in other words the fitness function returns an increasingly large number as the system moves in the direction of an unsafe state.
for swat and w adi we defined fitness functions on a per sensor basis and treated the values above and below these thresholds as two separate cases.
we did this for two reasons first to ensure that smart fuzzing can find attacks that violate each sensor in both ways where applicable and second as it increases the diversity of attacks in cases where it is much easier to attack a sensor in one direction.
we remark that a preliminary investigation found more general fitness functions e.g.
favouring any kind of attack not to be useful for swat or w adi as the attacks found by smart fuzzing were dominated by sensors that were easier to drive to unsafe ranges such as the water flow indicators in the first stage.
searching and fuzzing.
we consider two different algorithms for searching across the space of actuator configurations.
first we consider a simple random search in which several configurations of actuators are randomly generated.
the network is then fuzzed to apply the configuration that is predicted by the lstm svr model to maximise the fitness function.
second we consider a genetic algorithm ga a metaheuristic search inspired by the survival of the fittest principle from the theory of natural selection.
the high level steps of our particular ga for finding actuator configurations are summarised in algorithm .
first a population of actuator configurations is randomly generated.
we assume in this paper that the states of actuators are discrete allowing us to encode each solution as a simple bit vector e.g.
... .
most actuators can only be in one of two states and thus need only one bit in the vector i.e.
0for off 1for on though some actuators e.g.
modulating control valves have more states and need additional bits in the encoding.
next we calculate the fitness of each candidate in the population by applying the lstm svr model then applying the fitness functionto the resulting predicted state.
at this point we enter the main loop in which the fittest candidates are selected for generating offspring from.
we select the candidates using roulette wheel selection which assigns to each candidate a probability of being selected based on its fitness.
if fiis the fitness of one of the ncandidates then its probability of being selected is fi summationtextn j 1fj.
next we sample candidates based on the probabilities using the following implementation.
first a random number is generated between and the sum of the candidates fitness scores.
then we iterate through the population until the accumulated fitness score is larger than that number.
at this point we stop selecting the last candidate as a parent .
we repeat this until we have selected kparents possibly including duplicates .
from the parents we generate new candidates offspring by applying crossover and mutation.
in the former we randomly choose a point in the bit vectors of two parents and swap the sub vectors to the right of it.
in the latter we randomly flip a bit from 0to1or vice versa with some fixed probability pm.
the fitness of all the new candidates is calculated then the nfittest candidates from the old and the new candidates are carried forward as the new population with the other less fit candidates all eliminated.
this iteration continues until a fixed timeout is reached.
the fittest actuator configuration is then returned and the relevant commands to apply it are issued.
for swat implementing the search algorithms was relatively straightforward especially as its actuators consist only of binary states on or off and can be encoded directly as bit vectors.
for w adi the same is true except for its modulating control valve feeds these are set to an integer between and so we encoded their states as bit binary numbers.
for both the random and ga searches we set a timeout of 10s after which the best actuator configuration found so far would be the one that is applied.
while this 10s timeout is clearly longer than the 1s prediction time interval of our models except for the 100s time interval for tank levels in svr the predictions are still meaningful because the physical states of the testbeds evolve so slowly in the meantime.
for cpss that change faster a longer prediction time interval may need to be considered for the search to remain practically useful.
in our ga implementation we set the population size as n number of parents as k and the mutation probability as .
.
these parameters were chosen to ensure that the algorithm will converge before the 10s timeout.
for w adi any mutation that would change a modulating control valve s value to something outside of its range is rejected.
furthermore we cap the maximum number of iterations at if reached before the timeout .
once our random or ga search algorithm identifies the fittest actuator configuration we use the python package pycomm to fuzz the actuators over the network.
as long as the system continues to approach the targeted unsafe state the actuator configuration is held otherwise the search is repeated to identify a more fruitful configuration.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
iv .
e v alua tion we evaluate the effectiveness of smart fuzzing on the swat and w adi testbeds section ii .
a. research questions our evaluation addresses five research questions based on our original design requirements for smart fuzzing section i rq1 efficiency how quickly is smart fuzzing able to find a targeted attack?
rq2 comprehensiveness how many unsafe states can the attacks of smart fuzzing cover?
rq3 setup which combinations of model and search algorithm are most effective?
rq4 comparisons how do the attacks compare against those of other approaches or those in benchmarks?
rq5 utility are the discovered attacks useful for testing cps attack detection mechanisms?
rqs consider whether smart fuzzing achieves its principal goal of finding network attacks.
we assess this from two different angles first in terms of how quickly it is able to drive the cps into a particular unsafe state and second in terms of how many different unsafe states the attacks can cover.
rq considers how different setups of smart fuzzing i.e.
different models or search algorithms impact its ability to find attacks.
rq compares the effectiveness of smart fuzzing against other approaches first the baseline of randomly mutating actuator states without reference to a model of the system and second an established manually constructed benchmark of attacks .
finally rq investigates whether the attacks found by smart fuzzing are useful for testing existing cybersecurity defence mechanisms.
we assess this final question using swat as practical defence mechanisms are more established for this testbed in particular its water defense invariantbased detection solution .
b. experiments and discussion we designed three experiments for the swat and w adi testbeds to evaluate our research questions.
the programs we built to perform these experiments and all supplementary material are available online to download .
experiment rqs .
in our first experiment we systematically target the different possible unsafe sensor ranges in swat and w adi using our tools in four different model search setups lstm ga lstm random svr ga and svr random see section iii .
our goal is to collate the data and obtain an overall picture of how the different ml guided setups perform how quickly targeted attacks are found and how many different unsafe states are covered.
for each of the setups and fitness functions usually two per sensor targeting the lower and upper safety thresholds separately we ran the experiment as follows.
first we reset the testbed by operating it normally until all sensors enter their safe ranges.
upon reaching this state we launch the fuzzer with the given setup and fitness function and let it run without interference for up to minutes long enough to ensure thatover underflow attacks are able to complete .
if the unsafe state targeted by the fitness function is reached within that time we disable the fuzzer and record the time point at which the transition to unsafe state occurred.
if other sensors happen to enter their unsafe states along the way we record this too but do not disable the fuzzer for them.
once the fuzzer is disabled the testbed is allowed to reset and return to a safe state.
we repeat these steps times for every combination of fuzzer setup and fitness function and record the median so as to remove biases resulting from differences in starting states.
for w adi we note that we use slightly different fitness functions for the flow sensors fq fq ... 2fq which monitor the supply of the testbed s consumer tanks.
here the goal is not simply to disrupt the supply of a consumer e.g.
maximising sfor the targeted sensor s but rather to do so without disrupting the supplies of any others.
if targeting the first consumer tank for example this goal is expressed by the fitness function 2fq 2fq201 2fq301 2fq601 which is maximised when the supply of the first consumer tank is cut off while remaining sensitive to any possible unwanted effects on the other tanks.
results.
the results of this experiment are given in the first four rows of tables i and ii.
the rows denote the different smart fuzzing setups whereas the columns denote the different possible unsafe states that were targeted for each sensor.
these include flow indicator transmitters fits fqs which measure water flow in pipes and can become too high or low a differential pressure sensor dpit which can become too high or low and level indicator transmitters lits lts which measure the water levels of tanks and can indicate a risk of overflow or underflow.
we do not include the analyser indicator transmitters aits which measure properties such as ph as the testbeds currently take raw water from the mains i.e.
already close to ph as a result the readings barely vary during the plant s operation.
the numbers indicate the amount of time taken in seconds for a particular fuzzing setup to reach a targeted unsafe state they are the medians obtained from repetitions per combination of fuzzing setup and fitness function.
numbers indicated with an asterisk indicate that one or more repetitions that were unable to reach the unsafe state within minutes.
furthermore indicates that despite approaching the given unsafe state none of the repetitions were able to cross the threshold.
for most of the targeted unsafe states the performance rq1 rq3 of smart fuzzing across the four different setups is essentially the same.
this suggests that for a system of the testbeds complexity having some reasonably accurate prediction model and a lightweight search algorithm e.g.
random is sufficient to identify several attacks.
attacks covering most of the individual sensors can be discovered using an ml model together with a simple search algorithm e.g.
random .
there is one exception to report the lstm ga and svrga setups noticeably outperformed their random variants at driving swat s water tank level sensor lit301 into an unsafe authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
table i results median time taken s to drive sw at sflow d ifferential pressure and level indica tor transmitters into unsafe sta tes flow high flow low pr.
l tanks overflow tanks underflow fit101 fit201 fit601 fit101 fit201 fit301 fit401 fit501 dpit301 lit101 lit301 lit401 lit101 lit301 lit401ml basedlstm ga lstm random svr ga svr random otherrandom no model benchmark table ii results median time taken s to drive w adi into unsafe flow level sta tes and to cut the suppl y of specific consumers fl.
h flow low tanks overflow tanks underflow cut supply of specific consumer3fit 1fit 2fit 2fit 3fit 1lt 2lt 3lt 1lt 2lt 3lt 2fq 2fq 2fq 2fq 2fq 2fq 601ml basedlstm ga lstm random svr ga svr random oth.
random no model state for overflow table i .
in comparison to other sensors there are fewer configurations of actuators that can drive lit301 into its overflow range since the sensor is relevant to four of the six stages they are harder to find by accident as in a random search which we believe is why the fuzzing setups applying metaheuristic search were more performant.
the four fuzzing setups were able to cover the same number of unsafe states rq2 rq3 but with one exception when aiming to cut the supply of specific consumer tanks in w adi table ii we found that the ml random setups failed on all counts whereas ml ga could succeed across all sensors.
if attacks can only occur under strict conditions then a more sophisticated search algorithm e.g.
ga is necessary.
w adi s tank level sensor lt is a special case in table ii all four setups can generate the actuator commands necessary to cause an underflow.
however it takes too long to repeat the experiments as once drained it takes a very long time for the tank in this phase to return to its normal range.
our experiments were performed for svr ga only but since the other setups all found the right actuator configuration immediately we would expect to see similar results.
for some tank level sensors smart fuzzing approached but did not cross the over underflow thresholds.
one reason might be that during the learning stage not enough data was observed that was relevant to the evolution of those sensors leading to a poorer prediction model.
in future work we will address this by either fuzzing the actuators during the learning stage so that the model can train on some additional abnormalbehaviours or by using an online learning scheme in which the model is updated over time as more data is observed.
some sensed properties were not possible to attack at all and are excluded from the table e.g.
the pressure sensor pit501 which was suffering a hardware fault at the time of experimentation.
experiment rq .
our second experiment seeks to compare the results of our smart fuzzing setups against those of other approaches.
as we are unaware of any existing tools we can make a direct comparison with we instead make a comparison against two different baselines.
first we compare against an automatic approach in which all of the smartness is removed and commands to the actuators are simply generated and applied randomly without reference to any prediction model for the testbed in contrast to lstmrandom and svr random .
second and in contrast we compare against the attacks of an established expert crafted benchmark for swat only which were systematically derived from an attack model.
for the different attacks derived from these two sources this experiment is roughly similar to the first launch them and record which sensors are driven into unsafe ranges and at which time points .
the idea of the experiment is to establish where the effectiveness of smart fuzzing can be positioned between two extremes a simplistic uninformed search on the one hand and an expert crafted comprehensive benchmark on the other.
we ran the experiment as follows.
for the random baseline we wrote a program to randomly generate distinct sets of actuator configurations.
for each set in turn we begin by authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
resetting swat to a normal state using the same procedure as the previous experiment.
once in such a state we then fuzzed the network to override the actuator states with the given random configuration for minutes.
if during the run any sensor readings were driven into an unsafe range we recorded the sensors and ranges in question and the time points at which they first became unsafe.
after the run the system was allowed to reset before repeating the process for the other randomly generated configurations.
for the benchmark we manually extracted all attack sequences that were intended drive the system into unsafe physical states.
for each of these six attacks in turn we fuzzed the network manually to recreate the attack sequence overriding the sensor and actuator states as prescribed by the benchmark.
if during the run any actual sensor readings were driven into an unsafe range we recorded the sensors and time points at which they first became unsafe.
this was repeated times for each attack sequence.
results.
the results of this experiment are given in the bottom rows of tables i ii.
the numbers indicate the time at which sensor entered an unsafe state for the first time.
for random no model they are the medians across runs for randomly generated actuator configurations for benchmark they are the medians across repetitions for each of the six attacks that target some unsafe state.
the dashes indicate which sensors never reached an unsafe state.
in comparing these numbers with smart fuzzing rq4 i t appears that our approach drives more of the sensors to unsafe states and does so faster .
the comparison with random no model makes clear that most of the attacks are not possible to find by accident or just by simply fuzzing at random without any artificial or human intelligence.
at the other end the comparison with the swat benchmark illustrates that smart fuzzing was able to drive the system to six additional types of unsafe states that were not covered by the benchmark.
having said that the benchmark does include several attacks of the kind we do not consider e.g.
manipulating a sensor or actuator but without the goal of reaching an unsafe state and while its comparable attacks were slower than those of smart fuzzing efficiency was not necessarily a goal.
the comparison does however suggest that our approach could complement the benchmark and improve its comprehensiveness.
smart fuzzing complemented an established benchmark by covering six additional unsafe states.
experiment rq .
our final experiment explores by means of a case study whether smart fuzzing may have some utility for testing the attack defence mechanisms of cpss.
as these mechanisms are less established for w adi e.g.
forced logic between actuators which our method could easily overcome we considered swat s water defense wd solution which has demonstrated its efficacy many times in the past e.g.
detecting attacks at professional swat hackathons .
this attack detection mechanism is based on monitoring several different expected conditions and invariantsof the system and highlighting to the operator whenever one of them is violated.
broadly speaking wd monitors two kinds of properties state dependent conditions and physical invariants .
state dependent conditions define expected relationships between sensors and actuators e.g.
if motorised valve mv101 is open then the flow indicator fit101 must be non zero .
physical invariants are properties that are expected to always be true of a system behaving normally i.e.
they mathematically characterise the physical process.
in this case study we aimed to systematically drive each sensor in swat towards an unsafe state while avoiding detection by the monitors of wd.
for a more fine grained assessment of the attack detection mechanism we used it with all checks enabled only state dependent conditions enabled and only physical invariants enabled.
using our svr ga setup and each fitness function in turn we ran our tools until either driving the targeted sensor to an unsafe state or violating an invariant.
this was repeated for all fitness functions and all three modes of the wd system.
we remark that in this experiment the search algorithms were constrained to manipulating only the actuators within stage s of swat relevant to the targeted sensor.
this was to reduce the possibility of unnecessarily triggering alerts from stages that were not directly relevant to the target of the attack.
results.
we found that when enabling all checks in wd or only the state dependent conditions smart fuzzing was unable to successfully attack swat without detection.
this is unsurprising as the attack detection mechanism is especially effective at detecting process attacks at the recent swat hackathon comprising teams from industry and academia wd was able to detect all but one of the process attacks involving valve or pump manipulations and more of the attacks than the industry teams assigned to system defence .
however smart fuzzing was able to successfully attack two sensed properties fit501 low and fit601 high without detection by the physical invariants .
this weakness in the physical invariants could potentially be exploited by a real attacker if they are able to spoof the sensor and actuator values considered by the state dependent conditions.
attack .
the first attack targeted the flow sensor fit501 in stage five of swat reverse osmosis process .
the flow sensor is associated with the two high pressure pumps p501 and p502 that pump the water in from stage four.
prior to launching the attack p501 was on and p502 was in standby.
to achieve the goal of decreasing the flow of fit501 smart fuzzing automatically generated and launched the following simple attack over the star network of swat turn off pump p501 turn off p502.
within about seconds the flow through the pipes reduces to zero and fit501 enters an unsafe state.
the physical impact of this attack is a reduction in reverse osmosis production with possible effects from the reduction cascading through the system.
attack .
the second attack targeted the flow sensor fit601 in stage six of swat which is a backwash process that is intrinsically linked with the other stages.
it stores purified water from stage five ready to be recycled back into stage authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
one it also stores rejected water from stage five ready to be pumped to clean the ultra filtration of stage three.
to achieve the goal of increasing the value of fit601 smart fuzzing automatically generated and launched the following attack over the star network of swat open the motorised valves mv301 mv302 mv303 mv304 turn on the pumps p601 and p602 and ensure p301 and p302 are in the same state.
this actuator configuration increases the flow of fit601 beyond acceptable levels from the moment the valves are opened.
at this stage there are further physical consequences of the attack depending on whether smart fuzzing chose to turn both p301 and p302 off or left them both on.
in the former case ultra filtration is stopped completely but water continues to arrive from the backwash leading to a reduction of output for the process.
in the latter case ultra filtration is still operating but the increase in flow from the backwash stage leads to the pressure increasing beyond the normal operating values.
from running the fuzzer through to reaching the unsafe state the attack takes approximately seconds.
smart fuzzing discovered two attacks that evaded detection by the physical invariant monitors of the established water defense mechanism for swat.
c. threats to v alidity finally we remark on some threats to the validity of our evaluation.
first our approach was implemented for cps testbeds while they are real fully operational plants based on the designs of industrial ones they are still smaller and our results may therefore not scale up this is difficult to test due to the confidentiality surrounding plants in cities .
second the initial states of the testbeds were not controlled other than to be within their normal ranges meaning that our performance results may vary slightly.
finally for testing cps attack detection mechanisms we only studied an invariantbased solution meaning that our conclusions may not hold for other types of defences to be addressed in future work .
v. r ela ted work in this section we highlight a selection of the literature that is particularly relevant to some of the main themes of this paper constructing attacks fuzzing and assessing robustness.
we remark that related works on attack defence mechanisms are discussed earlier in the paper in section i with some mechanisms specific to swat w adi discussed in section ii.
a number of papers have considered the systematic construction orsynthesis of attacks for cpss in order to test or demonstrate flaws in some specific attack detection mechanisms.
liu et al.
for example target electric power grids which are typically monitored based on state estimation and demonstrate a new class of data injection attacks that can introduce arbitrary errors into certain state variables and evade detection.
huang et al.
also target power grids presenting an algorithm that synthesises attacks that are able to evade detection by conventional monitors.
the algorithm based on ideas from hybrid systems verification and sensitivity analysis covers both discrete and continuous aspects of the system.urbina et al.
evaluate several attack detection mechanisms in a comprehensive review concluding that many of them are not limiting the impact of stealthy attacks i.e.
from attackers who have knowledge about the system s defences and suggest ways of mitigating this.
sugumar and mathur address the problem of assessing attack detection mechanisms based on process invariants their tool simulates their behaviour when subjected to single stage single point attacks but must first be provided with some formal timed automata models.
c ardenas et al.
propose a general framework for assessing attack detection mechanisms but in contrast to the previous works focus on the business cases between different solutions.
for example they consider the cost benefit tradeoffs and attack threats associated with different methods e.g.
centralised vs. distributed.
fuzzing has been a popular research topic in security and software engineering for many years but the goals of previous works tend to differ from ours which is a general approach tool for discovering cps network attacks.
fuzzing has previously been applied to cps models but for the goal of testing them rather than finding attacks.
cyfuzz is one such tool which offers support for testing simulink models of cpss.
american fuzzy lop targets programs and uses gas to increase the code coverage of tests and find more bugs.
cha et al.
also target software using white box symbolic analysis on execution traces to maximise the bugs it finds in programs.
a number of works e.g.
have targeted the fuzzing of network protocols in order to test their intrusion detection systems.
in contrast our work starts from the assumption that an attacker has already compromised the network and uses ml guided fuzzing to find the different ways that such an attacker might drive the system to an unsafe state.
the attacks that it uncovers then form test suites for attack detection mechanisms.
there are more formal approaches that could be used to analyse a cps and construct a benchmark of different attacks.
however these typically require a formal specification which if available in the first place may be too simple to capture all the complexities in the physical processes of full fledged cpss.
kang et al.
for example construct a discretised first order model of swat s first three stages in alloy and analyse it with respect to some safety properties.
however the work uses very simple abstractions of the physical processes and only partially models the system we consider all of it without the need for any formal model .
castellanos et al.
automatically extract models from plc programs that highlight the interactions among different internal entities of a cps and propose reachability algorithms for analysing the dependencies between control programs and physical processes.
mclaughlin et al.
describe a trusted computing base for verifying safety critical code on plcs with safety violations reported to operators when found.
etigowni et al.
define a cps control solution for securing power grids focusing on information flow analyses based on potentially verifiable policy logic and symbolic execution.
beyond these examples if a cps can be modelled as a hybrid system there are authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
several formal methods that can be applied to it including model checking smt solving non standard analysis process calculi concolic testing and theorem proving .
defining a formal model that accurately characterises enough of the physical process and its interactions with the plcs is however the hardest part.
smart fuzzing in contrast can achieve results on real world cpss without the need for specifying a model at all it learns one implicitly and automatically from the data logs.