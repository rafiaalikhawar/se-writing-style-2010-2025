mobiplay a remote execution based record and replay tool for mobile applications zhengrui qinyyutao tangyed novak qun li department of computer science the college of william and mary williamsburg va usa zhengrui yytang ejnovak liqun cs.wm.edu yzhengrui qin and yutao tang are co first authors abstract the record and replay approach for software testing is important and valuable for developers in designing mobile applications.
however the existing solutions for recording and replaying android applications are far from perfect.
when considering the richness of mobile phones input capabilities including touch screen sensors gps etc.
existing approaches either fall short of covering all these di erent input types or require elevated privileges that are not easily attained and can be dangerous.
in this paper we present a novel system called mobiplay which aims to improve record and replay testing.
by collaborating between a mobile phone and a server we are the rst to capture all possible inputs by so at the application layer instead of at the android framework layer or the linux kernel layer which would be infeasible without a server.
mobiplay runs the to be tested application on the server under exactly the same environment as the mobile phone and displays the gui of the application in real time on a thin client application installed on the mobile phone.
from the perspective of the mobile phone user the application appears to be local.
we have implemented our system and evaluated it with tens of popular mobile applications showing that mobiplay is e cient exible and comprehensive.
it can record all input data including all sensor data all touchscreen gestures and gps.
it is able to record and replay on both the mobile phone and the server.
furthermore it is suitable for both white box and black box testing.
keywords mobile application record and replay google android virtual machine secure virtual mobile platform.
.
introduction mobile phones have been increasingly popular in recent years with nearly two billion users worldwide and milpermission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
icse may austin tx usa c acm.
isbn .
.
.
.
of applications apps are available in each of the substantial platforms.
as new technologies such as various sensors and other rich resources are adopted by mobile phones the user experience is greatly enhanced.
however at the same time these new features have imposed challenges on application design and testing for developers.
nowadays running an app may involve multiple input sources touchscreens swiping pinching zooming click tapping sensors gps accelerometer compass gyroscope and networking online gaming websites bluetooth to name a few.
therefore it is challenging for developers to test and debug mobile apps since it is non trivial to accurately record the data from all these inputs as well as the interaction among different components involved in the app.
even after the input has been recorded it is then challenging to replay the app execution using the recorded data.
while a handful of record and replay tools have been developed for mobile apps they are far from perfect.
as one of the key technologies in software engineering the record and replay approach to software testing has played an important role in the development of mobile apps.
recordand replay is a necessary and valuable tool for mobile app development because it allows developers to easily nd and recreate elusive and complex bugs test outlier cases and increase the speed of testing software by automating the process.
record and replay improves software in the testing debugging optimization and upgrading phases.
however we face several challenges in implementing such a system on mobile devices.
considering the rich input capabilities of mobile phones and the real time interaction between the mobile app and the user the challenges are as follows.
first it is di cult to accurately record an application s continuous execution instead of some discrete actions.
second it is hard to record all the input data which is especially true for sensors such as the gps.
third it is preferable that all recorded data is human readable such that developers can easily analyze revise and re assemble the recorded data in order to accurately locate and identify bugs or performance bottlenecks.
finally it may be possible to modify the mobile phone operating system os to achieve record and replay functionality.
however modifying the os requires a device with an unlocked bootloader and an open source operating system.
unlocking the bootloader is impossible on some devices due to manufacturer obstacles di cult and usually erases all user data on the device.
modifying the operating system may introduce bugs and is di cult in general requiring access to any proprietary closed source components ieee acm 38th ieee international conference on software engineering from the original.
in recent years researchers have designed and developed several replay tools for mobile apps.
however none of them are able to truly capture all possible input.
these tools can be divided into several categories.
the rst category is tools that obtain the input data by reading dev input event les through the android sdk getevent tool e.g.
reran and mosaic .
although these tools can record continuous gestures on the touchscreen swipe move pinch zoom they come with several drawbacks.
first they entirely depend on whether the mobile phone s os provides interfaces to dev input event which is not always the case.
for instance the nexus does not push any sensor data into any dev input event le.
second they are unable to record sensors whose events are made available to applications through system services rather than low level event interfaces such as gps.
third they can only obtain the event data in low level hexadecimal codes e.g.
dev input event4 0000011f which is not human readable hindering developers from white box testing.
fourth they have potential con icts with other events occurring during a replay session.
another category is guilevel tools such as .
they work at a higher level of abstraction by capturing gui objects and usually require app modi cation e.g.
android debuggable true .
though they work well for discrete point and click guis they cannot handle continuous touchscreen gestures or customized gui elements.
a straightforward question is can we solve all the problems and challenges within the mobile phone alone without modifying the operating system?
unfortunately the answer appears to be no.
for security concerns mobile operating systems such as android sandbox apps in order to provide applications with the guarantee of isolation from other applications on the system.
each application has its own uid that prevents it from many things to other applications on the system.
if we are to record all the input data for an app we would have to develop a second app without using any existing tools such as the android sdk getevent tool.
however as the android application sandbox has enforced the second recording app cannot access any data or memory of the app to be recorded.
therefore we have to introduce other component rather than the mobile phone alone to solve this problem.
in this paper we design a system called mobiplay to record and replay an android app s execution by introducing a server.
the to be tested app is actually running on the server while its gui is transmitted back to the mobile phone as if the application were running locally on the phone.
although it may seem that latency would be a large concern in this setup we nd that the latency is acceptable due to the high speed peer connection and the proximity of the server we evaluate on a lan connection .
we have a video of mobiplay on youtube search mobiplay .
without modifying the mobile phone s operating system mobiplay is able to record all sensor data inputs for replay later in the form of high level events such as touchscreen gesture key event and sensor event.
besides solving the existing problems and challenges we outlined previously mobiplay is also able to o er more exibility than ever before.
it can not only record all input data on both the mobile phone and the server side but it can also replay the app on both sides as well.
furthermore our system is suitable for bothwhite box testing and black box testing.
in summary in this paper we make the following main contributions we are the rst to record input data of mobile apps in the application layer without modifying mobile phone s operating system which is not achievable with the previous state of the art approaches.
we have designed and implemented mobiplay a system that is able to record and replay the execution of mobile apps.
our system is richer than ever before because it is able to record all sensor data input.
mobiplay is able to simulate the same environment on the mobile phone and the server which fundamentally expands the space of exibility.
mobiplay is exible in that it can record and replay on both the client mobile phone and server side.
our system enables white box testing for app developers because it exposes high level semantic events and presents them in a human readable form instead of an encoded stream of raw hexadecimal event data.
the rest of the paper is organized as follows.
we present the whole system in section and describe the implementation in section .
section details the evaluation of mobiplay.
section brie y discusses the limitations and future work.
we review the related work in section and conclude our paper in section .
.
design of mobiplay in this section we will rst elaborate on the rationale behind our design decisions.
then we will explain our system design its general architecture and the details therein.
finally we will explain the input data recording and replaying in our system.
.
design rationale as mentioned in section we have to coordinate work between the user s mobile phone and an external server to solve all of our design challenges.
here we further illustrate why the mobile phone alone cannot solve this problem and why a server is indispensable.
figure shows the logical ow of application input data.
suppose the user makes a os modification dev input event dedicate app ?
mobile phone hardwarelinux kernelandroid frameworktarget appapp for data interception figure app input data ow within a mobile phone no server .
gesture on the touchscreen tap swipe pinch zoom etc.
.
first the touchscreen hardware captures this gesture converts it into digital data and informs the linux kernel by 572sending an interrupt to the cpu.
second after receiving the interrupt the os stops the current job reads the input data with the corresponding driver and sends the data to the android framework.
third the android framework packages the data into discrete events motionevent and sends them to the related service such as sensor service input method service or location service at the same time it sends the data to dev input event as well in the form of hex codes.
finally the related service sends the discrete events to the application running on the foreground.
reran and mosaic obtain the app input data by reading dev input event les in the android framework and os modi cation occurs in the android framework as well.
from figure we can see that the only other possible location to record app input data without modifying the os is in the application layer.
in order to do this one must develop another application speci cally dedicated to intercepting the input data that is actually destined for the target application.
however this is forbidden by the android application sandbox as well as the sandbox policy in other mobile operating systems which guarantee that unsanctioned data sharing between applications is not possible.
as a result the dedicated data intercepting app cannot access any data or memory of the target application.
therefore it is clear that a mobile phone alone cannot solve the challenges and problems that the current approaches have encountered.
to overcome this isolation obstacle we introduce a second component i.e.
a sever.
.
architecture of mobiplay in this paper we design mobiplay a client server system consisting of a mobile phone and a server as shown in figure .
the server and the mobile phone are connected through a high speed network connection like 300mbps to 1gbps.
network mobile phone remote serverclient apptarget app android frameworkandroid framework hardwarelinux kernelvirtual machine linux kerneltouch screen graphics sensors gpsinput systemlocal app figure mobiplay consists of a mobile phone and a server.
in mobiplay there are two components associated with the application to be recorded and replayed the target app hereafter a client app on the mobile phone and a virtual machine vm on the server.
the target app runs on the vm on the server.
the client app the client hereafter is a typical android app that does not require root privilege and is dedicated to intercepting all the input data for the target app.
the vm is a duplicated mobile phone on the server which has the same con guration as the physical mobile phone including screen size resolution and all present sensors.
the vm runs a modi ed android operating system designed for x86 architecture.
it is important to note thatthe tester user has complete control over the server including the modi ed android operating system speci cally she has root privileges has access to modify and recompile the os source code is able to make con guration changes etc.
the basic idea of mobiplay is that the target app actually runs on the server while the user interacts with the client app on the mobile phone.
the user is not explicitly aware that she is in e ect using a thin client.
at the beginning we install the target app on the virtual machine on the server and the client on the mobile phone.
the client shows the gui of the target app in real time on the mobile phone exactly as if the target app were running on the mobile phone.
as a result the user just needs to interact with the target app as usual while under the surface the client continuously forwards all input data such as touchscreen gestures sensor data and gps to the vm on the server.
at the same time the gui of the target app on the server is forwarded to the client and is then displayed by the client on the mobile phone.
the vm on the server injects the input data received to the related os services which in turn send it to the target app.
the target app runs on the virtual machine with the injected input data exactly same as it would run on the mobile phone.
in other words the user runs the app with exactly the same experience as if the app had been running on the mobile phone.
the target app actually runs on the virtual machine on the server but with the same environment inputs resolution screen size etc.
as if it had been running on the mobile phone.
mobiplay has three modes normal record replay .
when the client is opened the graphical interface presents three buttons to the user and the user must choose one of the three modes before establishing a connection with the server.
in the normal mode mobiplay runs without any data recording or data replaying.
that is the user of the mobile phone runs the mobile app on the server while interacting with the local client app.
the mobile user can use this mode to test mobiplay.
another possible application scenario for this mode might be that the mobile user wants to o oad a resource hungry app to the much more powerful server.
in record mode mobiplay intercepts all input data through the client app as the target app runs on the server.
the collected data is stored on disk.
a user con guration option allows for the data to be stored on the phone or the server or both.
in the replay mode mobiplay rst con gures where to read data phone or server where to replay phone or server and the test type black box or white box .
then it reads the input data from disk injects the input events in the same order into the target app running on the chosen device and replay the target app.
during the replay mobiplay does not process any local android service request such that the target app is replayed with the recorded input only.
this avoids any interference from the current state such as new gps or accelerometer data .
in the following we will describe the data recording and the app replay mechanisms in more detail.
.
app recording when the user chooses record mode mobiplay will be directed to record all input data for replay later.
mobiplay can record all input data for the target app on both the mobile phone and the server.
as illustrated in figure all input data for the target app passes through the client app on the mobile phone.
therefore the client is able to 573intercept all this data.
at the same time since all the input data is transmitted to the server and the user has full control of the server the data can be intercepted and recorded there as well.
figure shows how the data is intercepted and stored on both sides.
on the phone side all the data is intercepted in serialization deltanetworkmobile phone server request mrequestclass int64 delta ... ... motionevent keyevent location rotation sensoreventrequest inputlog diskrequest inputlogapp figure mobiplay records input data on both the mobile phone and the server.
the form of events such as motion events key events location rotation sensor etc.
and each event is an object that contains the input information at a certain point of time.
mobiplay extracts useful information from each event and stores it in a structure called request.
mobiplay also obtains the time intervals between each pair of consecutive events and stores this information together with the requests in order in the log.
the log itself is a class called an inputlog which is a collection of request objects.
finally the entire inputlog instance is written to disk on the mobile phone.
at the same time all requests are transmitted through the network to the server in order to be fed into the target app.
thus mobiplay is able to record all input data on the server side as well.
once the target has nished running i.e the recording procedure has completed mobiplay quits to the gui with three modes for selection.
one prominent advantage of this architecture is that our recorded data is high level readable and revisable.
this is incredibly valuable for app developers when trying to recreate and x bugs in their code caused by speci c infrequent input.
.
app replaying when the user chooses replay mode mobiplay will load the recorded data from the disk and replay the target app.
the replay procedure is illustrated in figure .
the replay procedure for the white testing on the mobile phone is similar to that on the server and neither of them needs root privilege.
however the replay procedure for the black box testing on the mobile phone is di erent from that on the server.
in case on the phone the black box testing still requires root privilege since the input data has to be injected through dev input event les.
as figure shows rst mobiplay loads the input data from the disk of either the server or the mobile phone.
second the input data stored on disk as an inputlog class is unpacked into a sequence of request i.e.
events .
third a for black box testing on the server the sequence of events is sent to virtual devices on the vm which then inject events to the target app for replay b for white box testing on the server the input events is injected to the target app through android testing framework and event emulator c for white box testing on the phone it is same as the white dev input event eitherserver s disk phone s diskandroid testing framework event emulatorblack box white box white box black boxphoneserver inputlog requestmotionevent keyevent location rotation sensoreventfigure mobiplay can relay an app on both mobile phone and server black box and white box testing respectively.
box testing on the server d for black box testing on the phone the events is converted into hex codes and fed into the corresponding dev input event les where the target app read the input data for replay.
after the replay has nished mobiplay quits to the gui with three modes for selection.
mobiplay is advantageous in that app developers can revise the input data as they want to test the app in di erent scenarios.
this is much easier than re running the app multiple times to collect input data hoping for good test coverage from all types of input.
.
implementation in this section we present our implementation of mobiplay.
we establish the client server platform by leveraging the secure virtual mobile platform svmp and then we build the record and replay approaches on basis of svmp.
.
physical devices in principle mobiplay only consists of a mobile phone or a tablet and a server by utilizing the existing networking infrastructure.
in our implementation besides the phone and the server a router is used to set up the wireless connection between the server and the phone.
the characteristics of all these devices are listed in table .
table the devices used in mobiplay system.
device speci cation android phone samsung galaxy s4quad core .6ghz cortex a15 quad core .2ghz cortex a7 2gb ram gb microsd android os v5.
.
android tablet nexus 2013quad core .5ghz krait 2gb ram 32gb storage android os v4.
.
server y480 lenovo laptop2.4ghz intel i7 3610qm 8gb ram gb hd ubuntu .
router tp link tl wr841n300mbps additionally the server uses virtualbox1as the vm hypervisor and uses a virtual bridged network adaptor for networking access.
the vm con guration allocates mb 574ram an core processor and 5gb disk storage space.
and the vm runs android os v4.
.
.
.
the client server platform in mobiplay the essential component is the client server platform which we implement using svmp.
svmp is a secure mobile application platform developed by mitre2 based on thin client technology and cloud computing technology.
an open source virtual smartphone svmp runs an android based mobile operating system on a cloud platform.
in the big picture we utilize svmp to create a virtual machine on the server where the target mobile app actually runs and an svmp client on the mobile phone where the gui of the app is displayed in real time.
the client and the virtual machine are connected through a wireless network in our setup which is common for mobile devices.
.
.
svmp client the svmp client is installed on the mobile phone as a normal mobile application.
the client simple and unprivileged is associated with the vm on the server rather than the target app.
that is when we test multiple apps we just need to install each app in turn on the vm without making any changes to the client.
while mobiplay runs in normalorrecord mode the client captures native touch screen events sensor inputs like the accelerometer and gyroscope location information and messages such as noti cation popups and android intents .
all these data is packaged under the svmp message protocol and is sent from the client to the server in real time.
at the same time the client displays the gui of the target app transmitted from the server.
in a word the client enables the user to interact with the target mobile app running on the server in the same way as if the app had been running on the mobile phone.
.
.
svmp virtual machine the svmp vm is installed on the server.
on top of the vm is the android framework where the target app is installed.
the vm provides virtual devices including touch screen sensors gps and graphics which can be seen in figure .
the rst three virtual devices are responsible for feeding the input data as captured on the client side to the target app running on the vm.
as the target app runs its gui is displayed on the virtual display i.e.
graphics.
the vm in turn packages whatever is displayed on graphics and sends it to the client in real time.
it is important for mobiplay to maintain the same environment on the vm as that on the mobile phone including the screen size the resolution and all the input devices.
for instance if the screen size is di erent the touchscreen gestures will be represented with coordinates that are incorrect or even unde ned on one of the displays.
in our implementation we ensure that no device mismatch occurs in our system to avoid problems like these.
.
.
networking it is critical to maintain a high speed network connection between the mobile phone and the server otherwise the user experience of mobiplay will be impacted.
the network is responsible for transmitting the input data from the client on the phone to the vm on the server and the gui the target app from the vm to the client in real time.
as the mobile phone does not have a wired network option we set up a wireless network using a tp link tl wr841n router which can provide connectivity with throughput up to 300mbps.
fortunately svmp uses webrtc3to transmit data between the phone and the server which greatly reduces the latency and the data volume.
this is especially useful for situations where there may only be a slower network connection option available.
in our implementation mobiplay maintains a frame rate of fps.
.
the record approach as mentioned in section .
mobiplay is able to record the input data in order to replay it later on both the mobile phone and the server.
here we detail the implementation of the recording procedure.
on the mobile phone side the client in mobiplay intercepts all input data for the target mobile app in the form of events which are grouped into ve categories motionevent keyevent location rotation and sensorevent please refer to figure .
each event is an object containing the input information at a certain time.
after intercepting an event the client extracts only the necessary information for replay and creates a data structure called arequest to store it.
the client also calculates the time interval between two consecutive events.
the event information and the time interval are then logged in an inputlog class which stores a collection of request objects.
finally the inputlog is serialized and stored on disk.
note that we de ne the inputlog class via google s protocol bu er4 which is a language neutral platform neutral extensible and automated mechanism for serializing structured data.
the data stored in inputlog can be easily converted to json or xml format which is human readable.
in the following we will describe the interception of each of the ve categories of events.
.
.
motionevent for most mobile apps the most frequent input data is touchscreen events including tap press and hold pinch zoom swipe etc.
the android framework uses the motionevent class to record each touchscreen event.
motionevents describe movement in terms of an action code and a set of axis values.
the action code speci es the state change such as a pointer going down or up.
the axis values describe the position and other movement properties.
motionevents occur representing all possible touchscreen actions such as action down action move action up the time the coordinates and any historical event that happens before the current event.
for the purpose of efciency android may batch multiple touchscreen events into a single movementevent with several movement samples and an action move action code.
motionevents are passed as a paramenter into the ontouchevent method which is triggered by android framework when a touch gesture happens.
the top panel of figure shows all the elds of the class motionevent which mobiplay intercepts and records.
.
.
sensorevent ers docs overview 575pointercoords id x y historicalevent eventtime pointercoords motioneventaction downtime eventtime edgeflags sensortype accuracy timestamp values sensorevent keyeventeventtime deviceid flags downtime action code repeat metastate scandode source charactersfigure the motionevent sensorevent and keyevent classes along with their associated elds.
in the android framework sensor data is represented in the sensorevent class and as each sample occurs a sensorevent instance is sent to the app by the sensor service.
each sensorevent contains four elds sensor type time accuracy and the new data value s as shown in the middle panel of figure .
in our implementation mobiplay can support the following physical sensors accelerometer gyroscope light sensor magnetic sensor pressure sensor proximity sensor and virtual sensors gravity linear acceleration orientation and rotation vector .
sensor events are intercepted by onsensorchanged method in the client app.
.
.
keyevent keyevent is used to report key and button events and is intercepted by the dispatchkeyevent method.
each key press is described by a sequence of key events.
all information for these events is listed in the bottom panel of figure .
.
.
location one advantage of our mobiplay system is that it can handle location data i.e.
gps which other current approaches such as reran and mosaic cannot.
mobiplay utilizes the locationlistener class to intercept location information.
locationlistener has four methods each of which has several input parameters as listed in figure .
whenever changes have been made to the location android framework will trigger the locationlistener to notify the target app.
at the same time it intercepts and records all these parameters.
onproviderenabled providerproviderprovider status bunletime latitue longitude accuracy altitude bearing speed provider locationlisteneronlocationchanged onstatuschanged onproviderdisabled figure the class locationlistener and its four methods with the corresponding parameters.
.
.
rotation mobiplay can record device rotation changes as well.
if the app runs on the mobile phone whenever any rotation change is detected the android framework will notify the app and trigger the gui to change from portrait toland scape or vice versa.
the advantage of this design is that the app itself does not need to monitor the orientation of the gravity sensor which eases work for developers who only need to maintain the state of their gui when transitioning between view orientations.
in mobiplay however the target app will not obtain any rotation event because the target app is running on the server and the android framework on the server will not detect any rotation change.
to solve this problem mobiplay collects all rotation events by leveraging onorientationchanged in the client app on the mobile phone.
besides black box testing these events are also useful in white box testing because we can use these events to change the screen orientation.
the rotation event has only one parameter orientation ranging from to degrees.
speci cally degrees means that the device is oriented in its natural position degrees means its left side is at the top upside down and indicates the right side is on top.
when the device is nearly at parallel with the ground the orientation cannot be determined and orientation unknown will be returned.
for e ciency mobiplay does not record this undetermined case.
it is worth pointing out that reran cannot handle rotation events.
.
the replay approach mobiplay is able to replay a mobile app on both the server and the phone for both black box testing and white box testing.
in the following we will rst present the procedure of the replay on both sides.
note that in the replay duration mobiplay does not process any new input from local android services in order not to interfere the replay though it still can receive them from local android services it does not send it to the app.
we then will describe an eventsampling technique to revise the replay data as the tester wants.
.
.
replay on the server the replay procedure for black box testing on the server is quite similar to what happens on the server in the normal mode except the input is read from the log stored on disk instead of from the client directly.
also all concurrent input from mobile phone is discarded.
the input data can be injected from either the disk of the mobile phone or that of the server.
at the beginning the user sets the mobile phone in replay mode.
when the client detects that the mobile phone is currently in replay mode it will load the corresponding input data from disk and store it in an inputlog class which has the same form as the class used in data recording by calling the parsefrom method in the google protocol bu ers.
the events are simply injected into the system via the virtual devices.
to replay the app correctly it is of the utmost importance to keep the events in the correct order.
as mentioned in the data recording procedure the recorded data includes all the information of every event and the interarrival time between all pairs of consecutive events.
we need to adjust the time information in the recorded data according to the current time.
speci cally for the rst event mobiplay changes the event time to the current time and adjusts the subsequent events accordingly.
then mobiplay packages the events into a request the same structure used in data recording.
after sending the rst request to the target app mobiplay will wait in order to maintain the correct inter arrival time between events.
then the next request 576object is sent and the process is repeated.
this continues until all input data has been read from disk and injected.
after the replay has nished mobiplay will automatically switch back to the gui with three modes for choosing.
algorithm summarizes the whole procedure.
algorithm the replay procedure of black box testing on the server.
inputlog class int64 t request mrequest input disk phone serve device server test black box 1ifdisk phone then read input data from phone s disk 3else read input data from server s disk 5store data into inputlog by call parsefrom 6while request is not empty do event t getnextrequest inputlog change the time of event to current time inject event to the app sleep t 11return to the gui for mode selection since white box testing is more meaningful on the phone than on the server and the procedure is similar on the server and on the phone we defer white box testing details to section .
.
.
.
.
replay on the mobile phone for some tests we may want to conduct the replay on the mobile phone itself.
as we know mobiplay records all input data when the target app is actually running on the virtual machine on the server.
since the virtual machine o ers the same environment as the mobile phone including screen size and resolution the recorded data can be replayed on the mobile phone.
however in this case the tester does not have full control of the mobile phone.
therefore the replay procedure is di erent.
in the following we will describe the replay of black box testing and that of white box testing respectively.
black box testing .
for black box testing we cannot make any change to the target app.
as analyzed in the introduction the android application sandbox forbids one application from injecting data into any other application.
the only way to inject the input data for replay is to leverage thesendevent tool which requires root privilege.
therefore for replay on the mobile phone mobiplay runs into the same limitations as reran does.
as the recorded input data in mobiplay is high level events we need to convert it back to hex codes rst and then inject it by writing into the corresponding dev input event les.
white box testing .
here we want to inject the replay data directly into the target app assuming that we have the source code of the target app with the goal of modifying the target app as less as possible.
in a normal android system the android framework communicates with the app through api and sends the input data to the app in the form of events.
therefore in white box testing the recorded input data also has to be sent to the app in the form of events.
with the recorded data we need to recreate all ve events motionevent keyevent sensorevent location and rotation.
unfortunately we cannot create a sensorevent object as we do for the other four events because sensorevent is not public in android.hardware.sensorevent class.
thus we de ne a new class newsensorevent to carry sensor data i.e.
sensortype accuracy timestamp and an array of values .
depending on whether to modify the app the ve events are grouped into two categories.
the rst category motionevent and keyevent does not need to modify the app.
android provides its own testing framework called the android testing framework which is well integrated into the android sdk tools.
it o ers powerful and easy to use tools that help developers test their applications at every level from unit to framework.
we use the instrumentation class in this testing framework to inject motionevent and keyevent through sendpointersync and sendkeysync respectively.
the second category sensorevent location and rotation requires to modify the app since the android testing framework does not provide corresponding apis.
we have to manually inject these events into the target app.
speci cally for location we call four methods under the android testing framework onlocationchanged onstatuschanged onproviderenabled and onproviderdisable for rotation we call onrotationchanged for sensorevent we overload onsensorchanged method and then call it.
table summarizes how these ve types of events are injected.
.
.
event sampling the input data for replay is a sequence of events each of which has a timestamp.
we can consider these events as samples and re sample them at times di erent from those at which they are originally captured.
in the inputlog we record the events and the time interval of each pair of consecutive events.
what we need to do is to change the time intervals and the event time accordingly without a ecting the correct execution of the app.
first we can use event sampling to cancel the latency introduced by the server.
there is inevitably a latency from the point of view of the mobile phone since the app actually runs on the server even though the latency is small.
to cancel the latency we can shrink the time interval between every pair of consecutive events say event afollowed by event b by the amount of event b s latency please refer to section .
where the latency of di erent types of input has been measured.
to do this mobiplay carefully examines the events and identi es which are a ected by the latency and which are not and only adjusts the time intervals associated the former.
note that mobiplay adjusts the event time of each event as well according to the shrunk time intervals.
second we can replay an app in fast mode with mobiplay by adjusting the time interval between two consecutive activities similar to the technique used in reran.
for instance imagine that the user zooms in and then clicks a button on the screen we can shorten the time interval between the two activities when replaying the app.
.
evaluation in this section we will evaluate mobiplay.
first we demonstrate that mobiplay can record and replay a variety of mobile apps.
then we measure the latency introduced by the server and the time space overhead.
finally we will test the event sampling technique.
577table details of data injection in white box testing.
type recreated?
modify app?
injection description injection method motionevent yes no use instrumentation class in android testing framework.sendpointersync keyevent yes no sendkeysync sensorevent no yes developers need manually inject these data to the target application.call onsensorchanged location yes yes call four functions rotation yes yes call onrotationchanged .
usability for usability mobiplay currently does not support mobile apps that require arm based third party libraries since the server in mobiplay is x86 based.
mobiplay does not support camera or 3d acceleration either.
as listed in table we randomly tried apps from google play in di erent categories including games tools news health tness lifestyle education shopping etc.
none of which requires arm based third party libraries or 3d acceleration libraries.
we have successfully recorded and replayed all of the apps the replay is done on the server side multiple times .
.
latency the client server model introduces latency.
from the view of the mobile user she cares about how long it takes to get a response for her input.
for instance suppose she clicks a button on the client then how long does it take till she notices that the click really happens?
thus we de ne the latency as the time interval between the time the input occurs at the mobile phone and the time the input takes e ect on the mobile phone that is the round trip time of the input between the mobile phone and the server.
to measure the latency we have designed an app such that the screen turns red when an input event nishes.
then we run the app on mobiplay and record the time when an event occurs on the mobile phone and the time when the screen turns red.
for instance for the event of click we record the time when action up of click occurs and the time when the click spot turns red.
input typeclick swipe zoom key sensorstime ms figure round trip time for di erent types of input.
we have evaluated the latency for ve di erent types of input each with rounds.
figure show the box plot of the results.
as we can see all the latency is less than milliseconds and the average is below milliseconds which does not a ect the continuity of app execution andis acceptable to most testers.
individually the sensor input has the shortest latency the reason is that mobiplay only needs to intercept four elds of data as listed in figure .
the inputs of swipe and zoom have longer latency one reason is that mobiplay has to intercept more data including historical data refer to figure and svmp also batches a sequence of actions.
the input of click and that of key have nearly the same latency shorter than that of swipe and zoom but longer than that of sensor.
even though they belong to di erent categories of events motionevent and keyevent respectively they share the same action with an action down and an action up leading to similar latency.
.
time and space overhead we have measured the time overhead.
table shows the result of apps which are either touch intensive or sensorintensive.
column is the original run time which is the time of an app running in the record mode.
column is the replay time which is the time of the app running in the replay mode with the corresponding recorded data.
column is the time overhead.
as we can see the time overhead ranges roughly from to .
we believe that at least the following three factors contribute to the overhead.
first during the replay after injecting the rst event of a pair of consecutive events mobiplay waits a period of the time interval of the two events before injecting the second event by utilizing the thread.sleep method however thread.sleep is inaccurate and operation in parallel can lead to excessive sleep.
second it takes time for mobiplay to adjust the time information of an event on basis of current time.
third reading the input data from the disk needs time as well.
we also have measured the size of the recorded input data for the same apps.
additionally we have recorded the number of events for each of ve categories.
in table me ke se r and l stand for motionevent keyevent sensorevent rotation and location respectively.
the rst six are touch intensive and the rest two are sensor intensive.
as the table illustrates the more events the larger the data size and each motion event occupies more space than each sensor event since the former has more parameters than the latter.
.
event sampling our evaluation here focuses on the event re sampling on touchscreen gestures themselves i.e the motionevent.
reran has conducted similar test but it has focused on time warping during data entry such as shrinking time interval between two button presses and content processing such as reading a story instead of touchscreen gestures.
reran states that manipulating the speed of touchscreen gestures can easily modify the gesture s e ect or convert it to a different action or set of actions.
we have found that our re578table the apps that mobiplay has recorded and replayed successfully.
name category name category exploration lite adventure creativity cartwheel by target lifestyle bible book reference instructables lifestyle amazon kindle book reference mychart medical bing search book reference nbc news news magazines concur business bbc news news magazines square register business cnn news news magazines kids doodle casual reddit is fun news magazines zingbox manga comics flipboard news magazine news magazines crunchyroll manga comics hola launcher personalization teacherspayteachers education iron man live wallpaper personalization math expert education photo editor photography bing dictionary eng chn education emoji keyboard productivity chase mobile finance evernote productivity mint personal finance money finance onet connect fruit puzzle bank of america finance amazon for tablets shopping tic tac toe free game best buy shopping bubble shooter classic game meetup social crush eggs game nfl fantasy football sports word search game sensor box for android tools chinese checkers wizard game sensors tools pedometer health fitness file manager tools calorie counter myfitnesspal health fitness shell terminal emulator tools noom walk pedometer health fitness clock tools cardboard libraries demo adobe air tools always positive daily quotes lifestyle amber weather weather diy garden ideas lifestyle the weather channel weather table the time and space overhead and number of events in each category.
app namerunning time seconds data size kb of me of ke of se of r of loriginal replay overhead kidsdoodle .
.
.
.
bible .
.
.
.
bing dictionary .
.
.
.
bing search .
.
.
.
bbc news .
.
.
.
amazon kindle .
.
.
.
pedometer .
.
.
.
sensor box .
.
.
.
kids bible dict search bbc kindle pedo sensortime seconds .
.
.
.
.
.
.
original replay re sample figure re sampling reduces the replay time.
play approach can speed up the touchscreen gestures with out any error.
speci cally we sped up the touchscreen gestures twice.
for instance a swipe consists of an action down a sequence of action move and an action up.
we shrunk the time interval between each pair of action move by half.
figure shows the results of the same apps in section .
.
the numbers above the re sample column is the percentage of time that has been reduced by re sampling.
as we can see the more the number of motion events the more the time reduced please refer to table .
.
limitations and future work one limitation of mobiplay is that the server in our current implementation is x86 based preventing mobiplay from running apps that need arm based third party libraries such as 3d apps.
fortunately there are arm based servers available now and both kvm and xen o er exten579sions for arm architecture.
we leave the implementation of mobiplay with an arm based server as our future work.
there are also several other directions for the future work.
in principle mobiplay should be able to replay an app on a mobile device with the input data recorded from another device with distinct device con guration such as resolution screen size etc.
therefore one direction is to test and evaluate the cross device portability on mobiplay.
in addition it is worth improving mobiplay such that it can support camera and microphone which it currently does not.
.
related work a large body of research has been conducted in recordand replay techniques including desktop server and mobile phone applications.
in this section we review the most relevant works from recent literature.
desktop and server applications there are bunch of record and replay tools in the last decade .
among them some are eventdriven such as these tools record the x y pixel coordinates of mouse clicks as well as keyboard strokes and replay this recorded information by creating new mouse and keyboard events later.
some systems utilize the keyword action technique such as they work in a higher level of abstraction by capturing gui objects.
even though some of these tools record mouse move and mouse drag information they cannot record and replay gestures on mobile phones like swipe pinch and zoom due to the added complexity of multi touch.
there are several other works in this line of research.
has presented a tool called timelapse for quickly recording reproducing and debugging interactive behaviors in web applications.
have designed an approach for generating test cases for web service applications.
has presented an approach called puple to provide automated support for capturing and replaying con guration decisions.
has presented a tool to learn how to interact with the application under testing and stimulate its functionality by working at the system level and interacting only through the gui.
and presents a system for automating bug reproduction.
mobile phone applications the android sdk o ers a tool called monkey which can be run on any device or emulator instance.
it can generate pseudo random streams of user events such as clicks touches or gestures as well as a number of system level events.
monkey supports event sequence scripts to be fed into an app.
it can also handle presses but scripting presses is labor intensive.
furthermore monkey scripting does not support touchscreen gestures.
google has also provided several tools .
monkeyrunner provides an api for writing programs that control an android device or emulator and allows a developer to externally exercise an app.
robotium fully supports native and hybrid android apps and makes it easy to write automatic black box tests.
ui automator provides a set of apis to build ui tests that perform interactions on user apps and system apps.
espresso provides a set of apis to test user ows within an app.
all these tools hook into the app source code which is a limitation as source code is not always available.
there is another framework called guitar for java and windows apps.
it has been ported to android by extending the monkeyrunner tool to allow users to generate test cases.
however it does not support touchscreen gestures and many sensors typicallyfound on mobile phones.
mobiguitar presents a tool for automated gui driven testing of android apps based on observation extraction and abstraction of the run time state of gui widgets.
reran provides a record and replay tool to capture low level event streams on the mobile phone including gui events and sensor events.
however it is not able to record and replay data from the gps and microphone devices because android provides data for these devices through speci ed services.
furthermore it has a potential concern regarding time dependence of events.
finally because of the design of the replay agent there may be con icts with other events occurring at the same time.
mosaic provides a virtual screen to handle the di erences across di erent devices.
it maps a set of touchscreen events from a particular device into a set of virtualized user interfaces that can be retargeted and injected into another device.
both reran and mosaic utilize getevent to record app data and sendevent to inject the recorded data for app replay.
therefore it retains some of the problems present in reran.
selendroid presents a test framework based on android instrumentation framework and good for white box testing.
however it does not provide recording functionality.
record and replay functionality can also aid security researchers.
work that makes use of physical sensors on the android platform such as microphones accelerometers and speakers for security purposes such as can bene t greatly from mobiplay.
using our system researchers can debug their applications in a traditional way.
and they can also perform sophisticated security analysis such as monitoring sensor use and exploring the feasibility of replay attacks.
.
conclusion in this paper we have designed a client server system called mobiplay which allows users to record and replay mobile application executions.
mobiplay runs the the target mobile application on a server while displaying the app gui in real time on the mobile phone such that the mobile phone user has exactly the same experience as if the application were running on the mobile phone.
we are the rst to build such a system which records the input data at the application layer instead of the android framework or the linux kernel.
this allows us to solve many di culties the current approaches have encountered.
mobiplay is comprehensive exible and e cient.
first it is able to intercept all input data including all touchscreen gestures and data from all sensors better than current state of the art approaches.
second it is able to record and replay a mobile app on both the mobile phone or the server.
third it is suitable for both white box and blackbox testing.
we have implemented mobiplay on android and evaluated it with tens of popular applications with supportive and convincing results.
.