droidmate a platform for android test generation nataniel p. borges jr. saarland university saarbr cken germany nataniel.borges cispa.saarlandjenny hotzkow saarland university saarbr cken germany jenny.hotzkow cispa.saarlandandreas zeller saarland university saarbr cken germany zeller cs.uni saarland.de abstract androidapplications app s representaneverincreasingportionof the software market.
automated test input generators are the state of the art for testing and security analysis.
weintroducedroidmate dm aplatformtoeasilyassist both developers and researchers to customize develop and test new test generators.
dm can be used without app instrumentation or operating system modifications as a test generator onreal devices and emulators for app testing or regression testing.
additionally it provides sensitive resource monitoring or blocking capabilities through a lightweight app instrumentation out of thebox statement coverage measurement through a fully fledged app instrumentationandnativeexperimentreproducibility.inourexperimentswecompareddm 2againstdroidbot astate of the art test generator by measuring statement coverage.
our results show that dm reached of its peak coverage in less than of the timeneededbydroidbot allowingforbetterandmoreefficient tests.
on short runs minutes dm outperformed droidbot by while in longer runs hour this difference increases to .
acm dl artifact for the details see ccs concepts software and its engineering software testing and debugging dynamic analysis human centered computing graphical user interfaces smartphones keywords dynamic analysis test generation android acm reference format natanielp.borgesjr.
jennyhotzkow andandreaszeller.
.droidmate2 aplatformforandroidtestgeneration.in proceedingsofthe201833rd acm ieeeinternationalconferenceonautomatedsoftwareengineering ase september montpellier france.
acm new york ny usa 4pages.
authors in alphabetical order.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthe firstpage.copyrights forcomponentsof thisworkowned byothersthan the author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
ase september montpellier france copyright held by the owner author s .
publication rights licensed to acm.
acm isbn ... .
introduction the android mobile application market is highly volatile and competitivewithmillionsofapplications apps ongoogleplaystore.
the quality of an app is vital to stay competitive in such a market and testing is a core technique for quality control.
since manual app testing is expensive and laborious several tools for automated test generation have been developed.
automatedtestingis however aconstantlyevolvingsubject astesting techniques improve so increases the app s complexity.
this results in a never ending demand for more advanced testing techniques to cover app behavior as effective and efficient as possible.
quality control mostly implies defect free apps and test generators mainly focus on functionality testing.
as the recent facebook incident shows this is no longer sufficient.
as security and privacy become moreprominent securityanalysisshouldbepartofthetestingand development cycle.
inthisworkwepresentdm anextendedandimprovedversion of the original droidmate project.
while droidmate was a test input generator with api monitoring capabilities dm offers easytousemechanicstoimplementsystematictestingstrategieson top of a ready to use selection of strategies such as random fitness based or playback of recorded executions.
dm is still usable outof the boxasarandomtestinputgenerator however besidesmajor performance improvements its improved design gives developers and researchers means to easily implement and combine their own customstrategieswhileabstractingallandroidspecifics suchas appsetupordevicecommunication away.eachstrategyisautomatically selected according to freely configurable conditions e.g.
the condition if there is a permission request accept it can be easily expressedasbooleancheckofthecurrentlyvisibleelementsforthe permissionrequestidentifier.allthesetestgenerationalgorithms canbenefitfrommonitoring mockingorblockingofsensitiveresourcesduringanalysisaswellofanewdynamicallygeneratedand extensible app model which allows for context aware exploration strategies.
dm runs on stock android versions between api and api on physical devices and emulators without any need of device rooting or operating system os modification.
it providesout of the boxtestreproducibility aswellasstatement coverage analysis via app instrumentation.
tool design thearchitectureof dm 2consistsofthreemajorcomponents as illustrated by the dashed frames in figure .
exploration engine running on the host pc creates the ui statemodel onthefly anddeterminesinteractionswiththeapp under test based on a configurable set of exploration strategies monitoring proxy running on the device is responsible for intercepting api calls between the app and the android os to log block or mock the responses of these api calls authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france nataniel p. borges jr. jenny hotzkow and andreas zeller figure dm s conceptual architecture highlighting places where the developer can add custom implementa tions light gray as well as components from the originaldroidmate extended by dm dashed .
automation engine consisting of a pc interface and a device componentwhichcommunicateviatcp toexecutetheactions asdeterminedbythe explorationengine onthedevice.therebythe device itself is controlled via android s native uiautomator.
.
exploration engine originally the test generation of droidmate utilized an exploration loop to determine after each executed device action what interactions should be issued next.
dm extends this mechanism with a pool of exploration strategies andselectorswhich determine the next interaction based on the current state of the app model seesection .
.
.
each selectorprogrammatically specifies based on the current and previous model states if it is able to process the current state and if so which specific strategy should be activated.
to cope with cases where multiple conditions are fulfilled at the sametime auniquepriorityvaluehastobespecifiedforeachselector.foranyiterationintheexplorationloop theselectorwith thehighestprioritywhichcanprocessthecurrentstateischosen and its strategy is used to compute the next device interaction.
after each device action dm fetches the current device screen window dump and a screenshot alongside potential logcat exceptions.
with this information the new app state is derived as described in app model .
additionally all registered model features arenotifiedaboutthisstatetransition.thesemodelfeaturesprovidetheinterfacetoallowformodelextensionslikeablacklistof all ui elements which let the app crash or the exploration stagnate.
the new state is then used in the next iteration of the exploration loop as current state of the app.
this loop continues until any strategy triggers a terminate action.
.
.
strategy selectors.
dm 2supportsthedefinitionofcriteria to determine the best strategy for different situations e.g.
when a permissionisrequestedortheexplorationgetsstuck.thesecriteria are referred to as selectors.
formally a selector is defined as a pair parenleftbig p f c s parenrightbig wherepis itspriorityand f c isamappingfunction ffromamodelcontext c e.g.
thecurrentstateortheactiontrace toanexplorationstrategy s.dm 2calculatesiftheselectioncriteriaisfulfilled f c andchoses themostsignificantsuccessfulselector.thatis theonewithhighest prioritywhichreturnedastrategy stobeusedtoderivethenext device interaction.dm 2providesasetofselectorstoactivatethedefaultstrategies described in section .
.
.
the set of selectors to be used can be configuredviacommandlineorwithinaconfigurationfile.custom selectors can be implemented or existing selectors can be modified e.g to change priorities and passed to dm s initialization.
.
.
strategies.
aninteractionwithanappcanbesimple suchas click on coordinates x y or complex such as close the app enable thedevice wi fi bluetooth andrestartthe appfrom itsinitialscreen.
such complex interactions are abstracted as exploration actions.a n exploration action determines which specific sequence of device actionsshould be performed by the automation engine.
a strategy decides based on the current state of the app model which exploration action s should be issued next.
dm is shipped with a set of strategies e.g.
it is able to randomly explore an arbitrary app without any need of additional meta information labeling or manual user interaction.
in addition torandomexploration dm 2offersthefollowingdefaultstrategies reset re enables wi fi triggersthehome buttonandstarts the app from its main activity.terminate closes the app and finishes the exploration.
backpresses the back button of the device.
biasedrandom randomlyselectsauielementfromthecurrent screen among those which have been least explored and clicks or long clicks it.
in particular we count how often any ui element was clicked in the context of a specific state and how often over all states.
the leastinteracteduielementiscomputedbydeterminingtheinteractable elementswhich wereleast interactedin thecontext ofthe current state and filtering these by the smallest overall interaction number.ifthiscomputationresultsinmorethanoneuielement the target is chosen randomly among them.
apps which belong totheapplicationpackagearepreferredtoguidetheexploration rather to app internal features.
random randomly clicks on the coordinate of any ui element on the screen similar to monkey .
fitness proportionate uses a statically mined interaction model to predict the probability of each ui element having an event then use these probabilities as bias for a random selection.
playback selects the next valid interaction from a previously recorded model trace and replays it.
.
.
app model.
the appmodel constructed duringexploration consists of the ui states featuring a set of ui elements.
some of these ui elements are interactable meaning the user can for example tick click or long click them.
this interaction transition mayleadintoanotherstate.whileandroidsallowsthedeveloper tospecifya resource id foranyuielement itisoptionalandseldom used.
thus we uniquely identify a ui element by computing its id widin the form of a uuid from the java default library based on the concatenation of its display and description text if available or on its image bytes cut from a screenshot if not.
in additionto the unique id we compute a propidwhich represents the ui element configuration by converting all state related properties such as position checked enabled click able etc.
to a string and computing its uuid.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
droidmate a platform for android test generation ase september montpellier france weaimtoidentifyconceptuallyidenticalstates i.e.
slightdifferencesintherenderinglikethehighlightingofpreviouslyinteracted elementsshouldnotbeinterpretedasadifferentstate.moreover wedisregarduielementswhichdonotbelongtotheapp thatis possessadifferentpackagename aswellasnon interactableand simply structuring elements as non essential for the conceptual identityoftheuistate.however wewouldstillliketobeableto distinguish if for example a check box in the same conceptual state was ticked or not.
with this goal we specify the identityidof a state by a tuple stateid uniqueid configid .
where the uniqueid is computed as the union of the widof all ui elements belongingtotheappwhichareeitherinteractableorleafsinthe elementhierarchy non leafelementsareusedforlayoutandvisualrepresentationpurposes andthe configidistheunionofthe propid of all currently visible ui elements.
thismetricforuniqueidsallowsustoefficientlyre identifyconceptuallyidenticaluistatesaswell asuielementswhichreoccur withindifferentuistates likemenuorhelpbuttons independently oftheirpositionorlayout.themetricfor configidallowstoidentify which configurations were explored for each ui state.
both functionalities are essential for advanced exploration strategies.
.
automation engine theautomation engine abstracts and manages all communication between the exploration and app using a synchronous protocolbased on actionsandresponses.
strategies send one action at a timetothe automationengine pcside whichforwardsittoits on device instance and halts the exploration while this action is processed.
the on device automation engine converts actions into automation commands or api calls.
before issuing a response to the ex ploration the on device automation engine must wait until the appstabilizes thatis untilitfinishesperformingthepreviousaction and has at least one element from the app to interact with.
this synchronizationis anatural bottleneckof most androidtest generatorswhichallowforstate awareuiactions.itis however necessary to correctly emulate a user s behavior who would have to wait until a new screen is loaded to continue the exploration.
thetimetoexecuteanactionvariesaccordingtothefunctionalitybeingperformed tickingacheckboxisfasterthanclickinga loginbutton aswellasexternalfactors suchasnetw orkspeed and server availability.
the automation engine copes with varying load times as follows first it waits for the device to be idle that is ready to receive and handle commands again.
it then waits until atleastoneuielementcanbeinteractedwith.itdiscardsanyui elementsdisplayedonlyduringthistransitionperiod e.g.
progress bars as they do not provide any explorable behavior.
oncetheappstabilizes theon device automationengine issuesa responsecontainingthestructural screendump andvisual screenshot state of the device to its pc counterpart which forwards it to theexploration engine for processing.
.
monitoring proxy themonitoringproxy isapayloaddeployedtothedeviceinorderto workasaproxybetweentheappandos.itmonitorsaconfigurable listofprivacy sensitiveresourcesandinterceptsapiinvocations without changing the app code.
this functionality is only available figure2 averagecoverageovertimebetweendm droid bot and monkey for the test dataset.
on physical devices or emulators with arm processor architecture.
in order to use it the app has to be instrumented to activate this payloadbeforestartingtheapp.dm 2offersthisinstrumentation functionalitythroughits inlinemechanism whichinsertsanactivationcalltothepayloadintheentrypointoftheapp keepingthe remainder of the app unaltered.
whileoriginallydevelopedforapimonitoring the monitoring proxyallowscustomcodetobetriggeredforeachapi aswellasto individuallydefinesecuritypoliciessuchasmockingorblocking api access.
when active monitoring proxy s standard mocking behavioris toreturna defaultvalueforprimitive typeapis such as for integers and empty string for strings.
when blocking it by default raises a security exception.
empirical evaluation weconductedasetofexperimentstoevaluatedm sefficiency and effectiveness.
in particular we aim to answer the followingresearch question does dm reach a coverage peak faster than current tools?
we compared dm against droidbot which presents similar functionality and has been shown to outperform most current test generators and monkey the standard test generator from android.
as an evaluation metric we used statement coverage which has been extensively used to determine the effectiveness of testing toolsandisregardedasagoodpredictorforfaultdetection .we evaluated all tools on different apps randomly chosen from .
each app exploration was executed for hour on a real google nexus 5x device with runs per app to mitigate noise.
ourresultsinfigure 2showthatconcretestrategiesaresuperior topurerandomeventsforthetestedappset.eventhoughmonkeyimplementsmoreinputtypes e.g.
swipeandzoom thantheothertools it has the worst overall coverage.
this is in particular true for apps which have deeper functionality meaning the user has to navigatethroughafewscreensuntilcertainfeaturesareaccessible.
droidbot and dm both try to systematically explore different ui elements.
droidbot applies a depth first strategy meanwhile dm usesbiasedrandom.
this fact together with the better performanceof dm 2sinstead of3 4s peraction leadto faster and more efficient explorations.
on average dm achieved bettercoveragethandroidbotafter1hour witha difference in minute runs.
in addition this chart shows that dm achieved of its maximum coverage in approximately minutes whiledroidbot reached the same ration in approximately minutes.
usage scenarios weenvisiondm 2asatoolbeneficialtobothresearchandindustry due to its modular architecture and out of the box functionality.
below we describe a few scenarios where dm can be applied.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
ase september montpellier france nataniel p. borges jr. jenny hotzkow and andreas zeller recordandreplaysystemtests.
duringthetestexecution dm records each action performed ui element seen and state reached italsoprovidesout of the boxstatementcoveragemeasurement.
aninitialdm 2run orasetofrunswithdifferentconfigurations canbeexecutedtotestasystem.duringthereleaseofanewversion oftheappthesetestscanbereplayedandthefollowingevaluations performed does the functionality tested on the previous app version still work the same?
are there any previously tested code segments which are no longer tested?
sensitive resource impact analysis.
dm can be used to analyze theimpactofaccessrestrictiontosensitiveresources.whiledroidmate was capable of monitoring api access it did not provide any means torestrict orimpersonate them.
by combining dm s apirestrictingcapabilitieswithitsrecordandreplayfeatureand code coverage metric it is possible to measure the impact when restricting access to a sensitive resource.
appbehavioranalysis.
dm 2createsanappmodelduringexploration which can be used to generate new test inputs.
this model can be easily extended with custom features like tracking apis triggered after clicking ui elements with certain text labels.
previousresearch demonstratedthatsuchinformationcan beusedtoidentifyanomalousbehaviorswithinappcategories.ourmodelallowssuchstudiestobeperformedwithcontext awareness current and previous app states and on finer granularity level.
newtestgenerationstrategies.
dm sarchitectureoffersmajor assistance for the development of new android test generation algorithms.dm 2canbeusedtoabstractalllow levelandroidcommunicationandtocreatetestsfromamodelrepresentationofthe app mitigatingthedevelopmentefforts.inaddition dm 2provides natively experiment reproducibility through record and replay as well as coverage metrics for comparison between techniques.
related work automated test input generation in mobile apps is a frequent researchtopic.threemajorapproachesareusedforinputgenerators namely random model based and systematic.
random testing tools create sequences of events to explore apps.
representatives are monkey the lightweight test generator shippedwithandroid aswellasdroidmate .dm 2supports the same feature while providing more functionality.
model based inputgeneratorsusea previouslydefinedoron theflygenerated modeltoproduceinputs.forexampledroidbot employsdifferentmethodstodynamicallyconstructand consumeappmodels.dm sofferssimilarfeatures.adeveloper can easily implement custom strategies which use the on the fly constructed model.
droidbot s methods to quantify test effectiveness are orthogonal to our approach and may be integrated in the future.swifthand uses statically generated models to guide test generation.dm 2providesout of the boxa fitnessproportionate strategywhichconsumesastaticmodelfortestgeneration.this mechanism can be applied to arbitrary input models.
systematic testing approaches systematically test an app with a specific goal.
evodroid andsapienz attempt to improve test coverage while intellidroid attempt to trigger specific behaviors.withdm sextensiveappmodelitisstraightforwardto support all these approaches or to try out other new strategies.besidestheperformancebenefitsaspresentedin section3 dm offersadditionalfeatureslikereproducibility playbackstrategy an extensible architecture and a more powerful app model.
conclusion wepresentdm aplatform forandroidtestgeneration which canbeusedonallstockandroidversions6to8.
.whiledm 2can beusedoutoftheboxforrandomtesting withapimonitoringand privilege restriction or for recording and replaying system tests its major advantage is the easement for development combination extension and comparison of different test generation strategies.
dm 2simplifiestheworkfordevelopersbyabstractingalldevice related issues and providing a dynamically constructed app model whichcanbeusedtoverifytestcriteriaorforstrategydevelopment.
ourevaluationshowedthatdm 2isablenotonlytoachieveabetter coveragethanbothastate of the artandandroid sstandardtest generators butthat it isalso able toreach itspeak coverageearlier allowing for faster more efficient testing.
acknowledgment this work was funded partially by a german research foundation dfg grant d514111409 the dfg project sfb project a3 and partially by european research council grant g514111401 .