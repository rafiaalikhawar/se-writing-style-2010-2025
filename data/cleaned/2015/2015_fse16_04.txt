detecting table clones and smells in spreadsheets wensheng dou1 shing chi cheung2 chushu gao1 chang xu3 liang xu1 jun wei1 1state key lab of computer science institute of software chinese academy of sciences beijing china 2dept.
of computer science and engineering the hong kong university of science and technology hong kong china 3state key lab for novel software technology and dept.
of computer sci.
and tech.
nanjing university nanjing china wsdou gaochushu xuliang12 wj otcaix.iscas.ac.cn 2scc cse.ust.hk 3changxu nju.edu.cn abstract spreadsheets are widely used by end users for various business tasks such as data analysis and financial reporting .
end users may perform similar tasks by cloning a block of cells table in their spreadsheets.
the corresponding cells in these cloned tabl es are supposed to keep the same or similar computational semantics.
however when spreadsheets evolve thus cloned tables can become inconsistent due to ad hoc modifications and as a result suffer from smells .
in this paper we propose tablecheck to dete ct table clones and related smells due to inconsistency among them.
we observe that two tables with the same header information at their corresponding cells are likely to be table clones.
inspired by existing fingerprint based code clone detection techniqu es we developed a detection algorithm to detect this kind of table clones.
we further detected outliers among corresponding cells as smells in the detected table clones.
we implemented our idea into tablecheck and applied it to real world spreadsheets fr om the euses corpus.
experimental results show that table clones commonly exist .
and .
of the spreadsheets with table clones suffer from smells due to inconsistency among these clones.
tablecheck detected table clones and their smells with a pr ecision of .
and .
respectively while e xisting techniques detected no more than .
true smells that tablecheck could detect .
ccs concep ts applied computing spreadsheets software and its engineering software testing and debugging social and professional topics software maintenance .
keywords spreadsheet table clone copy and paste smell detection enduser programming .
introduction spreadsheets have been widely used by end users for various business tasks including data analysis decision support financial reporting and so on.
spreadsheets a re more popularly used than other computational paradigms .
since spreadsheets are created and maintained by non expert end users errors can be easily induced into spreadsheets .
in order to improve the quality of spreadsheets researchers have applied various software engi neering techniques to spreadsheets such as auditing testing smell detection and debugging .
a spreadsheet comprises blocks of cells arranged in rows and columns.
like code clones in conventional programs cells in spreadsheets can be copy and pasted reused during spreadsheet development and maintenance.
copy and paste can shorten the preparation time for spreadsheets.
for example a user can quickly prepare a new financial repo rt by updating a copy based on an existing one.
commercial spreadsheet systems e.g.
microsoft excel make it easy to copy cells from existing spreadsheets.
when a user copies a block of cells to a new location such spreadsheet systems can help deduce ne w formulas if any for them based on the underlying patterns of the copied cells automatically .
thus the computational semantics among the original and new cells are kept consistent.
however after copy and paste there are rarely any record s or meta data indicating which cells in a spreadsheet were thus created although they are supposed to be uniformly modified in future.
besides little provision is offered to warn users against arbitrary modification of these cells .
the current practice assumes that users should own conscientiousness to maintain the consistency between copied orig inal cells and pasted new cells.
users however may unintentionally break the consistency when maintaining the concerned cells.
this would lead to undesirable consequences which could further manifest into errors.
caulkins survey reported that investigated users found errors in spreadsheets that were prepared by reusing existing ones.
this motivates the need for effective techniques of detecting table clones groups of copied and pasted cells and their related inconsistency problems if any .
in this paper we focus on detecting table clones resulted from copy and paste operations and smells induced by the inconsistency among table clones.
we refer to two re ctangular blocks of cells as table clones when their corresponding cells share the same or similar computational semantics.
for example the corresponding cells in of figure a and of figure b share the same computation although their contents can look different some corresponding cells e.g.
c3 in figure a and b3 in figure b are both input cells and some other corresponding cells e.g.
c7 in figure a and b7 in figure b prescribe the same formula pattern although their concrete formulas take seemingly different inputs these inputs come from corresponding cells in the two blocks all corresponding cells have the same headers e.g.
d3 in figure a and c3 in figure b both have the row header weekly and column header responses .
our empirical st udy found that such table clones commonly exist e.g.
table clone groups exist in spreadsheets from the widely used euses corpus .
besides .
of these spreadsheets with table clones suffer from smells due to inconsistency among these table clone group s. this indicates the necessity of this is the author s version of the work.
it is posted here for your personal use.
not for redistribution.
the definitive version was published in the following publication fse november seattle wa usa c acm.
... 787detecting table clones in real life spreadsheets and their contained smells .
we propose tablecheck in this paper to detect table clones and their related smells.
the key challenge is how to determine which cells can form table clones and which cells are subject to smells when they are involved in inconsistency among table clone groups .
tablecheck works based on the observation that two tables blocks of cells if having the same row and column headers at their corresponding cells are likely to share the same computational semantics and become table clones.
howeve r simply examining each possible pair of cell blocks for detecting table clones can be extremely time consuming.
as inspired by existing fingerprint based code clone detection technique s we exploit a cell s derived header informati on as its fingerprint for facilitating table clone detection.
furthermore to detect smells among grouped table clones we analyze possible inconsistenc y among corresponding cells in these table clones e.g.
dissimilar formulas from d3 in figure a and c3 in figure b c and mark outliers from them as smells e.g.
c3 in figure c .
we implemented tablecheck as a prototype tool and evaluated its performance using the euses corpus from two perspectives table clone detection and smell detection.
experimental results show that table clones are common and .
of spreadsheets with formulas contain table clones smells associated with tab le clones are also common and tablecheck detected smelly cells in table clone groups which cover .
validated as true table clone groups smells among table clones are harmful and smelly cells indeed contain wrong value s tablecheck detected table clones and their smells with a high precision of .
and .
respectively other existing smell detection techniques e.g.
amcheck cacheck custodes excel and ucheck dimension detected no more than .
true smells tablecheck detected .
tablecheck differs from hermans data clone detection work in the types of detected c lones.
their work considers two blocks of cells with almost the same values as clones.
thus it cannot detect table clones with different values and smells in figure .
on the other hand tablecheck can detect clones with the same computational semantics but different values .
tablecheck also differs from our previous work amcheck cacheck and custodes in both cell clustering and smell detection.
tablecheck leverages the heade r information to detect table clones in the same worksheet s different worksheets and different spreadsheets.
unlike tablecheck amcheck cacheck and custodes aggregate cells into clusters by their formula similarity e.g.
referenced cells and continuous cell locations in a single worksheet.
as such amcheck cacheck and custodes cluster cells in figure a and in figure c into different clusters.
unlike tablecheck which detects smells by cross checking inconsistency among table clones across clusters amcheck cacheck and custodes detect smells in side single cluster s. as such the smell detection of amcheck cacheck and custodes are mostly restricted to those cells that can be clustered by their formula similarity e.g.
they treat in figure c as a cluster but there is no smell in it .
therefore tablecheck and amcheck cacheck custodes are working at two different levels.
unlike tablecheck which detects smells among cells ucheck and dimension inference exploit the header information to detect type inconsistency in single formula s. as a summary no prior technique has been dedicated for detecting table clones and their contained smells in spreadsheets.
we summarize our main contributions in this paper as follows we proposed the notion of a new and commonly existing structure in spreadsheets table clone in which corresponding cells share the same or similar computational semantics.
we proposed a fingerprint based algorithm to detect table clones in spreadsheets by exploiting the header information derived from cells and an outlier based technique to detect smells in grouped table clones.
both are automated.
we implemented our work into a tablecheck tool and evaluated it with real life spreadsheets from the euses corpus.
the experimental results show that tablecheck could detect table clones and smells effectively and precisely.
the remainder of this paper is organized as follows.
section presents a motivating example.
sectio n explains the concept of table clone.
section presents our table clone and smell detection approach.
section presents our tablecheck implementation and section evaluates it experimentally .
sections and discuss limitations and related work and section concludes this paper.
.
motiva tion in this section we illustrate table clones and related smells using an illustrative example extr acted from the euses corpus and then explain how to detect them .
a q1 b q2 c q3 d q4 figure .
table clones in a spreadsheet in the a1 format extracted from the euses corpus .
the cells marked by a red right cornered triangle are smelly.
the subtitle for each excerpt is its worksheet name.
.
example figure shows four worksheet excerpts from the euses corpus .
these excerpts perform quantitative analysis on four questions and form a table clone group marked by four rectangle s .
smells among tab le clones .
a cell suffers from a smell when there are inconsistent computation s in the corresponding cells among table clones.
the above example contains smelly cells marked with red right cornered triangle s among which the value of cell c3 in figure d is likely to be wrong.
note that smelly cells do not necessarily contain wrong value s. for instance smelly cells in figure c likely contain correct value s. improper modifications of cell formulas in table clones are a major cause for these smells .
for example users may prepare the excerpt in figure c based on the one in figure b .
cells in figure c could be a consequence of improper cell modifications that replace b with its computed value .
even though the modifications do not alter the computed values they impose an assumption that the computed value of b is al ways in view of spreadsheet updates.
the four smelly cells can become erroneous if the assumption is violated by later updates.
in the example we observe two different types of smells that can induce computation anomalies in cells which are also studi ed by our previous work amcheck cacheck and custodes .
missing for mula sme ll the smell occurs when a cell is supposed to contain a formula but it does not.
for example cells in figure d exhibit such smells.
however du e to no formula in figure d formula based smell detection e.g.
amcheck cacheck and custodes cannot detect these smelly cells .
inconsistent formula smells the smell occurs when a cell contain s an incorrect formula.
for example cells in figure c exhibit such smells e.g.
the formula in c3 should be b b .
however since all formulas in cells in figure c are the same formula based smell detection e.g.
amcheck cacheck and custodes treats these cell s as correct ones.
note that none of the smells shown in figure can be detected by other existing tools such as excel and ucheck dimension .
.
tablecheck overview detecting table clones and their associated smells needs to address three techn ical challenges .
let us explain them using the example in figure .
first how can one judge whether a cell e.g.
d3 in figure a belong s to a table clone as well as the boundary of the concerned table clone?
second in which situation do the occurrences of dissimilar formulas in table clones suggest smells?
note th at the occurrence of two dissimilar formulas does not necessarily suggest that the corresponding cells are smelly.
for example cell s d3 in figure a and c3 in figure b do not share the same formula in the r1c1 format explained later in section .
but they are not smelly.
third suppose that a group of cells fall into the situation where smells must have occurred.
how can one locate the smelly cells in the group?
for example the group formed by d3 in figure a and c3 in figure b d falls into a smelly situation but only c3 in figure c d are smelly.
for the first challenge we observe that table clones usually have the same header information.
inspired by existing fingerprint based clone detection technique s tablecheck uses cells header information as f ingerprints and group s cells with the same header information as table clones.
for the second challenge we observe that the formulas in table clones should reference their input cells similarly using relative indices.
thus we convert all formulas into their relative r1c1 formats e.g.
the formulas in d3 in figure a and c3 in figure b would be converted into the same formula rc r c in figure .
for the third challenge cells dissimilar to most of their corresponding ones can be identified as outliers.
such outlier s are a good indicator of smells.
.
preliminaries in this section we introduce the terminologies used in this paper .
.
spreadsheet programming model a spreadsheet can be modeled as a set of cells with expressions which are indexed by two dimensional cell addresses e.g.
c3 .
a cell may contain a formula which describe s the computation of this cell or contain s a plain value .
a formula