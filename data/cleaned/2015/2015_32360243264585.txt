augmenting stack overflow with api usage patterns mined from github anastasia reinhardt george fox university newberg oregon u.s. areinhardt14 georgefox.edutianyi zhang university of california los angeles los angeles california u.s. tianyi.zhang cs.ucla.edu mihir mathur university of california los angeles los angeles california u.s. mihirmathur ucla.edumiryung kim university of california los angeles los angeles california u.s. miryung cs.ucla.edu abstract programmers often consult q a websites such as stack overflow so to learn new apis.
however online code snippets are not always complete or reliable in terms of api usage.
to assess online code snippets we build a chrome extension examplecheck that detects api usage violations in so posts using api usage patterns mined from 380k github projects.
it quantifies how many github examples follow common api usage and illustrates how to remedy the detected violation in a given so snippet.
with examplecheck programmers can easily identify the pitfalls of a given so snippet and learn how much it deviates from common api usage patterns in github.
the demo video is at ccs concepts software and its engineering software reliability integrated and visual development environments keywords online q a forum api usage pattern code assessment acm reference format anastasia reinhardt tianyi zhang mihir mathur and miryung kim.
.
augmenting stack overflow with api usage patterns mined from github.
in proceedings of the 26th acm joint european software engineering conference and symposium on the foundations of software engineering esec fse november lake buena vista fl usa.
acm new york ny usa pages.
introduction programmers often search for online code examples to learn new apis.
a case study at google shows that developers issue an average of code search queries per weekday .
stack overflow work done as an intern at university of california los angeles.
corresponding author.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than the author s must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse november lake buena vista fl usa copyright held by the owner author s .
publication rights licensed to acm.
acm isbn .
.
.
.
pop up window api misuse description fix suggestion like or dislike supporting github examples pagination for multiple misusesfigure the examplecheck chrome extension that augments stack overflow with api misuse warnings.
the pop up window alerts that match number can be nullif the requested json attribute does not exist and will crash the program by throwing nullpointerexception when getasstring is called on it.
so is a popular q a website that programmers often resort to.
as of july stack overflow has accumulated more than million answers many of which contain code snippets for specific programming questions.
however so snippets are not always complete or reliable which can be misleading and sometimes harmful when programmers follow them as is during software development.
for example fischer et al.
find that of security related code snippets in stack overflow are insecure and might affect over million android apps in google play .
this tool demonstration paper builds on the api usage mining and api misuse detection technique described in our icse paper .
our insight is that common api usage inferred from a large corpus of 380k github projects may represent a desirable pattern that a programmer can use to examine and enhance so code snippets.
mined api usage patterns abstract away syntactic details such as variable names but retain the temporal ordering control structures and guard conditions of api calls.
this paper in particular focuses on the tool features and implementation details of a chrome extension called examplecheck that informs programmers about api usage violations in so posts.
figure shows a screenshot of examplecheck .
given a so post esec fse november lake buena vista fl usa anastasia reinhardt tianyi zhang mihir mathur and miryung kim api usage pattern databaseweb browser examplecheck server code code snippet code ... text ... ... text ...html page chrome extension code extraction popup generationinjectparsemethod call extraction message generationfix suggestion api misuse detectioncode snippet s javacall seqeuncequery patterns violationsjsonjsonjson violation message s fixed snippet s etc.
figure an overview of examplecheck s architecture examplecheck first extracts the sequence of api calls with corresponding control constructs and guard conditions.
examplecheck then contrasts the call sequence against the common api usage patterns mined from github.
to help users understand a detected violation examplecheck generates a descriptive warning message and illustrates how to fix the violation with corresponding github examples.
using common api usage patterns to detect violations may lead to false alarms since these mined common patterns do not necessarily represent correct api usage.
to mitigate this issue examplecheck allows users to upvote or downvote a reported violation based on its applicability and usefulness.
the resulting data set of mined api usage patterns detected violations in stack overflow and our manual inspection result are publicly available at html.
the chrome extension is available at chrome web store .
approach implementation this section describes the tool implementation details of examplecheck .
figure shows the architecture of examplecheck .
the api usage mining process is computed offline and the resulting patterns are stored in a database.
the technical details and evaluation of api usage mining technique is presented in our icse paper .
when a user loads a stack overflow page in the chrome browser the chrome extension extracts code snippets within code tags in answer posts and sends them to the back end server.
the back end then detects api usage violations in a snippet and synthesizes warning messages and corresponding fixes.
for each misused method call in a snippet the chrome extension generates a pop up window using the bootstrap popover plug in1to inform the user about the api misuse information.
api usage mining and the resulting pattern set.
our mining technique in leverages a distributed software mining infrastructure to search over the corpus of 380k github projects.
given an api method of interest it identifies code fragments that use the same method in the github corpus and performs program slicing to remove statements that are not related to the given method.
then it combines frequent subsequence mining and smtbased guard condition mining to retain important api usage features including the temporal ordering of related api calls enclosing control structures and guard conditions that protect an api call.
we evaluated the mining technique using api methods from mubench .
our mining technique has precision and recall when considering top patterns for each api method.
our prior work we mined api usage patterns of popular java api methods and carefully inspected inferred patterns based on online documentation.
as a result we curated a dataset of validated correct patterns for api misuse detection which covers api usages shown in 217k so posts in java.
these patterns are represented as api call sequences with surrounding control constructs.
each api call is also annotated with its argument types and guard conditions.
for example one pattern loop get int arg0 rcv.size checks if the index is out of bounds when calling the getmethod on an arraylist object.
api misuse detection.
given a code snippet sent from the browser the server first extracts the api call sequence from the snippet.
we use a partial program analysis and type resolution technique to parse incomplete snippets and resolve ambiguous types.
if a so snippet has multiple methods examplecheck inlines the call sequence of an invoked method into the sequence of the caller to emulate a lightweight inter procedural analysis.
examplecheck then queries the pattern database for the api calls present in each api call sequence.
given an api call sequence and an api usage pattern it checks whether the api calls and control constructs in the sequence follow the same temporal order in the pattern and the guard condition of an api call in the sequence implies the guard of the corresponding api call in the pattern.
examplecheck uses a smt solver z3 to check whether one guard condition implies another.
examplecheck is capable of detecting three types of api usage violations missing control constructs missing or incorrect order of api call and incorrect guard condition .
warning message generation.
given an api usage violation and the correct pattern examplecheck generates a warning message that describes the violation in natural language text.
table shows the warning message templates for different types of api usage violations.
in each template ?
is instantiated with the corresponding api calls or control constructs based on the detected api usage violation and the correct pattern.
before after is instantiated based on the relative order of the two api calls in the correct pattern.
the warning messages also describe which exception types are not handled in the snippets detected with missing try catch violations.
to help users understand the prevalence of a recommended api usage pattern the warning message also quantifies how many other code fragments follow the same pattern in github.
fix suggestion.
examplecheck further suggests a correct way of using an api method by synthesizing a readable fixed snippet based on the original so snippet.
examplecheck first matches each api call in the recommended api usage pattern with the given so snippet.
if an api call is matched examplecheck reuses the 881augmenting stack overflow with api usage patterns from github esec fse november lake buena vista fl usa table warning message templates for different types of api usage violations.
?
and before after are instantiated based on api usage violations and correct patterns.
the digits in the last column are the so post ids of the warning examples.
violation type description template example warning message missing incorrect order of api calls you may want to call ?
before after calling ?
you may want to call typedarray.recycle after calling typedarray.getstring .
missing control constructs you may want to call the api method ?
in ?
you may want to call cursor.close in a finally block.
missing try catchyou may want to handle the potential ?
exception thrown by ?
using a try catch blockyou may want to handle the potential sqlexception thrown by preparedstatement.setstring using a try catch block.
incorrect guard conditions you may want to check whether ?
is true before calling ?
you may want to check whether iterator.hasnext is true.
same receiver object and arguments of the corresponding api call from the original so snippet in the synthesized snippet.
otherwise examplecheck names the receiver and arguments based on their types.
for example if the receiver type of an unmatched api call i.e.
a missing api call violation is file examplecheck names the receiver object as file the lower case of the receiver type.
in this way examplecheck reduces the mental gap for switching between the original so post and the recommended snippet.
demonstration scenario suppose alice wants to read attribute values from a json message using google s gson library.
alice searches online and finds a related stack overflow post with an illustrative code example as shown in figure .2though this post is accepted as a correct answer it does not properly use the jsonelement.getasstring method which gets the string value of a json element.
for example if the requested attribute does not exist in the json message the preceding api call jsonobject.get will return null which consequently leads tonullpointexception when calling getasstring on the returned object.
if alice puts too much trust on this example of the so post she may inadvertently follow an unreliable solution which might lead to runtime errors in some corner cases.
alice cannot easily recognize the potential limitation of the given so post unless she manually investigates other similar code examples.
examplecheck frees alice from this manual investigation labor by contrasting a stack overflow post with common api usage patterns mined from over 380k github repositories.
examplecheck then highlights the potential api usage violations in the stack overflow post.
when alice clicks on a highlighted api call examplecheck generates a pop up window with detailed descriptions about the api usage violation as shown in figure .
api misuse description.
to help alice understand a detected api usage violation examplecheck translates the violation to a natural language description 1in figure .
from the warning message alice learns that she should check whether the jsonelement object isnull before calling getasstring .examplecheck also displays a message that github examples also follow this usage pattern.
such quantification can provide additional evidence about how many real world examples are different from the given so snippet.
fix suggestion.
examplecheck further sketches how to correct the violation in the original so post as shown in 3in figure .
this fix is an embodiment of the correct api usage pattern in the context of the so post.
to reduce the gap between the fix and the original post examplecheck reuses the same variable names in the figure a programmer can view a concrete code example from github that follows a correct api usage pattern when clicking on a github example link in the pop up window.
original so posts to generate a suggestion with improved api usage.
for example the jsonelement variable in the generated example is named as the same variable match number in the original post.
linking github examples.
to help alice understand how the same api method is used in real world projects examplecheck provides several github examples that follow the suggested api usage pattern 5in figure .
alice is curious about how others use jsonelement.getasstring .
when she clicks on the link of the first github example examplecheck redirects alice to a github page and automatically scrolls down to the java method where jsonelement.getasstring is called as shown in figure .
compared with the simplified so example in figure this github code is more carefully constructed with multiple ifchecks.
for example it not only checks whether the jsonelement object is null but also checks whether it is a primitive type to avoid classcastexception before calling getasstring .
by providing the traceability to concrete code examples in github alice could gain a more comprehensive view of correct api usage in production code which may not be illustrated in simplified code examples in stack overflow.
user feedback.
after investigating the concrete example in github alice finds it necessary to perform a null check.
she upvotes the pattern by clicking on the thumbs up button to notify 882esec fse november lake buena vista fl usa anastasia reinhardt tianyi zhang mihir mathur and miryung kim figure another api usage warning that reminds programmers to check whether the jsonelement object represents a json primitive value by calling isjsonprimitive .
it also suggests to catch potential exceptions thrown by getasstring .
other users that this detected violation is helpful 4in figure .
alice also finds that her decision resonates with the majority of examplecheck users since nine users also upvoted this violation.
multiple api usage violations.
if a method call in a so post violates multiple api usage patterns examplecheck displays them in separate pages in a pop up window.
these pages are first ranked by the vote score i.e.
upvotes minus downvotes of each violated pattern and then by the number of github examples that support a pattern if two patterns have the same vote score.
as shown in in figure the method call getasstring violates four api usage patterns.
figure shows the second violated pattern and suggests alice to check whether the jsonelement object represents a json primitive value before calling getasstring .
otherwise getasstring will throw classcastexception .examplecheck also suggests alice to wrap getasstring with a try catch block to handle potential exceptions.
this pattern is supported by github examples.
related work prior work has investigated the quality of code snippets in stack overflow.
several studies show that so snippets are often incomplete and the api names appearing in these snippets are hard to resolve .
zhou et al.
observe that of accepted so posts use deprecated apis but only of them are reported by other users .
fischer et al.
find that of security related so snippets are insecure and have potentially been reused to over million android apps on google play .
treude and robillard conduct a survey to investigate comprehension difficulty of code examples in stack overflow .
the responses from github users indicate that less than half of the so examples are self explanatory due to issues such as incomplete code and missing explanations.
though we draw motivation from these studies examplecheck focuses on detecting api usage violations by contrasting so code examples against common api usage patterns mined from github.
while examplecheck follows a similar style to codota codota does not group related examples based on common api usage does not quantify how many github code snippets support the common usage and doesnot detect api misuse by contrasting the so post against desirable api usage mined from github.
summary the main contribution of this paper is the design and implemenation of examplecheck which provides browser based tool support for systematically assessing and augmenting stack overflow with common api usage patterns mined from github.
in our previous work we examine 217k so posts with validated patterns and find that of so posts have potential api usage violations.
the first two authors manually inspect so posts with detected api usage violations and confirm real api misuse in posts which can produce symptoms such as program crashes and resource leaks if the posts are reused as is to target projects.
we also find that many unreliable examples are simplified to operate on crafted input data for illustration purposes only.
such curated examples could be insufficient for various input data and usage scenarios in real software systems especially for handling corner cases.
as future work we plan to conduct a longitudinal study with stack overflow users to understand the adoption and usage of examplecheck .
we will also investigate different weighting schemes for effectively ranking detected api usage violations.
acknowledgment participants in this project are supported by afrl grant fa875015 nsf grants ccf ccf ccf ccf onr grant n00014 and gift from huawei.