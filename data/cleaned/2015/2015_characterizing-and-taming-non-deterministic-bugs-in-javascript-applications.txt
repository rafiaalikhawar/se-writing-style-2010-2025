characterizing and taming non deterministic bugs in javascript applications jie wang state key lab of computer science institute of software chine se academy of sciences china university of chinese academy of sciences china wangjie12 otcaix.iscas.ac.cn abstract javascript has become one of the most popular programming language s for both client side and server side applications.
in javascript applications events may be generat ed triggered and consumed non deterministically.
thus javascript applications may suffer from non deterministic bugs when event s are triggered and consumed in an unexpected order.
in this proposal we aim to characterize and combat n o n d e t e r m i n i s t i c bugs in javascript applications.
specifically we first perform a comprehensive study about real world non deterministic bugs in server side javascript applications.
in order to facilitate bug diagnosis we further propose approaches to isolate the necessa ry events that are responsible for the occurrence of a failure.
we also plan to design new techniques in detecting non deterministic bugs in javascript applications.
index terms javascript node.js non deterministic bug empirical study record and replay bug detection.
i. introduction javascript has become the most popular language for clientside web applications.
according to recent survey s from stack overflow and node.js foundation javascript is also surpassing the popularity of other programming languages e.g.
php and java in server side applications.
for example node.js has become a popular server side javascript framework.
in both client and server sides javascript adopts eventdriven architecture.
in this architecture the events may be generated triggered and consumed non deterministically causing bugs that happens under a special event order.
we call such bugs as non deterministic bugs in this proposal.
non deterministic bugs can result in unreliable and unpredictable application behaviors such as crashes in server side applications and wrong outputs in client side applications.
non deterministic bugs in javascript applications have not been well addressed by existing work despite their importance.
first as far as we know no comprehensive study has been performed about nondeterministic bugs for javascript applications so we cannot well understand non deterministic bugs characteristics.
second there is still a lack of effecti ve tools for taming non deterministic bugs for javascript applications.
for example in debugging record replay techniques e.g.
mugshot can be used to record nondeterminism in javascript applications and facilitate failure diagnosis.
however record replay techniques usually record a long event trace and it is time consuming and exhausting to debug with such a long event trace.
for non deterministic bug detection there is no effective tool that can detect atomicity violation among events.
although the fuzz testing technique is proposed to increase the possibility to expose nondeterministic bugs in node.js there is still a lot of room for better approaches to combat non deterministic bugs.
in this proposal we target at characterizing and combating non deterministic bugs in event driven javascript applications.
specifically we address the following research problems.
first for better understanding non deterministic bugs we performed the first comprehensive study on real world non deterministic bugs in server side node.js applications .
we have carefully studied real world bug cases from open source node.js applications and analyzed their bug characteristics e.g.
bug patterns fixing strategies etc.
second to facilitate failure diagnosis we eliminate the side effects of non determinism by recording the event trace that r esults in a failure and then r educe the original event trace to a smaller event trace that is respo nsible for the occurrence of a failure.
in this respect we present a dynamic slicing based approach and a context based approach respectively.
third we are developing a tool for detecting atomicity violation bug s which are very common in node.js applications.
we have proposed several novel patterns to identify atomicity violation bugs.
ii.
r elated work bug studies.
existing bug studies in javascript mainly focus on client side javascript applications .
however these studies do not cover non deterministic bugs in javascript applications.
the study observes that non deterministic errors are common in web applications but it does not give an analysis on non deterministic bugs.
although node.fz provides an initial study on a small set of non deterministic b ugs only bugs in node.js we do not know whether the characteristics from these bugs can be generalized to more non deterministic bugs.
there are some studies on concurrency bugs in multi threaded and distributed systems .
however non deterministic bugs in server side javascript applications differ from those in traditional systems as they originate from different programming paradigms and execution environments.
concurrency bug analysis.
in recent years much research effort has been devoted to non deterministic bugs in event driven applications e.g.
android client side .
c circlecopyrt2017 ieeease urbana champaign il usa doctoral symposium1006 authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
and server side web applications .
our study shows that non deterministic bugs in node.js have different characteristic s in bug patterns manifestations and fix strategies.
thus those approaches may be ineffective for node.js.
event trace reduction.
dynamic slicing is effective in simplifying traces which computes the dynamic slice by building reachability graph.
however dynamic slicing faces dom specific challenges in javascript applications.
delta debugging is commonly use d for trace minimization and fault isolation.
hdd takes advantage of the hierarchical structure of the input such as xml to speed up delta debugging.
however hdd does not help our case since the input of the event trace reduction i.e.
event trace is not structured.
hamouddi et al.
adapts delta debugging to reduce event traces for web applications.
however it needs to try many infeasible candidate traces and is inefficient.
iii.
accomplished work in this section we introduce our approaches and results for our accomplished work.
first we perform a comprehensive study on real world bugs in server side javascript applications i.e.
node.js for better understanding of nondeterministic bugs caused by event ordering section iii.a .
second to help facilitate diagnosing non deterministic bugs w e eliminate the side effects of non determinism by recording the event trace that results in a failure and output a shortened e vent trace that can still reproduce the original failure.
to this end we propose a dynamic slicing based approach section iii.b .
third we find that some events are still irrelevant although dynamic slicing approach cannot remove them.
thus we further propose a context based approach to remo ve failure irrelevant events section iii.c .
although the proposed dynamic slicing based and context based approaches a re now implemented for clientside javascript applications they are also applicable for serv erside node.js applications.
a. a comprehensive study on re al world non deterministic bugs in node.js node.js as a server side javascript platform is relatively new and little is known about non deterministic bugs in real world node.js applications.
therefore we aim to conduct a comprehensive study on such non deterministic bugs in node.js applications.
our study tries to answer the following research questions z rq1 bug patterns and root causes what are common bug patterns of non determinisitic bugs in node.js?
what are their root causes?
z rq2 bug impacts do non determinisitic bugs have severe failure symptoms?
what impacts do they have in node.js applications?
z rq3 bug manifestation how do non determinisitic bugs manifest themselves in node.js?
how are nondeterminisitic bugs triggered e.g.
the timing condition input conditions?
z rq4 bug fix strategies how do developers fix nondeterminisitic bugs in node.js applications?
are there any common fix strategies?
in order to collect sufficient bugs for our study we directly collect non determinisitic bugs from all node.js projects in github.
first we use concurrencyrelated keywords concurrent race synchronization atomic mutex transaction deadlock compete and starve which is a union set of existing work to search candidate no ndeterminisitic bugs.
we aim to filter out the issues that are a bout code written in javascript marked as bugs already in closed state and have fixing solutions.
we obtain bugs after th is step.
then we manually check these bug reports and finally collect real world non determinisitic bugs in open source node.js projects.
the involved projects are popular avg.
stars well maintained avg.
revisions and issues complicated avg.
lines of code and from various categories including server side applications desktop applications and libraries .
result.
we thoroughly study these non determinisitic bugs and answer the above four research questions.
our main findings are as follows z non determinisitic bugs in node.js can be caused by atomicity violation order violation and starvation .
existing work mostly focuses on order violation in event driven applications .
this suggests that more research should be conducted on atomicity violation in node.js.
z most non determinisitic bugs contend against shared variables databases and files .
this suggests that besides shared variable non determinisitic bug detection approaches should pay more attention to shared resources like databases and files.
z apis in node.js are written in an asynchronous and event driven way.
they usually have unclear api protocols e.g.
event order and atomicity specifications .
the specifications are violated in of studied non determinisitic bugs indicating that developers may misunderstand the specificati ons of asynchronous apis.
z most non determinisitic bugs were fixed by a small set of fix strategies.
but only a small portion of bugs were fixed by simply adding synchronization e.g.
nested callbacks which is the main approach used by existing automated bug fixing approaches.
this indicates that further automated bug fixing approaches are needed.
b. jstrace fast reproducing web application bugs record replay techniques e.g.
mugshot can be used to record non determinism in client side javascript applications and reproduce a failure.
however the recorded event trace can be very long after a long run and lots of events in the record ed event trace may be irrelevant to the failure.
debugging with su ch a long trace is exhausting and time consuming.
a recent study shows that a shortened event trace can significantly increase programmers efficiency in failure diagnosis and fault localization.
we propose a dynamic slicing based approach jstrace to remove events irrelevant to the occurrence of the failure.
we have two key insights to re move failure irrelevant events.
if a recorded event never triggers any listener registered by authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
users we can safely remove it.
if an event e does not affect the variables that will be used by the erroneous event s handle r directly or indirectly then e can be removed.
to determine whether a variable may affect the variables in the erroneous event s handler we provide novel models to abstract the javascript and dom manipulation instructions to precisely capture data dependencies.
we also build the dependency between javascript instructions and dom instructions.
based on the captured data dependencies we build dependency relationships between events and based on this our slicing algorithm searches for the failure related events which are depended by the failure directly or indirectly.
result.
we have implemented the tool jstrace which is an enhanced record replay tool that can significantly remove irrelevant events while keeping the trace reproducible.
we have evaluated jstrace on real world bugs from popular web applications that belong to different domains.
the result shows that all bugs are successfully replayed and can remove most of the failure irrelevant events .
c. evmin context based event trace reduction jstrace adopts dynamic slicing to trace the precise program dependence and discards the events that are not depended by a failure.
however not all remaining events in jstrace are necessary to reproduce the failure.
e.g.
suppose an original event trace e a e2 a a e3 if a throw new error .
the event e2 is failure irrelevant since e1 e3 can faithfully reproduce the failure.
delta debugging can be used to minimize failureinducing events.
however delta debugging is slow because it may generate lots of infeasible candidate subtraces that may trigger syntactical errors e.g.
referenceerror .
we observe t hat if an event in the reduced subtrace can be replayed its context i.e.
variable usage information such as the existence of its accessed dom the type of accessed variables should keep the same as its corresponding event in the original trace.
based on this observation we propose evmin an effective and efficient approach to remove failure irre levant events from an event trac e. evmin iteratively generates a candidate subtrace of the original event trace and reruns the subtrace until it finds a failure reproducible trace i.e.
a trace that can reproduce the original failure .
in order to effectively and efficiently find a failure reproducible trace we utilize the context i.e.
preconditions of each event to guide the generation of subtrac es.
if an event e is selected in a candidate subtrace we require that the context of an event in a candidate subtrace should keep compatible with the context of its corresponding event in the original trace.
in this way we can generate shorter traces and avoid generating syntactically infeasible candidate event trace s. specifically for an event e i in the original trace if it is selected marking it as ei in the candidate event trace we say ei and ei have compatible contexts if the following two conditions are satisfied all the variables used by ei and e i are declared in the same scope with respect to their corresponding traces.
all the variables used by ei and ei have the same type with respect to their corresponding traces.
consider that the trace of neede d events for a failure is usually short i.e.
usually no mo re than evmin generates candidate traces from short to long so that it can find the failure reproducible trace earlier.
result.
we implemented evmin for client side javascript applications.
we evaluated evmin on real world bugs from popular web applications that belong to different domains in terms of effectiveness and performance.
we also compared evmin with delta debugging in terms of time and generated event traces.
the result shows that evmin can remove all irrelevant events for the evaluated subjects.
the performance o f evmin is acceptable.
evmin generates less event traces and costs less time overhead than delta debugging.
iv.
p lanned work a. event trace reduction in node.js applications non deterministic bugs in server side applications usually result in severe impacts according to our previous study section iii.a .
besides server side applications usually run for a very long time and lead to a long event trace and the events that a re caused by different requests may be heavily interleaved.
thus identifying the relevant events that are responsible for a fail ure and reproducing it to developers is very important for serverside applications .
we plan to develop dynamic slicing and delta debugging approaches and apply them on server side javascript applications.
we plan to carefully redesign the record replay tool for node.js and tackle the complicated event model of node.js.
we also need to design new approaches to make it scale to a long trace.
envisioned result.
we plan to evaluate our solution on popular real world open source node.js applications.
the approach is expected to be effective and yet efficient in reduc ing event traces in node.js applications especially long traces.
b. atomicity violation bug detection in node.js according to our previous study about two thirds of bugs are atomicity violation i.e.
av which indicates an urgent n eed for tools to detect atomicity violation bugs.
the main challeng es to detect atomicity violation bugs in node.js are as follows the atomicity intention i. e. some events should be processed uninterruptedly is unknown.
in node.js condition variable s are widely used to check whether some unexpected events have been processed or store program states that can be used to recover from unexpected event processing.
however these condition variables can introduce many false positives for bug detection.
we are now developing avdetector to detect atomicity violation bugs.
the reason why atomicity bugs are common is that developers often use cooperative multitasking and partition their operations into multiple asynchronous steps to avoid blocking the event loop leading to callback chains.
our soluti on is inspired by the observation that most atomicity violation bu gs happen due to a false assumption of atomicity across callback chains.
the interleaving between callback chains are very likel y to introduce atomicity violation bugs.
thus we plan to propose a pattern based approach to identify atomicity violation bugs.
for example for a read and write operated on the same variable v in the callbacks caused by a user request the variable v cannot be operated by the callback that caused by another user request .
if two asynchronous operations operate on the same resource e.g.
a file no other operations should operate on the same fi le.
these patterns certainly do not cover all kinds of av bugs.
we plan to propose more patterns to cover more av bugs.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
envisioned result.
we plan to evaluate avdetector on popular real world open source node.js applications and bugs studied in our empirical study.
it is expected that avdetector can effectively detect new non deterministic bugs.
v. conclusion non deterministic bugs are common in javascript applications and it takes time for debugging such bugs.
we firstly give a conprehensive study about non deterministic bugs in server side applications.
our findings can help better understand concurrency bugs in node.js applications and provide guidelines to many research fields sucha as testing and debugging.
further to tame non deterministic bugs.
we proposed a dynamic slicing based approach and a context based approach to reduce minimize a given event trace for client side applications so that developers can use a short event trace fo r diagonsing.
our envaluation shows our proposed approaches can effectively and efficiently reduce a given event trace.
we also planed to propose techniques to detect non deterministic bugs especially for detecting atomicity violation bugs in serv erside applications.
this approach is envisioned to be effective in finding new bugs.