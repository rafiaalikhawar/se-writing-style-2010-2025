whyaren tregularexpressionsa linguafranca?
an empirical study onthe re useand portabilityofregularexpressions james c. davis davisjam vt.edu virginiatech usalouis g.michael iv louism vt.edu virginiatech usachristya.coghlan ccogs vt.edu virginiatech usa franciscoservant fservant vt.edu virginiatech usadongyoonlee dongyoon vt.edu virginiatech usa abstract thispaperexplorestheextenttowhichregularexpressions regexes areportableacrossprogramminglanguages.manylanguagesoffersimilarregexsyntaxes anditwouldbenaturaltoassumethat regexes can be ported across language boundaries.
but can regexes becopy pastedacrosslanguageboundarieswhileretainingtheir semantic andperformance characteristics?
inoursurveyof158professionalsoftwaredevelopers mostindicatedthattheyre useregexesacrosslanguageboundariesandabout halfreportedthattheybelieveregexesareauniversallanguage.we experimentallyevaluatedtheriskinessofthispracticeusinganovel regex corpus regexes from projects written in javascript java php python ruby go perl andrust.using our polyglotregexcorpus weexploredthehitherto unstudied regex portability problems logic errors due to semantic differences andsecurity vulnerabilitiesdueto performance differences.
we report that developers belief ina regex lingua franca is understandable but unfounded.
though most regexes compile across language boundaries exhibitsemanticdifferencesacross languagesand exhibitperformance differencesacrosslanguages.
we explained these differences using regex documentation and furtherilluminateourfindingsbyinvestigatingregexengineimplementations.
along the way we found bugs in the regex engines ofjavascript v8 python ruby andrust andpotentialsemantic andperformance regex bugsinthousandsofmodules.
ccs concepts software and its engineering reusability social and professional topics softwareselectionand adaptation .
keywords regular expressions developer perceptions re use portability empirical software engineering mining software repositories redos christy a. coghlan is nowemployed by google inc. permissionto make digitalor hard copies of allorpart ofthis work for personalor classroom use is granted without fee provided that copies are not made or distributed forprofitorcommercialadvantageandthatcopiesbearthisnoticeandthefullcitation onthefirstpage.copyrights forcomponentsofthisworkownedbyothersthanthe author s mustbehonored.abstractingwithcreditispermitted.tocopyotherwise or republish topostonserversortoredistributetolists requirespriorspecificpermission and or a fee.
request permissions from permissions acm.org.
esec fse august 26 30 tallinn estonia copyright heldby the owner author s .
publicationrightslicensed to acm.
acm isbn ... .
format jamesc.davis louisg.michaeliv christya.coghlan franciscoservant anddongyoonlee.
.whyaren tregularexpressionsalinguafranca?
anempiricalstudyonthere useandportabilityofregularexpressions.in proceedingsofthe27thacmjointeuropeansoftwareengineeringconference andsymposiumonthefoundationsofsoftwareengineering esec fse august 26 30 tallinn estonia.
acm new york ny usa 12pages.
introduction regular expressions regexes are a core component of modern programminglanguages.
regexes are commonly used fortext processing and input sanitization appearing for example in an estimated30 ofopen sourcepythonandjavascriptprojects .however craftingacorrectregexisdifficult anddevelopers may prefer to re use an existing regex than write it from scratch.
they might turn to regex repositories like regexlib ortostackoverflow where regex isapopulartag ortoother softwareprojects.forexample aregexderivedfromthenode.js pathmoduleappears inmore than2 javascript projects .
correctness and security are fundamental problems in software engineeringingeneral andforregexesinparticular re usingregexes can be risky .
like other code snippets regexes may flow into softwarefrominternetforumsorothersoftwareprojects.unlike mostcodesnippets however regexescanflowunchangedacross languageboundaries.programminglanguageshavesimilarregex syntaxes so re used regexes may compile without modification.
however surface level syntactic compatibility can mask more subtlesemantic andperformance portability problems.
if regex semantics vary then a regex will match different sets of strings across programming languages resulting in logical errors.
if regex performancevaries aregexmayhavedifferingworst casebehavior exposing service providersto security vulnerabilities .
despitethewidespreaduseofregexesinpractice theresearch literature is nearly silent about regex re use and portability.
we knowonlyanecdotallythatsomedevelopersstrugglewith inconsistencies across .
in this paper we explored the coupled concepts of cross language regex re use and regex portabilityusingamixed methodsapproach.first wesurveyed158 professional developers to better understandtheir regex practices 4 andempiricallycorroboratedtheregexre usepracticesthey reported .
then we investigated the extent to which these practices may result in bugs.
we empirically measured semantic and performance portability problems attempted to explain these problems using existing regex documentation and explored regex esec fse august tallinn estonia james c.davis louisg.michaeliv christy a.coghlan francisco servant anddongyoonlee engine implementations to illuminate our findings .
we are not thefirsttoobserveregexportabilityissues butwearethefirstto provideevidenceofthe extentandimpact ofthe phenomenon.
our contributionsare we describe the regex re usepractices of158developers .
we present a first of its kind polyglot regex corpus consisting of unique regexes extracted from software projects written in8popular programminglanguages .
weempiricallyshowthatregexre useiswidespread bothwithin andacrosslanguagesandfrom internet sources .
weidentify andexplainsemanticandperformanceregex portability problems .
we report that approximately of the regexes in our corpus have semantic portability problems while have performance portability problems.
most of these problems could not be explained using existing regex documentation.
weidentifythousandsofpotentialregexbugsinrealsoftware as well as bugsinjavascript v8 python ruby andrust .
background .
regexdialects most programming languages support regexes providing developerswithaconcisemeansofdescribingasetofstrings.therehas beennosuccessfulspecificationofregexsyntaxandsemantics perlcompatibleregularexpressions pcre andposixregular expressions have influenced but not standardized the various regexdialectsthatprogramminglanguagessupport leadingtomanualswithphraseslike theseaspects...maynotbefullyportable .
anecdotally inconsistentbehaviorhasbeenreportedevenbetween differentimplementations ofthe same regex specification .
thislackofstandardizationmaycomeasnosurprisetodevelopersfamiliarwithregexesasalibraryfeatureratherthanalanguage primitive.
but for the latest generation of developers regexes have alwaysbeenpartoftheprogramminglanguage andbecausethe regex dialects are similar in syntax it would be natural for developers to assume that they are in fact a lingua franca .
we report thatmanydevelopersdomakethisassumption andweexplorethe potentialconsequencesbyinvestigatingthedistinctsemanticand performance characteristics ofmanyregex dialects.
.
regexdenialofservice redos under the hood programming languages implement a regex enginetotestcandidate inputsformembershipinthelanguageofa regex.
most regex engines evaluate a regex match by simulating thebehaviorofanequivalentfiniteautomaton deterministicor non on the candidate string but they vary widely in the particular algorithm used.
despite the recommendations of automata theorists inmostprogramminglanguagesaregexmatch may require greater than linear time in the length of the regex andtheinputstring.suchasuper linear sl matchmayrequire polynomialorexponential time inthe worst case .
slregexbehaviorhadlongbeenconsideredanunlikelyattack vector in practice but in the past year this has begun to change.
daviset al.
and staicu and pradel identified regular expression denial of service redos as a major problem facing node.js applications and davis et al.reported thousands of sl regexesaffectingover10 000javascriptprojects .althoughit isknownthatsl regexbehavioris possibleinjavascript python and java from a portability perspective we do not know the relative risk of redos across different programming languages.
cox has suggested that languages fall into two classes ofperformance thoughhedidnotsystematicallysupporthisclaim.
.
developerpractices around regexes despite the widespread use of regexes in practice surprisingly little is known about how software developers write and maintain them.
recent studies have shed some light on the typical languages developers encode in regexes the relative readabilityofdifferentregex notations developerregextestpractices anddeveloper regex maintenancepractices .
mostoftheseworkshavefocusedonsoftwareartifactsrather than on developers thought processes and day to day practices.
the only previous qualitative perspective on developers approach to regex development is chapman and stolee s exploratory survey of professional software developers employed by a single company .
they reported high level regex practices like the frequencywithwhichthosedevelopersuseregexesandthetasks they use regexesfor.
research questions in this work we seek to better understand developer regex re use practices and understand the potential risks they face.
first we survey professional software developers to learn their regex perceptionsandpractices.wethenmeasureregexre usepracticesin real software to corroborate the findings of our survey.
finally we empiricallyevaluatethesemanticandperformanceportabilityproblems that may result from cross language regex re use practices andexplaindifferences acrosslanguages.our research questions theme1 developerperspectives rq1 dodevelopers re useregexes?
rq2 where do developers re useregexesfrom?
rq3 dodevelopers believe regexesare a linguafranca ?
theme2 measuringregex re use rq4 howcommonly are regexesre usedfrom othersoftware?
rq5 howcommonly are regexesre usedfrom internet sources?
theme3 empirical portability rq6 semanticportability whenandwhydoregexesmatchdifferentsetsofstrings indifferentprogramming languages?
rq7 performance portability when and why do regexes have different worst case performance in different programming languages?
theme1 developer perspectives we surveyed developers to better understand regex re use and portability issuesfrom their perspective.
findings rq1 of developers re useregexes rq2 commonly from stackoverflowandothercode.
rq3 ofdevelopers treatregexeslike a linguafranca .
.
methodology surveycontent.
wedevelopeda33 questionsurveywithamixof closed and open ended questions.
we asked participants about theprocesstheyfollowwhenwritingregexes theirregexre use 444whyaren t regular expressions alingua franca?
esec fse august tallinn estonia practices and what awareness they have of regex portability problems1.wedraftedoursurveybasedondiscussionswithprofessionalsoftwaredevelopers andfollowedbestpracticesinsurvey design .
we refined the survey through internal iteration andtwopilotrounds withgraduatestudents.
survey deployment.
after obtaining approval from our institution sethics board we took atwo prongedapproach to surveying professional developers.
first following the snowball sampling methodology we asked developers of our acquaintance to take the survey and propagate it to their colleagues.
second to diversify our population we posted the survey on popular internetmessageboardsfrequentedbysoftwaredevelopers hackernews andreddit r samplesize r coding andr compsci .
we compensatedrespondentswitha amazongiftcard.
filtering results.
we received some invalid responses from users on the internet message boards.
we manually inspected the first 100responsestodevelopfiltersforvalidity.wereportonresponses thattookatleast5minutes wereinternallyconsistent andgave a thoughtful answer to at least one of our open ended questions.
this filteredout253responses mostly from aspoofing campaign.
.
results demographics.
wereceived158validresponsesfromprofessional software developers.
our responses came from direct and indirect professional contacts and internet message boards with no trackinginformationfor responses.the medianrespondenthas 5years of professional experience works at amediumsize company andclaims intermediate regex skill2 figure1 .
rq1 re use prevalence.
almost all of respondents indicated that they re use regexes with indicating that they re use aregexat leasthalfofthe timethat they usearegex figure a .
the most frequent reason to re use a regex was to meet a common usecase e.g.
matchingemails.thissupportsaprevioushypothesis that developers may write regexes for a few common reasons .
participants also mentioned time savings a good programmer doesn tre inventthe wheel.
rq2 re use sources.
developers most frequently said they reuse regexes from stack overflow but they often re use regexes fromothercode includingtheirown acolleague s oropen source projects figure b .
about of respondents reported re using regexesfromsomeinternetsource andabout90 reportedre using regexesfrom othercode.
rq3 developerperceptionof linguafranca .weaskeddevelopers if their regex design process was influenced by language.
figure3 a showsthat47 ofourrespondentsdonothaveadesign process that is language specific.
and their actions match their beliefs as shown in figure b respondents frequently re use regexeswithoutbeingconfidentthattheywerewritteninthesame language.
only of respondents were confident they never re usedacrosslanguageboundaries.
1dueto space limits wedo not report allresults.
2regexskillwasself reportedonascalefromnovicetomaster basedonfamiliarity with increasingly complex regex features according to friedl .
intermediate for example youhaveusedmoresophisticatedfeatureslikenon greedyquantifiers a ?
and characterclasses d w .
5 polyglotregex corpus inordertoanswerourremainingresearchquestionsweneededa polyglotregexcorpus asetofregexesextractedfromalargesample of software projects written in many programming languages.
the existing regex corpuses are small scale or include only two programminglanguages .
ourcorpus is neither covering about projects in programming languages see table .
figure our survey reached adiverseset ofdevelopers.
figure a when developers must use a regex they frequently re use them from another source.
b developers commonly re use fromthe internetand other software.
languages.
weareinterestedinstudyingcommonregexpractices andasaresultwefocusourattentionon major programminglanguagesdefinedbytwoconditions thelanguagehasalargemodule ecosystem the language is widely used by the open source community.weoperationalizedtheseconceptsbyconsultingthe modulecountswebsite andthegithublanguagepopularity report .
we also considered go perl and rust for scientific interest perl popularized the idea of regexes as a first class language member andgoandrustarerelativelynewmainstreamlanguages.
softwareprojects.
withintheselanguages wechosetostudythe software modules published in each language s primary module registryfor two reasons.
first it permits a relatively fair crosslanguage comparison since we observe that many modules fill equivalent ecological niches e.g.
logging or schema validation.
second wefeelthatmodulesareofgreatergeneralinterestthan applications.modulesarepublished maintained andusedbyamix of open source and commercial software developers and bugs and security vulnerabilitiesinmoduleshave asignificant rippleeffect.
3wealsoextractedregexesfromtypescriptsourcecode bytranspilingittojavascript.
445esec fse august tallinn estonia james c.davis louisg.michaeliv christy a.coghlan francisco servant anddongyoonlee figure a many developers design regexes without considering the programming language.
b developers regex re usedecisionsalsoimplybeliefinregexasa linguafranca .
table our regex corpus was derived from software writtenin8programminglanguages.thefirstfivelanguagesare ranked by the most available libraries modulecounts and popularity in open source github .
we also studied go perl and rust out of scientific interest.
the two final columnsshow thecontributionto our corpus.
lang.
registry libs.
gh mod.
anal.
uniqueregexes avg.
javascript3 npm .
java maven .
php packagist .
python pypi .
ruby rubygems .
go gopm .
perl cpan all .
rust crates.io all .
sum our goal was to analyze the most important modules in each language s primary module registry.
to have a uniform measure of importance across languages we filtered each registry for the modules available ongithub sorted those by thenumber ofstars and analyzed the top modules from each registry.
borges and valente recently showed that github star count is a reasonableproxyforimportance .unsurprisingly wefoundthatthe distributionofgithubstarswassimilarforthemodulesineachlanguage and analyzing the top modules typically captured all butthe verylong tailof0 2stars.perlandrusthadrelativelyfew modulesintheirregistries andwe analyzedalloftheirmodules.
regex extraction.
following for each module we cloned the head of its default branch from github and extracted any statically declared regexes.
we extracted regexes declared in regex evaluations as well as regexes compiled and stored in variables for later use.
in each module we extracted regexes only from source filesinthelanguagecorrespondingtotheregistry omittingregexes inplaceslike buildscripts written inanotherlanguage.polyglotregexcorpus.
ourcorpuscontains537 806uniqueregexes extracted from projects written in programming languages.eachlanguage scontributionsarelistedintable .average regex usevarieswidelybylanguage from .2regexespermodule rust upto6.1regexespermodule ruby .thetotaluniqueregexes by language exceeds due to inter language duplicates .
theme2 measuring regex re use the developers in our survey indicated that they re use regexes from other software and from internet sources like stack overflow.
they also reported re using regexes across language boundaries.
in this theme we corroborate their report by measuring the extent ofregex re use modulesthat use non unique regexes.
definitionofre use.
tothebestofourknowledgewearethefirst to attempt to measure regex re use.
as a first approximation in keeping withthephrasing inour survey copy pasting regexes we label as re use any pair of identical regexes string equality .
to eliminate trivially identical regexes like s we conservatively requireanymatchingregexestobeatleast15characterslong.while it is possible that two developers might independently produce the same longer regex this seems unlikely given that hundreds of distinct regexes have been reported even for simple languages likeemails .wedonotconsiderlessstrictmeasuresofregex equivalencelikestring orbehavioral similarity though suchmeasuresmightbettercapturethe shipoftheseus approach to regex re usedescribedbysomeof our survey respondents.
findings rq4 thousandsofcorpusmodules share thesamecomplexregexes bothwithinandacrosslanguages.
rq5 of all corpus modules about primarily in javascript use regexesfrom stackoverflowandregexlib.
.
rq4 re usefrom othersoftware howmuchintra inter languageregexre useoccursinourcorpus?
.
.
methodology.
whendevelopingourregexcorpus we tracked the modules and registries in which each regex was found.
as noted above we only consider as re use candidates the regexes that are at least characters long.
when such a regex appeared inmultiplemodulesinthe sameregistry wemarkthosemodules ascontaininganintra languageduplicate.whensucharegexappeared in at least one module in differentregistries we mark those modulesascontaininganinter languageduplicate.note then that for a single duplicated regex we may mark several modules as containing intra language duplicates and or inter language duplicates.
.
.
results.
the extent of intra and inter language regex reuse by modules is shown in figure second and third bars .
developers re use regexes in the modules in every language some more than others.
in most languages or more of the modules contain an intra language duplicate and inter language duplicates are also common.
these duplicates are often due to popular regexes.
forexample wefoundthe16 character email regex in476modules.
446whyaren t regular expressions alingua franca?
esec fse august tallinn estonia figure empirical regex re use practices by language.
.
rq5 re usefrom internetsources the developers in our survey frequently indicated that they re use regexesfromoneoftwointernetsources regexlib andstack overflow .
nextwe use our corpusto corroboratetheirclaims.
.
.
methodology.
weextractedregexesfromregexlibandstack overflow and then searched our corpus for matches.
in both of these relatively unstructured internet regex sources the resulting set of regexes may include false positives it is the intersection ofourcorpusandthesesetsthatisofinterest.anintersectionis acasewherearealregexfrom ourcorpusalsoappearedverbatim in one of these internet sources.
any module that contained one ofthese 15charactersorlonger internetregexeswasmarkedas containingan internet duplicate.
regexlib regexes.
weobtainedareasonablycompletedumpof the regexlibdatabasebysearching for all regexes .
stack overflow regexes.
for stack overflow we relied on the regex tag to identify regexes.
through manual analysis we found that questions and posts with the regex tag commonly denote regexesusingcodesnippets.usingallstackoverflowpostsasof september we found all questions tagged with regex as well as the answers to those questions and automatically extracted codesnippetsfromthoseposts.tofilter wethenremovedsnippets that containednoregex like characters basedontable4of .
.
.
results.
ourfindingsareshowninfigure fourthbarfor eachlanguage .manyofthemodulesinourcorpuscontainatleast oneinternetregex.thispracticeismostcommoninjavascript ofnpmmodulescontain an internet regex.
theme3 empiricalportability having shown that developers re use regexes across language boundaries now we experiment on our polyglot regex corpus to investigatetheimplicationsofcopy pastingaregexfromonelanguagetoanother.firstweconsidersemanticportability .
then performance portability .
.
experimentalparameters.
theseexperimentswereperformed ona node cluster of server class nodes.
we usedthe same base toolsinbothexperiments atesterforeachofthe8languages.each 4see .table2 summaryoflanguageversionsanddocsusedinour experiments.
most are at the default forubuntu .
.
language version information documentation javascript node.js v10.
.
v8 v6.
java oraclejdk php php .
.
dev cli python python3.
.
ruby ruby .
.1p112 go go v1.
.
perl perlv5.
.
rust rust v1.
.
nightly testeracceptsaregexpatternandinputandattemptsapartialregex match.
table 2liststhe languageversionsusedinour tests.
when we compare a regex s behavior in a pair of languages we use the subset of the regex corpus that is syntactically valid in that pair.thissimulatestheregexre usepracticesweidentified.most comparisons are on the majority of the corpus of the corpus wasvalid inevery language and88 were valid inallbut rust.
findings rq6 of regexes exhibit documented and undocumented semantic differences.
rq7 of regexes exhibitperformance differences due to regex engine algorithms andoptimizations.
.
rq6 semantic portability problems when two languages express the same feature using different syntax developersfaceatranslationproblem.butwhentwolanguages exhibit different features or behaviors for the same syntax developersmustsolveasemanticproblem.inthissectionweempirically study the semantic portability problems that developers mayface.
.
.
methodology.
to understandvariations in regex semantics we testedthe behaviorofeachregexinour corpusonavarietyof inputsineachlanguageofinterest.anyinconsistentregexbehavior across languages is something a developer would have to discover andaddressafter re using the regex.
input generation.
in search of an interesting set of inputs we created an ensemble of five state of the art regex input generators rex mutrex egret rescue and brics .
thesegeneratorsproduceeithermatchingstrings rex brics or both matching and mismatching strings mutrex egret rescue .
weusedrex mutrex andegretunchanged.wemodifiedrescue tousethestringsitexploresinitssearchforslinputs.wemodified brics to generate random input subsets not infinitely many inputs.
wewantedtheseinputstoprovidegoodregexautomatoncoverage.
wang and stolee showed that100 rex generated inputs yield about regex coverage so we requested inputs from each input generator with a time limit of seconds.
table summarizes the number of unique inputs generated for each regex.
attempted match.
for each regex for each input for each programming language that supported it we tested for a match using partial matchsemantics5.onamatch werecorded thesubstring that matched and the contentsof capture groups.
5we used default flags.
as the languages in our study support around distinct regexflags evaluatingameaningful subset of the flagcombinationswas infeasible.
447esec fse august tallinn estonia james c.davis louisg.michaeliv christy a.coghlan francisco servant anddongyoonlee table statistics forsemantic portability experiment.
metric value percentileinputsperregex 25th 50th 75th1 regexeswithany difference witnesses .
regexeswithany matchwitnesses .
regexeswithany substring witnesses .
regexeswithany capturewitnesses .
witnesses.
some pairs of languages may perfectly agree on the behavior of a regex on all of its inputs others may not.
we refer to re ex input pairsthatproducedifferentbehaviorindifferent programming languages as difference witnesses between those languages anddistinguishbetween three disjointtypes ofwitnesses matchwitness languagesdisagreeonwhetherthereisamatch.
substring witness languages agree that there is a match but disagree aboutthe matching substring.
capture witness languages agree on the match and the matchingsubstring butdisagreeaboutthedivisionofthesubstring intoany capture groupsofthe regex.
.
.
results.
table3summarizesourresults.about15 ofregexes participatedinatleastonedifferencewitness andamongthelanguagepairsweobservedallthreeclassesofwitnesses.intable andfigure 5wereportthenumberofdistinctregexesparticipating in the difference witnesses rather than the number ofdistinct witnesses themselves because we expect that many of the witnessing inputs for a given regex are members of an equivalence class on whichadifference manifests.
amoredetaileddescriptionofthesemanticdifferencesbetween languages is presented in figure .
the cells are colored proportionaltothenumberofregexesthathaveanywitnessofadifference betweenthatpairoflanguages.thethreenumbersinthecelldenote the percent6of regexes with match substring and capture witnesses for that pair of languages.
as can be seen in figure there are many language pairs with match witnesses php and python are the primary sources of substring witnesses and php is the primary sourceofcapture witnesses.
.
.
analysis.
wedevelopedanautomatictool the cross examiner toestimatethecausesofthedifferencewitnessesidentifiedthrough our experiment.
we iteratively examined unclassified witnesses referenced the regex documentation for the disagreeing languages understood the reason for the different behaviors where documented and encoded heuristics to classify witnesses as due to thisbehavior.
thecauseswe identifiedaresummarized intable .
approximately of witnesses could be explained byone ormore ofthesecauses.
table4differentiatesthewitnessesbytype.thefirstgroupof witnessesarecaseswheresomelanguagessupportafeaturethat others do not.
in the second group languages use the same syntax fordifferentfeatures.thethirdgrouparecaseswherelanguages use the same syntax for the same features but exhibit different behavior.the final group are bugswe identified describedbelow.
6at the scaleof ourcorpus eachpercentage pointrepresents about 300regexes.
figure5 symmetric pairwiseviewofdifferencewitnesses by language and type.
the individual cells indicate the percent of the regex corpus with at least one m atch s ubstring and c apture witnesses in that language pair anddarkercellsindicatethatregexesmorecommonlyhave difference witnesses in that pair of languages.
for example java go andrust generally agree on regex behavior.
documented semantics.
westudiedeachlanguage sregexdocumentation to see if these witnesses could be easily explained.comparingthegreycellsandboldfacingintable wenote that more than half of the unusual behaviors were unspecified in that language s documentation.
testing not reading the manual istheonlyway fordevelopers to learn these behaviors.
.
.
regexenginetesting.
thoughinthisexperimentweassumed thattheregexenginesweretrustworthy ourmethodologycanbe viewedasamixoffuzz anddifferential testing.undera lingua franca hypothesis if languages disagree then at least one of themiswrong.duringourexaminationofdifferencewitnesses we identified five cases where one language disagreed with the others andits behavior was inconsistent with the corresponding regex documentation.
we opened bug reports based on the behaviors brieflydescribedinthethirdsectionoftable .sofarthebugshave been confirmedinv8 javascript python ruby andrust.
.
rq7 performance portability problems programming languages have distinct regex engines which may exhibitdifferentperformancecharacteristics.are usedregexmight have worse worst case performance in its new language than in its languageoforigin.forexample softwarebeingportedfromphp to node.js might develop regular expression denial of service redos vulnerabilitiesbecauseregexes often have worse worst case performance in node.js.
in this experiment we measure the frequency with which regexes have different worst case performance characteristics indifferentprogramming languages.
.
.
methodology.
wegenerallyfollowthemethodologyofdavis etal.
andusetheirtoolsinbrief foreachregexwe query an ensemble of state of the art super linear regex detectors and 448whyaren t regular expressions alingua franca?
esec fse august tallinn estonia table difference witnesses identified during our semantic portability experiment.
each row indicates a witness regex the expected behavior s and each language s interpretation.
the first three groups describe different classes of valid but semantically distinct behavior.
the final group describes the bugs we found e means engine d means docs.
boldface indicates potentially surprisingbehavior cf.
.
indicateslanguageswhereafeaturecausessyntaxerrors.thebehaviorinthegrey cellswas notspecified inthedocumentation.
witness description javascript java php python ruby go perl rust false friends regexnotationdescribes afeaturein onelanguage andnofeaturein another.
qa e quote directive qae qae quote quote qae qae quote quote g matchassertion g g assertion assertion g assertion assertion ab z anchors abz abz anchors anchors anchors anchors anchors a z endof line az az eol eol az eol eol eol eol k matchreset k k reset k reset reset e esc e e esc esc e esc esc cc ctrl c cc ctrl c ctrl c ctrl c cc ctrl c ctrl c x a hex x...x x...x a a a a a a g1 backref notation ag1 ag1 backref ag1 ag1 backref a g backref notation ag ag backref ag backref p n unicodedigit pn p n p n pn unicodedigit pn pn digit digit pn pn digit digit digit digit custom char.
class ccc ccc ccc digit ccc digit digit digit digit false friends the same regexnotationdescribes different features.
a beginningof input orline input input input input line input input input a possessivequantifier regular possessive possessive possessive possessive regular a backref octal backref backref backref backref backref backref octal h horz.whitespace hex h h whitespace whitespace h hex whitespace nuanced the same regexnotationdescribes the same feature but engines exhibit subtlydifferent behavior.
a ?
b b named and unnamed capturegroups?
both both both named only both cccof empty ccc empty a diff.captureof on aa aa empty empty empty empty aa empty aa a b diff.captureof on ab empty a a a a a a a bugswefound in regexengines.
e python ab a ?b diff.captureof oninput ab a a a empty a a a a e rust aa ?
matched substring on aaz empty empty empty empty empty empty empty aa e rust a d .
?
d b matched substring on a0.0c a0 a0 a0 a0 a0 a0 a0 a0.0 e javascript complicated input ordermatters?
yes no no no no no no no d oraclejava s matchesbeforefinal r?
no yes no no no no no no d ruby a ?
lazy aa optional aa lazy lazy lazy lazy optional lazy lazy lazy then evaluateanypredictedsuper linearregexbehaviorsineach languageofinterestusing partial matchsemantics.
experimentalparameters.
weallowedeachofthedetectorsto evaluate a regex for up to seconds using no more than gb of memory.
if a detector predicted that a regex would be superlinear we evaluated its proposed worst case input in each of the languages in our study using input strings intended to trigger exponentialorpolynomialbehavior7.ifaregexmatchtookmore than10 secondsinsomelanguage we markeditas super linear.
reducingfalsepositives.
weextendedtheirmethodologyintwo waystoreducethenumberoffalsenegatives i.e.
slregexesmarked as linear time .
first we added shen et al.
s new dynamic sl regex detector to their ensemble .
more critically we introduce a new technique that identifies both polynomial and exponential sl regexes that their detector ensemble would not detect.thestaticdetectorsintheirensemble assumefull match semantics and do not scale well to regexes with large nfas.
we combat these problems by querying detectors with the original regex as well as regex variants that they can more readilyanalyze.
thefirstqueryvariantaddressesan unrealisticassumption inthe analysisperformedbysomeofthedetectorsintheensemble .
although thesedetectors assumethat the regex engine 7weused 100pumps for exponential and pumps for polynomial.is using full match semantics regex engines generally default to partial matchsemantics.forexample somedetectorspredictlinear behavior for a but it is quadratic in many languages when used with a partial match api.
to address this assumption we query the detector ensemble with an anchored full match variant ofunanchoredregexes e.g.
?a .
thesecondqueryvariantaddresses inefficientimplementations in the detector ensemble.
some of the detectors exceed our time limit on regexes with large nfa representations.
for example they time out on the exponential regex a because its nfa explodes in size.
to account for this inefficiency we query the detector ensemble with variants that replace bounded quantifiers withunboundedones e.g.
a .
thesevariantsreducetherateoffalsenegativeswithoutintroducingfalsepositives.althoughwequerythedetectorensemble on several variants we always test any worst case input on the originalregex dynamic validation .thefirst variantmay unmask polynomialregexesthatwouldotherwisegoundetected andthe secondmayidentifyboth polynomialandexponential regexes.
.
.
results.
figure6illustratestheextenttowhichtheregexes in our polyglot corpus exhibit worst case super linear behavior in eachofthe 8languagesunderstudy.
figure6indicatesthatslregexesmaybemorecommon byup toanorderofmagnitude!
thanwaspreviouslyreported .the 449esec fse august tallinn estonia james c.davis louisg.michaeliv christy a.coghlan francisco servant anddongyoonlee figure proportion of sl regexes in each language.
there are three distinct families of worst case regex performance.
we identified no regexes with exponential behavior in go and rust and only regexes had polynomial behavior in thoselanguages.regexeswithexponentialbehaviorarerare inphpandperl perl 227 php 0 butpolynomialbehaviorstilloccurs.incontrast over1 000regexeshaveexponentialbehaviorinruby java javascript andpython andpolynomialbehaviorisalsomore commoninthoselanguages.
majorityofthenewly discoveredregexeswereidentifiedthrough our variant testing technique as expected the new detector by shenet al.
identified only exponential regexes of them .
our results agree with a small scale estimate in java .
althoughfigure 6doesnotprovideadirectcomparisonto the same larger proportions occur when considering the subset of our corpusderivedfrom javascript andpython as theirswas .
.
.
analysis.
theproportionofregexesthatexhibitexponential andpolynomialworst casebehaviorvarieswidelybylanguage.the regex engines in these languages appear to fall into three families slow javascript java python ruby medium php perl and fast go rust .
to clarify this taxonomy figure 7shows the frequency with which regexes exhibit worsebehavior in one of apairoflanguages.forexample weseethatthe ofregexes thataresuper linearinbothjavaandjavascript cf.figure are thesameregexes.theworst caseperformanceofa regexgenerally worsens when moved between these families but not within them.
inthissectionweexplorethereasonsbehindthesethreefamilies ofregexperformance.westudiedthelanguagedocumentationand the implementation of these engines and identified a variety of mechanisms by which some regex engines fall prey to super linear behaviorandothersavoid it.
documented performance.
we studied each language s regex documentation toseewhetheritsworst caseperformance isdiscussed.javascript java andpythononlyprovidetipsonminor optimizations.
php and ruby comment vaguely on worst case performance can take a long time to run .
the best documentation explicitly states worst case expectations linear rust and go or exponential perl .
similar to the semantic behaviors in table4 in most languages these performance differences can only be identifiedthroughexperimentation.
figure pairwise view of regex performance differences.
cellsarecoloredaccordingtothenumberofregexesthatexhibitworsebehaviorinthedestination row thanthehypotheticalsource column .darkerrowsaredangerousdestinations theindividualcellscontainthepercentoftheregexes supported in that language pair whose worst case performance is worse in the destination.
for example regexes do not perform any worse in javascript than java but of regexesperformworsewhenmovedfromrusttojavascript.
underthehood.
the primary distinctionbetween these families is their core regex matching algorithms and varying support for super linearregexfeatures e.g.
backreferences .goandrust offerlinearbehaviorbecausetheyprimarilyrelyonthompson s algorithmforlinear timeregexevaluations thoughinconsequence they offer a limited set of regex features.
in contrast the remaining languages perform regex matches using some variant ofspencer sbacktrackingalgorithm .thompson salgorithmis similartoabreadth firsttraversalofthenfagraph whilespencer s is analogous to a depth first traversal.
some implementations of the spencer style dfs may exhibit super linear behavior due to redundant state visits though there are also truly exponential npcomplete regexeswithbackreferences .
within the set of spencer engines though there are distinct mediumandslowfamilies.inourexperiments exponentialbehavior was unusual in php and perl while it occurs at about the same ratesinjava javascript python andruby.similarly phpandperl havealowerincidenceofpolynomialbehaviorthandotheother spencerengines.thedifferencesbetweenthesetwofamiliescan be attributedto amixof defensesandoptimizations .
tothebestofourknowledge phpandperlaretheonlyspencer enginesinourstudythathaveexplicitdefensesagainstexponentialtimebehavior.bothlanguagesrelyon counterstotracktheamount ofworkperformedduringamatch andifaregexevaluationexceeds a threshold it is terminated with an exception.
in experiments we foundthatthesecountersareincrementedsuchthatexponential searches may trigger the threshold but poly time searches will not.
perladditionallymaintainsa cacheofvisitedstatesinordertoshortcircuit redundant paths through the nfa permitting it to evaluate 450whyaren t regular expressions alingua franca?
esec fse august tallinn estonia somesearchesinlineartimethattakepolynomialorexponential time inotherspencer engines.
in addition to their exponential defenses php and perl both haveoptimizationsthatactasasafeguardagainstpolynomialregex enginebehavior.forpartialmatches someregexengineswilltry every possible starting offset in the string trivially leading to polynomialbehavior.phpandperlhaveoptimizationstoprunethese starting offsets and these optimizations appear to reduce the incidenceofpolynomialbehaviorinthoselanguages.therelevant optimizationsseemtobe skippingaheadtoplausiblestarting points and filtering outinputsthat lacknecessary substrings.
tothebestofourknowledge thisisthefirstdescriptionofthese real worldregexenginemechanismsinthescientificliterature8.we hopeourfindingswillinformthemaintenanceanddevelopment ofregex enginesthat are less susceptible to super linear behavior.
three families nottwo?
inourexperimentsweweresurprised tofindthreefamiliesofregexengineperformanceinsteadofthe two previously described by cox .
perhaps based on cox s analysis others argued that exponential regex behavior in java would translate to php .
the defenses and optimizations we identifiedinphpandperl have previously gone unremarked.
regex bugs semantic bugs.
although developers may identify some semantic regex problems during testing others may cause unexpected regex behaviorinpractice.to estimatethefrequencyofsemantic problems in practice we developed linter style tools to identify regexes that use features that are unavailable in their language .forexample injavascripttheanchornotation ab z is interpretedliterallyasabz butdeveloperswhousethisnotationin javascript projects probably intend anchors.
among the javascript npm modulesfromwhichwederivedourcorpus weidentified31 modules that used this notation.
in total we identified hundreds of modules containing potential semantic regex bugs.
we have begun opening bugreports against thesemodules.
it is possible that these regexes were derived from copy paste practices.
however developers might introduce such bugs even when designing regexes from scratch since they may design them basedona supposed regex linguafranca thatdoesnotextendto the languageinwhichthey are developing cf.figure .
redos regexes.
the super linear regexes we identified represent potentialredos vectors.
afterfilteringout regexes thatappear in pathslike testorbuild wehaveinitiatedtheresponsibledisclosure processto informthe developersof14 495modulesaboutpotential security vulnerabilities.
discussion and futurework considerations software engineers.
our findings suggest that portingregexesacrosslanguageboundaries e.g.
fromothersoftwareprojectsorfromstackoverflow isapotentiallyriskyactivity.
subtlesemanticandperformanceissuescanoccurandshouldbe 8besides our description we are only aware of descriptions of these defenses in discussionforumposts andthesourcecodeitself e.g.
seeline7835of .these mechanismsarenot described in the php and perldocumentation that westudied.consideredbydevelopersintroducingregexesinto theircode.unfortunately thelargestdevelopercommunitiesareinthelanguages mostvulnerable to redos cf.table 1andfigure .
wehavereleasedourmany languagetoolstohelpdevelopers understand the possible risks of regexes.
our tools can test the semantic and performance of regexes in many languages on many inputs.we hope table 4willbe auseful reference for developers.
recommendations programminglanguagedesigners.
weempathize with the developers we surveyed who expected regexes to behave consistently across programming languages.
we believe that regexes should truly be the lingua franca many developers alreadybelievethemtobe.wesuggestthathavingthefastestor most feature rich engine is not worth the cost of regex portability problems.
perhaps supported by researchers programming language designers could agree on a universal regex specification and relieve software engineers of the burden of reconciling regexes across languages.
we acknowledge that diversity and competition sometimesimproveoutcomesforusers butregexesareamature technology andunifyingtheir behaviormakes sense.
each language s regex documentation currently focuses only on itsownsyntaxandsemantics.werecommendthatregexdocumentationadditionallydescribeitsdeviationsfromexternalspecification s e.g.
pcre orpx bre .explicitlydiscussingincompatibilities will inform developers of gotchas and it will have the indirect effect of reminding them that regexes are currently not a linguafranca .longerterm explicitlyconsideringeachlanguage s divergence from specification s will help designers reach agreement on a next generation universal regex specification.
lastly languagesshould document their worst case regex performance.
we recommend that language designers in the slow family javascript java python ruby of regex engines adopt techniques fromthe mediumfamily php perl toreducetheincidenceof redosvulnerabilitiesinthesepopular languages.
corpus applications.
our polyglot regex corpus is a promising basisfor further research.
clearly developers searchfor regexes canweadaptsemanticcodesearchtechniques tothediscovery of relevant regexes?
and do developers have different regex needs indifferentprogramminglanguages dothesedifferencesmanifest inmeasurableways andshouldthisaffecttheregexfeaturesupport oroptimizations usedinregex engines?
regextools andregex engines.
motivatedbythiswork weenvisionaregex universaltranslator tohelpdevelopersportregexes betweenlanguages.thistaskiscomplicatedbyincompleteregex specifications different feature supportindifferent programming languages and performance variations.
as a starting point van der merwe et al.
s work on regex transformations that preserve semantics but changeperformance seems promising .
we believe that two directions for regex engine research are promising.first weaccidentallyidentifiedbugsinfourregexengines 7. .
.testingregexenginesbyrefiningregexsemanticsand applying model checking techniques will improve the developer experience.
second we suggest that most redos vulnerabilities canbesolvedattheregexenginelevelbyrefiningandenhancing the optimizations already present in perl and php .
.
.
care willbe needed however to avoid changing regex semantics.
451esec fse august tallinn estonia james c.davis louisg.michaeliv christy a.coghlan francisco servant anddongyoonlee otherlinguafrancas .whatistheimpactofother linguafranca problems insoftwareengineering?forexample howdodevelopers account for variations in sql dialects markdown specifications software compilers and browser javascript support and what are the consequenceswhen they fail to doso?
threats to validity internal validity.
survey.our survey instrument has not been validated .
we assume the survey respondents who survived our bogus response filterrepliedingoodfaith.
performance portability.
our results assume that the sl regex detector ensemble is effective.
these detectors were designed with the naive spencer style regex engines in mind slow family and mightmissslregexesinthemediumandfastfamilies.forexample itisnotclearwhetherthedefensesofphpandperlaresoundor simply effective against thesedetectors inputs.
externalvalidity.
regexcorpus.
ourmethodologyforprocuring theregexcorpusfacestwothreats.first ourcorpusiscomposed onlyofstatically declaredregexes.togeneralize weassumethat either most regexes are statically declared or that dynamicallydeclaredregexeshavesimilarproperties.second weonlyextract regexes from modules.
we do not know whether developers follow thesameregexpracticeswhenwritingregexesinmodulesandin applications soour results maynot generalize to applications.
construct validity.
regex re use.
we took a simple approach to identifying regex re use in our corpus exact string matches for regexesatleast15characterslong.wechosethisthresholdbased on our assessment of regexes more or less likely to have been independentlyderivedbymultipledevelopers.however theremay havebeenshorterre usedregexes longerindependently derived regexes and many regexes that were re used with modifications to tailor themto specific use cases.
ourdefinitionofre usedoesnotaccountforthepossibilityof wholesalefileduplication whichisnottrueregexre use.fileduplication would only affect our intra language regex re use results.
related work empirical studies of regexes.
theempiricalstudyofregexuse is a recentendeavor with severallines ofresearch.
chapman and stoleeassessedtheuseofdifferentregexfeaturesinpython .
usingthatcorpus chapman etal.assessedtherelativeunderstandabilityofregexsynonymstodeterminecommunitypreferences .
wangandstoleereportedthatregexesare poorlyunittested injava applications thoughthismightbeduetodeveloperprocesses notcapturedbyversioncontrol e.g.
usingregexcheckingtools .
our polyglot regex techniques will enable generalizing some of theseresults to otherprogramminglanguages.
softwarere use othercode.
software re use is a prevalent practiceinsoftwareengineering .developersre usecode fromtheirownorotherprojects introducing codeclones .
multiple studies estimate that more than of the code in github is duplicated with similar ratios for android applications .
whether code clones are good practice is a matter of debate.
some researchers have pointed out the benefits of code clones and found little difference between cloned and non cloned codein qualities such as comprehensibility and defect proneness .butotherstudieshaveexaminednegativeeffectsofcloning code suchasmaintenancedifficulties duetofrequent butinconsistent changes.asaresult awidevarietyoftechniques have been proposedto detectcode clones e.g.
.
to the best of our knowledge our paper presents the first study ofregex re useandthe problems that can arisefrom it.
software re use internet forums.
researchers have also studiedsoftwarere usefrominternetforums.multiplestudiesfound evidence of code flow from stack overflow to software repositories and found that code frequently flows although sometimeswithoutrespectinglicenseterms orauthorshipattribution .
researchers have also studied the interplay of developer contributionsto both resources .
giventheprevalenceofcodesnippetsinstackoverflow multiple tools have been proposed to help developers re use them e.g.
to automatically generate comments or to augment the ide .
however some problems have been identified with reusingcodesnippetsfromstackoverflow e.g.
quality andusability .
furthermore other studies have identified particular threats with code re use from stack overflow such as api misuse security vulnerabilities or unreadable code .
inthispaperwefoundthatinternetforumsarealsoapopular source of regex re use among developers and we observed similar risks feature mis useandredosvulnerabilities.
migration.
researchershavelongdiscussedthedifficultiesofcode migration .
as new technologies emerge so donewmigrationtools e.g.
within andbetweenlanguages andframeworks .
our work shows that regexes are currently not a lingua franca creating an opportunity for toolsfor regex migration.
conclusion regexesarenota linguafranca .althoughabout92 ofregexeswill compileinmostprogramminglanguages theirapparentportability masksproblemsofcorrectnessandperformance.weempirically investigated the extent and causes of these portability problems offering the first empirical perspective on regex portability.
in the processweidentifiedhundredsofmoduleswithpotentialsemantic problemsandthousandswithpotentialperformanceproblems plus documentation andimplementationerrorsinpopular languages.
unfortunately butquiteunderstandably abouthalfofthesoftware developers we surveyed believe and act as though regexes are alingua franca .
we hope that this paper increases developer awareness of regex portability problems.
we also hope to motivate languagedesigners towardregex standardization.
reproducibility an artifact containing our survey instrument regex corpus and analysesisavailable at .