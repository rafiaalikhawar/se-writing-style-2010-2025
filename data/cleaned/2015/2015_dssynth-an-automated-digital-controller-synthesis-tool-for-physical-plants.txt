dssynth an automated digital controller synthesis tool for physical plants alessandro abate1 iury bessa2 dario cattaruzza1 lennon chaves2 lucas cordeiro1 cristina david1 pascal kesseli1 daniel kroening1 and elizabeth polgreen1 1university of oxford oxford united kingdom 2federal university of amazonas manaus brazil abstract we present an automated matlab toolbox named dssynth digital system synthesizer to synthesize sound digital controllers for physical plants that are represented as linear timeinvariant systems with single input and output.
in particular dssynth synthesizes digital controllers that are sound w.r .t.
stability and safety specifications.
dssynth considers the complete range of approximations including time discretization quanti zation effects and finite precision arithmetic and its roundingerrors .
we demonstrate the practical value of this toolbox byautomatically synthesizing stable and safe controllers for intricatephysical plant models from the digital control literature.
theresulting toolbox enables the application of program synthesis toreal world control engineering problems.
a demonstration canbe found at hlqslrcee8.
index t erms formal synthesis digital control systems matlab toolbox finite word length v erification i. i ntroduction control theory targets the construction of reliable systems by providing mathematical guarantees about the stability and the performance of closed loop dynamics where outputs of a discrete plant g z are fed back and compared to a reference signal towards which a controller c z should steer .
fig.
depicts a typical closed loop digital control system.
reference outputcontroller c z plant g z fig.
typical closed loop control system there are various ways to model control systems.
two common ways to represent the dynamics of such systems are transfer functions and state space equations difference or differential equations .
in this paper we consider systems with a single input and a single output siso given either as transferfunctions or state space linear time invariant lti models.
lti models are a common sub class and are frequently used incyber physical systems e.g.
in robotics smart grids power plants and avionics .
a discretized plant or a digital controller is in general given as follows when using the transfer function representation h z b z a z b0 b1z ... bmz m a0 a1z ... anz n in this representation z 1is called the backward shift operator a z andb z are the denominator and numerator polynomials and nandmare the order of the denominator and numerator polynomials respectively.
in state space form the behavior of a system is represented via a state evolution equation x n and an instantaneous output equation y n as follows x n ax n bu n y n cx n du n where a b canddare matrices that fully specify the model.
there is a rich body of literature on automating the synthesis of controllers for lti systems .
however there aremany challenges when digital control is used to implementthe controller mainly due to effects of finite word length fwl which leads to truncation or round off errors and time discretization and quantization noise which are typically introduced by analogue to digital adc and digitalto analogue dac conversion .
we have recently proposed a new method to synthesize digital control systems for lti systems which we havenamed dssynth digital system synthesizer .
the algorithm implements counter example guided inductivesynthesis cegis .
cegis is used to realize a program synthesis engine that is able to generate sound digital controllers for highly non trivial system specifications with a very high degree of automation.
the program synthesis engine is given a specification and subsequently produces a sequence of candidate programs from a template.
the candidate programs are iteratively refined to eventually satisfy the specification.
modernsynthesis engines such as the one used here combine automatedtesting genetic algorithms and smt based reasoning .
using the cegis based approach dssynth synthesizes stable digital controllers for a given physical plant represented by either transfer functions or state space equations.
there are existing toolboxes for matlab that provide functions and scripts to support the design and implementation of digital controllers .
in particular there is a matlab toolbox named dsv erifier which automatically detects specific errors in a given digital system design e.g.
errors related to stability limit cycle and overflow usingsymbolic model checking based on boolean satisfiability sat and satisfiability modulo theories smt solvers.
the pessoa toolbox performs synthesis of correct by design .
c circlecopyrt2017 ieeease urbana champaign il usa t ool demonstrations919 authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
digital controllers.
pessoa is based on approximate bisimulation which allows control engineers to replace the differential equations describing the physical plant by a finite state machine.
however pessoa does not take advantage of recent advances in bit accurate verification of programs to synthesize controllers w.r.t.
fwl effects.
matlab offers a tool named control system tuner for automatically designing controllers based on optimization or graphical analysis.
however the control system tuner is unable to consider fwl effects during controller synthesis.
to the best of our knowledge there is no matlab toolbox able to perform digital controller synthesis that considers the complete range of approximations including time discretization quantization effects and finite precision arithmetic and its rounding errors.
the present tool paper addresses this limitation and describes a matlab toolbox for dssynth.
matlab is very commonly used for modeling physical plants.
thus the integration into matlab enables rapid synthesis of a stable and safe digital controller for such plants without switching the environment.
experimental results show that the dssynth toolbox is able to efficiently synthesize stable and safe controllers for a set of intricate benchmarks taken from the literature themedian runtime for our benchmarks set is 124s and the average synthesis time amounts to .5s for closed loop control systems represented by state space equations while for transfer functions the average synthesis time amounts to .6s.
ii.
c ounterexample guided inductive synthesis for control systems our synthesizer iterates between two main phases an inductive synthesis phase synthesise and a validation phase verify .
the two phases interact via a finite set of test vectors which is updated incrementally.
given a stability and safety specification the inductive synthesis procedure tries to find a candidate solution satisfying the specification for the given set of test inputs.
if the synthesis phase succeeds in finding a witness this witness is a candidate solution to the full synthesis formula.
we pass this candidate solution to the validation phase which checks whether it is a proper solution i.e.
satisfies the specification for all possible inputs .
if this is the case then the algorithm terminates.
otherwise additional information is provided to the inductive synthesis phase in the form of a new counterexample c ex which is added to the set of test inputs and the loop iterates again.
we use two different instantiations of the synthesiser.
the two approaches differ in the manner in which they check the safety specification.
the first approach presented in fig.
starts by devising a digital controller that stabilizes the model while remaining safe for a pre selected time horizon k and a single initial state then it employs a multi staged verification process as follows i the first verification stage safety checks that the candidate solution which we synthesized tobe safe for at least one initial state is safe for allpossible initial states i.e.
does not reach an unsafe state within k steps.
ii the second verification stage precision restores soundness with respect to the plant precision by using interval arithmetic to validate the operations performed by thesynthesizeverify .safety .precision .complete done prog ram searchbmc based verifierfixed point arithmetic verifiercompleteness verifierk c expassincrease precisionincrease unfolding bound fig.
cegis with multi staged verification .preprocessing4.abstract .synthesize .verify passdone prog ram searchabstr act accelerationabstr action verifierkc ex fig.
abstraction based cegis previous stage.
iii the third verification stage complete checks that the current kis large enough to ensure safety for anyk prime k. here we compute the completeness threshold k for the current candidate controller k i.e.
the number of iterations required to sufficiently unwind the closed loop state space model such that the boundaries are not violated for any larger number of iterations and check that k k. the second approach illustrated in fig.
employs abstract acceleration to simultaneously evaluate all possible progressions of the model.
this eliminates the need for a completeness threshold since the time horizon considered in abstract acceleration is infinite.
an additional preprocessing phase is used to compute a set of initial bounds on kbased on input constraints.
note that these bounds will be used by the synthesize phase to reduce the size of the solution space.
since this model is based on abstraction we initially perform the synthesis over a basic model that abstracts away the complexity of the specification and is only refined to a more complex model when a counterexample is found.
the useof this counterexample guided abstraction refinement results in much faster synthesis and verification since it is applied to both phases allowing for faster results whilst maintaining soundness for an infinite time horizon.
iii.
s ynthesizing digital controllers with the dss ynth toolbox a. dssynth toolbox architecture the proposed synthesis methodology for closed loop digital control systems is based on the dssynth tool which can be split into two main stages as follows manual and automated steps as illustrated in fig.
.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
fig.
phases of the controller synthesis in step the user selects the digital controller representation which can be a transfer function or a state space model.
in step the physical plant in the form of equation or depending on representation must be given .
finally in step the numerical representation for the digital controller implementation must be set by the user i.e.
the fwl format that defines the number of bits of the integer and fractional parts as well as the dynamic range inputs.
the input provided by the user is a specification of the physical plant.
after that the automated synthesis process starts with step a where the dssynth toolbox translates the digital system specification from the matlab format into an ansi c program.
in step b our cegis engine is invoked to synthesize the digital controller w.r.t.
the digital system specification.
finally in step c the synthesized digital controller is produced.
the output generated by the dssynth toolbox is the synthesized digital controller represented either in transfer function or statespace equation.
the synthesis is considered to be successful if a digital controller is correctly synthesized w.r.t.
fwl effects otherwise if any parameter is incorrectly defined in previous steps or if there is no solution no controller for the respective physical plant given the implementation requirements then the synthesis is considered to have failed.
our cegis engine is implemented as an integrated module within the c bounded model checker cbmc .
cbmc transforms the ansi c representation of our closed loop control system model into its internal format.
we instrument this ir for each synthesis or verification scenario accordingly and use cbmc as an oracle to answer our queries.
cbmc itselfrelies on an underlying sat or smt solver to solve verification conditions.
we model fwl effects time discretization and the presence of quantization noise explicitly using cbmc s nondeterminism api e.g.
nondet cprover assume intrinsic functions .
our module is included in cbmc .
and is available for download.1we further created a virtualbox ov a image with our tool pre installed including our matlabgenerated benchmarks and benchmark shell script with instructions to run all benchmarks and reproduce our experiments.
our toolbox is available online.
the entire implementation consists of 400lines of matlab scripts for the ui module and lines of c code the naive and abstract accelerator back ends respectively cf.
section ii lines of c code for utility functions such as interval and fixed point arithmetic as well as lines of c code in the control synthesis module in cegis cbmc.
we evaluate dssynth toolbox using 18siso control system benchmarks.
additionally documentation and videos about the dssynth toolbox are available at dssynth toolbox .
.
.zip.
b. dssynth toolbox procedures the dssynth toolbox performs the following automated steps to synthesize a digital controller for the given physical plant setup obtains the physical plant fixed point format and dynamic input ranges and translates them to a specific structure in matlab.
parse obtains the digital system specification and translates it into an ansi c program.
execution obtains the ansi c program from the previous parse step and calls our cegis engine as a backend program synthesis tool to perform the automated synthesis.
extraction obtains the .log file that is generated after the synthesis phase and then checks the synthesized digital controller.
report obtains the digital controller from the previous extraction step and translates it into matlab for presentation to the user.
c. dssynth toolbox usage command line users must provide a digital system described as a matlab model using a tf for transfer function or an ss for state space model command step 1of fig.
.
the dssynth toolbox is called via the command line in matlab as synthesize plant intbits fracbits maxr minr whereplant is the physical plant in state space or transfer function representation intbits is the integer part fracbits is the fractional part maxr andminr are the maximum and minimum dynamic range respectively steps 2and of fig.
.
after executing the synthesize command the dssynth toolbox provides the synthesized digital controller.
authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
matlab application a graphical user interface application was developed illustrated in fig.
to support digital controller synthesis in matlab.
its aim is to improve usability and consequently to attract more engineers.
users provide the following inputs for digital controller synthesis within the ui physical plant specification fixed point representation and the range of the inputs.
a definition of the system representation and the physical plant b definition of implementation aspects and input ranges c digital controller synthesized by dssynth d step response for the synthesized digital controller fig.
dssynth gui for controller synthesis using transfer function representation d. illustrative example fig.
illustrates each step of the synthesis process for a physical plant described in eq.
which represents an unmanned aerial vehicle ua v quadcopter system .
this physical plant is expressed by a transfer function g z where b z and a z represent the numerator and denominator respectively as g z b z a z .06875z2 z2 .696z .
.
num den system tf num den .
y synthesize system synthesis successful y .9983z 2 .09587z .
z 2 .5665z .
fig.
synthesis of a digital controller for the physical plant defined in eq.
with fixed point format angbracketleft8 angbracketrightin fig.
num represents b z and den represents a z while yrepresents the synthesized stable digital controller which is defined by eq.
.
c z .
.09587z .
z2 .5665z .
.
a digital system is stable iff all of its poles are inside the zplane unity circle i.e.
the poles must have a modulus less than one .
in order to compute the poles for the digital system represented by equations and the user can invoke the feedback andseries commands in matlab to obtain a general equation regarding the transfer function representation as illustrated in fig.
.
num den controller tf num den .
num den plant tf num den .
sys feedback series controller plant sys .06863z 4 .006591z 3 .01324z 2 .069z 4 .136z 3 .4849z 2 .8704z .
fig.
general equation for the closed loop control system using the series configuration as illustrated in fig.
the general equation that represents the closed loop control system using the series configuration as illustrated in fig.
is described by eq.
as follows n z d z .06863z4 .006591z3 .01324z2 .069z4 .136z3 .4849z2 .8704z .
.
for the stability check if any root of the denominator polynomial d z in eq.
has modulus equal or greater than one then the system is unstable otherwise it is stable.
indeed the roots computed by the function roots in matlab result in the following poles as illustrated in fig.
which means that dssynth has synthesized a stable digital controller.
den r roots den r .
.8061i .
.8061i .
.0219i .
.0219i fig.
roots of the polynomial d z given by eq.
simulating the digital system represented by equations and to validate and reproduce the system stability the user can obtain the step response using the command dstep in matlab and then observe that the plotted graph indicates a stable digital system .
iv .
dss ynth toolbox experimental ev aluation a. benchmark description our evaluation consists of 18siso control system benchmarks extracted from the literature which include physical plants for an unmanned aerial authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
.
.
.
.
.
.
.7step response time seconds amplitude fig.
step response for eq.
describing a stable system for the ua v quadcopter system vehicle ua v a cruise control system a spring mass damper a satellite a direct current dc servo motor a helicopter the inverted pendulum a pendulum magnetic suspension a magnetized pointer car suspension a computer tape driver a flexible beam a guidance system a us coast guard cutter a continuous stirred tank reactor a voltage regulator and an acrobot control system.
b. experimental setup for all evaluated benchmarks the signal input range is between 1and .
the implementation features used for digital controller are 8bits for the integer part including the sign bit and 8bits for the fractional part.
we have run the dssynth toolbox using cegis with multi staged verification cf.
section ii .
all experiments with dssynth toolbox v .
.
were conducted on an otherwise idle intel core i .
ghz processor with 24gb of ram running ubuntu bit.
c. objectives the main objectives of our experimental evaluation is to evaluate the dssynth toolbox performance to produce stable and safe controllers and also confirm the stability and safety of the synthesized digital controllers outside of our model using matlab.
d. results for our experiments we observed that the dssynth toolbox correctly synthesizes stable and safe digital controllers for our set of benchmarks represented by transfer functions or state space equations.
we employed a diverse set of real worldbenchmarks extracted from the control literature.
however note that this set of benchmarks is still limited within the scope of this paper and the performance may not generalize to other benchmarks.
the median runtime for our benchmarks is 124s and the average synthesis time amounts to .5s for closed loop control systems represented by state space equations whilefor transfer functions the average synthesis time amounts to .6s.
additionally we are able to reproduce the stability and safety for all evaluated control system benchmarks.
as anexample we have reproduced the stability property in the synthesized controller for a dc motor plant described in eq.
simulating the step response in matlab.
fig.
shows that the digital controller synthesized by the dssynth toolbox stabilizes the closed loop control system using the series connection illustrated in fig.
for the dc motor plant.
we have applied this procedure to all synthesized controllers to validate our experimental results.
c z .3466796875z .
.5z2 .19921875z.
20step response time seconds amplitude fig.
step response for the eq.
describing a stable system for the dc motor plant regarding the state space representation we have reproduced the stability property for the closed loop control system of a pendulum represented by eq.
.
a bracketleftbigg .
.
bracketrightbigg b bracketleftbigg bracketrightbigg c bracketleftbig .
.
bracketrightbig d bracketleftbig9.
bracketrightbig .
for this particular closed loop control system the feedback matrix see eq.
generated by the dssynth toolbox also leads to a stable system as illustrated in fig.
.
k bracketleftbig .
.
bracketrightbig .
the synthesized controllers are also confirmed to be safe outside of our model representation using matlab which means that our results are usable for control engineers.
given that the closed loop dynamics are convergent the controller s safety can be checked by computing the initial state s infinity norm i.e.
the product between the l norm of the initial states authorized licensed use limited to lahore univ of management sciences.
downloaded on august at utc from ieee xplore.
restrictions apply.
05101520253035step response time seconds amplitude fig.
step response for the eq.
describing a stable system for the pendulum plant x0 m a x x0 and the l1norm of a m a x jm summationtext i aij where a a bk .
this is a conservative safety check which is based on a sufficient condition .
an alternative but not conservative approach is to unfold the system dynamics up to a given depth with the initial state equal to its maximum value compute the system input and output via the feedback matrix and then check the state bounds.
v. c onclusions the dssynth toolbox can automatically synthesize stable and safe digital controllers for dynamic physical plants represented in matlab either as a transfer function or a state space equation.
the dssynth toolbox is the first fully automated synthesis tool that is algorithmically and numerically sound considering various error sources in the implementation of the digital control algorithm and in the computational modelingof plant dynamics .
the dssynth toolbox presents a practical application of cegis based program synthesis.
our results in control engineering encourage the applicationof this technique in other fields such as program repair or superoptimization.
additionally given the current literature in controller synthesis there is no other matlab toolbox forsynthesizing stable and safe digital controllers for physical plants that considers all aspects of their digital implementation.
as future work the dssynth toolbox will perform synthesis considering performance requirements and will be combined with the dsverifier dsvalidator toolboxes to verify validate other controller properties.
we will also pursue the application of cegis to further software engineering problems.