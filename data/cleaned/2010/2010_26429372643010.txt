statistical learning approach for mining api usage mappings for code migration anh tuan nguyen1 anhnt iastate.eduhoan anh nguyen1 hoan iastate.edutung thanh nguyen2 tung.nguyen usu.edutien n. nguyen1 tien iastate.edu 1electrical and computer engineering department iowa state university ames ia usa 2computer science department utah state university logan ut usa abstract the same software product nowadays could appear in multiple platforms and devices.
to address business needs software companies develop a software product in a programming language and then migrate it to another one.
to support that process semi automatic migration tools have been proposed.
however they require users to manually define the mappings between the respective apis of the libraries used in two languages.
to reduce such manual effort we introduce staminer a novel data driven approach that statistically learns the mappings between apis from the corpus of the corresponding client code of the apis in two languages java and c .
instead of using heuristics on the textual or structural similarity between apis in two languages to map api methods and classes as in existing mining approaches staminer is based on a statistical model that learns the mappings in such a corpus and provides mappings for apis with all possible arities.
our empirical evaluation on several projects shows that staminer can detect api usage mappings with higher accuracy than a state of the art approach.
with the resulting api mappings mined by staminer java2csharp an existing migration tool could achieve a higher level of accuracy.
categories and subject descriptors d. .
distribution maintenance and enhancement keywords api mappings code migration api usages statistical learning .
introduction software companies nowadays often originally develop software in one language and then migrate them to another language to address the business need that the same software is required to appear on multiple platforms and devices.
the process of migrating software between languages is called code migration.
toward helping developers in the process of code migration there exist semi automatic approaches and supporting tools .
those tools and methods require users to define the permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
ase september vasteras sweden.
copyright acm ... .
.
examples of api mappings from java to c api usages in java api usages in c 1copy.setfirstlineindent copy.firstlineindent firstlineindent getfirstlineindent 2str.charat i str 3htmltags.align center.
util.equalsignorecase equalsignorecase alignment htmltags.align center alignment 4file.mkdirs system.io.directory.createdirectory string 5hashmap string integer dictionary string int 6vector.removeallelements arraylist.clear migration rules between the respective program constructs and the mappings between the corresponding application programming interfaces apis that are used in two languages.
for example a call to a superclass with super in java needs to be translated into the call with base in c .
as an example for the apis in libraries to manipulate files and directories in a file system developers use the apis in the java development kit library jdk such as java.io.file.mkdirs and java.io.file.delete .
the same functionality can be achieved in c with the apis in system.io such as system.io.directory.createdirectory string andsystem.io.file.delete respectively.
those mappings are called api mappings between languages.
the existing tools and methods expect programmers to specify such api mappings.
there are usually a large number of api mappings and many of them are newly introduced from time to time as well.
thus existing tools can support only a subset of needed api mappings .
importantly it has been reported that as a result the quality of the migrated code is reduced due to missing api mappings in such rule based migration tools .
to reduce manual effort in defining such rules of api mappings for code migration there exist approaches that automatically mine api mappings from the corpus of the libraries client code that already has two corresponding versions in two languages .
in twinning users have to manually write the rules to specify the mappings as program transformations.
mam represents api usages in the client code as a graph among api elements i.e.
api methods classes .
the two api usage graphs for the corresponding client code in two languages are matched against each other to determine the api mappings.
the nodes api methods classes in two usage graphs are mapped based on a set of heuristics such as the similarity of the nodes names and or the numbers and types of the parameters in method calls as well as their returned types.
those heuristics might not always hold because in general a library in the target language could use a quite different paradigm with the apis names different than those in the library used in the source language.
a method call in a library might be replaced by a field access or by multiple apis in the target library.
even when it is replaced by a method call the set of parameters might be different.
table displays the corresponding api usages providing the same functionality that we found in the java and c versions of the project db4o .
in the first example the pair of getter and setter functions becomes a field access and an assignment.
in the second one a call to charat was migrated into an array access str .
in the third one the numbers of parameters of the corresponding apis are different and an access to align center becomes an argument passed to an api call.
the last three examples show that the names of the respective api classes methods can be very different.
moreover a usage with two apis can be mapped into a usage with three apis e.g.
file.new string and java.io.file.exists in java become fileinfo.new string and system.io.file.exists string system.io.directory.exists string in c since java.io.file.exists in java can check if a file or directory exists while such checking for a file or a directory in c is achieved with two different apis .
importantly in other cases the api mappings of individual api classes methods are not sufficient because an api usage as a whole needs to be migrated into another usage in the target library.
in such cases existing tools which rely on one to one api mappings will not work.
thus providing mappings for entire api usages would help developers to understand and migrate the code themselves.
the notion of api usage mapping encompasses the notion of api mapping since a usage could be a single api element.
in this paper we propose staminer a data driven model that statistically learns the mappings between api usages from the corpus of the corresponding methods in the client code of the apis used in two languages java and c .
for a method it builds a groum a graph representation for the api usages in the method.
in a groum nodes represent method calls field accesses and control structures i.e.
if while for .
edges represent the control and data dependencies between the nodes.
the nodes labels are built from the names of the classes methods and control structures.
staminer extracts from the method s groum the connected subgroums representing the api sub usages with one or multiple objects.
for each of those sub groums it extracts its nodes labels to build a sequence of symbols.
those labels symbols are called usage symbols and a sequence of such usage symbols represents an api sub usage.
then the sequences of symbols for all sub groums are put together to form a sequence for the whole method called the sentence.
all the pairs of sentences for the corresponding methods in java and c are used as the input for a symbol to symbol alignment algorithm using expectation maximization em .
after that staminer extends the resulting symbol to symbol alignments to compute the alignments for the sequences of symbols in two languages.
the aligned sequences of symbols with their scores greater than a threshold represent the mappings of api usages.
importantly in staminer building the corpus of respective methods of client code requires little effort of manually labeling.
we built a tool to search for the respective methods in the pairs of corresponding implementations in java and c .
with a conservative strategy it chose only the methods with the same signatures in the classes with the same similar names with possible upper lowercase differences in the same similar directory structures in both java and c versions.
such pairs of methods likely realize the same functions.
we ran that tool on nine open source projects with both java and c versions.
we found pairs of respective methods and used them as a corpus for mining.
other methods are not used since we are not sure if they correspond to each other.
our empirical evaluation shows that staminer is able to mine a large number of api mappings with .
accuracy including many m to nmappings.
comparing against the oracle of manually built single api mappings it achieves higher precision .
relative improvement and recall .
than the state of the art approach mam .
we also evaluated how much benefit that the mined apia a usage in java 1hashmap string integer myvocabidxdict new hashmap string integer myvocabidxdict.
put alphabet 3filewriter writer new filewriter vocabidx.txt 4for string vocab myvocabidxdict.
keyset f writer .
append vocab myvocabidxdict.get vocab nrnn 6g writer .
close b a usage in c 1dictionary string int myvocabidxdict new dictionary string int myvocabidxdict.
add alphabet 3streamwriter writer new streamwriter vocabidx.txt 4list string keylist new list string myvocabidxdict.keys 5foreach string vocab inkeylist f intidx myvocabidxdict.trygetvalue vocab outidx writer .
writeline vocab idx 9g writer .
close figure api usage mappings between java and c mappings from staminer could help in supporting code migration.
the result shows that with the single api mappings mined from staminer java2csharp an existing migration tool produces code with .
less compilation errors and .
less defects than with the mappings from mam.
the contributions of this paper are .a statistical method for mining api mappings with any arities .a tool to mine api usage mappings in java and c and .an empirical evaluation to show staminer s higher accuracy and usefulness than the state of the art approach mam.
.
a motiv ating example figure shows the corresponding client code in java and c listed on stackover ow.com .
the code is for the tasks of reading the data from a vocabulary containing pairs of words and indexes after populating it and then writing them line by line to a text file.
to do that developers use the application programming interface elements api elements apis for short which are the classes methods and fields provided by a framework orlibrary .
those api elements are used in a specific order with specific data and or control dependencies and control structures i.e.
condition repetition according the api specification.
such a usage of api elements isused to achieve a programming task and is called an api usage.
for example figure 1a can be viewed as containing three sub usages.
first the vocabulary is instantiated and populated via hashmap.put .
second the task of reading data from a vocabulary begins with a foriteration over all elements in the vocabulary using hashmap.keyset .
each element is then retrieved by the hashmap.get method of the vocabulary.
finally the file writing usage starts with afilewriter object instantiation continues with a forloop where filewriter.append is called on that object and finally ends with the closing of the filewriter object via filewriter.close .
to migrate code between two languages one needs to implement a respective api usage in c thatachieves the same programming task s as the original api usage in java.
such two respective api usages are called an api usage mapping .
in a special case if each respective api usage has a single api class or method the mapping is called an api mapping i.e.
a class to a class or a method call to a method call .
currently the existing automatic mining approaches for api usage mappings which rely on the heuristics of name or structure similarity among api elements face several challenges 458firstly the names of the respective api elements in two languages could be different.
for example c utility library does not have a hashmap class as in java and one can use dictionary instead.
the classes have different names and their respective methods for adding an element to the collection have different names as well hashmap.put versus dictionary.add .
similarly to write texts to a file one could use filewriter.append in java and use streamwriter.writeline in c .
in fact the latest version of java2csharp contains a manually written data set of api mappings.
of them have different api names in java and c with case sensitivity being ignored .
thus an api mapping tool cannot be based solely on the similarity in names of api elements.
secondly the numbers of parameters in corresponding methods are not necessarily the same.
for example the method hashmap.get string line figure 1a is used to retrieve a value given a key.
to do that with c sdictionary one would use dictionary.trygetvalue string int line figure 1b with the second parameter being the reference to the index of the key if it is found in the collection dictionary does not have a getmethod .
in fact the authors of mam confirmed that a key source of its inaccuracy is the difference in names and parameters.
thirdly an api element can be mapped to another one of a different kind hashmap.keyset became dictionary.keys .
finally sometimes to achieve the same task one api in a usage can become multiple apis or vice versa.
for example to retrieve the set of keys in hashmap in java one could use hashmap.keyset line figure 1a .
however in c since the field access dictionary.keys line of figure 1b returns a collection the equivalent usage involves a listobject encapsulating the collection.
in fact an api usage mapping is generally m to nwhere mmight be different than n. for example in figure 1a the task of writing to a text file in java involves filewriter.new aforloop filewriter.append and filewriter.close .
the respective usage in c involves streamwriter.
new list aforeach loop streamwriter.writeline and streamwriter.
close in figure 1b.
currently the existing rule based migration tools support only one to one mappings.
without tool support in such general m to nmapping cases developers would need to manually perform code migration.
it would be beneficial to them if a tool could provide the mappings for entire api usages.
.
mining of api usage mappings .
formulation and important concepts we propose staminer a statistical model that learns the api usage mappings from the corpus of the respective client code of the apis in two languages.
let us first present important concepts.
definition api element .api elements are the classes methods and fields provided by a library or a framework.
definition api client code .client code of a library framework is the code that uses api elements of that library framework.
definition api usage .an api usage is a set of api elements in use in the client code i.e.
classes method calls field and array accesses and operators together with control units i.e.
condition repetition in a specific order and with control and data flow dependencies among api elements.
an api usage is an intended use to achieve a programming task.
a usage could involve multiple libraries frameworks.
it contains the usage of the classes via variables