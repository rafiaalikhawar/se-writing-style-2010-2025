patching vulnerabilities with sanitization synthesis fangyu national chengchi university yuf nccu.edu.twmuath alkhalaf ucsanta barbar a muath cs .ucsb .edutev kbultan ucsanta barbar a bultan cs .ucsb .edu abstra ct wepresen tautomata based static string analysis techniques thatautomatically generate sanitization statemen tsforpatchingvulnerable webapplications.
ourapproac hconsists of threephases givenanattackpattern we rstconduct avulnerabilit yanalysis toidentifyifstrings thatmatchtheattack pattern canreachthesecurit y sensitiv efunctions.
next we compute vulnerabilit ysignatures thatcharacterize allinput strings thatcanexploit thediscoveredvulnerabilit y.given thevulnerabilit ysignatures wethenconstruct sanitization statemen tsthat1 checkifagiveninput matchesthevulnerabilit ysignature and2 modifytheinput inaminimal waysothatthemodi ed input doesnotmatchthevulnerabilit ysignature.
ourapproac hiscapable ofgenerating relational vulnerabilit ysignatures andcorresp onding sanitization statemen ts forvulnerabilities thatareduetomore thanoneinput.
categories andsubject descriptors d. .
software program veri cation modelchecking reliability general terms veri cation securit y keywords sanitization synthesis string analysis automata .intr oduction webapplications arenotorious forsecurit yvulnerabilities thatcanbeexploited bymalicious users.
duetoglobal accessibilit yofwebapplications malicious users allaround theworldcanexploit avulnerable webapplication andcause thisresearc hisfunded bythenscgrant99 e my3 andthensf grantsccf andccf0916112.
permission tomakedigital orhard copies ofallorpart ofthisworkfor personal orclassroom useisgranted without feeprovided thatcopies are notmade ordistrib uted forpro t orcommercial advantage andthatcopies bear thisnotice andthefullcitation onthe rstpage.
tocopyotherwise to republish topost onserversortoredistrib utetolists requires prior speci c permission and or afee.
icse may waikiki honolulu hi usa copyright acm978 ... .
.serious damage.
so itiscritical thatvulnerabilities arenot onlydiscoveredfast buttheyarealsorepairedfast.
inthispaper wepresen ttechniques forautomatically detecting andpatchingstring related vulnerabilities inweb applications.
westartwithasetofattackpatterns regular expressions thatcharacterize possible attacks either taken fromanattackpattern speci cation library orwritten by thewebapplication developer .givenanattackpattern ourstring analysis approac hworksinthree phases phase vulnerabilit yanalysis first weuse automata based static string analysis techniques todetermineifthewebapplication isvulnerable toattackscharacterized bythegivenattackpattern andgenerate acharacterization ofthepotentialattackstrings iftheapplication is vulnerable.
phase vulnerabilit ysignature generation we thenprojecttheseattackstrings touserinputs andcompute anover appro ximation ofallpossible inputs thatcancause anattack.thischaracterization ofpotentially harmful user inputs iscalled thevulnerability signatur eforagivenattack pattern.
phase sanitization generation once wehavethe vulnerabilit ysignature weautomatically synthesize patches thateliminate thevulnerabilit yusing twostrategies match and blo ck weinsert match statements tovulnerablewebapplications andhalttheexecution when aninput thatmatchesavulnerabilit ysignature isdetected.
match and sanitize weinsert bothmatchandreplace statements tovulnerable webapplications.
when aninput thatmatchesavulnerabilit ysignature isdetected instead ofhalting theexecution thereplace statemen tisexecuted.
thereplace statemen tdeletes asmall setofcharacters from theinput suchthatthemodi ed string nolonger matches thevulnerabilit ysignature.
forvulnerabilit yanalysis weuseaforwardsymbolicreachabilityanalysis thatcomputes anover appro ximation ofall possible values thatstring variables cantakeateachprogram point.weusedeterministic nite automata dfas torepresen tvalues thatstring expressions cantake.intersecting theresults oftheforwardanalysis atsinks i.e.
sensitiv efunctions thatcancause avulnerabilit y withthe attackpattern givesusthepotentialattackstrings ifthe program isvulnerable.
iftheintersection isempty thenthe program isnotvulnerable withrespecttothegivenattack pattern.
weusetwodi eren ttechniques forvulnerabilit ysignature generation.
inthe rstone westart withthedfathat represen tstheattackstrings atthesink andthenuseabackwardsymbolicreachabilit yanalysis tocompute anoverapproximation ofallpossible inputs thatcangenerate those attackstrings.
theresult isadfathatcharacterizes the vulnerabilit ysignature forthegivenattackpattern.
however thisapproac hdoesnotworkforvulnerabilities thatareduetomorethanoneinput.
forexample ifanattackstring isgenerated byconcatenating twoinput strings itmightnotbepossible topreventtheattackbyblockingonlyoneoftheinputs since astring coming fromone input canleadtoanattackifitisconcatenated withasuitablyconstructed string coming fromanother input.
insuch cases thevulnerabilit ysignature caninclude allpossible inputstrings.
using suchavulnerabilit ysignature forautomated patchgeneration wouldmean blockingorerasing all theuserinput whichwouldmakethewebapplication unusable.
however ifwecandoananalysis thatkeepstrackof therelationships among di eren tstring variables thenwe canblockonlythecombinations ofinput strings thatlead toanattackstring.
wepresen tarelational vulnerabilit ysignature generationalgorithm based onmulti trac kdeterministic nite automata mdf a .anmdfahasmultiple tracksandreads onesymbolforeachtrackineachtransition.
i.e.
anmdfa recognizes tuples ofstrings rather thanasingle string.
we useaforwardsymbolicreachabilit yanalysis where eachgenerated mdfahasonetrackforeachinput variable and represen tstherelation betweentheinputs andthestring expression ataparticular program point.intersecting the mdfaatasinkwiththeattackpattern andprojecting the resulting mdfatotheinput tracksgivesusthevulnerabilitysignature.
thevulnerabilit ysignature mdfaaccepts all combinations ofinputs thatcanexploit thevulnerabilit y. once wegenerate thevulnerabilit ysignature wegeneratematchandreplace statemen tsbased onthevulnerabilitysignature.
thematchstatemen tbasically simulates thevulnerabilit ysignature automaton andreportsamatch iftheinput string isaccepted bytheautomaton.
inthe match and blo ckstrategy thisisallweneed andwehalt theexecution ifthere isamatch.inthematch and sanitize strategy however wealsogenerate areplace statemen tthat willmodifytheinput sothatitdoesnotmatchthevulnerabilitysignature.
since inputs thatmatchthevulnerabilit y signature maycome fromnormal non malicious users who forexample mayhaveacciden tallytypedasuspicious character itispreferable tochange theinput inaminimal way.
wepresen tanautomata theoretic characterization ofthis minimality andshowthatsolving itprecisely isintractable.
weshowthatwecangenerate areplace statemen twhichis closetooptimal inpractice byadopting apolynomial time min cut algorithm.
weimplemen tedallthetechniques mentioned abovefor php programs ontopofourstring analysis toolcalled stranger string automaton generator .
stranger usesthefront end ofpixy avulnerabilit yanalysis tool forphpthatperforms taintanalysis toidentifypotentially vulnerable sinks sinks thatdependonexternal inputs and generates dependency graphs thatshowhowtheexternal inputs owintothesinks.
stranger thenperforms string analysis onthedependency graphs.
stranger alsousesthe automata packageofmona tool tostoretheautomata constructed during string analysis symbolically .
related work duetoitsimportance insecurit y string1 ?php name get out name name 4echo out ?
figure asimple example analysis hasbeenwidely studied.
onein uen tialapproac h hasbeengrammar based string analysis thatstatically computes anover appro ximation ofthevalues ofstring expressionsinjavaprograms whichhasalsobeenusedtocheck forvarious typesoferrors inwebapplications .in multi trac kdfas alsoknownastransduc ers areusedtomodelreplacemen toperations.
there arealso severalrecentstring analysis toolsthatusesymbolicstring analysis based ondfaencodings .some ofthem arebased onsymbolicexecution anduseadfarepresentation tomodelandverifythestring manipulation operations injavaprograms .hampi isabounded string constrain tsolverthatsearchesforastring thatsatisesagivensetofstring constrain tsbybounding thestring length.
thistypeofbounded analysis cannot beusedfor sound string analysis whereas thestring analysis techniques wepresen tinthispaperaresound.
inourearlier work wehaveusedsingle trac kdfabased symbolicreachabilit y analysis toverifythecorrectness ofstring sanitization operations inphpprograms .ourpreliminary results ongenerating non relational vulnerabilit ysignatures usingsingle trac kdfawerereported earlier .
recen tly wealsoreported ourresults onfoundations ofstring analysisusing multi trac kautomata .these earlier results do notaddress thesanitization synthesis problem wediscuss in thispaper.moreo ver tothebestofourknowledge thisis the rstpaperthatpresen tsarelational vulnerabilit ysignature i.e.
avulnerabilit ysignature thatinvolvesmore than oneinput generation technique forstrings.
there hasbeenprevious workonautomatically generating lters forblockingbadinput .although thisissimilar to ourmatch and blo ckstrategy there areseveralsigni can t di erences withourwork.first earlier work focuses on bu er o ver owvulnerabilities whicharedi eren tthanthe string vulnerabilities weinvestigate here.
second inearlierwork thegeneration of lters isdonestarting with anexisting exploit whereas westart withanattackpattern.
finally unlikeprior results inthispaper wegenerate sanitization statemen tsthatrepair badinputs using thematch and sanitize strategy .wealsogiveanautomatatheoretic characterization ofthematch and sanitize strategy provethatgenerating optim ummodi cations isanintractable problem andpresen taheuristic approac hbased onamin cut algorithm.
.anover view consider thephp script showninfigure .thisscript starts withassigning theuserinput provided inthe getarraytothevariablenameinline2.itconcatenates aconstan t string withvariablenameandassigns ittoanother variable outinline3.then itsimply outputs thevariableoutusing theechostatemen tinline4.
theechostatemen tinline4isasinkstatemen tsince it cancontainacross sitescripting xss vulnerabilit y.for example amalicious usercanprovideaninput thatcontains thestring constan t script andexecute acommand leading toaxssattack.inorder topreventthisvulnerabilit y it isnecessary tosanitize theuserinputs before using theminanechostatemen t.intherestofthissection wegive anoverview ofhowourapproac hautomatically detects this vulnerabilit yandgenerates thesanitization statemen t.let usassume thattheattackpattern forthisvulnerabilit yis speci ed using thefollowing regular expression where denotes anyasciicharacter .
vulnerabilit yanalysis we rstperform aforwardsymbolicreachabilit yanalysis thatusesonedfaforeachvariableateachprogram pointtorepresen tthesetofvaluesthat thevariables cantake.during forwardanalysis weiterativelyupdatethesedfasbycomputing post conditions forwardimage ofprogram statemen ts.forexample ourpostcondition computation foranassignmen tstatemen ttakes asetofdfascharacterizing thevalues ofthestring variables attheright hand side oftheassignmen t before the assignmen tisexecuted asinput andreturns adfacharacterizing thepossible values oftheleft hand side variable aftertheassignmen tstatemen tisexecuted.
during forwardanalysis wecharacterize alltheuserinput as i.e.
theusercanprovideanystring asinput.
any variable thatisassigned aninput isrepresen tedbyadfa thataccepts thelanguage atthenextprogram pointaftertheassignmen t.forexample forthesmall script shown infigure ourforwardanalysis willgenerate adfafor thevariablenameatthebeginning ofstatemen t3thataccepts thelanguage .computing thepost condition of thestatemen t3willgenerate adfaforthevariableout atthebeginning ofstatemen t4thataccepts thelanguage name .when oursymbolicreachabilit yanalysis reaches a xpointeachstring variable ateachprogram pointisassociated withadfathatcharacterizes allpossible values thatvariable cantakeatthatprogram point.ouranalysis isconserv ativeinthesense thattheresulting dfasaccept anover appro ximation ofallpossible valuesofthevariables theyrepresen t.notethatapproximation isinevitable since string analysis problem isundecidable .
when ourforwardanalysis converges wetaketheintersection using automata product ofthelanguage ofthedfa thatcorresp ondstothestring expression atthesinkstatementwiththeattackpattern.
inourrunning example statement3isasinkstatemen t andthedfathatcorresp ondsto thestring expression atline4 whichissimply thevariable out accepts thelanguage name .when wetaketheintersection ofthislanguage withtheattackpattern weobtain anautomaton thataccepts thelanguage name .
thisautomaton characterizes allpossible attackstrings at thesinkstatemen t.since thelanguage ofthisautomaton is notempty weknowthattheprogram isvulnerable.
vulnerabilit ysignature generation next we gure outwhichinput values cancreate theattackstrings atthe sinkstatemen t.inoursingle trac kdfabased approac h thisisdonewithabackwardsymbolicreachabilit yanalysis.westartwiththedfathatcharacterizes theattack strings i.e thedfawecompute attheendofthevulnerabilityanalysis andpropagate theresults backwardsuntilwe reachaninput.
during backwardanalysis weiterativ elyupdatethese dfasbycomputing pre condition backwardimage ofprogram statemen ts.forexample ourpre condition computation foranassignmen tstatemen ttakesadfacharacterizing thevalues ofthestring variable attheleft handsideoftheassignmen t after theassignmen tisexecuted as input andreturns asetofdfascharacterizing thepossi ?php .1if preg match get .
die invalid input name get out name .
name 4echo out ?
a patch1using match and blo ckstrategy ?php .1if preg match get .
get preg replace get name get out name .
name 4echo out ?
b patch2using match and sanitize strategy figure patchesfortheexample infigure min cut21 min cut a b figure vulnerabilit ysignatures blevaluesofthevariables thatareattheright hand side of theassignmen tbeforetheassignmen tstatemen tisexecuted.
fortheexample showninfigure ourbackwardanalysis computes thepre condition fortheassignmen tstatemen tin line3andgenerates adfaforthevariablenameattheend ofstatemen t3thataccepts thelanguage .when wecompute thepre condition oftheassignmen tstatemen t inline2wereachaninput andgenerate thevulnerabilit y signature fortheinput get asadfathataccepts thelanguage .
sanitization generation thelastphase ofouranalysis generates apatchthatremovesthevulnerabilit y.thevulnerabilit ysignature givesanover appro ximation ofallpossibleinput valuesthatcanexploit thevulnerabilit y.hence ifwedonotallowinput values thatmatchthevulnerabilitysignature thenwecanremovethevulnerabilit y.inour match and blo ckstrategy wegenerate apatchthatsimply checksiftheinput string matchesthevulnerabilit ysignature.
ifitdoes ithalts theexecution without executing therestofthescript.
thepatchgenerated forthesmall example infigure 1based onthevulnerabilit ysignature andusing thematch and blo ckstrategy isshown infigure a .
notethatthepatchedscript willblockany input string thatcontainsthesymbol .
inourmatch and sanitize strategy instead ofblockingthe execution wemodifytheinput inaminimal waytoguaranteethatthemodi ed input cannot leadtoanyattack strings.
wedothisbyanalyzing thevulnerabilit ysignaturedfa.consider thedfaforthevulnerabilit ysignature showninfigure a weuse toindicate anysymbolother than .ourgoalisto ndaminimal set ofcharacters suchthatifweremovethose characters froma givenstring theresulting string willnotbeaccepted bythe dfa.aswediscuss insection thiscorresp ondsto nding1 ?php title get name get out name .
title.
name 5echo out ?
figure another simple example acutinthegraph de ned bythestates andthetransitions ofthedfa i.e.
nding asetofedges suchthatwhen we removethem there arenopaths leftinthegraph fromthe initial stateofthedfatoa nalstate.
notethateachedge ofthedfaislabeledwithasymbol.after we ndacut if wetaketheunion ofthesymbolsoftheedges inthecut we obtain asetofsymbolssuchthatanystring accepted bythe dfamustinclude atleastoneofthesymbolsinthatset.
weuseamin cut algorithm tocompute acutthatcontainsminim umnumberofedges.
then wegenerate apatch thatdeletes allthecharacters fromtheinput thatappear ontheedges included inthecutset.forthedfashownin figure a themin cut algorithm returns thesingle edge labeledwiththesymbol .sowegenerate apatchthat deletes allthe symbolsfromtheinput asshowninfigure2 b .
notethat unlikethepatchshowninfigure a thepatchgenerated based onthematch and sanitize strategycontinuestoexecute thescript afterthesanitization.
relational vulnerabilit ysignature generation considerthesimple script showninfigure .thisexample is similar totheoneshowninfigure 1withonesigni can tdifference there aretwoinput variables thatbothcontribute tothestring expression usedatthesinkstatemen tatline5.
assume thatweuseoursingle trac kautomata based analysisdescrib edabovetoanalyze thisscript.
thesetofattackstrings generated forthesinkstatemen tatline5will again be name .however theresult ofthebackwardanalysis willbedi eren t.thecrucial stepistheprecondition computation forthestatemen tinline4.theinputtothispre condition computation willbeadfathat accepts theattackstrings characterized bytheregular expression givenabove.theresult ofthepre condition computation willgenerate twodfas oneforthevariablename andoneforthevariabletitle andthese dfaswillcharacterize allpossible valuesthese twovariables cantakejust beforetheexecution ofstatemen tinline4thatcanleadto generation ofanattackstring atthesinkstatemen tinline .when wedothispre condition computation wegettwo dfasthataccept thesame language i.e.
anyvalueof either variable canleadtoanattackstring.
although this isasound approximation itfailstocapture theinformation thatatleastoneofthesevariables should contain thecharacter .notethatthiscondition cannot beexpressed asa constrain tonanindividual variable itidenti esarelation betweenthetwostring variables.
ourrelational analysis usesasingle multi trac kautomaton mdf a foreachprogram pointtocapture therelationshipbetweentheinput values andpossible values ofstring expressions intheprogram.
weuseaforwardanalysis that operates onthedependency graph.
weshowthedependency graph fortheexample fromfigure 4infigure .we write thestring expression intheprogram thatcorresp onds toeachnodeinthedependency graph totheleftsideof thenodeandalsogivethelinenumber.ouranalysis starts fromtheinput nodesandtraversesthedependency graph while generating onemdfaforeachinternal nodeofthede i1 get get name line title line i2 n1 n2 n1 i1 n2 i2 n3n3 i1 .
i2 title .
name line name .
title .
name line n5n5 name .
i1 .
i2n4 name line n6n6 name .
i1 .
i2 out lines figure dependency graph pendency graph.
eachmdfahasonetrackforeachinput variable andonetrackforthestring expression thatcorrespondstothatnode andrepresen tstherelation between them.
infigure 5weshowastring constrain tontheright sideofeachinternal node.thatstring constrain tcharacterizesthesetofstrings accepted bythemdfaforthatnode.
forexample fornoden3 thestring constrain tisn3 i1 i2 whichindicates thatthestring expression thatcorresp onds tonoden3isequal totheconcatenation ofinput i1and input i2.
when theanalysis reachesasinknode weintersect the trackthatcorresp ondstothestring expression forthesink node inourexample thiswouldbethetrackthatcorrespondstonoden6 withtheattackpattern dfa byextending theattackpattern dfatoanmdfabyadding extra tracksthataccept allstrings .
after theintersection weprojectawaythetrackforthesinknode leavingonly thetracksfortheinput nodes.theresulting mdfarepresentstherelational vulnerabilit ysignature.
forourexample thevulnerabilit ysignature mdfaisshowninfigure3 b where eachtransition ismarkedwithtwosymbols oneforeachtrack andifatrackismarkedwiththesymbol thenthatmeans thatnosymbolfromthattrackis consumed when thattransition istaken .
note thatthis automaton accepts tuples ofstrings where either the rst string inthetuple orthesecond string inthetuple contains atleastone symbol.
thepatchesshowninfigure 2forthesingle input caseare generated byconverting thestandard dfarepresen tation toaregular expression andthenusing thephppreg match function togenerate thematchpartofthepatch.fortherelational case when wegenerate tworegular expressions one foreachinput fromtheautomaton showninfigure b weagain get forbothinputs soallinputs match.thisis acceptable ifweusethematch and sanitize strategy since although alltheinput strings willbeconsidered potentially vulnerable onlyasmall setofsymbolsthatrelate tothe vulnerabilit ywillbereplaced.
forexample thepatchgenerated using thisapproac hfortheexample infigure 4is showninfigure .however ifweusethematch and blo ck approac husing theregular expression wewillblockall theinputs whichisnotacceptable.
aswediscuss insection3 insuchcasesitisnecessary togenerate matchstatementsthatuseautomata simulation instead ofautomata to regular expression conversion.
inorder togenerate thesanitization statemen tsfromrelational vulnerabilit ysignatures we ndamin cut inthe vulnerabilit ysignature mdfaaswedidforthesingle trac k1 ?php .1if preg match get andpreg match get .
get preg replace get .
get preg replace get title get name get out name .
title.
name 5echo out ?
figure patchfortheexample fromfigure case.then foreachtrack wetaketheunion ofthesymbols onthattrackforalltheedges inthemin cut.
inorder tosanitizetheinput weneedtoremovethesymbolsforeachtrack fromtheinput thatcorresp ondstothattrack.forexample based onthemin cut showninfigure b weneedto delete thesymbol bothfromtheinputs get and get .theautomatically generated replace statementsforthisexample areshowninfigure .
.sanitiza tion genera tion inthissection wedescrib ehowwegenerate sanitization statemen tsgivenavulnerabilit ysignature thatischaracterizedeither asastandard single trac kautomaton dfa or amulti trac kautomaton mdf a .wediscuss thedetails of vulnerabilit ysignature generation inlatersections.
inorder toimplemen tthematch and blo ckandmatchand sanitize strategies weneedtogenerate codeforthematch andreplacestatemen ts.
matchgeneration there aretwowaysof matching regular expr ession b asedmatching generate aregularexpression from thevulnerabilit ysignature automatonandthenusethephp function preg match tocheckif theinput matchesthegenerated regular expression or2 automata simulation b asedmatching generate codethat givenaninput string simulates thevulnerabilit ysignature automaton todetermine iftheinput string isaccepted bythe vulnerabilit ysignature automaton i.e.
iftheinput string matchesthevulnerabilit ysignature.
we rsttriedtheregular expression based matchingapproach.however thisapproac hendsupbeingveryine cientduetotheimplemen tation ofpreg match inphp.the alphab etofthevulnerabilit ysignature automata consists of the256asciicharacters andthevulnerabilit ysignature automata canhavealarge numberofstates ifthere area lotofcomplex string manipulation operations inthecode.
inoneoftheexamples weanalyzed thevulnerabilit ysignature automaton consists of811states.
thesizeofthe regular expression generated fromthevulnerabilit ysignatureautomaton canbeexponentialinthenumberofstates oftheautomaton .
hence wemayendupwithvery large regular expressions.
moreo ver thepreg match functioninphp doesnotonlycheckifagiveninput matches thegivenregular expression butitalsocomputes allthesubstrings thatmatchtheparenthesized subexpressions ofthe givenregular expression.
since thedfatoregular expressionconversion algorithm cangenerate alotofparenthesized subexpressions thismeans thatthepreg match function will doalotofunnecessary extra workduring thematch resultingwithanine cien tmatchimplemen tation.
inorder todoe cien tmatchingweusethedfasimulationalgorithm whichhaslinear timecomplexit y .giventhevulnerabilit ysignature dfa wegenerate afunction that takesastring asinput simulates thedfa andreturns true ifthedfaaccepts thestring orfalseotherwise.
weinsertthematchfunction instead ofthepreg match statemen ts showninthepatchesinfigures 2and6.
fortherelational vulnerabilit ysignatures weuseasimilar approac h.givenarelational vulnerabilit ysignature characterized asanmdfa wegenerate codethatsimulates the mdfaduring thematchgeneration.
themdfasimulation algorithm issimilar tothedfasimulation algorithm itjust keepsaseparate pointerforeachinput string tokeeptrack ofhowmuchofeachtrackisprocessed atanygiventime andadvances thestate ofthemdfabased onthetuples ofinput symbolsandthetransition relation ofthemdfa.
thesimulation timeformdfaislinear inthetotallength oftheinput strings.
replace generation forthematch and sanitize strategy ourautomated sanitization generation algorithm takes thevulnerabilit ysignature automaton asinput anditgenerates areplace statemen tthatmodi es agiveninput string insuchawaythatthemodi ed string isnotaccepted by thethevulnerabilit ysignature automaton meaning that themodi ed string cannot cause anattack .wemodify theinput strings byjustdeleting asetofcharacters using thepreg replace function ourapproac hcanbeextended so thatescapecharacters canbeinserted infrontofasetof characters rather thandeleting them .
inorder toprevent extensiv emodi cation totheinput thesetofcharacters to bedeleted should beassmall aspossible.
thequestion is howcanweidentifythesetofcharacters tobedeleted?
first wewillformalize thisproblem inautomata theoretic terms.
letm hq q0 fidenote adfawhere qis thesetofstates isthealphab et q qisthe transition relation q02qistheinitial state andf q isthesetofaccepting states.
l m denotes thelanguage accepted bym.wesays isanalphab et cut ofm if l m l s where l s ns isthesetofallstrings thatdonotcontainanycharacter ins.themin alphab etcutproblem is nding thealphab et cut smin suchthatfor anyother alphab et cut s jsminj jsj.fortheexample automaton infigure a themin alphab et cut isf g. themin alphab et cut problem canalsobestated ingraphtheoretic terms.
givenadfam anedge cut ofmisaset oftransitions e suchthat ifthesetoftransitions ine areremovedfromthetransition relation thennoneofthe states infarereachable fromtheinitial state q0.letse denote thesetofsymbolsofthetransitions ine.ifeisan edge cut ofmthenseisanalphab et cut ofm.hence ndingthemin alphab et cut isequivalentto nding anedge cut withminim umsetofdistinct symbols.fortheexample automaton infigure a themin edge cut isf g which alsocorresp ondstothemin alphab et cut.
notethat ifthevulnerabilit ysignature dfaaccepts the emptystring thenthere willnotbeanyedge oralphab et cutsincetheinitial statewouldbeanaccepting state.
for therestofourdiscussion wewillassume thatthedfafor thevulnerabilit ysignature doesnotaccept theemptystring wecaneasily handle thecases where itaccepts theempty string by rsttesting iftheinput string isemptyandthen inserting asingle character totheinput ifitis .
theorem themin alphab et cut problem isnp har d. weprovethisbyareduction fromthevertexcoverproblem.avertexcoverofagraph g v e isasetofvertices such thateachedgeofthegraph isinciden ttoatleastonevertex oftheset.theproblem of nding aminim umvertex cover isknowntobenp complete.
vertex coverproblem canbe reduced tothemin alphab et cut problem asfollows.given g v e webuildanautomaton m hq q0 fiwith thesetofstates q e fq0 qfg theinitial stateq0 setof nalstates f fqfg alphab et v andthetransition relation de ned asfollows e v v0 2e q0 v e e v0 qf .themin alphab et cut fortheautomaton mistheminim umvertex coverforthegraph g. since themin alphab et cut problem isintractable rather thantrying to ndtheoptim umsolution wecanconsider using e cien theuristics thatgiveareasonably small cut thatisnotnecessarily theoptim umsolution.
infact there isaverygoodcandidate foraheuristic solution.
given adfam amin edge cut ofmisanedge cut eminsuch thatforanyother edge cut e jeminj jej.notethatthe min edge cut minimizes thenumberofedges intheedge cut whereas themin alphab et cut minimizes thesetofsymbols ontheedges intheedge cut.
interestingly eventhough themin alphab et cut problem isintractable there isanefcientalgorithm forcomputing themin edge cut.
weuse theford fulkerson s maxo wmin cut algorithm to nd amin edge cut eminwhere thecomplexit yofthealgorithm iso j j2 .note thatjsminj jeminj i.e.
themin edgecutprovides andupperboundforthemin alphab et cut.
so ifthemin edge cut issmall thenthesetofdistinct symbolsontheedges ofthemin edge cut willgiveusagood approximation ofthesmin.
once wecompute analphab et cut susing ourheuristic wegenerate apreg replace statemen tthatdeletes thesymbolsinsfrom theinput making surethattheresulting string doesnotmatchthevulnerabilit ysignature.
thede nition ofthemin alphab et cut problem isdi eren t formulti trac kautomata.
givenann trackmdfamover n wesayann tuple s s1 sn where si isanalphab et cut ofm ifl m l s where l s ns1 nsn isthesetofallstrings whose ithtrackdoesnotcontainanycharacter insi.let jsj js1j jsnj.themin alphab et cut problem fora mdfamis nding thealphab etcutsminofm suchthat foranyalphab etcutsofm jsminj jsj.
since min alphab et cut isintractable forsingle trac kdfa itisalsointractable formdfa.weusemin edge cut alsoas anapproximation formin alphab et cut formdfa.when we ndamin edge cut wecompute thecorresp onding multitrackalphab et cut bycomputing asetofsymbolsforeach trackbycollecting thesetofdistinct symbols other than oneachtrackontheedges inthemin edge cut.
theresulting alphab etcutisann tuple s s1 sn where eachsiisthesetofsymbolsfortracki i.e.
input i.for theexample automaton infigure b themin edge cut is f g whichalsocorrespondstothemin alphab et cut f g f g .
once wecompute thealphab et cuts wegenerate one preg replace statemen tforeachinput variable i thatdeletes everysymbolinsifromtheinput isothattheresulting inputstrings donotmatchthevulnerabilit ysignature.
.vulnerability analysis inthissection we rstde ne thedependency graphs and thendescrib eourvulnerabilit yanalysis.
adependency graphg hn eiisadirected graph where nisa nite setof nodesande n nisa nite setofdirected edges.
an edge ni nj 2eidenti es thatthevalueofnjdepends onthevalueofni e.g.
assign thevalueofthevariable associated withnitothevariable associated withnjinthe program.
eachnoden2ncanbe anormal nodeincluding input constant variable or anoperation node including concat andreplace .
aninput nodeidenti esthedatafromuntrusted parties e.g.
aninput fromwebforms.
aconstant nodeisassociated withaconstan tvalue.bothnodeshavenopredecessors.
aconcat nodenhastwopredecessors thepre x node n p andthesu x node n s andstores theconcatenation ofanyvalueofthepre x nodeandanyvalueofthesu x nodeinn.
areplace nodehasthree predecessors thetarget node n t thematchnode n m andthereplacemen tnode n r .foreachvalueofn tit identi esallthematches i.e.
anyvalueofn m thatappearinn t replaces all these matchesinn twithanyvalueofn r and stores theresult inn.
forn2n succ n fn0j n n0 2egistheset ofsuccessors ofn.pred n fn0j n0 n 2egisthe setofpredecessors ofn.foradependency graph g we alsode ne root g fnjpred n gandleaf g fnjsucc n g. ourvulnerabilit yanalysis takesthefollowing inputs a dependency graph g asetofsinknodes sink andan attackpattern attk .sinkdenotes thenodesthatareassociated withsensitiv efunctions thatmightleadtovulnerabilities.
attkisaregular expression represen tedasadfa.
ourvulnerabilit yanalysis approximates thesetofstring values asaregular language andrepresen tsthem symbolically asadfathataccepts thatlanguage.
toassociate eachnodewithitsautomata wecreate twoautomata vectorspost andpre.thesizeofbothisbounded byjnj.
post isthedfaaccepting allpossible valuesthatnode ncantake.pre isthedfaaccepting allpossible values thatnodencantaketoexploit thevulnerabilit y.initially allthese automata accept nothing i.e.
their language is empty.vul sinkisthesetofvulnerable program points andinitially issettoanemptyset.
weuseaforwardsymbolicreachabilit yanalysis based on astandard workqueue algorithm.
weiterativ elyupdatethe automata vectorpost untila xpointisreached.atline constr uct n returns adfathat accepts arbitrary strings ifnisaninput node accepts anemptystring if nisavariable node or accepts theconstan tvalueifn isaconstant node.atlines9and11 weincorp orate two automata based string manipulating functions conca t dfam1 dfam2 returns adfamthataccepts fw1w2jw12l m1 w22l m2 g. repla ce dfam1 dfam2 dfam3 returns adfam that accepts fw1c1w2c2 wkckwk 1jk w1x1w2x2 wkxkwk 12l m1 8i xi2l m2 widoes notcontainanysubstring accepted bym2 ci2l m3 g. atline15 weincorp orate theautomata widening operator r toaccelerate the xpointcomputation whichensures termination andreturns theleast xpointunder certain conditions.
upontermination ofthewhile loop lines 4to20 post records thedfawhose language includes allpossiblevalues thatncantake.algorithm 1vulanal ysis g sink attk init post pre queue wq null wq.enqueue root g while wq6 nulldo n wq.dequeue ifn2root g then tmp constr uct n elseifnisconcat then tmp conca t post post elseifnisreplace then tmp repla ce post post post else tmp s n02pred n post endif tmp tmp rpost iftmp6 post then post tmp wq.enqueue succ n endif endwhile setvul fg foreachn2sinkdo tmp post attk ifl tmp then vul vul fng pre tmp endif endfor return vul intheforloop lines 22to28 foreachnoden2sink we generate adfatmpbyintersecting theattackpattern and thepossible valuesofn.ifl tmp isnotempty weidentify thatnisavulnerable program pointandaddittovulatline .infact tmpaccepts thesetofreachable attackstrings at nodenthatcanbeusedtoexploit thevulnerabilit y.hence weassign tmptopre atline26.thisinformation isthen passed toourvulnerabilit ysignature generation algorithm.
.vulnerability sign atures inthissection wepresen tournon relational vulnerabilitysignature generation algorithm algorithm whichisa backwardsymbolicreachabilit ycomputation based onsingletrackdfas.forn2vul pre issettotheintersection of post andattkduring thevulnerabilit yanalysis phase before thebackwardanalysis starts.
thepredecessors of n2vularethestarting pointsofthebackwardanalysis.
similar totheforwardanalysis thecomputation isbased onastandard workqueue algorithm.
we rstputthepredecessors ofn2vulintothework queue asshownatline2 .weiterativ elyupdatethepre array byadding pre images untilwereacha xpoint.ifthe successor ofnisanoperation node thepre image tmp of niscomputed inlines11 13and17bycalling thede ned automata based functions preconca tprefix preconca tsuffix andprerepla cewhichwede ne below.otherwise thepre image ofnisdirectly derivedfromthesuccessor ofn line20 .notethatpost records allpossible valuesthat ncantake.weusethisinformation during thepre image computation byrestricting theargumen tsofoperations such asreplace .weunion thepre images ofnastmp0atline22.
since weareinterested onlyinreachable valuesofn i.e.
pre post byde nition weintersect tmp0with post atline24.similar totheforwardanalysis we widen theresult atline25toaccelerate the xpointcomputation.
atline26 weintersect tmp0withpost again toremoveunreac hable values that mighthavebeenintro algorithm 2vulsiggen g post pre vul queue wq null foreachn2vuldo wq.enqueue pred n endfor while wq6 nulldo n wq.dequeue tmp0 null foreachn02succ n do ifn0isconcat then ifnisn0 lthen tmp preconca tprefix pre post else tmp preconca tsuffix pre post endif elseifn0isreplace then ifnisn0 tthen tmp prerepla ce pre post post endif else tmp pre endif tmp0 tmp0 tmp endfor tmp0 tmp0 post tmp0 tmp0 rpre tmp0 tmp0 post iftmp06 pre then pre tmp0 wq.enqueue pred n endif endwhile return pre duced duetowidening atnoden.iftmp0accepts more values thanpre weupdatepre atline28andadd thepredecessors ofntotheworking queue atline29.upon termination pre records thedfathataccepts allpossiblevaluesofnthatmayexploit theidenti ed vulnerabilit y. pre image computation below weexplain howwecomputethefollowingpre image functions preconca tprefix dfam dfam2 returns adfam1 sothatm conca t m1 m2 .
preconca tsuffix dfam dfam1 returns adfam2 sothatm conca t m1 m2 .
prerepla ce dfam m2 m3 returns adfam1sothat m repla ce m1 m2 m3 .
concatenation tocompute thepre image ofconcatenation nodes weintroduce concatenation transducers to specifytherelation among itsoutput andtwoinput nodes.
transducers aremulti trac kautomata weuseforimage computation these aredi eren tthanthemulti trac kautomata weuseforrelational vulnerabilit ysignature generation in thenextsection .
aconcatenation transducer isamdfa overthealphab etthatconsists of3tracks.the3 trac k alphab etisde ned as f g f g where isaspecialsymbolforpadding.
weusew i todenote theithtrackofw2 .alltracks arealigned.
w w isleftjusti ed and w isrightjusti ed.
weusew0 w0 to denote the freepre x ofw andthe freesu x ofw .
wesaywisaccepted byaconcatenation transducer mif w w0 w0 .since aconcatenation transducer binds thevaluesofdi eren ttrackscharacter bycharacter itisable toidentifythepre x andsu x relations precisely .
hereweonlyconsider howtocompute thepre image ofthepre x node i.e.
yinx yz givenregular setscharacterizing possible valuesoftheoutput nodexandthesu x nodez.thepre image ofthesu x nodecanbecomputed inasimilar way.letmxandmz accept valuesofxandz respectively.preconca tprefix mx mz returns mywhich isconstructed using thefollowingsteps extend mxtoa3 trac kdfam0 sothatm0accepts fwjw 2l mx g. construct theconcatenation transducer mthataccepts fwjw w0 w0 w0 2l mz g. intersect m0with m.theresult accepts fwjw w0 w0 w 2l mx w0 2l mz g.wethenproject awaythe rstandthethird tracks.
remove tailsifanytoconstruct my.
replacemen t recall thatareplace nodehasthree input nodes target match andreplacemen t.letusconsider the pre image ofthetarget nodegivenregular setscharacterizingpossible values oftheoutput node thematchnode andthereplacemen tnode.letmx repla ce mt mm mr thenourgoalistocompute mt givenmx mm and mr.weconserv ativelymodelprerepla ce mx mm mr as repla ce mx mr mm mr .theresult isanoverapproximation ofthepre image ofthetarget node.
.rela tion alsign atures arelational vulnerabilit ysignature mofninputs isa mdfaoverthen trackalphab et n de ned as f g f g ntimes where isthespecialsymbol forpadding.
wefurther restrict m sothatalltracksare aligned andforanyw2l m w i n .
letw0 denote thelongest freesubstring ofw .
givenadependency graph g asetofinput nodesin a sinknodesink andanattackpattern attk ourgoalisto generate arelational vulnerabilit ysignature msuchthat misajinj trackmdfa.eachtrackisassociated with aninput variable xn n2in.
foranywordw w wehavew2l m ifthefollowingcondition holds ifwesetw0 astheinitial valueoftheinput nodeiand propagate thevaluesofthenodesalong withgaccordingly thevalueofthenodesinkmatchesthepattern attk.i.e.
widenti es themalicious inputs whose combination may exploit thevulnerabilit y. thealgorithm togenerate arelational vulnerabilit ysignatureisshowninalgorithm .weperform forwar d xpoint computation onthedependency graph wherereplace nodes areignored.
ourrelational vulnerabilit ysignature algorithm isnotcapable ofhandling replace statemen ts.however since werunthevulnerabilit ysignature generation aftera vulnerabilit yisdetected weargue thatitisreasonable to ignore thesanitization statemen tsinthecode whichisthe typical useforthereplace statemen ts .after wegenerate therelational vulnerabilit ysignature theexisting sanitizationstatemen tscanbecommen tedoutandreplaced with theautomatically generated sanitization statemen ts.
similar totheother analyses wepresen ted weuseastandardworkqueue algorithm incorp orating theautomata wideningoperator.
eachnodeisassociated withasignature a i trac kmdfawhere the rstitracksareassociated with some input variables e.g.
xn n2in andthelasttrack output track isassociated withxousedtorepresen tthe valuesofthecurren tnode.more speci cally i i jinj isthenumberoftheinput variables whose valueshavebeenusedtoconstruct thevalues ofthecurren tnode.weusea mdfavector swhere s isthesignature associated with nodenanditspeci es therelations among thevaluesofthe input variables andthevaluesofn.
initially foreachinput noden2in s isa2 trac k mdfa associated withxnandxo thataccepts theidentityrelation onxnandxo i.e.
thevalueofthecurren t nodeisequal tothevalueoftheinput variable xn.fora noden2root g nin s isasingle trac kdfa associatedwithxo thateither accepts ifnisavariable node oraccepts aconstan tvalueifnisaconstant node.i.e.
the curren tvalueofthenodeisanarbitrary string oraconstan t. inbothcases itisnotrelated toanyinput variable.
for therest i.e.
n62root g s accepts anemptyset.
after weinitialize satline1 weperform the xpoint computation.
betweenlines6and18 weiterativ elyupdate thesignature ateachnodeuntilthequeue isempty reaching a xpoint .todealwiththeunion orwidening operator on s1ands2thatmaybeassociated withthedi eren tsetsof input variables sayx1andx2 weextend bothtracksto x1 x2andxobypadding sintheadded tracks.we thenapply standard union orwidening tothese extended mdfas.
belowwedescrib ehowtoconcatenate twosignatures conca tsigna ture s1 s2 where s1isthesignature ofthe pre x nodeands2isthesignature ofthesu x node.let s1 hq1 i1 f1ibeamdfawhose tracksareassociated withthesetofinput variables x1andxowhere jx1j .lets2beamdfawhose tracksare associated withthesetofinput variables x2andxowhere jx2j .we rstextend s1ands2totwo mdfas 1ands 2thatareassociated withx1 x2and xo.weextend s1 pre x tos 1byadding intheadded tracks while weextend s2 su x tos 2byadding in boththeadded tracksandthecommon tracksthatarealso associated withs1.conca tsigna ture s1 s2 returns the jx1 x2j trac kmdfathataccepts theconcatenation ofs 1ands .
after reachinga xpoint atline19 weintersect thesignature ofsinkwiththeattackpattern ontheoutput track.
letmattkaccepts fwjw 2attkg.thisisdone by thestandard intersection ofs andmattk.after the intersection theoutput trackidenti esthereachable attack strings andtheinput tracksidentifyallthemalicious inputs whose combination canyieldanattackstring.
atline20 weprojectawaytheoutput trackfromm andreturn the result atline21astherelational vulnerabilit ysignature of hg in sink attki.
.experiments we rstevaluated ourapproac hforxssvulnerabilities using veknownexamples.
then weapplied ouranalysis to three opensource webapplications tosearchforxssand sqli vulnerabilities.
inourexperimen tsweusedanintel machinewith3.0ghzprocessor and4gbofmemory runningubuntulinux8.
.
weused8bitstoencodeeach asciicharacter.
forthexssvulnerabilities thesinks include theprintf andechofunctions andforthesqli vulnerabilities thesinksinclude themysql query function.
we usedtheattackpattern script indicating anembeddedscript forthexssvulnerabilit yandtheattackpattern or1 indicating atruecondition inaquery for thesqli vulnerabilit y.ourapproac hcandealwithanyalgorithm 3relsiggen g in sink attk init s g in queue wq null forn2in root g do wq.enqueue succ n endfor while wq6 nulldo n wq.dequeue ifnisconcat then tmp conca tsigna ture s s else tmp s n02pred n s endif tmp tmp rs iftmp6 s then s tmp wq.enqueue succ n endif endwhile m s mattk projecttheoutput trackawayfrom m return m attackpattern speci ed asaregular expression.
forsanitization synthesis ourtoolgenerates matchstatementsasacextension tophpthatsimulates thevulnerabilitysignature automaton.
forreplace statemen ts itgenerates aphp function preg replace todelete characters thatareidenti ed bythealphab et cuts generated fromthe vulnerabilit ysignature automata.
patchingknownvulnerabilities we rstanalyzed ve benchmarks manuallyextracted from myeasymarket .
ashopping cartprogram bloggit .
ablogengine and promanager .
aprojectmanagemen tsystem .
eachbenchmark represen tsaknownxssvulnerabilit y containing asingle sink.
thedependency graphs ofthese benchmarks arerather small around nodes butinclude loops concatenations withlargeconstan ts andnested replacemen ts from customized orphpbuilt in sanitization routines andrepresen ttypical string manipulation operationsinphpwebapplications.
asexpected ourvulnerabilit yanalysis reported thatall benchmarks arevulnerable andreturned thecorresp onding vulnerabilit ysignature foreachinput.
benchmark 3has twouserinputs contributing tothevulnerabilit yandwe generated bothsingle trac k denoted as3s andmulti trac k signatures denoted as3r .table1showsthenumberof edges inthemin edge cut forthevulnerabilit ysignature automata wecomputed andthealphab et cuts thatcorresp ond tothese min edge cuts.
sig.
3s 3r edges alp.
cut f gfs g f g f gf gf g table1 minim umedge andalphab etcuts ourresults showthatourtechniques areverye ectiv e. aswecansee themin edge cut results inaverysmall alphab et cut andmanyofthem 1and3r aretheoptimumsolutions.
forbenchmark using single trac ksignatures 3s givesthealphab et cut forbothinputs.
i.e.
weneedtodelete allcharacters.
aswediscussed earlier thisisduetothefactthatsingle tracksignatures cannot keeptherelation among inputs andaretoocoarse inthis case tosynthesize practical sanitization code.onthe other hand therelational signature 3r givestheoptim um solution deleting only frominput 1andinput .wefavorednon alphan umeric characters while generating thealphab et cuts byincreasing theweightsofthealphan umeric characters during themin cut algorithm weassume thatalphan umeric characters aremore likelytorepresen t normal userinput andweprefer nottodelete them unless necessary thisresulted inhavingnon alphan umeric characters inallthecutsbutone.finally existing sanitization routines intheanalyzed applications canaddsome additional characters tothealphab et cut duetotheconserv ative nature ofouranalysis thatover appro ximates thevulnerabilitysignatures.
forexample in2 and areintroduced by thephpsanitization routinemysql real escape string .
analyzing andpatchingopensource applications weapplied ouranalysis tothree opensource phpwebapplications webchess .
.
aserverforplayingchess overtheinternet eve1.
atrackerforplayersactivit y foranonline game and faqforge .
.
adocumen t managemen ttool .thesizesoftheseapplications areshown in2.these applications aredownloaded fromsourceforge andaredirectly analyzed using thetechniques presen tedin thispaperwithout anymanualmodi cation.
application ofphp les totalloc ofsinks xss sqli 1webchess0.
.
eve1.
3faqforge .
.
table2 thesizesofanalyzed applications table3summarizes theresults ofourxssandsqli vulnerabilit yanalyses respectivelyandtheperformance forsignature generation.
stranger discovered55xssand61 sqli vulnerabilities inthese applications.
intable3 single indicates thenumberofdetected vulnerabilities thathavesingle input twoinputs three inputs andfourinputs respectively.forexample there are20vulnerabilities detected infaqforge andtheyallhavesingle input denoted as .that is foreachvulnerable sink wehave onlyoneinput contributing avaluetothesink.
weautomatically generate multi trac ksignatures forvulnerabilities thathavemultiple inputs andsingle trac ksignatures for vulnerabilities thathavesingle input.
there arethree sqli vulnerabilities forwhichwewerenotabletosynthesize sanitization patchesduetothelargenumberofinputs anddue toaboundinthemona dfapackageimplemen tation that limits thenumberoftrackswecandeclare foragivendfa.
during thesqli vulnerabilit yanalysis offaqforge thetaint analysis phase doesnotreportanysinks thatdependon userinputs soourtooldoesnotexecute anyofthestring analysis phases anddoesnotreportandvulnerabilities.
based ontheresults shownintable3 theanalysis cost seems a ordable thetotaltimeindicates thetotal time toanalyze allphp lesinthese applications from start totheend whichincludes pre pro cessing parsing dependency andtaintanalyses timeandstring analysis vulnerabilityanalysis andvulnerabilit ysignature generation time.
itranges from8seconds to290seconds.
thefwdtimeindicatesthetotaltimetodetect vulnerabilities fromalltainted sinks determined by rstrunning ataintanalysis inall phpscripts.
thebwdtimeindicates thetotaltimetogenerate single tracksignatures foralldetected vulnerabilities thathavesingle input andtherelational timeindicates the totaltimetogenerate multitracksignatures foralldetected vulnerabilities thathavemultiple inputs.
ofvul.
time seconds mem kb single total fwd bwd relational average xssvulnerabilit yanalysis .
.
.
.
.
.
.
.
.
.
sqli vulnerabilit yanalysis .
.
.
.
.
.
.
.
.
table3 xss sqli vulnerabilit yanalysis results replace performance theaverage timespentingenerating thealphab et cut from thevulnerabilit ysignature automata forxss sqli was0.
.
seconds perautomaton forwebchess .
.
seconds perautomaton for eve and0.05seconds perautomaton forfaqforge.
we notice thatmincut forxssanalysis results foreve took thelargest timeasitcontains onlythree input signature automata asapposedtomostly single input signature automata intheother two.
allofthegenerated alphab et cuts containonlyasingle character pereachinput.
foreachxsssingle trackautomata thecutisonlythecharacter whichistheoptimumcut consequen tlytheoptim umsanitization withrespecttotheattackpattern .
similarly forthexssrelational signature automata weobtained foreachinput.
theautomatically generated sanitization replace statementsfromouranalysis werealmost thesame astheones thataremanually written except thattheydelete the character instead ofreplacing itwiththehtml entity lt asistypically doneinmanualsanitization.
forthesqli vulnerabilities theresults weresimilar where thereported cutscontained onlythecharacter instead of .
ouranalysis produces twoartifacts aphp extension thatcontainsastranger match function foreachvulnerableinput andasetofpreg replace statemen ts onefor eachvulnerable input.
inphp userinputs from get and post arealwaysavailable atthe rstprogram pointinthe script.
thismeans thatwecansanitize theinputs atthe rstphplineofthetarget script.
inserting these callscan easily beautomated aswehavethe lenames foreachof theinput variables along withthevariables names fromthe parsing phase.
notethatweareanalyzing phpscripts statically inasound manner where weonlydealwithonescript atatimealong withallthe lesitincludes.
weusedtheresultofouranalysis tosanitize thethree applications above byplacing theautomatically generated sanitization statementsatthebeginning ofeachvulnerable script.
then we ranourforwardvulnerabilit yanalysis whichreported zero vulnerabilities withregard totheattackpattern mentioned abovedemonstrating thatouranalysis sound andguaran tees thatafterthesanitization statemen tsareinserted sensitiv e functions willnotreceiv eanyinput thatmatchestheattack pattern.
.conclusions most critical securit yvulnerabilities inwebapplications arecaused byinadequate manipulation ofinput strings.
in thispaperwepresen tedasetoftechniques that1 identifyvulnerabilities thatareduetostring manipulation generate acharacterization ofinputs thatcanexploit the vulnerabilit y and3 generate sanitization statemen tsthat eliminate thevulnerabilit y. .