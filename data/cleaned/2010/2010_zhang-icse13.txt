bridging the gap between the total andadditional test case prioritization strategies lingming zhang dan hao lu zhang gregg rothermel hong mei key laboratory of high confidence software technologies pe king university moe beijing china zhanglm07 haod zhanglu meih sei.pku.edu.cn department of electrical and computer engineering univer sity of texas austin usa zhanglm utexas.edu department of computer science and engineering universit y of nebraska lincoln usa grother cse.unl.edu abstract in recent years researchers have intensively investigated various topics in test case prioritization which aims to re order test cases to increase the rate of fault detection d uring regression testing.
the total and additional prioritization strategies which prioritize based on total numbers of elements co vered per test and numbers of additional not yet covered elem ents covered per test are two widely adopted generic strategie s used for such prioritization.
this paper proposes a basic model a nd an extended model that unify the total strategy and the additional strategy.
our models yield a spectrum of generic strategies ranging between the total and additional strategies depending on a parameter referred to as the pvalue.
we also propose four heuristics to obtain differentiated pvalues for different methods under test.
we performed an empirical study on versions of four java programs to explore our results.
our results demonstrate that wide ranges of strategies in our ba sic and extended models with uniform pvalues can significantly outperform both the total and additional strategies.
in addition our results also demonstrate that using differentiated pvalues for both the basic and extended models with method coverage can even outperform the additional strategy using statement coverage.
i. i ntroduction software engineers usually maintain a large number of test cases which can be reused in regression testing to test soft ware changes.
due to the large number of test cases regression testing can be very time consuming.
for example elbaum et al.
reported one industrial case in which the execut ion time of the entire regression test suite for one product was seven weeks.
test case prioritization which attempts to re order regression test cases to detect f aults as early as possible has been intensively investigated as a way to deal with lengthy regression testing cycles.
in test case prioritization a fundamental topic involves prioritization strategies.
in previous work researchers have studied two greedy strategies the total andadditional strategies which are generic for different coverage criteria.
g iven a coverage criterion the total strategy sorts test cases in descending order of coverage whereas the additional strategy always picks a next test case having the maximal coverage of items not yet covered by previously prioritized test case s. in addition to these two strategies researchers have also investigated other generic strategies.
li et al.
inves tigated the optimal greedy strategy a hill climbing strate gy anda genetic programming strategy.
jiang et al.
investiga ted adaptive random prioritization.
their empirical results s how that the additional strategy remains the most effective generic strategy on average in terms of rate of fault detection.
there is also however a weakness in the additional strategy.
consider statement coverage for instance.
in the additional strategy after a test case tis chosen no statement covered by tis explicitly considered again until all coverable statements are covered at least one time.
as a result when there is a fault fin one statement covered by tbut not covered by any test case chosen before t iftcannot detect f the detection of fmay be greatly postponed.
in contrast the total strategy does not have this weakness because when choosing a next test case the total strategy always considers all statements no matter whether or not previously chosen test cases have covered the statements.
this said as the total strategy counts only the numbers of statements covered by each test case it may be more inclined to choose test cases to cover statements previously covered many times than to choose test cases to cover previously not intensively covered statements.
th us thetotal strategy may postpone the detection of faults in rarely covered statements.
as a result some strategy that has the flavor of both the additional strategy and the total strategy may be more advantageous.
to understand the situation in which a test case covers a statement but does not reveal a fault in the statement consi der the following piece of code with a fault in line .
the code is a method returning the larger of xandy.
a test case in which the value ofxis smaller than that of ycovers the faulty statement and detects the fault.
however a test case in which the value ofxis equal to that of yalso covers the faulty statement but does not detect the fault.
intmax intx inty if x y returnx else returnx should be return y .
in fact research on test suite reduction has demonstrated that re covering already covered stateme nts may enhance fault detection capability.
furthermore whe n we978 c ieee icse san francisco ca usa accepted for publication by ieee.
c ieee.
personal use of this material is permitted.
permission from ieee must be obtained for all other uses in any current or future media including reprinting republishing this material for advertising or promotional purposes creating new collective works for resale or redistribution to servers or lists or reuse of any copyrighted component of this work in other works.192consider test case prioritization based on coverage infor mation at a coarser level e.g.
the method level it may be more common for a test case to miss a fault in a method covered by the test case because that test case may fail to cover the faulty statement in the method.
in this paper we propose a unified view including a basic model and an extended model for generic strategies in testcase prioritization.
in our models the total and additional strategies are extreme instances and the models also define various generic strategies that lie between the total strategy and the additional strategy depending on the value of fault detection probability referred to as the pvalue .
in addition we further extend the models by using differentiated pvalues.
we view our models as an initial framework to control the uncertainty of fault detection during test case prioritizat ion and believe more techniques can be derived based on our models.
we performed an empirical study to compare our strategies with the total strategy and the additional strategy.
our results demonstrate that many of our strategies can outperform both thetotal andadditional strategies.
the main contributions of this paper are as follows.
a new approach that creates better prioritization techniques by controlling the uncertainty of fault detection capability in test case prioritization.
two models that unify the total andadditional strategies and can also yield a spectrum of generic strategies having flavors of both the total andadditional strategies.
empirical evidence that many strategies between the total andadditional strategies are more effective than either of those strategies.
empirical evidence that our strategies using differentiat ed pvalues with method coverage can significantly outperform the additional strategy with statement coverage.
ii.
u nifying the total and additional strategies with the additional strategy the primary concern is to cover units not yet covered by previous test cases.
this strategy should be well suited for circumstances in which the probabi lity of a test case detecting faults in units it covers is high.
on the other hand the primary concern for the total strategy is to cover the most units with each test case.
this strategy shoul d be well suited for circumstances in which the probability of a test case detecting faults in units it covers is low.
thus if we explicitly consider the probability for a test case to detec t faults in units it covers we may devise strategies to take advantag e of the strengths of both the total andadditional strategies.
more specifically our models initially assign probability valu es for each program unit1.
then each time a unit is covered by a test case that could potentially detect some fault s in t he unit the probability that the unit contains undetected faults is reduced by some ratio between as in the total strategy and as in the additional strategy .
in this way we build 1as our approach is intended to work with different coverage c riteria we useunit as a generic term to denote different structural elements us ed in different coverage criteria.
for example a unit represents a statement for statement coverage but a method for method coverage.a spectrum of generic prioritization strategies between th etotal andadditional strategies.
algorithm prioritization in the basic model with p foreachj j m do prob end for foreachi i n do selected false end for foreachi i n do k whileselected do k k end while sum foreachj j m do ifcover then sum sum prob end if end for foreachl k l n do if notselected then s foreachj j m do ifcover then s s prob end if end for ifs sum then sum s k l end if end if end for priority k selected true foreachj j m do ifcover then prob prob p end if end for end for a. basic model in our basic model when a test case tcovers a unit u we refer to the probability that tcan detect faults in uas p. consider a test suite t t1 t2 ... tn containing ntest cases and a program u u1 u2 ... um containing munits.
algorithm depicts test case prioritization in our basic m odel in which we use a boolean array cover i n j m to denote whether test case ticovers unit uj.
in algorithm we use an array prob j m to store the probability that unit ujcontains undetected faults.
initially we set the value of prob j m to be1.
we use a boolean array selected i n to 2193store whether test case tihas been selected for prioritization.
initially we set the value of selected i n to be false .
furthermore we use an array priority i n to store the prioritized test cases.
if priority is equal to k i k n test case tkis ordered in the ith position.
in algorithm lines perform initialization.
in the mai n loop from lines to each iteration determines which test case to place in the prioritized test suite.
lines find a test casetksuch that tkis previously not chosen and the sum of probabilities that units covered by tkcontain undetected faults is the highest among test cases not yet chosen.
note th at as the basic model utilizes a uniform probability pfor fault detection in covered units lines actually find a test ca se with the highest probability of detecting previously undet ected faults.
in particular lines find the first test case tknot previously chosen for prioritization and calculate the sum of the probabilities that units covered by tkcontain undetected faults and lines check whether there is another uncho sen test case tlfor which the sum of the probabilities that the covered units contain undetected faults is higher than that fortk.
line sets the ith position in the prioritized test suite to tk and line marks tkas already chosen for prioritization.
lines update the probability that un its contain undetected faults for each unit covered by tk.
algorithm is in fact a variant of the algorithm for the additional strategy.
the main difference is that this algorithm tries to find the test case covering units with the maximal sum of probabilities of containing undetected faults.
due to th e similarity between this algorithm and the additional strategy its worst case time cost is the same as that of the additional strategy i.e.
o mn2 wherenis the number of test cases andmis the number of units .
with algorithm an optimistic tester who believes that a test case is likely to detect faults in covered units may set the value of pto1.
in such a circumstance this algorithm is equivalent to the additional strategy.
the reason for this is that lines set the probability for any previously cove red unit to contain undetected faults to .
in contrast a pessimistic tester who is concerned with the situation in which a test cas e may not detect faults in units covered by the test case may set the value of pto0.
in such a circumstance this algorithm is equivalent to the total strategy.
the reason is that lines do not change the probability that any previously covered un it contains undetected faults.
note that setting pto0does not render the algorithm as efficient as the original total strategy whose worst case time cost is o mn .
finally if a tester sets the value of pto a number between 0and1 this algorithm is a strategy between the total strategy and the additional strategy.
the closer pis to0 the closer this algorithm is to the total strategy and the closer pis to1 the closer this algorithm is to the additional strategy.
b. extended model in our basic model and previously proposed strategies for test case prioritization when a test case tcovers a unit u the number of times tcoversuis not further considered.
that is no matter how many times tcoversu the algorithm treats uas having been covered once.
intuitively the more times t coversu the more probable it may be for tto detect faults in u. therefore considering the ability of a test case to cover a unit multiple times may result in higher effectiveness.
we now extend our basic model to consider multiple coverage of units by given test cases.
in our extended model the main body of the algorithm is the same as the algorithm in our basic model but the extended algorithm uses a different method for calculating the probability for a test case to detect previously undetected faults.
we extend cover i n j m to denote the number of times test caseticovers unit uj.
we now present the main differences between the two algorithms.
first as the number of times test case tkcovers unit ujis cover the probability for unit ujto contain undetected faults changes from prob toprob p cover after executing tkif we consider each instance of coverage to have an equal probability pof detecting faults.
that is to say for unitujalone execution of tkdecreases the probability that uj contains undetected faults by prob p cover .
thus in the extended algorithm we change lines and of algorithm to sum sum prob p cover ands s prob p cover respectively.
second after we select test case tkfor prioritization at the ith place the probability for unit ujto contain undetected faults changes from prob toprob p cover .
thus in the extended algorithm we change line of algorithm to prob prob p cover .
the worst case time cost of the extended algorithm is also o mn2 the same as that of algorithm .
in the extended algorithm if we set pto1 the algorithm is the same as the additional strategy because p cover is equal to 0whenpis equal to .
however if we set pto0 the extended algorithm cannot distinguish any test cases fr om each other 2because1 p cover is always equal to whenpis equal to .
if we set pto a number between 0and1 the extended algorithm also represents a strategy between t he total andadditional strategies considering multiple coverage for each test case.
c. differentiating p values in section ii a in our basic model whenever a test case t covers a unit u we consider the probability for tto detect faults in uto be uniformly p. in section ii b using our extended model we reason that when tcoversumultiple times the probability for tto detect faults in umay not be uniform but each instance of coverage also implies a unifor m probability of fault detection.
in reality however fault s in some units may be easier to detect than faults in other units.
in this section we further extend our models to account for the situation in which the probability of fault detectio n is differentiated.
to deal with this situation we need to 2this limitation is due to the specific algorithm but concept ually our extended model implementation yields the total strategy when p .
3194assign different probability values for test cases to detec t faults in different units.
the challenge in performing such an assignment however lies in obtaining effective estimate s of the probability of fault detection.
in this paper we furthe r estimate differentiated pvalues at the method level based on two widely used static metrics mloc which stands for method line of code and mccabe which stands for the wellknown mccabe cyclomatic complexity .
our approach is based on the intuition that methods with larger volume e.g.
higher mloc values or greater complexity e.g.
hig her mccabe values need to be covered more times to reveal the faults within them i.e.
they should have lower pvalues.
we believe that test cases should be good at detecting faults and thus we calculate the pvalue for each method in the range .
formally we use both linear normalization formula and log normalization formula to calcul ate thepvalue for the jth method i.e.
p as follows .
metric metric min metric max metric min .
log10 metric log10 metric min log10 metric max log10 metric min wheremetric denotes the mloc or mccabe metric values for thejth method and metric min metric max denotes the minimum maximum metric value among all methods of the program under test.
based on the two metrics and the two pcalculation formulas we thus have four heuristics for generating a different iated pvalue for each method.
for both models we change all