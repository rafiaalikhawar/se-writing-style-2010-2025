a framework for automated testing of javascript web applications shay artzi ibm research artzi us.ibm.comjulian dolby ibm research dolby us.ibm.comsimon holm jensen aarhus university simonhj cs.au.dk anders m ller aarhus university amoeller cs.au.dkfrank tip ibm research ftip us.ibm.com abstract current practice in testing javascript web applications requires manual construction of test cases which is difficult and tedious.
we present a framework for feedback directed automated test generation for javascript in which execution is monitored to collect information that directs the test generator towards inputs that yield increased coverage.
we implemented several instantiations of the framework corresponding to variations on feedback directed random testing in a tool called artemis.
experiments on a suite of javascript applications demonstrate that a simple instantiation of the framework that uses event handler registrations as feedback information produces surprisingly good coverage if enough tests are generated.
by also using coverage information and read write sets as feedback information a slightly better level of coverage can be achieved and sometimes with many fewer tests.
the generated tests can be used for detecting html validity problems and other programming errors.
categories and subject descriptors d. .
testing and debugging general terms experimentation theory keywords ajax automated testing debugging event driven javascript random testing web applications .
introduction javascript plays a central role in modern web applications.
although originally designed for simple scripting modern javascript programs are complex pieces of software that involve intricate communication with users and servers.
compared to languages such as java and c relatively little tool support is available supported by the danish research council for technology and production grant no.
.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
to copy otherwise to republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
icse may honolulu hawaii usa copyright acm ... .
.to assist javascript programmers with testing their applications.
in current practice javascript programmers construct test cases either manually or using unit testing tools with capture replay facilities such as selenium watir and sahi.
these tools provide functionality for recording the gui actions performed by a user in test scripts for running a suite of tests and for visualizing test results.
however even with such tool support testing remains a challenging and time consuming activity because each test case must be constructed manually.
obtaining reasonable coverage of an application may be difficult because of javascript s event driven style which often gives rise to a combinatorial explosion in the number of possible executions and because of javascript s extremely dynamic nature which makes it difficult for users to understand how to write test cases that exercise a particular feature of an application.
the goal of our research is to develop scalable and effective algorithms for automated testing of javascript applications to discover common programming errors of various kinds including uncaught exceptions e.g.
runtime errors resulting from the use of undefined in a dereference or a function call unusual type coercions or misuses of the browser s built in libraries invalid html ajax http errors and violation of assertions.
a prerequisite for discovering such errors is that the generated tests obtain high code coverage which we focus on in this paper.
we envision automated testing used as part of the development process of future javascript applications to improve code quality and reduce development time.
several previous research projects have explored automated testing of javascript applications.
the crawljax atusa project uses dynamic analysis to construct a model of an application s state space from which a set of test cases is generated.
this work relies on a heuristic approach for detecting active user interface components and crawls these in some random order.
a limitation of this heuristic approach is that it may be unable to detect all relevant event handlers as is evidenced by the fact that the tool provides users with a domain specific language to specify how to crawl an application .
the kudzu project combines the use of random test generation to explore an application s event space i.e.
the possible sequences of user interface actions with the use of symbolic execution for systematically exploring an application s value space i.e.
how the execution of control flow paths depends on input values .
kudzu relies on an elaborate model for reasoning about string values and string operations which are frequently manipulated by javascript applications.
however it remains to be determined if high code coverage can perhaps be achieved with simpler techniques without requiring a sophisticated string constraint solver.
we present a new framework for automated testing of javascript web applications.
the framework takes into account the idiosyn1permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
to copy otherwise to republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
icse may waikiki honolulu hi usa copyright acm ... .
html head link rel stylesheet type text css href style.css script type text javascript src ajax.js script script type text javascript 6var ajax new ajax 7var active false 8var clicked false 9var contentobj 10function mouseoverarticle if this clicked return if active active!
this if active clicked active.classname selected else active.classname this.classname over active this 21function selectarticle ajax.requestfile this.id .html ajax.oncompletion function contentobj.innerhtml ajax.response ajax.run if clicked clicked!
this clicked.classname this.classname selected clicked this 31function init var articles document.getelementbyid articles .getelementsbytagname li for var i i articles.length i articles .onmouseover mouseoverarticle articles .onclick selectarticle contentobj document.getelementbyid content 41window.onload init script head body div id content p click on one of the articles to the right.
p div div ul id articles li id article1 one li li id article2 two li li id article3 three li ul div body html figure a simple javascript program in an html page.
crasies of javascript such as its event driven execution model and interaction with the document object model dom of web pages.
the framework is parameterized by i an execution unit to model the browser and server ii an input generator to produce new input sequences and iii a prioritizer to guide the exploration of the application s state space.
by instantiating these parameters appropriately various forms of feedback directed random testing e.g.
in the spirit of randoop can be performed.
here the idea is that when a test input has been generated the system executes the application on that input and observes the effects which can then be used to guide the generation of additional test inputs.
we implemented the framework in a tool called artemis1 and created several feedback directed random test generation algorithms by instantiating the framework with different prioritization functions and input generators.
the contributions of this paper can be summarized as follows we present a flexible framework for automated feedbackdirected test generation for javascript web applications.
by instantiating the framework with different prioritization functions and input generators we obtain several practical test generation algorithms events monitors the execution to collect relevant event handlers const additionally collects constants covalso considers coverage and alladditionally takes reads and writes of variables and object properties into account.
an evaluation on a suite of javascript applications shows that surprisingly even the simple events algorithm achieves coverage on average when tests are generated which significantly exceeds the coverage obtained by only loading each application s main page.
furthermore with the extended use of feedback information in the const cov and all 1artemis is the twin sister of apollo a tool for automated testing of php applications.algorithms a slightly higher level of coverage up to can be reached and sometimes with many fewer tests.
we also report on html validity errors and execution crashes detected by the automatically generated tests.
the remainder of this paper is organized as follows.
first we present a motivating example in section .
then section presents the framework and section describes several algorithms that were obtained by instantiating the framework with suitable prioritization functions and input generators.
section presents our tool artemis and its evaluation on a range of javascript applications.
section discusses related work on automated testing.
finally section concludes and mentions ideas for future work.
.
motiv ating example the javascript application shown in figure is a simplified version of an example from that demonstrates dynamic loading of contents using ajax.
it first registers an event handler for the load event line .
that event handler lines in turn registers event handlers formouseover andclick events for each lielement appearing in the element with id articles .
the mouseover events occur when the user hovers the mouse over the elements causing the classname to be modified and thereby changing the css properties lines .
the click events occur when the user clicks on the elements which causes the contents of the element with id content to be replaced by the appropriate article being selected lines .
to save space we omit the associated css stylesheet and the file ajax.js that contains basic ajax functionality.
this simple example shows how triggering relevant events can be crucial for exercising javascript applications.
lines are executed just by loading the page without triggering any actual events.
one way to cover more code is to subsequently trigger a click event on one of the lielements.
that will execute lines except line which requires yet another click event to 2572be triggered on another lielement.
also note that line is not executed directly but only via an ajax response event that is made possible by the call to the ajax library on line .
obtaining full coverage of lines requires several additional events in this case of type mouseover to be triggered at the right nodes.
simply triggering sequences of events produces an intractable number of possible executions and our tool relies on prioritization functions to decide what sequences will yield the best tests.
the code of figure illustrates two such metrics that we will define precisely later.
first observe that mouseoverarticle reads the local variable clicked andselectarticle writes that local variable.
hence it seems plausible that after triggering selectarticle the system should next try mouseoverarticle again to see if anything different happens.
in section .
we introduce a prioritization function that considers such information about read write sets to identify sequences of events that are likely to increase coverage.
second note that mouseoverarticle has several conditionals and hence will likely need to be executed multiple times to cover all the code.
in general calling a function is more likely to increase coverage as it contains more conditional cases that have not been executed yet.
this is addressed in section .
by a prioritization function that considers coverage to direct test generation.
.
the framework when a browser loads a web page it parses the html contents into a dom structure and executes the top level javascript code.
this may involve registration of event handlers that may be triggered later and cause more code to be executed.
event handlers are executed one at a time in a single threaded fashion.
our framework is tightly connected to this execution model.
.
input structure compared to automated test generation for other languages such as c or php the input to a javascript application has an unusual structure.
each event is a simple record for which all possible parameter values are valid i.e.
there are no application specific invariants that must be satisfied .
on the other hand we are faced with highly nondeterministic sequencing of events.
the following definitions characterize the notion of a test input to a javascript application accordingly.
definition .anevent consists of i an event parameter map which is a finite partial map from strings parameter names to numbers booleans strings and dom nodes ii a form state map which provides string values for html form fields and iii anenvironment which holds values for the current time of day the size of the screen and various other constituents of the browser s state that to some extent can be controlled by the user.
definition .atest input consists of i a url to a web page ii an entry state that describes the state of the server e.g.
databases and session data and the local browser e.g.
cookies and iii a sequence of events according to definition .
among the parameters in event parameter maps are the type parameter describing the kind of event and in case of a ui event thetarget parameter referring to the node where the event occurs.