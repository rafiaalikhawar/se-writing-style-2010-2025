do crosscutting concerns cause modularity problems?
robert j. walker shreya rawal jonathan sillito university of calgary calgary canada walker srawal sillito ucalgary.ca abstract it has been claimed that crosscutting concerns are pervasive and problematic leading to di culties in program comprehension evolution and long term design degradation.
to consider whether this theory bears out we examine the patch history of the mozilla project over a period of a decade to consider whether crosscutting concerns exist therein and whether we can see evidence of problems arising from them.
mozilla is an interesting case due to its longevity size polylingual nature and use of a patch review process which maintains strong connections between issue reports and the patches that are intended to address each.
we perform several statistical analyses of the over patches submitted to address over issues reported in this time period.
we nd that of patches show little or no evidence of scattering that the scattering of a patch tends to decrease slightly upon review on average and that the system shows at worst a slow increase of average scattering over time.
categories and subject descriptors d. .
metrics d. .
software engineering distribution maintenance and enhancement general terms experimentation design measurement veri cation.
keywords scattering aosd retroactive study mozilla power laws.
.
introduction it has been argued for decades that software should be well modularized to obtain various bene ts such as ease of change ease of comprehension and ease of parallel development .
in the 1990s it was understood that there exist software concerns known as crosscutting concerns that permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
to copy otherwise to republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
sigsoft fse november cary nc usa copyright acm ... .
.fail to be encapsulated by the otherwise good modularization present in real systems but are instead scattered across and tangled with the other modularized concerns in a system typical examples include logging security distribution protocol enforcement and various design patterns.
furthermore it was argued that crosscutting concerns were inherent and not an artifact of a poorly chosen modularization .
in response the solution was promoted to separate and encapsulate crosscutting concerns through novel programmatic mechanisms hence was born the aspect oriented software development aosd research community.
but in considering how the modularity issues should be addressed a key issue was often overlooked do crosscutting concerns cause modularity problems in practice?
to be clear there has been much work that has attempted to examine whether the novel aosd mechanisms represent an improvement in modularity over traditional mechanisms but all such work starts from the assumption that crosscutting concerns are necessarily deleterious.
we can see several serious threats to validity in such studies.
tiny examples of problems plus assertions that their properties extrapolate while reasonable at early research stages to explain issues cannot serve as demonstration that problems exist in practice.
measures of internal quality attributes e.g.
coupling can be used descriptively to characterize the properties of software.
but they cannot be used to demonstrate improvement of external quality attributes e.g.
ease of change ease of comprehension and ease of parallel development in the absence of their independent validation .
similarly structural or behavioural models can be used to demonstrate improvement only relative to the assumptions of the model.
in the absence of generalizable validation of those assumptions purely model based claims of improvement constitute circular reasoning.
comparisons between two versions of a program one written with traditional programming mechanisms and the other with aspectoriented ao programming mechanisms are potentially biased when the ao version is written with full knowledge of its evolutionary path or the measurements to be made.
we seek then to examine more closely and with a minimum of assumptions whether modularity problems arise in systems using conventional modularization mechanisms i.e.
not ao ones as predicted by standard aspect oriented theory.
to this end we analyze the change history for the mozilla project over a year period of development.
mozilla is an interesting and pertinent case study for crosscutting concerns it is large over mloc spread amongst nearly les in a recent snapshot so it potentiallycontains many crosscutting concerns it is mature so there has been adequate time for problems to develop it is written in multiple languages and data formats allowing a more general analysis and it uses a patch review process that a allows a reliable mapping from issue reports to patches that purport to solve the issues and b provides a means of seeing rejected attempts at providing patches potentially providing insight into issues that were di cult to address.
we expect that a patch is scattered i.e.
it includes changes to multiple parts of the codebase when the underlying issue being addressed relates to crosscutting concerns in the codebase analyzing the scattering of patches thus gives us an opportunity to understand the impact that scattered concerns have on development work in practice.
we focus on scattering rather than tangling as simple measures of scattering arise directly from the change history both simplifying the collection process and minimizing the potential for biases arising from tailored measures to measure tangling would instead require the reconstruction of large numbers of historical snapshots of the codebase or the use of questionable heuristics.
we have gathered issue patch and review information from mozilla s issue tracking system to consider the extent nature and changes to the scattering of patches.
more speci cally we have analyzed this information to address the following research questions does mozilla show signs of crosscutting concerns?
is the scattering of patches spurious?
what is the nature of the highly scattered changes?
how scattered are the patches?
do scattered patches require more revision?
does scattering increase after review?
does mozilla show signs of decay?
we nd that although crosscutting concerns are clearly present they show little evidence overall of causing problems in mozilla.
the remainder of the paper is structured as follows.
in section we examine previous work.
in section we describe some details of the mozilla project and the data that we collected from it.
details of the analysis and its results are given in section in which we take an exploratory approach to deriving each research question.
threats to validity of our study are discussed in section .
conclusions about our study are left until section .
this paper contributes an assessment of evidence about the presence and e ects of crosscutting concerns within a large scale industrial system.
.
previous work much work in aosd has created or applied measures of internal quality attributes e.g.
coupling entity counts particularly with an eye to considering how these measures change as the software system evolves or for comparison between systems employing aspect oriented and traditional mechanisms .
as argued in the introduction internal quality attributes do not immediately imply anything about the external quality attributes that we care about for modularity ease of change comprehension and parallel development .
przyby lek has argued that typical aspect oriented measures fail to consider the full range of dependencies in aspect oriented systems leading to these measures being biased in favour of aosd approaches his alternatives remain internal quality measures.
stability has been argued as a means for bridging the gap between internal and external quality attributes .
sev eral papers have examined the use of stability to evaluate aosd e.g.
.
kelly conducted a case study to examine how stability can be used to evaluate a design she explicitly points out that since stability is not a su cient criterion software engineering knowledge must be used to reason about candidate design characteristics related to long term maintainability.
baldwin and clark propose a method to compare and evaluate the design of a system based on design structure matrices dsms a modelling approach to represent dependencies in a system.
various studies have used dsms to investigate the modularity of systems e.g.
.
in particular maccormack et al.
used the dsm approach to compare the rst version of mozilla that was released as open source and a subsequent redesign of the codebase and found that the redesigned code base was more modular than its predecessor.
unfortunately dsms necessitate signi cant assumptions about what constitutes a dependency and the impact of a dependency as a system evolves.
in contrast our work aims to understand how the modularity of the system a ects the ongoing development of the system by investigating how scattered the changes are that developers make.
scattering has been measured in several ways.
absolute approaches i.e.
counts of entities a ected often have the advantage that they can avoid biasing the data.
several works use relative approaches e.g.
concern di usion the advantage of these is that scattering can then be compared between systems or versions.
we use absolute measures in our study and through our analysis see section .
derive a relative measure in order to compare scattering between di erent contexts.
baldi et al.
utilized an entropy based model to analyze the lexical details of software systems to demonstrate the presence of crosscutting concerns in a purely automated manner while also measuring the degree of scattering and tangling we do not attempt to identify crosscutting concerns beyond the issues with which they are associated.
.
results not supporting aosd s claims while the majority of the aosd literature claims improved modularity some works argue that at best the reality is more nuanced and at worst those claims are false.
marin et al.
classify crosscutting concerns based on literature review and their own experience some of their categories appear not to be harmful to software systems .
kienzle and g elineau performed a case study in which they attempted to modularize transactional properties while ensuring the classic acid properties from database research they found that subtle and complex design issues arise that if not handled well could lead to poor modularity.
siadat et al.
considered whether a variety of optimizations in a network simulator could be modularized through an ao approach they found that while maintaining good performance comprehensibility was clearly negatively affected by the separation.
figueiredo et al.
evolved two software product lines to assess their modularity properties they found that not all crosscutting concerns cause problems and forcing some crosscutting concerns into separated aspects can itself cause problems.
bartsch and harrison conducted an experiment in which developers were asked to make modi cations to either a java or an aspectj based implementation of a particular system they found no statistical improvement for the aspectj version.
przyby lek examined ten applications possessing both java and aspectj implementations to arrive at the conclusion the claim that the software built in aop is more modular than the software built in oop is a myth.
in fairness his measures have also not been validated but clearly the question as to the e ects on modularity by crosscutting concerns have not been settled at this point.
.
do crosscutting concerns cause defects?
an important study to consider here is that of eaddy et al.
.
they also point out that e ects on internal quality attributes do not signify e ects on external quality attributes.
they set out to measure whether scattering and defects are correlated by examining the histories of three systems.
their methodology was complicated by their need to link particular code particular bugs and particular concerns in addition to the need to design and collect a number of complicated measures.
in the end they claim to demonstrate a statistically signi cant correlation between the scattering of a concern and its likelihood to have defects independently of the size of the concern s implementation.
although their study was carefully conducted their linking methodology is a serious threat to internal validity as they point out independent means of investigating crosscutting concerns are warranted.
figueiredo et al.
conducted ve controlled experiments to ascertain how well people can map code to concerns they found that developers tend to underreport which concerns are present in a given piece of code that all concern based measures also lead to such biases but that coarse grained scattering measures are less sensitive to poor mappings from code to concerns.
we take this as support that utilizing simple measures of scattering arising directly from mozilla s repository may help avoid biases.
more recently aversano et al.
also report a correlation between the number of defects in design pattern classes and the scattering of the induced crosscutting concerns.
.
evolvability in open source previous work has studied the evolvability and modularization of various open source systems including the mozilla code base.
for example german et al.
have conducted studies of the evolution of the mozilla apache postgresql and gcc code bases.
they classi ed modi cation records mrs based on the type of activity they re ect functional improvement defect xing architectural evolution and refactoring documentation etc.
their analysis of mrs from the mozilla project found that on average les were changed per mr suggesting that scattering was not signi cant.
however measures of central tendency can be poor summaries of many distributions.
.
the data repository the mozilla project1is an open source project responsible for a range of applications most notably the firefox web browser thunderbird email client and bugzilla issue tracking system.
previous research has described the development process followed by participants in the mozilla project e.g.
.
central to this process is their issue system bugzilla which tracks issue reports of any type including bug reports and enhancement requests.
once an issue is reported that report is used as a discussion forum on whether to make the requested change and how it should be made .
a bug that cannot be duplicated or any other issue that is judged as not worth addressing may simply be marked as closed and not pursued further.
on the other hand if participants in the community decide to implement a change to address the issue the issue tracking system is used to facilitate source code review.
this review process begins when a developer uploads a patch a le capturing the di s of proposed changes to the code to the issue tracking system which is associated with a speci c issue report.
other developers can download that patch review it and make comments on it.
module owners can also formally mark a patch as approved or not.
mozilla s review process is often iterative and as problems are identi ed a new patch can be prepared and uploaded with the previous patch being marked as obsolete.
multiple patches can simultaneously be non obsolete we consider the union of non obsolete patches in our analyses where appropriate.
.
data we examined a total of issue reports submitted for the mozilla project.
first we used the search and export feature of bugzilla to generate a list of issue reports.
then we used custom python scripts to extract the data regarding each issue report such as the patch developer s identity submission date and time stamp issue description and attachments.
we analyzed a total of patches submitted from april patch id to june patch id .
in our data set we had a total of obsolete patches and non obsolete patches there were also patches for which obsolescence could not be determined and were excluded wherever the question of obsolescence mattered .
each patch le contains the path of each le a ected.
we also collected other parameters that were associated with the patch lines added removed and modi ed obsolescence review status developer of the patch and the time stamp when the patch was uploaded.
.
our scattering measures there are many potential ways of measuring the amount of scattering of a patch.
as mentioned in sections and .
we are concerned with biasing the results through complex measures.
we selected measures for the sake of simplicity and ease of computation from the patch data.
the number of les a ected per patch fpp is the number of unique les in the codebase that were modi ed or added as part of the patch for an issue.
when a patch le is submitted to the mozilla issue tracker the generated di contains the le name of all the les that were changed.
the code for all the individual subprojects in the mozilla family e.g.
firefox thunderbird etc.
is combined into a single source tree subdivided into directories referred to as modules .
each module is speci c to some particular feature of the project.
for example the browser module contains the front end code for the firefox browser.
the number of modules a ected per patch mpp is the number of unique modules modi ed including additions and deletions while addressing a change task.
mpp has the potential to evaluate the modularity of the directory structure created bythe mozilla developers.
mpp is calculated from the path information captured by the individual patches.
as mentioned above multiple patches can exist for the same issue report a subset of these will be obsolete and the remainder will be non obsolete.
for some of our analyses instead of working with per patch metrics we union the les a ected by each patch for a given issue report this yields the number of les a ected per issue considering only obsolete patches fpi obs and the number of les a ected per issue considering only non obsolete patches fpi nob .
the unioning procedure is ambiguous for modules as patches often contain path information local to the contributing developer s lesystem at variance with other patches we thus do not report modules per issue measurements to avoid errors that would bias the results.
.
the analysis our analysis proceeded in an exploratory fashion discovering new questions while addressing existing ones.
each subsection below describes the detailed research questions that we examined why the questions matter how we addressed the questions and what we found.
.
are there signs of crosscutting concerns?
this question is a fundamental one and not to be taken lightly.
although suggestions have been made that every system necessarily possesses crosscutting concerns there are two points to recognize a we should test hypotheses even if there is widespread agreement on them and b if we were unable to see crosscutting concerns through our measurements our methodology might possess a serious aw.
as patches are a lot to visualize we need some means of summarizing them.
in terms of standard descriptive statistics for the fpp measure the mean is .
2the median is the mode is the standard deviation is .
the minimum is and the maximum is .
for the mpp measure the mean is .
the median is the mode is and the standard deviation is .
the minimum is and the maximum is .
these statistics suggest that indeed at least some patches are scattered scattered patches are de nite signs of crosscutting concerns by de nition ifthe scattering of the patches are re ective of the scattering of the underlying concern.
patch scattering might occur for other spurious reasons.
.
is the scattering of patches spurious?
mozilla s patch review process is supposed to catch situations where developers have lumped together unrelated sets of changes as patches these should be broken up into individual patches each addressing an individual issue.
undoubtedly not all patches get reviewed in practice but more complex ones like ones involving scattered changes are unlikely to be ignored by module owners.
we note that ayari et al.
conducted a case study to manually inspect issue reports in mozilla nding very few cases where changes were made without an issue report this is reassuring but does not guarantee that the related patches do not address additional unrelated issues.
as a simple test we can examine the patches for issue reports where review has clearly occurred as evidenced by the 2we report all decimals to digits for convenience.fact that some are marked as obsolete.
if we see that scattering decreases markedly in these cases this would indicate that unrelated issues are being pushed out of the patches.
of the total issue reports that we collected of them display at least one patch marked as obsolete each of these issue reports also has at least one patch marked as non obsolete.
the standard descriptive statistics for the fpi nobmeasurements are as follows the mean is .
the median is the mode is the standard deviation is .
the minimum is and the maximum is .
the standard descriptive statistics for the fpi obsmeasurements are as follows the mean is .
the median is the mode is the standard deviation is .
the minimum is and the maximum is .
thus we can see that in at least some cases the splitting procedure happens notice the drop from the maximum fpi obsmeasurement to the maximum fpi nobmeasurement but that the e ect is not large on average.
this is a positive sign that the scattering of patches is actually re ective of the underlying concerns but we cannot be certain from this result.
we leave this issue for a qualitative examination in the next section.
.
what is the nature of changes that are highly scattered?
though the majority of patches touched fewer than les there were a number of more scattered changes.
for example we found that .
of issue reports had patches touching more than les in total.
to understand the nature of these scattered changes we conducted a simple qualitative analysis of a random sample of issue reports involving scattered changes.
to select changes for our analysis we considered all issue reports in mozilla s issue tracking system associated with the firefox product having a status of resolved fixed or veri ed fixed .
we ltered the resulting list to only include reports that had at least one patch that touched or more les yielding candidate issue reports.
finally we randomly selected of those issue reports to use in our analysis.
we categorized these as follows.
arbitrary issue combination.
five of the issue reports in our sample in fact combined multiple issues for the convenience of the developer or reviewers.
for example the patch attached to issue includes xes for bug and bug because of approval backups and waiting checkins.
as another example a developer xing several related issues and created a new issue and attached patches addressing all of the related issues.
such issue reports would tend to overreport the presence of crosscutting concerns.
these are instances of spurious scattering discussed in section .
.
dead code removal .
the mozilla community places emphasis on maintaining code quality.3getting rid of dead unused code is part of maintaining code quality.
but often it results in removing a lot of les and that ultimately results in an apparently scattered change.
we found instances of dead code removal in our sample.
in a strict sense these changes are crosscutting concerns but they are not particularly signi cant ones.
new feature addition .
our sample contained issue reports whose patches were scattered because they were review faqnew feature requests in mozilla firefox.
changes in functionality of the user interface ui were more scattered as the same changes are required to be made for multiple platforms simultaneously.
for instance issue involved the addition a new panel in the browser window for changing bookmark properties.
the change was made for two di erent themes of firefox for both mac os and windows.
the change was more or less the same for both the themes but resulted in a scattered change.
another instance of a ui related change is issue in this issue report a new theme was created for firefox and it resulted in a ecting les in total.
ripple e ect .
we observed issue reports in our sample e.g.
for which patches are scattered when changes in one part of the codebase a ects other parts of the codebase instances of the familiar ripple e ect.
ripple e ect is a sign of ine ective modularization but not necessarily to be improved through the separation of crosscutting concerns.
user facing changes .
firefox being a web browser greatly depends upon its ui layout demanding consistency for all its versions.
even minor changes in the layout such as xing a label in a dialog making buttons semi transparent or correcting language errors resulted in a scattered change.
we found that even small ui changes can result in a scattered patch partially because di erent parts of the ui related code are implemented using di erent programming languages examples include xing a label in a dialog making buttons semi transparent and correcting the language of messages displayed to the user.
there were such issue reports in our data set.
their associated patches are scattered due to the lack of direct cross language support.
trivial xes .
some of the changes in our sample were very large but very trivial.
for example changes to the commenting style issue xing punctuation errors issue removing white spaces from les issue etc.
these changes were found to require more review despite their triviality.
because the patch touched many les from di erent modules according to mozilla review standards each module owner is required to review any patch submitted for his module.
there were such cases in our data set.
.
how scattered are patches?
assuming that the scattering of patches represents actual crosscutting concerns we were curious about the distribution of scattering.
seeing the descriptive statistics given in section .
it was obvious that we were not dealing with a gaussian distribution but that highly scattered concerns could not be dismissed out of hand.
we examined histograms of the various measurements to investigate their form the leftmost portion of the histogram for the fpp measurements i.e.
for fpp of no more than is given in figure .
the minimum frequency over this range is for fpp i.e.
there are patches with an fpp of and the tail of the histogram does not reach for the rst time until fpp after which zeroes occur increasingly often.
to visualize this better we can redraw the histogram on a log log plot as per figure .
the histogram from the mpp measure has a similar form as do those from the fpi measures.
the apparent spreading out of the data to the righthand side of the plot in figure is due to noise from the 80000f fppfrequencyfigure histogram of fpp for fpp .
fppfrequency figure histogram of fpp log log plot .
discrete nature of the histogram this can be cleaned up by replacing the linearly scaled bins of the histogram with logarithmically scaled ones.
for example figure is the equivalent to figure .
the histogram for mpp measurements with logarithmically scaled bins is shown in figure .
most importantly the majority of the data falls at low levels of scattering of patches have or less les affected have or less have directory a ected have or less .
but a signi cant number of patches exhibit high or even extremely high degrees of scattering for both measures.
.
.
heavy tailed distributions these results exhibit a structure known colloquially as a heavy tail a distribution in which a non negligible number of events occur at large deviations from the mean.
standard descriptive statistics can give a false impression of the form of these distributions.
such structures have been reported in various natural phenomena and many studies have examined the presence of heavy tailed distributions in software for example louridas et al.
provide several plots of an appearance similar to figure .
recently taube schock et fppfrequency 000figure histogram of fpp log log plot logarithmicallyscaled bin widths .
mppfrequency figure histogram of mpp log log plot logarithmicallyscaled bin widths .
al.
reported that every system in a large corpus of java systems across domains at a wide variety of sizes and di ering levels of maturity exhibited heavy tailed distributions for coupling implying the presence of areas of high coupling in every single one of them.
these heavy tailed distributions are often assumed to follow a power law distribution the discrete version of which also known as the zeta distribution is pertinent here.
under this distribution the probability of an event occurring at some value xis p x cf x x xmin where is a decay constant and cis a normalization constant de ned such thatp1 xmincf x dx .
in this case c xmin 1x n n xmin where is the generalized or hurwitz zeta function xminis the point above which the power law holds as in practice only the tail of the data obeys a power law .finding that the data conforms or does not to a powerlaw distribution is potentially important certain processes are known to give rise to power laws while other processes give rise to alternative distributions.
thus being con dent about the distribution to which data conforms can both allow us to make good predictions about future data arising from the same process and to model and thus understand how the data arises in the rst place.
falsely claiming conformance to any distribution can be harmful since it will both lead to false predictions about future data and to misleading conclusions about how the data arises.
thus questions of data distribution should not be ignored.
the most common procedure for tting a power law distribution consists of transforming the data and equation into a log log form log p x log x log c a linear equation in which is the slope and log c is the x intercept.
thus a linear regression is generally performed to get the best t straight line louridas et al.
follow this procedure for example.
however as described in detail by clauset et al.
there are a number of serious issues ignored by this procedure linear regression makes a set of assumptions that are violated in transforming the data into the log log form a variety of other distributions also visually follow a linear form in a log log plot and it says nothing about how well the power law distribution model ts the data.
to address each of these issues clauset et al.
have dened more statistically valid and or empirically supported alternatives speci cally numerical procedures for estimating the values of xminand a set of additional models that can serve as likely alternatives and a numerical simulation procedure for evaluating the probability that a given model could have generated the observed data.
for the details of the tting procedures and the associated scripts we used those provided by clauset for the r statistics language we refer the reader to the manuscript of clauset et al.
and the companion web page.4the six alternative models suggested as likely alternatives are the discrete exponential distribution the discrete log normal distribution the discrete power law distribution with exponential cut o the discrete weibull distribution the poisson distribution and the yule distribution.
we collate some details of the probability estimation procedure in the following subsection.
.
.
estimating goodness of fit given a set of discrete empirical data fxkg its cumulative distribution function p x can be directly computed as p x jfxkjxk xgj then any discrete model distribution dwith probability mass function pd x will have cumulative distribution function pd x pr x x jd xx k 0pd k to determine goodness of t we utilize the monte carlo simulation procedure of clauset et al.
in which a synthetic sample is repeatedly drawn for a predetermined set aaronc powerlaws of repetitions from the model distribution a measurement is taken to determine whether the empirical data is a better or worse t for the model distribution than the synthetic sample and the value pis computed indicating for what percentage of the synthetic samples the empirical data is a better t. to determine whether the empirical data is a better t to the model distribution than a given synthetic sample a measure is needed to quantify the distance between two probability distributions.
clauset et al.
empirically justify the use of one such measure the kolmogorov smirnov ks statistic dks max x xminjp x pd x j wherep x is either the cumulative distribution function of the data p x or of thekth synthetic samplecpk d x .
the pvalue is then computed as p n kj1 k r dks p x dks cpk d x o r i.e.
the fraction of synthetic samples that are a poorer t to the model distribution than is the data ris the total number of synthetic samples to be randomly drawn from the distribution which clauset et al.
recommend to lie between and .
finally p is interpreted as the model distribution being a reasonable t to the empirical data.
.
.
results of fitting we followed the monte carlo procedure of clauset et al.
to determine whether any of the common candidate distributions are good ts for the data.
we arrive at the conclusion that of the common candidate distributions the fpp data most closely follows a discrete log normal distribution forxmin but that even this distribution is not a good t p for repetitions selecting slightly higher values for the threshold did not improve the t. from figure we can see a slight curve downwards in the data and so the fact that none of the common candidate distributions model this well is not surprising.
in contrast the mpp data reasonably ts a discrete lognormal distribution forxmin p for repetitions .
we then examined the fpi nobdata figure shows the resulting histogram.
this data ts a discrete log normal distribution forxmin best of the common candidate distributions although it is a poor t p for repetitions .
.
.
summary in conclusion the data all clearly follows a heavy tailed distribution meaning that there are a large number of patches whether unioned or not over individual issues with small amounts of scattering few patches with large amounts of scattering and very few with very large amounts of scattering.
in particular we can see that scattering follows a continuum a binary distinction between a crosscutting concern and a non crosscutting concern seems inappropriate.
none of the data follows a power law distribution.
we can say only that the mpp measurements t a log normal 5note that pshould not be confused with pused in more common statistical analyses.
fpi nobfrequency 10000figure histogram of fpi nob log log plot logarithmically scaled bin widths .
distribution suggesting that it can be modelled well as the superimposition of independent random variables and thus that the entropy based model of baldi et al.
see section has a reasonable basis at the module level.
the fpp and fpi measurements t none of the standard heavy tailed distributions meaning that no standard process models will be a good description for le level impact of crosscutting concerns.
these ndings call into question the software engineering literature that follows the common and erroneous tting process described above to arrive at the conclusion that power laws are present.
more importantly there are downsides for aspect orientation in these ndings.
there is no natural cuto point to di erentiate between crosscutting concerns and non crosscutting concerns except for the degenerate case when a patch a ects only one le.
a large number of patches about half illustrate at least minor crosscutting thus it appears unrealistic to separate and encapsulate all of these as is promoted by standard ao theory.
about half of the patches of mozilla manifest at least minor crosscutting so it is a good candidate system on which to test theories about the e ects of crosscutting.
the processes giving rise to the scattering distribution for the patches must be both complex and poorly understood meaning that simple model based solutions are unlikely to su ce.
.
do scattered patches require more revision?
as described in section crosscutting concerns have been argued as causing defects and it is reported that developers tend to miss the full extent of crosscutting concerns.
we would expect one of a few possible consequences to be visible in mozilla as a result more highly scattered concerns would require more revision more highly scattered concerns would more likely become even more scattered after review the frequency of issue reports would rise over time the codebase would show signs of decay over time.
we address point here and leave the other points for later.
.
.
scattering versus revision to measure revision we used two alternatives the number of obsolete patches associated with an issue and the numberof total patches associated with an issue.
neither is a perfect proxy measure as multiple patches can sometimes be submitted simultaneously but one would expect that more revisions would generally lead to more obsolete patches.
we assume that the only reason to have additional patches submitted is either that there is some competition regarding the best solution or that additional non obsolete patches signal that the earlier solution was incomplete.
for the number of obsolete patches per issue versus the fpi nobmeasurement we measured two sided correlation via both pearson s product moment correlation and spearman s rank correlation.
pearson s indicates a small but positive correlation r t dof p con dence f0 21g .
spearman s indicates a small but positive correlation s p .
for the total number of patches per issue versus the fpi nobmeasurement we again measured two sided correlation.
pearson s indicates a marginally larger positive correlation r t dof p con dence f0 30g .
spearman s indicates a larger positive correlation s p .
our interpretation is that more highly scattered patches are somewhat more likely to require revision.
but is this e ect due to confounding correlation between scattering and size of the implementation change?
.
.
scattering versus change size we considered whether there was a correlation between the scattering measures and the change size measure.
for fpp pearson s indicates a middling positive correlation r t dof p con dence f0 48g spearman s indicates a fairly high correlation s p .
for mpp pearson s indicates a low positive correlation r t dof p con dence f0 19g spearman s indicates a lowmiddle positive correlation s p .
there are a number of qualitative points that have to be considered.
we see that for fpp pearson s robtains a middling value while spearman s is fairly high.
this suggests that there is only a vaguely linear relationship between fpp and change size.
since it should be self evident that as change size grows beyond the size of individual les the changes will necessarily become more scattered and we postulate that this is the e ect witnessed.
for mpp however change size is much more loosely constrained by the size of modules and so we would expect to see a far weaker correlation which is borne out by the measures.
the third combination change size versus revision would require us to merge the individual patch changes in order to measure the complete size.
as this is a tricky proposition we avoid this analysis at present.
.
.
summary patches with greater scattering are slightly more likely to be revised but the confounding e ect of larger changes being harder to get right brings into question whether there is a direct e ect at work from the presence of crosscutting concerns.
addressing this point will require future work.
fpi crs table overview of e ect of review on scattering.
.
is scattering likely to increase after review?
if there were a correlation between initial scattering and the increase in scattering after review this would be a signal that more scattered changes are harder for developers to cope with and get right.
we examined the number of revised patches for which the scattering did or did not change.
table overviews the basic observations on changes to the fpi measures for revised patches i.e.
the di erence between fpi noband fpi obs which we de ne as fpi issue reports possess obsolete patches and thus were revised out of total issue reports addressed i.e.
required revision upon review.
the scattering of the majority of the revised patches was the same after the review fpi nob as before fpi obs .
with respect to fpi the sets of revised patches for which scattering increased for which scattering decreased and for which scattering remained constant all display a heavy tailed distribution.
interestingly for the case where fpi xmin see equation and related discussion is about below this the distribution is rather at suggesting that scattering has to be fairly high before the review process reduces the scattering.
as a second step we examined whether for revised patches where the scattering changed the scattering was more likely to increase than to decrease.
for each issue with both obsolete and non obsolete patches we counted the number of les unioned over the obsolete patches and over the non obsolete patches we call these counts nobsandnnobrespectively.
we then constructed a matrix min which the i jth cell counted the number of patches for which nobs iandnnob j the diagonal of mrepresents patches for which no change in scattering occurred the upper triangle represents decreased scattering and the lower triangle increased scattering.
the matrixmappeared to be asymmetric skewed signi cantly in favour of a decrease in scattering.
to test this hypothesis we performed mcnemar s 2test not to be confused with pearson s which determines the probability that the marginal frequencies are equal i.e.
it checks whether the matrix deviates from symmetry signi cantly .
the numerical procedure has problems where the input matrix is sparse so we restricted our attention to the upper left submatrix this captured of the issues with revised patches of them and we treat the remainder as outliers.
mcnemar s 2statistic is .
with degrees of freedom and p .
this means that the null hypothesis that mis symmetric is rejected in favour of the alternative that is asymmetric.
to get the sense of the degree of asymmetry we restrict our attention to only those issues with both obsolete and non obsolete patches we refer to these as the revised issues .
the mean fpp measure over the revised issues for only obsolete patches is .
for only non obsolete patches ityear files mb irs irs le irs mb .
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
.
table annual measurements of the codebase and number of issue reports.
is .
.
hence the scattering tends to decrease on revision.
by comparison issues with only non obsolete patches i.e.
non revised issues had a smaller mean fpp .
.
.
.
summary we conclude that review usually does not alter the scattering.
in cases when it does the scattering is slightly more likely to increase than decrease of the time vs. .
however overall the degree of scattering tends to decrease slightly upon revision.
.
is there evidence of decay?
if patches consistently missed some elements of scattered concerns we would expect to see growth in the number of issue reports as mozilla increased in bugginess and hence its design decayed.
it is clear that the number of issue reports has grown signi cantly on an annual basis over the lifetime of the mozilla project but so has the size of the system.
we attempted to download the mozilla codebase at annual snapshots specifically for jan year at apia time to represent the total change over the preceding year.6table shows annual counts of les millions of bytes and issue reports plus issue reports normalized by les and by bytes.
discounting and for which only incomplete data was collected we do not see an obvious steady growth in normalized counts of issue reports mozilla is not obviously getting buggier.
more subtle e ects may be at play however.
we examined the proportion of revised patches on an annual basis.
there were clearly start up e ects occurring during the years and the ratio of issues with obsolete patches to the total number of issues was very low .
and .
respectively .
after this a steady state seems to have been 6for the years this was a straightforward though slow checkout from the main branch of the mozilla cvs repository.
in early mozilla migrated some but not all of its subprojects to a mercurial repository.
it seems that some of the changes in the mercurial repository migrate to the cvs repository for the sake of supporting the remaining subprojects there but we are unclear whether this is consistently the case.
the distributed nature of mercurial makes it very di cult to select a de nitive version of the system for any given timestamp.
thus we report codebase size as pulled from cvs in all cases for practicality.reached the mean ratio for the remaining years is .
with a standard deviation of .
.
to determine whether the variations are explainable by random chance we analyzed the data for non obsolete patches on an annual basis and ignored the years due to the start up e ects.
for each of the remaining years with respect to the fpi nobmeasure we collated the probability mass function p x for the data from that year.
we then calculated an average probability mass function p x across the years by taking the mean across all these years for each discrete value of xand normalizing the result p x served as a model distribution against which to compare the annual data.
we then followed the monte carlo procedure of clauset et al.
section .
.
to determine whether each year s data t p x better than a synthetic sample randomly drawn from p x .
for each set of annual data for we generated synthetic samples from p x and compared their ks statistic to that of the empirical data.
the resultant pvalue was in all cases a very strong indication that the variations in the data cannot be explained by random chance.
we then examined the data for trends in the annual variations shown in table .
after initial startup e ects we see a clear trend towards higher scattering as the mean level of fpi nobincreases steadily though slowly from through .
but we see that the number of issues dealt with annually increases rapidly this may either be a sign that the system s design is decaying despite the lack of a strong signal in table or that its size and hence feature set is expanding.
that a bigger more complex system has slightly higher levels of scattering is not surprising.
in order to assess the annual variations we needed a means to evaluate the overall annual scatteredness that is independent from the number of issues addressed.
consider again that if the exact same distribution t each year s data clearly there would be no change in the normalized scatteredness of patches even if the mean non normalized scattering were changing.
since a probability mass function is necessarily normalized the number of data points involved is irrelevant the gures earlier in the paper were not shown with normalized axes and hence we would expect that the slope would remain constant.
on the other hand if the scatteredness is increasing but we hold the number of data points xed this will have the e ect of spreading the data to the right and decreasing the height of the initial peak.
for simplicity we t the power law distribution to each annual set of data to suggest its shape.
the slope of this data which is the negative of the parameter as per equation can be compared across years to determine how the scatteredness is changing serves as a relative measure of scatteredness over whole systems.
the fact that a power law distribution does not t a data set well is potentially problematic since the parameter will then not be a true representation of the scatteredness in a statistically sound sense but it will su ce here to indicate trends.
examining the parameter for each year s best tted power law we see a slow decrease from to .
a lower indicates an increase in issue reports with high fpi nob measurements relative to issue reports with low fpi nobmeasurements i.e.
the long tail is stretching scattering is getting slowly more pronounced independently of the growth in the number of issue reports handled annually.
this means that mozilla shows minor signs of decay.year fpi nob .
.
.
.
.
.
.
.
.
.
.
.86year fpi nob .
.
.
.
.
.
.
.
.
.
.
.
table change trends in the annual fpi nobdata.
.
threats to v alidity in the mozilla issue tracking system developers sometimes submit patches for more than the issue supposedly being addressed.
ideally the project s patch review process would catch this but it is not likely to be perfect.
nevertheless this phenomenon would have the e ect of arti cially increasingthe scattering of patches but the impact of scattering is already low so this e ect can be ignored.
on the other hand a patch may fail to fully address an issue and hence underrepresent the appropriate level of scattering.
one would presume that such cases would be caught when a patch failed to completely address an issue or else we would see a steady rise in issue reports independent from the trends in system size.
also the mozilla codebase is designed for multiple platforms and this results in patches containing les that are written in multiple programming languages.
most of the code is written in c but there are javascript and xml les to support cross platform compatibility in a clone like manner.
we note that such polylingual crosscutting concerns are not refactorable to aspects with current techniques.
cross platform support will tend to raise the levels of scattering so the observed scattering in the system is again potentially worse than a monolingual system.
as the system considered in this study is open source there are many possible sources of defects including the complexity of problem domain.
the developers experience likely varies widely with contributions arriving daily from around the world.
we expect that developer s experience with the codebase and the programming language used will have an impact on the amount of scattering observed.
our study does not consider factors of developer e ort in coping with more scattered concerns.
if scattered concerns require a disproportionate e ort to deal with we would expect that developers would do a poorer job with them leading to more revision or more issues being reported.
neither e ect is observed.
.
conclusion we have analyzed the submitted patches for the mozilla project over a year period examining their scattering properties to consider whether scattering causes evolutionary problems.
we found that real crosscutting concerns occur in mozilla but that scattering of its patches forms a continuum patches are not simply either scattered or not.
thus there is no natural distinction to be made between crosscutting concerns and non crosscutting concerns roughly half of the submitted patches show at least some scattering.
furthermore while our measures of scattering take the form of a heavy tailed distribution they fail statistical teststo be a power law distribution or any other typical candidate distributions the mpp measure is an exception .
this implies that we have no good process models at our disposal to describe how scattering arises at the le level in mozilla and hence simple model based approaches are unlikely to easily capture the nuances.
this also contradicts the common assumption in the software engineering literature that heavy tailed distributions imply power laws.
patches with greater scattering are slightly more likely to be revised upon review than not but the degree of scattering does not change in the majority of cases upon revision when it does the degree of scattering tends to decrease slightly on average.
this contradicts the prediction derived from aspect oriented theory that elements in a scattered concern are more likely to be overlooked suggesting that modi cations to some elements would likely be added based on review.
while the absolute number of change requests has shown steady growth for mozilla so has the size of the codebase normalized counts of issue reports show no obvious growth pattern suggestive of increasing bugginess.
on the other hand there is a subtle annual increase of scatteredness of patches independent of the growth in issue reports.
this suggests that mozilla s structure is getting slowly more brittle but the e ect is small.
overall this contradicts the standard aspect oriented theory that any crosscutting concern will lead to signi cant evolutionary problems and hence that refactoring to aspect oriented constructs is warranted.
one issue that our study has not addressed is whether particular kinds of crosscutting concerns cause problems as some of the literature has suggested.
if such crosscutting concerns are in the minority within mozilla their e ects may be washed out in our analyses.
future work will need to attempt to distinguish di erent kinds of crosscutting concerns within a system like mozilla to examine if these are more consistently or severely problematic.
the case for aspect orientation rests on the assumption that crosscutting concerns will cause signi cant evolutionary problems.
our results on mozilla appear to contradict this assumption.
of course mozilla is only a single system a single open source massive heavily used and long lived system containing a wide variety of features commonly pointed to as archetypes for crosscutting concerns.
if the results were not to generalize there would have to be something special and important about mozilla or the processes used in its development warranting close study as a potential alternative to the explicit separation of crosscutting concerns.
.