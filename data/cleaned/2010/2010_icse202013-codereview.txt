expectations outcomes and challenges of modern code review alberto bacchelli reveal faculty of informatics university of lugano switzerland alberto.bacchelli usi.ch christian bird microsoft research redmond washington usa cbird microsoft.com abstract code review is a common software engineering practice employed both in open source and industrial contexts.
review today is less formal and more lightweight than the code inspections pe rformed and studied in the 70s and 80s.
we empirically explore the motivations challenges and outcomes of tool based code reviews.
we observed interviewed and surveyed developers and managers and manually classified hundreds of review comments across diverse teams at microsoft.
our study reveals that while finding defects remains the main motivation for review reviews are less about defects than expected and instead provide additional benefits such as knowledge transfer increased team awareness and c reation of alternative solutions to problems.
moreover we find that code and change understanding is the key aspect of code reviewing and that developers employ a wide range of mechanisms to meet their understanding needs most of which are not met by cur rent tools.
we provide recommendations for practitioners and researchers.
i. introduction peer code review a manual inspection of source code by developers other than the author is recognized as a valuable tool for reducing software defects and improving th e quality of software project s .
in fagan formalized a highly structured process for code reviewing based on line by line group reviews done in extended meetings code inspections .
over the years researchers provided evidence on code inspection s benefits especially in terms of defect finding but the cumbersome time consuming and synchronous nature of this approach hinders its universal adoption in practice .
nowadays m any o rganizations are adopting more lightweight code review practices to limi t the inefficiencies of inspections.
in particular there is a clear trend toward the usage of tools specifically developed to support code review .
in the context of this paper we define modern code review as review that is informal in contrast to fagan style toolbased and that occurs regularly in practice nowadays f or example at companies s uch as microsoft google facebook and in other companies and oss projects .
this trend raises questions such as can we apply the lessons learned from previous research on code inspections to modern code reviews?
what are the expectations for code review nowadays?
what are the actual outcome s of code review?
wh at challenges do people face in code review ?
answers to these questions can provide insight for both practitioners and researchers.
developers and other software project stakeholders can use empirical evidence about expectations and outcomes to make informed decisions about when to use code review and how it should fit into their development process.
researchers can focus their attention on practitioners challenges to make code review more effective.
we present an in depth study of practices in teams that use modern code review revealing what practitioners think do and achieve when it comes to modern code review .
since microsoft is made up of many different teams working on very diverse products it gives the opportunity to study teams performing code review in situ and unders tand their expectations the benefits they derive from code review the needs they have and the problems they face.
we set up our study as an explorative investigation.
we started without a priori hypothes es regarding how and why code review should be per formed with the aim of discovering what developers and managers expect from code review how reviews are conducted in practice and what the actual outcomes and challenges are.
to that end we observed industrial developers performing code review with various degrees of experience and seniority across separate product teams with distinct reviewing cultures and policies interviewed these developers using a semi structured interviews manually inspected and classifi ed the content of comments in discussions contained within code review s and surveyed managers and programmers .
our results show that although the top motivation driving code reviews is still finding defect s the practice and the actual outcomes are less about finding errors than expected defect related comments comprise a small proportion and mainly cover small logical low level issues.
at the same time code review additionally provides a wide spectrum of benefits to software teams such as knowledge transfer team awareness and improved solutions to problems.
moreover we found that context and change understanding is the key of any review.
according to the outcome s they want to achieve developers employ many mechanisms to fulfill their understanding needs most of which are not currently met by any code review tool.
this paper makes the following contributions characteriz ing the motivations of developers and managers for code review and compare with actual outcomes.
relating the outcomes to understanding needs and discuss how developers achieve such needs.
based on our findings we provide recommendations for practitioners an d implications for researchers as well as outline future avenues for research.
ii.
related work previous studies exist that have examin ed the practices of code inspection and code review.
stein et al.
conducted a study focusing specifically on distributed as ynchronous code inspections .
the study included evaluation of a tool that allowed for identification and sharing of code faults or defects.
participants at separated locations can then discuss faults via the tool.
laitenburger conducted a survey of co de insp ection methods and presented a taxonomy of code inspection techniques .
johnson conducted a n investigation into code review practices in open source development and the effect they have on choices made by software project managers .
porter et al.
reported on a review of s tudies on code inspection in that examined the effects of factors such as team size type of review and n umber of sessions on code inspections .
they also assessed costs and benefits across a number of studies.
these studies differ from ours in that they were not tool based and were the majority involved planned meetings to discuss the code.
however prior research also sheds light on why review today is more often tool based informal and often asynchronous.
the current state of code review might be due to the time required for mor e formal inspections.
votta found that of the interval in a traditional inspection is wasted due to scheduling .
the icicle tool or intelligent code inspection in a c language environment was developed after researchers at bellcore observed how much time and work was expended before and during formal code inspections.
many of today s review tools are based on ideas that originated in icicle.
other similar tools have been developed in an effort to reduce time for inspection and allow asynchronous work on reviews.
example s include cais and scrutiny .
more recently rigby has done extensive work examining code review practices in open source software development .
for example in a study of practices in the apache project they data mined the email archives and found that reviews were typically small and frequent and that the contributions to a review were often brief and independent from one another.
sutherland and venolia conducted a study at microsoft regarding using code review data for later information needs .
they hypothesized that the knowledge exchanged during code reviews could be of great value to engineers later trying to understand or modify the discussed code.
they found that the meat of the code review dialog no matter what medium is the articulati on of design rationale and thus code reviews are an enticing opportunity for capturing design rationale.
when studying developer work habits latoza et al.
found that many problems encountered by developers were related to understanding the rationale behind code changes and gathering knowledge from other members of their team .
iii.
methodology in this section we define the research questions describe the research setting s and outline our research method .
a. research questions our investigation of code review revolves around the following research questions which we iteratively refined during our initial in field observations and interviews .
what are the mot ivations and expectations for modern code review?
do they change from managers to developers and testers?
.
what are the actual outcome s of modern code review?
do they match the expectation s?
.
what are the main challenges experienced when performing modern code reviews relative to the expectations and outcomes ?
b. research setting our study took place with professional developers testers and managers.
microsoft develops software in diverse domains from high end server enterprise data management solutions such as sql server to mobile phone applications and smart phone apps to search engines .
each team has its own development culture and code review p olicies .
over the past two years a common tool for code review at microsoft has achieved wide spread adoption .
as it represents a common and growing solution for code review over developers used it so far we focus ed on developers using this tool for code review codeflow .
codeflow is a collaborative code review tool that allows users to directly annotate so urce code in its viewer and interact with review participants in a live chat model.
the functio nality of c odeflow is similar to other review tools such google s mondrian facebook s phabricator or open source gerrit .
developers who want their code to be reviewed create a package with the changed new deleted and modified files select the reviewers write a message to describe the code review and submit everything to the c odeflow service.
codeflow then notifies the reviewers about the incoming task via email.
once reviewers open a codeflow review they interact with it via a sin gle desktop window figure .
on the top left they see the list of files changed in the current submission plus a desc ription.txt file which contains a textual explanation of the change written by the author .
on bottom left c odeflow shows the list of reviewers and their status .
we see that christian is the review author and alberto tom and nachi are the reviewers.
alberto has review ed and is waiting for the author to act as the clock icon suggests while nachi already signed off on the changes .
codeflow s main view shows the diff highlighted content of the file currently under review.
both the reviewers and the author can highlight portions of the code and add comments inline .
these c omments can start thread s of discus sion and are the interaction point s for the people involved in the review.
each user viewing the same review in c odeflow sees events as they happen.
thus if an author and reviewer are working on the review at the same time the communication is synchrono us and comment threads act similar to instant messaging.
the comments are persisted so that i f they work at different times the communication becomes asynchronous.
the bottom right pane shows the summary of all the comments in the review .
codeflow centralizes and records a ll the information on code reviews on a central server .
this provides an additional data source that we used to analyze real code review comments without incurring the hawthorne effect .
c. research method our research method followed a mixed approach depicted in figure collecting data from different sources for triangulation analysis of previous study observations and interviews with developers card sort on interview data card sort on code review comments the creation of an affinity diagram and survey to managers and programmers.
.
analysis of previous study our research started with the analy sis of a study commissioned by microsoft between april and may carried out by an external vendor .
the study investigated how different product teams were using codeflow .
it consisted of structured interviews lasting minutes to people with different roles.
most of the interview questions revolved around topics that are very specific to tool usage and were only tangentiall y related to this work .
we found one relevant as a starting point for our study what do you hope to accomplish when you submit a code review?
we analyzed the transcript of this answer for each interview through the process of coding also used in grounded theory breaking up the answers into smaller coherent units sentences or paragraphs and adding codes to them.
w e organized codes into concepts which in turn were grouped into more abstract categories .
from this analysis four motivations emerged for code review finding defects maintaining team awareness improving code quality and assessing the high level design.
we used the m to draw an initial guideline for our interviews .
.
observations and inte rviews with developers next we conducted a series of one to one meetings with developers who use codeflow each taking minutes .
we contacted random candidates who signed off between and code reviews since the codeflow release and sampled across different product teams to address our research questions from a multi point perspective .
we wrote developers who used codeflow in the past a nd asked them to contact us giving us minute notice when they received their next review task so that we could observe.
the respondents that we interviewed comprise d five developers four senior developers six testers one senior tester and one software architect.
their time in the company ranged from months to almost years with a median of five years.
each meeting was comprised of two parts in the first pa rt we observed them performing the code review that they had been assigned.
to minimize invasiveness we used only one observer and to encourage the participant to narrate their work we asked the participant s to think of us as a newcomer to the team .
in this way most developers thought aloud without need of prompting .
with consent we recorded the audio assuring the participants of anonymity .
since we as observers have backgrounds in software development and practices at microsoft we were able to understand m ost of the work and where and how information was obtained without inquiry.
the second part of the meeting was a semi structured interview .
semi structured interviews make us e of an interview guide that contains general groupings of topics and questions rather than a pre determined exact set and order of questions.
they are often used in an exploratory context to find out what is happening to seek new insights .
the guideline was iteratively refined after each interview in particular when developers started provid ing answers very similar to the earlier ones thus reaching a saturation effect.
observations also reached a saturation point thus providing insights very similar to the earlier ones .
for this after the first observations we adjusted the meetings to have shorter observations which we used as a starting point for our meetings and as a hook to talk about topics in our guideline.
the audio of each interview was then transcribed and broke n up into smaller coherent units for subsequent analysis.
.
card sort meetings to group codes that emerged from interviews and observations into categories we co nducted a card sort .
card sorting is a sorting technique that is widely used in information architecture to create mental models and derive taxonomies from input data .
in our case it help ed to organize the codes into hierarchies to deduce a higher level of abstraction and identify common themes.
a card sort involves three phases in the preparation phase participants of the card sort are selected and the cards are created in the execution phase cards are sorted into meaningful groups with a descriptive title and in the analysis phase abstract hierarchies are formed to deduce general categories.
we applied an open card sor t there were no prede fined groups .
instead the groups emerged and evolved during the sorting process.
in contrast a closed card sort has predefined groups and is typically applied when themes are known in advance which was not the case for our study.
the first author of this paper created a ll of the cards from the coherent units in the interviews .
throughout our figure .
screenshot of codeflow the dom inant code review tool used by developers at microsoft.
further analysis other researchers the second author and external people were involved in developing categories and assigning cards to categories so as to strengthen the validity of the result.
the first author played a special role of ensuring that the context of each question was appropriately considered in the categorization and cre ating the initial categories.
to ensure the integrity of our ca tegories the cards were sorted by the first author several times to identify initial th emes.
next all researchers re viewed and agreed on the final set of categories .
.
card sort code review comments the same method was applied to group code review co mments into categories we randomly sampled threads with at least two comments e.g.
point of figure from the entire dataset of c odeflow reviews which embeds data from dozens of independent software products at microsoft.
we printed one card for each comment along with the entire discussion thread to give the context totaling cards and conducted a card sort as performed for the interviews to identify common themes.
.
affinity diagram we used an affinity diagram to organize the categories that emerged from the card sort.
this tool allows large numbers of ideas to be sorted into groups for review and analysis .
we used it to generate an overview of the topics that emerg ed from the card sort in order to connect the related concepts and derive the main themes.
for generating the affinity diagram we followed the five canonical steps we recorded the categories on post it notes spread them onto a wall sorted the categories based on discussions until all are sorted and all participants agreed named each group with a description and captured and discussed the themes.
.
survey s the final step of our study was aimed at validating the concepts that emerged from the previous phases.
towards this goal we created two surveys to reach a significant number of participants and to challenge our conclusions the full survey s are available as a technical report .
for the design of the survey s we followed kitchenham and pfleeger s guidelines for personal opinion surveys .
both surveys were anonymous to increase response rates .
we sent the first survey to a cross section of managers.
we considered managers for which at least half of their team performed code reviews regularly on average one per week or more and sampled along two dimensions.
the first dimension was whether or not the manager had participated in a code review himself since the beginning of the year and the second dimension was whether the manager managed a single team or multiple teams a manager of managers .
thus we had one sample of first level managers wh o participated in review another sample of second level managers who participated in reviews etc.
the first survey was a short survey comprising questions all optional which we sent to managers that had at least ten direct or indirect reporting developers who used codeflow in the past.
the central focus was the open question asking to enumerate the main motivations for code reviews in their team.
we received answers response rate which we analyzed before devising the second survey the second survey comprise d questions mostly closed with multiple choice answers and was sent to randomly chosen developers who signed off on average at least one code review per week since the beginning of the year.
we used the time frame of january to june of to m inimize the amount of organizational churn during the time period and identify employees activity in their current role and team.
we received answers response rate .
both response rates were high as other online surveys in software engineering have reported response rates ranging from to .
iv.
why do programmers do code reviews ?
our first research question seeks to understand what motivations and expectations drive code reviews and whether managers and developers share the same opinion s. based on the responses that we coded from observations of developers performing code review as well as interviews there are various motivations for code review.
overall t he interviews revealed that finding defects even though prominent is just one of the many motivations driving developers to perform code reviews.
especially when reinforced by a strong team culture around reviews developers see code reviews as an activity that has multiple benefi cial influences not only on the code but also for the team and the entire development process.
in this vein one senior developer s comment summarized many of the responses also has several beneficial influences makes people less prot ective about their code gives another person insight into the code so figure .
the mixed approach research method applied .
there is better sharing of information across the team helps support coding conventions on the team and helps improving the overall process and quality of code.
through the card sort on both meetings and code review comments we found several