formalisation of the integration of behavior trees kushal ahmed m. a. hakim newton lian wen abdul sattar institute for integrated and intelligent systems griffith university nathan qld australia k.ahmed hakim.newton l.wen a.sattar griffith.edu.au abstract in this paper we present a formal de nition of the integration of the requirements modeling language behavior trees bts .
we rst provide the semantic integration of two interrelated bts using an extended version of communicating sequential processes.
we then use a semantic network model to capture a set of interrelated bts and develop algorithm to integrate them all into one bt.
this formalisation facilitates developing semi automated tools for modeling the requirements of large scale software intensive systems.
categories and subject descriptors d. .
requirements speci cations requirements modeling process automation keywords behavior trees behavior engineering integration merge csp semantic network model .
introduction requirements engineering re often starts with a set of scattered and unstructured system requirements with a view to achieving an integrated and structured formal speci cation.
unsurprisingly such requirements may be lled with problems such as ambiguity inconsistency redundancy and incompleteness.
as a result the process of transforming the requirements into a formal speci cation is extremely complicated.
the transformation process must therefore be able to identify issues in the requirements in a way easy to understand and the model must be structured such that it can be cross referenced with the original requirements document.
behavior engineering be was developed to address this problem .
it uses behavior tree bt as the graphical notation.
a bt contains a range of constructs that cover state based manipulations as well as more abstract concepts such as synchronisation and message passing along with permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
ase september vasteras sweden.
copyright acm ... .
.
concurrency choice and iteration control structures familiar to speci cation and programming languages.
each requirement is translated into one or more bts and each node in the tree is tagged with the requirements identi er allowing traceability back to the original informal requirements.
bts may have syntactically matching constructs.
therefore they may then be progressively integrated into one holistic model of the system which serves as a formal speci cation.
this process may reveal inconsistencies redundancies incompleteness and ambiguities.
bts have been adopted for industrial use in particular raytheon australia who invested resources to developing a bt editor .
there are many other tools on bts some of them support validation and veri cation as well.
however the integration of the bts is still informal adhoc and manual.
colvin and hayes provided the semantics of a bt using hoare s process algebra communicating sequential processes csp as its base which is a well established and elegant formal notation for describing interactions between concurrent processes.
by extending it they de ned csp to include state based constructs such as tests and updates and message passing facility similar to publish subscribe models of the communication .
in this paper we rst provide the semantic integration of two interrelated bts using an extended version of csp .
we then use a semantic network model snm to capture a set of interrelated bts and develop algorithm to integrate them all into one bt.
this formalisation facilitates developing semi automated tools for modeling the requirements of large scale software intensive systems.
paper organisation section brie y describes bts and their interrelations csp and snm section formalises the integration of two interrelated bts section extends the formalism for a set of bts section explores related literature and nally section presents our conclusion.
.
background in this section we brie y describe the constructs of bts and their interrelations csp and snm.
bts and their interrelations fig.
a shows a bt of a requirement id r2 of a security alarm system sas .
it mentions the initialisation scenarios for activating the sas.
fig.
b displays the contents of a bt node.
each node is associated with a component having a behavior.
the type of behavior may be internal input .. external input internal output .. external output event ?
?..??
selection ?..?
or state realisation etc .
note brackets show the syntaxes.
r2 sas r2 user ?
?
press ?
?
what set button r2 set button r2 sas a bt for r2 bt2 r4 alarm what tone how high pitch b a component name b behavior name c behavior type d node status e traceability link f node operator g node label h related nodes b attributes of a node figure behavior tree and attributes of a node the node operators such as reversion reference branch kill and synchronisation are used to indicate control ow beyond simple sequential execution and branching.
the nodes can be connected in di erent ways such as sequential parallel atomic and alternative .
notice bt2 in fig.
a and bt3 id r3 in fig.
a .
bt2 s ending scenario activating the sas is the starting scenario of bt3.
this means bt2 and bt3 are interrelated and can be integrated into one bt fig.
a .
r3 sas r3set button a bt3 r3 sas r3set button r2 sas r2 sas b relation between bt2 bt3 figure relation in bts dots nodes skipped r2 sas r2 user ?
?
press ?
?
what set button r2 set button r3 sas r2 r3set button a bt2 bt3 integrated r5 alarm what tone how high pitch r5 user ?
?
enter ?
?
what digit code r5 digit code r5 ?correct ?u0 u1 u2 u3 r5 sas u4 r5 alarm u53 digit code b bt5 r6 digit code ?
?entered??
r63 digit code ?correct?
r6 sas u0 u1 u2 c bt6 figure bt2 bt5 and bt6 we use a very generic representation of behavioral model bm denoted by m to refer to the mathematical representation of a bt .
as such a bt node is referred to asbehavioral unit bu denoted by u. a bu consists of a set of attributesfakgand so does an edge between two bus.
each attribute akhas a name denoted by name ak and a value denoted by value ak .
we use parents u and childs u to denote the set of parent and child bus.
we say a parent bmmpforms an integration relation with achild bmmc denoted by r mp mc if a buupinmpis equivalent to the root bu ucofmc .
as such bt5 and bt6 form an integration relation because u2of bt5 andu0of bt6 are equivalent fig.
b c .
we use rk mp mc to denote k th relation between mpandmc.
we consider three types of integration relation root root branch root and leaf root relations .
csp it is an extension of the process algebra csp.
it allows concurrent processes to communicate synchronouslyvia shared events and to manipulate and check the value of state variables .
a bt is transformed into a csp process and each node is transformed into a csp action.
di erent operators control the concurrency in the processes.
snm an snm captures the bms and their interrelations into an annotated graph which stores their meta level information such as their acceptability states included in excluded ex and undecided un the con dence s of the bms to be included in the speci cation and the similarity measure of the parent and child bus for a relation etc .
.
formal integration in this section we rst provide the semantics of a bm.
we then formalise the integration of two interrelated bms.
.
semantics of a bm extension of csp a bm consists of bus connected by edges.
the attributes of each of these entities may have operational semantics.
for example the behavior type attribute of a bu indicates the type of action such as state realisation selection guard input or output for the component denoted by componentname .
the node operator attribute indicates recursion interrupt restart or synchronisation.
thus a bu represents a csp action characterised by the attributes of the bu.
the type name attribute of an edge indicates atomic sequential parallel or alternative step from one action to another.
an edge may have timing constraints.
thus an edge represents the characteristics of the step between actions such as actions performed non interleaving atomic sequential parallel or external choice alternative which may further be executed after a xed amount of time delay.
csp does not consider the edge as an entity however it provides semantics of atomic sequential parallel and alternative steps.
u0 u1 u2 u3 u5u6u7u4 u8e0 1e0 2e0 e1 4e2 e2 6e2 7e3 u9e4 u10e6 u11e8 figure sample bm with bus connected with edgesfig.
shows a sample bm having bus connected with edges.
csp de nes semantics of the bm considering the attributes e.g.
behavior type of the bus and the type of edges.
it also de nes nonsequential execution of the processes for node operator attribute.
on top of it we can extend the csp as follows.
letpuidenotes the csp process starting from the csp action characterised by the buui.
as such pu0denotes the csp of the bm shown in fig.
.
here the root bu u0has three children u1 u2 andu3connected by e0 e0 2ande0 3respectively.
if the csp action foru0is performed the csp processpu0may behave aspu1 pu2and orpu3after following the steps characterised by the edges e0 e0 2ande0 3respectively.
therefore pu0can be written by the following way pu0 kuj u0 e0 j !puj s.t.uj2childs u symbolkujindicates concurrent processes for each uj.
definition semantics of a bm .
the semantics of a bm is a csp with bus as the csp actions and edges as the steps from one action to another.
let puidenotes the csp process starting from the action characterised by the buui which has children bus denoted by childs ui then pui kuj ui ei j !puj s.t.uj2childs ui .
integrating bms merging csp processes if two bms have root root branch root orleaf root relation they can be integrated into one bm by merging their equivalent bus pair into one bu.
by de nition a bm represents a csp process and each bu represents a csp action.
as a result integrating two bms means merging two csp processes.
this further implies that the csp actions represented by the equivalent bus can be merged into one csp action.
in that case the attributes that characterise the merged csp action would depend on the merging of the attributes of the equivalent bus.
we refer to the merged csp action as the least common action lca .
definition least common action .
if two bms have an integration relation the csp actions represented by the equivalent bus upanduccan be merged into one csp action referred to as the least common action lca of the two csp processes represented by the bms respectively.
in addition the equivalent bus may have child bus which themselves may again be equivalent and so on.
that means the csp actions for the child equivalent bus can again be merged into one csp action procedure which may continue recursively until there is no equivalent child bus.
thus a re nement of csp processes must follow after the lcato achieve a merged csp process that is more complete and concise than the original two csp processes.
.
.
illustration of the integration the buu2in bt5 is equivalent to the root bu u0in bt6 fig.
b c .
therefore they form an integration relation fig.
a .
so they can be integrated into one bt.
the integration starts from integrating u2andu0 fig.
b .
note that the behavior type of these two bus are di erent state realisation and event.
here state realisation has higher precedence over event.
so the integrated bu takes state realisation value of the behavior type attribute.
after integrating these bus the child bus u3 of bt5 and u1 of bt6 of these former bus are equivalent again fig.
b .
therefore the edges e2 3of bt5 and e0 1of bt6 are integrated rst and then the bus u3of bt5 and u1of bt6 are integrated.
now the child bus u4 of bt5 and u2 of bt6 further are equivalent fig.
c .
the integration ends after integrating the edges e3 4of bt5 and e1 2of bt6 and the busu4of bt5 and u2of bt6 fig.
d .
thus the integration starts by integrating the equivalent bus which cause the integration relation to be formed between the bms.
then the integrated bm goes through further re nement by integrating the equivalent child bus and so on.
.
.
integration for root root relation let upanducrepresent the root bus of the bms having root root relation .
from de nition pup kux up ep x !pux s.t.ux2childs up puc kuy uc ec y !puy s.t.uy2childs uc supposeup uc upc denotes their integration.
therefore the merged csp processpupc pup pucis formed pupc kuk upc epc k !puk uk2childs upc assume the child bus uxanduyare again equivalent as shown in fig.
.
therefore we have to integrate the edges ep x ec y epc xy and the bus ux uy uxy as indicated by the dotted boxes in fig.
.
now r5 digit code r5 ?correct?u2 u3 r5 sas u4 r5 alarm u53 digit coder6 digit code ?
?entered??
r63 digit code ?correct?
r6sas u0 u1 u2 a u2 left u0 right equivalent r5 digit code r5 ?correct?u2 u3 r5 sas u4 r5 alarm u53 digit code r63 digit code ?correct?r6 r6sas u1 u2 b u2 u0integrated u3 left u1 right equivalent r5 digit code r5 ?correct?u2 u3 r5 sas u4 r5 alarm u53 digit coder6 r6sas u2r6 c u3 u1integrated u4 left u2 right equivalent r5 digit code r5 ?correct?u2 u3 sas u4 r5 alarm u53 digit coder6 r6 r5 r6 d u4 u2integrated figure step by step integration of bt5 bt6 pupc ku0 k upc epc xy uxy exy k0 !pu0 k kuk upc epc k !puk u0 k2childs uxy uk2fchilds upc uxyg u1 u2 uxep 1ep ep x uy u2 u3ec yec 2ec up uc figure sample bms having root root relations procedure integrating root root related bms .
if two bms have root root relation the csp processespup andpucrepresented by the bms can be merged into one csp process denoted by pupc pup puc in two phases least common action the merging begins with producing the lca upc up uc of the two processes.
thus pupc kuk upc epc k !puk uk2childs upc re nement for each equivalent child bus pairs ux2 childs up anduy2childs uc the re nement steps are a the child bus uxanduy and the corresponding edges ep xandec yare integrated.
that is uxy ux uy and epc xy ep x ec y. therefore pupcre nes to pupc ku0 k upc epc xy uxy exy k0 !pu0 k kuk upc epc k !puk u0 k2childs uxy uk2fchilds upc uxyg b assignup uxanduc uy and perform re nement.
.
.
integration for branch root relation let upanducrepresent the equivalent bus of the bms having branch root relation.
suppose urdenotes the root of the parent bm.
let we rewrite the csp processpuras pur pur pupdenotingpurcontains a csp process pupat a certain point in time along with other concurrent processes.
the csp processespupandpuccan be expressed by equations and .
similarly the merging and the re nements can be performed by equations and .
781u1 u2 uxep 1ep ep x uy u2 u3ec yec 2ec up ucurer pfigure sample bms having branch root relations procedure integrating branch root related bms .
if two bms have branch root relation the csp processes purandpucrepresented by the bms can be merged into one csp process denoted by pur pur puc in two phases least common action the merging begins with producing the lca upc up uc of the two processes.
thus pur pur pupcwhere pupc kuk upc epc k !puk uk2childs upc re nement for each equivalent child bus pairs ux2 childs up anduy2childs uc the re nement steps are a the child bus uxanduy and the corresponding edges ep xandec yare integrated.
that is uxy ux uy and epc xy ep x ec y. therefore pupcre nes to pupc ku0 k upc epc xy uxy exy k0 !pu0 k kuk upc epc k !puk u0 k2childs uxy uk2fchilds upc uxyg b assignup uxanduc uy and perform re nement.
.
.
integration for leaf root relation let upanducrepresent the equivalent bus of the bms having leaf root relation.
suppose urdenotes the root of the parent bm.
since it is a leaf root relation there exists no child of the leaf bu.
let we rewrite the csp process puraspur pur pup.
fig.
shows that the merging is performed by integrating the equivalent bus upanduc.
u1 u2 u3e1 2e1 e1 p u1 u2 u3ec 1ec 2ec ucur uper figure sample bms having leaf root relations procedure integrating leaf root related bms .
if two bms have leaf root relation the corresponding processespurandpuccan be merged into one csp process denoted by pur pur puc by producing the lca upc up uc of the two processes pur pur pupcwhere pupc kuk upc epc k !puk uk2childs upc .
integrating bus merging csp actions if two bus are equivalent the integration of them represents a merged csp action.
it is characterised by the attributes of the integrated bu which we get by integrating the attributes of the given bus.the integration of two attributesaiandaj given their names are same is denoted byai aj which is formalised in section .
.
the names of the attributes may not be syntactically same but may have same mapping.
we assume that names of the attributes are syntactically same if they have the same mapping.procedure integrating bus up uc .if the bus upanducare equivalent the corresponding csp actions can be merged into one csp action that is characterised by the attributes of the bu upc up ucformed by integrating the attributes of upanducby the following rules if there exists a pair of attributes ai2upandaj2uc such thatname ai name aj then an attribute ak2upc is formed such that ak ai aj.
if there exists an attribute ai2upsuch thatname ai name aj for all attribute aj2uc then an attribute ak2 upcis formed such that ak ai.
if there exists an attribute aj2ucsuch thatname aj name ai for all attribute ai2up then an attribute ak2upc is formed such that ak aj.
in many cases a bu may have relational bu .
while integrating the equivalent bus the equivalent relational bus are also integrated.
the concepts of equivalency and the integration of relational bus is similar.
for space constraints we leave out the formalisation of these concepts.
again due to similarity we omit the formalisation of integrating edges i.e.
merging the steps between the csp actions.
.
integrating attributes when integrating two bus or edges we essentially integrate the attributes of these entities.
if the names of the attributesaiandajare same we form an integrated attributeak ai aj.
the value of the integrated attribute akdepends on the values of the attributes aiandaj.
if the values are same then the integrated value is also the same.
otherwise the value of the integrated attribute is formed by many di erent operations between the original values.
procedure integrating attributes ai aj .if two attributes aiandaj given that name ai name aj are integrated into one attribute akwherename ak name ai thenvalue ak is formed by the following rules ifvalue ai value aj thenvalue ak value ai .
otherwise value ak value ai value aj .
the integration of the values i.e.
value ai value aj can be performed in many di erent ways.
choice the value of the integrated attribute may be selected from the original values.
for example the values of thebehavior type attribute may be di erent.
one may have state realisation and other may have selection ?
?
as values.
in this case the value of the integrated attribute would be state realisation .
in this case we say that the property of the attribute behavior type ischoice.
if the property of an attribute is choice the values of that attribute are kept into a sorted set from high to low precedence order.
for example state realisation has a high precedence over selection for the behavior type attribute.
combination the value of the integrated attribute may be the combination of the original values.
for example the value of traceability link attribute may be di erent.
the values may be r2 and r3.
in this case the value of the integrated attribute would be the combination of those values i.e.fr5 r6g.
we say that the property of the attribute traceability link iscombination .
mapping the values of the attributes may be syntactically di erent but semantically same.
for example the component name of a component may have aliases but all these aliases refer to the same component.
782thus the integration of the values may be the mapped value from the original values intersection of the values mathematical operation and so on.
which strategy should be taken depends on the domain information.
.
theorems and properties corollary closure of merging .
the merging of the two csp actions by procedure produces another csp action and the integration of two attributes by procedure produces another attribute.
theorem preservation of semantics .
the semantics of the integrated bm by procedures and is consistent with the semantics of the given two input bms.
theorem polynomial complexity .
given two bms having edge sets e1ande2 the worst case complexity of procedure is o min procedure is o and procedure is o je1j je2j.
theorem closure of merging csp processes .
the merging of the two csp processes by procedures and also produce a csp process.
theorem optimal refinement .
procedures and produce an optimally re ned csp process from the given two csp processes.
properties of the merging of csp processes we get the following properties re exive pui pui pui.
asymmetry pui puj6 puj pui.
partial symmetry pui puj puj puiif the corresponding bms have root root relation.
associative pui puj puk pui puj puk pui puj puk .
properties of the merging of csp actions edges and attributes each operation shares the same set of properties.
we mention the properties for csp actions re exive ui ui ui.
symmetric ui uj uj ui.
associative ui uj uk ui uj uk ui uj uk .
proofs of all the theorems and properties will be available in the longer version of the paper.
.
integration of a set of models in this section we use an snm of the interrelated bms and develop an algorithm to integrate all the bms into one bm.
let m1tom7denote the bms of the sas.
suppose they are interrelated to each other as shown in table .
the column bms shows the pair of parent and child bms relations u p shows the type of relation parent bu up and the similarity measure of the parent and child bus.
table relations of the bms of the sas.
bms relations up bms relations up m2 m3leaf root u3 m2 m4 leaf root u3 m3 m4root root u0 m4 m3 root root u0 m4 m5leaf root u2 m6 m2 leaf root u2 m5 m6branch root u2 .
m5 m7 branch root u2 .
m6 m7root root u0 m7 m6 root root u0 m3 m1root root u0 m1 m3 root root u0 m4 m1root root u0 m1 m4 root root u0 m2 m1leaf root u3 m5 m2 branch root u4 fig.
shows a sample snm created from the table .
we assumed that m2is the initialisation init model.
initially m2isin and all other bms are ex.
for a bm we assign con dence if a bm is inand if ex.
otherwise con dence of a bm is the con dence of its parent multiplied by the similarity measure of its corresponding integration relation.further a relation is annotated by its acceptability state.
we consider two layers of thresholds namely inthreshold in and unthreshold unwhere un in.
we assume a relation is inifsimilarity in and exifsimilarity un and unotherwise.
assume that in and un .
m3 m1 ex m4 ex m5 ex m7 ex un .
m6 ex m2 ex in in in un .
in in in in in in in in in in in in figure snm showing initial states relation equivalences and con dence levels the acceptability states of the other bms can be inferred.
for example m2isinand the relation between m2 m3is also in.
therefore m3can be inferred as in.
informally we setin m ifmis an initbm that the ra has chosen with discretion.
we infer in m if there exists at least one pair ofinstate parent and relation.
moreover we infer un m if it is not inand there exists at least one pair of parent and relation such that both are not ex.
we infer ex m if it is neither innor un.
further the snm shown in fig.
can be made well formed by eliminating redundant relations breaking cycles and assigning the states as shown in fig.
.
assume that the relations between m5 m6andm5 m7 have been accepted by the requirements analyst.
informally we say an snm is well formed if the snm is a directed acyclic graph the number of initmodels in the snm is all models are in and all existing relations are in .
we use childs mi and parents m i to denote child and parent bms respectively.
m3 m1 in m4 m5 m7 in .
m6 in in in in in in m2 in in in in .
in figure well formed snm we can traverse the well formed snm from the initmodel by breadth rst search and integrate the bms into one bm.
procedure integrating bms .
given a well formed snmg hm riwheremis the set of bms and ris the set of relations in the well formed snm the integration of the bms are performed by algorithm .
algorithm integratebms g push initbm to an empty q initim initbm integrated model while qis not empty do popmifrom q foreach mj2childs m i do foreach equivalent bus pair up uc do im im mj.
procedure or foreach mi mk 2rdo push mktoq return im theorem polynomial complexity .
given relationsrin the well formed snmg the worst case complexity of algorithm integratebms is o r r jrj.
theorem soundness completeness .
given awell formed snm procedure produces an integrated bm in polynomial time procedure can be applied to any well formed snm to produce an integrated bm.
.
related work we classify the related work into two categories formalisation of be and integrating software models .
formalisation of be colvin and hayes provided the semantics of the bt using csp .
we extended the semantics by including the edge between nodes as an entity in csp .
winter et al.
developed a framework of rules for integrating requirements using a notation independent graphical model.
though they discussed overall broad approach of bts integration the rules do not relate the integration with bt s semantics.
they also did not develop the techniques to automatically integrate a set of bts.
bt has been used for model checking to assess the safety requirements analyse role based access control perform failure modes and e ects analysis fmea to identify the combinations of component failures by cut set analysis csa verify large systems using a slicing techniques and so on.
myers et al.
simulated behavioral scenarios using bts into modelica framework.
integrating software models in earlier stage the main focus was to do parallel composition of models that explains how two di erent components work together.
since di erent uml diagrams have di erent syntax and semantics merging of those models are mostly manual .
uchitel and chechik worked on merging two partial behavioral models of the same component to produce an elaborated version of both original models.
our works di er from these works in composing two behavioral models depicting state based and scenario based behavioral scenarios of more than one interacting components of the software system which may have overlapping system behaviors to obtain a more compact version of the original two.
.
conclusion in this paper we provided a formal de nition of the integration of the bts.
we rst formalised the semantic integration of two interrelated bts using an extended version of csp .
we then formalised the integration of a set of bts.
our future research focus is to formalise speci cation process where we would like to semi automate the tasks to convert an integrated bt into an executable bt which can be validated by simulation and veri ed by model checking.
.