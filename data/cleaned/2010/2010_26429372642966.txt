finding html presentation failures using image comparison techniques sonal mahajan and william g.j.
halfond university of southern california los angeles ca usa spmahaja halfond usc.edu abstract presentation failures in web applications can negatively affect an application s usability and user experience.
to nd such failures testers must visually inspect the output of a web application or exhaustively specify invariants to automatically check a page s correctness.
this makes nding presentation failures labor intensive and error prone.
in this paper we present a new automated approach for detecting and localizing presentation failures in web pages.
to detect presentation failures our approach uses image processing techniques to compare a web page and its oracle.
then to localize the failures our approach analyzes the page with respect to its visual layout and identi es the html elements likely to be responsible for the failure.
we evaluated our approach on a set of real world web applications and found that the approach was able to accurately detect failures and identify the faulty html elements.
categories and subject descriptors d. testing and debugging general terms veri cation algorithms reliability keywords html presentation failures detection localization .
introduction presentation failures in web applications occur when the rendering of an html web page does not match its expected appearance.
these kinds of failures occur in modern web applications because of the highly complex and dynamic nature of the html css and javascript that de ne a web page s visual appearance.
presentation failures can negatively a ect the usability of a web application and reduce the end user s perception of the quality of the application and the services it delivers.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
ase september vasteras sweden.
copyright acm ... .
.
presentation failures and identifying the corresponding faulty html element is challenging.
to determine that a failure has occurred a tester must examine the rendering of each html element in a web page and verify its visual properties against an oracle or speci cation.
once a presentation failure has been detected it is also challenging to nd the faulty html element since an element s visual appearance is controlled by a complex series of interactions de ned by the html structure and css rules.
the use of oating elements overlays and dynamic sizing also increases the di culty of identifying the faulty element.
these challenges have led to new processes and techniques for testing web applications however these have limitations that reduce their usefulness.
testing tools such as selenium crawljax sikuli and cucumber can nd certain types of presentation failures.
however these techniques require testers to exhaustively specify all correctness properties to be checked.
these tools are capable of only verifying the syntactical correctness and not the actual visual appearance of the web page.
another group of techniques such as cross browser testing and gui differencing can also nd presentation failures.
however these approaches assume the existence of a bug free previous version of the web application and detect failures by comparing against this version.
other approaches such as google s fighting layout bugs project search for certain kinds of common presentation failures that are application agnostic such as overlapping div tags but cannot nd application speci c presentation failures.
in this paper we present a novel approach for detecting presentation failures and then identifying the corresponding faulty html element.
our approach leverages image processing techniques to compare layout designs created by graphic designers against actual screenshots of the rendered web page under test.
the approach then builds rendering maps of the web page to identify the html elements that are responsible for the detected di erences.
we carried out a case study of our approach s ability to detect and localize presentation failures in real world web applications such as gmail and paypal.
the results of our evaluation show that it is able to detect the occurrence of presentation failures with accuracy and was able to identify result sets that included the faulty html element in over of the cases.
overall our results were positive and indicate that our approach represents a viable new approach for addressing the problem of presentation failures.
.
motivation the need to debug presentation failures arises in many scenarios throughout the development process of a web application.
we rst describe three such scenarios and then discuss the usage of existing techniques with respect to these scenarios.
.
usage scenarios during the initial development of a web application s templates or view components front end developers are guided by mockups highly detailed renderings of the intended appearance of the web application created by graphic designers .
the developers are generally expected to create pixel perfect matches of these mockups .
this can be done by hand or by using one of the numerous and popular wysiwyg editors such as adobe muse amaya or visual studio to generate template html and css les.
back end developers also make changes to these templates by adding dynamic content.
during this process the developers perform presentation development testing to ensure that the appearance of the developed pages matches the given intended appearance and if it does not to determine which html elements in the developed pages are responsible for the failure.
once initial development is completed developers may inadvertently introduce faults into a web application while making changes to the code.
for example a developer may refactor code to transition a table based layout to one based on the use of the div tag.
such changes are not intended to change the pages appearance but a developer error can cause a presentation failure in any page that depends on the faulty modi cation.
the developer must then perform regression debugging in order to gure out which elements are responsible for the observed failure.
in contrast to the rst scenario in regression debugging the developers have a previously correct version instead of a mockup that can serve as an oracle.
once the development has reached a level of stability developers will make corrective changes to the code based on bug reports.
for example to resolve user reported failures.
we call this scenario standard debugging.
for this kind of debugging the developers must generally reproduce and then debug the failure in house.
techniques developed by both industry and research help developers in one or more of these scenarios however the techniques have limitations that reduce their usefulness or practicality.
we now discuss each of these techniques in more detail.
.
limitations of existing techniques a group of techniques is based on comparing two working versions of an application against each other and using the di erences to localize faults.
examples of these techniques include cross browser testing xbt gui di erencing and automated oracle comparators .
these techniques compare tree based representations e.g.
gui tree or html dom of the current user interface against a reference version and use di erences between these representations to nd failures and faults.
all of these techniques can be used to debug presentation failures however their use imposes limitations on the problem domain that reduces their usefulness.the rst limitation is that these techniques require that the tree based representation of a previous correct version must exist so that it can be compared against the version to be debugged.
this assumption means that the di erencing techniques could only help in regression debugging.
second to use these techniques for regression debugging requires that the tree based representations be similar enough that a comparison is possible without generating too many false positives.
if a refactoring signi cantly changes the code structure the techniques would not be able to identify which elements in the tree based representation should be compared.
third the techniques assume that a di erence between the tree based representations implies a failure and conversely that a failure implies a di erence in the tree based representations.
this is not necessarily the case.
a di erence without a presentation failure can occur for two reasons i there can be di erent ways to implement the styling of an html element and ii a page may be refactored in a way that does not translate into a visual di erence.
conversely an example of when a failure may occur without a di erence is if an img tag does not specify size attributes and the dimensions of the supplied image change on disk.
several techniques selenium cucumber and crawljax allow developers to programmatically specify invariants that will then be checked against a web page s dom.
there are three drawbacks to these approaches.
first they require testers to exhaustively specify each visual property to be checked.
the size of this set could at minimum grow linearly with the number of html elements in the page which could require several thousand invariants for a typical page.
second the invariants are expressed in terms of an element s css or html syntax instead of its actual visual appearance.
thus checking an element s invariants does not necessarily ensure that the rendering of the element conforms to the expected visual appearance.
for example it is possible for the appearance of an element to be a ected by an html ancestor element s css properties.
finally these techniques do not help with localization of a failure unless the fault occurs in the same element s checked by an invariant.
two other approaches fighting layout bugs flb and sikuli employ a di erent approach.
flb detects general application independent correctness properties such as overlapping text regions and poor color contrast by looking at a screenshot of the web page.
the drawback to this approach is that it cannot detect failures that are application speci c and only marks up the screenshot to show where the failure occurred.
the testers must still identify the responsible html elements.
sikuli is an automation framework that uses sub image searching to identify and manipulate gui controls in a web page.
although not intended for veri cation one could provide a set of screenshots of each gui control and use sikuli to ensure that they match i.e.
there are no presentation failures.
however since sikuli uses a sub image based search of the page it could match the provided screenshots against any portion of the page not necessarily the intended region.
this means it would be ine ective if there were visually identical elements in the page.
furthermore sikuli only provides an element after a positive match therefore when there is a failure no match will be made and no element s will be provided to the testers to help with localization.
.
approach the goal of our approach is to automatically detect and localize presentation failures in web pages.
to do this our approach applies techniques from the eld of image processing to analyze the visual representation of a web page identify presentation failures and then determine which elements in the html source of the page could be responsible for the observed failures.
we brie y describe the inputs to our approach and its phases at a high level and then in the following subsections discuss the phases in more detail.
the approach takes two inputs which are provided by the developers or testers.
the rst input is the web page to be analyzed for presentation failures.
the form of the test web page can be a url that points to either a location on the network or lesystem where all html css javascript and media les of the test web page can be accessed.
the second input is the oracle that speci es the visual correctness properties of the test web page.
the form of the oracle is an image that can be either a mockup or a screenshot of a previously correct version of the web application.
from a high level our approach can be described as having two phases.
the rst phase detection section .
compares the visual representations of the test web page and the oracle to detect a set of di erences.
the second phase localization section .
analyzes the rendering of the test web page to identify the set of html elements that de ne the previously detected set of di erences.
the identi ed set of html elements is provided as an output to the developer.
.
presentation failure detection the rst phase of the approach detects presentation failures by comparing the screenshot of a web page under test as rendered in a browser with its expected appearance the oracle.
the approach rst captures a visual representation of the test web page.
then the visual di erences between the visual representations of the oracle and the test web page are identi ed.
the output is a set of of pixels that represent the di erences between the two representations.
to capture the visual representation the approach takes a screenshot of the browser window that is rendering the page.
since this visual representation will be compared against the oracle the primary challenge is to ensure that the screenshot is taken under the same conditions as the oracle.
otherwise di erences such as screen resolution between the platform on which the oracle was developed and the testing platform can a ect the image comparison.
to facilitate this we developed a normalization process for taking the screenshots.
this was primarily an engineering challenge so we only brie y summarize this aspect of the approach.
we identi ed three primary visual aspects that had to be controlled for in order to enable an accurate comparison dimensions of the images i.e.
height and width amount of zoom in the browser window and size of the browser viewport to ensure that page scrolling did not eliminate portions of the page.
the screenshot library selenium provides functionality to con gure these visual aspects so our approach only tracks and reproduces the oracle s environment.
to identify the visual di erences between the oracle and screenshot of the page our approach uses a pixel level comparison.
at a high level the approach carries out the comparison by iterating over each pixel in the oracle and comparing it against the corresponding pixel in the test web pagescreenshot.
if the two pixels are not equivalent then the x andycoordinates of the pixel are added to the di erence set.
two pixels are equivalent if they have the same color and saturation values.
.
localization of faulty element the second phase of the approach identi es the set of html elements that are most likely to be the cause of the detected presentation failures.
to do this the approach builds a model of the test web page called an r tree that describes the pixel level relationships among elements of an html page.
for each pixel in the di erence set identi ed in the detection phase the approach uses the r tree to identify the set of html elements whose visual representation includes that pixel.
the union of all of these html elements for all di erence pixels is the set of potentially faulty html elements.
the rst step is to build an r tree model of the test web page that will be used to map di erence pixels to html elements.
an r tree is a height balanced tree data structure that is widely used in the spatial database community to store multidimensional information.
in our approach we use the r tree to store the bounding rectangle assigned to an element when it is rendered in the browser.
the approach extracts the bounding rectangle for each element in the test web page via browser provided apis.
in the rtree built by our approach the leaves of an r tree correspond to rectangles and non leaf nodes correspond to the tuplehi child pointer i where iis the identi er for the minimum bounding rectangle that groups nearby rectangles and child pointer is the pointer to a lower node in the r tree.
the html elements corresponding to an hx yipixel can then be found by traversing the r tree s edges to nd the rectangles containing the pixel.
building and searching an r tree are standard techniques and can be found in .
other browser accessible apis such as the html dom and javascript can be used to map pixels to html elements.
however the r tree representation is more e cient.
the reason for this is that the dom tree models parentchild relationships based on syntax not layout.
therefore even when an element is found in the dom tree that contains the pixel there may be other elements elsewhere in the tree that also contain the di erence pixel.
this makes pixel mapping in the dom an o n operation.
in contrast the r tree search is o log n as it is a height balanced tree.
after an r tree has been constructed for the test web page the approach identi es the html elements that can be responsible for rendering the pixels contained in the difference set identi ed in the detection phase.
for a given pixel it is possible to have more than one responsible html element since css allows layers of html elements with transparent or overlapping areas.
the approach iterates over each pixel hx yi 2the di erence set nds the corresponding html elements in the r tree and adds them to the result set of potentially faulty html elements.
each html element in the result set is represented using its xpath identi er which can uniquely identify an element in an html page.
.
evaluation we conducted a case study to evaluate the accuracy of our approach in detecting presentation failures and reporting faulty html elements.
for this we utilized the subject 93table overview of subjects and accuracy of the approach app url size t localization gmail craigslist autos virgin america paypal applications shown in table .
we chose these web pages because they are popular real world web applications and represent a mix of di erent implementation technologies and layouts that are widely used across modern web applications.
the size of each page in terms of the total number of html elements is also shown for each subject under the column labeled size .
.
implementation and procedure we implemented a prototype tool built in java to demonstrate our proof of concept.
in the detection phase module selenium webdriver is used to take screenshots of the html page under test and imagemagick to compare images and calculate di erences.
in the localization phase module we use the java spatial index library to help implement the r trees for the html pages and selenium webdriver to extract bounding rectangle information.
for our experiment we created test cases by using an automated fault seeding technique to mutate the original web page of each subject application with a random presentation failure.
for seeding faults we rst manually analyzed the w3c s html and css speci cation to identify html elements with visual properties html attributes or css properties that could impact the visual appearance of an html element.
for example the css property font size applies to elements such as div or p that contain text but not to img .
then the basic process for each subject application web page pwas as follows download from the web all les required to display pin a browser take an image capture of pto serve as the oracle o create a set p0that contains variants of p each with a di erent randomly seeded presentation fault run our tool on o and each member of p0 manually verify the detection and localization results generated by our tool.
our experiment was designed to evaluate the accuracy of performing detection and localization based on our image detection and localization techniques.
in particular we focused on the presentation development testing and regression debugging scenarios since these could be completely automated without developer intervention.
since we did not have access to mockups templates or multiple versions of our subject applications we used the screenshots taken in step of the protocol as a stand in for the mockup or screenshot of the previous correct version.
this allowed us to simulate the presentation development testing and regression debugging scenarios for evaluation purposes.
the results of this experiment are shown in table .
the column t shows the total number of test cases used per application.
accuracy for localization is shown under the column labeled localization.
for detection accuracy we calculated the percentage of test cases in which our approach could detect that a presentation failure had occurred.
for localization accuracy we calculated the percentage of testcases in which the expected faulty element was reported in the result set.
.
discussion our tool was able to detect the presentation failures in all testcases.
accuracy for localization was also high the tool was able to identify a result set that contained the faulty element for on average of the test cases.
we investigated the result sets in order to determine the reason that of the result sets did not contain the faulty element.
we found that two reasons dominated.
the rst of these is that detecting the results of deletion or addition of an html element was not possible with our approach.
when an element is deleted it is no longer present in the web page s r tree therefore it cannot be reported in the result set.
when an element is added the new element is present in the r tree and reported as faulty.
however it is not part of the expected element set since it was not present in the original web page.
the second reason the tool did not identify faulty elements in the result set was that some seeded faults only changed the appearance of other elements.
that is to say they did not change the appearance of the element into which they were seeded.
for example a seeded fault that set the css position property to fixed caused the surrounding elements to be re positioned.
this made the html elements surrounding the seeded element but not the seeded element appear to be a di erence.
.
related work the most closely related work is discussed in section .
in this section we elaborate on the contrast with cross browser testing xbt and discuss more broadly related work.
xbt techniques by roy choudhary and colleagues compare the rendering of a reference version of a web page in one browser against its rendering in another browser to detect cross browser issues xbi .
as discussed in section .
this approach is not applicable for presentation development testing and standard debugging.
for regression debugging its use would be limited to scenarios where the dom had not changed signi cantly and matching elements could still be matched using probabilistic techniques.
a visual comparison of certain elements is done using color histograms instead of the pixel by pixel comparison employed by our approach.
browser plug ins such as perfectpixel for chrome and pixel perfect for firefox help developers to detect pixel level di erences with an image based oracle.
they overlay a semi transparent version of the oracle over the html page under test enabling developers to do a per pixel comparison to detect presentation failures.
however they require the developer to manually locate the faulty el94ements.
in contrast our approach is fully automated for detection and localization.
there has been active research in the eld of user interface testing.
memon and colleagues have done substantial work in the area of model based automated gui testing.
these techniques di er from our approach in that they are not focused on testing the appearance of the user interface but instead focus on testing the behavior of the system based on event sequences on the user interface.
another work by eaton and memon in the eld of web applications focuses on reporting html tags present in the test web page that are not supported by a speci c browser.
this can detect presentation failures caused by unsupported tags however it cannot detect failures related to application speci c appearance properties.
there has also been active research in the eld of validating html for syntax .
these techniques check for malformed html code that can cause presentation failures if the rendering browser does not handle them properly.
however these techniques can only detect presentation failures related to html syntax errors and not failures related to application speci c appearance properties.
recently techniques to test javascript and analyze css have been proposed.
these techniques deal with speci c components of the client side and as such are not meant for detecting presentation failures in a web application.
another technique based on impact analysis of css changes across a web site noti es the developer if changes made in a css le are introducing new presentation failures in other web pages of the web site.
however this technique relies on the availability of the golden version of all the web pages in the web site and is not able to handle presentation failures caused by changes in the dom structure of the web page.
wang and colleagues propose a technique to automatically perform presentation changes in dynamic web applications.
their technique facilitates automatic changes to the server side code generating web pages based on a given presentation change.
though this produces a new looking web page its appearance is not veri ed for correctness.
.
conclusion and future work in this paper we introduced a new technique for detecting and localizing presentation failures in web applications.
our approach uses image processing techniques to compare a web page rendered in a browser with its oracle and identify di erence pixels.
then the approach builds a rendering map of the page and uses the di erence pixels to identify and rank a set of likely faulty html elements.
in the evaluation our approach detected of the presentation failures and was able to locate the faulty element in over of the cases.
overall these preliminary results are promising and indicate the feasibility of our approach in being able to assist developers by automating the detection and localization of presentation failures.
in future work we rst plan to explore techniques to handle the dynamic nature of modern web applications.
example of dynamic portions of a web application are advertisements user account information text from a database etc.
for this we plan to provide a mechanism by which the users can mark the dynamic portions of the web page and specify the correctness properties that should apply to the respec tive portions.
the idea is to check certain visual properties such as font while ignoring the content di erences.
secondly we plan to relax the expectation of a pixelperfect match of the test web page to the oracle image as it may not always be desirable.
in many cases small di erences may represent concessions to coding simplicity or be within a level of tolerance that the development team does not consider to represent a presentation failure.
in these cases a more relaxed comparison that expresses a close enough match is more appropriate.
for this we plan to introduce the notion of a tolerance level while deciding the equivalence of two image pixels.
thirdly we plan to prioritize the result set produced as the output of the localization phase.
our approach adds html elements to the result set regardless of whether their presentation failure is independent or dependent on another element.
this can be problematic for developers if the size of the result set requires them to inspect many html elements.
to address this problem we plan to use heuristics based on the parent child relationships of the elements and rank them with respect to their likelihood of being faulty.
.