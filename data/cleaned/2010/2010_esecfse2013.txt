code fragment summarization annie t.t.
ying and martin p .
robillard school of computer science mcgill university annie.ying martin cs.mcgill.ca abstract currentresearchinsoftwareengineeringhasmostlyfocused on the retrieval accuracy aspect but little on the presentation aspect of code examples e.g.
how code examples are presented in a result page.
we investigate the feasibility ofsummarizingcodeexamplesforbetterpresentingacode example.
our algorithm based on machine learning could approximatesummariesinanoraclemanuallygeneratedby humans with a precision of .
.
this result is promising assummarieswiththislevelofprecisionachievedthesame levelofagreementashumanannotatorswitheachother.
categoriesandsubjectdescriptors d. .
distribution maintenance andenhancement generalterms experimentation keywords machinelearning summarization sourcecodeanalysis .
introduction the web is an important resource for a programmer as much as of a programmer s time could be spent on theweb .
when a programmersearchesforinformation relatedtoanapplicationprogramminginterfaces api of thevarioustypesofdocumentationtheprogrammerfindson the web code examples are one of the most effective important and frequently sought after .
because searching for code examples is often an indispensable part of programming researchers have built search engines and recommendationsystemsforretrievingrelevantcodeexamples .
mostofthesesystemsfocusonimprovingthe accuracyofcodeexampleretrieval.
however even when a relevant example is returned by a general or code specific search engine the presentation of permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bearthisnoticeandthefullcitation onthefirst page.
tocopyotherwise to republish topostonserversortoredistributetolists requirespriorspecific permission and ora fee.
esec fse august saint petersburg russia copyright2013acm ... .
.
figure a result for apr fileread from google code examples can hinder the use of the example.
even a state of the artsearchengineforfindingcodeexamplesdoes not provide adequate cues for a programmer to effectively evaluate whether the link is worth while to follow.
often the textual snippet accompanying a returned link contains no code only a textual summary of the web page being linked.
when a summary does contain code the summary isextractedasifthecodeweretext figure1 .
theselimitationsoftenfoilaprogrammer sattempttoevaluatewhether a search hit is worth pursuing making it necessary for a programmertoopenandscanmanyoftheresultpages .
yet in the context of general search engines textual snippets form a significant part of the time on a search resultpage ofevaluatingwhetheraparticularreturned linkisworthnavigatingto.
weproposetosummarize codeexamples moreformally code fragmentswhich we define as partial programs that serve the purpose of demonstrating the usage of an api.
acode fragment summaryis a shorter code fragment than the original one where any line in the summary is more informative in the context of a specific query than any otherlinenotinthesummary.
in this paper we present a feasibility study on one way of generating code fragment summaries a supervised machine learning approach that classifies whether a line in a codefragmentshouldbeinasummary.
asaninitialinvestigation we exploited two types of features syntacticfeaturesofthesourcecode andwhetheralineisrelatedtothe givenquery.
for training and evaluating our classifier we collectedacorpusofcodefragments andconstructedacorresponding summary oracle using four human annotators.
thecorpusconsistsof70codefragmentsdirectlyextracted from code examples illustrating the answers to the eclipse officialfaq.1wedefinedthequery whichisthefocusofthe summary as the faq question.
the summary oracle consistsofsummariesmanuallycreatedbyannotatorsthrough selectinglinesdeemedimportantforasummary totalingto 3560judgments.
figure2illustratesonecodefragmentfrom ourcorpus forthefaq how wegeneratedismarkedasbold.
faqs accessed onmay29 iclasspathentry entry ... ipath path entry.getpath iworkspace workspace resourcesplugin.getworkspace iresourcejarfile workspace.getroot .findmember path if jarfile !
null return jarfile.getlocation else must be an external jar or invalid classpath entry figure a code fragment summary in bold we found promising evidence in the feasibility of generating code fragment summaries using a machine learning approachwithlight weightfeatures withaprecisionof0.
whenweallowedsummariestobeofthesamelengthasthe oracle.
this level of precision were as similar to humangenerated summaries as summaries generated by different humanstoeachother.
oursyntacticandquery relatedfeaturesarefasttogenerate .09spercodefragment making itpossibletodeployinarealsearchengineandothersoftwareengineeringsettings.
thissimplealgorithmwillserve as a baseline as we develop more sophisticated code fragmentsummarizationapproaches.
.
relatedwork the closest work to ours is a system by kim et al thataugmentsapidocumentationwithcodeexamplesummaries.
thecomponentoftheirsystemresponsibleforsummarizationresemblesourtool alsousingsyntacticandquery features though without the use of machine learning.
our summarizerdiffersinthepurpose theirapproachismeant forsummarizingmultipleresultsfromacodesearchengine suchaskoders whereasouralgorithmworksonsummarizinganysinglecodefragments.
mica andassieme areexamplesofthelineofwork aimingataugmentingsearchengines.
micaaimsathelping aprogrammerevaluatewhetherasearchhitfromageneral search engine contains the relevant api elements and for assieme relevantcodeexamples.
micaworksbyaugmenting the search result page with api methods classes and field names that are contained in web pages linked by the searchhits.
assiemeextractsthecodeexamplesfromthereturnedwebpagesastheresultanddisplaysvariousstatistics andlinkstotheapielements.
assiemeattemptstobetter adapt a general search engine to code search by expanding aprogrammer squeryonageneralsearchenginewithprogramming language keywords.
our system differs in that insteadofsimplydisplayingalltheapielements inmica s case orthecodefragments inassieme scase containedin a web page linked by the search hits wesummarizecode fragmentscontainedinthewebpagetoimproveontheofteninadequatetextualsnippetsprovidedbygeneralsearch engines.
researchershaveproposedmanycodeexamplesearchengines e.g.
strathcona sniff sourcerer and arecentsystembybuseandweimer andcodecompletiontools e.g.
theintelligentcodecompletionsystem .
mostofthesesystemsattempttosynthesizecodeexamples orfindtherelevantapisfromcoderepositoriesthatmatcha programmer squery whetherthequeryisexplicitlyformed orimplicitlyinferredfromthecontext.
however thesesystems do not help a programmer searching on the web for codeexamplesandwishingtousethecontextaccompanyingthedesiredcodefragmentinawebpage.
several efforts have investigated reduced representations ofsoftwareartifacts includingsummarizingbugreports and producinga succinctset of textual keywords or textualsummary giventhesourcecodeofamethod.
.
codefragmentsummarizer our classifier uses two types of features whether a line contains certain syntactic constructs and whether a line is related to a query.
we set aside code fragments and summariesforthethedevelopmentoffeatures development set andtherest forevaluation.
.
syntacticfeatures weobservedfromthesummariesinthedevelopmentset that when a line contains a certain type of syntactic constructs the line is more likely to be in a summary.
for example a line containing an anonymous class declaration andinstantiationtendedtobeinasummaryintheoracle whereasalinecontaininganifconditionaltendednottobe inasummary.
in total after experimenting with the development set we employed syntactic features.
these features include whether a line in a code fragment contains a certain part of a type signature e.g.
typeispublic contains an anonymous declaration and instantiation contains an exception handling or conditional keyword is in a block contains a variable or field declaration contains a part of a method signature containsamethodinvocation containsamethod exist statement contains a comment contains an assignment contains a call declared in the code and contains a callinthejavasdk.
weextractedthesesyntacticfeaturesofacodefragment from its abstract syntax tree ast .
all syntactic features are discrete variables with a binary value depending on whetheralinecontainsafeature.
.
query relatedfeatures we also observed that annotators are more likely to include in the summary the lines containing the terms from the query which is the question in the faq.
analogous to the syntactic features query related features are discrete variables with a binary value dependingon whether a line contains a feature.
we constructed three features that indicate whether an identifier in a code fragment contains a querytermornot.
weconstructedtwoadditionalfeatures thatlookedbeyondjustindividuallines mosttermsistrue when a line contains the most number of matching terms amongallthelinesinthesamecodefragment andmostdiversetermsis analogousexcept it indicates the most numberofdistinctterms.
whencomputingthefeatures wesplit theidentifiersaccordingtothecommoncamelcaseidentifier namingconvention.
.
classifier trainingandevaluationdata weexperimentedwithtwoseparateclassifiersusingnaive bayes nb andsupportvectormachine svm .
regardingtrainingdata thesummariesfromthefourannotatorshadacohenkappa agreementof0.
.
avalue between .
.
is considered a moderate agreement when the task is well defined .
since the same code fragment line could have contradictory markings by the four annotators.
such noise could confuse machine learning models average false positive rateaverage true positive rate .
.
.
.
.
.
.
.
.
.
.
.
line line line line linesvm nb svm query only first n lines last n linesfigure roc curves moresoforsvmthannaivebayes.
otherpreviouseffortsin summarizationhaveaddressedthisproblembytrainingand evaluatingamodelusingagold standard summary .
agoldstandardsummaryforagivencodefragmentconsists of lines marked as in summary by at least two annotators andlinesmarkedbyoneannotatorornonearenotconsideredtobeinagoldstandardsummary.
onaverage thesize of a summary in the gold standard was .
sd .
oftheoriginalcodefragment.
.
feasibilitystudy our main research question is whether it is feasible to generatecodefragmentssummariesusingonlysyntacticand query related features.
on average our summarizer could generate features for a code fragment in .
seconds per codefragment.
ifwecangeneratereasonablecodefragment summariesusingthesetwosimpletypesoffeatures itwould provideuswitha promisingfeasibilityargumentandbaselinefordevelopingmoresophisticatedtechniques.
effectiveness metrics we usedleave one out cross validation where one also known as a fold refers to one code fragment.2for each fold we defined the correctness of the generated summary asthecorrespondinggoldstandardsummary.
toevaluatehowwellageneratedsummaryresemblesthe goldstandardsummaryintheoracle wecomparedthetwo usingr precision an evaluation metric from the field of informationretrieval .
r precisionissimilartoprecisionat k theprecisionforsummariesoflengthk.
precision at k determinesoutofthetopklinespredictedbyourclassifier predicted k howmanyarecorrect oracle predicted k .
r precisiondiffersfromprecision at kbyallowingsummaries ofvariablelengths.
ther precisionofacodefragmentevaluatesthetoprlinesreturnedbyourclassifier predicted r whereristhelengthofthesummaryoracle.
moreformally r precisionisgivenby oracle predicted r predicted r .
effectiveness results as a preliminary evaluation we assessed the performance ofoursummarizerbycomparingwhethertheclassifierwas betterthanthreebaselines thefirst n linesclassifierwhich 2to maximize the training data but still evaluate on the unseenevaluationdata thecrossvalidationconsistedof53 folds eachfoldyieldedapredictionforonesummarytrained on69 i.e.
goldstandardsummaries.a1 a2 a3 a40.
.
.
annotators except ...kappa agreement4 annotators konailafigure agreement result constructs a summary of lengthnby picking the firstn lines of a code fragment thelast n linesclassifier which picks the lastnlines and thesvm query onlyclassifier that only uses the two query related features described in section .
.
we conducted the performance comparison throughareceiveroperatorcharacteristic roc curve.
an roc curve depicts the trade off between the true positive rate and false positive rate as we variednfrom one line tofourlines.
thiscurveenablesustounderstandexplicitly theperformancetrade offamongdifferentsummarylengths.
the coordinate of a point on the curve is given by the averagetruepositiverate averageofeachofthetruepositive ratepercodefragment andaveragefalsepositiverate average of each of the false positive rate per code fragment .
thetrue positive rateofacodefragmentcisgivenby lines in gold st. summary ofc lines in gen. summary ofc lines in gold st. summary ofc thefalse positive rateofacodefragmentcisgivenby lines inc notin gold st. summary lines in gen. sum.
ofc lines inc notin gold st. summary averaging the rates per code fragment rather than for all lines alignsbetterwiththeactualtaskofprovidingasummaryforacodefragment ratherthanbeingjustanexercise ofpredictingsummary membershipoflines .
thecloserthe roccurveistotheupperleftcorner withfewerfalsepositivesandmoretruepositives thebettertheclassifier.
the areaunderthecurvesumsupthisintuition thebetterthe classifier thecloseritsareaunderaroccurveisto1.
figure3showsfiveroccurves twoversionsofourclassifier svmandnb thetwothickerlines andthreebaselines svm query only first n lines andlast n lines the threethinnerlines .
ourtwoclassifiershaveareaunderthe curve of .
forsvmand .
fornb.
both clearly lie abovethefirst n linesbaseline theareaunderthecurveis .
andlast n linesbaseline the area under the curve is0.
.
inaddition thetwoclassifiersusingbothsyntactic and query features out perform the baseline using only query related features svm query only whose area under thecurveis0.
.
comparing generated and annotators summaries figure4illustratesthekappaagreementofthefourannotators kappa .
andhowtheagreementchangedwhen we left out the summaries provided by each one of the annotators and replaced the summaries of the left out annotator with summaries generated by the classifier.
in one case a3 swapping in the generated summaries evenimprovedthe agreement whereas in two cases the agreement decreasedslightlyandinthethirdcasedecreasedmore.
the averageofthefourkappastatisticsofthethree annotatorsplus our classifiersettingswas0.
almostthesameasthe agreementofthefourannotators.one could argue that the average r precision was .
andtheareaundertheroccurvewerefarfrom1 theperfectscore.
however giventheagreementamongthehuman annotatorsonthesummarieswasconsideredmoderatelylow kappa .
thereisalimittotheperformanceonecould expectfromamachinelearningapproachthatreliedonthis samesetofannotations.
theseinitialresultsshowpromisingfeasibilityinusinglight weightfeaturestogeneratecode fragmentsummaries.
.
conclusionandfuturedirections we introduced a new idea of generating code fragment summariesasawaytoprovidesuccinctcuesforwebpages containing code fragments.
these summaries have a wide rangeofapplicationsinsummarizinganyartifactscontainingcodefragments.
theapproachofusinglight weightsyntacticandqueryfeaturesachievedaprecisionof0.705when we allowed summaries to be of the same length as the oracle.
with this level of precision our summaries achieved thesamelevelofagreementashumanannotatorswitheach other.
the features are fast to generate .
seconds per codefragment makingitpossibletodeployinarealsearch engineandothersoftwareengineeringsettings.
therearepromisingfuturedirectionstotakeourcurrent summarizerto.
observingthesummariesintheeclipsefaq oraclerevealedthepromiseinadditionalcode levelanalysis totakeintoaccounttherelationbetweenlineswhengeneratingsummaries.
forexample simpleintra methoddata flow relatedfeatures suchaswhetherareturntypeofamethod call in a code fragment is later used can be indicative of whether the line is important for a summary.
analyses on codefragmentscanposetechnicalchallengesrelatedtothe factthatcodefragmentsarenotcompleteprograms.
intheevaluationofoursummaries definingthecorrectnessofasummaryasthesummarylinesmoreagreedupon bytheannotatorsassumedthatacodefragmenthasasingle universal summary suitable for everyone.
the moderately lowagreementamongtheannotatorsmotivatedustoinvestigate a different assumption on the correctness of a summary there does not exist one correct summary rather each annotator s version of the summary is correct.
with thisassumption anoptimalsummarizerwouldbeonethat personalizessummaries for each individual.
personalized summariesisapromisingdirectionforfutureresearch.
.