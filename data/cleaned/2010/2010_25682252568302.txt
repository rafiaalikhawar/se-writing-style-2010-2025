mining interprocedural data oriented usage patterns in javascript web applications hung viet nguyen hungnv iastate.eduhoan anh nguyen hoan iastate.eduanh tuan nguyen anhnt iastate.edutien n. nguyen tien iastate.edu electrical and computer engineering department iowa state university ames ia usa abstract a frequently occurring usage of program elements in a programming language and software libraries is called a usage pattern .
in javascript js web applications js usage patterns in their source code have special characteristics that pose challenges in pattern mining.
they involve nested data objects with no corresponding names or types.
js functions can be also used as data objects.
js usages are often crosslanguage inter procedural and involve control and data ow dependencies among js program entities and data objects whose data types are revealed only at run time due to dynamic typing in js.
this paper presents jsmodel a novel graph based representation for js usages and jsminer a scalable approach to mine inter procedural data oriented js usage patterns.
our empirical evaluation on several web programs shows that jsminer e ciently detects more js patterns with higher accuracy than a state of the art approach.
we conducted experiments to show jsmodel s usefulness in two applications detecting anti patterns buggy patterns and documenting js apis via pattern skeletons.
our controlled experiment shows that the mined patterns are useful as js documentation and code templates.
categories and subject descriptors d. .
distribution maintenance and enhancement general terms algorithms design documentation languages keywords usage patterns mining javascript web applications .
introduction when writing code developers often use the program elements in a programming language and the apis of software permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
to copy otherwise to republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
icse may june hyderabad india copyright acm ... .
.libraries in a speci c order to realize a certain task.
for example in a task of writing a number to a data le in c a variable of type file must be opened via the fopen function before another variable of type intcan be written to the le via the fwrite function and nally the le should be closed to conclude the task via the fclose function .
multiple programs could share a common task and software developers repeat the code to realize it following the usage of the program elements for that task.
a frequently occurring code for a common task is called a usage pattern .
several methods for mining usage patterns from code repositories have been proposed.
the resulting usage patterns have been shown to be useful in many software engineering tasks e.g.
usage documentation code smell and anomaly detection defect and vulnerability detection code search code completion evolution adaptation etc.
however existing usage pattern mining methods are limited in the context of javascript js web code.
the usage patterns in js have characteristics that pose several challenges in pattern mining.
first js usage patterns involve control and data ow dependencies among program entities and data objects whose data types are often revealed only at run time due to dynamic typing in js.
this creates great challenges since existing mining algorithms require named types for matching the entities in the usages .
second js usage patterns can involve aggregated and nested data objects which are often inline code i.e.
havingno corresponding named entities in the program.
thus a mining algorithm must match the structures prototypes of objects and cannot rely solely on the type names.
despite recent advance in data clone detection for spreadsheets data objects have never been considered in existing pattern mining approaches for the traditional typed languages since they can be abstracted with their types.
third a js pattern may cross the boundary of functions due to a popular programming style in js for event handlers .
several static analysis based mining techniques could not handle suchinter procedural patterns due to their scalability.
additional complexity is from the fact that js functions can be used as data objects .
finally js code is used to provide the control logic for web pages thus js patterns often involve html elements.
no existing mining approach can handle all those properties in js patterns yet.
this paper presents jsminer a static approach to mine inter procedural data oriented js usage patterns in web applications.
a js usage is modeled by a novel graph based representation called jsmodel .
in addition to function calls eld accesses and control nodes as in existing usage models permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
copyright is held by the author owner s .
publication rights licensed to acm.
icse may june hyderabad india acm jsmodel has un named data nodes for variables object literals js functions and html elements.
the structure of an object is captured via un named data nodes and edges that represent their containment relations.
edges are also used to model control and data ow dependencies among nodes.
a data node for a js function which has an edge to its body can be connected as an input of any operation e.g.
as an argument of a function call.
this facilitates the mining of inter procedural patterns and the patterns with anonymous functions in event handlers.
our graph based mining tool jsminer is tailored toward js to be e cient and scalable for large usage graphs.
it relies on graph structures and labels for matching rather than data types as in existing tools.
our empirical evaluation on several web programs shows that jsminer can detect more js patterns with higher accuracy and e ciency than the state of the art tool grouminer .
other experiments also showed jsmodel s usefulness in two applications detecting buggy patterns and documenting js apis via patterns.
our key contributions include .
jsmodel a graph based representation model for js usages and patterns in js web applications sections .
jsminer a scalable js pattern mining tool section .
an empirical evaluation on its scalability and accuracy in pattern mining in web programs and jsmodel s usefulness in anti pattern detection and js documentation section .
.
motivating examples let us present a few usage scenarios that share js usage patterns and then discuss the challenges in mining them.
.
usage scenario figure shows the html js code of an example from the website of the google maps js api library .
the library allows developers to embed google maps applications in their websites by providing a variety of utilities for manipulating maps and adding content to the maps.
this example web page displays a map at a given location on the left panel.
when a user selects two points aand bon the map the optimal driving directions from atobwill be calculated and highlighted and the direction details will be displayed on the right panel.
to provide that function using google maps a developer would need to implement four main steps step .
creating two html panels for the content of the map and the direction information in figure the html div tags map canvas and directionspanel on lines serve as the place holders for the map and direction panels.
step .
creating a js map object provided by the api and displaying it on the html panel for the map this step is realized in lines of the function initialize which will be called to create the actual map as the web page is loaded line .
the variable myoptions is rst initialized with an object literal storing the properties of the map lines .
a js object literal is an unnamed list of property value pairs of an object enclosed in curly braces.
then the variable myoptions is passed as the second argument to a function that creates a map object line .
to display the map on the map panel document.getelementbyid map canvas is passed as the rst argument of that function line .
step .
creating a js directionsrenderer api object to highlight the route on the map and displaying the direction on the html direction panel lines the variable directionsdisplay is rst initialized as a directionsrenderer ob html head ... script type text javascript ... 3var directionsservice new google.maps.directionsservice ... 4function initialize f directionsdisplay new google.maps.directionsrenderer var center new google.maps.latlng .
.
varmyoptions f zoom maptypeid google.maps.maptypeid.roadmap center center streetviewcontrol false g map new google.maps.map document.getelementbyid map canvas myoptions directionsdisplay .setmap map directionsdisplay .
setpanel doc.getelementbyid directionpanel google.maps.event.addlistener map click function event f... calcroute ... g 19g... function calcroute f var request f origin origin destination destination waypoints waypoints travelmode google.maps.directionstravelmode.driving g directionsservice .
route request function response status f if status google.maps.directionsstatus.ok f clearmarkers directionsdisplay .
setdirections response g g 33g... script head body onload initialize ... ... div id map canvas style ... width 398px ... div div id directionspanel style ... width 240px ... div .. body html figure usage scenario nding directions ject line which contains direction details between two points.
functions setmap and setpanel are called to display the direction on the map and direction panels lines .
step .
updating the directions when the user selects or updates two locations the api function addlistener lines is called to declare a handler for the event when a user clicks to select two points on the map.
.
usage scenario we also found a google maps api example on that allows users to mark an area on a map with a polygon figure .
the web page example has di erent functionality but shares the map displaying task with the previous example.
following the google maps api usage the authors of that web page example realized that task with the same four steps.
step was implemented on lines step on lines step on line and step on line .
observations.
from the two above usage scenarios we have the following observations o1.
a library provides usages for di erent tasks in different scenarios.
a usage for one task can be shared among multiple scenarios.
the frequently occurring usage for a common task is called a usage pattern .
as writing code in a usage developers need to follow speci c steps and use program elements in speci c orders.
that is there are control ow dependencies among the actions in those usages.
for example the map object needs to be created before it can be attached to another object via the function setmap .
there792 edit.html script type text javascript 2var poly map ... 3function initialize f var uluru new google.maps.latlng .
.
map new google.maps.map document.getelementbyid map f zoom center uluru maptypeid google.maps.maptypeid.satellite g poly new google.maps.polygon ... poly.setmap map poly.setpaths new google.maps.mvcarray google.maps.event.addlistener map click addpoint 14g function addpoint event f... 16g script ... body ...onload initialize ... div id map ... div body html figure usage scenario creating polygons are also data ow dependencies among actions e.g.
the data resulted from an action can be the input of another.
moreover the code for a pattern is not necessarily contiguous since it can be intermixed with the code for other tasks.
o2.
a js usage pattern often involves not only function calls but also js data objects and js functions that are required for the intended usage.
for instance a js object literal is needed to initialize the properties of the map object and a js event handler whether anonymous or named is used as an argument of addlistener .
multiple objects can be aggregated as the values of the properties of an unnamed object literal .
note that js functions are treated as data and can be passed as arguments to other functions.
o3.
a js usage pattern can involve code written in different languages and there are cross language dependencies among those code fragments.
for instance the html element body onload initialize ... speci es a call to the js function initialize on its onload event whereas the js code document.getelementbyid map canvas accesses an html element with the id map canvas .
o4.
the same usage pattern might have implementation variants written in slightly di erent ways .
for example in figure the object literal describing the map s properties is assigned to variable myoptions and myoptions is passed as an argument to google.maps.map lines while at lines of figure the object literal is directly passed as an argument.
the event handler at line of figure is anonymous while the one at line of figure is a named function .
o5.
js is a dynamically typed language.
the data types of js variables can be determined changed automatically as needed during the execution.
for instance the variables poly and map line figure are declared with js keyword var without their types being speci ed in the code.
at run time map wil be initialized as a map object line figure .
.
usage scenario figure displays another google maps example which shares the same route calculation displaying task as in the rst usage scenario except for a few details e.g.
the source and destination locations are now pre de ned.
the usage for that task is inside the function calcroute lines figure similar to the one on lines figure .
draggable directions.html 1var directionsservice new google.maps.directionsservice ... 2function calcroute f var start pirrama road pyrmont nsw varend bondi beach nsw var request f origin start destination end travelmode google.maps.directionstravelmode.driving g directionsservice .
route request function response status f if status google.maps.directionsstatus.ok f directionsdisplay .
setdirections response g g 15g... figure usage scenario draggable directions o6.
a usage pattern can involve inter procedural dependencies .
for example the route calculation usage pattern involves both the code from outside an event handler lines and its function body lines .
this type of interprocedural pattern occurs in js event handling code which is popular in web applications to enhance interactivity.
thus all or parts of such a js callback function belong to a usage.
.
challenges in mining js usage patterns these examples illustrate new challenges in mining usage patterns in js based web code.
first a pattern may contain aggregated data objects including unnamed object literals o2 .
worse some js variables might not have declared types o5 .
thus pattern mining that relies solely on matching type names for program entities would not work.
the prototypes of data objects must be considered during entity matching to nd patterns.
data objects which are crucial parts of js usage patterns have never been considered in existing mining approaches for the traditional typed languages since they can be abstracted with their types.
second a js pattern often contains inter procedural dependencies due to event handling code o6 .
anonymous functions are used both as functions and as data when passed as arguments to another function.
thus mining inter procedural patterns is needed in js code.
however this not only creates the scalability issue but also increases the complexity in a mining tool to represent such complex relationships.
moreover in some applications anonymous functions objects are used and in others the named ones are o4 .
a mining tool must be able to detect patterns despite that di erence.
finally a js pattern involves also non js web code o3 .
.
representation of js usages to address those challenges we present jsmodel a graph representation and jsminer a pattern miner for js usages.
definition jsmodel .
a jsmodel is a labeled directed graph representing a usage in a js program.
in a jsmodel the nodes represent program actions data and control structures and the edges represent control and data ows and inclusion relationships among them.
all types of jsmodel nodes and edges are listed in table .
there are types of nodes action data and control nodes.
.
action nodes n1 n3 .
program actions in a js usage include function invocations variable assignments and793table types of nodes and edges in a jsmodel type sub type description nodes n1.
action funccall m mis a function invocation n2.
action assignment a value assignment to a variable n3.
action operation op a data operation !
... n4.
data variable x xis a variable or a eld of an object n5.
data function a function used as data n6.
data objlit an object literal n7.
data html an html tag element n8.
control a control structure if for while edges x!y e1.
control controlow dependency from xtoy e2.
data dataow dependency from xtoy e3.
inclusion xhas a block of code including y node types edge typesaction data control control flow data flow inclusionroutedirectionsservice obj request outinobjlitinclorigin destinationincl waypointsincl waypoints inout outdestination in arg function anonymous argorigin out in if op cond responseparamstatus param in in...ok directionsdisplay setdirectionsobjargincl clearmarkerstravelmode ...driving in out incl incll21 l27 l30l28 l29incl figure jsmodel for the body of calcroute in figure data operations e.g.
!
etc .
those actions are represented by action nodes in a jsmodel.
the label of an action node is either for an assignment the function name for a function invocation or the notation opfor a data operation.
for example the action nodes at l21 and l27 in the jsmodel in figure correspond to the assignment and the function invocation route on lines and in figure .
.
data nodes n4 n7 .
data nodes are used to represent the data involved in the actions of a js usage.
jsmodel has four types of data nodes variable function and object literal for representing js data objects and html data nodes for html elements.
the label of a data node contains the name id of the corresponding data entity i.e.
variable function object literal or html element if it has a name id.
otherwise a label anonymous is used.
.
control nodes n8 .
control nodes model control structures such as branches and loops that are required for the intended usage.
the label of a control node is the name of its corresponding control structure e.g.
iforwhile .there are three edge types control data and inclusion .
controlow edges e1 .
controlow edges represent the control ows orders among the actions and control structures in a usage.
such edges have no labels.
for example in figure variable request is initialized line then is passed to function route line .
in figure the order is modeled as a controlow edge from toroute .
.
dataow edges e2 .
dataow edges with their labels model di erent types of data ow dependencies between the actions and data entities in a usage e.g.
an argedge from a variable node xto a function call node m indicates that xis an argument ofm or an objedge between mand xmeans that mis a function call on the object x. for instance the dataow edge labeled outfrom the action node to the data node request in figure means that a value is assigned to variable request .
.
inclusion edges e3 .
aninclusion edge labeled as incl from a node xto a nodeyindicates that xhas a block of code directly containing y wherexcan be a function object literal or control structure.
in figure the control node if has two inclusion edges to the two actions clearmarker and setdirections to indicate that those two function calls need to be placed inside an ifstatement lines figure .
a function node also has incledges to its body s statements.
let us explain in detail di erent node and edge types in a jsmodel and our design rationale and illustrate how those design ideas address the challenges discussed in section .
.
representing data objects we introduce three data node types namely variable function and object literal to represent those js data objects and html nodes to represent html elements.
variable nodes n4 table .
avariable node is used to model a variable or a eld of an object.
if the data is an object eld the corresponding jsmodel will have a data node representing the object a data node representing the object s eld and a dataow edge between them.
object literal nodes n6 .
in js usages object literals are unnamed.
they must be matched via their prototypes structures .
thus jsmodel uses an objlit node.
each object literal has one or multiple elds each of which has a name and an initial value.
thus an objlit has inclusion edges referring to the object s elds.
the value initialization of each eld is modeled by the action nodes.
for example the objlit node in figure represents the object literal at line figure .
the eld of an object literal can in turn be assigned with another object literal i.e.
object literals can be nested .
jsmodel can model a usage with nested object literals as in the following example.
objlit radius incl out circle radius getradius center x y centergetradius in objlit out inx yincl incl incl jsmodel for the value of circle besides the above data types a js usage may also contain primitive types.
since data values might vary in di erent usages of the same pattern jsmodel does not represent them.
html nodes n7 .
we also represent html elements as data nodes of type html .
information about an element s properties e.g.
its type name and id is recorded so that when it is accessed from js code the corresponding html node can be used to represent the referred element.794function nodes n5 .
we represent a function as a data node of type function .
to support inter procedural usage pattern a function node is linked via inclusion edges to the jsmodels describing its body code the function node in figure connects to the inside of the jsmodel for its body .
there are two ways that a function can be used.
first a function is invoked via a function call .
thus an action node funccall n1 table is connected via a dataow edge to its corresponding function node n5 if the declaration of that function is found in the current source code so that inter procedural dependencies in a js usage can be recognized.
second if a js function is used as a data object the function node will connect to other nodes.
for example in figure the function node connects via a dataow edge to the action node route since the function is an argument of route .
a function could also have a name and be referred to as in the following code from figure where the function addpoint is used as an argument of addlistener google.maps.event.addlistener map click addpoint 14g function addpoint event f... 16g in such cases the declared function and its