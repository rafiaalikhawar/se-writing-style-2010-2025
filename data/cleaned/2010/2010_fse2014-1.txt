efficient runtime enforcement techniques for policy weaving richard joinery thomas repsy z somesh jhay mohan dhawan vinod ganapathy yuniversity of wisconsin madison usazgrammatech inc. ithaca ny usa ibm research new delhi india rutgers university piscataway nj usa fjoiner reps jhag cs.wisc.edu mohan.dhawan in.ibm.com vinodg cs.rutgers.edu abstract policy weaving is a program transformation technique that rewrites a program so that it is guaranteed to be safe with respect to a stateful security policy.
it utilizes i static analysis to identify points in the program at which policy violations might occur and ii runtime checks inserted at such points to monitor policy state and prevent violations from occurring.
the promise of policy weaving stems from the possibility of blending the best aspects of static and dynamic analysis components.
therefore a successful instantiation of policy weaving requires a careful balance and coordination between the two.
in this paper we examine the strategy of using a combination of transactional introspection andstatement indirection to implement runtime enforcement in a policy weaving system.
transactional introspection allows the state resulting from the execution of a statement to be examined and if the policy would be violated suppressed.
statement indirection serves as a light weight runtime analysis that can recognize and instrument dynamically generated code that is not available to the static analysis.
these techniques can be implemented via static rewriting so that all possible program executions are protected against policy violations.
we describe our implementation of transactional introspection and statement indirection for policy weaving and report experimental results that show the viability of the approach in the context of real world javascript programs executing in a browser.
categories and subject descriptors d. .
software program verification general terms security verification keywords security policy enforcement dynamic runtime verification transactional introspection statement indirection speculative execution supported in part by darpa under cooperative agreement hr001112 .
any opinions findings and conclusions or recommendations expressed in this publication are those of the authors and do not necessarily reflect the views of the sponsoring agencies.
t. reps has an ownership interest in grammatech inc. thanks to m. zhivich s. maddi and m. rabe at mit lincoln laboratory for invaluable feedback on our implementation.
thanks to the anonymous reviewers for many good suggestions.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
fse november hong kong china.
copyright c acm .
.
.
.
.
introduction policy weaving for security policy enforcement is a programrewriting approach oriented towards striking a balance between static and runtime analysis techniques .
it is sound for policy violations each program trace that is prevented is one that violates the policy.
complete for policy violations all program traces that violate the policy are prevented.
transparent the rewritten program has the same semantics as the original program modulo policy violations.
we refer collectively to these properties as correctness .
the policyweaving approach is motivated by the acknowledgment that in nontrivial scenarios static analysis alone cannot prove that a program adheres to a policy .
in contrast runtime analyses such as inlined reference monitoring irm can be complete for policy violations by testing properties of concrete states at runtime but at the cost of degraded performance.
in addition they may not be sound because it may be difficult from a pragmatic standpoint to exclude only policy violating traces.
to address these limitations policy weaving is a hybrid approach that i attempts to statically identify sections of the program that can be proven safe and ii rewrites the program to include runtime checks at locations where policy state may be affected.
this approach while harnessing the best of both worlds also creates a new challenge that of coordinating the interoperability of and managing the trade offs between the static and runtime analyses.
our goal in this paper is to present and evaluate a runtime policy enforcement mechanism that is well suited to be the target of a static weaving algorithm.
specifically we investigate the utility of transactional introspection applied to a program through static rewriting of source code and an additional statement indirection transformation to enable just in time transactional introspection of code that is generated at runtime.
we describe the resulting end to end policyenforcement system and present experimental data that shows the viability of this approach when applied to real world javascript applications in a browser context.
transactional introspection is a straightforward and powerful tool for securing untrusted code.
transactions allow speculative execution meaning that the effects of an execution can be computed and examined prior to the application of those effects to the environment.
the ability to introspect on actions without committing their effects is necessary when dealing with programs that perform irrevocable actions such as the initiation of an http request.
rollback of communication and other i o actions is not possible in general so a security policy enforcement mechanism that aims to mediate such actions must recognize and potentially suppress such events prior to their occurrence rather than reacting after the fact.
transactions provide this capability to peek into the future and take preventive action to avoid policy violations.
transactional introspection has been studied in prior security work and some difficulties have been identified permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
fse november hong kong china copyright acm ... .
performance overhead of speculative execution can be prohibitive .
correct placement of transactional instrumentation is a nontrivial task .
implementation of introspection logic to recognize and prevent policy violations can be error prone .
in this paper we address each of the concerns that have been raised.
in particular the complexity of both manually placing individual transactions and manually constructing introspection code is replaced by the requirement to formulate an explicit security policy as an automaton.
security policy automata allow programmers to state their intentions and goals explicitly in a typically small and self contained artifact.
moreover the use of transactions produces substantial benefits in terms of performance and flexibility when compared to other enforcement mechanisms.
we also incorporate statement indirection a concept introduced by yu et al.
as a supplemental enforcement primitive.
this mechanism allows us to apply transactional semantics to generated code which is code that is created at runtime and is therefore unavailable to the static analysis.
we use statement indirection to recognize higher order scripts language constructs that generate code to be run immediately or at a later time and to ensure that this code is executed inside a transaction.
examples of higherorder scripts abound in modern scripting languages such as javascript eval function python eval exec compile and perl eval .
the use of statement indirection serves two purposes the static analysis is freed from the generally impossible task of precisely modeling all possible executions of dynamically generated code.
indirection serves as a light weight but special purpose alternative to the use of hard coded transactions.
our work makes use of and synthesizes several techniques from prior work runtime verification the monitoring and enforcement of safety properties during program execution policy aspect weaving the use of static analysis and rewriting for fine grained placement of instrumentation transactional introspection a powerful monitoring and enforcement tool that allows effects of program execution to be examined before being committed statement indirection a light weight monitoring tool that can apply instrumentation to dynamically generated scripts however integrating these diverse techniques is challenging.
the specific contributions of our work are as follows we show how a policy weaving algorithm can be used to automatically weave sound complete and transparent transactional instrumentation into a program.
we describe the automatic translation of a security policy specification into introspection code which substantially reduces the number of opportunities for implementation errors.
we describe how statement indirection can be used to propagate transactional introspection to all dynamically generated scripts.
we present jamscript a simple general purpose extension of the javascript language that implements transactional semantics with properties suited to security policy enforcement.
we present experimental results that demonstrate that our approach performs well compared to manual placement of transactions and other types of enforcement mechanisms that could be targeted by a policy weaving algorithm.
organization x2 presents a specification of the programrewriting algorithm the semantics of transactional introspection the mechanism of indirection and how these techniques fit together conceptually.x3 discusses implementation challenges encountered f set private false get o o true call httprequest true true get o o true f call httprequest f set private false figure policy automaton and its textual representation that specifies a set of disallowed traces namely ones that set the private property of any object to false the bottom path in the automaton or read any property of an object whose private property is true and subsequently make a network request the top path .
set get and call are special event predicates that unify their arguments with values.
ois a variable constrained to be the same value at each occurrence and underscore matches any value.
httprequest