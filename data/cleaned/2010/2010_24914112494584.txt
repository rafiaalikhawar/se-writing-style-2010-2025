lexical statistical machine translation for language migration anh tuan nguyen anhnt iastate.edutung thanh nguyen tung iastate.edutien n. nguyen tien iastate.edu electrical and computer engineering department iowa state university ames ia usa abstract prior research has shown that source code also exhibits naturalness i.e.
it is written by humans and is likely to be repetitive.
the researchers also showed that the n gram language model is useful in predicting the next token in a source le given a large corpus of existing source code.
in this paper we investigate how well statistical machine translation smt models for natural languages could help in migrating source code from one programming language to another.
we treat source code as a sequence of lexical tokens and apply a phrase based smt model on the lexemes of those tokens.
our empirical evaluation on migrating two java projects into c showed that lexical phrase based smt could achieve high lexical translation accuracy bleu from .
.
.
users would have to manually edit only .
.
of the total number of tokens in the resulting code to correct it.
however a high percentage of total translation methods .
.
is syntactically incorrect.
therefore our result calls for a more program oriented smt model that is capable of better integrating the syntactic and semantic information of a program to support language migration.
categories and subject descriptors d. .
distribution maintenance and enhancement general terms algorithms documentation experimentation measurement keywords language migration statistical machine translation .
introduction nowadays the same software could appear in multiple platforms and environments.
for example with the fast growing market of mobile devices a software product needs permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
to copy otherwise to republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
esec fse august saint petersburg russia copyright acm ... .
.to be migrated from one programming language in a platform to another.
companies and organizations often originally developed software in a language and then migrated it to another to address their business needs.
manually migrating projects between languages is time consuming and error prone .
existing semi automatic language migration approaches are based on prede ned translation rules for the constructs and apis between two languages.
those methods expect users to manually specify such rules which is also a tedious and error prone task.
since there are a large number of mappings such as those among apis provided in di erent languages manual rule de nition is timeconsuming insu cient and not scalable.
aiming to reduce such manual e ort we have investigated statistical machine translation smt approaches.
smt is a machine translation paradigm where translations are generated on the basis of statistical models whose parameters are derived from the analysis of a corpus in two corresponding languages .
the motivation for our approach of using smt is the naturalness of source code .
hindle et al.
have shown that source code also exhibits naturalness as in a document written in a natural language i.e.
source code is written by humans and is likely to be repetitive.
the authors also showed that the n gram language model is useful in predicting the next token in a source le given a large corpus of existing source code.
with the repetitiveness in source code we expect that natural language processing methods such as smt could be applicable to language migration.
in this paper we focus on how well smt could translate source code.
more speci cally in this work we studied the method to method migration from java to c .
we treat source code as a sequence of lexical tokens.
a method is considered as a sentence and each code token as a word.
to extract the tokens the lexers for java or c are applied on each method.
only the lexemes of code tokens are used.
we then applied a phrase based smt model named phrasal on the lexemes of those tokens to migrate two open source java projects.
we call this approach lexical phrase based smt lpsmt for short .
our results show that lpsmt achieves high lexical translation accuracy in language migration for source code .
it achieves bleu values a metrics on accuracy of phrase to phrase translation from .
.
and token editing distance ratios from .
.
.
that is users would have to edit .
.
of the total number of tokens in the resulting code to make it correct.
however despite high translation accuracy a high percentage .
.
of all translation methods is syntactically incorrect resulting many parsing errors.
examining the results wepermission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
esec fse august saint petersburg russia copyright acm ... .
table subject systems project java c m.meth ver file meth ver file meth db4o .
.
lucene .
.
.
.
found that the key reason is lpsmt operating only at the lexical level.
therefore our result calls for a more programoriented smt model that is capable of better integrating the syntactic and semantic information of a program to support language migration.
the contributions of this paper include .a lexical smt based language migration approach from java to c and .an empirical evaluation on the applicability of smt in language migration for source code.
section discusses related work.
our study on applying smt to source code is in section .
we conclude by analyzing the results and discussing our future work on integrating syntactic and semantic information to the smt process.
.
related work java2csharp is a tool that translates a java program to c .
it relies on the set of rules between the syntactic units in two languages.
in comparison its approach is deterministic while ours is statistical learning based.
lpsmt does not require the pre de ned translation rules.
however it requires a training data of the systems and their translated versions.
in brief lpsmt model statistically and implicitly learns the translation rules and leverages them and a language model to migrate the code without requiring manual de nition of rules as in rule based translators .
zhong et al.
mine api mapping rules for language migration by relying on textually similar names and similar calling structures among apis in two languages.
yasumatsu and tool automatically translates smalltalk code to c by creating runtime replacement classes implementing the same functionality of smalltalk classes that are inherently part of its execution model.
in waters paradigm a source program is rst analyzed to obtain a programming languageindependent procedure and then re implemented in the target language.
mossienko performs source translation from cobol to java via syntactic rule based approach.
as software is ported to use a new library developers have to migrate their code to use the new one.
several approaches have been proposed to mine the migration rules in api libraries frameworks .
.
lexical phrase based smt in this work we focus on migrating java code to c .
this section presents our study on applying the phrase based smt model in translating source code from java to c .
.
data collection and settings we collected two open source subject systems which were originally developed for java and ported to c .
they are well established systems with long developing histories and both of their java and c versions have been in use.
these two projects db4o and lucene have also been used in prior research in mining language migration rules by zhong et al.
.
columns java.ver and c .ver show the corresponding versions in two languages.
we con rmed thecorresponding versions by reading the associated documentation and code.
columns fileand meth show the numbers of les and methods in each revision for each language.
we chose to evaluate the translation at the method level i.e.
from methods to methods.
we did not choose a nergrained level e.g.
statements since it would be less practical and more time consuming to build the training data for statement to statement translation.
moreover to translate a java class to c one would translate its method and eld declarations to the corresponding ones.
importantly to build the training data for the corresponding methods in two versions we were able to use a semi automatic approach that is time e cient as our subject projects are large.
to do that we built a simple semi automatic tool to search for the similar class names and method signatures in the similar directory structure in two versions for java and c .
the reason is that in those projects most of the names of the corresponding packages classes methods and method signatures in both versions are similar.
in addition because the corresponding versions of a project include also di erent supporting libraries and utility methods in two languages and or contain little extra or less functionality there are methods in both java and c versions that do not have the corresponding ones.
thus we manually veri ed to ensure that the method pairs are in fact the corresponding ones.
incorrect pairs were discarded.
we also veri ed the code in the packages that were not aligned by the tool.
the correct mappings among them were kept.
many packages for deleted added functionality were easily identi ed and discarded.
column m.meth shows the number of aligned methods between the two versions for each subject project.
.
training translating with lpsmt for each project the aligned method pairs between java and c versions were used for training and translating with lpsmt model.
we applied ten fold cross validation by dividing all aligned methods into ten folds with equal numbers of methods.
for each fold used for testing we used other nine folds for training.
we used phrasal a well known lexical phrase based smt tool.
its theoretical foundation was presented in .
the basic linguistic units in phrasal are sentences each of which consists of words separated from one another by whitespaces.
in our experiment each method is considered as a sentence and each code token as a word.
to separate tokens from one another we ran the lexers for java and c on the methods.
whitespaces within string literals were replaced by special characters.
in training phrasal takes as input the set of aligned methods in two languages in which each method is lexically analyzed into a sequence of lexical tokens.
the output of the training phase includes the model s parameters and the mappings between the phrases in java and c .
in translating testing phrasal takes each method in the testing set and produces the translation version in c .
default setting in phrasal was used .
the resulting methods were then compared against the corresponding methods in the oracle.
.
quality metrics we used di erent metrics to evaluate translation quality .bleu .
this is a popular metrics in smt that measures translation quality by the accuracy of translating n grams ton grams with various values of n phrases to phrases 652table accuracy of lexical phrase based smt project tokens bleu edr scr db4o .
.
.
lucene .
.
.
bleu bp e1 n logp1 logpn where bpis the brevity penalty value which equals to if the total length i.e.
the number of words of the resulting sentences is longer than that of the reference sentences i.e.
the correct sentences in the oracle .
otherwise it equals to the ratio between those two lengths.
piis the metrics for the overlapping between the bag of i grams repeating items are allowed appearing in the resulting sentences and that ofi grams appearing in the reference sentences.
speci cally ifsi refandsi trans are the bags of i grams appearing in the reference code and in the translation code respectively pi jsi ref si trans j jsi trans j. the value of bleu is between .
the higher it is the higher the translation quality.
since pirepresents the accuracy in translating phrases with iconsecutive words the higher the value of iis used the better bleu measures translation quality.
for example assume that a translation trhas a high p1value but a low p2.
that is trhas high word to word accuracy but low accuracy in translating grams to grams e.g.
the word order might not be respected in the result .
thus using both p1andp2 will measure trbetter than using only p1.
if translation sentences are shorter bpis smaller and bleu is smaller.
if they are too long and more incorrect words occur pivalues are smaller thus bleu is smaller.
pis are computed for i .
.token edit distance ratio edr .
this metrics measures e ort that a user must edit in term of the code tokens that need to be deleted added in order to transform the resulting code into the correct one.
it is computed as edr p methodseditdistance sr st p methodslength st where editdistance sr st is the editing distance between each pair of the reference method srand the translation method st and the denominator is the total length of all translation sentences.
.syntactic correctness ratio scr .
syntactic correctness of translation code is measured by the ratio between the number of translation methods that are parsable by a standard c parser over the total translation methods.
for each fold in ten fold cross validation we recorded those metrics and calculated the average values in ten folds.
.
results table shows translation accuracy of the lpsmt model.
as seen the model achieves a high bleu value .
.
i.e.
it has high lexical phrase to phrase translation accuracy.
it achieves edrfrom .
.
.
that is a user would need to edit about .
.
of the total number of tokens in the translation code to correct it.
this result shows that statistical machine translation can be applied to language migration in source code with high lexical translation accuracy .
however the number of syntactically incorrect methods is high.
.
.
of translation methods need syntactic correction.
.
case studies and analysis let us present a few case studies and the key limitations of the lpsmt model as being applied to the code lexemes.
java code nativeclassfactory.java 2public class forname string classname throws classnotfoundexception c code inativeclassfactory.cs 5public type forname string classname translated by lpsmt 8public type forname string classname typeloadexception figure method declaration with exception declaration java code clientqueryresult.java 2public clientqueryresult transaction ta intinitialsize f 3super ta initialsize 4g c code clientqueryresult.cs 7public clientqueryresult transaction ta intinitialsize base ta initialsize fg translated by lpsmt 10public clientqueryresult transaction ta intinitialsize base ta f initialsize g figure call to parent class constructor super ... example .
a method declaration with an exception declaration.
figure shows an example in db4o project as the lpsmt model translates a method declaration with an exception declaration in the java le nativeclassfactory.java .
the method forname is speci ed to receive a class name as a string variable and returns the reference to that class.
if that reference does not exist it will cause a classnotfoundexception .
this exception handling behavior is declared in java by the exception declaration in the signature of the method as in throws classnotfoundexception line .
in c an exception declaration in the signature of the method is not supported.
instead a speci c throw statement is declared inside the method s body.
thus in the correctly migrated version of this method the exception declaration is removed from the method signature line .
as the lpsmt model translates this method it removed the keyword throws since it has seen in the training data such removal of that keyword.
however it still translates the term classnotfoundexception into typeloadexception in c .
thus lpsmt in this case created a syntactically incorrect method declaration.
in brief lpsmt can statistically learn the rule to remove the lexeme throws however it is unable to learn the rule to remove the entire syntactic unit of an exception declaration throws classnotfoundexception in the method declaration.
example .
call to parent class constructor super ... .
figure shows another example as the lpsmt model translates a call to the constructor of a parent class via super lines .
in java a call to super is made inside the method s body.
in contrast in c a call to the constructor is made viabaseand occurs in the method signature i.e.
prior to the method s body as in base ta initialsize line .
however in the translation version this call was broken into two pieces one in the method signature base ta and one in the method body initialsize line .
thus the translation code is syntactically incorrect.
in this case lpsmt translated based on the lexemes of tokens in the method signature and the body however does not consider the entire syntactic unit of a constructor call to the parent class in super for translation.
java code formatmigrationtestcasebase.java 2private void createdatabase string le f if file4.exists le f file4.delete le g... 6g c code formatmigrationtestcasebase.cs 8private void createdatabase string le f if system.io.file.exists le f file4.delete le g... 12g translated by lpsmt 14private void createdatabase string le f if system.io.file.exists le f file4.delete le g... 18g figure missing tokens due to limited phrases sizes example .
long phrases.
figure shows a case that the result has a missing close parenthesis at the end of the condition of the ifstatement line .
the reason for such syntactic error is the limited sizes of the phrases in an smt model.
expanding the maximum sizes of the phrases would x the problem however might cause a performance issue.
.
discussions on future work this result shows that statistical machine translation is a promising approach and could be applied well to language migration in source code.
just considering source code as a sequence of lexical tokens lpsmt could achieve good lexical translation accuracy and a small token edit distance ratio.
however the code resulting from running an smt model on lexical code tokens is still far from perfect.
.
almost half of the resulting methods have syntactic errors.
thus we need a method to integrate the syntactic information from the languages into the translation process.
unlike a natural language a programming language has well de ned syntactic rules and unambiguous semantics.
the grammar rules of two programming languages could be used to direct the translation process.
syntactic units could be translated and played the roles of the placeholders for a later migration process for the tokens within each of them.
.
no semantic information on source code is currently taken into account in lpsmt.
it uses only the lexemes from code tokens.
our future direction will be to use program analysis to extract the semantic information of program elements such as their types roles etc.
such information could help the model better align the code within each placeholder.
.
we are also investigating an approach that statistically aligns tree based structures among the source and the target les in two languages.
current smt approach focuses on the alignment of the phrases in natural language documents.
.
post processing could be applied to correct the resulting code as well.
such a process could use program analysis techniques to make sure the migrated code correct.
test cases could also be used to validate the resulting code.
our future work includes the aforementioned directions to improve smt to produce higher quality translation code.
.
conclusions in this paper we investigate how well statistical machine translation smt could help in language migration.
ourstudy shows that applying phrase based smt on code lexemes can achieve high lexical translation accuracy.
however a high percentage of translation methods is syntactically incorrect.
therefore our result calls for a more programoriented smt model that better integrates the syntactic and semantic information of a program to support language migration.
we also discussed several directions for such an integration that we will investigate in our future work.
.