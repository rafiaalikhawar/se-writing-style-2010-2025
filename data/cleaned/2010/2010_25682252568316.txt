is spreadsheet ambiguity harmful?
detecting and repairing spreadsheet smell s due to ambiguous computation wensheng dou state key laboratory of computer science institute of software chinese academy of sciences beijing china wsdou otcaix.iscas.ac.cn shing chi cheung department of computer science and engineering the hong kong university of science and technology hong kong china scc cse.ust.hk jun wei state key laboratory of computer science institute of software chinese academy of sciences beijing china wj otcaix.iscas.ac.cn abstract spreadsheets are widely used by end users for numerical comp ut a tion in their business .
s preadsheet c ells whose computation is subject to the same semantics are often clustered in a row or co lumn.
when a spreadsheet evolves these cell clusters can degene rate due to ad hoc modifications or undisciplined copy and pastes.
such degenerated clusters no longer keep cells prescribing the same computation al semantics and are said to exhibit ambiguous computation smell s .
our empirical study finds that such smells are common and likely harmful.
w e propose amcheck a novel tec hnique that automatically detect s and repair s ambiguous comput ation smell s by recovering their intended computational semantics.
a case study using amcheck suggests that it is useful for disco ver ing and repair ing real spreadsheet problems .
categories and subject descriptors d. .
software engineering distribution maintenance and enhancement r estructuring reverse engineering and reeng ineering general terms reliability experimentation human factors keywords spreadsheet a mbiguous c omputation s mell r epair .
introduction spreadsheets are generally developed and maintained by end users who are not familiar with appropriate software development pra ctice.
as a result spreadsheets have been found to be error prone .
spreadsheet e rrors can induce great financial losses .
various techniques have been proposed to improve the quality of spreadsheets .
some e xamples include testing error or smell detection and debugging .
a spreadsheet comprises tables of c ells arranged in rows and co lumns.
we refer to a cell cluster as a cell array when it is subject to the same computational semantics.
for example the cells in figure b refer to the semantic s of total and un iformly follow a formula pattern of d i b i c i where i .
in general c ell arrays can be specified manually or with tool assi stance .
in this paper we focus only on those cell arrays subject to computational semantics expressed in formula patterns without using if conditions .
our empirical study report s that t here are altogether cell array s among out of sprea dsheets in the euses corpus .
this indicates that cell array s are common in real life spreadsheets.
s preadsheet smells can occur due to a distortion of or an amb igu i ty in the meaning of data or formulas .
sp readsheet sof tware like excel provides two useful features copy and paste and auto fill to reduce the chances of introducing smells during the creation of new cells in a cell array.
both features can help aut omatically deduce a formula pattern from selec ted sample cells and apply it to the new cells in a cell array .
although the two features provide convenience in editing sprea dsheet s their application is restrictive in the sense that end users have little control on the formula pattern deduction process .
they may not even be aware of deduced formula pattern s .
after editing t here is no record in the new cells that they have been created using the se two features and therefore have to be un iformly mo dified in future .
little provision is offered to warn end users from modifying these cells arbitrarily.
in principle all cells in a cell array should prescribe the same computational semantics.
a cell array is said to suffer from an ambiguous computation smell when there is more than one computational semantic among the cells it contains.
ad hoc modification s to these cells are one major cause of ambiguous computation smell s. for example t he cell array in figure a could be a consequence of ad hoc cell modifications that result in four different formu la patterns leading to an ambiguous computation smell .
note that no warning can be raised by spr eadsheet software to alert end users of such a smell.
this s mell can exist for a long time and even be replicated to ot her spreadsheet s without being discovered.
even though this cell array currently offers a correct value in each cell it is error prone and susceptible to develop ing errors upon future data updates .
for example the value in d2 would be incorrect if the value of c2 is later updated to .
as ambiguous computation smell s are vulner able to errors their early detection is important .
it is particularly the case for those spreadsheets subject to liability consequences such as company reports for release to authorized third parties.
spreadsheet software like excel provides a mechanism to detect cells with inappropriate formulas.
however the detection is appl ipermission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full cit ation on the first page.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
icse may june hyderabad india .
copyright acm ... .
.
permission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
copyrights for components of this work owned by others than acm must be honored.
abstracting with credit is permitted.
to copy otherwise or republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
request permissions from permissions acm.org.
icse may june hyderabad india copyright acm ... .
cable cally inconsistent with th formulas of the two adjacent cells are syntactically consistent.
such in cannot be detected by either like semantic bugs in program to this involves knowledge of intended s quire inappropriate cell formulas is another non in this paper we focus on as well as detection and repair smell smell tional semantics appropriate from two observations have formula patterns modified arbitrarily share an equivalent formula pattern scribe a sub observations allow us to identify candidate cell arrays effectively using heuristics.
we tection ous computation smell existing work on appropriate formula pattern in a we evaluated o lyze putation smell formance of our smell with the evaluation in the euses corpus suffer which cover putation smell sheets smell computation smells previously can the quality of we summarize cable only to the cally inconsistent with th formulas of the two adjacent cells are syntactically consistent.
such excel is not able to in figure in figure a does not have cannot be detected by either .
like semantic bugs in program to identify which cell this involves knowledge of intended s quire s human judgment inappropriate cell formulas is another non in this paper we focus on as well as detection and repair smell s. in order to detect and smell s we need to know formula tional semantics appropriate formula from ambiguous computation smell two observations have the same computational formula patterns .
modified arbitrarily share an equivalent formula pattern scribe a sub or super observations allow us to identify candidate cell arrays effectively using heuristics.
we tection to a constraint satisfaction problem.
to repair a ous computation smell existing work on appropriate formula pattern in a n array that suffers we evaluated o ur lyze d the euses corpus putation smell s can formance of our smell s .
second we with real life spreadsheets the institute of software chinese academy of sciences evaluation report in the euses corpus suffer which cover .
putation smell s reveal weakness and sheets .
from randomly sampled smell s error computation smells previously created can help end users the quality of their we summarize main contributions of this paper we propose a new ambiguous computation smell we propose a ambiguous computation smell that are subject to the same computation the se cells formula patterns and synthesi zing we evaluate our tool euses corpus and real e xperimental results are common and the situation where cally inconsistent with th ose of its two adjacent cells and b the formulas of the two adjacent cells are syntactically consistent.
is not able to ra ise figure a .
since each cell in the cell array does not have any cannot be detected by ucheck like semantic bugs in program ming identify which cell s contain inappropriate formula this involves knowledge of intended s human judgment s or specification inappropriate cell formulas is another non in this paper we focus on automated identification of cell arrays as well as detection and repair in order to detect and s we need to know formula tional semantics in cell array s .
the key formula pattern s for ambiguous computation smell two observations c onsecutive cells in a row computational semantics .
even if some cells modified arbitrarily a majority of share an equivalent formula pattern or super form of observations allow us to identify candidate cell arrays effectively using heuristics.
we then map ambiguous computation smell to a constraint satisfaction problem.
to repair a ous computation smell we propose an algorithm adapted fro existing work on program synthesis by jha et al.
appropriate formula pattern that generalizes that suffers from this smell ur technique from two perspectives the euses corpus to can occur and formance of our technique for detecting second we conduct ed a spreadsheets prepared of software chinese academy of sciences report s that .
in the euses corpus suffer from .
of identified reveal weakness and randomly sampled error s are found with these smells.
computation smells are often caused by created by auto fill and copy users detect and repair such smells thus their spreadsheet s .
main contributions of this paper we propose a new and common ambiguous computation smell we propose a novel technique computation smell that are subject to the same computation formula patterns zing new patterns to repair evaluate our tool implem euses corpus and real life spreadsheets xperimental results show that are common and indeed vulnerable to situation where a a cell s formula is syntact of its two adjacent cells and b the formulas of the two adjacent cells are syntactically consistent.
ise any warning since each cell in the cell array any unit or dimension erro ucheck and d imension ming languages contain inappropriate formula this involves knowledge of intended s emantics which often r or specification s .
automatic repair inappropriate cell formulas is another non trivial challenge.
automated identification of cell arrays as well as detection and repair ing of ambiguous computation in order to detect and repair ambiguous computation s we need to know formula pattern s that .
the key challenge for repair ing cell arrays that suffer ambiguous computation smell s .
our technique is based on onsecutive cells in a row semantics .
t hey likely some cells in a cell array have been majority of cells in this share an equivalent formula pattern and o ther form of th is formula pattern.
the observations allow us to identify candidate cell arrays effectively ambiguous computation smell to a constraint satisfaction problem.
to repair a we propose an algorithm adapted fro program synthesis by jha et al.
that generalizes the this smell as many as from two perspectives to learn how often and measured the precision and pe technique for detecting ambiguous computation a case study using prepared by budget finance officers of software chinese academy of sciences .
of spreadsheets from ambiguous computation smell identified cell arrays.
reveal weakness and have cause d randomly sampled true ambiguous computation with these smells.
caused by careless updates to cells and copy and paste detect and repair such smells thus main contributions of this paper as follows and common type of spreadsheet ambiguous computation smell which is error technique amcheck to computation smell s by identifying arrays of cells that are subject to the same computation al semantics formula patterns spotting incompatible patterns patterns to repair the smells.
implem entation experimentally spreadsheets used in practice that ambiguous computation smell vulnerable to error s .
cell s formula is syntact of its two adjacent cells and b the formulas of the two adjacent cells are syntactically consistent.
as for the cell array since each cell in the cell array unit or dimension erro r the smell imension inference it is hard contain inappropriate formula s because emantics which often r .
automatic repair ing trivial challenge.
automated identification of cell arrays ambiguous computation ambiguous computation capture comput challenge is how to infer cell arrays that suffer our technique is based on onsecutive cells in a row or column often likely share similar in a cell array have been this array could still ther cells could pr formula pattern.
the se two observations allow us to identify candidate cell arrays effectively ambiguous computation smell d to a constraint satisfaction problem.
to repair a n ambig we propose an algorithm adapted fro program synthesis by jha et al.
to infer an the for mulas of cells many as possible .
from two perspectives .
first we an often ambiguous co mthe precision and pe ambiguous computation using our technique finance officers of software chinese academy of sciences .
our spreadsheets with formulas ambiguous computation smell ambiguous co md errors in sprea ambiguous computation with these smells.
a mbiguous careless updates to cells paste .
o ur technique detect and repair such smells thus improv ing as follows spreadsheet smell error prone .
to detect and repair by identifying arrays of cells semantics inferring spotting incompatible patterns smells.
entation experimentally on the used in practice .
the ambiguous computation smell .
cell s formula is syntact iof its two adjacent cells and b the as cell array since each cell in the cell array r the smell hard because emantics which often r eof automated identification of cell arrays ambiguous computation ambiguous computation comput ais how to infer cell arrays that suffer our technique is based on often similar in a cell array have been could still pr etwo observations allow us to identify candidate cell arrays effectively d eambig u we propose an algorithm adapted fro m to infer an mulas of cells .
first we an amthe precision and pe rambiguous computation technique in our with formulas ambiguous computation smell s min sprea dambiguous computation mbiguous careless updates to cells technique ing smell repair by identifying arrays of cells inferring spotting incompatible patterns on the the ambiguous computation smell s the remainder of motivating example defines detection and repairing tation.
cusses related work and finally .
motivation in this section we an example we then .
example figure it exhibits missing formula smell curs when s such smell can be introduced to a ride the formula in a cell with ray1 an intended for like cells f2 f3 and f4 the values of computed by formulas.
inconsistent formula smell occurs when the cells in a cell array prescribe different formula patterns.
users specify without larray2 intended formula pattern of users may and thus at d2 and a la pattern.
a similar smell although cellarray2 and cellarray3 in ambiguous computation smell cells are appropriate.
however the smells can lead to and c9 if c2 problems to fill to would also a ny formula pattern a b a spreadsheet the remainder of th is motivating example and explains the use defines ambiguous computation detection and repairing tation.
evaluates amcheck cusses related work and finally motivation in this section we illustrate ambiguous computation smells using example spreadsheet then explain how to detect and repair example a is a spreadsheet exhibits two kinds of missing formula smell curs when s ome cells in a such smell can be introduced to a ride the formula in a cell with ray1 is subject an intended for mula pattern like cells f2 f3 and f4 the values of computed by formulas.
inconsistent formula smell occurs when the cells in a cell array prescribe different formula patterns.
such smell can specify the formula of a without realizing its computational semantic larray2 is subject to intended formula pattern of users may understand thus leave c2 empty.
and a s a result cellarray2 prescribe la pattern.
a similar smell although cellarray2 and cellarray3 in ambiguous computation smell cells are appropriate.
however the smells can lead to and c9 if c2 is updated problems can arise when to these cell arrays would also likely contain formula pattern that a a spreadsheet a spreadsheet without figure paper is organized as follows.
and explains the use ambiguous computation smell detection and repairing technique .
presents amcheck with real cusses related work and finally conclude motivation illustrate ambiguous computation smells using spreadsheet extracted from the to detect and repair spreadsheet comput ing two kinds of ambiguous computation smell missing formula smell .
this ambiguous computation smell in a cell array do not such smell can be introduced to a cell array ride the formula in a cell with a plain value is subject to the computation of mula pattern of f i d i like cells f2 f3 and f4 the values of computed by formulas.
inconsistent formula smell .
this ambiguous computation smell occurs when the cells in a cell array prescribe different formula smell can be introduced the formula of a cell in the its computational semantic is subject to the computation of intended formula pattern of d i b i that there is no orange c2 empty.
t hey specify a formula that s a result cellarray2 prescribe la pattern.
a similar smell also occurs to although cellarray2 and cellarray3 in ambiguous computation smell s the value cells are appropriate.
however the smells can lead to is updated later with a ny when end users apply cell arrays later .
a n ambiguous computation smell likely contain a n error e.g.
f7 that can lead to values in spreadsheet with ambiguous computation smells without ambiguous computation smells figure .
a m otivating example is organized as follows.
and explains the use of our technique smell .
proposes presents our tool with real life spreadsheets.
conclude s this paper.
illustrate ambiguous computation smells using extracted from the euses corpus to detect and repair the se smells.
ing monthly harvest of fruits.
ambiguous computation smell s ambiguous computation smell do not prescribe a cell array when end value .
for example computation of total price i e i where like cells f2 f3 and f4 the values of cells f5 f6 and f7 ambiguous computation smell occurs when the cells in a cell array prescribe different formula be introduced to a cell array the cell array inappropriately its computational semantic s .
for exam computation of total c i where no orange output in february hey specify a formula that s a result cellarray2 prescribe s more than one form to cellarray3 .
although cellarray2 and cellarray3 in figure a s the value s given by their cells are appropriate.
however the smells can lead to error ny non ze ro value.
apply copy and paste and a ambiguous computation smell e.g.
f7 if one is un values in such a cell with ambiguous computation smells ambiguous computation smells otivating example .
is organized as follows.
gives a technique .
proposes our smell our tool impleme nlife spreadsheets.
di sthis paper.
illustrate ambiguous computation smells using euses corpus .
harvest of fruits.
s ambiguous computation smell o cprescribe a ny formula.
end users ove rfor example cella rtotal price with i .
u nand f7 are not ambiguous computation smell occurs when the cells in a cell array prescribe different formula to a cell array when end inappropriately for exam ple ce ltotal with an i .
end in february hey specify a formula that ignores c2 more than one form ucellarray3 .
suffer from by their member error s in d2 ro value.
besides paste and a uambiguous computation smell one is un able to find cell array.
with ambiguous computation smells .
ambiguous computation smells .
.
several and repairing of we explain cell e.g.
of ly consider two formula patterns rived from these patterns offer the same computation and pattern for a cell array tern none of cells in e.g.
cell array d4 and d5 in cellarray2 array may even conflict with the our two steps.
underlying array mula pattern sis biguous computation smell cope with and struct repair also use its cell arrays.
.
in t explain smell .
a spreadsheet by two be partitioned into whether they contain formulas.
expression address be include basic opera spreadsheet software ly an express we define a dress