unbounded data model veri cation using smt solver s jaideep nijjar and tev kbultan university ofcalifornia santa barbar a jaideepnijjar bultan cs .ucsb .edu abstra ct thegrowinginfluence ofwebapplications ineveryaspectof societymakestheirdependabilit yanimmense concern.
a fundamen talbuilding blockofwebapplications thatusethe model view con troller mvc pattern isthedatamodel whichspecifies theobjectclasses andtherelations among them.
wepresen tanapproac hforunbounded automated verification ofdatamodelsthat1 extracts aformal data modelfromanobjectrelational mapping convertsverification queries aboutthedatamodeltoqueries aboutthe satisfiabilit yofformulasinthetheory ofuninterpreted functions and3 usesasatisfiabilit ymodulotheories smt solvertocheckthesatisfiabilit yoftheresulting formulas.
weimplemen tedthisapproac handapplied ittofiveopensource rails applications.
ourresults demonstrate thatthe proposedapproac hisfeasible andismore efficien tthan sat based bounded verification.
categories andsubject descriptors d. .
software program verification formal metho ds d. .
softwarearchitectures data abstr action general terms verification keywords unbounded verification mvcframew orks smt solvers .intr oduction thewebhasevolvedintoanubiquitous medium forcomputing andcomm unication services thatbothbusinesses and individuals relyonextensiv ely.there isreason tobeconcerned aboutthisever increasing reliance onwebapplications webapplication developmen tisanerror prone processthatproduces acomplicated distributed softwaresystemwithcomplex interactions among manycomponents.
moreo ver duetotheextensiv euseofscripting languages in permission tomakedigital orhard copies ofallorpart ofthisworkfor personal orclassroom useisgranted without feeprovided thatcopies are notmade ordistrib uted forpro t orcommercial advantage andthatcopies bear thisnotice andthefullcitation onthe rstpage.
tocopyotherwise to republish topost onserversortoredistrib utetolists requires prior speci c permission and or afee.
ase september essen german y copyright acm978 ... .
.
!
.
!
.
.
.
.
.
figure toolarchitecture webapplication developmen t static analysis ofwebsoftware isverydifficult.
onepositiveadvancemen tinwebapplication developmen t hasbeentheadoption ofthemodel view con troller mvc pattern .
manypopular webapplication developmen t framew orkssuchasrubyonrails rails forshort zend forphp cakephp django forpython andspring forj2ee arebased onthemvcpattern.
thispattern facilitates the separation ofthedatamodel model fromtheuserinterface logic view andthecontrolflowlogic controller .
the modularit yandseparation ofconcerns principles imposed bythemvcpattern provideopportunities fordeveloping customized verification andanalysis techniques.
ourworkfocuses ontheverification ofdatamodelsinweb applications.
adatamodelspecifies thetypesofobjects e.g.
user photo profile etc.
andtherelations among the objects e.g.
therelations betweenusers andphotos and profiles inawebapplication.
adatamodelalsospecifies constrain tsonthedatamodelrelations e.g.
therelation betweenusers andprofiles mustbeone to one .
inthispaperwepresen tanunbounded automated verification technique andtool figure fordatamodelverification ofmvc based webapplications.
mvc based frameworksuseanobject relational mapping orm tomapthe datarepresen tation ofthewebapplication totheback endpermission to make digital or hard copies of all or part of this work for personal or classroom use is granted without fee provided that copies are not made or distributed for profit or commercial advantage and that copies bear this notice and the full citation on the first page.
to copy otherwise to republish to post on servers or to redistribute to lists requires prior specific permission and or a fee.
ase september essen germany copyright acm ... .
database.
thefront end ofourtoolautomatically extracts aformal datamodelfromtheorm specification oftheinputwebapplication.
curren tly ourfront end onlysupports orm specifications ofrubyonrailswebapplications.
the back end ofourtoolconvertsverification queries toformulasinthetheory ofuninterpreted functions andthenuses asatisfiabilit ymodulotheories smt solvertodetermine thesatisfiabilit yofthequeries.
based ontheoutput ofthe smt solver ourtoolreportswhether thepropertyholds or fails andforfailing assertions italsoreportsadatamodel instance asacounter example.
oursmt based verification approac hdoesnotbound thesizesoftheobjectclasses or therelations soifourverification toolreportsthatanassertion holds itisguaran teedtoholdforanydatamodel instance.
weapplied ourapproac htofiveopen source rubyonrails applications andidentified avarietyofdatamodelerrors.
ourresults showthatourverification technique isfeasible anduseful inanalyzing real w orldapplications.
wealso compared theperformance ofourapproac hwithaboundedverification approac hbased onsatsolvers andourexperimentsdemonstrate that inaddition toguaran teeing correctness forverified properties whichisnotpossible with bounded verification surprisingly ourunbounded verificationapproac hismore efficien tthanbounded verification when theboundontheclasssizeexceeds .
ourcontributions inthispaperinclude anautomated translation ofdatamodelverification queries toformulasin thetheory ofuninterpreted functions.
anewdatamodel verification technique formvc based webapplications that usessmt solversandcanhandle unbounded datamodels.
atechnique forreducing thesizeofthedatamodelspecification byprojecting itbased onthepropertythatisbeing verified.
experimen talevaluation oftheproposedapproachonfivereal w orldapplications.
therestofthepaperisorganized asfollows section 2discusses datamodelsinwebapplications andgivesaformalization ofthedatamodelverification problem.
section presen tsthetranslation ofdatamodelverification queries tothetheory ofuninterpreted functions.
section 4explains ourdatamodelprojection technique.
section 5presen tsour experimen talresults.
related workisdiscussed insection andsection 7concludes thepaper.
.web applica tion datamodels thedatamodelforms thefoundation ofanmvc based web application.
anyerrorinthisfoundation canhaveasignificantimpact ontheentireapplication.
thedatamodelprovides anabstraction betweentheapplication codeandthe backenddatastore inawebapplication.
typically fromthe backenddatastore s pointofviewthedataisstored inarelational database whereas fromtheperspectiveoftheapplication codethedataisrepresen tedusing anobject orien ted datamodel.theorm provided bythemvc based web application developmen tframew orkshandles thetranslation betweenthese twoviews sothattheapplication codeand thebackenddatastore caninteract witheachother while preserving theirownviews ofthedata.
class user activerecord base has and belongs to many roles has one profile dependent destroy has many photos through profile end class role activerecord base has and belongs to many users end class profile activerecord base belongs to user has many photos dependent destroy has many videos dependent destroy conditions format mp4 end class photo activerecord base belongs to profile has many tags as taggable end class video activerecord base belongs to profile has many tags as taggable end class tag activerecord base belongs to taggable polymorphic true end figure adatamodelexample theorm usedintherubyonrails framew orkiscalled activerecords.
figure 2showsasimple activerecords specification forasocialnetworking application where users haveprofiles whichstore theirphoto andvideo files.
the photos andvideos canbetagged byusers andusers can havedifferen troles.
below weexplain differen ttypesof declarations supported byactiverecords using thisexample andwediscuss howthesedeclarations canbeformalized asrelational constrain tsonaformal datamodel.
wedefine adatamodelasatuple m angbracketlefts c d angbracketrightwhere sis thedatamodelschema identifying thesetsandrelations of thedatamodel cisasetofrelational constrain ts and d isasetofdependency constrain ts.theschema sidentifies thenames oftheobjectclasses andthenames anddomains oftherelations inthedatamodel.forexample theschema fortheexample showninfigure 2willidentifythefollowing setofobjectclasses user role profile photo video tag andtherelations among these objectclasses photo profile photo tag photo user profile user profile video role user tag video therelational constrain tsincexpress theconstraintsontheserelations thatareimposedbytheirdeclarations.
ifagivenrelation rsatisfies agivenconstrain t then wewouldstatethat r c. basic relation declar ations.
rails supportsthree basic typesofrelations among objects one to one one tomany and3 many to many .thehas one andbelongs to declarations inlines3and10infigure 2define aone to one relation betweentheuserandprofile classes.
more accurately thisisaone to zero or one relation anditdeclares thateachuserobjectmustbeassociated withzeroorone profile object andeachprofile objectmustbeassociated withexactly oneuserobject.inorder toformalize thisrelation asaconstrain t letususe ouand optodenote theset ofobjectsfortheuserandprofile classes and ru ptodenotetherelation betweenuserobjectsandprofile objects.211then theconstrain tthatcorresp ondstothisrelation isformalized as p op u ou u p ru p p p prime op u ou u p ru p u p prime ru p p p prime p op u u prime ou u p ru p u prime p ru p u u prime next letusconsider theone to man yrelation betweenthe profile andphoto classes whichisdeclared intherails datamodelinfigure 2using thehas many andbelongs to declarations inlines11and16.using opand ophtodenote thesetofobjectsfortheprofile andphoto classes and rp ph todenote theprofile photo relation theformal datamodel constrain tthatcorresp ondstothisdeclaration is ph oph p op p ph rp ph p p prime op ph oph p ph rp ph p prime ph rp ph p p prime finally amany to man yrelation canbeexpressed inrails using thehas and belongs to many declaration onbothsides oftherelation asshowninlines2and7infigure .this declares amany to man yrelation betweentheuserandrole classes.
forsuchdeclarations wedonothavetocreate any additional constrain tssinceanyrelation isamany to man y relation.
extensions.
rails provides asetofoptions thatcanbe usedtoextend thethree basic relations mentioned above.
thefirstoption isthe through option forthehas many and has one declarations.
the through option enables thedeclaration ofnewrelations thatarethecomposition oftwo other relations.
consider line4infigure 2whichendswith through profile anddeclares arelation betweenuser andphoto objects.
when thisdeclaration iscombined with thedeclarations oftherelation betweenuserandprofile objects lines 3and10 andprofile andphoto objects lines and16 itspecifies thattherelation betweentheuserand photo objects ru ph isthecomposition oftherelations betweentheuserandprofile objects ru p andtheprofile andthephoto objects rp ph .thiscanbeformalized as u ou ph oph u ph ru ph p op u p ru p p ph rp ph thesecond option thatcanbeusedtoextend relations isthe conditions option whichcanbesetonallofthefourdeclarations has one has many belongs to and has and belongs to many .the conditions option limits the relation tothose objectsthatmeetacertain criteria.
forexample based ontherelation declaration inlines12and13in figure video objectsareonlyrelated toaprofile objectif theirformat fieldismp4.
note thatthecondition statemen t needs tobeintheformofthewhere clause ofasql query.
theformalization ofthisconstrain tdefines asetof objects ov prime thatisasubset ofthevideo objects ov corresponding tovideo objectswithformat field mp4 and restricts therelation betweentheprofile andvideo objects rp v tothatsubset.
formally ov prime ov p op v ov p v rp v v ov prime rails alsosupportsthedeclaration ofpolymorphic associations.
thisissimilar totheideaofinterfaces inobject orienteddesign where dissimilar things mayhavecommon characteristics thatareembodiedintheinterface theyimplemen t.inrails polymorphic associations aredeclared by setting the polymorphic option onthebelongs to declarationandthe asoption onthehas one orhas many declarations.
weseetheuseofthe polymorphic option infigure betweentags photos andvideos lines .photos andvideos donothaveasub class relationship butthey bothcanhavetags.theuseofthe polymorphic option in thetagclasscreates arelationship whichallowsanyclassto actasataggable objectandrelate tothetagclassviathis relation.
thisisformalized bydefining asetofobjectsfor thesupersetandthenexpressing inheritance using subset constrain ts.fortheexample above wedefine anewsetof objectscalled taggable ot thesuperset anddeclare that video objects ov andphoto objects oph aremutually exclusiv esubsets ofthetaggable objectsasbelow.then a relation canbeformally specified betweentagandtaggable objectsusing ideas discussed earlier.
ov ot oph ot ov oph dependency constr aints.
thefinalrails construct we wanttodiscuss addssome dynamism tothedatamodel.
itallowsthemodeling ofobjectdeletion atthedatamodel level.therails construct forthisisthe dependent option whichcanbesetforalltherelation declarations except has and belongs to many .normally when anobjectis deleted itsrelated objectsarenotdeleted.
however bysettingthe dependent option to destroy or delete delete all forhas many deleting anobjectwillalsodelete theassociated objects.
although there areseveraldifferences between destroy and delete theonethatisimportantfor ourpurposesisthat delete willdirectly delete theassociated objectsfromthedatabase without looking attheir dependencies whereas destroy firstcheckswhether theassociated objectsitselfhasassociations withthe dependent option set.
infigure 2weseethattheuserclasshasthe dependent option setfortherelation withtheprofile class line3 .
thus when auserobjectisdeleted theprofile objectthat isassociated withthatuserwillalsobedeleted.
further sincethe dependent option issetto destroy anyrelations oftheprofile classwiththe dependent option setwillcause those associated objectstobedeleted aswell.
formal modeling ofthedependency constrain tsrequires us tomodelthedelete operation.
consider therelation between theuserandprofile objects.
inorder tomodelthedelete operation wehavetospecifythesetofuserobjects the setofprofile objectsandtherelation betweentheuserand profile objectsbothbefore andafterthedelete operation ou o prime u op o prime p ru p and r prime u p respectively .
then we212needtospecifythatwhen auserobjectisdeleted theprofile objectsrelated tothatuserarealsodeleted.
formally o prime p op o prime u ou r prime u p ru p u ou u negationslash o prime u u prime ou u prime negationslash u u prime o prime u p op u p ru p p negationslash o prime p p op u p negationslash ru p p o prime p u prime ou p op u prime p ru p u p negationslash ru p u prime p r prime u p theconstructs wehavediscussed aboveformtheessence ofrails datamodels.similar constructs arealsosupported byother orms suchascakephp whichhastheequivalent ofthefourbasic rails association declarations andalldeclaration options except forthe polymorphic anddjango whichhastheabilitytocreate allthree basic relations and through relations likeinrails butnoneoftheremaining features.
using suchconstructs adevelopercanspecify complex relations among objectsofanapplication.
since atypical application wouldcontaindozens ofobjectclasses withmanyrelations among them itispossible tohaveerrorsandomissions inthedatamodelspecification thatcan result inunexp ected behaviorsandbugs.
hence itwouldbe worthwhile toautomatically verifythedatamodels.below weformalize thedatamodelverification problem.
formalizing veri cation queries.
inorder toformalize verification queries wefirstdefine datamodelinstances and whatitmeans forthedatamodelinstance tosatisfy agiven setofdatamodelconstrain ts.
adatamodelinstance isatuple i angbracketlefto r angbracketrightwhere o o1 o2 ...ono isasetofobjectclasses and r r1 r2 ...rnr isasetofobjectrelations andforeachri rthere exists oj ok osuchthat ri oj ok. givenadatamodelinstance i angbracketlefto r angbracketright wewrite r cto denote thattherelations inrsatisfy theconstrain tsinc.
similarly giventwoinstances i angbracketlefto r angbracketrightand i prime angbracketlefto prime r prime angbracketright wewrite r r prime dtodenote thattherelations inrand r primesatisfy theconstrain tsind.
adatamodelinstance i angbracketlefto r angbracketrightisaninstanc eofthedata model m angbracketlefts c d angbracketright denoted byi m ifandonlyif1 thesetsinoandtherelations inrfollowtheschema s and2 r c. givenapairofdatamodelinstances i angbracketlefto r angbracketrightand i prime angbracketlefto prime r prime angbracketright i i prime isabehavior ofthedatamodel m angbracketlefts c d angbracketright denoted by i i prime mifandonlyif1 oand rand o prime and r primefollowtheschema s r cand r prime c and3 r r prime d. givenadatamodel m angbracketlefts c d angbracketright wewilldefine fourtypes ofproperties state assertions denoted byas these areproperties thatweexpecttoholdforeachinstance of thedatamodel behavior assertions denoted byab these areproperties thatweexpecttoholdforeachpairof instances thatformabehaviorofthedatamodel state predicates denoted byps these arepredicates weexpect toholdinsome instance ofthedatamodel and finally behavior predicates denoted bypb these arepredicatesweexpecttoholdinsome pairofinstances thatform a behaviorofthedatamodel.wewilldenote thatadata modelsatisfies anassertion orapredicate asm aor m p respectively.then wecanusethefollowingformal definitions forthese fourtypesofproperties m as i angbracketlefto r angbracketright i m r as m ab i angbracketlefto r angbracketright i prime angbracketlefto prime r prime angbracketright i i prime m r r prime ab m ps i angbracketlefto r angbracketright i m r ps m pb i angbracketlefto r angbracketright i prime angbracketlefto prime r prime angbracketright i i prime m r r prime pb toperform verification ofdatamodels weusetheformalization presen tedabovetoconvertverification queries about thedatamodeltosatisfiabilit yofformulasinthetheory of uninterpreted functions.
wethenuseansmt solvertoanswertheverification queries aswediscuss next.
.transla tion tosmt smt lib isthestandard input language forsmtsolvers .
wehaveimplemen tedatranslator thattakesrails active record filesdescribing thedatamodelasinput andgenerates ansmt lib specification forthedatamodel.the generated smt lib specification consists ofaconjunction of constrain tsinthetheory ofuninterpreted functions.
inthis section wedescrib ehowdifferen tactiverecord constructs thatdefine thedatamodelcanbetranslated toconstrain ts inthetheory ofuninterpreted functions.
smt lib specifications arewritten assequences of s expressions.
uninterpreted functions aredeclared using thedeclare fun command andtypesaredeclared using the declare sort command.
forexample thespecification declare sort video declare fun ismp4video video bool declares avideo type thattakes0parameters andaboolean function calledismp4video thataccepts avalueoftypevideo.
smt lib supportsthebasic boolean operators not and or equalit y implication andif then else ite .
quantifiers areexpressed using theforall andexists operators.
constrain tsarespecified using thekeywordassert .
after thisshort overview ofthesmt lib language syntax wenowexplain howwetranslate theformal modelconstraintsdiscussed insection 2tosmt lib.
letusfirstconsiderconstrain t fromsection 2whichcharacterizes the seman ticsofaone to man yrelation declaration.
wetranslatetheone to man yrelation betweentheprofile andphoto classes tosmt lib using anuninterpreted function as declare sort profile declare sort photo declare fun profile photo photo profile where aphoto andaprofile objectarerelated ifandonlyif theprofile photo function maps onetotheother.
constrain t insection 2represen tstheseman ticsofaoneto one relation declaration.
wetranslate sucharelation to213smt lib using anuninterpreted function likeabove but adding anextra constrain trestricting thecardinalit yofthe relation.
forexample theone to one relation betweenuser andprofile istranslated as declare sort user declare sort profile declare fun user profile profile user assert forall p1 profile p2 profile not p1p2 not user profile p1 user profile p2 notethattheaboveconstrain tspecifies eachuserisassociated withoneornoprofile andeachprofile isassociated withexactly oneuserasweexpectbased ontheseman tics oftheone to one relation declaration.
since uninterpreted functions mapeachinput valuetoasinglevalueintherange itisnotpossible torepresen tamanyto man yrelation betweentwosetsusing anuninterpreted function withoneparameter aswedidfortheone to one andone to man yrelations.
instead wetranslate amanyto man yrelation declaration tosmt lib bydeclaring an uninterpreted boolean function withtwoargumen tsthatreturns trueifandonlyifthetwoobjectspassed inasargumentsarerelated.
forinstance amany to man yrelation betweentheuserandroleclasses istranslated as declare sort user declare sort role declare fun user role user role bool asdiscussed insection relations thatarethecomposition ofother relations canbedeclared inadatamodelusing the through keywordandconstrain t providesaformalization ofsuchdeclarations.
forexample assume thatusers are associated withprofiles profiles areassociated withphotos andthedatamodeldeclares athird relation betweenusers andphotos suchthatitisthecomposition oftheother two relations.
thisistranslated tosmt lib as1 declare sort profile declare sort photo declare sort user declare fun profile photo photo profile declare fun user profile profile user declare fun user photo photo user assert forall u user ph photo iff u user photo ph exists p profile and u user profile p p profile photo ph the conditions option isusedtoexpress arelationship betweenonesetofobjectsandthesubset ofanother setofobjectsandisformalized inconstrain t ofsection .since there isnosupportforsubtyping orinheritance inthesmtliblanguage wemodelthe conditions option bycreating aboolean function thatreturns trueifandonlyiftheargumentobjectisinthedesignated subset.
togiveaconcrete example sayvideos areassociated withaprofile onlyif theprofile isactive.thesmt lib translation ofsucha declaration wouldbe 1theifandonlyifoperator iff isusedhereforclarity.
thiscaneasily beconverted intoadouble implication to conform totheofficial smt lib setofoperators.
declare sort video declare sort profile declare fun isactive profile bool declare fun activeprofile video profile video assert forall p profile v video v activeprofile video p isactive p here theisactive function isusedtocharacterize thesubset ofprofiles thatareactive andthefinalconstrain tensures thatthefunction activeprofile video onlyreturns active profiles.
next railsactiverecords supportthespecification ofpolymorphic relations asdiscussed insection 2andformalized in constrain t .inorder foronetypetoberelated tomultiple other types onecancreate asupertypethattheformer type canrelate to.forexample ifatagcanberelated toboth photos andvideo wecancreate asupertypeofphoto and video thattagcanberelated to.letuscallthissupertype taggable andletphoto andvideo besubtypesofit.as mentioned earlier smt lib doesnotsupportsubtyping so weuseboolean functions tomodelsuchadeclaration.
we alsoaddaconstrain tthatstates thetaggable typeisabstract i.e.alltaggable objectsareeither photos orvideos andthatthese subtypesaremutually exclusiv e declare sort tag declare sort taggable declare fun isphoto taggable bool declare fun isvideo taggable bool assert forall t taggable and or isphoto t isvideo t iff isphoto t not isvideo t declare fun taggable tag tag taggable thisexample showsasimple caseofpolymorphic relations.
ingeneral aclassmaybepolymorphically related tomultipleclasses.
forinstance multimedia mayhaveapolymorphicrelation withthevideo andaudio classes.
combined withthescenario above video willnowrequire twosupertypes saytaggable andmultimediaitem .
inourtoolwe actually create oneultimate supertypecalled polymorphicclass ofwhichanypolymorphically related typesaresubtypes suchasphoto video andaudio aswellastheir supertypes taggable andmultimediaitem .
allthese subtypesareexpressed insmt lib language using boolean functions.
then anassert isadded whichcontains constraintsspecifying whichtypesaresubtypesofwhichsupertypes thatsubtypesaremutually exclusiv eofothers inthe samesupertype thatthesupertypesthemselv esareabstract meaning allelemen tsbelong tooneofitssubtypes and thatpolymorphicclass isalsoabstract.
furthermore since subtypes suchasphoto andvideo arenottypesoftheir own i.e.nosortisdeclared forthem anynon p olymorphic relations withthese classes require anassert thatenforces therange ofthefunction similar toconstrain t .
finally letusdiscuss delete dependencies thataredeclared using the dependent option andformalized withconstrain t insection .thistypeofconstrain texpresses achange fromonestateofthemodel beforeanobjectisdeleted to another thestateofthemodelaftertheobjectdeleted i.e.
post delete state .
wemodelthepost delete stateinsmtlibtranslation using boolean functions denoted withthe prefix post .there isonesuchfunction foreverytype.214thisfunction returns trueiftheobjectexists afterthedelete operation.
forexample declare sort user declare fun post user user bool there isalsoonesuchboolean function foreveryrelation.
thisfunction returns trueifandonlyifthetwoobjectsare stillrelated afterthedeletion occurs.
forinstance declare fun user profile profile user declare fun post user profile profile user bool when onewantstoperform averification query abouthow thedeletion ofanobjectaffects other objectsandrelations theseboolean functions areusedtoexpress theproperty.for example toexpress apropertyaboutdeleting auser our translator generates aconstrain tthatdefines thepostobject functions aswellasthepostrelation functions according to thedependencies expressed inthedatamodel.thealgorithm togenerate thistakesintoaccoun ttheeffect ofdependencies ontransitiv e conditional andpolymorphic relations.
ouralgorithm assumes nocyclic delete dependencies.
encodingcyclic dependencies requires transitiv eclosure which isnotexpressible inthetheory ofuninterpreted functions.
hereistheconstrain tgenerated byourtranslation algorithm forthesimple user profile scenario ofdeleting auser where xdenotes theuserbeingdeleted assert not forall x user and forall a user ite ax not post user a post user a forall b profile ite x user profile b not post profile b post profile b forall a profile buser ite and b user profile a post profile a post user profile ab not post user profile ab remaining property specific constraints gohere .datamodel projection ourtoolchecksthecorrectness ofeachverification query separately andthiscreates anopportunit yforreducing the sizeofthegenerated smt lib specifications.
reducing the sizeofthegenerated smt lib specifications reduces the costofthesatisfiabilit ycheckandhence increases theperformance ofourtool.thebasicideaisthefollowing given apropertytoverify wecanreduce thesizeofthegeneratedsmt lib specification byremovingthedeclarations andconstrain tsabouttheparts ofthedatamodelthatdoes notdependonthepropertythatweareplanning toverify.
wecallthistechnique property b aseddata modelprojection.
weformally define theproperty based datamodelprojectionasafunction denoted by thattakesadatamodel andapropertyasinput andreturns anewdatamodel.
hence givenadatamodel m angbracketlefts c d angbracketrightandapropertyp m p mpwhere mp angbracketlefts cp dp angbracketrightistheprojected data modelsuchthat cp cand dp d.notethattheprojectionfunction removessomeoftherelational anddependency constrain tsfromthemodel therefore reducing thesizeofthe projected model.ifthepropertypisastateassertion ora statepredicate denoted byasand psinsection then theprojection function removesallthedependency constraints i.e.
dp sincedependency constrain tsareonlyalgorithm 1datamodelprojection algorithm input model rails activerecords files p property delclass the classname forthedeleted object only needed when pisabehavior assertion orpredicate output projected smt lib specification pclasses listofclasses mentioned in p prelations listofrelations mentioned inp ifpisabehaviorassertion orpredicate then followdependencies fordelclass withrespecttotherelations giveninprelations addanydependen tclasses andtherelations through which theyaredependen t topclasses and prelations end if forallclassinpclasses do output anuninterpreted function declaration andpostfunction declaration forclass ifthere exists arelation inprelations thathasaconditional relation with class then output aboolean function declaration thatmodelstheconditional subset end if end for output thepolymorphic constrain tsforthepolymorphic classes in pclasses forallrelation inprelations do output afunction declaration anyassociated constrain tsbased onthedeclaration oftherelation andthepostfunction declaration forthe relation ifrelation isatransitiv erelation thatisthecomposition of multiple relations then output function declarations associated constrain ts and postfunction declarations forallrelations thatarepartofthecomposition end if end for relevantforbehaviorassertions andpredicates denoted by aband pbinsection .
akeypropertyoftheprojection function isthatitpreservesthecorrectness oftheinput property.formally m p m p p foranypropertyp.
letusnowexplain whythispropertyholds.
inourverification approac h allverification queries aretranslated to satisfiabilit yqueries.
hence theabovepropertyisequivalenttostating thatthesmt lib specification wegenerate fromtheoriginal model mandthepropertypissatisfiable ifandonlyifthesmt lib specification wegenerate from theprojected model m p andthepropertypissatisfiable.
notethat ifthesmt lib specification wegenerate fromthemodel m p andthepropertypisnotsatisfiable thenthesmt lib specification wegenerate fromtheoriginalmodel mandthepropertypcannot besatisfiable since theprojection operation m p onlyremovesconstrain ts resulting inalessconstrained smt lib specification.
however ourprojection algorithm alsoguaran teesthatifthe smt lib specification wegenerate fromthemodel m p andthepropertypissatisfiable thenthesmt lib specification wegenerate from theoriginal model mandthe propertypisalsosatisfiable.
thisistrueduetotworeasons theconstrain tsthattheprojection function deletes fromtheoriginal modelcanneverbeself con tradictory since theycorresp ondtoclassandrelation declarations anditis notpossible todeclare aself con tradictory datamodelthat doesnotallowanyinstances using theconstructs weanalyze theconstrain tsthattheprojection function deletes fromtheoriginal modelcannot contradict withtheverified propertypsincetheprojection algorithm onlydeletes aclass215orarelation ifthatclassorrelation hasnoinfluence onthe propertyp.
weimplemen tedthisproperty based datamodelprojection aspartofourverification tool.thealgorithm usedisgiven inalgorithm .itrequires asinput therails datamodel andthepropertytheuserwishes toverifyaboutthedata model.ifthepropertyisabehaviorpredicate orassertion italsorequires theclassname fortheobjecttobedeleted.
theprojected smt lib specification output bythetranslatorcontainsconstrain tsononlythose classes andrelations thatareexplicitly mentioned inthepropertyandtheclasses andrelations thatarerelated tothem based ontransitiv e relations dependency constrain tsorpolymorphic relations.
.experiments weusedfiveopen source rubyonrailswebapplications for evaluating theeffectiv eness ofoursmt based unbounded datamodelverification approac h.wewrote tenproperties abouteachapplication s datamodelthatweexpected to holdbased ontheseman ticsoftheapplication.
then using ourtool wegenerated ansmt lib specification foreach application.
thisspecification isconjoined withaproperty andthensenttothesmt solverforsatisfiabilit ycheck.
weusedmicrosoft s smtsolver z3 inourexperimen ts.
inaddition toreturning unsatisfiable orsatisfiable ansmt solvermayalsoreturn unkno wn oritmaytimeout since thequantified theory ofuninterpreted functions isknownto beundecidable .inourexperimen tsthetimeout limit wassettofiveminutes.
assertions thatareverified using ourapproac hareguaranteedtoholdintheapplication.
however assertions that failmayormaynotholdintheapplication the verification results simply indicate thatthepropertywasnotenforced bytheapplication s datamodel.itmaynotbepossible to observ ethefailure during program execution sincethepropertymayactually beenforced inpartsoftheapplication that wedonotmodel e.g.
inthecontroller code .however we consider afailed propertyadatamodelerroriftheproperty could havebeenenforced statically inthedatamodelbut wasnot.ontheother hand ifafailed propertycannot be enforced inthedatamodelusing therubyonrails constructs thenwedonotconsider itadatamodelerror.
thus forproperties thatfailed weperformed further manualinvestigation toidentifywhichfailing properties wereindeed datamodelerrors.
theapplications.
table1liststhesizesofthefiveapplications interms oflinesofcode thenumberofclasses and thenumberofdatamodelclasses.
opensourcerails osr ensourcerails.com isasocialprojectgallery application thatallowsusers tosubmit projects aswellas bookmark andratethem.
tracks tracks.org isanapplication thatletsusers create andmanage to do lists where listscanbeorganized bycontextandproject.
fatfreecrm isacustomer relationship managemen tsoftwarethatorganizes abusiness customers campaigns opportunities and accoun ts.
substruct de.google.com p substruct isanecommerce application where userscanaddproducts tocartandcreate wishlists.
lovdbyless vdbyless.com isasocialnetworking sitewiththeusual features suchas userprofile withpictures becoming friends etc.
table1 sizesoftheapplications loc classes datamodels lovdbyless tracks osr fatfreecrm substruct veri cation results.
theproperties wecheckedonthese applications arelisted intable2 along withtheirtypefrom section .
theresults oftheverification arealsoshownintable2.
checkindicates thatthepropertywasverified and indicates thatitfailed.
atotalofsixteen properties wetriedtoverify failed.
weinvestigated eachofthese failures manually to determine iftheycorresp ondtodatamodelerrors.
forexample propertyl5fromlovdbyless doesnothold duetothelimited expressiv eness inrails constructs.
there isnoconstruct thatallowsyoutoaddaconstrain ttoa relation expressing thatanobjectcannot berelated toitself.
thustheapplication programmer inlovdbyless hadtoadd avalidation function tothemodeltoensure thatauser cannot create afriend request forherself.
thusthefailure ofthepropertyl5doesnotindicate adatamodelerror.
another propertythatfailed waspropertyo2.thesetup inopensourcerails isthatausercanbookmark projects soauserhasmanybookmarks abookmark belongs toa project andaprojecthasmanybookmarks.
theproperty o2states thatauserisallowedtobookmark aprojectat mostonce.
however thedeclarations usedtosetuptheserelationships allowthesameusertocreate multiple bookmarks withthesame project.
thustheapplication programmer hadtoenforce thispropertyusing theuserinterface andcode inthecontroller.
however what theprogrammer desires is amany to man yrelationship betweenuserandproject as opposedtotwoone to man yrelationships.
onereason for suchasetup isiftheywantedtoholdextra information in thebookmark class.
investigation intothisclassshowsthat thisisnotthecase hence thiscorresp ondstoadatamodel errorinthisapplication.
afailing propertyindicates theapplication s datamodel doesnotsatisfy theproperty however thepropertymay stillholdintheoverallapplication because thepropertyis beingenforced outside ofthedatamodel asinpropertyo2.
however thiswasnotthecaseforpropertyo6.thispropertyfailed because thedeclaration intheusermodeldoes nothavethe dependen toption set.thusauser s associatedbookmarks arenotdeleted causing thepropertyto fail.because thedeletion ofauserleavesorphaned bookmarks inthedatabase propertyo6isanexample ofadata modelerrorthatisalsoanerrorintheapplication.
intotalwediscoveredelevendatamodeling errors fromthe sixteen properties thatfailed.
there weretwodatamodel216errors inlovdbyless three eachintracksandosr onein substruct andtwoinfatfreecrm.
thefactthatwewere abletodiscoverdatamodelerrors inreal w orldapplications isevidence thatourapproac hcanbeaneffectiv everification approac hinpractice.
performance.
tofurther evaluate theeffectiv eness ofour approac h wemeasured performance oftheverification task.
specifically wemeasured theverification timereported by z3andthenumberofvariables andclauses produced in thesmt specification.
bynumberofvariables wemean thenumberofsorts functions andquantified variables.
by numberofclauses wemean thenumberofasserts quantifiers andoperations inthesmt lib specification.
themeasuremen tsweretakenforthesmt lib specification generated foreachproperty.thevalueswerethenaveraged overtheproperties foreachapplication.
theresults forthe verification times aregivenintable3.what weimmediately noticed isthattheverification isextremely fast the longest verification timeisjust0.
seconds.
onething to noteisthatthese values donotinclude thetimes forthose properties thattimed outduring verification.
there were foursuchproperties allforfatfreecrm.
soalthough unbounded verification isveryquick thedisadv antageisthat some properties maynotgiveananswertotheverification query.
thedifficult ythesmt solverishavingwhen ittimes outis duetothenumberofquantifiers inthesmt specification.
tominimize thisnumberwerantheexperimen tsagain this timeusing thedatamodelprojection algorithm discussed in section .with projection wewereabletoobtain answers toalloftheproperties thattimed out.furthermore the verification timedecreased forallproperties asshownin table3.onaverage theverification timedecreased by40 afterusing datamodelprojection.
tocompare effectiv eness betweenbounded andunbounded verification weused thealloyanalyzer toverify thesame setofproperties.
thedatamodelsofallfive applications wererunthrough theactiverecord toalloy translator thatwasimplemen tedinourprevious work .
thesamemeasuremen tsweretakenaswithz3 butoveran increasing bound fromatmost10objectsforeachclassto atmost35objectsforeachclass.
these valueswereplotted alongside thez3verification timeforeachapplication where thesolverdidnottimeout.asseeninfigure unbounded verification ismuchfaster thanbounded verification even forthesmallest bound of10objects.
bounded verification using alloytookuptotensofseconds whereas z3 tookless thanasecond.
however sincez3isnotguaran teedtoterminate because wearegenerating smt lib specifications inthetheory ofuninterpreted functions withquantification weobserv ethatbounded andunbounded verification canbe complemen taryapproac hessince bounded verification can beusedwhen theunbounded approac hfails.
since alloyspecializes intheverification ofobjectmodels itisrather surprising thatthere issuchadrastic difference betweentheverification times ofz3andalloy.there may beseveralreasons whyunbounded verification didsowell.table2 verification results lovdbyless prop erties asl1.aforum postisalwaysassociated withatopic check psl2.aforum topicmayhavenoforum posts check asl3.aphoto isalwaysassociated withauserprofile check asl4.profile s feeditems profile s feed sfeeditems check asl5.ausercan tbeherownfriend abl6.deleting userprofile deletes photos abl7.deleting userprofile doesn tdelete anyfriends check abl8.deleting auserprofile leavesnoorphan users abl9.deleting amessage doesn tdelete auser check abl10.deleting aforum topicleavesnodangling forum posts check tracksprop erties ast1.everytodohasacontext check pst2.acontextmayhavenotodos check pst3.todocanhavenoassociated project ast4.note s user note s project s user ast5.everyuserhasapreference abt6.deleting aprojectleavesnodangling notes check abt7.deleting apreference leavesnoorphan users abt8.deleting auserleavesnodangling contexts check abt9.deleting auserleavesnodangling projects check abt10.deleting acontextleavesnodangling todos check osr prop erties pso1.aprojectcanhavemultiple screenshots check pso2.ausercanbookmark aprojectatmostonce pso3.ausercanbookmark herownsubmitted project check aso4.project s bookmark s user project s user check pso5.ausercanputmultiple commen tsonone project check abo6.deleting auserdeletes herbookmarks abo7.deleting auserdeletes heractivities abo8.deleting auserdoesn tdelete hercommen ts check abo9.deleting aprojectdeletes itsratings abo10.deleting aprojectrating doesn tdelete project check substruct prop erties ass1.everycartisassociated withauser check pss2.anproductcanbeonmultiple wishlists check pss3.awishlist canbeempty check ass4.aproductisonauser s wishlist atmostonce pss5.ausercanhavemultiple orders check abs6.deleting acartdoesn tdelete itsproducts check abs7.deleting aproductdeletes itfromallcarts abs8.deleting auserdeletes herorders abs9.deleting userdoesn tdelete items onher wishlists check abs10.deleting awishlist doesn tdelete itsitem check fatfreecrm prop erties asf1.everytaskmusthaveauser check asf2.everyleadbelongs toexactly oneuser check asf3.accoun topportunit y sopportunit y accoun topportunit y saccoun t sopportunit y check psf4.acontactmayhavenotasks check asf5.user s opportunit y user s campaigns opportunit y abf6.deleting aleaddoesnotdelete contacts check abf7.deleting leaddoesnotdelete user check abf8.deleting anaccoun tdeletes associated tasks check abf9.deleting aleadleavesnodangling contacts abf10.deleting anaccoun tdoesnotdelete contacts check table3 z3verification times inseconds notprojected projected lovdbyless .
.
tracks .
.
osr .
.
substruct .
.
fatfreecrm .
.013217figure verification time alloyvsz3 z3usesmanyheuristics toeliminate quantifiers informulas.
itusesane graph toinstan tiatequantified variables which inconjunction withcodetrees aninverted pathindex and eager instan tiation makesitveryeffectiv eatdealing with quantifiers .notethatthese heuristics donotaffect the soundness oftheverification.
another reason whyz3performed betterthanalloymaybeduetotheirimplemen tationlanguages z3isimplemen tedinc whereas alloy aswellasthesatsolverituses sat4j isimplemen tedin java.finally another likelyreason thatz3ismoreefficien t thanalloyisthatsmt solversoperate atahigher levelof abstraction thansatsolvers.thussmt solverscanuse information aboutthestructure andseman ticsofaformula tomakeinferences aboutsatisfiabilit ymore accurately as wellasmore efficien tlythanasat based approac hwhich convertstheverification tosatformulasusing aboolean encoding.
infact duetoincreasing sizeoftheboolean encoding bounded verification suffers fromanexponential increase inverification timewithincreasing bound.
besides verification time wealsomeasured thenumberof clauses andvariables created byalloy ssattranslation.
these measuremen tswereaveraged overtheproperties for eachapplication andplotted overincreasing scope asshown infigure .
thenumberofclauses andvariables werealsoaveraged over properties forthesmt lib specifications foreachapplication.
infigure 4isaplotofthenumberofclauses and variables inthespecifications foreachapplication.
boththe projected andnon pro jected versions ofthespecifications areshown.weseeatremendous decrease inthenumberofvariables andclauses afterperforming thedatamodel projection.
although thenumberofvariables andclauses figure formulasize smt figure formulasize alloy inthesmt specification arenotdirectly comparable tothe figures produced byalloy wecanstillobserv ethatthesmt formulasizeismuchsmaller thantheoneusedbythesat solver.wealsoobserv ethatbounded verification hasthe disadv antagethatthesizeoftheformulausedbythesat solverincreases exponentially withrespecttobound.
overallourexperimen talresults indicate thatunbounded verification using smtsolversismoreefficien tthanbounded verification.
thisleadsustoconclude thattheapproac hwe presen tedinthispaperisafeasible andefficien tapproac h todatamodelverification.
.rela ted work there hasbeenpriorworkontheverification ofdatamodels these workspresen tbounded verification approac hesusingthealloyanalyzer.
forexample mapping relational database schemas toalloyhasbeenstudied before .also translating ora ss specifications adatamodeling language forsemi structured data toalloyandusing alloyanalyzer tofindaninstance oftheinput datamodelhasbeeninvestigated .however unlikeourwork these approac hesare bounded whereas ourtechnique performs unbounded verification.
alsothetranslation isnotautomated intheseearlier efforts.
finally alloyhasalsobeenusedfordiscoveringbugs inwebapplications related tobrowserandbusiness logicinteractions .thisisadifferen tclassofbugsthanthedata modelrelated bugswefocusoninthispaper.
there hasbeensomerecentworkonunbounded verification ofalloyspecifications using smtsolvers buttothebest ofourknowledge thisapproac hhasnotbeenimplemen ted yet.unbounded verification ofalloyspecifications maybe more challenging thanthedatamodelverification problem thatwefocusoninthispapersincethealloylanguage provides powerfulconstructs suchastransitiv eclosure.
such218constructs donotappearinthedatamodelsthatweextract fromwebapplications.
there hasbeenrecentworkonspecification andanalysis of conceptual datamodels .these efforts followthe model driv endevelopmen tapproac hwhereas ourapproac h isareverseengineering approac hthatextracts themodelof anexisting application andanalyzes ittofinderrors.
there areearlier results ontheformal modeling ofwebapplications focusing onstatemachine based formalisms tocapturethenavigation behavior forexample .in contrasttothislineofwork wearefocusing onanalysis of thedatamodelrather thanthenavigational aspectsofthe webapplications.
there hasbeenearlier workonreducing thecostofautomated verification byanalyzing dependencies suchascone ofinfluence reduction andprogram analysis based reductions .compared tothese earlier results ourprojection algorithm isaspecialized reduction technique fordatamodel verification thatutilizes thedatamodelseman tics.
thefactthatverification withsmt solverscanbemore efficien tthansat based bounded verification hasbeenobservedinother verification domains .however thedata modelverification problem weinvestigate inthispaperis differen tfromtheproblems studied inthese earlier works.
thispaperbuilds onourearlier workonbounded verification ofrails datamodels .
there areseveralsignificantdifferences inthispapercompared totheworkpresentedin inthispaperweuseanunbounded verification approac hbased onsmt solv ersasopposedtothe bounded sat based verification approac husedin .
thispaperdirectly constructs formulasinthetheory ofuninterpreted functions fromverification queries aboutagiven rails datamodel whereas theapproac hpresen tedin translates datamodelstoalloyspecifications whichalloy analyzer thenconvertstoboolean satformulas.
we presen tanoveldatamodelprojection technique thatsimplifies thegenerated formulabyremovingconstrain tsabout thedatamodelthatarenotrelevanttothepropertybeingverified impro vingtheperformance oftheanalysis.
wepresen texperimen talanalysis demonstrating theperformance oftheproposedverification approac honfiveopen source rails applications.
weexperimen tallycompare theunbounded verification approac hpresen tedinthispaper withthebounded verification approac hpresen tedin and showthattheunbounded verification approac hpresen tedin thispaperismore efficien t. .conclusion wepresen tedanunbounded verification approac hforweb application datamodels.weautomatically extract aformal datamodelfromtheorm specifications inmvc based web applications andtranslate verification queries aboutthese modelstosatisfiabilit yqueries inthetheory ofuninterpreted functions.
weuseansmt solvertocheckthesatisfiabilit y oftheresulting formulas.
thisapproac hwasimplemen ted inatoolthatverifies rails datamodels.
ourexperimen ts demonstrate thatourapproac hiseffectiv einverifying datamodelsofreal w orldwebapplications andthatitismore efficien tthansat based bounded verification.
.